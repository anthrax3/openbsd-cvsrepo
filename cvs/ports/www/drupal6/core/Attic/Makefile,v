head	1.48;
access;
symbols
	OPENBSD_5_9:1.46.0.2
	OPENBSD_5_9_BASE:1.46
	OPENBSD_5_8:1.43.0.4
	OPENBSD_5_8_BASE:1.43
	OPENBSD_5_7:1.39.0.2
	OPENBSD_5_7_BASE:1.39
	OPENBSD_5_6:1.37.0.2
	OPENBSD_5_6_BASE:1.37
	OPENBSD_5_5:1.35.0.2
	OPENBSD_5_5_BASE:1.35
	OPENBSD_5_4:1.33.0.2
	OPENBSD_5_4_BASE:1.33
	OPENBSD_5_3:1.31.0.2
	OPENBSD_5_3_BASE:1.31
	OPENBSD_5_2:1.30.0.2
	OPENBSD_5_2_BASE:1.30
	OPENBSD_5_1_BASE:1.26
	OPENBSD_5_1:1.26.0.2
	OPENBSD_5_0:1.20.0.2
	OPENBSD_5_0_BASE:1.20
	OPENBSD_4_9:1.15.0.2
	OPENBSD_4_9_BASE:1.15
	OPENBSD_4_8:1.10.0.2
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.9.0.2
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.2.0.2
	OPENBSD_4_6_BASE:1.2;
locks; strict;
comment	@# @;


1.48
date	2016.06.30.12.02.30;	author espie;	state dead;
branches;
next	1.47;
commitid	d5LtwRSRpLZYpXvK;

1.47
date	2016.06.30.11.48.25;	author espie;	state Exp;
branches;
next	1.46;
commitid	UBOsw9sxU3iGlgDU;

1.46
date	2015.12.30.10.01.25;	author ajacoutot;	state Exp;
branches;
next	1.45;
commitid	70nO8w9Ckt7hbcu6;

1.45
date	2015.11.02.11.56.55;	author espie;	state Exp;
branches;
next	1.44;
commitid	ox8NBCUwS6UB4UwE;

1.44
date	2015.11.01.09.04.23;	author espie;	state Exp;
branches;
next	1.43;
commitid	iwnDJV33zbAmFoUU;

1.43
date	2015.07.09.13.28.54;	author espie;	state Exp;
branches;
next	1.42;
commitid	I49kzIVGF37YWZTF;

1.42
date	2015.06.05.06.00.22;	author robert;	state Exp;
branches;
next	1.41;
commitid	PS9YXjRm9KQkIZjT;

1.41
date	2015.05.27.13.39.09;	author espie;	state Exp;
branches;
next	1.40;
commitid	z0GapiB86fHAuyZa;

1.40
date	2015.05.27.13.37.52;	author espie;	state Exp;
branches;
next	1.39;
commitid	q8t7cd8le3UinMPr;

1.39
date	2015.01.29.13.22.04;	author sthen;	state Exp;
branches;
next	1.38;
commitid	ViQRFoU481m8Cu5M;

1.38
date	2014.11.06.17.13.40;	author sthen;	state Exp;
branches;
next	1.37;
commitid	ig1O4RkSPXzTZYwZ;

1.37
date	2014.07.21.11.43.15;	author sthen;	state Exp;
branches;
next	1.36;
commitid	O9yVDwk90ByxxvPM;

1.36
date	2014.05.30.13.20.13;	author sthen;	state Exp;
branches;
next	1.35;

1.35
date	2014.02.08.18.16.39;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2013.08.12.04.11.21;	author robert;	state Exp;
branches;
next	1.33;

1.33
date	2013.05.05.19.24.13;	author jasper;	state Exp;
branches;
next	1.32;

1.32
date	2013.03.17.07.21.17;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2013.01.18.11.19.05;	author sthen;	state Exp;
branches;
next	1.30;

1.30
date	2012.05.11.07.46.56;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2012.03.20.10.00.13;	author sthen;	state Exp;
branches;
next	1.28;

1.28
date	2012.03.18.16.18.34;	author sthen;	state Exp;
branches;
next	1.27;

1.27
date	2012.03.18.16.15.16;	author sthen;	state Exp;
branches;
next	1.26;

1.26
date	2012.02.03.10.14.12;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2012.01.28.11.20.52;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	2012.01.27.20.59.48;	author espie;	state Exp;
branches;
next	1.23;

1.23
date	2012.01.11.22.27.26;	author sthen;	state Exp;
branches;
next	1.22;

1.22
date	2011.11.16.15.56.37;	author robert;	state Exp;
branches;
next	1.21;

1.21
date	2011.09.16.12.00.06;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2011.07.22.10.20.10;	author sthen;	state Exp;
branches;
next	1.19;

1.19
date	2011.07.11.08.14.14;	author robert;	state Exp;
branches;
next	1.18;

1.18
date	2011.07.09.00.14.45;	author robert;	state Exp;
branches;
next	1.17;

1.17
date	2011.06.02.13.41.41;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2011.05.30.15.35.28;	author landry;	state Exp;
branches;
next	1.15;

1.15
date	2010.11.22.08.36.47;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2010.11.15.12.58.52;	author stephan;	state Exp;
branches;
next	1.13;

1.13
date	2010.11.15.09.05.41;	author stephan;	state Exp;
branches;
next	1.12;

1.12
date	2010.09.14.10.14.33;	author stephan;	state Exp;
branches;
next	1.11;

1.11
date	2010.08.31.08.15.45;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2010.06.03.16.25.23;	author espie;	state Exp;
branches
	1.10.2.1;
next	1.9;

1.9
date	2010.03.05.09.09.23;	author stephan;	state Exp;
branches
	1.9.2.1;
next	1.8;

1.8
date	2009.12.18.19.05.57;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2009.10.01.12.28.34;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2009.09.20.11.56.37;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2009.07.26.12.20.07;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2009.07.17.09.33.12;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2009.07.15.10.33.39;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2009.05.15.21.21.27;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2009.04.03.23.26.48;	author espie;	state Exp;
branches;
next	;

1.9.2.1
date	2010.09.16.02.23.16;	author william;	state Exp;
branches;
next	;

1.10.2.1
date	2010.09.16.02.24.08;	author william;	state Exp;
branches;
next	;


desc
@@


1.48
log
@byebye
@
text
@# $OpenBSD: Makefile,v 1.47 2016/06/30 11:48:25 espie Exp $

COMMENT =	powerful content management system
MAINTAINER =	Marc Espie <espie@@openbsd.org>

DISTNAME =	drupal-6.36
DISTFILES =	${DISTNAME}${EXTRACT_SUFX}
REVISION =	2

MODULES=	lang/php
RUN_DEPENDS=	php-mysql-${MODPHP_VSPEC}|php-mysqli-${MODPHP_VSPEC}|php-pgsql-${MODPHP_VSPEC}:lang/php/${MODPHP_VERSION},-mysql \
		lang/php/${MODPHP_VERSION},-gd

do-install:
		mkdir -p ${PREFIX}/${DRUPAL_ROOT}
		# copy base distrib
		cp -R ${WRKDIST}/* ${PREFIX}/${DRUPAL_ROOT}
		# copy config file
		${SUBST_CMD} -m 444 -c ${FILESDIR}/drupal.conf \
			${PREFIX}/${DRUPAL_ROOT}/misc/drupal.conf
		install -d -o www ${PREFIX}/${DRUPAL_ROOT}/files
		chmod 640 ${PREFIX}/${DRUPAL_ROOT}/sites/default/default.settings.php
		chgrp www ${PREFIX}/${DRUPAL_ROOT}/sites/default/default.settings.php
		${INSTALL_DATA_DIR} ${PREFIX}/${DRUPAL_MODS}
		${INSTALL_DATA_DIR} ${PREFIX}/${DRUPAL_THEMES}

.include <bsd.port.mk>
@


1.47
log
@depend on the new core
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2015/12/30 10:01:25 ajacoutot Exp $
@


1.46
log
@@@sample /var/www/conf/modules.sample/

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2015/11/02 11:56:55 espie Exp $
d8 1
a8 1
REVISION =	0
@


1.45
log
@a few minor pkg_subst fixes, for the coming patch (disallow -c without -m
outside of WRKDIR)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2015/11/01 09:04:23 espie Exp $
d8 1
@


1.44
log
@make sure we specify a mode for files copied from FILESDIR...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2015/07/09 13:28:54 espie Exp $
d18 1
a18 1
		${SUBST_CMD} -m 440 -c ${FILESDIR}/drupal.conf \
@


1.43
log
@belated update to 6.36.
need some fixes for php-5.6, as their unicode detect test is broken.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2015/06/05 06:00:22 robert Exp $
d18 1
a18 1
		${SUBST_CMD} -c ${FILESDIR}/drupal.conf \
@


1.42
log
@bump revision due to the change of the default php version to 5.6
ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2015/05/27 13:39:09 espie Exp $
d6 1
a6 1
DISTNAME =	drupal-6.34
a7 1
REVISION =	2
a12 1
SUBST_VARS += DRUPAL
@


1.41
log
@thinko in previous
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2015/05/27 13:37:52 espie Exp $
d8 1
a8 1
REVISION =	1
@


1.40
log
@use SUBST_CMD. Let drupal6.conf work with localbase apache
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2015/01/29 13:22:04 sthen Exp $
d8 1
a8 1
REVISION =	0
@


1.39
log
@update to drupal 6.34, ok espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2014/11/06 17:13:40 sthen Exp $
d8 1
d14 1
d20 2
a21 5
		perl -p \
			-e 's@@\$$\{DRUPAL_ROOT\}@@${DRUPAL_ROOT}@@g;' \
			-e 's@@\$$\{DRUPAL\}@@${DRUPAL}@@g;' \
			<${FILESDIR}/drupal.conf \
			>${PREFIX}/${DRUPAL_ROOT}/misc/drupal.conf
@


1.38
log
@bump REVISION for php version switch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2014/07/21 11:43:15 sthen Exp $
d6 1
a6 1
DISTNAME =	drupal-6.32
a7 1
REVISION =	0
@


1.37
log
@drupal6 updates: core 6.3.2 (security update), date 2.10, filefield 3.13
ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2014/05/30 13:20:13 sthen Exp $
d8 1
@


1.36
log
@bump ports which may have been installed when /var/www/modules.sample didn't
exist, to force an update to make sure that their config samples get installed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2014/02/08 18:16:39 espie Exp $
d6 1
a6 1
DISTNAME =	drupal-6.30
a7 1
REVISION =	0
@


1.35
log
@belated security updates.
add a comment to readme as the mysql size error is common...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2013/08/12 04:11:21 robert Exp $
d8 1
@


1.34
log
@bump REVISION due to the php update
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2013/05/05 19:24:13 jasper Exp $
d6 1
a6 1
DISTNAME =	drupal-6.28
a7 1
REVISION =	2
@


1.33
log
@modules.sample/ always lives in /var/www, so no need for ${PREFIX} here.

as discussed with aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2013/03/17 07:21:17 ajacoutot Exp $
d8 1
a8 1
REVISION =	1
@


1.32
log
@Remove duplicate information that is to be moved to the mysql README.

ok brad@@ sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2013/01/18 11:19:05 sthen Exp $
d8 1
a8 1
REVISION =	0
@


1.31
log
@SECURITY update to drupal6-core 6.28, ok espie

- cross site scripting
- access permissions bypass issues
- code execution in upload, though not with standard htaccess configuration

http://drupal.org/SA-CORE-2012-004 http://drupal.org/SA-CORE-2013-001
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2012/05/11 07:46:56 espie Exp $
d8 1
@


1.30
log
@minor update. Add a note about my.cnf
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2012/03/20 10:00:13 sthen Exp $
d6 1
a6 1
DISTNAME =	drupal-6.26
@


1.29
log
@fix botched update commit.. pointed out by landry, no cookie for me!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2012/02/03 10:14:12 espie Exp $
d6 1
a6 1
DISTNAME =	drupal-6.25
@


1.28
log
@oops, fix CVS conflict in $OpenBSD$ line.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2012/03/18 16:15:16 sthen Exp $
d6 1
a6 1
DISTNAME =	drupal-6.24
@


1.27
log
@update to drupal core 6.25; minor fixes. ok espie@@
@
text
@d1 1
a1 5
<<<<<<< Makefile
# $OpenBSD: Makefile,v 1.25 2012/01/28 11:20:52 espie Exp $
=======
# $OpenBSD: Makefile,v 1.26 2012/02/03 10:14:12 espie Exp $
>>>>>>> 1.26
@


1.26
log
@xss agregator dos in 6.22
okay sthen@@
@
text
@d1 1
d3 3
@


1.25
log
@people keep adding drupal modules without changing the default MAINTAINER,
so start putting myself in on stuff I explicitly want to maintain...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/01/27 20:59:48 espie Exp $
d6 1
a6 1
DISTNAME =	drupal-6.22
a7 1
REVISION =	7
@


1.24
log
@restore sanity for plain installs... how do you expect the installer to
work if it can't write its configuration ?
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/01/11 22:27:26 sthen Exp $
d4 1
@


1.23
log
@use MODPHP_VSPEC for either|or dependencies on php5 extension modules
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2011/11/16 15:56:37 robert Exp $
d7 1
a7 1
REVISION =	6
@


1.22
log
@switch php to version 5.3 by default
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2011/09/16 12:00:06 espie Exp $
d7 1
a7 1
REVISION =	5
d10 1
a10 1
RUN_DEPENDS=	php-mysql-*|php-mysqli-*|php-pgsql-*:lang/php/${MODPHP_VERSION},-mysql \
@


1.21
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2011/07/22 10:20:10 sthen Exp $
d7 1
a7 1
REVISION =	4
@


1.20
log
@Bump for PKGSPEC changes in ports/lang/php/Makefile.inc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2011/07/11 08:14:14 robert Exp $
d7 1
a7 1
REVISION =	3
@


1.19
log
@add missing lang/php module and bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2011/07/09 00:14:45 robert Exp $
d7 1
a7 1
REVISION =	2
@


1.18
log
@switch to lang/php
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/06/02 13:41:41 ajacoutot Exp $
d7 1
a7 1
REVISION =	1
d9 1
@


1.17
log
@Add a consistent header that substitutes FULLPKGNAME for the READMEs.

ok jasper@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/05/30 15:35:28 landry Exp $
d4 1
a4 1
 
d6 5
a10 2
DISTFILES=	${DISTNAME}${EXTRACT_SUFX}
REVISION=	0
a11 5
RUN_DEPENDS = 	www/php5/core \
	php5-mysql-*|php5-mysqli-*|php5-pgsql-*:www/php5/extensions,-mysql \
		www/php5/extensions,-gd \
		www/php5/extensions,-mbstring
		
@


1.16
log
@Security update to drupal 6.22, from wen heping.

Fixes SA-CORE-2011-001, see http://drupal.org/node/1168756 for details.
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2010/11/22 08:36:47 espie Exp $
d7 1
@


1.15
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2010/11/15 12:58:52 stephan Exp $
d5 1
a5 2
DISTNAME =	drupal-6.19
REVISION =	1
@


1.14
log
@switch to pkg-readme, ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2010/11/15 09:05:41 stephan Exp $
d9 4
a12 4
RUN_DEPENDS = 	::www/php5/core \
	:php5-mysql-*|php5-mysqli-*|php5-pgsql-*:www/php5/extensions,-mysql \
		::www/php5/extensions,-gd \
		::www/php5/extensions,-mbstring
@


1.13
log
@least invasive round of cleanup:
- install drupal modules/themes as root:daemon rather than www:www
  (only the files/ directory needs to be writeable by 'www').
- don't install 'settings.php' world-readable since it contains the
  DB password. Use 640, owner 'www' instead.
- bump all modules.

tested in production, including upgrade szenarios.
ok sthen@@ and landry@@, maintainer timeout.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2010/09/14 10:14:33 stephan Exp $
d6 1
a6 1
REVISION =	0
@


1.12
log
@update drupal core to 6.19, addresses SA-CORE-2010-002:
 - OpenID authentication bypass
 - File download access bypass
 - Comment unpublishing bypass
 - Actions cross site scripting

gory details at http://drupal.org/node/880476
no database upgrade required for this update.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2010/08/31 08:15:45 ajacoutot Exp $
d6 1
d24 3
a26 1
		${INSTALL_DATA_DIR} ${PREFIX}/${DRUPAL_ROOT}/files
a28 2
		# give everything to www
		chown -R www.www ${PREFIX}/${DRUPAL_ROOT}
@


1.11
log
@Remove PKGNAME=${DISTNAME} constructs where possible, as this is the
default anyway.

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2010/06/03 16:25:23 espie Exp $
d5 1
a5 1
DISTNAME =	drupal-6.17
@


1.10
log
@minor updates.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/03/05 09:09:23 stephan Exp $
a5 1
PKGNAME=	${DISTNAME}
@


1.10.2.1
log
@SECURITY UPDATE to drupal-6.18

Resolves SA-CORE-2010-002

From stephan@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2010/06/03 16:25:23 espie Exp $
d5 1
a5 1
DISTNAME =	drupal-6.18
@


1.9
log
@security update to 6.16, fixes DRUPAL-SA-CORE-2010-001.

ok jasper@@, "I can vouch for it" @@espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2009/12/18 19:05:57 espie Exp $
d5 1
a5 1
DISTNAME =	drupal-6.16
@


1.9.2.1
log
@SECURITY UPDATE to drupal-6.18

Resolves SA-CORE-2010-002

From stephan@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/03/05 09:09:23 stephan Exp $
d5 1
a5 1
DISTNAME =	drupal-6.18
@


1.8
log
@DRUPAL-SA-CORE-2009-009

Vulnerabilities in Contact module, XSS if malicious users can create menus.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2009/09/20 11:56:37 espie Exp $
d5 1
a5 1
DISTNAME =	drupal-6.15
@


1.7
log
@Tweak MESSAGE now that /var/www/tmp/ is here by default.
@
text
@d5 2
a6 2
DISTNAME =	drupal-6.14
PKGNAME=	${DISTNAME}p0
@


1.6
log
@security update (DRUPAL-SA-CORE-2009-008):
if you use OpenID, or your uploads are badly configured, you have a
security risk.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2009/07/26 12:20:07 espie Exp $
d6 1
a6 1
PKGNAME=	${DISTNAME}
@


1.5
log
@tweak SUBST_VARS so that nodeaccess won't match DRUPAL_LOCALE (oops)
a few PKGNAME bumps needed after regenerating plists, because of DESCR
changes or .orig files from patches.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2009/07/17 09:33:12 espie Exp $
d5 2
a6 2
DISTNAME =	drupal-6.13
PKGNAME=	${DISTNAME}p1
@


1.4
log
@a few minor tweaks:
- don't reload rewrite if it's already there, one less warning for httpd
- pinpoint translation errors
- document the painful state of updates from drupal5...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2009/07/15 10:33:39 espie Exp $
d6 1
a6 1
PKGNAME=	${DISTNAME}p0
@


1.3
log
@update to current versions
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2009/05/15 21:21:27 sthen Exp $
d6 1
a6 1
PKGNAME=	${DISTNAME}
@


1.2
log
@update to 6.12, fixes an xss issue. ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2009/04/03 23:26:48 espie Exp $
d5 1
a5 1
DISTNAME =	drupal-6.12
@


1.1
log
@hate cvs... "core" directory with stuff in it should be okay by default.
noticed by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2009/04/03 19:03:03 espie Exp $
d5 1
a5 1
DISTNAME =	drupal-6.10
@

