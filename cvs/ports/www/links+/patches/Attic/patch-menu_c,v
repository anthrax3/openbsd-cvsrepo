head	1.9;
access;
symbols
	OPENBSD_3_8:1.8.0.4
	OPENBSD_3_8_BASE:1.8
	OPENBSD_3_7:1.8.0.2
	OPENBSD_3_7_BASE:1.8
	OPENBSD_3_6:1.6.0.4
	OPENBSD_3_6_BASE:1.6
	OPENBSD_3_5:1.6.0.2
	OPENBSD_3_5_BASE:1.6
	OPENBSD_3_4:1.4.0.2
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.2.0.2
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.1.0.2
	OPENBSD_3_2_BASE:1.1;
locks; strict;
comment	@# @;


1.9
date	2005.09.28.05.59.36;	author fgsch;	state dead;
branches;
next	1.8;

1.8
date	2005.02.24.22.24.55;	author fgsch;	state Exp;
branches;
next	1.7;

1.7
date	2004.12.04.01.01.42;	author fgsch;	state Exp;
branches;
next	1.6;

1.6
date	2003.11.17.22.59.32;	author fgsch;	state Exp;
branches;
next	1.5;

1.5
date	2003.09.23.06.35.33;	author fgsch;	state Exp;
branches;
next	1.4;

1.4
date	2003.06.12.13.47.44;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2003.04.07.19.30.21;	author fgsch;	state Exp;
branches;
next	1.2;

1.2
date	2002.12.28.21.49.14;	author fgsch;	state Exp;
branches;
next	1.1;

1.1
date	2002.09.16.04.11.23;	author fgsch;	state Exp;
branches;
next	;


desc
@@


1.9
log
@update to 2.1pre18. most of the patches were accepted one way or another.
tested by jolan and pedro.
@
text
@$OpenBSD: patch-menu_c,v 1.8 2005/02/24 22:24:55 fgsch Exp $
--- menu.c.orig	Sat Jan 22 17:51:55 2005
+++ menu.c	Mon Feb 21 12:23:12 2005
@@@@ -397,7 +397,7 @@@@ void flush_caches(struct terminal *term,
 /* jde v historii o psteps polozek dozadu */
 void go_backwards(struct terminal *term, void *psteps, struct session *ses)
 {
-	long steps = (long) psteps;
+	long steps = (intptr_t) psteps;
 
 	/*if (ses->tq_goto_position)
 		--steps;
@@@@ -481,7 +481,7 @@@@ void menu_toggle(struct terminal *term, 
 
 void display_codepage(struct terminal *term, void *pcp, struct session *ses)
 {
-	long cp = (long)pcp;
+	long cp = (intptr_t)pcp;
 	struct term_spec *t = new_term_spec(term->term);
 	if (t) t->charset = cp;
 	cls_redraw_all_terminals();
@@@@ -489,7 +489,7 @@@@ void display_codepage(struct terminal *t
 
 void assumed_codepage(struct terminal *term, void *pcp, struct session *ses)
 {
-	long cp = (long)pcp;
+	long cp = (intptr_t)pcp;
 	ses->ds.assume_cp = cp;
 	redraw_terminal_cls(term);
 }
@@@@ -511,7 +511,7 @@@@ void charset_list(struct terminal *term,
 
 void set_val(struct terminal *term, void *ip, int *d)
 {
-	*d = (long)ip;
+	*d = (intptr_t)ip;
 }
 
 void charset_sel_list(struct terminal *term, struct session *ses, int *ptr, int noutf8)
@@@@ -1943,7 +1943,7 @@@@ void miscelaneous_options(struct termina
 
 void menu_set_language(struct terminal *term, void *pcp, struct session *ses)
 {
-	set_language((long)pcp);
+	set_language((intptr_t)pcp);
 	cls_redraw_all_terminals();
 }
 
@


1.8
log
@update to 2.1pre16 and remove my shift fix since it causes troubles in
other areas. reported by Ray <ray at cyth dot net> and
Alex Holst <a at mongers dot org>. tested by jolan@@ and pedro@@
@
text
@d1 1
a1 1
$OpenBSD: patch-menu_c,v 1.7 2004/12/04 01:01:42 fgsch Exp $
@


1.7
log
@update to 2.1pre15. prompted some time ago by
Julian Leyh <oenone at oenone dot de>. sorry for the delay dude.
@
text
@d1 4
a4 4
$OpenBSD: patch-menu_c,v 1.6 2003/11/17 22:59:32 fgsch Exp $
--- menu.c.orig	Tue Apr 20 05:08:43 2004
+++ menu.c	Fri Dec  3 20:35:32 2004
@@@@ -329,7 +329,7 @@@@ void flush_caches(struct terminal *term,
d8 2
a9 2
-	int steps = (int) psteps;
+	int steps = (intptr_t) psteps;
d13 1
a13 10
@@@@ -363,7 +363,7 @@@@ void history_menu(struct terminal *term,
 	foreach(l, ses->history) {
 		if (n/* || ses->tq_goto_position*/) {
 			if (!mi && !(mi = new_menu(3))) return;
-			add_to_menu(&mi, stracpy(l->url), "", "", MENU_FUNC go_backwards, (void *) n, 0);
+			add_to_menu(&mi, stracpy(l->url), "", "", MENU_FUNC go_backwards, (void *)(intptr_t) n, 0);
 		}
 		n++;
 	}
@@@@ -410,7 +410,7 @@@@ void menu_toggle(struct terminal *term, 
d17 2
a18 2
-	int cp = (int)pcp;
+	int cp = (intptr_t)pcp;
d22 1
a22 1
@@@@ -418,7 +418,7 @@@@ void display_codepage(struct terminal *t
d26 2
a27 2
-	int cp = (int)pcp;
+	int cp = (intptr_t)pcp;
d31 1
a31 10
@@@@ -431,7 +431,7 @@@@ void charset_list(struct terminal *term,
 	if (!(mi = new_menu(1))) return;
 	for (i = 0; (n = get_cp_name(i)); i++) {
 		if (is_cp_special(i)) continue;
-		add_to_menu(&mi, get_cp_name(i), "", "", MENU_FUNC display_codepage, (void *)i, 0);
+		add_to_menu(&mi, get_cp_name(i), "", "", MENU_FUNC display_codepage, (void *)(intptr_t)i, 0);
 	}
 	sel = ses->term->spec->charset;
 	if (sel < 0) sel = 0;
@@@@ -440,7 +440,7 @@@@ void charset_list(struct terminal *term,
d35 1
a35 1
-	*d = (int)ip;
d39 2
a40 11
 void charset_sel_list(struct terminal *term, struct session *ses, int *ptr)
@@@@ -450,7 +450,7 @@@@ void charset_sel_list(struct terminal *t
 	struct menu_item *mi;
 	if (!(mi = new_menu(1))) return;
 	for (i = 0; (n = get_cp_name(i)); i++) {
-		add_to_menu(&mi, get_cp_name(i), "", "", MENU_FUNC set_val, (void *)i, 0);
+		add_to_menu(&mi, get_cp_name(i), "", "", MENU_FUNC set_val, (void *)(intptr_t)i, 0);
 	}
 	sel = *ptr;
 	if (sel < 0) sel = 0;
@@@@ -1894,7 +1894,7 @@@@ void miscelaneous_options(struct termina
d44 1
a44 1
-	set_language((int)pcp);
a48 9
@@@@ -1906,7 +1906,7 @@@@ void menu_language_list(struct terminal 
 	if (!(mi = new_menu(1))) return;
 	for (i = 0; i < n_languages(); i++) {
 		n = language_name(i);
-		add_to_menu(&mi, n, "", "", MENU_FUNC menu_set_language, (void *)i, 0);
+		add_to_menu(&mi, n, "", "", MENU_FUNC menu_set_language, (void *)(intptr_t)i, 0);
 	}
 	sel = current_language;
 	do_menu_selected(term, mi, ses, sel);
@


1.6
log
@update to links2.1pre14; tested by jolan@@ and Pedro Bastos.
@
text
@d1 3
a3 3
$OpenBSD: patch-menu_c,v 1.5 2003/09/23 06:35:33 fgsch Exp $
--- menu.c.orig	2003-11-10 15:03:30.000000000 -0300
+++ menu.c	2003-11-17 19:09:12.000000000 -0300
d67 1
a67 1
@@@@ -1885,7 +1885,7 @@@@ void miscelaneous_options(struct termina
d76 1
a76 1
@@@@ -1897,7 +1897,7 @@@@ void menu_language_list(struct terminal 
@


1.5
log
@update to links 2.1pre12.
@
text
@d1 3
a3 3
$OpenBSD: patch-menu_c,v 1.4 2003/06/12 13:47:44 brad Exp $
--- menu.c.orig	2003-09-01 17:22:57.000000000 -0300
+++ menu.c	2003-09-23 02:55:15.000000000 -0300
d67 1
a67 85
@@@@ -751,26 +751,68 @@@@ int dlg_http_options(struct dialog_data 
 	return 0;
 }
 
+unsigned char *ftp_labels[] = { TEXT(T_USE_PASSIVE), TEXT(T_PASSWORD_FOR_ANONYMOUS_LOGIN) };
+
+void ftpopt_fn(struct dialog_data *dlg)
+{
+	struct terminal *term = dlg->win->term;
+	int max = 0, min = 0;
+	int w, rw;
+	int y = 0;
+	checkboxes_width(term, dlg->dlg->udata, &max, max_text_width);
+	checkboxes_width(term, dlg->dlg->udata, &min, min_text_width);
+	max_text_width(term, ftp_labels[1], &max, AL_LEFT);
+	min_text_width(term, ftp_labels[1], &min, AL_LEFT);
+	max_buttons_width(term, dlg->items + dlg->n - 2, 2, &max);
+	min_buttons_width(term, dlg->items + dlg->n - 2, 2, &min);
+	w = term->x * 9 / 10 - 2 * DIALOG_LB;
+	if (w > max) w = max;
+	if (w < min) w = min;
+	if (w > term->x - 2 * DIALOG_LB) w = term->x - 2 * DIALOG_LB;
+	if (w < 5) w = 5;
+	rw = 0;
+	dlg_format_checkboxes(dlg, NULL, dlg->items, dlg->n - 3, 0, &y, w, &rw, dlg->dlg->udata);
+	y += gf_val(1, G_BFU_FONT_SIZE);
+	dlg_format_text(dlg, NULL, ftp_labels[1], 0, &y, w, &rw, COLOR_DIALOG_TEXT, AL_LEFT);
+	y += gf_val(1, 2 * G_BFU_FONT_SIZE);
+	dlg_format_buttons(dlg, NULL, dlg->items + dlg->n - 2, 2, 0, &y, w, &rw, AL_CENTER);
+	w = rw;
+	dlg->xw = rw + 2 * DIALOG_LB;
+	dlg->yw = y + 2 * DIALOG_TB;
+	center_dlg(dlg);
+	draw_dlg(dlg);
+	y = dlg->y + DIALOG_TB + gf_val(1, G_BFU_FONT_SIZE);
+	dlg_format_checkboxes(dlg, term, dlg->items, dlg->n - 3, dlg->x + DIALOG_LB, &y, w, NULL, dlg->dlg->udata);
+	y += gf_val(1, G_BFU_FONT_SIZE);
+	dlg_format_text(dlg, term, ftp_labels[1], dlg->x + DIALOG_LB, &y, w, NULL, COLOR_DIALOG_TEXT, AL_LEFT);
+	dlg_format_field(dlg, term, dlg->items + 1, dlg->x + DIALOG_LB, &y, w, NULL, AL_LEFT);
+	y += gf_val(1, G_BFU_FONT_SIZE);
+	dlg_format_buttons(dlg, term, dlg->items + dlg->n - 2, 2, dlg->x + DIALOG_LB, &y, w, &rw, AL_CENTER);
+}
+
 int dlg_ftp_options(struct dialog_data *dlg, struct dialog_item_data *di)
 {
 	struct dialog *d;
-	if (!(d = mem_alloc(sizeof(struct dialog) + 4 * sizeof(struct dialog_item)))) return 0;
-	memset(d, 0, sizeof(struct dialog) + 4 * sizeof(struct dialog_item));
+	if (!(d = mem_alloc(sizeof(struct dialog) + 5 * sizeof(struct dialog_item)))) return 0;
+	memset(d, 0, sizeof(struct dialog) + 5 * sizeof(struct dialog_item));
 	d->title = TEXT(T_FTP_OPTIONS);
-	d->fn = input_field_fn;
-	d->udata = TEXT(T_PASSWORD_FOR_ANONYMOUS_LOGIN);
-	d->items[0].type = D_FIELD;
-	d->items[0].dlen = MAX_STR_LEN;
-	d->items[0].data = di->cdata;
-	d->items[1].type = D_BUTTON;
-	d->items[1].gid = B_ENTER;
-	d->items[1].fn = ok_dialog;
-	d->items[1].text = TEXT(T_OK);
+	d->fn = ftpopt_fn;
+	d->udata = ftp_labels;
+	d->items[0].type = D_CHECKBOX;
+	d->items[0].dlen = sizeof(int);
+	d->items[0].data = (void *)&ftp_passive;
+	d->items[1].type = D_FIELD;
+	d->items[1].dlen = MAX_STR_LEN;
+	d->items[1].data = di->cdata;
 	d->items[2].type = D_BUTTON;
-	d->items[2].gid = B_ESC;
-	d->items[2].fn = cancel_dialog;
-	d->items[2].text = TEXT(T_CANCEL);
-	d->items[3].type = D_END;
+	d->items[2].gid = B_ENTER;
+	d->items[2].fn = ok_dialog;
+	d->items[2].text = TEXT(T_OK);
+	d->items[3].type = D_BUTTON;
+	d->items[3].gid = B_ESC;
+	d->items[3].fn = cancel_dialog;
+	d->items[3].text = TEXT(T_CANCEL);
+	d->items[4].type = D_END;
  	do_dialog(dlg->win->term, d, getml(d, NULL));
 	return 0;
 }
@@@@ -1845,7 +1887,7 @@@@ void miscelaneous_options(struct termina
d76 1
a76 1
@@@@ -1857,7 +1899,7 @@@@ void menu_language_list(struct terminal 
@


1.4
log
@upgrade to links 2.1pre11
fgsch@@ pval@@ ok
@
text
@d1 3
a3 3
$OpenBSD: patch-menu_c,v 1.3 2003/04/07 19:30:21 fgsch Exp $
--- menu.c.orig	Thu May 22 03:29:22 2003
+++ menu.c	Wed Jun  4 08:57:15 2003
d67 1
a67 1
@@@@ -755,26 +755,68 @@@@ int dlg_http_options(struct dialog_data 
d151 1
a151 1
@@@@ -1760,7 +1802,7 @@@@ void miscelaneous_options(struct termina
d160 1
a160 1
@@@@ -1772,7 +1814,7 @@@@ void menu_language_list(struct terminal 
@


1.3
log
@update to links 2.1pre9; tested by pvalchev@@ and Pedro Bastos.
@
text
@d1 3
a3 3
$OpenBSD: patch-menu_c,v 1.2 2002/12/28 21:49:14 fgsch Exp $
--- menu.c.orig	Thu Feb 20 10:01:13 2003
+++ menu.c	Fri Apr  4 00:16:19 2003
d22 1
a22 1
@@@@ -405,7 +405,7 @@@@ void menu_toggle(struct terminal *term, 
d31 1
a31 1
@@@@ -413,7 +413,7 @@@@ void display_codepage(struct terminal *t
d40 1
a40 1
@@@@ -426,7 +426,7 @@@@ void charset_list(struct terminal *term,
d49 1
a49 1
@@@@ -435,7 +435,7 @@@@ void charset_list(struct terminal *term,
d58 1
a58 1
@@@@ -445,7 +445,7 @@@@ void charset_sel_list(struct terminal *t
d67 1
a67 1
@@@@ -738,26 +738,68 @@@@ int dlg_http_options(struct dialog_data 
d151 1
a151 1
@@@@ -1739,7 +1781,7 @@@@ void miscelaneous_options(struct termina
d160 1
a160 1
@@@@ -1751,7 +1793,7 @@@@ void menu_language_list(struct terminal 
@


1.2
log
@o ftp passive support, based from elinks.
o bump package name.
@
text
@d1 4
a4 4
$OpenBSD: patch-menu_c,v 1.1 2002/09/16 04:11:23 fgsch Exp $
--- menu.c.orig	Sat Oct 12 16:48:21 2002
+++ menu.c	Sat Dec 28 18:26:00 2002
@@@@ -324,7 +324,7 @@@@ void flush_caches(struct terminal *term,
d13 1
a13 1
@@@@ -358,7 +358,7 @@@@ void history_menu(struct terminal *term,
d22 1
a22 1
@@@@ -400,7 +400,7 @@@@ void menu_toggle(struct terminal *term, 
d31 1
a31 1
@@@@ -408,7 +408,7 @@@@ void display_codepage(struct terminal *t
d40 1
a40 1
@@@@ -421,7 +421,7 @@@@ void charset_list(struct terminal *term,
d49 1
a49 1
@@@@ -430,7 +430,7 @@@@ void charset_list(struct terminal *term,
d58 1
a58 1
@@@@ -440,7 +440,7 @@@@ void charset_sel_list(struct terminal *t
d67 1
a67 1
@@@@ -733,26 +733,68 @@@@ int dlg_http_options(struct dialog_data 
d151 1
a151 1
@@@@ -1729,7 +1771,7 @@@@ void miscelaneous_options(struct termina
d160 1
a160 1
@@@@ -1741,7 +1783,7 @@@@ void menu_language_list(struct terminal 
@


1.1
log
@use intptr_t where needed.  pvalchev@@ actually noticed this and provided
diffs but unfortunately they got lost in a hd crash.
pvalchev@@ ok.
@
text
@d1 3
a3 3
$OpenBSD$
--- menu.c.orig	Sun Sep 15 10:16:34 2002
+++ menu.c	Sun Sep 15 10:19:02 2002
d67 85
a151 1
@@@@ -1729,7 +1729,7 @@@@ void miscelaneous_options(struct termina
d160 1
a160 1
@@@@ -1741,7 +1741,7 @@@@ void menu_language_list(struct terminal 
@

