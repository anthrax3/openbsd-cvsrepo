head	1.2;
access;
symbols
	OPENBSD_5_0:1.1.0.6
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.4
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2011.09.18.22.44.18;	author landry;	state dead;
branches;
next	1.1;

1.1
date	2010.06.19.10.34.41;	author landry;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Die die old horrible unmaintained piece of code. Too much bad memories
in there.
prodded by aja@@
@
text
@$OpenBSD: patch-module_embed_gecko_kz-mozwrapper_cpp,v 1.1 2010/06/19 10:34:41 landry Exp $
Backport of svn r3779 + r3872, fix for xl 1.9.2
--- module/embed/gecko/kz-mozwrapper.cpp.orig	Tue Sep 29 05:38:19 2009
+++ module/embed/gecko/kz-mozwrapper.cpp	Tue Jun 15 23:48:03 2010
@@@@ -99,13 +99,6 @@@@
 
 typedef nsString              nsAFlatString;
 typedef nsCString             nsAFlatCString;
-#ifndef G_OS_WIN32
-#  define nsString_h___
-#  define nsAString_h___
-#  include <nsPresContext.h>
-#  undef nsAString_h___
-#  undef nsString_h___
-#endif
 
 #include "kz-mozprogresslistener.h"
 #include "kz-mozutils.h"
@@@@ -2152,29 +2145,5 @@@@ KzMozWrapper::GetSelectedRange (nsIDOMDocument *domDoc
 gboolean
 KzMozWrapper::SetZoomOnDocShell (float aZoom, nsIDocShell *DocShell)
 {
-#ifndef G_OS_WIN32
-	nsCOMPtr<nsPresContext> PresContext;
-	nsresult rv = DocShell->GetPresContext (getter_AddRefs(PresContext));
-	if (NS_FAILED(rv) || !PresContext) return FALSE;
-
-	nsIDeviceContext *DeviceContext(nsnull);
-	DeviceContext = PresContext->DeviceContext();
-	if (!DeviceContext) return FALSE;
-
-	nsCOMPtr<nsIContentViewer> ContentViewer;
-	
-	rv = DocShell->GetContentViewer(getter_AddRefs(ContentViewer));
-	if (NS_FAILED(rv) || !ContentViewer) return FALSE;
-
-	nsCOMPtr<nsIMarkupDocumentViewer> mdv = do_QueryInterface(ContentViewer);
-	if (!mdv) return FALSE;
-
-	rv = mdv->SetTextZoom (aZoom);
-
-	if NS_FAILED(rv) return FALSE;
-	
-	return TRUE;
-#else
-	return FALSE;
-#endif
+	return NS_SUCCEEDED(mDOMWindow->SetTextZoom(aZoom));
 }
@


1.1
log
@Finally fix www/kazehakase, after lots of cries and pain with/about
libtool. Backport upstream svn r3779 + r3872 to correctly build with
xulrunner 1.9.2, and use ports libtool which does a way better job at
linking gecko.so than gnu libtool. This needs r1.120 of build/libtool.
@
text
@d1 1
a1 1
$OpenBSD$
@

