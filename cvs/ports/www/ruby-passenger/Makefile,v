head	1.53;
access;
symbols
	OPENBSD_6_1:1.50.0.2
	OPENBSD_6_1_BASE:1.50
	OPENBSD_6_0:1.46.0.2
	OPENBSD_6_0_BASE:1.46
	OPENBSD_5_9:1.45.0.2
	OPENBSD_5_9_BASE:1.45
	OPENBSD_5_8:1.43.0.4
	OPENBSD_5_8_BASE:1.43
	OPENBSD_5_7:1.39.0.2
	OPENBSD_5_7_BASE:1.39
	OPENBSD_5_6:1.33.0.2
	OPENBSD_5_6_BASE:1.33
	OPENBSD_5_5:1.32.0.2
	OPENBSD_5_5_BASE:1.32
	OPENBSD_5_4:1.30.0.2
	OPENBSD_5_4_BASE:1.30
	OPENBSD_5_3:1.26.0.2
	OPENBSD_5_3_BASE:1.26
	OPENBSD_5_2:1.22.0.4
	OPENBSD_5_2_BASE:1.22
	OPENBSD_5_1_BASE:1.22
	OPENBSD_5_1:1.22.0.2
	OPENBSD_5_0:1.19.0.2
	OPENBSD_5_0_BASE:1.19
	OPENBSD_4_9:1.15.0.2
	OPENBSD_4_9_BASE:1.15
	OPENBSD_4_8:1.5.0.2
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.3.0.2
	OPENBSD_4_7_BASE:1.3
	bernd_2009-08-20:1.1.1.1
	bernd:1.1.1;
locks; strict;
comment	@# @;


1.53
date	2017.07.26.22.45.31;	author sthen;	state Exp;
branches;
next	1.52;
commitid	tD4MFrpYYDDL2UFT;

1.52
date	2017.07.16.19.19.04;	author espie;	state Exp;
branches;
next	1.51;
commitid	tt0GhWK5c4uf9ILG;

1.51
date	2017.04.10.11.46.35;	author sthen;	state Exp;
branches;
next	1.50;
commitid	HY6VNZxjJWzKQFDV;

1.50
date	2017.03.13.21.32.51;	author jca;	state Exp;
branches;
next	1.49;
commitid	d68BZNyOXWNFX8kO;

1.49
date	2016.11.04.22.08.18;	author jeremy;	state Exp;
branches;
next	1.48;
commitid	mG0eEu14lhvUQNFX;

1.48
date	2016.11.04.11.35.20;	author sthen;	state Exp;
branches;
next	1.47;
commitid	Gg5LRcnQlqj5M3F7;

1.47
date	2016.10.08.20.38.39;	author jeremy;	state Exp;
branches;
next	1.46;
commitid	4EgK9DaQmrz9AvM5;

1.46
date	2016.03.20.17.59.21;	author naddy;	state Exp;
branches;
next	1.45;
commitid	DiLpGuORpWJnRdDH;

1.45
date	2015.12.10.08.49.31;	author landry;	state Exp;
branches;
next	1.44;
commitid	mOScsSAB0IaqauLo;

1.44
date	2015.10.30.12.59.17;	author sthen;	state Exp;
branches;
next	1.43;
commitid	vVZOehVa6DiEPxJL;

1.43
date	2015.07.26.01.31.39;	author jeremy;	state Exp;
branches;
next	1.42;
commitid	eLAwVRv9PoQSs8EB;

1.42
date	2015.07.19.02.10.31;	author jeremy;	state Exp;
branches;
next	1.41;
commitid	A33PdkIjYp6nCrLn;

1.41
date	2015.07.17.14.36.29;	author jeremy;	state Exp;
branches;
next	1.40;
commitid	CLEvHx8vYuVNRSMt;

1.40
date	2015.03.25.18.13.36;	author dcoppa;	state Exp;
branches;
next	1.39;
commitid	awEx0UCw6KRI08bC;

1.39
date	2015.01.08.21.24.57;	author jeremy;	state Exp;
branches;
next	1.38;
commitid	9zUg7afmGPlncpPw;

1.38
date	2015.01.02.19.32.21;	author robert;	state Exp;
branches;
next	1.37;
commitid	lZJl8zXP6QfZGKyb;

1.37
date	2014.12.31.08.42.27;	author landry;	state Exp;
branches;
next	1.36;
commitid	vf8MnqY339W3vwfX;

1.36
date	2014.10.11.19.54.47;	author jeremy;	state Exp;
branches;
next	1.35;
commitid	gOwEb2sD8zosipFk;

1.35
date	2014.10.08.02.32.43;	author jeremy;	state Exp;
branches;
next	1.34;
commitid	pcEBygN4WNdRlpmI;

1.34
date	2014.08.18.06.53.07;	author landry;	state Exp;
branches;
next	1.33;
commitid	CA4GHGXT8PXJt5Hy;

1.33
date	2014.06.24.21.43.02;	author jeremy;	state Exp;
branches;
next	1.32;
commitid	7wpvj72TnIOd2X3b;

1.32
date	2013.10.06.20.54.28;	author jeremy;	state Exp;
branches;
next	1.31;

1.31
date	2013.08.14.03.08.09;	author lteo;	state Exp;
branches;
next	1.30;

1.30
date	2013.07.09.12.23.40;	author jasper;	state Exp;
branches;
next	1.29;

1.29
date	2013.05.07.23.20.11;	author jeremy;	state Exp;
branches;
next	1.28;

1.28
date	2013.03.19.15.06.06;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2013.03.11.11.44.49;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2013.01.09.17.38.52;	author jeremy;	state Exp;
branches;
next	1.25;

1.25
date	2012.10.11.10.39.08;	author jeremy;	state Exp;
branches;
next	1.24;

1.24
date	2012.09.24.06.51.59;	author jasper;	state Exp;
branches;
next	1.23;

1.23
date	2012.09.23.16.57.35;	author jeremy;	state Exp;
branches;
next	1.22;

1.22
date	2012.01.18.16.52.06;	author jeremy;	state Exp;
branches;
next	1.21;

1.21
date	2011.12.13.18.38.17;	author jeremy;	state Exp;
branches;
next	1.20;

1.20
date	2011.09.16.12.00.09;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2011.07.19.18.00.51;	author jeremy;	state Exp;
branches;
next	1.18;

1.18
date	2011.07.18.19.06.37;	author naddy;	state Exp;
branches;
next	1.17;

1.17
date	2011.05.20.17.33.18;	author jeremy;	state Exp;
branches;
next	1.16;

1.16
date	2011.05.17.03.25.18;	author william;	state Exp;
branches;
next	1.15;

1.15
date	2011.01.15.01.09.43;	author naddy;	state Exp;
branches;
next	1.14;

1.14
date	2010.12.27.15.48.01;	author jasper;	state Exp;
branches;
next	1.13;

1.13
date	2010.11.24.21.35.16;	author jeremy;	state Exp;
branches;
next	1.12;

1.12
date	2010.11.22.08.36.54;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2010.11.18.14.16.47;	author jasper;	state Exp;
branches;
next	1.10;

1.10
date	2010.11.08.23.47.37;	author jeremy;	state Exp;
branches;
next	1.9;

1.9
date	2010.10.26.21.42.14;	author jeremy;	state Exp;
branches;
next	1.8;

1.8
date	2010.10.15.20.27.22;	author jeremy;	state Exp;
branches;
next	1.7;

1.7
date	2010.09.23.23.25.53;	author jeremy;	state Exp;
branches;
next	1.6;

1.6
date	2010.09.23.22.30.30;	author jeremy;	state Exp;
branches;
next	1.5;

1.5
date	2010.07.24.23.05.08;	author naddy;	state Exp;
branches;
next	1.4;

1.4
date	2010.06.21.03.56.02;	author william;	state Exp;
branches;
next	1.3;

1.3
date	2010.01.27.21.43.28;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2009.09.01.17.45.43;	author bernd;	state Exp;
branches;
next	1.1;

1.1
date	2009.08.20.20.36.12;	author bernd;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.08.20.20.36.12;	author bernd;	state Exp;
branches;
next	;


desc
@@


1.53
log
@bump LIBCXX/LIBECXX/COMPILER_LIBCXX ports.
@
text
@# $OpenBSD: Makefile,v 1.52 2017/07/16 19:19:04 espie Exp $

COMMENT =		ruby web application server/nginx module
BROKEN-alpha =		.got subsegment exceeds 64K (size 83312)
BROKEN-arm =		.../libuv/src/unix/atomic-ops.h:46: undefined reference to __sync_val_compare_and_swap_4
BROKEN-hppa =	rake fails when linking PassengerHelperAgent
BROKEN-sparc64 =	rake fails when linking PassengerHelperAgent

PASS_VERSION =		5.0.30
NGINX_VERSION =		1.10.2
DISTNAME =		passenger-${PASS_VERSION}
REVISION =		0

CATEGORIES =	www
DISTFILES =	${DISTNAME}.gem \
		nginx-${NGINX_VERSION}.tar.gz:0
MASTER_SITES0 =	http://nginx.org/download/

HOMEPAGE =	https://www.phusionpassenger.com/

# GPLv2
PERMIT_PACKAGE_CDROM = Yes

MODULES =		devel/gettext \
			lang/ruby

CONFIGURE_STYLE =	gem ext

WANTLIB =	${MODRUBY_WANTLIB} crypto curl kvm nghttp2 pcre pthread ssl ${COMPILER_LIBCXX} z

# Make devel/gmake a BUILD_DEPEND instead of USE_GMAKE, as the port also uses
# BSD make. Depend on gsed as embedded libuv picks it up if present.
BUILD_DEPENDS =		${RUN_DEPENDS} \
			devel/gmake \
			textproc/gsed
RUN_DEPENDS =		www/ruby-rack,${MODRUBY_FLAVOR}
LIB_DEPENDS =		${MODRUBY_LIB_DEPENDS} \
			devel/pcre \
			net/curl

CONFIGURE_ENV +=	CC=${CC} CXX=${CXX} \
			PASSENGER_DOWNLOAD_NATIVE_SUPPORT_BINARY=0

PASS_DIR =		${GEM_BASE_LIB}/gems/${DISTNAME}

SUBST_VARS =		MODRUBY_FLAVOR NGINX_VERSION PASS_VERSION

pre-configure:
	${SUBST_CMD} -DRUBY=${RUBY} \
		-DPASSENGER_ROOT='${PREFIX}/lib/phusion-passenger${GEM_MAN_SUFFIX}' \
		${WRKSRC}/src/nginx_module/config \
		${WRKSRC}/src/ruby_supportlib/phusion_passenger.rb \
		${WRKSRC}/src/ruby_supportlib/phusion_passenger/platform_info/compiler.rb
	${MODRUBY_RUBY_ADJ} ${WRKSRC}/bin/passenger* \
		${WRKSRC}/dev/*.rb \
		${WRKSRC}/src/helper-scripts/p* \
		${WRKSRC}/src/helper-scripts/*.rb

post-build:
	cd ${PASS_DIR} && ${RUBY} bin/passenger-config \
		install-standalone-runtime --auto \
		--nginx-version ${NGINX_VERSION} \
		--nginx-tarball ${FULLDISTDIR}/nginx-${NGINX_VERSION}.tar.gz
	cd ${PASS_DIR} && ${RUBY} bin/passenger-config build-native-support
	cd ${PASS_DIR} && ${RAKE} nginx:as_dynamic_module 
	rm -r ${PASS_DIR}/nginx-${NGINX_VERSION} \
		${PASS_DIR}/bin/passenger-install-*-module \
		${GEM_BASE_BIN}/passenger-install-*-module*
	mv ${PASS_DIR}/src/.passenger/support-binaries/${PASS_VERSION}/* \
		${PASS_DIR}/buildout/support-binaries/
	mv ${PASS_DIR}/buildout/ruby/openbsd/*.so ${PASS_DIR}/buildout/
	rm -r ${PASS_DIR}/buildout/ruby/
	find ${PASS_DIR} -name '*.beforesubst' -or -name '*.orig' | xargs rm

post-install:
	cd ${WRKINST}/${LOCALBASE}/${GEM_LIB}/gems/${DISTNAME}/man && \
		mv passenger-config.1 ${WRKINST}/${LOCALBASE}/man/man1/passenger-config${GEM_MAN_SUFFIX}.1 && \
		mv passenger-status.8 ${WRKINST}/${LOCALBASE}/man/man8/passenger-status${GEM_MAN_SUFFIX}.8 && \
		mv passenger-memory-stats.8 ${WRKINST}/${LOCALBASE}/man/man8/passenger-memory-stats${GEM_MAN_SUFFIX}.8
	rm -r ${WRKINST}/${LOCALBASE}/${GEM_LIB}/gems/${DISTNAME}/{man,src/apache2_module}
	${INSTALL_DATA_DIR} ${PREFIX}/share/nginx
	${INSTALL_DATA} ${FILESDIR}/nginx-passenger.conf.sample ${PREFIX}/share/nginx/nginx-passenger${GEM_MAN_SUFFIX}.conf.sample
	${SUBST_CMD} -DRUBY=${RUBY} \
		-DPASSENGER_ROOT=${TRUEPREFIX}/lib/phusion-passenger${GEM_MAN_SUFFIX} \
		${PREFIX}/share/nginx/nginx-passenger${GEM_MAN_SUFFIX}.conf.sample
	rm ${PREFIX}/share/nginx/nginx-passenger${GEM_MAN_SUFFIX}.conf.sample.*
	ln -s ${TRUEPREFIX}/${GEM_LIB}/gems/passenger-${PASS_VERSION} ${PREFIX}/lib/phusion-passenger${GEM_MAN_SUFFIX}

.include <bsd.port.mk>
@


1.52
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2017/04/10 11:46:35 sthen Exp $
d12 1
@


1.51
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2017/03/13 21:32:51 jca Exp $
d28 1
a28 1
WANTLIB =	${MODRUBY_WANTLIB} crypto curl kvm nghttp2 pcre pthread ssl ${LIBCXX} z
@


1.50
log
@Mark as BROKEN on arm, undefined reference to __sync_val_compare_and_swap_4

The __sync_val_compare_and_swap_4 reference comes from the internal
libuv copy.  Using lang/gcc doesn't seem to help.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2016/11/04 22:08:18 jeremy Exp $
d28 1
a28 1
WANTLIB =	${MODRUBY_WANTLIB} crypto curl kvm nghttp2 pcre pthread ssl stdc++ z
@


1.49
log
@Update to passenger 5.0.30

Update embedded nginx to 1.10.2.

Support nginx dynamic modules.

All files that were patched previously got moved, add patches for the
new locations.

Remove all of the pointless hiding of build steps behind progress bars.

OK robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2016/11/04 11:35:20 sthen Exp $
d5 1
@


1.48
log
@sync WANTLIB (and in one case, add gettext to LIB_DEPENDS) in dependent ports
now that internationalised domain name support has been removed from net/curl
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2016/10/08 20:38:39 jeremy Exp $
d8 2
a9 2
PASS_VERSION =		5.0.14
NGINX_VERSION =		1.9.3
a10 1
REVISION =		1
d49 3
a51 3
		${WRKSRC}/ext/nginx/config \
		${WRKSRC}/lib/phusion_passenger.rb \
		${WRKSRC}/lib/phusion_passenger/platform_info/compiler.rb
d54 2
a55 1
		${WRKSRC}/helper-scripts/p*
d63 1
a63 1
	cd ${PASS_DIR} && ${RAKE} nginx CACHING=false
d67 1
a67 1
	mv ${PASS_DIR}/.passenger/support-binaries/${PASS_VERSION}/* \
d69 2
a70 3
	mv ${PASS_DIR}/buildout/ruby/ruby-*/*.so ${PASS_DIR}/buildout
	rm -r ${PASS_DIR}/buildout/ruby ${PASS_DIR}/.passenger
	ln -s buildout ${PASS_DIR}/.passenger
d78 1
a78 1
	rm -r ${WRKINST}/${LOCALBASE}/${GEM_LIB}/gems/${DISTNAME}/man
@


1.47
log
@Add BDEP on gsed, since embedded libuv picks it up at runtime

problem noticed by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2016/03/20 17:59:21 naddy Exp $
d11 1
a11 1
REVISION =		0
d28 1
a28 1
WANTLIB =	${MODRUBY_WANTLIB} crypto curl idn kvm nghttp2 pcre pthread ssl stdc++ z
a36 1
			devel/libidn \
@


1.46
log
@remove SHARED_ONLY from some stragglers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2015/12/10 08:49:31 landry Exp $
d30 2
a31 2
# Make devel/gmake a BUILD_DEPEND instead of USE_GMAKE, as the port
# also uses BSD make.
d33 2
a34 1
			devel/gmake
@


1.45
log
@fails on sparc64 like on hppa: rake blows when linking PassengerHelperAgent
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2015/10/30 12:59:17 sthen Exp $
a24 2

SHARED_ONLY =	Yes
@


1.44
log
@sync WANTLIB (curl+nghttp2)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2015/07/26 01:31:39 jeremy Exp $
d6 1
@


1.43
log
@Update to passenger 5.0.14

Remove subpackages, revert to a single package, since standalone package
is now only 10% the size of the main package.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2015/07/19 02:10:31 jeremy Exp $
d10 1
d29 1
a29 1
WANTLIB =	${MODRUBY_WANTLIB} crypto curl idn kvm pcre pthread ssl stdc++ z
@


1.42
log
@Remove MODRUBY_RAKE_DEPENDS.  Only necessary on ruby 1.8, and none of
the ports that use it are still built with ruby 1.8.

OK ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2015/07/17 14:36:29 jeremy Exp $
d3 1
a3 2
COMMENT-main =		Nginx module for deploying ruby applications
COMMENT-standalone =	ruby web application server
d7 2
a8 2
PASS_VERSION =		4.0.44
NGINX_VERSION =		1.4.7
a9 5
REVISION =		4
FULLPKGNAME-main =	${MODRUBY_PKG_PREFIX}-${DISTNAME}
FULLPKGNAME-standalone = ${MODRUBY_PKG_PREFIX}-passenger-standalone-${PASS_VERSION}.${NGINX_VERSION}
FULLPKGPATH-main =	${BASE_PKGPATH},-main
FULLPKGPATH-standalone = ${BASE_PKGPATH},-standalone
d16 1
a16 1
HOMEPAGE =	http://www.modrails.com/
a20 3
MULTI_PACKAGES =	-main -standalone


d24 1
a24 10
FLAVORS =		ruby18 ruby19 ruby20 ruby21 ruby22
FLAVOR ?=		ruby22

# Fix conflict between subpackages when using ruby21/ruby22 FLAVORs
.if ${FLAVOR} == ruby21 || ${FLAVOR} == ruby22
PKG_ARGS-standalone =
.endif

SHARED_ONLY-main =	Yes
SHARED_ONLY-standalone =	Yes
d28 1
a28 3
WANTLIB-main =	c crypto curl ev idn m pcre pthread stdc++ ssl z \
		${MODRUBY_WANTLIB}
WANTLIB-standalone =	c crypto curl ev idn m pcre pthread ssl stdc++ z
d32 1
a32 1
BUILD_DEPENDS =		${RUN_DEPENDS-main} \
d34 2
a35 6
RUN_DEPENDS-main =	devel/ruby-daemon_controller,${MODRUBY_FLAVOR}>=1.2.0 \
			www/ruby-rack,${MODRUBY_FLAVOR}
LIB_DEPENDS-main =	${MODRUBY_LIB_DEPENDS} \
			${LIB_DEPENDS-standalone}
RUN_DEPENDS-standalone =${BUILD_PKGPATH}=${PASS_VERSION}
LIB_DEPENDS-standalone =devel/libev \
d40 2
a41 1
BUILD_ENV +=            CC=${CC} CXX=${CXX}
a49 3
		${WRKSRC}/build/common_library.rb \
		${WRKSRC}/bin/passenger-config \
		${WRKSRC}/build/packaging.rb \
a50 1
		${WRKSRC}/ext/common/ResourceLocator.h \
d52 1
a52 1
		${WRKSRC}/lib/phusion_passenger/platform_info/depcheck_specs/libs.rb
d58 2
a59 2
	cd ${PASS_DIR} && ${SETENV} ${MAKE_ENV} \
		${RUBY} bin/passenger package-runtime standalone \
d62 3
a64 8
	cd ${PASS_DIR} && ${SETENV} ${MAKE_ENV} ${RAKE} native_support
	cd ${PASS_DIR} && ${SETENV} ${MAKE_ENV} ${RAKE} nginx RELEASE=yes
	tar -zxf ${PASS_DIR}/standalone/${PASS_VERSION}/nginx-${NGINX_VERSION}-*-openbsd.tar.gz -C ${PASS_DIR}/standalone
	tar -zxf ${PASS_DIR}/standalone/${PASS_VERSION}/support-*-openbsd.tar.gz -C ${PASS_DIR}/standalone
	mv ${PASS_DIR}/buildout/ruby/ruby-*/passenger_native_support.so ${PASS_DIR}/lib/
	rm -r ${PASS_DIR}/standalone/{${PASS_VERSION},common,libeio} \
		${PASS_DIR}/{download_cache,nginx-${NGINX_VERSION},rpm,buildout/ruby} \
		${PASS_DIR}/ext/!(nginx|common) \
d67 6
@


1.41
log
@Make ruby22 the default FLAVOR
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2015/03/25 18:13:36 dcoppa Exp $
d11 1
a11 1
REVISION =		3
d54 1
a54 2
RUN_DEPENDS-main =	${MODRUBY_RAKE_DEPENDS} \
			devel/ruby-daemon_controller,${MODRUBY_FLAVOR}>=1.2.0 \
@


1.40
log
@
Remove obsolete/useless patch: our sigaltstack() implementation
does the right thing since we switched to rthreads, as confirmed
by miod@@

ok jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2015/01/08 21:24:57 jeremy Exp $
d34 1
a34 1
FLAVOR ?=		ruby21
@


1.39
log
@Support ruby22 FLAVOR for ruby-passenger

Add patch to make passenger not fail at runtime on ruby 2.2.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2015/01/02 19:32:21 robert Exp $
d11 1
a11 1
REVISION =		2
@


1.38
log
@fix compatibility with nginx 1.7.9; pulled from upstream git
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2014/12/31 08:42:27 landry Exp $
d11 1
a11 1
REVISION =		1
d33 1
a33 1
FLAVORS =		ruby18 ruby19 ruby20 ruby21
d36 2
a37 2
# Fix conflict between subpackages when using ruby21 FLAVOR
.if ${FLAVOR} == ruby21
@


1.37
log
@Yet another bunch of ports that reliably fail to build on hppa.

BROKEN-hppa =	SIGILL when running lilypond
BROKEN-hppa =	libjson-c.so.0.0: undefined reference to __sync_val_compare_and_swap_4
BROKEN-hppa=	missing atomic ops
BROKEN-hppa=	./iodev/hdimage/hdimage.cc:807: error: 'bx_bswap32' was not declared in this scope
BROKEN-hppa =	cc1plus: error: unrecognized command line option '-std=c++11'
BROKEN-hppa =	src/bin/jp2/convert.c:192: error: expected identifier or '(' before '__extension__'
BROKEN-hppa=	libpt.so.7.0: undefined reference to __sync_fetch_and_or_4
BROKEN-hppa=	ykpers-json.c:42: error: redefinition of typedef 'json_bool'
BROKEN-hppa=	OOM on src/lxml/lxml.etree.c
BROKEN-hppa =	undefined reference to `__sync_val_compare_and_swap_4' in libjson-c
BROKEN-hppa =	rake fails when linking PassengerHelperAgent
BROKEN-hppa =	kstars/kstars/tools/scriptbuilder.cpp:103: internal compiler error: Segmentation fault
BROKEN-hppa=	build stuck on virt-viewer-window.c

See http://build-failures.rhaalovely.net/hppa/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2014/10/11 19:54:47 jeremy Exp $
d11 1
a11 1
REVISION =		0
d38 1
a38 1
PKG_ARGS-standalone =	
@


1.36
log
@Bump gem ports buildable with ruby 1.8 that have binaries

The binaries now use a 18 suffix on ruby 1.8.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2014/10/08 02:32:43 jeremy Exp $
d6 1
@


1.35
log
@Use default ruby version for building ruby-passenger and nginx passenger
FLAVOR. No runtime effect for either, so no bump.

nginx part from zhuk@@, with minor tweak by me to fix CONFIGURE_ARGS
and BUILD_DEPENDS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2014/08/18 06:53:07 landry Exp $
d10 1
@


1.34
log
@BROKEN-alpha =         .got subsegment exceeds 64K (size 83312)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2014/06/24 21:43:02 jeremy Exp $
d32 1
a32 1
FLAVOR ?=		ruby20
@


1.33
log
@Update passenger to 4.0.44.  Update the nginx version used by
passenger standalone to 1.4.7.

Thanks to Frank Groeneveld for feedback and testing.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2013/10/06 20:54:28 jeremy Exp $
d5 1
@


1.32
log
@Restrict passenger to ruby18 and ruby19 (default) FLAVORs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2013/08/14 03:08:09 lteo Exp $
d6 2
a7 2
PASS_VERSION =		3.0.11
NGINX_VERSION =		1.2.3
a8 1
REVISION =		7
d30 7
a36 2
FLAVORS =		ruby18 ruby19
FLAVOR ?=		ruby19
d43 1
a43 1
WANTLIB-main =	c crypto curl ev idn m pthread  ssl stdc++ z \
d45 1
a45 1
WANTLIB-standalone =	c crypto curl ev idn m pthread ssl stdc++ z
d52 1
a52 2
			devel/ruby-fastthread,${MODRUBY_FLAVOR}>=1.0.1 \
			devel/ruby-daemon_controller,${MODRUBY_FLAVOR}>=0.2.5 \
d59 1
d66 1
a66 1
SUBST_VARS =		MODRUBY_FLAVOR
d69 2
a70 1
	${SUBST_CMD} -DPASSENGER_ROOT='${PREFIX}/lib/phusion-passenger${GEM_MAN_SUFFIX}' \
d74 1
d76 2
a77 1
		${WRKSRC}/lib/phusion_passenger.rb
d87 10
a96 8
	mkdir ${PASS_DIR}/standalone/support
	tar -zxf ${PASS_DIR}/standalone/runtime/nginx-${NGINX_VERSION}.tar.gz -C ${PASS_DIR}/standalone
	tar -zxf ${PASS_DIR}/standalone/runtime/support.tar.gz -C ${PASS_DIR}/standalone/support
	mv ${PASS_DIR}/standalone/sbin/nginx ${PASS_DIR}/standalone/
	cd ${PASS_DIR} && rm -rf standalone/{runtime,sbin}
	cd ${PASS_DIR}/ext/ruby && ${RUBY} extconf.rb && make && mv passenger_native_support.so ${PASS_DIR}/lib/
	cd ${PASS_DIR}/ext/nginx && ${RAKE} nginx RELEASE=yes
	cp -R ${PASS_DIR}/standalone/support/agents ${PASS_DIR}/
d103 1
a103 3
	rm -r ${WRKINST}/${LOCALBASE}/${GEM_LIB}/gems/${DISTNAME}/man \
		${GEM_ABS_PATH}/gems/${DISTNAME}/ext/ruby/ \
		${GEM_ABS_PATH}/gems/${DISTNAME}/standalone/support/ext/ruby/
@


1.31
log
@Fix passenger_root in the nginx sample config to point to the correct
directory.

OK gsoares@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2013/07/09 12:23:40 jasper Exp $
d30 3
@


1.30
log
@cleanup modules/wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2013/05/07 23:20:11 jeremy Exp $
d9 1
a9 1
REVISION =		6
d97 1
a97 1
		-DPASSENGER_ROOT=${TRUEPREFIX}/lib/phusion_passenger${GEM_MAN_SUFFIX} \
@


1.29
log
@Use libev from ports instead of embedded libev. Clean up WANTLIB and
DEPENDS.  Update nginx config file to reflect current user/paths.

libev issue discovered by naddy@@.

OK naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2013/03/19 15:06:06 ajacoutot Exp $
d9 1
a9 1
REVISION =		5
d28 2
a29 1
MODULES =		lang/ruby converters/libiconv
d36 3
a38 3
WANTLIB-main =	c crypto curl ev iconv idn intl m pthread  ssl stdc++ z \
		${MODRUBY_WANTLIB} 
WANTLIB-standalone =	c crypto curl ev iconv idn intl m pthread ssl stdc++ z
d55 1
a55 1
BUILD_ENV +=            CC=${CC} CXX=${CXX} 
@


1.28
log
@Fix @@sample file.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2013/03/11 11:44:49 espie Exp $
d9 1
a9 1
REVISION =		4
d28 1
a28 1
MODULES =		lang/ruby
d35 3
a37 1
WANTLIB-standalone =	c crypto m pthread stdc++ z ${MODRUBY_WANTLIB} 
a43 1
			net/curl \
d47 6
a52 2
LIB_DEPENDS-standalone =	${MODRUBY_LIB_DEPENDS}
RUN_DEPENDS-standalone =	${BUILD_PKGPATH}=${PASS_VERSION}
d62 1
@


1.27
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2013/01/09 17:38:52 jeremy Exp $
d9 1
a9 1
REVISION =		3
@


1.26
log
@Revision bump ruby C extension ports after addition of pthread to
WANTLIB.

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/10/11 10:39:08 jeremy Exp $
a23 3
PERMIT_PACKAGE_FTP = Yes
PERMIT_DISTFILES_CDROM = Yes
PERMIT_DISTFILES_FTP = Yes
@


1.25
log
@RUN_DEPENDS on curl, since it is used at runtime. Adjust shebangs
for ruby scripts, so they work correctly without setting up
symlinks manually.  Use nginx 1.2.3 for standalone version.

Heads up on curl issues from Peter Ljung via william@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/09/24 06:51:59 jasper Exp $
d9 1
a9 1
REVISION =		2
@


1.24
log
@- remove -lpthread vs. -pthread patches/chunks.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/09/23 16:57:35 jeremy Exp $
d7 1
a7 1
NGINX_VERSION =		1.0.11
d9 1
a9 1
REVISION =		1
a42 1
			net/curl \
d45 1
d64 3
@


1.23
log
@Bump revisions for ruby gem/extconf ports after the switch to ruby 1.9
by default, since the ruby 1.8 version now has a ruby18 explicit FLAVOR.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2012/01/18 16:52:06 jeremy Exp $
d9 1
a9 1
REVISION =		0
d14 1
@


1.22
log
@Upgrade the passenger standalone subpackage to nginx 1.0.11.

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2011/12/13 18:38:17 jeremy Exp $
d9 1
@


1.21
log
@Update to 3.0.11.  Support by the standalone version of passenger by
splitting into a multipackage, with a subpackage for the standalone
version (which embeds a version of nginx).  The standalone version
operates much like other ruby webservers, serving a single ruby/rack
application.

Switch to using the gem version of passenger.  Because the gem
installs into a versioned directory, setup symlinks to the
versioned directory so that nginx configuration files don't need
to be modified when the version is updated.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2011/09/16 12:00:09 espie Exp $
d7 1
a7 1
NGINX_VERSION =		1.0.10
@


1.20
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2011/07/19 18:00:51 jeremy Exp $
d3 2
a4 1
SHARED_ONLY =	Yes
d6 7
a12 5
COMMENT =	Nginx module for deploying Ruby applications

DISTNAME =	passenger-3.0.7
PKGNAME =	ruby-${DISTNAME}
REVISION =	3
d14 3
d26 2
a27 1
MASTER_SITES =		http://files.rubyforge.vm.bytemark.co.uk/passenger/
d31 2
a32 1
WANTLIB =		c crypto curl idn m pthread stdc++ ssl z ${MODRUBY_WANTLIB} 
d34 1
a34 1
LIB_DEPENDS =		${MODRUBY_LIB_DEPENDS}
d36 5
a40 3
BUILD_DEPENDS =		${RUN_DEPENDS}
RUN_DEPENDS =		devel/ruby-rake \
			devel/ruby-fastthread \
d42 9
a50 1
			www/ruby-rack
d52 1
a52 1
PORTHOME =		${WRKDIR}
d54 1
a54 1
MAKE_ENV +=		CC=${CC} CXX=${CXX}
d57 28
a84 19
	perl -pi -e "s#PASSENGER_ROOT =.*#PASSENGER_ROOT = '${PREFIX}/lib/phusion_passenger'#g" \
		${WRKSRC}/bin/passenger-config
	perl -pi -e "s#\\$$\\{LOCALBASE\\}#${LOCALBASE}#g" ${WRKSRC}/build/packaging.rb \
		${WRKSRC}/ext/common/ResourceLocator.h ${WRKSRC}/lib/phusion_passenger.rb

do-build:
	cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${RAKE} nginx
	cd ${WRKBUILD} && ${SETENV} ${MAKE_ENV} ${RAKE} fakeroot

do-install:
	find ${WRKBUILD}/pkg/fakeroot -name '*.orig' | xargs -r rm -f
	cd ${WRKBUILD}/pkg/fakeroot${LOCALBASE} && \
		tar -cf - * | tar -C ${PREFIX} -xf -
	rm -f ${PREFIX}/bin/passenger-install-nginx-module
	${INSTALL_DATA_DIR} ${PREFIX}/lib/phusion-passenger/ext
	cd ${WRKBUILD}/ext && tar -cf - common nginx | \
		tar -C ${PREFIX}/lib/phusion-passenger/ext -xf -
	find ${PREFIX}/lib/phusion-passenger/ext -name '*.orig' | \
		xargs -r rm -f
d86 6
a91 1
	${INSTALL_DATA} ${FILESDIR}/*.sample ${PREFIX}/share/nginx
@


1.19
log
@Bump after change to remove OpenBSD version from ruby SITEARCHDIR.

OK landry@@, jcs@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2011/07/18 19:06:37 naddy Exp $
d9 1
a9 1
REVISION =	2
@


1.18
log
@bump revision for plist changes 4.9 -> 5.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/05/20 17:33:18 jeremy Exp $
d9 1
a9 1
REVISION =	1
@


1.17
log
@Fix broken PLIST.  Update WANTLIB while here and bump REVISION.

OK william@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/05/17 03:25:18 william Exp $
d9 1
a9 1
REVISION =	0
@


1.16
log
@Update to passenger 3.0.7

Ignore EINVAL from sigaltstack, seems to be what ruby itself does in 1.9

committing on behalf of jeremy@@, who did all the work,
tested on i386 and tested packaging on amd64.  All so I can commit a
simple nginx update... THANKS.

ok jasper
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/01/15 01:09:43 naddy Exp $
d9 1
d24 1
a24 1
WANTLIB =		c m pthread stdc++ ${MODRUBY_WANTLIB}
@


1.15
log
@bump revision for plist changes 4.8 -> 4.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2010/12/27 15:48:01 jasper Exp $
d7 1
a7 1
DISTNAME =	passenger-3.0.0
a8 1
REVISION =	3
d37 6
d44 2
a45 5
	@@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${RAKE} nginx
	@@perl -pi -e "s#PASSENGER_ROOT =.*#PASSENGER_ROOT = '${PREFIX}/lib/phusion_passenger'#g" \
		${WRKSRC}/bin/passenger-config
	@@cd ${WRKBUILD} && ${SETENV} ${MAKE_ENV} ${RAKE} fakeroot
	@@find ${WRKBUILD}/pkg/fakeroot -name '*.orig' | xargs -r rm -f
d48 2
a49 1
	cd ${WRKBUILD}/pkg/fakeroot/usr/local && \
@


1.14
log
@- fix build on at least mips64el by syncing the endian definitions, tested
on both big and little endian machines.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2010/11/24 21:35:16 jeremy Exp $
d9 1
a9 1
REVISION =	2
@


1.13
log
@REVISION bump all ruby ports due to a change in the pkgspec.
Previously, we were using ruby->=1.8,<=1.9, instead of
ruby->=1.8,<1.9.  While this wouldn't cause an issue, since
our ruby-1.9.2 package isn't included in ruby->=1.8,<=1.9,
it's still wrong and should be fixed.  This also fixes the
following minor issues:

Switch from using FLAVOR to MODRUBY_FLAVOR for *_DEPENDS.
Currently we don't have a ruby port that uses FLAVORs that
would differ from MODRUBY_FLAVOR, but it's possible we will
in the future.

Switch from BASE_PKGPATH to BUILD_PKGPATH in a few cases in
REGRESS_DEPENDS.  This probably is not strictly necessary, but
BUILD_PKGPATH is used in more cases, so it is good for
consistency.

Switch to new style *_DEPENDS, with the version specification
at the end.  The remaining cases where this is not done is
because a specific version is used.

Some FULLPKGNAME added to REGRESS_DEPENDS, to make sure that if
the old version is installed when you run a regress test, it
will install the new version first.

Some conversion of spaces to tabs for consistency.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2010/11/22 08:36:54 espie Exp $
d9 1
a9 1
REVISION =	1
@


1.12
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2010/11/18 14:16:47 jasper Exp $
d9 1
a9 1
REVISION =	0
@


1.11
log
@- add missing dependency
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2010/11/08 23:47:37 jeremy Exp $
d29 4
a32 4
RUN_DEPENDS =		::devel/ruby-rake \
			::devel/ruby-fastthread \
			::net/curl \
			::www/ruby-rack
@


1.10
log
@Update ruby-passenger to 3.0.0.  Switch the directory name from
phusion_passenger to phusion-passenger, since that's the name used
by upstream. Also tested by Pierre-Yves Ritschard.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/10/26 21:42:14 jeremy Exp $
d9 1
d31 1
@


1.9
log
@Handle the rest of the fallout from the splitting of MODRUBY_LIB_DEPENDS
into MODRUBY_WANTLIB and using CONFIGURE_STYLE = ruby gem ext.  Use the
lang/ruby module for all dependent ports, setting
MODRUBY_{BUILD,RUN}DEP=No if necessary.

ok landry, phessler, sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/10/15 20:27:22 jeremy Exp $
d7 1
a7 1
DISTNAME =	passenger-2.2.5
a8 1
REVISION =	4
a45 2
	rm -f ${PREFIX}/bin/passenger-install-apache2-module
	rm -f ${PREFIX}/bin/passenger-make-enterprisey
d47 1
a47 1
	${INSTALL_DATA_DIR} ${PREFIX}/lib/phusion_passenger/ext
d49 2
a50 2
		tar -C ${PREFIX}/lib/phusion_passenger/ext -xf -
	find ${PREFIX}/lib/phusion_passenger/ext -name '*.orig' | \
@


1.8
log
@Remove MASTER_SITE_RUBYFORGE from network.conf.template.

It's only remaining user is www/ruby-passenger, so hardcode
it in that port's Makefile.

ok landry
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/09/23 23:25:53 jeremy Exp $
d24 1
a24 1
WANTLIB =		c m pthread stdc++
@


1.7
log
@Remove Bernd as maintainer of ruby-passenger

OK bernd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/09/23 22:30:30 jeremy Exp $
d20 1
a20 1
MASTER_SITES =		${MASTER_SITE_RUBYFORGE:=passenger/}
@


1.6
log
@Bump all ruby ports not already handled.

In the upgrade from ruby 1.8.6 to 1.8.7, the PLISTs changed
due to differences in how RDoc processes files.

This also has a number of changes to the regress tests to
work with the changes to devel/ruby-rake.  It moves most of
the regress tests to use MODRUBY_REGRESS.

OK jcs@@, landry@@, jasper@@, sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/07/24 23:05:08 naddy Exp $
d9 1
a9 1
REVISION =	3
a12 2

MAINTAINER =	Bernd Ahlers <bernd@@openbsd.org>
@


1.5
log
@bump PKGNAME for PLIST changes 4.7 -> 4.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/06/21 03:56:02 william Exp $
d9 1
a9 1
REVISION =	2
d40 1
a40 1
	@@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${LOCALBASE}/bin/rake nginx
d43 1
a43 1
	@@cd ${WRKBUILD} && ${SETENV} ${MAKE_ENV} ${LOCALBASE}/bin/rake fakeroot
@


1.4
log
@Fix build with nginx->=0.7.66
from upstream commit e973b93e8998edbbb4c6

ok bernd@@

found by naddy@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/01/27 21:43:28 naddy Exp $
d8 2
a9 1
PKGNAME =	ruby-${DISTNAME}p1
@


1.3
log
@bump PKGNAME for PLIST changes 4.6 -> 4.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2009/09/01 17:45:43 bernd Exp $
d8 1
a8 1
PKGNAME =	ruby-${DISTNAME}p0
@


1.2
log
@Update to ruby-passenger-2.2.5.

ChangeLog:
http://blog.phusion.nl/2009/09/01/phusion-passenger-2-2-5-released/

One patch went upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2009/08/20 20:36:12 bernd Exp $
d8 1
a8 1
PKGNAME =	ruby-${DISTNAME}
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d7 1
a7 1
DISTNAME =	passenger-2.2.4
@


1.1.1.1
log
@Initial import of ruby-passenger-2.2.4.

Phusion Passenger is an Nginx module, which makes deploying Ruby
and Ruby on Rails applications on Nginx a breeze. It follows the
usual Ruby on Rails conventions, such as "Don't-Repeat-Yourself"
and ease of setup, while at the same time providing enough
flexibility.

Tested by many.

With hints from Jeremy Evans and msf@@.   
@
text
@@
