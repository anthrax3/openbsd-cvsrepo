head	1.4;
access;
symbols
	OPENBSD_5_5:1.3.0.10
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.8
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.6
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2014.06.24.21.43.02;	author jeremy;	state dead;
branches;
next	1.3;
commitid	7wpvj72TnIOd2X3b;

1.3
date	2011.12.13.18.38.18;	author jeremy;	state Exp;
branches;
next	1.2;

1.2
date	2011.05.17.03.25.18;	author william;	state Exp;
branches;
next	1.1;

1.1
date	2010.11.08.23.47.37;	author jeremy;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update passenger to 4.0.44.  Update the nginx version used by
passenger standalone to 1.4.7.

Thanks to Frank Groeneveld for feedback and testing.
@
text
@$OpenBSD: patch-ext_common_AgentBase_cpp,v 1.3 2011/12/13 18:38:18 jeremy Exp $

Apparently there are issues using sigaltstack with pthreads.

--- ext/common/AgentBase.cpp.orig	Wed Dec 31 16:00:00 1969
+++ ext/common/AgentBase.cpp	Wed Nov 30 10:51:43 2011
@@@@ -320,10 +320,12 @@@@ installAbortHandler() {
 	stack.ss_flags = 0;
 	if (sigaltstack(&stack, NULL) != 0) {
 		int e = errno;
-		fprintf(stderr, "Cannot install an alternative stack for use in signal handlers: %s (%d)\n",
-			strerror(e), e);
-		fflush(stderr);
-		abort();
+		if (e != EINVAL) {
+			fprintf(stderr, "Cannot install an alternative stack for use in signal handlers: %s (%d)\n",
+				strerror(e), e);
+			fflush(stderr);
+			abort();
+		}
 	}
 	
 	struct sigaction action;
@


1.3
log
@Update to 3.0.11.  Support by the standalone version of passenger by
splitting into a multipackage, with a subpackage for the standalone
version (which embeds a version of nginx).  The standalone version
operates much like other ruby webservers, serving a single ruby/rack
application.

Switch to using the gem version of passenger.  Because the gem
installs into a versioned directory, setup symlinks to the
versioned directory so that nginx configuration files don't need
to be modified when the version is updated.
@
text
@d1 1
a1 1
$OpenBSD: patch-ext_common_AgentBase_cpp,v 1.2 2011/05/17 03:25:18 william Exp $
@


1.2
log
@Update to passenger 3.0.7

Ignore EINVAL from sigaltstack, seems to be what ruby itself does in 1.9

committing on behalf of jeremy@@, who did all the work,
tested on i386 and tested packaging on amd64.  All so I can commit a
simple nginx update... THANKS.

ok jasper
@
text
@d1 1
a1 1
$OpenBSD$
d5 3
a7 3
--- ext/common/AgentBase.cpp.orig	Wed Apr 27 12:51:06 2011
+++ ext/common/AgentBase.cpp	Wed Apr 27 12:51:20 2011
@@@@ -302,10 +302,12 @@@@ installAbortHandler() {
@


1.1
log
@Update ruby-passenger to 3.0.0.  Switch the directory name from
phusion_passenger to phusion-passenger, since that's the name used
by upstream. Also tested by Pierre-Yves Ritschard.

OK landry@@
@
text
@d2 22
a23 11
--- ext/common/AgentBase.cpp.orig	Wed Oct 27 15:44:19 2010
+++ ext/common/AgentBase.cpp	Wed Oct 27 15:44:34 2010
@@@@ -132,8 +132,6 @@@@ appendSignalReason(char *buf, siginfo_t *info) {
 	#endif
 	SI_CODE_HANDLER(SI_QUEUE);
 	SI_CODE_HANDLER(SI_TIMER);
-	SI_CODE_HANDLER(SI_ASYNCIO);
-	SI_CODE_HANDLER(SI_MESGQ);
 	#ifdef SI_SIGIO
 		SI_CODE_HANDLER(SI_SIGIO);
 	#endif
@

