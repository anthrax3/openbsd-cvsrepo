head	1.4;
access;
symbols
	OPENBSD_5_7:1.3.0.4
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.2
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.2.0.12
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.10
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.8
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.6
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.4
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2015.07.26.01.31.39;	author jeremy;	state dead;
branches;
next	1.3;
commitid	eLAwVRv9PoQSs8EB;

1.3
date	2014.06.24.21.43.02;	author jeremy;	state Exp;
branches;
next	1.2;
commitid	7wpvj72TnIOd2X3b;

1.2
date	2011.05.17.03.25.18;	author william;	state Exp;
branches;
next	1.1;

1.1
date	2010.11.08.23.47.37;	author jeremy;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to passenger 5.0.14

Remove subpackages, revert to a single package, since standalone package
is now only 10% the size of the main package.
@
text
@$OpenBSD: patch-build_packaging_rb,v 1.3 2014/06/24 21:43:02 jeremy Exp $
--- build/packaging.rb.orig	Thu May 29 05:13:24 2014
+++ build/packaging.rb	Thu Jun  5 10:47:23 2014
@@@@ -394,12 +394,12 @@@@ def change_shebang(filename, value)
 end
 
 desc "Create a fakeroot, useful for building native packages"
-task :fakeroot => [:apache2, :nginx, :doc] do
+task :fakeroot => [:nginx, :doc] do
 	require 'rbconfig'
 	require 'fileutils'
 	include RbConfig
 
-	fs_prefix  = ENV['FS_PREFIX']  || "/usr"
+	fs_prefix  = ENV['FS_PREFIX']  || "${LOCALBASE}"
 	fs_bindir  = ENV['FS_BINDIR']  || "#{fs_prefix}/bin"
 	fs_sbindir = ENV['FS_SBINDIR'] || "#{fs_prefix}/sbin"
 	fs_datadir = ENV['FS_DATADIR'] || "#{fs_prefix}/share"
@@@@ -527,10 +527,6 @@@@ task :fakeroot => [:apache2, :nginx, :doc] do
 		end
 	end
 	
-	# Apache 2 module
-	sh "mkdir -p #{File.dirname(fake_apache2_module_path)}"
-	sh "cp #{APACHE2_MODULE} #{fake_apache2_module_path}"
-
 	# Ruby extension sources
 	sh "mkdir -p #{fake_ruby_extension_source_dir}"
 	sh "cp -R #{PhusionPassenger.ruby_extension_source_dir}/* #{fake_ruby_extension_source_dir}"
@


1.3
log
@Update passenger to 4.0.44.  Update the nginx version used by
passenger standalone to 1.4.7.

Thanks to Frank Groeneveld for feedback and testing.
@
text
@d1 1
a1 1
$OpenBSD: patch-build_packaging_rb,v 1.2 2011/05/17 03:25:18 william Exp $
@


1.2
log
@Update to passenger 3.0.7

Ignore EINVAL from sigaltstack, seems to be what ruby itself does in 1.9

committing on behalf of jeremy@@, who did all the work,
tested on i386 and tested packaging on amd64.  All so I can commit a
simple nginx update... THANKS.

ok jasper
@
text
@d1 5
a5 5
$OpenBSD: patch-build_packaging_rb,v 1.1 2010/11/08 23:47:37 jeremy Exp $
--- build/packaging.rb.orig	Mon Apr 11 03:22:53 2011
+++ build/packaging.rb	Wed Apr 27 10:35:15 2011
@@@@ -100,7 +100,7 @@@@ Rake::Task['package:force'].prerequisites.unshift(:doc
 task :clobber => :'package:clean'
d8 2
a9 2
-task :fakeroot => [:apache2, :nginx] + Packaging::ASCII_DOCS do
+task :fakeroot => [:nginx] + Packaging::ASCII_DOCS do
d12 9
a20 23
 	include Config
@@@@ -109,14 +109,14 @@@@ task :fakeroot => [:apache2, :nginx] + Packaging::ASCI
 	# We don't use CONFIG['archdir'] and the like because we want
 	# the files to be installed to /usr, and the Ruby interpreter
 	# on the packaging machine might be in /usr/local.
-	fake_libdir = "#{fakeroot}/usr/lib/ruby/#{CONFIG['ruby_version']}"
-	fake_native_support_dir = "#{fakeroot}/usr/lib/ruby/#{CONFIG['ruby_version']}/#{CONFIG['arch']}"
+	fake_libdir = "#{fakeroot}${LOCALBASE}/lib/ruby/#{CONFIG['ruby_version']}"
+	fake_native_support_dir = "#{fakeroot}${LOCALBASE}/lib/ruby/#{CONFIG['ruby_version']}/#{CONFIG['arch']}"
 	fake_agents_dir = "#{fakeroot}#{NATIVELY_PACKAGED_AGENTS_DIR}"
 	fake_helper_scripts_dir = "#{fakeroot}#{NATIVELY_PACKAGED_HELPER_SCRIPTS_DIR}"
-	fake_resources_dir = "#{fakeroot}/usr/share/phusion-passenger"
+	fake_resources_dir = "#{fakeroot}${LOCALBASE}/share/phusion-passenger"
 	fake_docdir = "#{fakeroot}#{NATIVELY_PACKAGED_DOCDIR}"
-	fake_bindir = "#{fakeroot}/usr/bin"
-	fake_sbindir = "#{fakeroot}/usr/sbin"
+	fake_bindir = "#{fakeroot}${LOCALBASE}/bin"
+	fake_sbindir = "#{fakeroot}${LOCALBASE}/sbin"
 	fake_source_root = "#{fakeroot}#{NATIVELY_PACKAGED_SOURCE_ROOT}"
 	fake_apache2_module = "#{fakeroot}#{NATIVELY_PACKAGED_APACHE2_MODULE}"
 	fake_apache2_module_dir = File.dirname(fake_apache2_module)
@@@@ -160,8 +160,6 @@@@ task :fakeroot => [:apache2, :nginx] + Packaging::ASCI
 		sh "cp bin/#{exe} #{fake_sbindir}/"
d23 7
a29 5
-	sh "mkdir -p #{fake_apache2_module_dir}"
-	sh "cp #{APACHE2_MODULE} #{fake_apache2_module_dir}/"
 	
 	sh "mkdir -p #{fake_source_root}"
 	spec.files.each do |filename|
@


1.1
log
@Update ruby-passenger to 3.0.0.  Switch the directory name from
phusion_passenger to phusion-passenger, since that's the name used
by upstream. Also tested by Pierre-Yves Ritschard.

OK landry@@
@
text
@d1 4
a4 4
$OpenBSD$
--- build/packaging.rb.orig	Wed Oct 27 15:11:05 2010
+++ build/packaging.rb	Wed Oct 27 15:20:48 2010
@@@@ -83,7 +83,7 @@@@ Rake::Task['package:force'].prerequisites.unshift(:doc
d13 1
a13 1
@@@@ -92,17 +92,17 @@@@ task :fakeroot => [:apache2, :nginx] + Packaging::ASCI
d19 2
a20 2
+	fake_libdir = "#{fakeroot}/usr/local/lib/ruby/#{CONFIG['ruby_version']}"
+	fake_native_support_dir = "#{fakeroot}/usr/local/lib/ruby/#{CONFIG['ruby_version']}/#{CONFIG['arch']}"
d23 2
d28 2
a29 2
+	fake_bindir = "#{fakeroot}/usr/local/bin"
+	fake_sbindir = "#{fakeroot}/usr/local/sbin"
d33 1
a33 6
-	fake_certificates_dir = "#{fakeroot}/usr/share/phusion-passenger/certificates"
+	fake_certificates_dir = "#{fakeroot}/usr/local/share/phusion-passenger/certificates"
 	
 	sh "rm -rf #{fakeroot}"
 	sh "mkdir -p #{fakeroot}"
@@@@ -140,8 +140,6 @@@@ task :fakeroot => [:apache2, :nginx] + Packaging::ASCI
d40 2
a41 2
 	sh "mkdir -p #{fake_certificates_dir}"
 	sh "cp misc/*.crt #{fake_certificates_dir}/"
@

