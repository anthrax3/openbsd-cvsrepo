head	1.6;
access;
symbols
	OPENBSD_6_0:1.5.0.6
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.4
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.4.0.4
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.2
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.3.0.10
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.8
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.6
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2016.11.04.22.08.19;	author jeremy;	state dead;
branches;
next	1.5;
commitid	mG0eEu14lhvUQNFX;

1.5
date	2015.07.26.01.33.26;	author jeremy;	state Exp;
branches;
next	1.4;
commitid	XHDvbHl3gYXQ5RX5;

1.4
date	2014.06.24.21.45.06;	author jeremy;	state Exp;
branches;
next	1.3;
commitid	l38n2YOWdyClHIIT;

1.3
date	2011.12.13.18.38.18;	author jeremy;	state Exp;
branches;
next	1.2;

1.2
date	2011.05.17.03.25.18;	author william;	state Exp;
branches;
next	1.1;

1.1
date	2010.11.08.23.47.37;	author jeremy;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to passenger 5.0.30

Update embedded nginx to 1.10.2.

Support nginx dynamic modules.

All files that were patched previously got moved, add patches for the
new locations.

Remove all of the pointless hiding of build steps behind progress bars.

OK robert@@
@
text
@$OpenBSD: patch-lib_phusion_passenger_rb,v 1.5 2015/07/26 01:33:26 jeremy Exp $

Use the specified version of nginx.

Don't store or look for stuff in $HOME, use the passenger directory.

--- lib/phusion_passenger.rb.orig	Wed Jul 15 00:22:45 2015
+++ lib/phusion_passenger.rb	Sun Jul 19 00:50:45 2015
@@@@ -32,7 +32,7 @@@@ module PhusionPassenger
   # Run 'rake ext/common/Constants.h' after changing this number.
   VERSION_STRING = '5.0.14'
 
-  PREFERRED_NGINX_VERSION = '1.8.0'
+  PREFERRED_NGINX_VERSION = '${NGINX_VERSION}'
   NGINX_SHA256_CHECKSUM = '23cca1239990c818d8f6da118320c4979aadf5386deda691b1b7c2c96b9df3d5'
 
   PREFERRED_PCRE_VERSION  = '8.34'
@@@@ -322,13 +322,6 @@@@ private
   # example `sudo` preserves it. That's why we don't respect it by
   # default.
   def self.home_dir(respect_home_env = false)
-    if respect_home_env
-      home = ENV['HOME'].to_s
-    end
-    if home.nil? || home.empty?
-      require 'etc' if !defined?(Etc)
-      home = Etc.getpwuid(Process.uid).dir
-    end
-    return home
+    File.dirname(File.dirname(File.expand_path(__FILE__)))
   end
 end if !defined?(PhusionPassenger::VERSION_STRING)
@


1.5
log
@Update to passenger 5.0.14

Remove subpackages, revert to a single package, since standalone package
is now only 10% the size of the main package.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.4
log
@Update passenger to 4.0.44.  Update the nginx version used by
passenger standalone to 1.4.7.

Thanks to Frank Groeneveld for feedback and testing.
@
text
@d1 32
a32 13
$OpenBSD: patch-lib_phusion_passenger_rb,v 1.3 2011/12/13 18:38:18 jeremy Exp $
--- lib/phusion_passenger.rb.orig	Thu May 29 05:13:25 2014
+++ lib/phusion_passenger.rb	Thu Jun  5 10:47:23 2014
@@@@ -51,8 +51,7 @@@@ module PhusionPassenger
 	
 	# Directories in which to look for plugins.
 	PLUGIN_DIRS = [
-		"/usr/share/#{GLOBAL_NAMESPACE_DIRNAME}/plugins",
-		"/usr/local/share/#{GLOBAL_NAMESPACE_DIRNAME}/plugins",
+		"${PASSENGER_ROOT}/plugins",
 		"~/#{USER_NAMESPACE_DIRNAME}/plugins"
 	]
 	
@


1.3
log
@Update to 3.0.11.  Support by the standalone version of passenger by
splitting into a multipackage, with a subpackage for the standalone
version (which embeds a version of nginx).  The standalone version
operates much like other ruby webservers, serving a single ruby/rack
application.

Switch to using the gem version of passenger.  Because the gem
installs into a versioned directory, setup symlinks to the
versioned directory so that nginx configuration files don't need
to be modified when the version is updated.
@
text
@d1 4
a4 24
$OpenBSD: patch-lib_phusion_passenger_rb,v 1.2 2011/05/17 03:25:18 william Exp $
--- lib/phusion_passenger.rb.orig	Wed Dec 31 16:00:00 1969
+++ lib/phusion_passenger.rb	Thu Dec  1 08:15:40 2011
@@@@ -46,12 +46,12 @@@@ module PhusionPassenger
 		return @@natively_packaged
 	end
 	
-	NATIVELY_PACKAGED_SOURCE_ROOT        = "/usr/share/phusion-passenger/source"
-	NATIVELY_PACKAGED_DOCDIR             = "/usr/share/doc/phusion-passenger"
-	NATIVELY_PACKAGED_RESOURCES_DIR      = "/usr/share/phusion-passenger"
-	NATIVELY_PACKAGED_AGENTS_DIR         = "/usr/lib/phusion-passenger/agents"
-	NATIVELY_PACKAGED_HELPER_SCRIPTS_DIR = "/usr/share/phusion-passenger/helper-scripts"
-	NATIVELY_PACKAGED_APACHE2_MODULE     = "/usr/lib/apache2/modules/mod_passenger.so"
+	NATIVELY_PACKAGED_SOURCE_ROOT        = "${PASSENGER_ROOT}/source"
+	NATIVELY_PACKAGED_DOCDIR             = "${PASSENGER_ROOT}/doc"
+	NATIVELY_PACKAGED_RESOURCES_DIR      = "${PASSENGER_ROOT}/resources"
+	NATIVELY_PACKAGED_AGENTS_DIR         = "${PASSENGER_ROOT}/agents"
+	NATIVELY_PACKAGED_HELPER_SCRIPTS_DIR = "${PASSENGER_ROOT}/helper-scripts"
+	NATIVELY_PACKAGED_APACHE2_MODULE     = "${LOCALBASE}/lib/apache2/modules/mod_passenger.so"
 	
 	# Directory containing the Phusion Passenger Ruby libraries.
 	LIBDIR         = File.expand_path(File.dirname(__FILE__))
@@@@ -63,15 +63,14 @@@@ module PhusionPassenger
 	LOCAL_DIR      = ".passenger"
d7 6
a12 11
-	PLUGIN_DIRS    = ["/usr/share/phusion-passenger/plugins",
-		"/usr/local/share/phusion-passenger/plugins",
+	PLUGIN_DIRS    = ["${PASSENGER_ROOT}/plugins",
 		"~/#{LOCAL_DIR}/plugins"]
 	
 	# Directory under $HOME for storing Phusion Passenger Standalone resource files.
 	LOCAL_STANDALONE_RESOURCE_DIR  = File.join(LOCAL_DIR, "standalone")
 	
 	# System-wide directory for storing Phusion Passenger Standalone resource files.
-	GLOBAL_STANDALONE_RESOURCE_DIR = "/var/lib/passenger-standalone"
+	GLOBAL_STANDALONE_RESOURCE_DIR = "${PASSENGER_ROOT}/standalone/support/resources"
a13 2
 	if !natively_packaged?
 		# Top directory of the Phusion Passenger source code.
@


1.2
log
@Update to passenger 3.0.7

Ignore EINVAL from sigaltstack, seems to be what ruby itself does in 1.9

committing on behalf of jeremy@@, who did all the work,
tested on i386 and tested packaging on amd64.  All so I can commit a
simple nginx update... THANKS.

ok jasper
@
text
@d1 3
a3 3
$OpenBSD: patch-lib_phusion_passenger_rb,v 1.1 2010/11/08 23:47:37 jeremy Exp $
--- lib/phusion_passenger.rb.orig	Wed Apr 13 23:14:17 2011
+++ lib/phusion_passenger.rb	Wed Apr 27 10:44:18 2011
d14 5
a18 5
+	NATIVELY_PACKAGED_SOURCE_ROOT        = "${LOCALBASE}/share/phusion-passenger/source"
+	NATIVELY_PACKAGED_DOCDIR             = "${LOCALBASE}/share/doc/phusion-passenger"
+	NATIVELY_PACKAGED_RESOURCES_DIR      = "${LOCALBASE}/share/phusion-passenger"
+	NATIVELY_PACKAGED_AGENTS_DIR         = "${LOCALBASE}/lib/phusion-passenger/agents"
+	NATIVELY_PACKAGED_HELPER_SCRIPTS_DIR = "${LOCALBASE}/share/phusion-passenger/helper-scripts"
d23 1
a23 1
@@@@ -63,8 +63,8 @@@@ module PhusionPassenger
d29 1
a29 2
+	PLUGIN_DIRS    = [
+		"${LOCALBASE}/share/phusion-passenger/plugins",
d33 8
@


1.1
log
@Update ruby-passenger to 3.0.0.  Switch the directory name from
phusion_passenger to phusion-passenger, since that's the name used
by upstream. Also tested by Pierre-Yves Ritschard.

OK landry@@
@
text
@d1 4
a4 4
$OpenBSD$
--- lib/phusion_passenger.rb.orig	Wed Oct 27 15:14:30 2010
+++ lib/phusion_passenger.rb	Wed Oct 27 15:28:20 2010
@@@@ -46,10 +46,10 @@@@ module PhusionPassenger
d10 1
d13 7
a19 5
+	NATIVELY_PACKAGED_SOURCE_ROOT        = "/usr/local/share/phusion-passenger/source"
+	NATIVELY_PACKAGED_DOCDIR             = "/usr/local/share/doc/phusion-passenger"
+	NATIVELY_PACKAGED_AGENTS_DIR         = "/usr/local/lib/phusion-passenger/agents"
+	NATIVELY_PACKAGED_HELPER_SCRIPTS_DIR = "/usr/local/lib/phusion-passenger/bin"
 	NATIVELY_PACKAGED_APACHE2_MODULE     = "/usr/lib/apache2/modules/mod_passenger.so"
d22 2
a23 1
@@@@ -62,7 +62,7 @@@@ module PhusionPassenger
d28 1
d30 1
a30 1
 		"/usr/local/share/phusion-passenger/plugins",
d33 1
@

