head	1.2;
access;
symbols
	OPENBSD_6_0:1.2.0.10
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.6
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.8
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.4
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.2
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.1.0.20
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.18
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.16
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.14
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.12
	OPENBSD_5_0:1.1.0.10
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.8
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.6
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_6:1.1.0.4
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2014.04.25.16.35.42;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2010.02.09.13.44.28;	author sthen;	state Exp;
branches
	1.1.4.1;
next	;

1.1.4.1
date	2010.04.14.03.05.10;	author william;	state Exp;
branches;
next	;


desc
@@


1.2
log
@patch to fix incorrect use of the squid redirector protocol which will
have been broken for several squid releases
@
text
@$OpenBSD: patch-src_sgDiv_c_in,v 1.1 2010/02/09 13:44:28 sthen Exp $

First hunk:

squidGuard 1.4 patch 20091019; when constructing a redirect URL which
includes the requested URL, truncate it to make sure it's smaller than
squid's MAX_URL.

Second hunk: fix broken use of the old squid-2.5 helper protocol, see
http://bugs.squid-cache.org/show_bug.cgi?id=3978#c3

--- src/sgDiv.c.in.orig	Mon Jul 14 17:02:43 2008
+++ src/sgDiv.c.in	Fri Apr 25 17:25:31 2014
@@@@ -745,7 +745,7 @@@@ char *sgParseRedirect(redirect, req, acl, aclpass)
       p++;
       break;
     case 'u': /* Requested URL */
-      strcat(buf, req->orig);
+      strncat(buf, req->orig, 2048);
       p++;
       break;
     default:
@@@@ -782,7 +782,7 @@@@ void sgEmergency ()
   }
   sgLogError("Going into emergency mode");
   while(fgets(buf, MAX_BUF, stdin) != NULL){
-    puts("");
+    puts("ERR");
     fflush(stdout);
   }
   sgLogError("ending emergency mode, stdin empty");
@


1.1
log
@SECURITY fix, add patches from upstream to avoid a buffer overflow with
long URLs. Based on a diff from "iridium", similar diff from maintainer.
ok jasper@@
@
text
@d1 3
a3 1
$OpenBSD$
d9 3
d13 1
a13 1
+++ src/sgDiv.c.in	Wed Feb  3 12:26:15 2010
d23 9
@


1.1.4.1
log
@MFC:

SECURITY FIX

Resolves a buffer overflow with long URLs

ok MAINTAINER and jasper@@
@
text
@@

