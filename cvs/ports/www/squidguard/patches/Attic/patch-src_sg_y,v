head	1.2;
access;
symbols
	OPENBSD_4_5:1.1.1.1.0.8
	OPENBSD_4_5_BASE:1.1.1.1
	OPENBSD_4_4:1.1.1.1.0.6
	OPENBSD_4_4_BASE:1.1.1.1
	OPENBSD_4_3:1.1.1.1.0.4
	OPENBSD_4_3_BASE:1.1.1.1
	OPENBSD_4_2:1.1.1.1.0.2
	OPENBSD_4_2_BASE:1.1.1.1
	aanriot_20070602:1.1.1.1
	aanriot:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2009.04.09.23.53.13;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2007.06.02.15.26.54;	author aanriot;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.06.02.15.26.54;	author aanriot;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to 1.4, based on a diff from and ok with maintainer Claudio Correa.
@
text
@$OpenBSD: patch-src_sg_y,v 1.1 2007/06/02 15:26:54 aanriot Exp $
--- src/sg.y.orig	Wed Apr 11 02:57:02 2007
+++ src/sg.y	Fri Jun  1 20:07:12 2007
@@@@ -21,9 +21,12 @@@@
 #include "sg.h"
 
 #ifdef HAVE_LIBLDAP
-#include "lber.h"
-#include "ldap.h"
+#ifndef LDAP_DEPRECATED
+#define LDAP_DEPRECATED 1
 #endif
+#include <lber.h>
+#include <ldap.h>
+#endif
 
 #include "sgEx.h"
 
@@@@ -954,7 +957,7 @@@@ struct Source *sgFindSource (bsrc, net, ident, domain)
 	  founduser = 1;
 	  unblockeduser = 1;
 	  if(s->userquota.seconds != 0){
-            struct UserInfo uq;
+            // struct UserInfo uq;
 	    time_t t = time(NULL) + globalDebugTimeDelta;
 	    //sgLogError("status %d time %d lasttime %d consumed %d", userquota->status, userquota->time, userquota->last, userquota->consumed);
 	    //sgLogError("renew %d seconds %d", s->userquota.renew, s->userquota.seconds);
@@@@ -1940,11 +1943,14 @@@@ void sgTimeSetAcl()
   for(rew = Rewrite; rew != NULL; rew = rew->next){
     if(rew->time != NULL){
       rew->active = rew->time->active;
-      if(rew->within == OUTSIDE)
-	if(rew->active)
+      if(rew->within == OUTSIDE) {
+	if(rew->active) {
 	  rew->active = 0;
-	else
+	}
+	else  {
 	  rew->active = 1;
+	}
+      }
     }
   }
 }
@@@@ -2347,7 +2353,7 @@@@ char *sgAclAccess(src, acl, req)
 	}
       }
       if(aclpass->dest->regExp != NULL && access){
-	if((result = sgRegExpMatch(aclpass->dest->regExp,req->url)) != 0){
+	if((result = sgRegExpMatch(aclpass->dest->regExp,req->strippedurl)) != 0){
 	  if(aclpass->access){
 	    access++;
 	    break;
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@squidGuard is a combined filter, redirector and access controller plugin
for Squid. It can be used to limit the web access for some users, block
access to URLs, redirect trafic, etc.

from Claudio Correa <correa@@pucpcaldas.br>, thanks.
@
text
@@
