head	1.27;
access;
symbols
	OPENBSD_6_0:1.27.0.4
	OPENBSD_6_0_BASE:1.27
	OPENBSD_5_9:1.27.0.2
	OPENBSD_5_9_BASE:1.27
	OPENBSD_5_8:1.26.0.6
	OPENBSD_5_8_BASE:1.26
	OPENBSD_5_7:1.26.0.2
	OPENBSD_5_7_BASE:1.26
	OPENBSD_5_6:1.25.0.2
	OPENBSD_5_6_BASE:1.25
	OPENBSD_5_5:1.22.0.2
	OPENBSD_5_5_BASE:1.22
	OPENBSD_5_4:1.18.0.2
	OPENBSD_5_4_BASE:1.18
	OPENBSD_5_3:1.15.0.2
	OPENBSD_5_3_BASE:1.15
	OPENBSD_5_2:1.13.0.2
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.2
	OPENBSD_5_0:1.10.0.4
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.2
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.7.0.4
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.6.0.2
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.3.0.6
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.4
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.2
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.1.1.1.0.2
	OPENBSD_4_2_BASE:1.1.1.1
	aanriot_20070602:1.1.1.1
	aanriot:1.1.1;
locks; strict;
comment	@# @;


1.27
date	2015.09.10.13.31.25;	author sthen;	state Exp;
branches;
next	1.26;
commitid	FC7K2lJ3acruxEDB;

1.26
date	2014.09.13.18.09.22;	author brad;	state Exp;
branches;
next	1.25;
commitid	PpbRjVZdAmlrmi8q;

1.25
date	2014.05.15.17.27.39;	author sthen;	state Exp;
branches;
next	1.24;

1.24
date	2014.04.25.16.35.42;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2014.04.15.08.53.04;	author ajacoutot;	state Exp;
branches;
next	1.22;

1.22
date	2014.01.24.22.50.37;	author sthen;	state Exp;
branches;
next	1.21;

1.21
date	2013.11.30.15.41.40;	author sthen;	state Exp;
branches;
next	1.20;

1.20
date	2013.10.31.21.12.13;	author sthen;	state Exp;
branches;
next	1.19;

1.19
date	2013.08.12.20.01.49;	author jeremy;	state Exp;
branches;
next	1.18;

1.18
date	2013.06.12.20.36.34;	author brad;	state Exp;
branches;
next	1.17;

1.17
date	2013.05.25.00.33.10;	author brad;	state Exp;
branches;
next	1.16;

1.16
date	2013.03.11.11.44.49;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2013.02.09.14.49.53;	author sthen;	state Exp;
branches;
next	1.14;

1.14
date	2012.11.30.15.53.20;	author sthen;	state Exp;
branches;
next	1.13;

1.13
date	2012.04.28.10.51.44;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2011.09.16.12.00.09;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2011.09.12.18.02.35;	author naddy;	state Exp;
branches;
next	1.10;

1.10
date	2010.11.26.14.50.10;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2010.11.22.08.36.54;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2010.11.11.12.35.18;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2010.02.09.13.44.28;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2009.04.09.23.53.13;	author sthen;	state Exp;
branches
	1.6.2.1;
next	1.5;

1.5
date	2009.04.09.21.20.36;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2009.03.16.22.55.31;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2007.10.25.21.05.33;	author steven;	state Exp;
branches;
next	1.2;

1.2
date	2007.09.15.20.38.26;	author merdely;	state Exp;
branches;
next	1.1;

1.1
date	2007.06.02.15.26.54;	author aanriot;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.06.02.15.26.54;	author aanriot;	state Exp;
branches;
next	;

1.6.2.1
date	2010.04.14.03.05.10;	author william;	state Exp;
branches;
next	;


desc
@@


1.27
log
@switch squid dep from www/squid/stable to www/squid, reminded by aja@@
@
text
@# $OpenBSD: Makefile,v 1.26 2014/09/13 18:09:22 brad Exp $

COMMENT =		filter, redirector and access controller for Squid

DISTNAME =		squidGuard-1.4
REVISION =		14
CATEGORIES =		www

HOMEPAGE =		http://www.squidguard.org/
MAINTAINER =		Claudio Correa <correa@@pucpcaldas.br>

# GPLv2 only
PERMIT_PACKAGE_CDROM =	Yes

WANTLIB =		c lib/db4/db pthread

MASTER_SITES =		http://www.squidguard.org/Downloads/

LOCALSTATEDIR=		${BASELOCALSTATEDIR}/db/squidGuard
CONFIG_DIR =		${SYSCONFDIR}/squidguard
SUBST_VARS =		CONFIG_DIR

LIB_DEPENDS =		databases/db/v4
RUN_DEPENDS =		www/squid
BUILD_DEPENDS =		${RUN_DEPENDS}

CONFIGURE_ENV =		CFLAGS='${CFLAGS} -I${LOCALBASE}/include' \
			LDFLAGS='${LDFLAGS} -L${LOCALBASE}/lib' \
			ac_cv_path_LYNX=false
CONFIGURE_STYLE =	gnu
CONFIGURE_ARGS =	--with-squiduser='_squid' \
			--with-sg-logdir=/var/log/squidguard \
			--with-sg-dbhome=${LOCALSTATEDIR}/db \
			--with-sg-config=${CONFIG_DIR}/squidguard.conf \
			--with-db-lib=${LOCALBASE}/lib/db4 \
			--with-db-inc=${LOCALBASE}/include/db4

TEST_TARGET =	test

FLAVORS =	ldap mysql
FLAVOR ?=

.if ${FLAVOR:Mldap}
LIB_DEPENDS +=		databases/openldap
WANTLIB +=		ldap
CONFIGURE_ARGS +=	--with-ldap=yes
.else
CONFIGURE_ARGS +=	--with-ldap=no
.endif

.if ${FLAVOR:Mmysql}
LIB_DEPENDS +=		databases/mariadb
CONFIGURE_ARGS +=	--with-mysql=${LOCALBASE}
WANTLIB +=		mysqlclient z
.else
CONFIGURE_ARGS +=	--with-mysql=no
.endif

pre-configure:
	@@perl -pi -e "s,\@@prefix\@@\/squidGuard/squidGuard.conf,\@@cfgdir\@@\/squidguard/squidguard.conf," ${WRKSRC}/src/sg.h.in
	@@perl -pi -e "s,\@@prefix\@@\/squidGuard/log,\@@logdir\@@\/squidGuard," ${WRKSRC}/src/sg.h.in
	@@perl -pi -e "s,\@@prefix\@@\/squidGuard/db,\@@logdir\@@\/squidGuard/db," ${WRKSRC}/src/sg.h.in

do-install:
	${INSTALL_PROGRAM} ${WRKDIST}/src/squidGuard ${PREFIX}/bin

	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/squidguard \
	    ${PREFIX}/share/doc/squidguard/html
	${INSTALL_DATA} ${WRKDIST}/doc/README ${WRKDIST}/doc/*.txt \
	    ${PREFIX}/share/doc/squidguard/
	${INSTALL_DATA} ${WRKDIST}/doc/*.gif ${WRKDIST}/doc/*.html \
	    ${PREFIX}/share/doc/squidguard/html/

	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/squidguard
	@@rm ${WRKDIST}/samples/{Makefile,*.in}
	cp -R ${WRKDIST}/samples/* ${PREFIX}/share/examples/squidguard/
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share/examples/squidguard/
	chmod -R og+rX ${PREFIX}/share/examples/squidguard/

.include <bsd.port.mk>
@


1.26
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2014/05/15 17:27:39 sthen Exp $
d6 1
a6 1
REVISION =		13
d24 1
a24 1
RUN_DEPENDS =		www/squid/stable
@


1.25
log
@fix squidguard patch; from Matthias Pitzl
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2014/04/25 16:35:42 sthen Exp $
d6 1
a6 1
REVISION =		12
d52 1
a52 1
LIB_DEPENDS +=		databases/mysql
@


1.24
log
@patch to fix incorrect use of the squid redirector protocol which will
have been broken for several squid releases
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2014/04/15 08:53:04 ajacoutot Exp $
d6 1
a6 1
REVISION =		11
@


1.23
log
@No need to explicitely SUBST_VARS LOCALSTATEDIR anymore.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2014/01/24 22:50:37 sthen Exp $
d6 1
a6 1
REVISION =		10
@


1.22
log
@examples should be o+rX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2013/11/30 15:41:40 sthen Exp $
d21 1
a21 1
SUBST_VARS =		LOCALSTATEDIR CONFIG_DIR
@


1.21
log
@Fix RUN_DEPENDS following squid reorganisation; use a run dep of
www/squid/stable which is used if squid isn't already installed, but
this doesn't prevent using it with an already-installed squid/snapshot
package. Spotted by naddy (silent failure in bulk builds).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2013/10/31 21:12:13 sthen Exp $
d6 1
a6 1
REVISION =		9
d77 2
@


1.20
log
@bump REVISION for any ports using route messages. regen some distinfos and
remove unnecessary USE_GROFFs while there.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2013/08/12 20:01:49 jeremy Exp $
d6 1
a6 1
REVISION =		8
d24 1
a24 1
RUN_DEPENDS =		www/squid
@


1.19
log
@Fix segfault on 64-bit platforms due to undeclared pointer-returning
function.

OK MAINTAINER Claudio Correa
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2013/06/12 20:36:34 brad Exp $
d6 1
a6 1
REVISION =		7
@


1.18
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2013/05/25 00:33:10 brad Exp $
d6 1
a6 1
REVISION =		6
@


1.17
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2013/03/11 11:44:49 espie Exp $
d6 1
a6 1
REVISION =		5
d52 1
a52 1
LIB_DEPENDS +=		databases/mariadb
@


1.16
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2013/02/09 14:49:53 sthen Exp $
d6 1
a6 1
REVISION =		4
d52 1
a52 1
LIB_DEPENDS +=		databases/mysql
@


1.15
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2012/11/30 15:53:20 sthen Exp $
a13 3
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM =Yes
PERMIT_DISTFILES_FTP =	Yes
d38 1
a38 1
REGRESS_TARGET =	test
@


1.14
log
@bump; @@depend change due to squid update. spotted by naddy.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2012/04/28 10:51:44 ajacoutot Exp $
d46 1
a46 1
.if ${FLAVOR:L:Mldap}
d54 1
a54 1
.if ${FLAVOR:L:Mmysql}
@


1.13
log
@Use LOCALSTATEDIR.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/09/16 12:00:09 espie Exp $
d6 1
a6 1
REVISION =		3
@


1.12
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/09/12 18:02:35 naddy Exp $
d6 1
a6 1
REVISION =		2
d22 1
a22 1
SG_DIR =		/var/db/squidGuard
d24 1
a24 1
SUBST_VARS =		SG_DIR CONFIG_DIR
a32 1

a34 1
			--localstatedir=${SG_DIR} \
d36 1
a36 1
			--with-sg-dbhome=${SG_DIR}/db \
@


1.11
log
@bump all (sub)packages that depend on db/v4; requested by and help from espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2010/11/26 14:50:10 espie Exp $
d6 1
a6 1
REVISION =		1
@


1.10
log
@since db/v4 has db->=4,<5 as default, no need to specify it explicitly
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/11/22 08:36:54 espie Exp $
d6 1
a6 1
REVISION =		0
@


1.9
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/11/11 12:35:18 sthen Exp $
d26 1
a26 1
LIB_DEPENDS =		db->=4,<5:databases/db/v4
@


1.8
log
@new-style LIB_DEPENDS/REVISION/WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/02/09 13:44:28 sthen Exp $
d26 2
a27 2
LIB_DEPENDS =		:db->=4,<5:databases/db/v4
RUN_DEPENDS =		::www/squid
d49 1
a49 1
LIB_DEPENDS +=		:openldap-client-*:databases/openldap
d57 1
a57 1
LIB_DEPENDS +=		::databases/mysql
@


1.7
log
@SECURITY fix, add patches from upstream to avoid a buffer overflow with
long URLs. Based on a diff from "iridium", similar diff from maintainer.
ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2009/04/09 23:53:13 sthen Exp $
d6 1
a6 1
PKGNAME =		${DISTNAME}p0
d18 1
a18 1
WANTLIB =		c pthread
d26 1
a26 1
LIB_DEPENDS =		lib/db4/db.>=4:db->=4,<5:databases/db/v4
d49 2
a50 1
LIB_DEPENDS +=		ldap:openldap-client-*:databases/openldap
d57 1
a57 1
LIB_DEPENDS +=		mysqlclient::databases/mysql
d59 1
a59 1
WANTLIB +=		z
@


1.6
log
@update to 1.4, based on a diff from and ok with maintainer Claudio Correa.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2009/04/09 21:20:36 sthen Exp $
d6 1
@


1.6.2.1
log
@MFC:

SECURITY FIX

Resolves a buffer overflow with long URLs

ok MAINTAINER and jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2009/04/09 23:53:13 sthen Exp $
a5 1
PKGNAME =		${DISTNAME}p0
@


1.5
log
@add spaces before = in Makefile in preparation for forthcoming update to
make the diff clearer.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2009/03/16 22:55:31 sthen Exp $
d5 1
a5 2
DISTNAME =		squidGuard-1.2.1
PKGNAME =		${DISTNAME}p1
a8 1

d16 1
d21 1
a21 1
SG_DIR =		/var/squidguard
d23 1
a23 2
CONFIG_FILE =		${CONFIG_DIR}/squidguard.conf
SUBST_VARS =		SG_DIR CONFIG_DIR CONFIG_FILE
d34 1
a34 1
CONFIGURE_ARGS =	--squiduser='_squid' \
d36 1
a36 3
			--sysconfdir=${CONFIG_DIR} \
			--with-sg-config=${CONFIG_FILE} \
			--with-sg-logdir=${SG_DIR} \
d38 1
d42 4
a45 2
FLAVORS =	ldap
FLAVOR ?=        
d54 12
a65 3
post-configure:
	@@perl -pi -e "s,%%CONFIG_DIR%%,${CONFIG_DIR}," ${WRKSRC}/src/sg.h
	@@perl -pi -e "s,%%SG_DIR%%,${SG_DIR}," ${WRKSRC}/src/sg.h
d70 6
a75 3
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/squidguard
	@@rm ${WRKDIST}/doc/{Makefile,*.in}
	cp -R ${WRKDIST}/doc/* ${PREFIX}/share/doc/squidguard/
d78 1
a78 1
	@@rm ${WRKDIST}/samples/{Makefile,*.in,*.orig}
@


1.4
log
@db lib_depends, fix license marker, bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2007/10/25 21:05:33 steven Exp $
d3 1
a3 1
COMMENT=		filter, redirector and access controller for Squid
d5 3
a7 3
DISTNAME=		squidGuard-1.2.1
PKGNAME=		${DISTNAME}p1
CATEGORIES=		www
d9 1
a9 1
HOMEPAGE=		http://www.squidguard.org/
d11 1
a11 1
MAINTAINER=		Claudio Correa <correa@@pucpcaldas.br>
d14 16
a29 16
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
WANTLIB=		c pthread

MASTER_SITES=		http://www.squidguard.org/Downloads/

SG_DIR=			/var/squidguard
CONFIG_DIR=		${SYSCONFDIR}/squidguard
CONFIG_FILE=		${CONFIG_DIR}/squidguard.conf
SUBST_VARS=		SG_DIR CONFIG_DIR CONFIG_FILE

LIB_DEPENDS=		lib/db4/db.>=4:db->=4,<5:databases/db/v4
RUN_DEPENDS=		::www/squid
BUILD_DEPENDS=		${RUN_DEPENDS}
d31 1
a31 1
CONFIGURE_ENV=		CFLAGS='${CFLAGS} -I${LOCALBASE}/include' \
d35 2
a36 2
CONFIGURE_STYLE=	gnu
CONFIGURE_ARGS=		--squiduser='_squid' \
d45 2
a46 2
FLAVORS=	ldap
FLAVOR?=        
d49 2
a50 2
LIB_DEPENDS+=		ldap:openldap-client-*:databases/openldap
CONFIGURE_ARGS+=	--with-ldap=yes
d52 1
a52 1
CONFIGURE_ARGS+=	--with-ldap=no
@


1.3
log
@db.=4 -> db.>=4  in preparation of db4 update

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2007/09/15 20:38:26 merdely Exp $
d6 1
a6 1
PKGNAME=		${DISTNAME}p0
d13 1
a13 1
# GPL
d27 1
a27 1
LIB_DEPENDS=		lib/db4/db.>=4:db-4.*:databases/db/v4
@


1.2
log
@Remove surrounding quotes from
COMMENT-*/ERRORS/NO_REGRESS/PERMIT_*/REGRESS_IS_INTERACTIVE

Change '.include "bsd.port.mk"' to '.include <bsd.port.mk>' while here
(ok naddy@@)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2007/06/02 15:26:54 aanriot Exp $
d6 1
d27 1
a27 1
LIB_DEPENDS=		lib/db4/db.=4:db-4.*:databases/db/v4
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d3 1
a3 1
COMMENT=		"filter, redirector and access controller for Squid"
@


1.1.1.1
log
@squidGuard is a combined filter, redirector and access controller plugin
for Squid. It can be used to limit the web access for some users, block
access to URLs, redirect trafic, etc.

from Claudio Correa <correa@@pucpcaldas.br>, thanks.
@
text
@@
