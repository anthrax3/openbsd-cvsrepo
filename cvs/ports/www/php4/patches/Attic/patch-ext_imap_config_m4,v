head	1.6;
access;
symbols
	OPENBSD_3_1:1.4.0.2
	OPENBSD_3_1_BASE:1.4
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2002.06.24.19.17.50;	author avsm;	state dead;
branches;
next	1.5;

1.5
date	2002.06.16.15.47.29;	author avsm;	state Exp;
branches;
next	1.4;

1.4
date	2002.04.06.23.12.17;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2001.12.18.01.40.48;	author avsm;	state Exp;
branches;
next	1.2;

1.2
date	2001.11.19.01.50.34;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2001.10.04.21.27.44;	author avsm;	state Exp;
branches;
next	;


desc
@@


1.6
log
@delete the existing php4 port in preparation for the new, hopefully
improved one.
@
text
@$OpenBSD: patch-ext_imap_config_m4,v 1.5 2002/06/16 15:47:29 avsm Exp $
--- ext/imap/config.m4.orig	Tue Aug 21 12:02:42 2001
+++ ext/imap/config.m4	Sun Jun 16 16:11:15 2002
@@@@ -36,10 +36,13 @@@@ AC_DEFUN(PHP_IMAP_KRB_CHK, [
   if test "$PHP_KERBEROS" != "no"; then
     AC_DEFINE(HAVE_IMAP_KRB,1,[ ])
     PHP_ADD_LIBPATH($PHP_KERBEROS/lib, IMAP_SHARED_LIBADD)
-    PHP_ADD_LIBRARY(gssapi_krb5, 1, IMAP_SHARED_LIBADD)
+    PHP_ADD_LIBRARY(gssapi, 1, IMAP_SHARED_LIBADD)
+    PHP_ADD_LIBRARY(krb, 1, IMAP_SHARED_LIBADD)
     PHP_ADD_LIBRARY(krb5, 1, IMAP_SHARED_LIBADD)
-    PHP_ADD_LIBRARY(k5crypto, 1, IMAP_SHARED_LIBADD)
-    PHP_ADD_LIBRARY(com_err,  1, IMAP_SHARED_LIBADD)
+    PHP_ADD_LIBRARY(asn1, 1, IMAP_SHARED_LIBADD)
+    PHP_ADD_LIBRARY(com_err_pic,  1, IMAP_SHARED_LIBADD)
+    PHP_ADD_LIBRARY(kafs, 1, IMAP_SHARED_LIBADD)
+    PHP_ADD_LIBRARY(des, 1, IMAP_SHARED_LIBADD)
   else
     AC_EGREP_HEADER(auth_gss, $IMAP_INC_DIR/linkage.h, [
       AC_MSG_ERROR(This c-client library is build with Kerberos support. 
@@@@ -71,7 +74,7 @@@@ AC_DEFUN(PHP_IMAP_SSL_CHK, [
     old_LIBS=$LIBS
     LIBS="$LIBS -L$IMAP_LIBDIR -l$IMAP_LIB"
     if test $PHP_KERBEROS != "no"; then
-      LIBS="$LIBS -L$PHP_KERBEROS/lib -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err"
+      LIBS="$LIBS -L$PHP_KERBEROS/lib -lgssapi -lkrb -lkrb5 -lasn1 -lcom_err_pic -lkafs -ldes"
     fi
 
     AC_TRY_RUN([
@


1.5
log
@Upgrade to php-4.2.1

A few PEAR modules have disappeared completely during the PECL transition
so they are temporarily included here to avoid breaking dependencies
within the ports tree.
@
text
@d1 1
a1 1
$OpenBSD: patch-ext_imap_config_m4,v 1.4 2002/04/06 23:12:17 brad Exp $
@


1.4
log
@some more Kerberos libs to fix the imap FLAVOR on ELF systems.
@
text
@d1 4
a4 4
$OpenBSD: patch-ext_imap_config_m4,v 1.3 2001/12/18 01:40:48 avsm Exp $
--- ext/imap/config.m4.orig	Tue Aug  7 12:18:04 2001
+++ ext/imap/config.m4	Sat Apr  6 17:40:25 2002
@@@@ -36,10 +36,12 @@@@ AC_DEFUN(PHP_IMAP_KRB_CHK, [
d17 1
d21 1
a21 1
@@@@ -71,7 +73,7 @@@@ AC_DEFUN(PHP_IMAP_SSL_CHK, [
d26 1
a26 1
+      LIBS="$LIBS -L$PHP_KERBEROS/lib -lgssapi -lkrb -lkrb5 -lasn1 -lcom_err_pic -lkafs"
@


1.3
log
@Update to php4-4.1.0

Not much response to my post to ports@@ asking for testing, so there
will probably be some breakage in the more obscure flavors and
non-x86 arches.
@
text
@d1 4
a4 4
$OpenBSD$
--- ext/imap/config.m4.orig	Tue Aug  7 16:18:04 2001
+++ ext/imap/config.m4	Sat Nov 24 19:10:23 2001
@@@@ -36,10 +36,10 @@@@ AC_DEFUN(PHP_IMAP_KRB_CHK, [
d10 1
d16 1
d20 1
a20 1
@@@@ -71,7 +71,7 @@@@ AC_DEFUN(PHP_IMAP_SSL_CHK, [
d25 1
a25 1
+      LIBS="$LIBS -L$PHP_KERBEROS/lib -lgssapi -lkrb5 -lasn1 -lcom_err_pic"
@


1.2
log
@- bump NEED_VERSION
- add pkgspec for c-client
- rename checksums file
- link with libcom_err_pic vs. libcom_err
@
text
@d1 4
a4 19
$OpenBSD: patch-ext_imap_config_m4,v 1.1 2001/10/04 21:27:44 avsm Exp $
--- ext/imap/config.m4.orig	Mon May 21 20:38:46 2001
+++ ext/imap/config.m4	Sun Nov 18 17:12:56 2001
@@@@ -22,8 +22,12 @@@@ AC_DEFUN(IMAP_LIB_CHK,[
 ])
 
 AC_DEFUN(PHP_IMAP_KRB_CHK, [
-  PHP_ARG_WITH(kerberos,for Kerberos support in IMAP,
-  [  --with-kerberos[=DIR]     IMAP: Include Kerberos support.])
+  AC_ARG_WITH(kerberos,
+  [  --with-kerberos[=DIR]     IMAP: Include Kerberos support. DIR is the Kerberos install dir.],[
+    PHP_KERBEROS=$withval
+  ],[
+    PHP_KERBEROS=no
+  ])
 
   if test "$PHP_KERBEROS" = "yes"; then
     test -d /usr/kerberos && PHP_KERBEROS=/usr/kerberos
@@@@ -32,31 +36,44 @@@@ AC_DEFUN(PHP_IMAP_KRB_CHK, [
d15 4
a18 33
+  else
+    AC_EGREP_HEADER(auth_gss, $IMAP_INC_DIR/linkage.h, [
+      AC_MSG_ERROR(This c-client library is build with Kerberos support. 
+
+      Add --with-kerberos<=DIR> to your configure line. Check config.log for details.)
+    ])
   fi
+
 ])
 
 AC_DEFUN(PHP_IMAP_SSL_CHK, [
-  PHP_ARG_WITH(imap-ssl,for SSL support in IMAP,
-  [  --with-imap-ssl[=DIR]     IMAP: Include SSL support.])
+  AC_ARG_WITH(imap-ssl,
+  [  --with-imap-ssl[=DIR]     IMAP: Include SSL support. DIR is the OpenSSL install dir.],[
+    PHP_IMAP_SSL=$withval
+  ],[
+    PHP_IMAP_SSL=no
+  ])
 
   if test "$PHP_IMAP_SSL" = "yes"; then
     PHP_IMAP_SSL=/usr
   fi
 
   if test "$PHP_IMAP_SSL" != "no"; then
+    AC_DEFINE(HAVE_IMAP_SSL,1,[ ])
     PHP_ADD_LIBPATH($PHP_IMAP_SSL/lib, IMAP_SHARED_LIBADD)
-    PHP_ADD_LIBRARY_DEFER(crypto)
-    PHP_ADD_LIBRARY_DEFER(ssl)
-
+    PHP_ADD_LIBRARY_DEFER(ssl,, IMAP_SHARED_LIBADD)
+    PHP_ADD_LIBRARY_DEFER(crypto,, IMAP_SHARED_LIBADD)
+  else
d20 1
a20 2
-    LIBS="$LIBS -lc-client"
+    LIBS="$LIBS -L$IMAP_LIBDIR -l$IMAP_LIB"
d22 1
a22 1
-      LIBS="$LIBS -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err"
d25 1
a25 1
+
a26 65
       void mm_log(void){}
       void mm_dlog(void){}
@@@@ -73,15 +90,15 @@@@ AC_DEFUN(PHP_IMAP_SSL_CHK, [
       void mm_exists(void){}
       void mm_searched(void){}
       void mm_expunged(void){}
-      char ssl_onceonlyinit();
+      char mail_open();
       int main() {
-        ssl_onceonlyinit();
+        mail_open(0,"",0);
         return 0;
       }
-    ],[
-      AC_DEFINE(HAVE_IMAP_SSL,1,[ ])
-    ], [
-      AC_MSG_ERROR(This c-client library does not support SSL. Recompile or remove --with-imap-ssl from configure line.)
+    ],,[
+      AC_MSG_ERROR(This c-client library is build with SSL support. 
+      
+      Add --with-imap-ssl<=DIR> to your configure line. Check config.log for details.)
     ])
     LIBS=$old_LIBS
   fi
@@@@ -108,8 +125,21 @@@@ if test "$PHP_IMAP" != "no"; then  
       fi
     done
 
+    old_CPPFLAGS=$CPPFLAGS
+    CPPFLAGS=-I$IMAP_INC_DIR
+    AC_EGREP_CPP(this_is_true, [
+      #include "imap4r1.h"
+      #if defined(IMAPSSLPORT)
+      this_is_true
+      #endif
+    ],[
+      AC_DEFINE(HAVE_IMAP2001, 1, [ ])
+    ],[ ])
+    CPPFLAGS=$old_CPPFLAGS
+
     AC_CHECK_LIB(pam, pam_start) 
-    
+    AC_CHECK_LIB(crypt, crypt)
+	    
     PHP_EXPAND_PATH($IMAP_DIR, IMAP_DIR)
 
     if test -z "$IMAP_DIR"; then
@@@@ -122,7 +152,7 @@@@ if test "$PHP_IMAP" != "no"; then  
       ln -s "$IMAP_DIR/lib/c-client.a" "$IMAP_DIR/lib/libc-client.a" >/dev/null 2>&1
     fi
 
-    for lib in imap c-client4 c-client; do
+    for lib in c-client4 c-client imap; do
       IMAP_LIB=$lib
       IMAP_LIB_CHK(lib)
       IMAP_LIB_CHK(c-client)
@@@@ -134,7 +164,7 @@@@ if test "$PHP_IMAP" != "no"; then  
 
     PHP_ADD_INCLUDE($IMAP_INC_DIR)
     PHP_ADD_LIBPATH($IMAP_LIBDIR, IMAP_SHARED_LIBADD)
-    PHP_ADD_LIBRARY_DEFER($IMAP_LIB)
+    PHP_ADD_LIBRARY_DEFER($IMAP_LIB,, IMAP_SHARED_LIBADD)
     PHP_IMAP_KRB_CHK
     PHP_IMAP_SSL_CHK
 fi
@


1.1
log
@- fix imap flavor build, enable kerberos support as well
  (checked by heko, naddy)
- work with any LOCALBASE for most flavors (heko)
- turn off url_fopen by default for better security, most people
  never use it
- correctly detect the crypt function as part of libc,
  not a separate library
- unbreak curl, since 7.9 is now present in our tree
- more informative INSTALL script (naddy, heko)
@
text
@d1 3
a3 3
$OpenBSD$
--- ext/imap/config.m4.orig	Tue May 22 00:38:46 2001
+++ ext/imap/config.m4	Sun Sep 30 01:16:25 2001
d27 1
d29 1
a29 1
     PHP_ADD_LIBRARY(com_err,  1, IMAP_SHARED_LIBADD)
d68 1
a68 1
+      LIBS="$LIBS -L$PHP_KERBEROS/lib -lgssapi -lkrb5 -lcom_err -lasn1"
@

