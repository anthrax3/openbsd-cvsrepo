head	1.11;
access;
symbols
	OPENBSD_3_0:1.6.0.2
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9:1.4.0.2
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_8:1.1.0.2
	OPENBSD_2_8_BASE:1.1;
locks; strict;
comment	@# @;


1.11
date	2002.04.06.23.12.17;	author brad;	state dead;
branches;
next	1.10;

1.10
date	2002.03.03.12.13.29;	author avsm;	state Exp;
branches;
next	1.9;

1.9
date	2002.01.09.16.00.51;	author jcs;	state Exp;
branches;
next	1.8;

1.8
date	2001.12.18.01.40.48;	author avsm;	state Exp;
branches;
next	1.7;

1.7
date	2001.11.19.01.50.34;	author brad;	state Exp;
branches;
next	1.6;

1.6
date	2001.10.04.21.27.44;	author avsm;	state Exp;
branches
	1.6.2.1;
next	1.5;

1.5
date	2001.05.10.22.58.34;	author avsm;	state dead;
branches;
next	1.4;

1.4
date	2001.01.07.21.08.11;	author avsm;	state Exp;
branches;
next	1.3;

1.3
date	2000.12.28.17.53.17;	author avsm;	state Exp;
branches;
next	1.2;

1.2
date	2000.12.26.23.35.43;	author avsm;	state dead;
branches;
next	1.1;

1.1
date	2000.09.04.21.14.47;	author jakob;	state Exp;
branches;
next	;

1.6.2.1
date	2002.01.16.23.52.07;	author brad;	state Exp;
branches;
next	;


desc
@@


1.11
log
@some more Kerberos libs to fix the imap FLAVOR on ELF systems.
@
text
@$OpenBSD: patch-configure,v 1.10 2002/03/03 12:13:29 avsm Exp $
--- configure.orig	Wed Feb 27 09:18:32 2002
+++ configure	Sun Mar  3 11:22:25 2002
@@@@ -4644,7 +4644,7 @@@@ if test "${with_thttpd+set}" = set; then
   
   if test -n "$GCC"; then
         
-  gcc_arg_name=ac_cv_gcc_arg_rdynamc
+  gcc_arg_name=ac_cv_gcc_arg_rdynamic
   echo $ac_n "checking whether $CC supports -rdynamic""... $ac_c" 1>&6
 echo "configure:4650: checking whether $CC supports -rdynamic" >&5
 if eval "test \"`echo '$''{'ac_cv_gcc_arg_rdynamic'+set}'`\" = set"; then
@@@@ -24916,22 +24916,22 @@@@ EOF
   fi
 
     
- case gssapi_krb5 in
+ case gssapi in
  c|c_r|pthread*) ;;
  *)
 
    if test "$ext_shared" = "yes"; then
      
-  IMAP_SHARED_LIBADD="$IMAP_SHARED_LIBADD -lgssapi_krb5"
+  IMAP_SHARED_LIBADD="$IMAP_SHARED_LIBADD -lgssapi"
 
    else
      
- case gssapi_krb5 in
+ case gssapi in
  c|c_r|pthread*) ;;
  *)
 
    
-  LIBS="$LIBS -lgssapi_krb5"
+  LIBS="$LIBS -lgssapi"
 
 
   ;;
@@@@ -24970,22 +24970,22 @@@@ EOF
   esac
 
     
- case k5crypto in
+ case asn1 in
  c|c_r|pthread*) ;;
  *)
 
    if test "$ext_shared" = "yes"; then
      
-  IMAP_SHARED_LIBADD="$IMAP_SHARED_LIBADD -lk5crypto"
+  IMAP_SHARED_LIBADD="$IMAP_SHARED_LIBADD -lasn1"
 
    else
      
- case k5crypto in
+ case asn1 in
  c|c_r|pthread*) ;;
  *)
 
    
-  LIBS="$LIBS -lk5crypto"
+  LIBS="$LIBS -lasn1"
 
 
   ;;
@@@@ -24997,22 +24997,22 @@@@ EOF
   esac
 
     
- case com_err in
+ case com_err_pic in
  c|c_r|pthread*) ;;
  *)
 
    if test "$ext_shared" = "yes"; then
      
-  IMAP_SHARED_LIBADD="$IMAP_SHARED_LIBADD -lcom_err"
+  IMAP_SHARED_LIBADD="$IMAP_SHARED_LIBADD -lcom_err_pic"
 
    else
      
- case com_err in
+ case com_err_pic in
  c|c_r|pthread*) ;;
  *)
 
    
-  LIBS="$LIBS -lcom_err"
+  LIBS="$LIBS -lcom_err_pic"
 
 
   ;;
@@@@ -25157,7 +25157,7 @@@@ EOF
     old_LIBS=$LIBS
     LIBS="$LIBS -L$IMAP_LIBDIR -l$IMAP_LIB"
     if test $PHP_KERBEROS != "no"; then
-      LIBS="$LIBS -L$PHP_KERBEROS/lib -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err"
+      LIBS="$LIBS -L$PHP_KERBEROS/lib -lgssapi -lkrb5 -lasn1 -lcom_err_pic"
     fi
 
     if test "$cross_compiling" = yes; then
@@@@ -57561,7 +57561,7 @@@@ unset with_pic
 
 case $php_build_target in
 program|static)
-    standard_libtool_flag='-prefer-non-pic -static'
+    standard_libtool_flag='-static'
     if test "$lib_build_shared" != "yes"; then
         enable_shared=no
     fi
@@@@ -57570,7 +57570,7 @@@@ program|static)
 ;;
 shared)
     enable_static=no
-    standard_libtool_flag=-prefer-pic
+    standard_libtool_flag=
     EXTRA_LDFLAGS="$EXTRA_LDFLAGS -avoid-version"
 ;;
 esac
@


1.10
log
@upgrade to php-4.1.2

closes a security issue in multipart form handling (buffer overflow)

temporarily disable the freetds flavour, since the m4 patch cannot
seem to be regenerated
@
text
@d1 1
a1 1
$OpenBSD$
@


1.9
log
@Add "freetds" flavor
ok avsm@@
@
text
@d1 13
a13 3
--- configure.orig	Wed Dec 26 04:43:05 2001
+++ configure	Fri Dec 28 11:47:29 2001
@@@@ -24893,22 +24893,22 @@@@ EOF
d40 1
a40 1
@@@@ -24947,22 +24947,22 @@@@ EOF
d67 1
a67 1
@@@@ -24974,22 +24974,22 @@@@ EOF
d94 1
a94 1
@@@@ -25134,7 +25134,7 @@@@ EOF
d103 1
a103 337
@@@@ -52283,33 +52283,6 @@@@ EOF
   fi
 
   
- case cs in
- c|c_r|pthread*) ;;
- *)
-
-   if test "$ext_shared" = "yes"; then
-     
-  SYBASE_CT_SHARED_LIBADD="-lcs $SYBASE_CT_SHARED_LIBADD"
-
-   else
-     
- case cs in
- c|c_r|pthread*) ;;
- *)
-
-   
-  LIBS="-lcs $LIBS"
-
-
-  ;;
-  esac
-
-   fi
-
-  ;;
-  esac
-
-  
  case ct in
  c|c_r|pthread*) ;;
  *)
@@@@ -52337,214 +52310,22 @@@@ EOF
   esac
 
   
- case comn in
- c|c_r|pthread*) ;;
- *)
-
-   if test "$ext_shared" = "yes"; then
-     
-  SYBASE_CT_SHARED_LIBADD="-lcomn $SYBASE_CT_SHARED_LIBADD"
-
-   else
-     
- case comn in
- c|c_r|pthread*) ;;
- *)
-
-   
-  LIBS="-lcomn $LIBS"
-
-
-  ;;
-  esac
-
-   fi
-
-  ;;
-  esac
-
-  
- case intl in
- c|c_r|pthread*) ;;
- *)
-
-   if test "$ext_shared" = "yes"; then
-     
-  SYBASE_CT_SHARED_LIBADD="-lintl $SYBASE_CT_SHARED_LIBADD"
-
-   else
-     
- case intl in
- c|c_r|pthread*) ;;
- *)
-
-   
-  LIBS="-lintl $LIBS"
-
-
-  ;;
-  esac
-
-   fi
-
-  ;;
-  esac
-
-
-  SYBASE_CT_LIBS="-L$SYBASE_CT_LIBDIR -lcs -lct -lcomn -lintl"
-
-  echo $ac_n "checking for netg_errstr in -ltcl""... $ac_c" 1>&6
-echo "configure:52398: checking for netg_errstr in -ltcl" >&5
-ac_lib_var=`echo tcl'_'netg_errstr | sed 'y%./+-%__p_%'`
-if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  ac_save_LIBS="$LIBS"
-LIBS="-ltcl  
-    $SYBASE_CT_LIBS 
-   $LIBS"
-cat > conftest.$ac_ext <<EOF
-#line 52408 "configure"
-#include "confdefs.h"
-/* Override any gcc2 internal prototype to avoid an error.  */
-/* We use char because int might match the return type of a gcc2
-    builtin and then its argument prototype would still apply.  */
-char netg_errstr();
-
-int main() {
-netg_errstr()
-; return 0; }
-EOF
-if { (eval echo configure:52419: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=yes"
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=no"
-fi
-rm -f conftest*
-LIBS="$ac_save_LIBS"
-
-fi
-if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
-  echo "$ac_t""yes" 1>&6
-  
-    
- case tcl in
- c|c_r|pthread*) ;;
- *)
-
-   if test "$ext_shared" = "yes"; then
-     
-  SYBASE_CT_SHARED_LIBADD="-ltcl $SYBASE_CT_SHARED_LIBADD"
-
-   else
-     
- case tcl in
- c|c_r|pthread*) ;;
- *)
-
-   
-  LIBS="-ltcl $LIBS"
-
-
-  ;;
-  esac
-
-   fi
-
-  ;;
-  esac
-
-  
-else
-  echo "$ac_t""no" 1>&6
- 
-    
- case sybtcl in
- c|c_r|pthread*) ;;
- *)
-
-   if test "$ext_shared" = "yes"; then
-     
-  SYBASE_CT_SHARED_LIBADD="-lsybtcl $SYBASE_CT_SHARED_LIBADD"
-
-   else
-     
- case sybtcl in
- c|c_r|pthread*) ;;
- *)
-
-   
-  LIBS="-lsybtcl $LIBS"
-
-
-  ;;
-  esac
-
-   fi
-
-  ;;
-  esac
-
-  
-fi
-
-
-  echo $ac_n "checking for insck__getVdate in -linsck""... $ac_c" 1>&6
-echo "configure:52498: checking for insck__getVdate in -linsck" >&5
-ac_lib_var=`echo insck'_'insck__getVdate | sed 'y%./+-%__p_%'`
-if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  ac_save_LIBS="$LIBS"
-LIBS="-linsck -L$SYBASE_CT_LIBDIR $LIBS"
-cat > conftest.$ac_ext <<EOF
-#line 52506 "configure"
-#include "confdefs.h"
-/* Override any gcc2 internal prototype to avoid an error.  */
-/* We use char because int might match the return type of a gcc2
-    builtin and then its argument prototype would still apply.  */
-char insck__getVdate();
-
-int main() {
-insck__getVdate()
-; return 0; }
-EOF
-if { (eval echo configure:52517: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=yes"
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=no"
-fi
-rm -f conftest*
-LIBS="$ac_save_LIBS"
-
-fi
-if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
-  echo "$ac_t""yes" 1>&6
-  
- case insck in
+ case tds in
  c|c_r|pthread*) ;;
  *)
 
    if test "$ext_shared" = "yes"; then
      
-  SYBASE_CT_SHARED_LIBADD="-linsck $SYBASE_CT_SHARED_LIBADD"
+  SYBASE_CT_SHARED_LIBADD="-ltds $SYBASE_CT_SHARED_LIBADD"
 
    else
      
- case insck in
+ case tds in
  c|c_r|pthread*) ;;
  *)
 
    
-  LIBS="-linsck $LIBS"
+  LIBS="-ltds $LIBS"
 
 
   ;;
@@@@ -52555,81 +52336,10 @@@@ if eval "test \"`echo '$ac_cv_lib_'$ac_l
   ;;
   esac
 
-else
-  echo "$ac_t""no" 1>&6
-fi
-
-  echo $ac_n "checking for bsd_tcp in -linsck""... $ac_c" 1>&6
-echo "configure:52564: checking for bsd_tcp in -linsck" >&5
-ac_lib_var=`echo insck'_'bsd_tcp | sed 'y%./+-%__p_%'`
-if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  ac_save_LIBS="$LIBS"
-LIBS="-linsck -L$SYBASE_CT_LIBDIR $LIBS"
-cat > conftest.$ac_ext <<EOF
-#line 52572 "configure"
-#include "confdefs.h"
-/* Override any gcc2 internal prototype to avoid an error.  */
-/* We use char because int might match the return type of a gcc2
-    builtin and then its argument prototype would still apply.  */
-char bsd_tcp();
-
-int main() {
-bsd_tcp()
-; return 0; }
-EOF
-if { (eval echo configure:52583: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=yes"
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=no"
-fi
-rm -f conftest*
-LIBS="$ac_save_LIBS"
-
-fi
-if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
-  echo "$ac_t""yes" 1>&6
   
- case insck in
- c|c_r|pthread*) ;;
- *)
-
-   if test "$ext_shared" = "yes"; then
-     
-  SYBASE_CT_SHARED_LIBADD="-linsck $SYBASE_CT_SHARED_LIBADD"
-
-   else
-     
- case insck in
- c|c_r|pthread*) ;;
- *)
-
-   
-  LIBS="-linsck $LIBS"
-
-
-  ;;
-  esac
-
-   fi
-
-  ;;
-  esac
-
-else
-  echo "$ac_t""no" 1>&6
+  SYBASE_CT_LIBS="-L$SYBASE_CT_LIBDIR -lct -ltds"
 fi
 
-fi
-
-
-
-
 echo $ac_n "checking whether to enable System V semaphore support""... $ac_c" 1>&6
 echo "configure:52635: checking whether to enable System V semaphore support" >&5
 # Check whether --enable-sysvsem or --disable-sysvsem was given.
@@@@ -57538,7 +57248,7 @@@@ unset with_pic
d112 1
a112 1
@@@@ -57547,7 +57257,7 @@@@ program|static)
a120 83
@@@@ -60620,7 +60330,14 @@@@ old_postuninstall_cmds=
 
 if test -n "$RANLIB"; then
   old_archive_cmds="$old_archive_cmds~\$RANLIB \$oldlib"
-  old_postinstall_cmds="\$RANLIB \$oldlib~$old_postinstall_cmds"
+  case "$host_os" in
+  openbsd*)
+    old_postinstall_cmds="\$RANLIB -t \$oldlib~$old_postinstall_cmds"
+  ;;
+  *)
+    old_postinstall_cmds="\$RANLIB \$oldlib~$old_postinstall_cmds"
+  ;;
+  esac
 fi
 
 # Allow CC to be a program name with arguments.
@@@@ -61117,7 +60834,9 @@@@ cygwin* | mingw* | pw32* )
     with_gnu_ld=no
   fi
   ;;
-
+openbsd*)
+  with_gnu_ld=no
+  ;;
 esac
 
 ld_shlibs=yes
@@@@ -61521,10 +61240,24 @@@@ else
     ;;
 
   openbsd*)
-    archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
-    hardcode_libdir_flag_spec='-R$libdir'
     hardcode_direct=yes
     hardcode_shlibpath_var=no
+    if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+      archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $linkopts'
+      hardcode_libdir_flag_spec='${wl}-R$libdir'
+      export_dynamic_flag_spec='${wl}-E'
+    else
+      case "$host_os" in
+      openbsd01.* | openbsd2.0-7 | openbsd2.0-7.*)
+       archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linkopts'
+       hardcode_libdir_flag_spec='-R$libdir'
+       ;;
+      *)
+       archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $linkopts'
+       hardcode_libdir_flag_spec='${wl}-R$libdir'
+       ;;
+      esac
+    fi
     ;;
 
   os2*)
@@@@ -62001,9 +61734,25 @@@@ newsos6)
 
 openbsd*)
   version_type=sunos
-  if test "$with_gnu_ld" = yes; then
-    need_lib_prefix=no
-    need_version=no
+  need_lib_prefix=no
+  need_version=no
+  sys_lib_search_path_spec="/usr/lib"
+  sys_lib_dlsearch_path_spec="/usr/lib /usr/local/lib"
+  file_magic_cmd=/usr/bin/file
+  file_magic_test_file=`echo /usr/lib/libc.so.*`
+  if test "`echo __ELF__ | $CC -E - | grep __ELF__`" = "" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+    deplibs_check_method='file_magic ELF 0-90-9*-bit LMSB shared object'
+    case "$host_os" in
+    openbsd2.89 | openbsd2.89.*)
+      shlibpath_overrides_runpath=no
+    ;;
+    *)
+      shlibpath_overrides_runpath=yes
+    ;;
+    esac
+  else
+    deplibs_check_method='file_magic OpenBSD.* shared library'
+    shlibpath_overrides_runpath=yes
   fi
   library_names_spec='${libname}${release}.so$versuffix ${libname}.so$versuffix'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
@


1.8
log
@Update to php4-4.1.0

Not much response to my post to ports@@ asking for testing, so there
will probably be some breakage in the more obscure flavors and
non-x86 arches.
@
text
@d1 2
a2 3
$OpenBSD$
--- configure.orig	Sat Dec  8 19:40:35 2001
+++ configure	Mon Dec 17 21:35:09 2001
d93 337
a429 1
@@@@ -57538,7 +57538,7 @@@@ unset with_pic
d438 1
a438 1
@@@@ -57547,7 +57547,7 @@@@ program|static)
d447 1
a447 1
@@@@ -60620,7 +60620,14 @@@@ old_postuninstall_cmds=
d463 1
a463 1
@@@@ -61117,7 +61124,9 @@@@ cygwin* | mingw* | pw32* )
d474 1
a474 1
@@@@ -61521,10 +61530,24 @@@@ else
d501 1
a501 1
@@@@ -62001,9 +62024,25 @@@@ newsos6)
@


1.7
log
@- bump NEED_VERSION
- add pkgspec for c-client
- rename checksums file
- link with libcom_err_pic vs. libcom_err
@
text
@d1 4
a4 180
$OpenBSD: patch-configure,v 1.6 2001/10/04 21:27:44 avsm Exp $
--- configure.orig	Thu Jun 21 02:28:57 2001
+++ configure	Sun Nov 18 17:12:35 2001
@@@@ -6577,6 +6577,7 @@@@ for ac_func in asctime_r \
 chroot \
 ctime_r \
 cuserid \
+crypt \
 flock \
 gai_strerror \
 gcvt \
@@@@ -8517,10 +8518,6 @@@@ if eval "test \"`echo '$ac_cv_lib_'$ac_l
   esac
 
  cat >> confdefs.h <<\EOF
-#define HAVE_LIBCRYPT 1
-EOF
- 
- cat >> confdefs.h <<\EOF
 #define HAVE_CRYPT 1
 EOF
  
@@@@ -22424,8 +22421,37 @@@@ EOF
       fi
     done
 
+    old_CPPFLAGS=$CPPFLAGS
+    CPPFLAGS=-I$IMAP_INC_DIR
+    cat > conftest.$ac_ext <<EOF
+#line 22431 "configure"
+#include "confdefs.h"
+
+      #include "imap4r1.h"
+      #if defined(IMAPSSLPORT)
+      this_is_true
+      #endif
+    
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "this_is_true" >/dev/null 2>&1; then
+  rm -rf conftest*
+  
+      cat >> confdefs.h <<\EOF
+#define HAVE_IMAP2001 1
+EOF
+
+    
+else
+  rm -rf conftest*
+   
+fi
+rm -f conftest*
+
+    CPPFLAGS=$old_CPPFLAGS
+
     echo $ac_n "checking for pam_start in -lpam""... $ac_c" 1>&6
-echo "configure:22429: checking for pam_start in -lpam" >&5
+echo "configure:22458: checking for pam_start in -lpam" >&5
 ac_lib_var=`echo pam'_'pam_start | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@@@ -22471,7 +22497,54 @@@@ else
   echo "$ac_t""no" 1>&6
 fi
  
-    
+    echo $ac_n "checking for crypt in -lcrypt""... $ac_c" 1>&6
+echo "configure:22505: checking for crypt in -lcrypt" >&5
+ac_lib_var=`echo crypt'_'crypt | sed 'y%./+-%__p_%'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_save_LIBS="$LIBS"
+LIBS="-lcrypt  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 22513 "configure"
+#include "confdefs.h"
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char crypt();
+
+int main() {
+crypt()
+; return 0; }
+EOF
+if { (eval echo configure:22524: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=yes"
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=no"
+fi
+rm -f conftest*
+LIBS="$ac_save_LIBS"
+
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_lib=HAVE_LIB`echo crypt | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_lib 1
+EOF
+
+  LIBS="-lcrypt $LIBS"
+
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+	    
     
   if test -z "$IMAP_DIR" || echo "$IMAP_DIR" | grep '^/' >/dev/null ; then
     IMAP_DIR="$IMAP_DIR"
@@@@ -22585,53 +22658,21 @@@@ fi
   fi
 
     
-  DLIBS="-l$IMAP_LIB $DLIBS"
+  DLIBS="$DLIBS -l$IMAP_LIB"
 
     
-  
-
-echo $ac_n "checking for Kerberos support in IMAP""... $ac_c" 1>&6
-echo "configure:22595: checking for Kerberos support in IMAP" >&5
-# Check whether --with-kerberos or --without-kerberos was given.
+  # Check whether --with-kerberos or --without-kerberos was given.
 if test "${with_kerberos+set}" = set; then
   withval="$with_kerberos"
-  PHP_KERBEROS=$withval
+  
+    PHP_KERBEROS=$withval
+  
 else
-  PHP_KERBEROS=no
-fi
-
-
-case "$PHP_KERBEROS" in
-shared,*)
-  ext_output="yes, shared"
-  ext_shared=yes
-  PHP_KERBEROS=`echo "$PHP_KERBEROS"|sed 's/^shared,//'`
-  ;;
-shared)
-  ext_output="yes, shared"
-  ext_shared=yes
-  PHP_KERBEROS=yes
-  ;;
-no)
-  ext_output="no"
-  ext_shared=no
-  ;;
-*)
-  ext_output="yes"
-  ext_shared=no
-  ;;
-esac
-
-if test "$php_always_shared" = "yes"; then
-  ext_output="yes, shared"
-  ext_shared=yes
-  test "$PHP_KERBEROS" = "no" && PHP_KERBEROS=yes
+  
+    PHP_KERBEROS=no
+  
 fi
 
-echo "$ac_t""$ext_output" 1>&6
-
-
-
 
   if test "$PHP_KERBEROS" = "yes"; then
     test -d /usr/kerberos && PHP_KERBEROS=/usr/kerberos
@@@@ -22676,22 +22717,22 @@@@ EOF
d8 2
a9 2
- case "gssapi_krb5" in
+ case "gssapi" in
d20 2
a21 2
- case "gssapi_krb5" in
+ case "gssapi" in
d31 1
a31 1
@@@@ -22730,22 +22771,22 @@@@ EOF
d35 2
a36 2
- case "k5crypto" in
+ case "asn1" in
d47 2
a48 2
- case "k5crypto" in
+ case "asn1" in
d58 1
a58 1
@@@@ -22757,22 +22798,22 @@@@ EOF
d62 2
a63 2
- case "com_err" in
+ case "com_err_pic" in
d74 2
a75 2
- case "com_err" in
+ case "com_err_pic" in
d85 7
a91 3
@@@@ -22783,59 +22824,49 @@@@ EOF
   ;;
   esac
d93 2
a94 27
-  fi
-
-    
+  else
+    cat > conftest.$ac_ext <<EOF
+#line 22833 "configure"
+#include "confdefs.h"
+#include <$IMAP_INC_DIR/linkage.h>
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "auth_gss" >/dev/null 2>&1; then
+  rm -rf conftest*
   
+      { echo "configure: error: This c-client library is build with Kerberos support. 
 
-echo $ac_n "checking for SSL support in IMAP""... $ac_c" 1>&6
-echo "configure:22793: checking for SSL support in IMAP" >&5
-# Check whether --with-imap-ssl or --without-imap-ssl was given.
-if test "${with_imap_ssl+set}" = set; then
-  withval="$with_imap_ssl"
-  PHP_IMAP_SSL=$withval
-else
-  PHP_IMAP_SSL=no
+      Add --with-kerberos<=DIR> to your configure line. Check config.log for details." 1>&2; exit 1; }
+    
 fi
+rm -f conftest*
d96 29
a124 38
+  fi
 
-case "$PHP_IMAP_SSL" in
-shared,*)
-  ext_output="yes, shared"
-  ext_shared=yes
-  PHP_IMAP_SSL=`echo "$PHP_IMAP_SSL"|sed 's/^shared,//'`
-  ;;
-shared)
-  ext_output="yes, shared"
-  ext_shared=yes
-  PHP_IMAP_SSL=yes
-  ;;
-no)
-  ext_output="no"
-  ext_shared=no
-  ;;
-*)
-  ext_output="yes"
-  ext_shared=no
-  ;;
-esac
 
-if test "$php_always_shared" = "yes"; then
-  ext_output="yes, shared"
-  ext_shared=yes
-  test "$PHP_IMAP_SSL" = "no" && PHP_IMAP_SSL=yes
+    
+  # Check whether --with-imap-ssl or --without-imap-ssl was given.
+if test "${with_imap_ssl+set}" = set; then
+  withval="$with_imap_ssl"
+  
+    PHP_IMAP_SSL=$withval
+  
+else
+  
+    PHP_IMAP_SSL=no
+  
d127 3
a129 7
-echo "$ac_t""$ext_output" 1>&6
-
-
-
 
   if test "$PHP_IMAP_SSL" = "yes"; then
     PHP_IMAP_SSL=/usr
d131 1
a131 18
 
   if test "$PHP_IMAP_SSL" != "no"; then
+    cat >> confdefs.h <<\EOF
+#define HAVE_IMAP_SSL 1
+EOF
+
     
   if test "$PHP_IMAP_SSL/lib" != "/usr/lib"; then
     
@@@@ -22870,22 +22901,23 @@@@ echo "$ac_t""$ext_output" 1>&6
   fi
 
     
-  DLIBS="-lcrypto $DLIBS"
+  DLIBS="$DLIBS -lssl"
 
     
-  DLIBS="-lssl $DLIBS"
d133 56
a188 2
+  DLIBS="$DLIBS -lcrypto"
 
d190 5
a194 52
     old_LIBS=$LIBS
-    LIBS="$LIBS -lc-client"
+    LIBS="$LIBS -L$IMAP_LIBDIR -l$IMAP_LIB"
     if test $PHP_KERBEROS != "no"; then
-      LIBS="$LIBS -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err"
+      LIBS="$LIBS -L$PHP_KERBEROS/lib -lgssapi -lkrb5 -lasn1 -lcom_err_pic"
     fi
+
     if test "$cross_compiling" = yes; then
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 22889 "configure"
+#line 22924 "configure"
 #include "confdefs.h"
 
       void mm_log(void){}
@@@@ -22903,27 +22935,24 @@@@ else
       void mm_exists(void){}
       void mm_searched(void){}
       void mm_expunged(void){}
-      char ssl_onceonlyinit();
+      char mail_open();
       int main() {
-        ssl_onceonlyinit();
+        mail_open(0,"",0);
         return 0;
       }
     
 EOF
-if { (eval echo configure:22914: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:22949: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
-  
-      cat >> confdefs.h <<\EOF
-#define HAVE_IMAP_SSL 1
-EOF
-
-    
+  :
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -fr conftest*
   
-      { echo "configure: error: This c-client library does not support SSL. Recompile or remove --with-imap-ssl from configure line." 1>&2; exit 1; }
+      { echo "configure: error: This c-client library is build with SSL support. 
+      
+      Add --with-imap-ssl<=DIR> to your configure line. Check config.log for details." 1>&2; exit 1; }
     
 fi
 rm -fr conftest*
@


1.6
log
@- fix imap flavor build, enable kerberos support as well
  (checked by heko, naddy)
- work with any LOCALBASE for most flavors (heko)
- turn off url_fopen by default for better security, most people
  never use it
- correctly detect the crypt function as part of libc,
  not a separate library
- unbreak curl, since 7.9 is now present in our tree
- more informative INSTALL script (naddy, heko)
@
text
@d1 3
a3 3
$OpenBSD$
--- configure.orig	Thu Jun 21 06:28:57 2001
+++ configure	Thu Oct  4 21:38:55 2001
d234 27
d368 1
a368 1
+      LIBS="$LIBS -L$PHP_KERBEROS/lib -lgssapi -lkrb5 -lcom_err -lasn1"
@


1.6.2.1
log
@Upgrade Pine to 4.44 which requires newer c-client.
This also fixes dependency entries for c-client and brings in some other
minor fixes from the -current ports tree.
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.6 2001/10/04 21:27:44 avsm Exp $
--- configure.orig	Thu Jun 21 02:28:57 2001
+++ configure	Sun Jan 13 03:22:41 2002
a233 27
@@@@ -22757,22 +22798,22 @@@@ EOF
   esac
 
     
- case "com_err" in
+ case "com_err_pic" in
  c|c_r|pthread*) ;;
  *)
 
    if test "$ext_shared" = "yes"; then
      
-  IMAP_SHARED_LIBADD="$IMAP_SHARED_LIBADD -lcom_err"
+  IMAP_SHARED_LIBADD="$IMAP_SHARED_LIBADD -lcom_err_pic"
 
    else
      
- case "com_err" in
+ case "com_err_pic" in
  c|c_r|pthread*) ;;
  *)
 
    
-  LIBS="$LIBS -lcom_err"
+  LIBS="$LIBS -lcom_err_pic"
 
 
   ;;
d341 1
a341 1
+      LIBS="$LIBS -L$PHP_KERBEROS/lib -lgssapi -lkrb5 -lasn1 -lcom_err_pic"
@


1.5
log
@Upgrade to PHP-4.0.5

- update MASTER_SITES to account for some wierdness on php.net
- all the old patches have been merged into the source tree now
- add a minor patch to improve the randomness of php temporary files

Upgrade is recommended.  Contains a vast array of bugfixes over
previous PHP4 releases (read the NEWS file)
@
text
@d1 123
a123 14
$OpenBSD: patch-configure,v 1.4 2001/01/07 21:08:11 avsm Exp $
--- configure.orig	Wed Dec 20 07:44:27 2000
+++ configure	Sun Jan  7 18:38:39 2001
@@@@ -376,7 +376,7 @@@@ ac_help="$ac_help
   --with-exec-dir[=DIR]   Only allow executables in DIR when in safe mode
                           defaults to /usr/local/php/bin"
 ac_help="$ac_help
-  --with-openssl[=DIR]    Include OpenSSL support (requires OpenSSL >= 0.9.6) "
+  --with-openssl[=DIR]    Include OpenSSL support (requires OpenSSL >= 0.9.5) "
 ac_help="$ac_help
   --enable-sigchild       Enable PHP's own SIGCHLD handler."
 ac_help="$ac_help
@@@@ -7578,7 +7578,7 @@@@ echo "configure:7576: checking for OpenS
 #include "confdefs.h"
d125 13
a137 13
   #include <openssl/opensslv.h>
-  #if OPENSSL_VERSION_NUMBER >= 0x0090600fL
+  #if OPENSSL_VERSION_NUMBER >= 0x0090500fL
   yes
   #endif
   
@@@@ -7587,12 +7587,12 @@@@ if (eval "$ac_cpp conftest.$ac_ext") 2>&
   egrep "yes" >/dev/null 2>&1; then
   rm -rf conftest*
   
-    echo "$ac_t"">= 0.9.6" 1>&6
+    echo "$ac_t"">= 0.9.5" 1>&6
   
d139 32
a170 5
   rm -rf conftest*
   
-    { echo "configure: error: OpenSSL version 0.9.6 or greater required." 1>&2; exit 1; }
+    { echo "configure: error: OpenSSL version 0.9.5 or greater required." 1>&2; exit 1; }
   
a171 2
 rm -f conftest*
@@@@ -23084,12 +23084,7 @@@@ fi
d173 3
a175 6
   LIBS=$old_LIBS
   LDFLAGS="$old_LDFLAGS"
-  if test "$ac_cv_lib_mcrypt_init_mcrypt" = "yes"; then
-	cat >> confdefs.h <<\EOF
-#define HAVE_LIBMCRYPT22 1
-EOF
d177 33
a209 2
-  elif test "$ac_cv_lib_mcrypt_mcrypt_module_open" = "yes"; then
+  if test "$ac_cv_lib_mcrypt_mcrypt_module_open" = "yes"; then
d211 14
a224 1
  case "ltdl" in
d226 88
a313 3
@@@@ -23106,6 +23101,11 @@@@ EOF
 #define HAVE_LIBMCRYPT24 1
 EOF
d315 1
a315 1
+  elif test "$ac_cv_lib_mcrypt_init_mcrypt" = "yes"; then
d317 1
a317 1
+#define HAVE_LIBMCRYPT22 1
d320 4
a323 2
   else
     { echo "configure: error: Sorry" 1>&2; exit 1; }
d325 25
a349 1
@@@@ -39359,7 +39359,7 @@@@ echo "configure:39357: checking for Open
d352 24
a375 13
   #include <openssl/opensslv.h>
-  #if OPENSSL_VERSION_NUMBER >= 0x0090600fL
+  #if OPENSSL_VERSION_NUMBER >= 0x0090500fL
   yes
   #endif
   
@@@@ -39368,12 +39368,12 @@@@ if (eval "$ac_cpp conftest.$ac_ext") 2>&
   egrep "yes" >/dev/null 2>&1; then
   rm -rf conftest*
   
-    echo "$ac_t"">= 0.9.6" 1>&6
+    echo "$ac_t"">= 0.9.5" 1>&6
   
d377 3
a379 4
   rm -rf conftest*
   
-    { echo "configure: error: OpenSSL version 0.9.6 or greater required." 1>&2; exit 1; }
+    { echo "configure: error: OpenSSL version 0.9.5 or greater required." 1>&2; exit 1; }
d381 5
d387 1
a387 1
 rm -f conftest*
@


1.4
log
@Add a couple of patches from venaas@@php.net to allow PHP-4.0.4 to work
with OpenSSL 0.9.5a, instead of requiring only OpenSSL 0.9.6
These patches detect the revelant version and use the additional return
values in 0.9.6 only if present.

This also unbreaks the SNMP flavor on 2.8-stable, which requires SSL
support, since our UCD-SNMP daemon has OpenSSL compiled into it
(wierd, but thats how the PHP snmp-config.m4 works)

- Add OpenSSL patches
- Add note crypt.c patch that its now in 4.0.5-dev and can be removed soon
- Add --with-openssl to the standard set of configure options
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.3 2000/12/28 17:53:17 avsm Exp $
@


1.3
log
@Add in a flavor for mcrypt, an interface to block and stream
encryption algorithms.

The patches are a backport from PHP-CVS to the mcrypt m4 script, which
didn't pick up the right version of libmcrypt.  I've included the
m4 patch also, since the outputted configure script patch will make no
sense to anyone who looks at it in the future.
@
text
@d1 36
a36 3
$OpenBSD: update-patches,v 1.3 2000/06/09 17:08:37 espie Exp $
--- configure.orig	Thu Dec 28 16:53:29 2000
+++ configure	Thu Dec 28 16:54:06 2000
d51 3
a53 3
@@@@ -23102,8 +23097,13 @@@@ EOF
   ;;
   esac
d55 1
a55 1
-	cat >> confdefs.h <<\EOF
d57 1
a57 1
 #define HAVE_LIBMCRYPT24 1
d60 5
a64 4
+  elif test "$ac_cv_lib_mcrypt_init_mcrypt" = "yes"; then
+    cat >> confdefs.h <<\EOF
+#define HAVE_LIBMCRYPT22 1
 EOF
d66 21
a86 1
   else
@


1.2
log
@- update to php-4.0.4
- bump NEED_VERSION
- no longer need extra distfile number4.tar.gz since it has
  been integrated into the main distribution
- ltconfig, mysql socket patches are in main distribution now,
  so they are removed.  Note that the ltconfig patch was only
  applied to the 4_0_4 branch by the PHP team, so we will have
  to resubmit it for the next version, unless libtool-cvs has
  been updated with our information.
- Since php3/4 conflict with each other anyway, versioning is
  not needed.

ok jakob@@
@
text
@d1 32
a32 10
--- configure	Tue Aug 29 14:37:36 2000
+++ configure	Mon Sep  4 15:56:54 2000
@@@@ -22456,6 +22456,7 @@@@
 echo "configure:22457: checking for MySQL UNIX socket" >&5
   MYSQL_SOCK=/tmp/mysql.sock
   for i in  \
+      /var/mysql/mysql.sock \
       /var/run/mysqld/mysqld.sock \
       /var/tmp/mysql.sock \
       /var/lib/mysql/mysql.sock \
@


1.1
log
@make sure configure finds mysql.sock
@
text
@@

