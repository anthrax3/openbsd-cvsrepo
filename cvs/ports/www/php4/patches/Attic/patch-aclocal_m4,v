head	1.8;
access;
symbols
	OPENBSD_4_3:1.7.0.12
	OPENBSD_4_3_BASE:1.7
	OPENBSD_4_2:1.7.0.10
	OPENBSD_4_2_BASE:1.7
	OPENBSD_4_1:1.7.0.8
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.7.0.6
	OPENBSD_4_0_BASE:1.7
	OPENBSD_3_9:1.7.0.4
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.7.0.2
	OPENBSD_3_8_BASE:1.7
	OPENBSD_3_7:1.6.0.6
	OPENBSD_3_7_BASE:1.6
	OPENBSD_3_6:1.6.0.4
	OPENBSD_3_6_BASE:1.6
	OPENBSD_3_5:1.6.0.2
	OPENBSD_3_5_BASE:1.6
	OPENBSD_3_4:1.4.0.2
	OPENBSD_3_4_BASE:1.4;
locks; strict;
comment	@# @;


1.8
date	2008.05.27.07.07.29;	author jasper;	state dead;
branches;
next	1.7;

1.7
date	2005.04.04.21.11.42;	author robert;	state Exp;
branches;
next	1.6;

1.6
date	2004.02.29.00.08.08;	author avsm;	state Exp;
branches
	1.6.2.1
	1.6.4.1
	1.6.6.1;
next	1.5;

1.5
date	2003.11.15.18.11.35;	author avsm;	state Exp;
branches;
next	1.4;

1.4
date	2003.05.23.20.08.33;	author avsm;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	2003.05.02.19.46.04;	author avsm;	state Exp;
branches;
next	1.2;

1.2
date	2002.03.03.12.13.29;	author avsm;	state dead;
branches;
next	1.1;

1.1
date	2001.12.18.01.40.48;	author avsm;	state Exp;
branches;
next	;

1.4.2.1
date	2004.07.20.23.23.07;	author robert;	state Exp;
branches;
next	;

1.6.2.1
date	2005.04.20.12.28.41;	author robert;	state Exp;
branches;
next	;

1.6.4.1
date	2005.04.20.12.23.45;	author robert;	state Exp;
branches;
next	;

1.6.6.1
date	2005.05.23.20.21.31;	author robert;	state Exp;
branches;
next	;


desc
@@


1.8
log
@it's a sunny day....and the right time to kill php4.

it has been unlinked from the builds for some monthts now, and everybody
should've upgraded to php5 a long time ago.

from brad@@, ok robert@@
@
text
@$OpenBSD: patch-aclocal_m4,v 1.7 2005/04/04 21:11:42 robert Exp $
--- aclocal.m4.orig	Wed Mar 30 16:35:19 2005
+++ aclocal.m4	Sun Apr  3 22:21:42 2005
@@@@ -1660,10 +1660,9 @@@@
     if test "$PHP_KERBEROS_DIR"; then
       found_kerberos=yes
       PHP_ADD_LIBPATH($PHP_KERBEROS_DIR/lib, $1)
-      PHP_ADD_LIBRARY(gssapi_krb5, 1, $1)
       PHP_ADD_LIBRARY(krb5, 1, $1)
-      PHP_ADD_LIBRARY(k5crypto, 1, $1)
-      PHP_ADD_LIBRARY(com_err,  1, $1)
+      PHP_ADD_LIBRARY(crypto, 1, $1)
+      PHP_ADD_LIBRARY(gssapi, 1, $1)
       PHP_ADD_INCLUDE($PHP_KERBEROS_DIR/include)
     fi
   fi
@@@@ -1757,6 +1756,7 @@@@
   
     PHP_CHECK_LIBRARY(crypto, CRYPTO_free, [
       PHP_ADD_LIBRARY(crypto,,$1)
+      PHP_ADD_LIBRARY(des,,$1)
     ],[
       AC_MSG_ERROR([libcrypto not found!])
     ],[
@@@@ -4231,7 +4231,7 @@@@
     shlibpath_overrides_runpath=yes
   fi
   library_names_spec='${libname}${release}.so$versuffix ${libname}.so$versuffix'
-  finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
+  finish_cmds=
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
@


1.7
log
@update to 4.3.11;
@
text
@d1 1
a1 1
$OpenBSD$
@


1.6
log
@Update to php4-4.3.5RC3 (final RC), fixes some 64-bit bugs conveniently in
time for amd64 to work.  Also some gcc3 fixes.
@
text
@d1 17
a17 4
$OpenBSD: patch-aclocal_m4,v 1.5 2003/11/15 18:11:35 avsm Exp $
--- aclocal.m4.orig	2004-02-16 15:30:25.000000000 +0000
+++ aclocal.m4	2004-02-28 17:54:33.000000000 +0000
@@@@ -1659,6 +1659,7 @@@@ AC_DEFUN([PHP_SETUP_OPENSSL],[
d25 1
a25 1
@@@@ -4074,7 +4075,7 @@@@ openbsd*)
@


1.6.6.1
log
@SECURITY: update to 4.3.11
fixes multiple vulnerabilities
http://www.vuxml.org/openbsd/c6f452e8-b00a-11d9-825c-00065bd5b0b6.html

ok brad@@
@
text
@d1 4
a4 17
$OpenBSD$
--- aclocal.m4.orig	Wed Mar 30 16:35:19 2005
+++ aclocal.m4	Sun Apr  3 22:21:42 2005
@@@@ -1660,10 +1660,9 @@@@
     if test "$PHP_KERBEROS_DIR"; then
       found_kerberos=yes
       PHP_ADD_LIBPATH($PHP_KERBEROS_DIR/lib, $1)
-      PHP_ADD_LIBRARY(gssapi_krb5, 1, $1)
       PHP_ADD_LIBRARY(krb5, 1, $1)
-      PHP_ADD_LIBRARY(k5crypto, 1, $1)
-      PHP_ADD_LIBRARY(com_err,  1, $1)
+      PHP_ADD_LIBRARY(crypto, 1, $1)
+      PHP_ADD_LIBRARY(gssapi, 1, $1)
       PHP_ADD_INCLUDE($PHP_KERBEROS_DIR/include)
     fi
   fi
@@@@ -1757,6 +1756,7 @@@@
d12 1
a12 1
@@@@ -4231,7 +4231,7 @@@@
@


1.6.2.1
log
@SECURITY:
update to version 4.3.11; fixes multiple vulnerabilities
http://www.vuxml.org/openbsd/c6f452e8-b00a-11d9-825c-00065bd5b0b6.html

ok brad@@
@
text
@d1 4
a4 17
$OpenBSD$
--- aclocal.m4.orig	Wed Mar 30 16:35:19 2005
+++ aclocal.m4	Sun Apr  3 22:21:42 2005
@@@@ -1660,10 +1660,9 @@@@
     if test "$PHP_KERBEROS_DIR"; then
       found_kerberos=yes
       PHP_ADD_LIBPATH($PHP_KERBEROS_DIR/lib, $1)
-      PHP_ADD_LIBRARY(gssapi_krb5, 1, $1)
       PHP_ADD_LIBRARY(krb5, 1, $1)
-      PHP_ADD_LIBRARY(k5crypto, 1, $1)
-      PHP_ADD_LIBRARY(com_err,  1, $1)
+      PHP_ADD_LIBRARY(crypto, 1, $1)
+      PHP_ADD_LIBRARY(gssapi, 1, $1)
       PHP_ADD_INCLUDE($PHP_KERBEROS_DIR/include)
     fi
   fi
@@@@ -1757,6 +1756,7 @@@@
d12 1
a12 1
@@@@ -4231,7 +4231,7 @@@@
@


1.6.4.1
log
@SECURITY:
update to version 4.3.11; fixes multiple vulnerabilities
http://www.vuxml.org/openbsd/c6f452e8-b00a-11d9-825c-00065bd5b0b6.html

ok brad@@
@
text
@d1 4
a4 17
$OpenBSD$
--- aclocal.m4.orig	Wed Mar 30 16:35:19 2005
+++ aclocal.m4	Sun Apr  3 22:21:42 2005
@@@@ -1660,10 +1660,9 @@@@
     if test "$PHP_KERBEROS_DIR"; then
       found_kerberos=yes
       PHP_ADD_LIBPATH($PHP_KERBEROS_DIR/lib, $1)
-      PHP_ADD_LIBRARY(gssapi_krb5, 1, $1)
       PHP_ADD_LIBRARY(krb5, 1, $1)
-      PHP_ADD_LIBRARY(k5crypto, 1, $1)
-      PHP_ADD_LIBRARY(com_err,  1, $1)
+      PHP_ADD_LIBRARY(crypto, 1, $1)
+      PHP_ADD_LIBRARY(gssapi, 1, $1)
       PHP_ADD_INCLUDE($PHP_KERBEROS_DIR/include)
     fi
   fi
@@@@ -1757,6 +1756,7 @@@@
d12 1
a12 1
@@@@ -4231,7 +4231,7 @@@@
@


1.5
log
@update to php4-4.3.4
@
text
@d1 3
a3 3
$OpenBSD: patch-aclocal_m4,v 1.4 2003/05/23 20:08:33 avsm Exp $
--- aclocal.m4.orig	2003-11-02 23:27:49.000000000 +0000
+++ aclocal.m4	2003-11-14 09:24:24.000000000 +0000
d12 1
a12 1
@@@@ -4069,7 +4070,7 @@@@ openbsd*)
@


1.4
log
@update to php4-4.3.2RC4
@
text
@d1 12
a12 4
$OpenBSD: patch-aclocal_m4,v 1.3 2003/05/02 19:46:04 avsm Exp $
--- aclocal.m4.orig	Thu May 22 01:25:35 2003
+++ aclocal.m4	Thu May 22 16:20:29 2003
@@@@ -3968,7 +3968,7 @@@@ openbsd*)
@


1.4.2.1
log
@Update to 4.3.8:
SECURITY: PHP memory_limit remote vulnerability
http://security.e-matters.de/advisories/112004.html
It contains a lot of other fixes too, check the
changelog at http://www.php.net/ChangeLog-4.php#4.3.8 .

ok pvalchev@@
@
text
@d1 4
a4 12
$OpenBSD: patch-aclocal_m4,v 1.6 2004/02/29 00:08:08 avsm Exp $
--- aclocal.m4.orig	2004-02-16 15:30:25.000000000 +0000
+++ aclocal.m4	2004-02-28 17:54:33.000000000 +0000
@@@@ -1659,6 +1659,7 @@@@ AC_DEFUN([PHP_SETUP_OPENSSL],[
   
     PHP_CHECK_LIBRARY(crypto, CRYPTO_free, [
       PHP_ADD_LIBRARY(crypto,,$1)
+      PHP_ADD_LIBRARY(des,,$1)
     ],[
       AC_MSG_ERROR([libcrypto not found!])
     ],[
@@@@ -4074,7 +4075,7 @@@@ openbsd*)
@


1.3
log
@put common php patches here
@
text
@d1 4
a4 4
$OpenBSD: patch-aclocal_m4,v 1.1 2003/04/03 10:26:25 avsm Exp $
--- aclocal.m4.orig	Wed Jan 22 11:09:53 2003
+++ aclocal.m4	Wed Jan 22 11:10:12 2003
@@@@ -3976,7 +3976,7 @@@@ openbsd*)
@


1.2
log
@upgrade to php-4.1.2

closes a security issue in multipart form handling (buffer overflow)

temporarily disable the freetds flavour, since the m4 patch cannot
seem to be regenerated
@
text
@d1 5
a5 21
$OpenBSD: patch-aclocal_m4,v 1.1 2001/12/18 01:40:48 avsm Exp $
--- aclocal.m4.orig	Mon Dec 17 18:41:24 2001
+++ aclocal.m4	Mon Dec 17 18:42:41 2001
@@@@ -2110,7 +2110,14 @@@@ old_postuninstall_cmds=
 
 if test -n "$RANLIB"; then
   old_archive_cmds="$old_archive_cmds~\$RANLIB \$oldlib"
-  old_postinstall_cmds="\$RANLIB \$oldlib~$old_postinstall_cmds"
+  case "$host_os" in
+  openbsd*)
+    old_postinstall_cmds="\$RANLIB -t \$oldlib~$old_postinstall_cmds"
+  ;;
+  *)
+    old_postinstall_cmds="\$RANLIB \$oldlib~$old_postinstall_cmds"
+  ;;
+  esac
 fi
 
 # Allow CC to be a program name with arguments.
@@@@ -2513,7 +2520,9 @@@@ cygwin* | mingw* | pw32* )
     with_gnu_ld=no
d7 4
a11 9
-
+openbsd*)
+  with_gnu_ld=no
+  ;;
 esac
 
 ld_shlibs=yes
@@@@ -2917,10 +2926,24 @@@@ else
     ;;
a12 53
   openbsd*)
-    archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
-    hardcode_libdir_flag_spec='-R$libdir'
     hardcode_direct=yes
     hardcode_shlibpath_var=no
+    if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+      archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $linkopts'
+      hardcode_libdir_flag_spec='${wl}-R$libdir'
+      export_dynamic_flag_spec='${wl}-E'
+    else
+      case "$host_os" in
+      openbsd[01].* | openbsd2.[0-7] | openbsd2.[0-7].*)
+       archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linkopts'
+       hardcode_libdir_flag_spec='-R$libdir'
+       ;;
+      *)
+       archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $linkopts'
+       hardcode_libdir_flag_spec='${wl}-R$libdir'
+       ;;
+      esac
+    fi
     ;;
 
   os2*)
@@@@ -3394,9 +3417,25 @@@@ newsos6)
 
 openbsd*)
   version_type=sunos
-  if test "$with_gnu_ld" = yes; then
-    need_lib_prefix=no
-    need_version=no
+  need_lib_prefix=no
+  need_version=no
+  sys_lib_search_path_spec="/usr/lib"
+  sys_lib_dlsearch_path_spec="/usr/lib /usr/local/lib"
+  file_magic_cmd=/usr/bin/file
+  file_magic_test_file=`echo /usr/lib/libc.so.*`
+  if test "`echo __ELF__ | $CC -E - | grep __ELF__`" = "" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+    deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object'
+    case "$host_os" in
+    openbsd2.[89] | openbsd2.[89].*)
+      shlibpath_overrides_runpath=no
+    ;;
+    *)
+      shlibpath_overrides_runpath=yes
+    ;;
+    esac
+  else
+    deplibs_check_method='file_magic OpenBSD.* shared library'
+    shlibpath_overrides_runpath=yes
   fi
   library_names_spec='${libname}${release}.so$versuffix ${libname}.so$versuffix'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
@


1.1
log
@Update to php4-4.1.0

Not much response to my post to ports@@ asking for testing, so there
will probably be some breakage in the more obscure flavors and
non-x86 arches.
@
text
@d1 1
a1 1
$OpenBSD$
@

