head	1.6;
access;
symbols
	OPENBSD_5_6:1.5.0.6
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.4
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.2
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2014.10.25.14.25.21;	author nigel;	state dead;
branches;
next	1.5;
commitid	mzfgbA918q2ys95o;

1.5
date	2013.04.27.14.29.09;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2012.11.05.10.59.43;	author sthen;	state dead;
branches;
next	1.3;

1.3
date	2012.09.28.00.20.16;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2011.08.16.08.24.51;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2011.07.31.18.09.57;	author landry;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2011.08.24.07.52.23;	author jasper;	state dead;
branches;
next	;


desc
@@


1.6
log
@Update for p5-libwww 6.08, add dependencies, move to latest versions.
Ok sthen@@
@
text
@$OpenBSD: patch-lib_WWW_YouTube_Download_pm,v 1.5 2013/04/27 14:29:09 sthen Exp $

- support one more url type

--- lib/WWW/YouTube/Download.pm.orig	Fri Apr 19 18:50:43 2013
+++ lib/WWW/YouTube/Download.pm	Sat Apr 27 12:33:16 2013
@@@@ -271,7 +271,7 @@@@ sub _suffix {
 
 sub _video_id {
     my $stuff = shift;
-    if ($stuff =~ m{/.*?[?&;!]v=([^&#?=/;]+)}) {
+    if ($stuff =~ m{/.*?[?&;!](?:v|video_id)=([^&#?=/;]+)}) {
         return $1;
     }
     elsif ($stuff =~ m{/(?:e|v|embed)/([^&#?=/;]+)}) {
@


1.5
log
@update to p5-WWW-YouTube-Download 0.50, from maintainer Mikolaj Kucharski
@
text
@d1 1
a1 1
$OpenBSD$
@


1.4
log
@update to p5-WWW-YouTube-Download 0.41, from maintainer Mikolaj Kucharski
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_WWW_YouTube_Download_pm,v 1.3 2012/09/28 00:20:16 sthen Exp $
d3 1
a3 1
- fix downloading after youtube changes
d5 9
a13 10
--- lib/WWW/YouTube/Download.pm.orig	Sun Jan 22 07:54:47 2012
+++ lib/WWW/YouTube/Download.pm	Thu Sep 27 22:45:08 2012
@@@@ -222,7 +222,9 @@@@ sub _parse_stream_map {
         my $uri = URI->new;
         $uri->query($stuff);
         my $query = +{ $uri->query_form };
-        $fmt_url_map->{$query->{itag}} = $query->{url};
+        my $sig = $query->{sig};
+        my $url = $query->{url};
+        $fmt_url_map->{$query->{itag}} = $url.'&signature='.$sig;
d15 1
a15 2
 
     return $fmt_url_map;
@


1.3
log
@adapt p5-WWW-YouTube-Download to youtube changes
while there, fix file extensions to match the format

from maintainer Mikolaj Kucharski
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@yodate to 0.29, fix following youtube changes
discussed with Mikolaj Kucharski (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_WWW_YouTube_Download_pm,v 1.1 2011/07/31 18:09:57 landry Exp $
d3 1
a3 4
- unbreak after recent youtube changes
- error out when extracting JSON fails
- support for another url type
- youtu.be shortener support
d5 10
a14 10
--- lib/WWW/YouTube/Download.pm.orig	Sun May 29 15:32:20 2011
+++ lib/WWW/YouTube/Download.pm	Sat Jul 30 22:44:24 2011
@@@@ -170,9 +170,17 @@@@ sub _get_args {
             $data = JSON->new->utf8(1)->decode($json);
             last;
         }
+        elsif ($_ && /^\s*'PLAYER_CONFIG'\s*:\s*({.*})\s*$/) {
+            $data = JSON->new->utf8(1)->decode($1);
+            last;
+        }
d17 1
a17 27
-    return $data->{args};
+    if ($data->{args}) {
+        return $data->{args};
+    } else {
+        Carp::croak "failed to extract JSON data.";
+    }
 }
 
 sub _parse_fmt_url_map {
@@@@ -214,13 +222,16 @@@@ sub _suffix {
 
 sub _video_id {
     my $stuff = shift;
-    if ($stuff =~ m{/.*?[?&;]v=([^&#?=/;]+)}) {
+    if ($stuff =~ m{/.*?[?&;!]v=([^&#?=/;]+)}) {
         return $1;
     }
     elsif ($stuff =~ m{/(?:e|v|embed)/([^&#?=/;]+)}) {
         return $1;
     }
     elsif ($stuff =~ m{#p/(?:u|search)/\d+/([^&?/]+)}) {
+        return $1;
+    }
+    elsif ($stuff =~ m{youtu.be/([^&#?=/;]+)}) {
         return $1;
     }
     else {
@


1.1
log
@update to p5-WWW-YouTube-Download 0.27 from maintainer Mikolaj
Kucharski, adds a pair of patches to unbreak it with latest youtube.
ok jasper@@ no objection from sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@Fix youtube functionality in OPENBSD_5_0, original commit by sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_WWW_YouTube_Download_pm,v 1.1 2011/07/31 18:09:57 landry Exp $
@


