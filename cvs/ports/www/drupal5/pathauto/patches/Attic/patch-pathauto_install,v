head	1.4;
access;
symbols
	OPENBSD_4_8:1.3.0.10
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.8
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.6
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.4
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.2
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.2.0.2
	OPENBSD_4_3_BASE:1.2;
locks; strict;
comment	@# @;


1.4
date	2010.09.27.12.21.25;	author stephan;	state dead;
branches;
next	1.3;

1.3
date	2008.07.10.14.21.38;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2008.02.18.12.44.18;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2008.02.18.12.40.16;	author espie;	state Exp;
branches;
next	;


desc
@@


1.4
log
@remove drupal5, which will soon be end-of-life. Switch to drupal6, please. explicit ok sthen@@, aja@@
@
text
@$OpenBSD: patch-pathauto_install,v 1.3 2008/07/10 14:21:38 espie Exp $
--- pathauto.install.orig	Fri May 30 02:58:55 2008
+++ pathauto.install	Thu Jul 10 15:52:31 2008
@@@@ -95,7 +95,7 @@@@ function pathauto_update_2() {
   $ret = array();
   switch ($GLOBALS['db_type']) {
     case 'pgsql':
-      db_change_column($ret, 'variable', 'name', 'name', 'varchar(128)', array('not null' => TRUE, 'default' => "''"));
+      db_query("ALTER TABLE {variable} ALTER name TYPE varchar(128)");
       break;
     case 'mysql':
     case 'mysqli':
@


1.3
log
@update various modules to more recent versions. Mostly minor updates,
except for webform. Rerun update-db after the update ! but the admin
page will tell you so...
@
text
@d1 1
a1 1
$OpenBSD: patch-pathauto_install,v 1.2 2008/02/18 12:44:18 espie Exp $
@


1.2
log
@simpler fix from dev branch
@
text
@d1 5
a5 5
$OpenBSD: patch-pathauto_install,v 1.1 2008/02/18 12:40:16 espie Exp $
--- pathauto.install.orig	Mon Feb 18 13:42:22 2008
+++ pathauto.install	Mon Feb 18 13:42:39 2008
@@@@ -55,7 +55,7 @@@@ function pathauto_install() {
   // Make the variable column wide enough for long cck names
@


1.1
log
@fix activation for pgsql (db_change_column is not available during install,
so copy it locally)
@
text
@d1 4
a4 43
$OpenBSD$
--- pathauto.install.orig	Mon Feb 18 13:36:27 2008
+++ pathauto.install	Mon Feb 18 13:37:57 2008
@@@@ -7,7 +7,38 @@@@
  * 
  */
 
+function ouch1($sql) {
+  $result = db_query($sql);
+  return array('success' => $result !== FALSE, 'query' => check_plain($sql));
+}
+
  
+function ouch(&$ret, $table, $column, $column_new, $type, $attributes = array()) {
+  if (array_key_exists('not null', $attributes) and $attributes['not null']) {
+    $not_null = 'NOT NULL';
+  }
+  if (array_key_exists('default', $attributes)) {
+    if (is_null($attributes['default'])) {
+      $default_val = 'NULL';
+      $default = 'default NULL';
+    }
+    elseif ($attributes['default'] === FALSE) {
+      $default = '';
+    }
+    else {
+      $default_val = "$attributes[default]";
+      $default = "default $attributes[default]";
+    }
+  }
+
+  $ret[] = ouch1("ALTER TABLE {". $table ."} RENAME $column TO ". $column ."_old");
+  $ret[] = ouch1("ALTER TABLE {". $table ."} ADD $column_new $type");
+  $ret[] = ouch1("UPDATE {". $table ."} SET $column_new = ". $column ."_old");
+  if ($default) { $ret[] = ouch1("ALTER TABLE {". $table ."} ALTER $column_new SET $default"); }
+  if ($not_null) { $ret[] = ouch1("ALTER TABLE {". $table ."} ALTER $column_new SET NOT NULL"); }
+  $ret[] = ouch1("ALTER TABLE {". $table ."} DROP ". $column ."_old");
+}
+
  
 /**
  * Implementation of hook_install().
@@@@ -55,7 +86,7 @@@@ function pathauto_install() {
d9 1
a9 1
+      ouch($ret, 'variable', 'name', 'name', 'varchar(128)', array('not null' => TRUE, 'default' => "''"));
@

