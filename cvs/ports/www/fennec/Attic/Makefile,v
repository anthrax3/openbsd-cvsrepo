head	1.39;
access;
symbols
	OPENBSD_5_4:1.36.0.2
	OPENBSD_5_4_BASE:1.36
	OPENBSD_5_3:1.31.0.2
	OPENBSD_5_3_BASE:1.31
	OPENBSD_5_2:1.24.0.2
	OPENBSD_5_2_BASE:1.24
	OPENBSD_5_1_BASE:1.18
	OPENBSD_5_1:1.18.0.2
	OPENBSD_5_0:1.8.0.2
	OPENBSD_5_0_BASE:1.8
	landry_20110412:1.1.1.1
	landry:1.1.1;
locks; strict;
comment	@# @;


1.39
date	2013.12.07.12.50.16;	author landry;	state dead;
branches;
next	1.38;

1.38
date	2013.09.19.13.47.05;	author landry;	state Exp;
branches;
next	1.37;

1.37
date	2013.09.04.18.59.28;	author landry;	state Exp;
branches;
next	1.36;

1.36
date	2013.06.26.19.31.57;	author landry;	state Exp;
branches;
next	1.35;

1.35
date	2013.06.20.06.54.38;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2013.06.17.19.29.05;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2013.04.06.14.41.17;	author landry;	state Exp;
branches;
next	1.32;

1.32
date	2013.03.11.11.44.41;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2012.12.04.21.05.30;	author landry;	state Exp;
branches;
next	1.30;

1.30
date	2012.11.12.20.45.32;	author landry;	state Exp;
branches;
next	1.29;

1.29
date	2012.10.06.07.55.55;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2012.09.22.10.30.17;	author landry;	state Exp;
branches;
next	1.27;

1.27
date	2012.09.21.13.21.44;	author ajacoutot;	state Exp;
branches;
next	1.26;

1.26
date	2012.09.01.14.35.06;	author landry;	state Exp;
branches;
next	1.25;

1.25
date	2012.08.06.11.14.39;	author naddy;	state Exp;
branches;
next	1.24;

1.24
date	2012.06.11.15.34.37;	author landry;	state Exp;
branches;
next	1.23;

1.23
date	2012.04.30.15.40.31;	author landry;	state Exp;
branches;
next	1.22;

1.22
date	2012.04.24.17.21.42;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2012.03.16.22.05.40;	author landry;	state Exp;
branches;
next	1.20;

1.20
date	2012.03.08.12.13.00;	author ajacoutot;	state Exp;
branches;
next	1.19;

1.19
date	2012.02.20.20.21.43;	author landry;	state Exp;
branches;
next	1.18;

1.18
date	2012.01.11.02.17.13;	author nigel;	state Exp;
branches;
next	1.17;

1.17
date	2011.12.15.23.09.44;	author nigel;	state Exp;
branches;
next	1.16;

1.16
date	2011.12.08.00.42.54;	author nigel;	state Exp;
branches;
next	1.15;

1.15
date	2011.10.28.13.09.26;	author robert;	state Exp;
branches;
next	1.14;

1.14
date	2011.10.03.21.08.12;	author landry;	state Exp;
branches;
next	1.13;

1.13
date	2011.09.16.12.00.06;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2011.09.06.19.45.34;	author landry;	state Exp;
branches;
next	1.11;

1.11
date	2011.08.24.06.19.51;	author landry;	state Exp;
branches;
next	1.10;

1.10
date	2011.08.23.20.55.53;	author landry;	state Exp;
branches;
next	1.9;

1.9
date	2011.08.23.08.38.13;	author landry;	state Exp;
branches;
next	1.8;

1.8
date	2011.07.30.07.55.53;	author landry;	state Exp;
branches;
next	1.7;

1.7
date	2011.06.28.22.01.17;	author landry;	state Exp;
branches;
next	1.6;

1.6
date	2011.06.08.18.15.29;	author rpointel;	state Exp;
branches;
next	1.5;

1.5
date	2011.05.04.12.15.33;	author landry;	state Exp;
branches;
next	1.4;

1.4
date	2011.05.04.08.11.15;	author dcoppa;	state Exp;
branches;
next	1.3;

1.3
date	2011.05.03.11.11.37;	author landry;	state Exp;
branches;
next	1.2;

1.2
date	2011.04.14.15.55.19;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2011.04.12.19.48.57;	author landry;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.04.12.19.48.57;	author landry;	state Exp;
branches;
next	;


desc
@@


1.39
log
@Remove devel/xulrunner/1.9, www/fennec, www/firefox36 and productivity/sunbird

- nothing uses xulrunner 1.9 anymore, and that branch was EOL'd upstream
  20 months ago (firefox36 was already unlinked from the build)
- www/fennec as a xul app is dead upstream, since now firefox mobile is
  built on top of java android libs and thus unportable to regular OS.
The esr10 branch from which it was built upon was EOL'd upstream 10 months ago
- productivity/sunbird as a standalone app is dead upstream since 3
  years, hypothetical users should just use thunderbird+lightning which
is still supported/developed.

No complains from ports@@, this will allow for a serious mozilla ports
cleanup, and we're down to 5 mozillas in the ports tree.
@
text
@# $OpenBSD: Makefile,v 1.38 2013/09/19 13:47:05 landry Exp $

COMMENT =	Mozilla mobile web browser
ONLY_FOR_ARCHS =	amd64 i386 powerpc

MOZILLA_VERSION =	10.0.5esr
MOZILLA_BRANCH =	esr10
MOZILLA_PROJECT =	fennec
MOZILLA_CODENAME =	mobile
PKGNAME =	${MOZILLA_PROJECT}-${MOZILLA_VERSION:S/esr//}
REVISION =		10

SO_VERSION =	6.0
# NOTE: Must bump minor version if any shlib's are removed from the
# components dir to avoid pkg_add -r issues.
MOZILLA_LIBS =	mozalloc xpcom xul

CATEGORIES =	www

# mozilla public license
PERMIT_PACKAGE_CDROM=	Yes

MASTER_SITES =	http://releases.mozilla.org/pub/mozilla.org/mobile/releases/${MOZILLA_VERSION}/source/ \
		https://ftp.mozilla.org/pub/mozilla.org/mobile/releases/${MOZILLA_VERSION}/source/ \
		ftp://ftp.mozilla.org/pub/mozilla.org/mobile/releases/${MOZILLA_VERSION}/source/
HOMEPAGE =	http://www.mozilla.com/en-US/mobile/

# lots of logic in mozilla.port.mk
MODULES =	www/mozilla devel/gettext lang/python

MODPY_RUNDEP =	No

# Regression tests are too hard to adapt to run here
NO_TEST =	Yes

CONFIGURE_STYLE =	autoconf no-autoheader
CONFIGURE_ARGS +=	--enable-official-branding
CONFIGURE_ARGS +=	--disable-gconf
CONFIGURE_ARGS +=	--with-system-libevent=/usr/
CONFIGURE_ARGS +=	--with-system-zlib=/usr/ --with-system-bz2=${LOCALBASE}
WANTLIB +=	event

# --with-system-png=${LOCALBASE}
# no system png : apng support not bundled in

MOZILLA_AUTOCONF_DIRS +=	js/src
MOZILLA_SUBST_FILES +=		config/autoconf.mk.in services/crypto/modules/WeaveCrypto.js

SUBST_VARS +=	MOZILLA_VERSION NSS_SO_VERSION

INSTALL_TARGET =	package

# unzip used during install
BUILD_DEPENDS +=	archivers/unzip

post-configure:
	rm -f ${WRKSRC}/services/crypto/modules/WeaveCrypto.js.{orig,beforesubst}

post-install:
	cd ${WRKSRC} && tar -C ${PREFIX}/lib/ -xjf dist/fennec*.tar.bz2
	mv ${PREFIX}/lib/${MOZILLA_PROJECT}{,-${MOZILLA_VERSION}}/
	echo '#!/bin/sh\ncd ${TRUEPREFIX}/lib/${MOZILLA_PROJECT}-${MOZILLA_VERSION} ; LD_LIBRARY_PATH=. ./fennec "$$@@"' \
		 > ${PREFIX}/bin/fennec
	chmod +x ${PREFIX}/bin/fennec
	${INSTALL_DATA} ${WRKSRC}/mobile/branding/nightly/content/fennec_72x72.png \
		${PREFIX}/lib/${MOZILLA_PROJECT}-${MOZILLA_VERSION}/fennec_icon.png
	# install desktop file
	${INSTALL_DATA_DIR} ${PREFIX}/share/applications/ ; \
	${SUBST_CMD} -o ${SHAREOWN} -g ${SHAREGRP} -c ${FILESDIR}/${MOZILLA_PROJECT}.desktop \
		${PREFIX}/share/applications/${MOZILLA_PROJECT}.desktop ; \

.include <bsd.port.mk>
@


1.38
log
@Bump REVISIONS to be on the safe side after typo fix in mozilla.port.mk
(MOZMOZ_WANTLIB instead of MODMOZ_WANTLIB for krb5 libs...)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2013/09/04 18:59:28 landry Exp $
@


1.37
log
@Mark as ONLY_FOR_ARCHS = amd64 i386 powerpc. Realistically, it only builds
& works there, and given that it's based off 10esr branch which is dead
upstream, and fennec on xul is also dead upstream... this could even be cvs
rm'ed :)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2013/06/26 19:31:57 landry Exp $
d11 1
a11 1
REVISION =		9
@


1.36
log
@Bump some REVISIONs after mozilla.port.mk WANTLIB change.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2013/06/20 06:54:38 ajacoutot Exp $
d4 1
@


1.35
log
@Unbreak after hx509 and ntlm removal from Kerberos.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2013/06/17 19:29:05 ajacoutot Exp $
d10 1
a10 1
REVISION =		8
@


1.34
log
@Unbreak Mozilla ports after the Heimdal update.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2013/04/06 14:41:17 landry Exp $
d10 1
a10 1
REVISION =		7
@


1.33
log
@Bump after WANTLIB fix - while here, backport kettenis' libffi i386 fix
to fennec.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2013/03/11 11:44:41 espie Exp $
d10 1
a10 1
REVISION =	6
@


1.32
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2012/12/04 21:05:30 landry Exp $
d10 1
a10 1
REVISION =	5
@


1.31
log
@Winter cleanup of the mozillas :

- Add gtar to BUILD_DEPENDS everywhere in moz.port.mk, since fx 18 will
  start using gtar-only options. Ditto for unzip, used during install.
- special-case the deps for firefox/thunderbird/seamonkey, since those
  are maintained on the long-term. Only those need to depend on the
latest and greatest nss/nspr.
- move the '--relax LDFLAGS for ppc' to moz.port.mk
- move the 'yasm BUILD_DEPENDS for i385/amd64' to moz.port.mk
- move more common CONFIGURE_ARGS to moz.port.mk (libevent,gio,bz2,gconf..)
- fix MODMOZ_WANTLIB wrt nss/nspr majors
- ensure we depend on sqlite3>=21, needed for fx/tb 18
- use --with-system-jpeg only in firefox36/sunbird/fennec/xulrunner,
  fx/tb 18 will have to use its bundled libjpeg-turbo (#791305)
- bump REVISIONs for the WANTLIB/LIB_DEPENDS change.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2012/11/12 20:45:32 landry Exp $
a20 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d33 1
a33 1
NO_REGRESS =	Yes
@


1.30
log
@Bump all ports depending on nspr to account for the devel/nspr,-main ->
devel/nspr pkgpath change. While here, make sure mozilla ports depend on
the latest and greatest via mozilla.port.mk.
Tested in a bulk build..
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2012/10/06 07:55:55 ajacoutot Exp $
d10 1
a10 1
REVISION =	4
a44 6
.if ${MACHINE_ARCH:Msparc64}
CONFIGURE_ARGS +=	--disable-tracejit --disable-methodjit
.endif

# ensure we depend on cairo with tee backend enabled
LIB_DEPENDS =	graphics/cairo>=1.10.2p0
a52 2
# package target uses gtar options
BUILD_DEPENDS +=	archivers/gtar
@


1.29
log
@Extend the desktop file: add a couple of mime types (x-scheme-handler)
so that the mozilla browsers are properly recognized in the "default
browser" specification.

ok landry@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2012/09/22 10:30:17 landry Exp $
d10 1
a10 1
REVISION =	3
@


1.28
log
@Remove useless dependency on deprecated pangox.

- remove useless patch to gfx/thebes/Makefile.in adding -lpangox-1.0 to
EXTRA_DSO_LDOPTS, this was maybe useful before ffx 3.0, but mozilla
stopped using pangox between 2.0 and 3.0. See for the last traces of
pangox.h use : https://bugzilla.mozilla.org/show_bug.cgi?id=528941. See
also bugs #323671/#338446
- backport the patch from #528941 to remove useless pangox.h inclusion
from www/firefox35.
- remove the RUN_DEPENDS on pangox-compat
- bump all corresponding REVISIONS
- while here, make sure all moz ports depend on latest nspr 4.9.2 since
  it'll be a requirement for upcoming gecko 16 releases
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2012/09/21 13:21:44 ajacoutot Exp $
d10 1
a10 1
REVISION =	2
@


1.27
log
@Fix after pangox removal from devel/pango.
ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2012/09/01 14:35:06 landry Exp $
d10 1
a10 1
REVISION =	1
a47 3

# EXTRA_DSO_LDOPTS += -lpangox-1.0
RUN_DEPENDS +=		devel/pangox-compat
@


1.26
log
@Garge collect nsSound.cpp, the original one uses libcanberra
properly and thus sndio. Bump corresponding REVISIONs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/08/06 11:14:39 naddy Exp $
d10 1
a10 1
REVISION =	0
d48 3
@


1.25
log
@remove USE_GROFF from ports that don't install any man pages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/06/11 15:34:37 landry Exp $
d10 1
@


1.24
log
@Update to fennec 10.0.5esr
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/04/30 15:40:31 landry Exp $
a33 1
USE_GROFF =	Yes
@


1.23
log
@Update to fennec 10.0.4. There likely wont be any releases from newer
branches, since desktop fennec is abandoned in favor of fennec with
native ui on android (hence, not targeted at other oses...)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2012/04/24 17:21:42 espie Exp $
d5 1
a5 1
MOZILLA_VERSION =	10.0.4esr
@


1.22
log
@missed bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2012/03/16 22:05:40 landry Exp $
d5 2
a6 2
MOZILLA_VERSION =	10.0.2
MOZILLA_BRANCH =	release
d9 1
a9 1
REVISION =	2
@


1.21
log
@Bump after mozilla.port.mk dependency change.
Note that firefox mobile/fennec doesnt follow the mozilla release train
this time, they're working hard on getting the native android UI, per
https://blog.mozilla.com/futurereleases/2012/01/25/bringing-android-native-firefox-to-beta/
(we'll see what are the consequences for building on gtk...)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2012/03/08 12:13:00 ajacoutot Exp $
d9 1
a9 1
REVISION =	1
@


1.20
log
@Garbage collect the /dev/arandom patches.

from Brad
ok landry@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2012/02/20 20:21:43 landry Exp $
d9 1
a9 2

REVISION =	0
@


1.19
log
@Update to fennec/firefox mobile 10.0.2.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2012/01/11 02:17:13 nigel Exp $
d10 1
@


1.18
log
@Update fennec to 9.0
Change for macppc from mpi@@

Ok landry@@ stsp@@ mpi@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/12/15 23:09:44 nigel Exp $
d5 1
a5 1
MOZILLA_VERSION =	9.0
d11 1
a11 1
SO_VERSION =	5.0
@


1.17
log
@always build without gconf

Ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/12/08 00:42:54 nigel Exp $
d5 1
a5 1
MOZILLA_VERSION =	8.0
a8 1
REVISION =		0
d11 1
a11 1
SO_VERSION =	4.0
d25 1
@


1.16
log
@Update fennec v7.0.1 to v8.0 sent to ports@@ for review.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/10/28 13:09:26 robert Exp $
d9 1
d40 1
@


1.15
log
@fix after nspr fix and enable vswprintf support
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/10/03 21:08:12 landry Exp $
d5 1
a5 1
MOZILLA_VERSION =	7.0.1
a9 1
REVISION =		0
d11 1
a11 1
SO_VERSION =	3.0
@


1.14
log
@Update to fennec/firefox mobile 7.0.1.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/09/16 12:00:06 espie Exp $
d9 2
@


1.13
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/09/06 19:45:34 landry Exp $
d5 1
a5 1
MOZILLA_VERSION =	6.0.2
a8 1
REVISION=	0
d10 1
a10 1
SO_VERSION =	2.0
@


1.12
log
@Security update to fennec 6.0.2.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/08/24 06:19:51 landry Exp $
d9 1
@


1.11
log
@s/_MOZ_PROJECT_SHORT/MOZILLA_PROJECT/ when installing desktop file.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/08/23 20:55:53 landry Exp $
d5 1
a5 1
MOZILLA_VERSION =	6.0
@


1.10
log
@Update to fennec/firefox mobile 6.0.
Remove patches merged upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/08/23 08:38:13 landry Exp $
d76 2
a77 2
	${SUBST_CMD} -o ${SHAREOWN} -g ${SHAREGRP} -c ${FILESDIR}/${_MOZ_PROJECT_SHORT}.desktop \
		${PREFIX}/share/applications/${_MOZ_PROJECT_SHORT}.desktop ; \
@


1.9
log
@Add ftp://ftp.mozilla.org as backup MASTER_SITES to still be able to
fetch 'old' releases phased out of mirrors. Prodded by espie@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2011/07/30 07:55:53 landry Exp $
d5 2
a6 2
MOZILLA_VERSION =	5.0
MOZILLA_BRANCH =	mobile-${MOZILLA_VERSION}
a8 1
REVISION =	0
d10 1
a10 2
SO_VERSION =	1.0
NSS_SO_VERSION =	27.0
@


1.8
log
@Security fix for CVE-2011-2691 backported from png 1.4.8, from naddy@@.
(forgotten in previous commit..)
See https://bugzilla.mozilla.org/show_bug.cgi?id=669863 for details.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2011/06/28 22:01:17 landry Exp $
d25 2
a26 1
MASTER_SITES =	http://releases.mozilla.org/pub/mozilla.org/mobile/releases/${MOZILLA_VERSION}/source/
@


1.7
log
@Update to fennec/firefox for mobile 5.0, sync patches from www/mozilla-firefox..
Tested on amd64 and macppc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2011/06/08 18:15:29 rpointel Exp $
d9 1
@


1.6
log
@bump after default python version switch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2011/05/04 12:15:33 landry Exp $
d5 2
a6 2
MOZILLA_VERSION =	4.0.1
MOZILLA_BRANCH =	2.1
a8 1
REVISION =	2
d10 1
a10 1
SO_VERSION =	0.0
d37 1
a37 1
CONFIGURE_ARGS +=	--enable-official-branding --disable-install-strip
d59 3
@


1.5
log
@Ensure mozilla-firefox and fennec depends on the cairo lib with tee
backend enabled.
ok/discussed with dcoppa@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2011/05/04 08:11:15 dcoppa Exp $
d9 1
a9 1
REVISION =	1
@


1.4
log
@Build firefox4 and fennec against systemwide cairo.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2011/05/03 11:11:37 landry Exp $
d9 1
a9 1
REVISION =	0
d47 2
@


1.3
log
@Update to fennec 4.0.1.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2011/04/14 15:55:19 jasper Exp $
d9 1
@


1.2
log
@don't use ``rm -f'' for remove unneeded files.
this will remember us, when not needed anymore this treatment.

from gleydson soares
ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2011/04/12 19:48:57 landry Exp $
d5 1
a5 1
MOZILLA_VERSION =	4.0
a8 2
# XXX rc1 is the final release
DISTNAME =	${MOZILLA_PROJECT}-${MOZILLA_VERSION}rc1.source
d59 1
a59 1
	rm ${WRKSRC}/services/crypto/modules/WeaveCrypto.js.{orig,beforesubst}
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.174 2011/04/05 09:00:42 landry Exp $
d61 1
a61 1
	rm -f ${WRKSRC}/services/crypto/modules/WeaveCrypto.js.{orig,beforesubst}
@


1.1.1.1
log
@Import fennec 4.0:

Firefox for mobile (codenamed Fennec) is the name of the build of the
Mozilla Firefox web browser for devices such as mobile phones and
personal digital assistants (PDAs).
While it initially targets android and maemo, it also works on desktop
machines, and can be useful on small screens or low-powered devices.

Looks ok to jasper@@
@
text
@@
