head	1.39;
access;
symbols
	OPENBSD_5_1_BASE:1.25
	OPENBSD_5_1:1.25.0.2
	OPENBSD_5_0:1.17.0.2
	OPENBSD_5_0_BASE:1.17
	OPENBSD_4_9:1.6.0.2
	OPENBSD_4_9_BASE:1.6
	jasper_20102812:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.39
date	2012.05.23.15.13.41;	author jasper;	state dead;
branches;
next	1.38;

1.38
date	2012.05.15.17.37.34;	author jasper;	state Exp;
branches;
next	1.37;

1.37
date	2012.05.10.18.29.52;	author sthen;	state Exp;
branches;
next	1.36;

1.36
date	2012.05.09.06.37.49;	author jasper;	state Exp;
branches;
next	1.35;

1.35
date	2012.05.08.15.38.01;	author sthen;	state Exp;
branches;
next	1.34;

1.34
date	2012.05.07.20.11.47;	author jasper;	state Exp;
branches;
next	1.33;

1.33
date	2012.05.05.15.29.27;	author sthen;	state Exp;
branches;
next	1.32;

1.32
date	2012.05.03.17.16.27;	author rpointel;	state Exp;
branches;
next	1.31;

1.31
date	2012.04.12.10.16.50;	author sthen;	state Exp;
branches;
next	1.30;

1.30
date	2012.03.26.20.53.32;	author sthen;	state Exp;
branches;
next	1.29;

1.29
date	2012.03.15.22.05.51;	author sthen;	state Exp;
branches;
next	1.28;

1.28
date	2012.03.15.21.23.43;	author sthen;	state Exp;
branches;
next	1.27;

1.27
date	2012.03.03.10.58.00;	author sthen;	state Exp;
branches;
next	1.26;

1.26
date	2012.02.17.15.38.47;	author sthen;	state Exp;
branches;
next	1.25;

1.25
date	2012.01.24.10.03.55;	author sthen;	state Exp;
branches
	1.25.2.1;
next	1.24;

1.24
date	2012.01.10.14.35.55;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2012.01.05.20.36.53;	author jeremy;	state Exp;
branches;
next	1.22;

1.22
date	2011.12.21.09.56.54;	author sthen;	state Exp;
branches;
next	1.21;

1.21
date	2011.12.20.14.50.54;	author sthen;	state Exp;
branches;
next	1.20;

1.20
date	2011.12.18.13.37.35;	author sthen;	state Exp;
branches;
next	1.19;

1.19
date	2011.12.07.12.18.01;	author sthen;	state Exp;
branches;
next	1.18;

1.18
date	2011.09.16.12.00.07;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2011.06.29.18.44.07;	author jasper;	state Exp;
branches;
next	1.16;

1.16
date	2011.06.08.18.15.29;	author rpointel;	state Exp;
branches;
next	1.15;

1.15
date	2011.06.02.07.21.14;	author robert;	state Exp;
branches;
next	1.14;

1.14
date	2011.05.31.07.55.16;	author robert;	state Exp;
branches;
next	1.13;

1.13
date	2011.05.21.20.32.54;	author sthen;	state Exp;
branches;
next	1.12;

1.12
date	2011.04.29.07.41.15;	author jasper;	state Exp;
branches;
next	1.11;

1.11
date	2011.04.28.22.02.44;	author jasper;	state Exp;
branches;
next	1.10;

1.10
date	2011.04.12.10.32.49;	author jasper;	state Exp;
branches;
next	1.9;

1.9
date	2011.03.30.20.54.13;	author jasper;	state Exp;
branches;
next	1.8;

1.8
date	2011.03.30.19.54.29;	author jasper;	state Exp;
branches;
next	1.7;

1.7
date	2011.03.02.06.29.44;	author jasper;	state Exp;
branches;
next	1.6;

1.6
date	2011.01.03.10.22.29;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2010.12.30.08.54.52;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2010.12.29.17.49.41;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2010.12.29.15.06.48;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2010.12.29.12.24.39;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2010.12.28.18.19.28;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.12.28.18.19.28;	author jasper;	state Exp;
branches;
next	;

1.25.2.1
date	2012.05.07.20.04.09;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.39
log
@be gone, you belong in lang/ now.
@
text
@# $OpenBSD: Makefile,v 1.38 2012/05/15 17:37:34 jasper Exp $

# XXX:
# - Needs __ARM_NR_cacheflush (or the like) to work on arm-based ports.
# - Needs bundled libcares as arpa/nameser.h does not include ns_t_a.

ONLY_FOR_ARCHS=	amd64 i386

COMMENT=	V8 JavaScript for clients and servers

NODE_VERSION=	v0.6.18
DISTNAME=	node-${NODE_VERSION}
PKGNAME=	${DISTNAME:S/v//g}

CATEGORIES=	www devel

HOMEPAGE=	http://nodejs.org/

MAINTAINER=	Aaron Bieber <deftly@@gmail.com>

# MIT
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MASTER_SITES=	${HOMEPAGE}dist/${NODE_VERSION}/

MODULES=	lang/python

VMEM_WARNING=	Yes

WANTLIB +=	c crypto execinfo kvm m pthread ssl stdc++ util z

LIB_DEPENDS=	devel/libexecinfo

USE_GMAKE=	Yes

# node-gyp uses it at runtime
RUN_DEPENDS=	devel/gmake \
		sysutils/flock

MODPY_ADJ_FILES=wscript \
		tools/node-waf \
		tools/waf-light

REGRESS_TARGET= test
CONFIGURE_STYLE= simple

SUBST_VARS+=	CFLAGS
SUBST_VARS+= 	PREFIX
SUBST_VARS+= 	DISTFILES

MAKE_ENV+=	CXX=c++ CCFLAGS+="${CFLAGS}" CXXFLAGS="${CXXFLAGS}"

NO_CCACHE=	Yes

pre-configure:
	@@# Bad practice, but prevents a whole stack of patches.
	ln -sf ${LOCALBASE}/bin/python${MODPY_VERSION} ${WRKDIR}/bin/python
	${SUBST_CMD} ${WRKDIST}/lib/module.js \
		${WRKDIST}/deps/npm/node_modules/node-gyp/lib/configure.js \
		${WRKDIST}/deps/npm/node_modules/node-gyp/lib/install.js

post-install:
	${MODPY_BIN} ${MODPY_LIBDIR}/compileall.py \
		${PREFIX}/lib/node/wafadmin
	${INSTALL_DATA} ${FULLDISTDIR}/${DISTFILES} \
		${PREFIX}/lib/node/${DISTFILES}


.include <bsd.port.mk>
@


1.38
log
@- update to 0.6.18

ok MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2012/05/10 18:29:52 sthen Exp $
@


1.37
log
@tweaks to node:

- install tar.gz source, and patch node-gyp to use it rather than
attempting to download from the 'net when building a native extension,
from Aaron Bieber (maintainer).

- set V=1 in node-gyp to avoid hiding compiler command lines
(from me, ok jasper).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2012/05/09 06:37:49 jasper Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.17
a13 1
REVISION=	3
@


1.36
log
@- Allow building of sub-packages (ie. node-sqlite3) with USE_SYSTRACE
set, also prevents downloading of the node distfile again.

from MAINTAINER

- add run dependency on sysutils/flock.

now node-sqlite3 builds fine.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2012/05/08 15:38:01 sthen Exp $
d14 1
a14 1
REVISION=	2
d52 2
a53 1
SUBST_VARS+= 	DISTDIR
d69 2
@


1.35
log
@Fix node-gyp for native builds by using gmake (and add a run dep).
From Aaron Bieber, I also added a comment to the RUN_DEPENDS line.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2012/05/07 20:11:47 jasper Exp $
d14 1
a14 1
REVISION=	1
d40 3
a42 1
RUN_DEPENDS=	devel/gmake # node-gyp uses it at runtime
d52 1
d62 2
a63 1
		${WRKDIST}/deps/npm/node_modules/node-gyp/lib/configure.js
@


1.34
log
@Make sure node-gyp is able to find a python executable.

ok MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2012/05/05 15:29:27 sthen Exp $
d14 1
a14 1
REVISION=	0
d39 2
@


1.33
log
@update to Node.js 0.6.17, from maintainer Aaron Bieber

* Upgrade npm to 1.1.21
* uv: Add support for EROFS errors (Ben Noordhuis, Maciej Ma≈Çecki)
* uv: Add support for EIO and ENOSPC errors (Fedor Indutny)
* http: Fix client memory leaks (isaacs, Vincent Voyer)
* fs: fix file descriptor leak in sync functions (Ben Noordhuis)
* fs: fix ReadStream / WriteStream double close bug (Ben Noordhuis)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2012/05/03 17:16:27 rpointel Exp $
d14 1
d56 2
a57 1
	${SUBST_CMD} ${WRKDIST}/lib/module.js
@


1.32
log
@Update node to 0.6.16, from Aaron Bieber (maintainer).
ok jasper@@, sthen@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2012/04/12 10:16:50 sthen Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.16
@


1.31
log
@update to node 0.6.15, from Aaron Bieber

- Thanks for the great book Aaron!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2012/03/26 20:53:32 sthen Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.15
@


1.30
log
@update to node.js 0.6.14, from maintainer Aaron Bieber.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2012/03/15 22:05:51 sthen Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.14
@


1.29
log
@update to node.js 0.6.13; mainly npm fixes. From maintainer Aaron Bieber.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2012/03/15 21:23:43 sthen Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.13
@


1.28
log
@bytecode-compile the wafadmin python files, ok Aaron Bieber (maintainer).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2012/03/03 10:58:00 sthen Exp $
d11 1
a11 2
NODE_VERSION=	v0.6.12
REVISION=	0
@


1.27
log
@update to node.js 0.6.12, from maintainer Aaron Bieber
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2012/02/17 15:38:47 sthen Exp $
d12 1
d57 5
@


1.26
log
@update to node 0.6.10, from maintainer Aaron Bieber
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/01/24 10:03:55 sthen Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.10
@


1.25
log
@update to node 0.6.8 from maintainer Aaron Bieber
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/01/10 14:35:55 sthen Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.8
@


1.25.2.1
log
@Security fix for potential header spoofing attacks, as described in
http://blog.nodejs.org/2012/05/07/http-server-security-vulnerability-please-upgrade-to-0-6-17/

ok MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/01/24 10:03:55 sthen Exp $
a13 1
REVISION=	0
@


1.24
log
@- update to node.js 0.67, from maintainer Aaron Bieber
- fix following kinfo_proc2 removal
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/01/05 20:36:53 jeremy Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.7
@


1.23
log
@Add LOCALBASE/lib/node_modules to the list of directories to check
for modules, since that is the location where npm installs modules
globally.  Removes the need to use npm link to link global modules
into each project.

OK Aaron Bieber (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2011/12/21 09:56:54 sthen Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.6
a13 1
REVISION=	0
@


1.22
log
@update to node 0.6.6, from maintainer Aaron Bieber
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2011/12/20 14:50:54 sthen Exp $
d14 1
d56 1
@


1.21
log
@add Aaron Bieber as MAINTAINER.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2011/12/18 13:37:35 sthen Exp $
d11 1
a11 2
NODE_VERSION=	v0.6.5
REVISION=	0
@


1.20
log
@update to node 0.6.5, from Aaron Bieber, discussed with jasper@@ and schwarze@@
- also sync WANTLIB (now pulls in libz)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2011/12/07 12:18:01 sthen Exp $
d12 1
d19 2
@


1.19
log
@update to node 0.6.3, parts from Aaron Bieber
(further update 0.6.5 to be done soonish, but let's get this in first)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2011/09/16 12:00:07 espie Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.3
d31 1
a31 1
WANTLIB +=	c crypto execinfo kvm m pthread ssl stdc++ util
@


1.18
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/06/29 18:44:07 jasper Exp $
d11 2
a12 2
DISTNAME=	node-v0.4.9
REVISION=	0
d25 1
a25 1
MASTER_SITES=	${HOMEPAGE}/dist/
d31 1
a31 1
WANTLIB +=	c crypto execinfo ev kvm m pthread ssl stdc++ util
d33 1
a33 2
LIB_DEPENDS=	devel/libev \
		devel/libexecinfo
d35 1
a35 3
CONFIGURE_STYLE=	simple
CONFIGURE_ARGS+=	--shared-libev-libpath="${LOCALBASE}/lib" \
			--shared-libev-include="${LOCALBASE}/include"
d41 2
a42 2
# These don't require complete rebuilds of the tree
REGRESS_TARGET= test-message test-simple test-pummel test-internet
d51 1
a51 4
	${SUBST_CMD} ${WRKSRC}/wscript \
			${WRKSRC}/Makefile \
			${WRKSRC}/tools/wafadmin/Tools/python.py
	# Bad practice, but prevents a whole stack of patches.
@


1.17
log
@- bugfix update to 0.4.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/06/08 18:15:29 rpointel Exp $
d12 1
@


1.16
log
@bump after default python version switch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/06/02 07:21:14 robert Exp $
d11 1
a11 1
DISTNAME=	node-v0.4.8
a13 2
REVISION=	2

d49 2
@


1.15
log
@Instead of reserving 32MB of virtual memory let's reserve the quarter of
RLIMIT_DATA (ulimit -d) if RLIMIT_DATA is not 0 (unlimited).
If RLIMIT_DATA is 0 then the default 512MB reservation will be used.
Using 32MB made v8 use less memory for sure but it was a huge performance
loss too.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/05/31 07:55:16 robert Exp $
d14 1
a14 1
REVISION=	1
@


1.14
log
@Make v8 pre-allocate at least 32M of virtual memory to avoid
crashing with vmmap. This is needed because of their JIT is
not fully 64-bit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/05/21 20:32:54 sthen Exp $
d14 1
a14 1
REVISION=	0
@


1.13
log
@- update node to 0.4.8

- pull across a patch from www/chromium to use the same memory allocation
policy on amd64 as is currently used on i386, this seriously reduces the
amount of virtual memory required
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/04/29 07:41:15 jasper Exp $
d14 2
d21 3
a23 3
PERMIT_PACKAGE_CDROM=	Yes 
PERMIT_PACKAGE_FTP=	Yes 
PERMIT_DISTFILES_CDROM=	Yes 
@


1.12
log
@Zap zoom zoom (-O3)

prompted by zthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/04/28 22:02:44 jasper Exp $
d11 1
a11 1
DISTNAME=	node-v0.4.7
a12 1
REVISION=	0
@


1.11
log
@- update to 0.4.7

i386 build test by sthen@@, thanks
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/04/12 10:32:49 jasper Exp $
d13 1
@


1.10
log
@- update to 0.4.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/03/30 20:54:13 jasper Exp $
d11 1
a11 1
DISTNAME=	node-v0.4.5
@


1.9
log
@hookup some regression tests
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2011/03/30 19:54:29 jasper Exp $
d11 1
a11 1
DISTNAME=	node-v0.4.4
@


1.8
log
@- update node to 0.4.4 with various patches from chrome to make this build
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2011/03/02 06:29:44 jasper Exp $
d43 2
a44 1
NO_REGRESS=	Yes
d52 1
@


1.7
log
@- the issues some people have been seeing with the build crashing in v8, is
related to too low limits, so remove the comment and set VMEM_WARNING instead.

(ports is unlocked, but no new files/directories/imports!, if in doubt, ask!)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2011/01/03 10:22:29 jasper Exp $
d11 1
a11 1
DISTNAME=	node-v0.2.6
d30 1
a30 1
WANTLIB +=	c crypto execinfo ev kvm m pthread ssl stdc++ z
d40 1
a40 1
		bin/node-waf \
a47 4

post-extract:
	rm -f ${WRKSRC}/deps/v8/src/SConscript.orig \
		${WRKSRC}/deps/v8/src/platform.h.orig
@


1.6
log
@- update node.js to 0.2.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/12/30 08:54:52 jasper Exp $
a3 1
# - Build fails on some amd64 machines?
d27 2
@


1.5
log
@Enable node and add a note as to why it's using the bundled libcares
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/12/29 17:49:41 jasper Exp $
d12 1
a12 1
DISTNAME=	node-v0.2.5
@


1.4
log
@- this won't work on ARM untill __ARM_NR_cacheflush is implemented/worked-around in the v8 code.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/12/29 15:06:48 jasper Exp $
d5 2
@


1.3
log
@- honor CXXFLAGS with this utterly retarded and stupid "build system"
(though this fix was simple, i take every opportunity to rant at scons)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/12/29 12:24:39 jasper Exp $
a4 1
# - Test on ARM.
@


1.2
log
@- don't link with -lpthread
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/12/28 18:19:28 jasper Exp $
a4 1
# - Honor CXXFLAGS.
d45 1
a45 1
MAKE_ENV+=	CXX=c++ CCFLAGS+="${CFLAGS}" CXXFLAGS+="${CXXFLAGS}"
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
a3 1
# - mksnapshot links with -lpthread.
@


1.1.1.1
log
@import WIP node.js 0.2.5

Node.js is an evented I/O framework for the V8 JavaScript engine. It is
intended for writing scalable network programs such as web servers.

As there are still some issues to resolve, this won't be hooked up yet.

ok landry@@ 
@
text
@@
