head	1.5;
access;
symbols;
locks; strict;
comment	@# @;


1.5
date	2012.05.23.15.13.41;	author jasper;	state dead;
branches;
next	1.4;

1.4
date	2012.05.10.18.29.52;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2012.05.09.15.33.23;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2012.05.09.15.32.25;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2012.05.08.15.38.01;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.5
log
@be gone, you belong in lang/ now.
@
text
@$OpenBSD: patch-deps_npm_node_modules_node-gyp_lib_build_js,v 1.4 2012/05/10 18:29:52 sthen Exp $
--- deps/npm/node_modules/node-gyp/lib/build.js.orig	Fri May  4 21:12:52 2012
+++ deps/npm/node_modules/node-gyp/lib/build.js	Thu May 10 19:05:18 2012
@@@@ -11,13 +11,15 @@@@ var fs = require('graceful-fs')
   , which = require('which')
   , mkdirp = require('./util/mkdirp')
   , win = process.platform == 'win32'
+  , openbsd = process.platform == 'openbsd'
 
 exports.usage = 'Invokes `' + (win ? 'msbuild' : 'make') + '` and builds the module'
 
 function build (gyp, argv, callback) {
 
   gyp.verbose('build args', argv)
-  var command = win ? 'msbuild' : 'make'
+  var builder = openbsd ? 'gmake' : 'make' 
+  var command = win ? 'msbuild' : builder
     , buildDir = path.resolve('build')
     , configPath = path.resolve(buildDir, 'config.gypi')
     , buildType
@@@@ -181,6 +183,8 @@@@ function build (gyp, argv, callback) {
       argv.push('/p:Configuration=' + buildType + ';Platform=' + p)
     } else {
       argv.push('BUILDTYPE=' + buildType)
+      // Don't hide compiler commands
+      argv.push('V=1')
       // Invoke the Makefile in the 'build' dir.
       argv.push('-C')
       argv.push('build')
@


1.4
log
@tweaks to node:

- install tar.gz source, and patch node-gyp to use it rather than
attempting to download from the 'net when building a native extension,
from Aaron Bieber (maintainer).

- set V=1 in node-gyp to avoid hiding compiler command lines
(from me, ok jasper).
@
text
@d1 1
a1 1
$OpenBSD: patch-deps_npm_node_modules_node-gyp_lib_build_js,v 1.3 2012/05/09 15:33:23 sthen Exp $
@


1.3
log
@oops revert unintentional commit
@
text
@d1 3
a3 3
$OpenBSD: patch-deps_npm_node_modules_node-gyp_lib_build_js,v 1.1 2012/05/08 15:38:01 sthen Exp $
--- deps/npm/node_modules/node-gyp/lib/build.js.orig	Mon May  7 19:33:03 2012
+++ deps/npm/node_modules/node-gyp/lib/build.js	Mon May  7 19:33:59 2012
d21 9
@


1.2
log
@when generating PKGNAME from NPM_NAME, strip a leading node- so we don't
double it. ok jasper@@
@
text
@d2 2
a3 2
--- deps/npm/node_modules/node-gyp/lib/build.js.orig	Fri May  4 21:12:52 2012
+++ deps/npm/node_modules/node-gyp/lib/build.js	Wed May  9 09:26:31 2012
a20 9
@@@@ -181,6 +183,8 @@@@ function build (gyp, argv, callback) {
       argv.push('/p:Configuration=' + buildType + ';Platform=' + p)
     } else {
       argv.push('BUILDTYPE=' + buildType)
+      // Don't hide compiler commands
+      argv.push('V=1')
       // Invoke the Makefile in the 'build' dir.
       argv.push('-C')
       argv.push('build')
@


1.1
log
@Fix node-gyp for native builds by using gmake (and add a run dep).
From Aaron Bieber, I also added a comment to the RUN_DEPENDS line.
@
text
@d1 3
a3 3
$OpenBSD$
--- deps/npm/node_modules/node-gyp/lib/build.js.orig	Mon May  7 19:33:03 2012
+++ deps/npm/node_modules/node-gyp/lib/build.js	Mon May  7 19:33:59 2012
d21 9
@

