head	1.2;
access;
symbols
	OPENBSD_5_7:1.1.0.2
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2015.03.30.03.01.51;	author bentley;	state dead;
branches;
next	1.1;
commitid	6FMbIblumRVSRK0T;

1.1
date	2014.10.13.09.29.20;	author bentley;	state Exp;
branches;
next	;
commitid	bVM2NdZD9FlJaD2A;


desc
@@


1.2
log
@Update to netsurf-3.3.

Changelog at:
http://download.netsurf-browser.org/netsurf/releases/ChangeLog.txt

ok landry@@
@
text
@$OpenBSD: patch-content_fetchers_curl_c,v 1.1 2014/10/13 09:29:20 bentley Exp $
memcpy and terminate from openssl buffers.
Fixes crash on certain invalid SSL certificates.

From upstream commit c695d3d0074687e767b68ca9d1412a5bc5303178
--- content/fetchers/curl.c.orig	Tue Aug 26 08:57:21 2014
+++ content/fetchers/curl.c	Thu Sep  4 00:03:08 2014
@@@@ -921,10 +921,12 @@@@ void fetch_curl_done(CURL *curl_handle, CURLcode resul
 			BIO_get_mem_ptr(mem, &buf);
 			(void) BIO_set_close(mem, BIO_NOCLOSE);
 			BIO_free(mem);
-			snprintf(ssl_certs[i].not_before,
-					min(sizeof ssl_certs[i].not_before,
-						(unsigned) buf->length + 1),
-					"%s", buf->data);
+			memcpy(ssl_certs[i].not_before,
+			       buf->data,
+			       min(sizeof(ssl_certs[i].not_before) - 1,
+				   (unsigned)buf->length));
+			ssl_certs[i].not_before[min(sizeof(ssl_certs[i].not_before) - 1,
+						    (unsigned)buf->length)] = 0;
 			BUF_MEM_free(buf);
 
 			mem = BIO_new(BIO_s_mem());
@@@@ -933,10 +935,13 @@@@ void fetch_curl_done(CURL *curl_handle, CURLcode resul
 			BIO_get_mem_ptr(mem, &buf);
 			(void) BIO_set_close(mem, BIO_NOCLOSE);
 			BIO_free(mem);
-			snprintf(ssl_certs[i].not_after,
-					min(sizeof ssl_certs[i].not_after,
-						(unsigned) buf->length + 1),
-					"%s", buf->data);
+			memcpy(ssl_certs[i].not_after,
+			       buf->data,
+			       min(sizeof(ssl_certs[i].not_after) - 1,
+				   (unsigned)buf->length));
+			ssl_certs[i].not_after[min(sizeof(ssl_certs[i].not_after) - 1,
+						 (unsigned)buf->length)] = 0;
+
 			BUF_MEM_free(buf);
 
 			ssl_certs[i].sig_type =
@@@@ -952,24 +957,30 @@@@ void fetch_curl_done(CURL *curl_handle, CURLcode resul
 			BIO_get_mem_ptr(mem, &buf);
 			(void) BIO_set_close(mem, BIO_NOCLOSE);
 			BIO_free(mem);
-			snprintf(ssl_certs[i].issuer,
-					min(sizeof ssl_certs[i].issuer,
-						(unsigned) buf->length + 1),
-					"%s", buf->data);
+			memcpy(ssl_certs[i].issuer,
+			       buf->data,
+			       min(sizeof(ssl_certs[i].issuer) - 1,
+				   (unsigned) buf->length));
+			ssl_certs[i].issuer[min(sizeof(ssl_certs[i].issuer) - 1,
+						(unsigned) buf->length)] = 0;
 			BUF_MEM_free(buf);
 
 			mem = BIO_new(BIO_s_mem());
 			X509_NAME_print_ex(mem,
 				X509_get_subject_name(certs[i].cert),
-				0, XN_FLAG_SEP_CPLUS_SPC |
-					XN_FLAG_DN_REV | XN_FLAG_FN_NONE);
+					   0,
+					   XN_FLAG_SEP_CPLUS_SPC |
+					   XN_FLAG_DN_REV |
+					   XN_FLAG_FN_NONE);
 			BIO_get_mem_ptr(mem, &buf);
 			(void) BIO_set_close(mem, BIO_NOCLOSE);
 			BIO_free(mem);
-			snprintf(ssl_certs[i].subject,
-					min(sizeof ssl_certs[i].subject,
-						(unsigned) buf->length + 1),
-					"%s", buf->data);
+			memcpy(ssl_certs[i].subject,
+			       buf->data,
+			       min(sizeof(ssl_certs[i].subject) - 1,
+				   (unsigned)buf->length));
+			ssl_certs[i].subject[min(sizeof(ssl_certs[i].subject) - 1,
+						 (unsigned) buf->length)] = 0;
 			BUF_MEM_free(buf);
 
 			ssl_certs[i].cert_type =
@


1.1
log
@Update to netsurf-3.2 (and associated libraries).

While here, fix regression tests in hubbub (broken since json-c update).

ok landry@@
@
text
@d1 1
a1 1
$OpenBSD$
@

