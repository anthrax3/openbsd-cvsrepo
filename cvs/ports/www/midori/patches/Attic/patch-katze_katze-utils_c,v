head	1.2;
access;
symbols
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2010.03.23.20.56.55;	author landry;	state dead;
branches;
next	1.1;

1.1
date	2010.01.19.14.25.08;	author landry;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to midori 0.2.4, remove a patch merged upstream.
(As a sidenode, this version fixes the timeouts i was seeing with google maps)
@
text
@$OpenBSD: patch-katze_katze-utils_c,v 1.1 2010/01/19 14:25:08 landry Exp $
Fix use-after-free and memory leak for icon_uri
--- katze/katze-utils.c.orig	Tue Dec 15 13:34:29 2009
+++ katze/katze-utils.c	Sat Jan 16 22:57:24 2010
@@@@ -1452,17 +1452,18 @@@@ katze_load_cached_icon (const gchar* uri,
             i++;
         if (uri[i] == '/')
         {
-            icon_uri = g_strdup (uri);
-            icon_uri[i] = '\0';
-            icon_uri = g_strdup_printf ("%s/favicon.ico", icon_uri);
+            gchar *ticon_uri = g_strdup (uri);
+            ticon_uri[i] = '\0';
+            icon_uri = g_strdup_printf ("%s/favicon.ico", ticon_uri);
+            g_free(ticon_uri);
         }
         else
             icon_uri = g_strdup_printf ("%s/favicon.ico", uri);
 
         checksum = g_compute_checksum_for_string (G_CHECKSUM_MD5, icon_uri, -1);
         ext = g_strrstr (icon_uri, ".");
-        g_free (icon_uri);
         filename = g_strdup_printf ("%s%s", checksum, ext ? ext : "");
+        g_free (icon_uri);
         g_free (checksum);
         path = g_build_filename (g_get_user_cache_dir (), PACKAGE_NAME,
                                  "icons", filename, NULL);
@


1.1
log
@Add a patch to fix a use-after-free & a memory leak, from canacar@@.
Fwded' and commited upstream.
ok jasper@@ sthen@@ no objection ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD$
@

