head	1.36;
access;
symbols
	OPENBSD_5_8:1.31.0.4
	OPENBSD_5_8_BASE:1.31
	OPENBSD_5_7:1.25.0.2
	OPENBSD_5_7_BASE:1.25
	OPENBSD_5_6:1.21.0.2
	OPENBSD_5_6_BASE:1.21
	OPENBSD_5_5:1.5.0.2
	OPENBSD_5_5_BASE:1.5;
locks; strict;
comment	@# @;


1.36
date	2015.09.10.13.00.10;	author sthen;	state dead;
branches;
next	1.35;
commitid	vagA8GU9rOjsV69E;

1.35
date	2015.09.04.21.38.46;	author sthen;	state Exp;
branches;
next	1.34;
commitid	Y0p1claWaqsvZjCU;

1.34
date	2015.08.28.21.43.50;	author sthen;	state Exp;
branches;
next	1.33;
commitid	wjQiATHLnOEoRzTM;

1.33
date	2015.08.25.07.30.29;	author ajacoutot;	state Exp;
branches;
next	1.32;
commitid	x3rR2VHR7RvISfgT;

1.32
date	2015.08.11.21.54.55;	author sthen;	state Exp;
branches;
next	1.31;
commitid	e01IbZ2B9qIQWMyQ;

1.31
date	2015.07.06.13.43.06;	author sthen;	state Exp;
branches
	1.31.4.1;
next	1.30;
commitid	mn8lrQNk1QmS1eWZ;

1.30
date	2015.06.11.14.57.30;	author sthen;	state Exp;
branches;
next	1.29;
commitid	nX6rh9h06dwKgpcl;

1.29
date	2015.05.28.10.17.25;	author pascal;	state Exp;
branches;
next	1.28;
commitid	020U4lCPk8wUkCOz;

1.28
date	2015.05.04.11.04.24;	author sthen;	state Exp;
branches;
next	1.27;
commitid	B56rsJp1yGFIipDz;

1.27
date	2015.04.03.19.23.27;	author sthen;	state Exp;
branches;
next	1.26;
commitid	rQgxkUdPEK9NDyT2;

1.26
date	2015.03.14.21.07.04;	author sthen;	state Exp;
branches;
next	1.25;
commitid	z8fKbtFeQVFU0RZM;

1.25
date	2015.02.06.16.30.17;	author sthen;	state Exp;
branches;
next	1.24;
commitid	FyfFFK75w7rNsk5i;

1.24
date	2015.01.19.08.35.43;	author sthen;	state Exp;
branches;
next	1.23;
commitid	gXHgwcHdzqXsdMwJ;

1.23
date	2015.01.06.22.51.54;	author sthen;	state Exp;
branches;
next	1.22;
commitid	0XCssRRfuZkksjgl;

1.22
date	2014.11.17.14.02.19;	author ajacoutot;	state Exp;
branches;
next	1.21;
commitid	lrMc8yxomUudhiIj;

1.21
date	2014.07.19.22.36.13;	author ajacoutot;	state Exp;
branches;
next	1.20;
commitid	MSFt4PoL3vJ8bL97;

1.20
date	2014.07.09.14.19.58;	author ajacoutot;	state Exp;
branches;
next	1.19;
commitid	bdiG2oZmTsT2fhbi;

1.19
date	2014.06.26.21.13.47;	author sthen;	state Exp;
branches;
next	1.18;
commitid	xLqaJ1KNHyBfVyR6;

1.18
date	2014.06.26.13.08.42;	author sthen;	state Exp;
branches;
next	1.17;
commitid	NT87JHEXo5skwIoI;

1.17
date	2014.05.15.21.24.33;	author sthen;	state Exp;
branches;
next	1.16;

1.16
date	2014.05.09.10.06.46;	author sthen;	state Exp;
branches;
next	1.15;

1.15
date	2014.05.09.09.13.47;	author sthen;	state Exp;
branches;
next	1.14;

1.14
date	2014.05.07.20.52.06;	author sthen;	state Exp;
branches;
next	1.13;

1.13
date	2014.04.24.14.26.21;	author sthen;	state Exp;
branches;
next	1.12;

1.12
date	2014.04.21.23.37.55;	author sthen;	state Exp;
branches;
next	1.11;

1.11
date	2014.04.21.20.29.50;	author sthen;	state Exp;
branches;
next	1.10;

1.10
date	2014.04.13.21.41.00;	author sthen;	state Exp;
branches;
next	1.9;

1.9
date	2014.04.13.12.38.37;	author sthen;	state Exp;
branches;
next	1.8;

1.8
date	2014.04.08.12.22.48;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2014.03.16.13.15.12;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2014.03.09.20.56.44;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2014.01.27.13.38.17;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2014.01.10.20.54.27;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2013.12.10.12.09.17;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2013.12.07.10.47.29;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2013.11.15.19.09.17;	author sthen;	state Exp;
branches;
next	;

1.31.4.1
date	2015.09.30.08.55.17;	author sthen;	state Exp;
branches;
next	;
commitid	VN1IZQ0jgIF92Mmp;


desc
@@


1.36
log
@Currently Squid 3.5 is considered stable. Rather than moving snapshot/*
to stable/*, just drop back to a single version of squid in ports.
@
text
@# $OpenBSD: Makefile,v 1.35 2015/09/04 21:38:46 sthen Exp $

V=		3.5.8

# needs c++11. other parts for gcc MODULES are in ../Makefile.inc.
MODGCC4_ARCHS=	*

# uncommenting the following would use clang where possible, otherwise fallback
# to gcc, but at present linking fails with clang ("local symbol 0: discarded
# in section XXX").
#MODULES+=	lang/clang
#MODCLANG_ARCHS=	*
#MODCLANG_LANGS=	c++

EXTERNAL_ACL=	LDAP_group SQL_session file_userip time_quota \
		unix_group wbinfo_group # kerberos_ldap_group (sasl/gssapi)

CONFIGURE_ARGS=	--disable-strict-error-checking \
		--disable-arch-native \
		--enable-ssl-crtd

LIB_DEPENDS+=	security/gnutls
MODULES+=	devel/gettext
WANTLIB+=	ffi gmp gnutls hogweed p11-kit tasn1 z

BUILD_DEPENDS+=	devel/cppunit

.include <bsd.port.mk>
@


1.35
log
@update to squid-3.5.8 and reenable -ntlm subpackage while there.
(I have no way to test ntlmauth but it builds ok, reports welcome).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2015/08/28 21:43:50 sthen Exp $
@


1.34
log
@fix squid-3.5 build with OPENSSL_NO_SSL3, with help from jsing and
the src/ssl/support.cc part is borrwed from jca's diff to squid-3.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2015/08/25 07:30:29 ajacoutot Exp $
d3 1
a3 2
V=		3.5.7
REVISION=	1
@


1.33
log
@/var/run content is already removed by /etc/rc, so no need to handle that in
the package. If a /var/run/foo directory must exist for proper start of a
software, then the rc.d script should take care of it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2015/08/11 21:54:55 sthen Exp $
d4 1
a4 1
REVISION=	0
@


1.32
log
@update to squid-3.5.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2015/07/06 13:43:06 sthen Exp $
d4 1
@


1.31
log
@update to squid 3.5.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2015/06/11 14:57:30 sthen Exp $
d3 1
a3 1
V=		3.5.6
@


1.31.4.1
log
@Backport from -current: update to squid-3.5.9, fixes problems with
TLS/SSL parsing in configurations using SSL-Bump.

- int overflow with extension parsing: char << 8 into a short
http://www.squid-cache.org/Versions/v3/3.5/changesets/squid-3.5-13915.patch

- {Client,Server}Hello parsing; when checking for TLS extensions, don't
check for bytes following compression_method in the _whole_ message, only
in the *Hello part ("does not account for the fact that the message may
contain more than just ServerHello").
http://www.squid-cache.org/Versions/v3/3.5/changesets/squid-3.5-13915.patch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2015/07/06 13:43:06 sthen Exp $
d3 1
a3 1
V=		3.5.9
@


1.30
log
@update to squid-3.5.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2015/05/28 10:17:25 pascal Exp $
d3 1
a3 1
V=		3.5.5
@


1.29
log
@gcc4 bumps, reminded by aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2015/05/04 11:04:24 sthen Exp $
d3 1
a3 2
V=		3.5.4
REVISION=	0
@


1.28
log
@update to squid-3.5.4, fixing a certificate validation bypass issue
in SSL-Bump configurations using "client-first" or "bump" modes.
This does not affect configurations that don't use SSL-Bump (this is
not something you are likely to have enabled by accident as it needs
fairly significant configuration).

http://www.squid-cache.org/Advisories/SQUID-2015_1.txt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2015/04/03 19:23:27 sthen Exp $
d4 1
@


1.27
log
@update to squid-3.5.3, upstream have rolled in patches to build with libressl
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2015/03/14 21:07:04 sthen Exp $
d3 1
a3 1
V=		3.5.3
d6 1
a6 1
MODGCC_ARCHS=	*
@


1.26
log
@update to squid-3.5.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2015/02/06 16:30:17 sthen Exp $
d3 1
a3 1
V=		3.5.2
d15 1
a15 1
EXTERNAL_ACL=	LDAP_group SQL_session file_userip time_quota session \
a25 7
AUTOCONF_VERSION?= 2.69
AUTOMAKE_VERSION?= 1.14
BUILD_DEPENDS=	${MODGNU_AUTOCONF_DEPENDS} \
		${MODGNU_AUTOMAKE_DEPENDS} \
		devel/libtool

# for stable version, replace with setting ac_cv_path_CPPUNITCONFIG=false
a26 6

post-patch:
	cd ${WRKSRC}; \
	    AUTOCONF_VERSION=${AUTOCONF_VERSION} \
	    AUTOMAKE_VERSION=${AUTOMAKE_VERSION} \
	    LOCALBASE=${LOCALBASE} ./bootstrap.sh
@


1.25
log
@update squid 3.5 branch to 3.5.1 and re-enable now that the horrible
*_cipher_by_char API has been added back to libssl.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2015/01/19 08:35:43 sthen Exp $
d3 1
a3 1
V=		3.5.1
@


1.24
log
@update to squid 3.4.11
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2015/01/06 22:51:54 sthen Exp $
d3 1
a3 1
#BROKEN=		sslbump uses functions removed in libressl
d5 2
a6 1
V=		3.5.0.4
d8 6
a13 5
# future versions will be requiring c++11 support, so let's build
# the devel version in squid/snapshot with a newer compiler to get
# experience with it. (other parts in ../Makefile.inc as it's
# already required for ppc).
MODGCC4_ARCHS=	*
@


1.23
log
@update squid/snapshot to 3.5.0.4 and mark BROKEN for now
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2014/11/17 14:02:19 ajacoutot Exp $
d3 1
a3 1
BROKEN=		sslbump uses functions removed in libressl
@


1.22
log
@Bump daemon_timeout from 31 to 35. Default squid shutdown timeout is 30s,
but we may be a bit slow, so give us some room.

ok sthen@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2014/07/19 22:36:13 ajacoutot Exp $
d3 3
a5 6
D=		20140626-r13480
V=		3.5pre${D:C/-.*//}
DISTNAME=	squid-3.HEAD-$D
EXTRACT_SUFX=	.tar.bz2
REVISION=	0
REVISION-main=	2
@


1.21
log
@/etc/rc.d -> ${RCDIR}
(as pedantic and useless as /usr/local vs LOCALBASE|PREFIX but well...)

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2014/07/09 14:19:58 ajacoutot Exp $
d8 1
a8 1
REVISION-main=	1
@


1.20
log
@Drop local shutdown patch and set daemon_timeout="31".

prodded by sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2014/06/26 21:13:47 sthen Exp $
d8 1
@


1.19
log
@BUILD_DEPENDS+= works better if it's after a previous BUILD_DEPENDS
rather than before it... found my naddy (and myself earlier but I didn't
see the problem then).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2014/06/26 13:08:42 sthen Exp $
d7 1
@


1.18
log
@update squid/snapshot to squid-3.HEAD-20140626
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2014/05/15 21:24:33 sthen Exp $
a20 2
BUILD_DEPENDS+=	devel/cppunit
# alternatively set ac_cv_path_CPPUNITCONFIG=false to disable
d30 3
@


1.17
log
@disable "rock" storeio backend, it doesn't currently work on OpenBSD (creates
initial db file ok, but EMSGSIZE when trying to open at normal startup)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2014/05/09 10:06:46 sthen Exp $
d3 1
a3 1
D=		20140506-r13398
a4 1
REVISION=	0
@


1.16
log
@add a comment about ac_cv_path_CPPUNITCONFIG=false which I may switch to
instead of a build dep on cppunit when the devel version becomes stable.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2014/05/09 09:13:47 sthen Exp $
d5 1
@


1.15
log
@Add a build dependency on cppunit. Not required for Squid itself, but tests
are enabled if it's present at configure time, and junking it mid-build
causes a failure. Found by espie@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2014/05/07 20:52:06 sthen Exp $
d22 1
@


1.14
log
@update squid/stable to 3.4.5 and squid/snapshot to 20140506-r13398.
use ports/lang/gcc to build snapshot, squid will be moving to requiring
c++11 so let's build this with it already to get more experience.
squid/stable stays with base gcc for most arch for now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2014/04/24 14:26:21 sthen Exp $
d21 1
@


1.13
log
@update squid/stable to 3.4.4.2, move some now-common pieces up into
squid/Makefile.inc, and regen PLISTs with @@commented pieces from PLIST-ntlm
to avoid problems with future regens if samba is installed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2014/04/21 23:37:55 sthen Exp $
d3 1
a3 1
D=		20140413-r13351
a5 1
REVISION=	1
d8 6
d20 16
@


1.12
log
@disable ntlm subpackage for now, it depends on samba,ads
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2014/04/21 20:29:50 sthen Exp $
d6 1
a6 1
REVISION=	0
a14 7

WANTLIB-main += nettle
#WANTLIB-ntlm += nettle
WANTLIB-ldap += nettle
LIB_DEPENDS-main += security/libnettle
#LIB_DEPENDS-ntlm += security/libnettle
LIB_DEPENDS-ldap += security/libnettle
@


1.11
log
@disable kerberos
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2014/04/13 21:41:00 sthen Exp $
d17 1
a17 1
WANTLIB-ntlm += nettle
d20 1
a20 1
LIB_DEPENDS-ntlm += security/libnettle
@


1.10
log
@adjust autoconf test to check for working 64-bit atomic ops (which is not the
case on i386 without using -march=i586 or higher), and remove BROKEN-i386
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2014/04/13 12:38:37 sthen Exp $
d6 1
@


1.9
log
@update to newer snapshot of squid, and mark BROKEN-i386 for now - stable
version is unaffected. (If atomic ops are available at all, it wants 64-bit
ops; http://permalink.gmane.org/gmane.comp.web.squid.devel/22453)
@
text
@d1 1
a1 5
# $OpenBSD: Makefile,v 1.8 2014/04/08 12:22:48 sthen Exp $

BROKEN-i386=	64-bit atomic ops
# on arch where atomic ops are supported at all, squid (as of bzr rev 13201)
# needs 64-bit ops. talking to upstream.
@


1.8
log
@switch squid/stable to the 3.4 branch, and update squid/snapshot to a
recent snapshot from the 3.5 branch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2014/03/16 13:15:12 sthen Exp $
d3 7
a9 2
V=		3.5pre20140405
DISTNAME=	squid-3.HEAD-20140405-r13341
@


1.7
log
@update to squid-3.4.4, security fix for CVE-2014-0128 in HTTPS request
handling affecting users who have enabled the "ssl-bump" MITM feature.

workarounds at
http://www.squid-cache.org/Advisories/SQUID-2014_1.txt

Also includes other fixes, see changelog.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2014/03/09 20:56:44 sthen Exp $
d3 3
a5 1
V=		3.4.4
d11 9
a19 1
		--disable-arch-native
@


1.6
log
@update to squid 3.4.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2014/01/27 13:38:17 sthen Exp $
d3 1
a3 1
V=		3.4.3
@


1.5
log
@Squid 3.4's build process uses -march=native by default; disable to avoid cpu-
specific code in packages. Reported and diagnosed by Aleksandar Lazic, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2014/01/10 20:54:27 sthen Exp $
d3 1
a3 2
V=		3.4.2
REVISION=	0
@


1.4
log
@update to squid 3.4.2

3.4.x is now classed as a stable release upstream, but let's leave 3.3
around for now in squid/stable until we have more experience with 3.4 as
there have been fairly big chances to the tproxy code.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2013/12/10 12:09:17 sthen Exp $
d4 1
d9 2
a10 1
CONFIGURE_ARGS=	--disable-strict-error-checking
@


1.3
log
@update squid/snapshot to 3.4.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2013/12/07 10:47:29 sthen Exp $
d3 1
a3 1
V=		3.4.1
@


1.2
log
@update to squid 3.4.0.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2013/11/15 19:09:17 sthen Exp $
d3 1
a3 1
V=		3.4.0.3
@


1.1
log
@Update to squid-3.3.10 and reorganise the squid ports; retire squid-2.7
(it was kept separately because 3.x didn't build on some arch due to an
incomplete atomic ops autoconf check which has since been repaired) and
replace with 3.4 (devel version). Enable additional helpers and turn on
support for rock cache dirs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.164 2013/09/17 16:56:24 sthen Exp $
d3 1
a3 1
V=		3.4.0.2
@

