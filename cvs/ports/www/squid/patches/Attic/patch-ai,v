head	1.3;
access;
symbols
	OPENBSD_3_0:1.2.0.6
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9_TRACKING_SWITCH:1.2
	OPENBSD_2_9:1.2.0.4
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.2
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.1.0.2
	OPENBSD_2_7_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2002.02.20.01.17.03;	author brad;	state dead;
branches;
next	1.2;

1.2
date	2000.06.28.07.08.31;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2000.01.17.15.38.38;	author brad;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2000.09.15.05.22.16;	author marc;	state Exp;
branches;
next	;


desc
@@


1.3
log
@upgrade to Squid 2.5.PRE4
- The port now runs as uid/gid of nobody:nobody instead of www:www
- This needs some testing, especially the transparent proxy support for PF
@
text
@--- scripts/Makefile.in.orig	Tue Jun 27 23:18:14 2000
+++ scripts/Makefile.in	Tue Jun 27 23:20:19 2000
@@@@ -18,19 +18,21 @@@@
 RANLIB		= @@RANLIB@@
 LN_S		= @@LN_S@@
 
+DESTDIR = 
+
 all: 
 
 install:	
-	@@if test ! -d $(exec_prefix); then \
-		echo "mkdir $(exec_prefix)"; \
-		mkdir $(exec_prefix); \
+	@@if test ! -d $(DESTDIR)$(exec_prefix); then \
+		echo "${BSD_INSTALL_DATA_DIR} $(DESTDIR)$(exec_prefix)"; \
+		${BSD_INSTALL_DATA_DIR} $(DESTDIR)$(exec_prefix); \
 	fi
-	@@if test ! -d $(bindir); then \
-		echo "mkdir $(bindir)"; \
-		mkdir $(bindir); \
+	@@if test ! -d $(DESTDIR)$(bindir); then \
+		echo "${BSD_INSTALL_PROGRAM_DIR} $(DESTDIR)$(bindir)"; \
+		${BSD_INSTALL_PROGRAM_DIR} $(DESTDIR)$(bindir); \
 	fi
-	$(INSTALL_BIN) RunCache $(bindir)
-	$(INSTALL_BIN) RunAccel $(bindir)
+	$(INSTALL_BIN) RunCache $(DESTDIR)$(bindir)
+	$(INSTALL_BIN) RunAccel $(DESTDIR)$(bindir)
 
 clean:
 
@


1.2
log
@upgrade to Squid 2.3.STABLE3

- NOTE: you can now override the dir used for cache/logs by using the
variable STATEDIR. i.e., "make STATEDIR=/alternate/dir package", and it
will be substituted into the INSTALL/DEINSTALL scripts.
@
text
@@


1.1
log
@- check that PATCH_DEBUG is set to yes instead of just being defined
- change MAINTAINER, ports@@ -> brad@@
- add 2 distribution patches;

squid-2.2.stable5-domain-match.patch
Matching a hostname and a domain name doesn't always work, depending on
leading dots and other edge conditions. Plus, the code for matching in
ACL's worked one way, while the code for matching 'cache_peer_domain' list
worked slighly different.

The patch below makes all host/domain matching operate the same way. It
also changes the rules a bit, so your current configuration probably will
not work the way you want after applying this patch.

- patch was included in the patches dir because of the difference in
relative path in comparison to all the other distribution patches.

squid-2.2.stable5-mkhttpdlogtime-end-of-year.patch = patch-ai
mkhttpdlogtime() generates a date string of the form 31/Dec/1999:23:59:59 +0900.
But when the year changes, the timezone offset will be wrong, for example:
01/Jan/2000:00:00:00 -1500.
@
text
@d1 5
a5 4
--- lib/rfc1123.c.orig	Fri Feb 12 14:38:15 1999
+++ lib/rfc1123.c	Mon Jan 17 09:16:29 2000
@@@@ -237,15 +237,16 @@@@
     gmt_yday = gmt->tm_yday;
d7 23
a29 4
     lt = localtime(t);
-    day_offset = lt->tm_yday - gmt_yday;
-    min_offset = day_offset * 1440 + (lt->tm_hour - gmt_hour) * 60
-	+ (lt->tm_min - gmt_min);
d31 1
a31 9
+    day_offset = lt->tm_yday - gmt_yday;
     /* wrap round on end of year */
     if (day_offset > 1)
 	day_offset = -1;
     else if (day_offset < -1)
 	day_offset = 1;
+
+    min_offset = day_offset * 1440 + (lt->tm_hour - gmt_hour) * 60
+	+ (lt->tm_min - gmt_min);
a32 2
     len = strftime(buf, 127 - 5, "%d/%b/%Y:%H:%M:%S ", lt);
     snprintf(buf + len, 128 - len, "%+03d%02d",
@


1.1.2.1
log
@bring www as of cut-over date into 2.7 branch
@
text
@d1 4
a4 5
--- scripts/Makefile.in.orig	Tue Jun 27 23:18:14 2000
+++ scripts/Makefile.in	Tue Jun 27 23:20:19 2000
@@@@ -18,19 +18,21 @@@@
 RANLIB		= @@RANLIB@@
 LN_S		= @@LN_S@@
d6 11
a16 1
+DESTDIR = 
d18 2
a19 23
 all: 
 
 install:	
-	@@if test ! -d $(exec_prefix); then \
-		echo "mkdir $(exec_prefix)"; \
-		mkdir $(exec_prefix); \
+	@@if test ! -d $(DESTDIR)$(exec_prefix); then \
+		echo "${BSD_INSTALL_DATA_DIR} $(DESTDIR)$(exec_prefix)"; \
+		${BSD_INSTALL_DATA_DIR} $(DESTDIR)$(exec_prefix); \
 	fi
-	@@if test ! -d $(bindir); then \
-		echo "mkdir $(bindir)"; \
-		mkdir $(bindir); \
+	@@if test ! -d $(DESTDIR)$(bindir); then \
+		echo "${BSD_INSTALL_PROGRAM_DIR} $(DESTDIR)$(bindir)"; \
+		${BSD_INSTALL_PROGRAM_DIR} $(DESTDIR)$(bindir); \
 	fi
-	$(INSTALL_BIN) RunCache $(bindir)
-	$(INSTALL_BIN) RunAccel $(bindir)
+	$(INSTALL_BIN) RunCache $(DESTDIR)$(bindir)
+	$(INSTALL_BIN) RunAccel $(DESTDIR)$(bindir)
 
 clean:
d21 2
@


