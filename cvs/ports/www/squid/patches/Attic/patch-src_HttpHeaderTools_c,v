head	1.2;
access;
symbols
	OPENBSD_4_6:1.1.0.4
	OPENBSD_4_5:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2009.10.30.00.56.57;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2009.08.30.21.52.44;	author jasper;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2009.09.15.02.38.09;	author william;	state Exp;
branches;
next	;

1.1.4.1
date	2009.10.25.03.37.12;	author william;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2010.02.09.03.07.43;	author william;	state dead;
branches;
next	;


desc
@@


1.2
log
@update to the latest bug fix release in the 2.7 branch. From Brad (maintainer).
@
text
@$OpenBSD: patch-src_HttpHeaderTools_c,v 1.1 2009/08/30 21:52:44 jasper Exp $

Security fix for CVE-2009-2855.
Patch from upstream repository:
http://www.squid-cache.org/Versions/v2/HEAD/changesets/12541.patch

--- src/HttpHeaderTools.c.orig	Sun Aug 30 20:43:57 2009
+++ src/HttpHeaderTools.c	Sun Aug 30 20:44:54 2009
@@@@ -239,6 +239,10 @@@@ int
 strListGetItem(const String * str, char del, const char **item, int *ilen, const char **pos)
 {
     size_t len;
+    /* ',' is always enabled as field delimiter as this is required for
+     * processing merged header values properly, even if Cookie normally
+     * uses ';' as delimiter.
+     */
     static char delim[3][8] =
     {
 	"\"?,",
@@@@ -261,16 +265,15 @@@@ strListGetItem(const String * str, char del, const cha
     /* find next delimiter */
     do {
 	*pos += strcspn(*pos, delim[quoted]);
-	if (**pos == del)
-	    break;
 	if (**pos == '"') {
 	    quoted = !quoted;
 	    *pos += 1;
-	}
-	if (quoted && **pos == '\\') {
+	} else if (quoted && **pos == '\\') {
 	    *pos += 1;
 	    if (**pos)
 		*pos += 1;
+	} else {
+	    break;		/* Delimiter found, marking the end of this value */
 	}
     } while (**pos);
     len = *pos - *item;		/* *pos points to del or '\0' */
@


1.1
log
@Security fix for CVE-2009-2855

ok brad (MAINTAINER)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@MFC:

SECURITY FIX

Resolve CVE-2009-2855
@
text
@d1 1
a1 1
$OpenBSD: patch-src_HttpHeaderTools_c,v 1.1 2009/08/30 21:52:44 jasper Exp $
@


1.1.4.2
log
@MFC:

SECURITY FIX

Resolves:  CVE-2009-2855, CVE-2010-0308, and bugfixes

ok Brad jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_HttpHeaderTools_c,v 1.1.4.1 2009/10/25 03:37:12 william Exp $
@


1.1.2.1
log
@MFC:

SECURITY FIX

Resolve CVE-2009-2855

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_HttpHeaderTools_c,v 1.1 2009/08/30 21:52:44 jasper Exp $
@

