head	1.2;
access;
symbols
	OPENBSD_5_4:1.1.0.4
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.2
	OPENBSD_5_3_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2013.11.15.19.09.17;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2013.01.02.11.21.13;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to squid-3.3.10 and reorganise the squid ports; retire squid-2.7
(it was kept separately because 3.x didn't build on some arch due to an
incomplete atomic ops autoconf check which has since been repaired) and
replace with 3.4 (devel version). Enable additional helpers and turn on
support for rock cache dirs.
@
text
@$OpenBSD: patch-src_client_side_c,v 1.1 2013/01/02 11:21:13 sthen Exp $

fix a leak with malformed headers: 1.754.2.30 upstream, extracted from
http://www.squid-cache.org/Versions/v2/2.7/squid-2.7.STABLE9-20110824.diff

--- src/client_side.c.orig	Wed Jan  2 10:15:50 2013
+++ src/client_side.c	Wed Jan  2 10:16:07 2013
@@@@ -3063,6 +3063,7 @@@@ clientCheckHeaderDone(clientHttpRequest * http)
     if (mb.size > 0) {
 	comm_write_mbuf(http->conn->fd, mb, clientWriteComplete, http);
     } else {
+	memBufClean(&mb);
 	storeClientCopy(http->sc, http->entry,
 	    http->out.offset,
 	    http->out.offset,
@


1.1
log
@add a patch from upstream's stable diff; fix memleak with malformed headers.
@
text
@d1 1
a1 1
$OpenBSD$
@

