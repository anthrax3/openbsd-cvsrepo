head	1.9;
access;
symbols
	OPENBSD_5_4:1.6.0.2
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	sthen_20130102:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.9
date	2013.11.15.19.09.17;	author sthen;	state dead;
branches;
next	1.8;

1.8
date	2013.10.31.21.12.13;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2013.08.07.15.37.11;	author naddy;	state Exp;
branches;
next	1.6;

1.6
date	2013.06.20.06.54.37;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2013.06.17.19.31.25;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2013.03.11.11.44.49;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2013.02.09.14.49.53;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2013.01.02.11.21.13;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2013.01.02.10.12.02;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2013.01.02.10.12.02;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Update to squid-3.3.10 and reorganise the squid ports; retire squid-2.7
(it was kept separately because 3.x didn't build on some arch due to an
incomplete atomic ops autoconf check which has since been repaired) and
replace with 3.4 (devel version). Enable additional helpers and turn on
support for rock cache dirs.
@
text
@# $OpenBSD: Makefile,v 1.8 2013/10/31 21:12:13 sthen Exp $

COMMENT=	WWW and FTP proxy cache and accelerator

DISTNAME=	squid-2.7.STABLE9
REVISION=	25
CATEGORIES=	www
MASTER_SITES=	${HOMEPAGE}/Versions/v2/2.7/
DIST_SUBDIR=	squid

MAINTAINER=	Stuart Henderson <sthen@@openbsd.org>

HOMEPAGE=	http://www.squid-cache.org/

# GPLv2+
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += asn1 c com_err crypto krb5 gssapi m pthread ssl roken
WANTLIB += heimbase wind

LOCALSTATEDIR=	${BASELOCALSTATEDIR}/squid
SUBST_VARS=	LOCALSTATEDIR

FLAVORS=	ldap ntlm snmp
FLAVOR?=

AUTH=		basic digest negotiate
BASIC_AUTH=	NCSA YP
DIGEST_AUTH=	password
EXTERNAL_ACL=	ip_user unix_group
STOREIO=	aufs ufs diskd null

SEPARATE_BUILD=	Yes
AUTOCONF_VERSION= 2.62
CONFIGURE_STYLE= autoconf
MODGNU_CONFIG_GUESS_DIRS=${WRKSRC}/cfgaux

CONFIGURE_ARGS+=--datadir="${PREFIX}/share/squid" \
		--enable-auth="${AUTH}" \
		--enable-arp-acl \
		--enable-basic-auth-helpers="${BASIC_AUTH}" \
		--enable-digest-auth-helpers="${DIGEST_AUTH}" \
		--enable-delay-pools \
		--enable-external-acl-helpers="${EXTERNAL_ACL}" \
		--enable-forw-via-db \
		--enable-negotiate-auth-helpers="squid_kerb_auth" \
		--enable-removal-policies="lru heap" \
		--enable-ssl \
		--enable-storeio="${STOREIO}" \
		--with-pthreads \
		--enable-follow-x-forwarded-for

.if ${FLAVOR:Mldap}
BASIC_AUTH+=	LDAP
DIGEST_AUTH+=	ldap
EXTERNAL_ACL+=	ldap_group
WANTLIB+=	ldap lber
LIB_DEPENDS+=	databases/openldap
CONFIGURE_ENV+=	CPPFLAGS="-I${LOCALBASE}/include" \
		LDFLAGS="-L${LOCALBASE}/lib"
.endif

.if ${FLAVOR:Mntlm}
AUTH+=         ntlm
BASIC_AUTH+=   SMB
EXTERNAL_ACL+= wbinfo_group
RUN_DEPENDS+=  net/samba,ads
CONFIGURE_ARGS+=--enable-ntlm-auth-helpers="fakeauth SMB"
.endif

.if ${FLAVOR:Msnmp}
CONFIGURE_ARGS+=--enable-snmp
.endif

pre-build:
	@@${SUBST_CMD} ${WRKSRC}/src/defines.h \
		${WRKSRC}/helpers/external_acl/wbinfo_group/wbinfo_group.pl

post-install:
	@@chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share/examples/squid
	@@find ${PREFIX}/share/examples/squid/errors \
		-name '*.orig' -print0 | xargs -0 rm -f

.include <bsd.port.mk>
@


1.8
log
@bump REVISION for any ports using route messages. regen some distinfos and
remove unnecessary USE_GROFFs while there.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2013/08/07 15:37:11 naddy Exp $
@


1.7
log
@kill direct and indirect references to GCC2_ARCHS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2013/06/20 06:54:37 ajacoutot Exp $
d6 1
a6 1
REVISION=	24
@


1.6
log
@Unbreak after hx509 and ntlm removal from Kerberos.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2013/06/17 19:31:25 ajacoutot Exp $
a25 7

.include <bsd.port.arch.mk>

# optimization workaround for gcc 2.95
.if ${PROPERTIES:Mgcc2}
PATCH_LIST=     patch-* gcc-*
.endif
@


1.5
log
@Unbreak with new Heimdal; get rid of self-cooked krb5-config since we
have it in base now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2013/03/11 11:44:49 espie Exp $
d6 1
a6 1
REVISION=	23
d19 1
a19 1
WANTLIB += heimbase heimntlm hx509 wind
@


1.4
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2013/02/09 14:49:53 sthen Exp $
d6 1
a6 1
REVISION=	22
d18 2
a19 1
WANTLIB=	asn1 c com_err crypto krb5 gssapi m pthread ssl
@


1.3
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2013/01/02 11:21:13 sthen Exp $
a16 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.2
log
@add a patch from upstream's stable diff; fix memleak with malformed headers.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2013/01/02 10:12:02 sthen Exp $
d62 1
a62 1
.if ${FLAVOR:L:Mldap}
d72 1
a72 1
.if ${FLAVOR:L:Mntlm}
d80 1
a80 1
.if ${FLAVOR:L:Msnmp}
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.132 2012/08/27 06:19:48 ajacoutot Exp $
d6 1
a6 1
REVISION=	21
@


1.1.1.1
log
@Re-import squid 2.7.STABLE9 under www/squid27, same as the previous port
in www/squid as of 2012/11/26 plus a REVISION bump. The newer version works
well in most cases, but is less portable and seems to have problems with
certain configurations.  ok ajacoutot.
@
text
@@
