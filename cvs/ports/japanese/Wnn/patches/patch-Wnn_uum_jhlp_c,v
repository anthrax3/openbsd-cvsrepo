head	1.7;
access;
symbols
	OPENBSD_6_1:1.6.0.4
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.6.0.2
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.4
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.4.0.6
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.4
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.4.0.2
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.3.0.8
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.6
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.2.0.48
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.46
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.44
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.42
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.40
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.38
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.36
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.34
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.32
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.30
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.28
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.26
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.24
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.22
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.20
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.18
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.16
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.14
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.12
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.2.0.10
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.2.0.8
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9_TRACKING_SWITCH:1.2
	OPENBSD_2_9:1.2.0.6
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.4
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.2
	OPENBSD_2_7_BASE:1.2;
locks; strict;
comment	@# @;


1.7
date	2017.04.29.14.31.40;	author espie;	state Exp;
branches;
next	1.6;
commitid	BANaREjfB2FZ9POp;

1.6
date	2016.03.11.16.06.01;	author naddy;	state Exp;
branches;
next	1.5;
commitid	pyq9FPbg8GbwmC9v;

1.5
date	2015.07.25.16.47.12;	author espie;	state Exp;
branches;
next	1.4;
commitid	lfUoLFpbeIFyf3Ry;

1.4
date	2013.12.08.16.42.24;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2011.11.13.13.24.14;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2000.04.20.22.59.21;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2000.04.16.21.53.31;	author espie;	state Exp;
branches;
next	;


desc
@@


1.7
log
@fixes for clang: don't compile a clone of getopt.
while there, fix system includes, implicit ints, and void main.
@
text
@$OpenBSD: patch-Wnn_uum_jhlp_c,v 1.6 2016/03/11 16:06:01 naddy Exp $
--- Wnn/uum/jhlp.c.orig
+++ Wnn/uum/jhlp.c
@@@@ -49,7 +49,11 @@@@ static char *rcs_id = "$Id: jhlp.c,v 1.40 1994/08/19 0
 /*	Version 4.0
  */
 #include <stdio.h>
+#include <stdlib.h>
 #include <signal.h>
+#include <string.h>
+#include <unistd.h>
+#include <sys/stat.h>
 #include "jllib.h"
 #include "commonhd.h"
 #include "sdefine.h"
@@@@ -61,7 +65,7 @@@@ static char *rcs_id = "$Id: jhlp.c,v 1.40 1994/08/19 0
 #ifndef SYSVR2
 #include <fcntl.h>
 #endif /* !SYSVR2 */
-#include <sys/errno.h>
+#include <errno.h>
 #include <pwd.h>
 #include <sys/time.h>
 #ifdef UX386
@@@@ -80,6 +84,9 @@@@ struct passwd *getpwuid();
 
 jmp_buf kk_env;
 
+#if (defined(__unix__) || defined(unix)) && !defined(USG)
+#include <sys/param.h>
+#endif
 #ifdef SYSVR2
 #	include <sys/param.h>
 #endif /* SYSVR2 */
@@@@ -88,9 +95,21 @@@@ jmp_buf kk_env;
 #	include <sys/wait.h>
 #endif /* HAVE_WAIT3 */
 
+#if defined(__OpenBSD__)
+#define USE_TERMIOS
+#else
 #ifdef BSD42
+#define USE_SGTTY
+#endif
+#endif
+
+#ifdef linux
+#define USE_TERMIOS
+#endif
+
+#ifdef USE_SGTTY
 #       include <sgtty.h>
-#endif /* BSD42 */
+#endif
 
 #ifdef SYSVR2
 #ifdef TERMINFO
@@@@ -101,7 +120,7 @@@@ jmp_buf kk_env;
 #if defined(SVR4) || defined(hpux) || defined(sgi)
 #include <sys/termio.h>
 #endif
-#ifdef linux
+#ifdef USE_TERMIOS
 #include <termios.h>
 #endif
 
@@@@ -133,11 +152,10 @@@@ char *cmdnm = "csh";		/* char *cmdnm = "csh"; */
 int child_id;
 char *prog;
 
-extern int errno;
 extern char *optarg;
 extern int optind;
 
-extern char *ttyname(), *malloc(), *getenv();
+extern char *ttyname();
 
 static void save_signals();
 static void restore_signals();
@@@@ -148,7 +166,7 @@@@ static void do_end(), open_pty(), open_ttyp(), do_main
   change_size(), default_usage();
 
 /** メイン */
-void
+int
 main(argc, argv)
 int argc;
 char **argv;
@@@@ -166,14 +184,14 @@@@ char **argv;
     flow_control = FLOW_CONTROL;
     code_trans = default_code_trans;
 
-    strcpy(username, getpwuid(getuid())->pw_name);
+    strlcpy(username, getpwuid(getuid())->pw_name, PATHNAMELEN);
     if((name = getenv(WNN_USERNAME_ENV)) != NULL){
-	strcpy(username, name);
+	strlcpy(username, name, PATHNAMELEN);
     }
     for (i = 1; i < argc;) {
 	if (!strcmp(argv[i++], "-L")) {
 	    if (i >= argc || argv[i][0] == '-') default_usage();
-	    strcpy(lang_dir, argv[i++]);
+	    strlcpy(lang_dir, argv[i++], 32);
 	    for (;i < argc; i++) {
 		argv[i - 2] = argv[i];
 	    }
@@@@ -185,12 +203,7 @@@@ char **argv;
 
     if(*lang_dir == '\0') {
 	if ((p = getenv("LANG")) != NULL) {
-	    if (strlen(p) >= 4) {
-		strncpy(lang_dir, p, 5);
-		lang_dir[5] = '\0';
-	    } else {
-		strcpy(lang_dir, p);
-	    }
+	    strlcpy(lang_dir, p, 5);
 	}
     }
     for (f = function_db; *lang_dir && f && f->lang; f++) {
@@@@ -233,8 +246,8 @@@@ char **argv;
 	    server_env = WNN_DEF_SERVER_ENV;
 	}
 	if(name = getenv(server_env)) {
-	    strcpy(def_servername, name);
-	    strcpy(def_reverse_servername, name);
+	    strlcpy(def_servername, name, PATHNAMELEN);
+	    strlcpy(def_reverse_servername, name, PATHNAMELEN);
 	}
     }
 
@@@@ -244,7 +257,7 @@@@ char **argv;
     }
 
     if((p = getenv(WNN_COUNTDOWN_ENV)) == NULL) {
-      setenv(WNN_COUNTDOWN_ENV,"0");
+      setenv(WNN_COUNTDOWN_ENV,"0", 1);
     } else if (atoi(p) <= 0) {
 	puteustring(MSG_GET(4), stdout);
 	/*
@@@@ -253,7 +266,7 @@@@ char **argv;
 	exit(126);
     } else {
       sprintf(p,"%d",atoi(p) - 1);
-      setenv(WNN_COUNTDOWN_ENV,p);
+      setenv(WNN_COUNTDOWN_ENV,p, 1);
     }
 
     if((tname = getenv("TERM")) == NULL) {
@@@@ -263,9 +276,11 @@@@ char **argv;
 
 
 #if defined(BSD42) && !defined(DGUX)
+#if !(defined(BSD) && (BSD >= 199306))
     if (saveutmp() < 0) {
 	puts("Can't save utmp\n");
     }
+#endif
 #endif /* BSD42 */
 
 
@@@@ -312,7 +327,7 @@@@ char **argv;
 #endif /* TERMCAP */
 
     open_pty();
-#ifndef linux
+#if !(defined(linux) || defined(__OpenBSD__))
     open_ttyp();
 #endif
     exec_cmd(argv);
@@@@ -492,7 +507,7 @@@@ static int do_X_opt()
 
 static int do_k_opt()
 {
-    strcpy(uumkey_name_in_uumrc, optarg);
+    strlcpy(uumkey_name_in_uumrc, optarg, PATHNAMELEN);
     if (*uumkey_name_in_uumrc == '\0') {
 	return -1;
     }
@@@@ -502,7 +517,7 @@@@ static int do_k_opt()
 
 static int do_c_opt()
 {
-    strcpy(convkey_name_in_uumrc, optarg);
+    strlcpy(convkey_name_in_uumrc, optarg, PATHNAMELEN);
     if (*convkey_name_in_uumrc == '\0') {
 	return -1;
     }
@@@@ -512,7 +527,7 @@@@ static int do_c_opt()
 
 static int do_r_opt()
 {
-    strcpy(rkfile_name_in_uumrc, optarg);
+    strlcpy(rkfile_name_in_uumrc, optarg, PATHNAMELEN);
     if (*rkfile_name_in_uumrc == '\0') {
 	return -1;
     }
@@@@ -528,8 +543,8 @@@@ static int do_l_opt()
 
 static int do_D_opt()
 {
-    strcpy(def_servername, optarg);
-    strcpy(def_reverse_servername, optarg);
+    strlcpy(def_servername, optarg, PATHNAMELEN);
+    strlcpy(def_reverse_servername, optarg, PATHNAMELEN);
     if (*def_servername == '\0') {
 	return -1;
     }
@@@@ -538,7 +553,7 @@@@ static int do_D_opt()
 
 static int do_n_opt()
 {
-    strcpy(username, optarg);
+    strlcpy(username, optarg, PATHNAMELEN);
     if (*username == '\0') {
 	return -1;
     }
@@@@ -581,14 +596,14 @@@@ char **argv;
 #endif	/* SYSVR2 */
   extern char *index();
   
-  strcpy(ostr, default_getoptstr);
-  strcat(ostr, lang_db->getoptstr);
+  strlcpy(ostr, default_getoptstr, sizeof(ostr));
+  strlcat(ostr, lang_db->getoptstr, sizeof(ostr));
   while ((c = getopt(argc, argv, ostr)) != EOF) {
     if (!(p = index(default_ostr, c)) || (*do_opt[p - default_ostr])() < 0) {
 	if (!(p = index(lang_db->ostr, c)) ||
 	    (*lang_db->do_opt[p - lang_db->ostr])() < 0) {
-	    strcpy(ostr, default_ostr);
-	    strcat(ostr, lang_db->ostr);
+	    strlcpy(ostr, default_ostr, sizeof(ostr));
+	    strlcat(ostr, lang_db->ostr, sizeof(ostr));
 	    usage(ostr);
 	}
     }
@@@@ -600,7 +615,7 @@@@ char **argv;
 
 /** tty に対する ioctl のセット */
 
-#ifdef BSD42
+#ifdef USE_SGTTY
 struct sgttyb savetmio;
 /*
   struct sgttyb ttyb =
@@@@ -642,11 +657,11 @@@@ j_term_init()
 }
 #endif /* BSD42 */
 
-#ifdef SYSVR2
+#if defined(SYSVR2) || defined(USE_TERMIOS)
 #define UNDEF_STTY 0xff 
 
-struct termio savetmio;
-struct termio terms = {
+struct termios savetmio;
+struct termios terms = {
     IGNBRK | ICRNL | IXON,	/* c_iflag */
     ONLCR | OPOST,		/* c_oflag */
     B9600 | CS8 | CSTOPB | CREAD | CLOCAL, /* c_cflag */
@@@@ -678,13 +693,13 @@@@ get_rubout()
 int
 j_term_init()
 {
-    struct termio buf1;
+    struct termios buf1;
 #if defined(uniosu)
     struct jtermio buf2;
 #endif	/* defined(uniosu) */
 
     buf1 = savetmio;
-#ifdef linux
+#ifdef USE_TERMIOS
     buf1.c_lflag &= ~(ECHONL | ECHOK | ECHOE | ECHO | XCASE | ICANON | ISIG);
     buf1.c_iflag = 0;
     buf1.c_oflag &= ~OPOST;
@@@@ -705,7 +720,7 @@@@ j_term_init()
     buf1.c_cc[VEOF] = 1;	/* cf. ICANON */
     buf1.c_cc[VEOL] = 0;
 #endif /* linux */
-    if(ioctl(ttyfd, TCSETA, &buf1) == -1){
+    if (tcsetattr(ttyfd, TCSANOW, &buf1) == -1) {
 	fprintf(stderr, "error in ioctl TCSETA.\n");
 	exit(1);
     }
@@@@ -764,19 +779,20 @@@@ intfntype
 chld_handler()
 {
 #ifdef HAVE_WAIT3
-#ifdef linux
     int status;
-#else
-    union wait status;
-#endif
     int pid;
 
-    if ((pid = wait3(&status, WNOHANG | WUNTRACED, NULL)) == child_id) {
+/*
+ * Remove warning.
+ * Patched by Hidekazu Kuroki(hidekazu@@cs.titech.ac.jp)		1996/8/20
+ */
+/*  if ((pid = wait3(&status, WNOHANG | WUNTRACED, NULL)) == child_id) { */
+    if ((pid = wait3((int *)&status, WNOHANG | WUNTRACED, NULL)) == child_id) {
 	if (WIFSTOPPED(status)) {
 #ifdef SIGCONT
 	    kill(pid, SIGCONT);
 #ifndef SYSVR2
-	    pid = getpgrp(pid);
+	    pid = getpgrp();
 	    killpg(pid, SIGCONT);
 #else
 #if defined(uniosu)
@@@@ -1107,9 +1123,9 @@@@ char **argv;
 #ifdef BSD42
     int pid;
 #endif
-#ifdef linux
+#if defined(linux) || defined(__OpenBSD__)
     struct winsize win;
-    extern Term_RowWidth,crow;
+    extern int Term_RowWidth,crow;
 #endif
 #if defined(SYSVR2) && !defined(linux)
 	setpgrp();
@@@@ -1140,16 +1156,18 @@@@ char **argv;
 	setpgrp(0, pid);
 #endif /* BSD42 */
 
+#if !(defined(BSD) && (BSD >= 199306))
 	if (setutmp(ttypfd) == ERROR) {
 	    puts("Can't set utmp.");
 	} 
+#endif
 
-#ifdef linux
+#if defined(linux) || defined(__OpenBSD__)
 	setsid();
 	open_ttyp();
 	close(ptyfd);
 	ioctl(ttyfd, TIOCGWINSZ, &win);
-	ioctl(ttypfd, TCSETA, &savetmio);
+	tcsetattr(ttypfd, TCSANOW, &savetmio);
 	dup2(ttypfd, 0);
 	dup2(ttypfd, 1);
 	dup2(ttypfd, 2);
@@@@ -1187,7 +1205,7 @@@@ char **argv;
 	    err("Can't set utmp.");
 	} 
 */
-#ifdef linux
+#if defined(linux) || defined(__OpenBSD__)
  	crow = win.ws_row = Term_RowWidth = win.ws_row - conv_lines;
 	ioctl(ttyfd, TIOCSWINSZ, &win);
 	setgid(getgid());
@@@@ -1198,6 +1216,7 @@@@ char **argv;
     }
 }
 
+#if 0
 /** 環境変数のセット */
 void
 setenv(var, value)
@@@@ -1234,6 +1253,7 @@@@ char *value;
     strcat(environ[i], "=");
     strcat(environ[i], value);
 }
+#endif
 
 #ifdef SVR4
 static int
@@@@ -1342,7 +1362,7 @@@@ open_ttyp()
     chown(nmbuf, getuid(), getgid());
     chmod(nmbuf, 0622);
 #endif /* !linux */
-#ifdef BSD42
+#ifdef USE_SGTTY
     ioctl(ttyfd, TIOCGETC, &tcharsv);
     ioctl(ttyfd, TIOCGLTC, &ltcharsv);
     ioctl(ttyfd, TIOCGETP, &ttyb);
@@@@ -1446,11 +1466,23 @@@@ open_ttyp()
     close(open(ttyname(ttypfd), O_WRONLY, 0));
 */
 #endif /* defined(SYSVR2) && !defined(linux) */
+#ifdef __OpenBSD__
+    {
+    struct winsize win;
+
+    if (ioctl(ttyfd, TIOCGWINSZ, &win) != -1) {
+	win.ws_row = crow;
+	win.ws_col = maxlength;
+	ioctl(ttypfd, TIOCSWINSZ, &win);
+    }
+    }
+#else
 #ifdef TIOCSSIZE
     pty_rowcol.ts_lines = crow; /* instead of lines */
     pty_rowcol.ts_cols = maxlength; /* instead of columns */
     ioctl(ttypfd, TIOCSSIZE, &pty_rowcol);
 #endif /* TIOCSSIZE */
+#endif
 }
 
 /** pty のオープン */
@@@@ -1524,15 +1556,13 @@@@ do_end()
     signal(SIGCHLD, SIG_DFL);
     fcntl(ttyfd, F_SETFL, 0);
 
-#ifdef BSD42
+#ifdef USE_SGTTY
     ioctl(ttyfd, TIOCSETP, &savetmio);
-#endif /* BSD42 */
-#if defined(BSD43) || defined(DGUX)
     ioctl(ttyfd, TIOCLSET, &local_mode_sv);
 #endif /* BSD43 */
 
-#ifdef SYSVR2
-    if(ioctl(ttyfd, TCSETA, &savetmio) < 0) {
+#ifdef USE_TERMIOS
+    if(tcsetattr(ttyfd, TCSANOW, &savetmio) < 0) {
 	fprintf(stderr, "error in ioctl TCSETA.\n");
 	exit(1);
     }
@@@@ -1562,9 +1592,11 @@@@ do_end()
 	perror(prog);
     }
 
+#if !(defined(BSD) && (BSD >= 199306))
     if (resetutmp(ttypfd) == ERROR) {
 	printf("Can't reset utmp.");
     }
+#endif
 #ifdef TIOCSSIZE
     pty_rowcol.ts_lines = 0;
     pty_rowcol.ts_cols = 0;
@@@@ -1636,7 +1668,16 @@@@ ptyname(b, pty, no)
 char *b, *pty;
 int no;
 {
+/*
+ * Change pseudo-devices.
+ * Because FreeBSD's master pseudo-devices are pty[p-sP-S][0-9a-v].
+ * Patched by Hidekazu Kuroki(hidekazu@@cs.titech.ac.jp)		1996/8/20
+ */
+#if (defined(BSD) && (BSD >= 199306)) /* 4.4BSD-Lite by Taoka */
+    sprintf(b, "%s%1c%1c", pty, "pqrsPQRS"[(no >> 5)], ((no & 0x1f > 9)? 'a' : '0') + (no & 0x1f));
+#else /* ! 4.4BSD-Lite */
     sprintf(b, "%s%1c%1x", pty, 'p' + (no >> 4), no & 0x0f);
+#endif /* ! 4.4BSD-Lite */
 }
 #endif /* !sgi */
 
@@@@ -1722,7 +1763,7 @@@@ setsize()
 {
 	register int i;
 	struct winsize win;
-	extern Term_LineWidth,Term_RowWidth,maxlength,crow;
+	extern int Term_LineWidth,Term_RowWidth,maxlength,crow;
 
 	if (ioctl(ttyfd, TIOCGWINSZ, &win) < 0) {
 		/* Default set at getTermData() */
@@@@ -1744,7 +1785,7 @@@@ change_size()
 {
 	register int i;
 	struct winsize win;
-	extern Term_LineWidth,Term_RowWidth,maxlength,crow;
+	extern int Term_LineWidth,Term_RowWidth,maxlength,crow;
 
 	if (ioctl(ttyfd, TIOCGWINSZ, &win) < 0) {
 		/* Default set at getTermData() */
@@@@ -1755,14 +1796,14 @@@@ change_size()
 
 		if ((i = win.ws_row) != 0) {
 			crow = Term_RowWidth = i - conv_lines;
-#ifdef linux
+#if defined(linux) || defined(__OpenBSD__)
 			win.ws_row = crow;
 #endif
 		}
 		if ((i = win.ws_col) != 0) {
 			maxlength = Term_LineWidth = i;
 		}
-#ifdef linux
+#if defined(linux) || defined(__OpenBSD__)
 		ioctl(ttypfd, TIOCSWINSZ, &win);
 #else /* linux */
 #ifdef	TIOCSSIZE
@@@@ -1770,7 +1811,8 @@@@ change_size()
     		pty_rowcol.ts_cols = maxlength; /* instead of columns */
     		ioctl(ttypfd, TIOCSSIZE, &pty_rowcol);
 #endif	/* TIOCSSIZE */
-#ifdef	sun	/* When your machine needs SIGWINCH, add your machine */
+#endif
+#if defined(sun) || defined(__OpenBSD__)	/* When your machine needs SIGWINCH, add your machine */
 		{
 		int grp;
 		ioctl(ptyfd, TIOCGPGRP, &grp);
@@@@ -1781,7 +1823,6 @@@@ change_size()
 #endif
 		}
 #endif	/* sun */
-#endif /* linux */
 
 		set_scroll_region(0, crow - 1);
 		if (henkan_off_flag) {
@


1.6
log
@remove no_shared check and fix errno definition
@
text
@d1 4
a4 4
$OpenBSD: patch-Wnn_uum_jhlp_c,v 1.5 2015/07/25 16:47:12 espie Exp $
--- Wnn/uum/jhlp.c.orig	Fri Mar 11 16:32:33 2016
+++ Wnn/uum/jhlp.c	Fri Mar 11 16:40:00 2016
@@@@ -49,6 +49,7 @@@@ static char *rcs_id = "$Id: jhlp.c,v 1.40 1994/08/19 0
d10 3
d15 2
a16 1
@@@@ -61,7 +62,7 @@@@ static char *rcs_id = "$Id: jhlp.c,v 1.40 1994/08/19 0
d25 1
a25 1
@@@@ -80,6 +81,9 @@@@ struct passwd *getpwuid();
d35 1
a35 1
@@@@ -88,9 +92,21 @@@@ jmp_buf kk_env;
d58 1
a58 1
@@@@ -101,7 +117,7 @@@@ jmp_buf kk_env;
d67 1
a67 1
@@@@ -133,11 +149,10 @@@@ char *cmdnm = "csh";		/* char *cmdnm = "csh"; */
d80 1
a80 1
@@@@ -148,7 +163,7 @@@@ static void do_end(), open_pty(), open_ttyp(), do_main
d89 1
a89 1
@@@@ -166,14 +181,14 @@@@ char **argv;
d107 1
a107 1
@@@@ -185,12 +200,7 @@@@ char **argv;
d121 1
a121 1
@@@@ -233,8 +243,8 @@@@ char **argv;
d132 1
a132 1
@@@@ -244,7 +254,7 @@@@ char **argv;
d141 1
a141 1
@@@@ -253,7 +263,7 @@@@ char **argv;
d150 1
a150 1
@@@@ -263,9 +273,11 @@@@ char **argv;
d162 1
a162 1
@@@@ -312,7 +324,7 @@@@ char **argv;
d171 1
a171 1
@@@@ -492,7 +504,7 @@@@ static int do_X_opt()
d180 1
a180 1
@@@@ -502,7 +514,7 @@@@ static int do_k_opt()
d189 1
a189 1
@@@@ -512,7 +524,7 @@@@ static int do_c_opt()
d198 1
a198 1
@@@@ -528,8 +540,8 @@@@ static int do_l_opt()
d209 1
a209 1
@@@@ -538,7 +550,7 @@@@ static int do_D_opt()
d218 1
a218 1
@@@@ -581,14 +593,14 @@@@ char **argv;
d237 1
a237 1
@@@@ -600,7 +612,7 @@@@ char **argv;
d246 1
a246 1
@@@@ -642,11 +654,11 @@@@ j_term_init()
d261 1
a261 1
@@@@ -678,13 +690,13 @@@@ get_rubout()
d277 1
a277 1
@@@@ -705,7 +717,7 @@@@ j_term_init()
d286 1
a286 1
@@@@ -764,14 +776,15 @@@@ intfntype
d307 7
a313 1
@@@@ -1107,7 +1120,7 @@@@ char **argv;
d320 2
a321 1
     extern Term_RowWidth,crow;
d323 3
a325 1
@@@@ -1140,16 +1153,18 @@@@ char **argv;
d346 1
a346 1
@@@@ -1187,7 +1202,7 @@@@ char **argv;
d355 1
a355 1
@@@@ -1198,6 +1213,7 @@@@ char **argv;
d363 1
a363 1
@@@@ -1234,6 +1250,7 @@@@ char *value;
d371 1
a371 1
@@@@ -1342,7 +1359,7 @@@@ open_ttyp()
d380 1
a380 1
@@@@ -1446,11 +1463,23 @@@@ open_ttyp()
d404 1
a404 1
@@@@ -1524,15 +1553,13 @@@@ do_end()
d423 1
a423 1
@@@@ -1562,9 +1589,11 @@@@ do_end()
d435 1
a435 1
@@@@ -1636,7 +1665,16 @@@@ ptyname(b, pty, no)
d452 19
a470 1
@@@@ -1755,14 +1793,14 @@@@ change_size()
d487 1
a487 1
@@@@ -1770,7 +1808,8 @@@@ change_size()
d497 1
a497 1
@@@@ -1781,7 +1820,6 @@@@ change_size()
@


1.5
log
@move to new auth checks. Add "a few" includes to placate a lot of warnings.
(and bump affected packages of course)
@
text
@d1 3
a3 3
$OpenBSD: patch-Wnn_uum_jhlp_c,v 1.4 2013/12/08 16:42:24 espie Exp $
--- Wnn/uum/jhlp.c.orig	Fri Jul 24 17:43:06 2015
+++ Wnn/uum/jhlp.c	Fri Jul 24 18:05:03 2015
d12 9
d63 5
a67 1
@@@@ -137,7 +153,7 @@@@ extern int errno;
d76 1
a76 1
@@@@ -148,7 +164,7 @@@@ static void do_end(), open_pty(), open_ttyp(), do_main
d85 1
a85 1
@@@@ -166,14 +182,14 @@@@ char **argv;
d103 1
a103 1
@@@@ -185,12 +201,7 @@@@ char **argv;
d117 1
a117 1
@@@@ -233,8 +244,8 @@@@ char **argv;
d128 1
a128 1
@@@@ -244,7 +255,7 @@@@ char **argv;
d137 1
a137 1
@@@@ -253,7 +264,7 @@@@ char **argv;
d146 1
a146 1
@@@@ -263,9 +274,11 @@@@ char **argv;
d158 1
a158 1
@@@@ -312,7 +325,7 @@@@ char **argv;
d167 1
a167 1
@@@@ -492,7 +505,7 @@@@ static int do_X_opt()
d176 1
a176 1
@@@@ -502,7 +515,7 @@@@ static int do_k_opt()
d185 1
a185 1
@@@@ -512,7 +525,7 @@@@ static int do_c_opt()
d194 1
a194 1
@@@@ -528,8 +541,8 @@@@ static int do_l_opt()
d205 1
a205 1
@@@@ -538,7 +551,7 @@@@ static int do_D_opt()
d214 1
a214 1
@@@@ -581,14 +594,14 @@@@ char **argv;
d233 1
a233 1
@@@@ -600,7 +613,7 @@@@ char **argv;
d242 1
a242 1
@@@@ -642,11 +655,11 @@@@ j_term_init()
d257 1
a257 1
@@@@ -678,13 +691,13 @@@@ get_rubout()
d273 1
a273 1
@@@@ -705,7 +718,7 @@@@ j_term_init()
d282 1
a282 1
@@@@ -764,14 +777,15 @@@@ intfntype
d303 1
a303 1
@@@@ -1107,7 +1121,7 @@@@ char **argv;
d312 1
a312 1
@@@@ -1140,16 +1154,18 @@@@ char **argv;
d333 1
a333 1
@@@@ -1187,7 +1203,7 @@@@ char **argv;
d342 1
a342 1
@@@@ -1198,6 +1214,7 @@@@ char **argv;
d350 1
a350 1
@@@@ -1234,6 +1251,7 @@@@ char *value;
d358 1
a358 1
@@@@ -1342,7 +1360,7 @@@@ open_ttyp()
d367 1
a367 1
@@@@ -1446,11 +1464,23 @@@@ open_ttyp()
d391 1
a391 1
@@@@ -1524,15 +1554,13 @@@@ do_end()
d410 1
a410 1
@@@@ -1562,9 +1590,11 @@@@ do_end()
d422 1
a422 1
@@@@ -1636,7 +1666,16 @@@@ ptyname(b, pty, no)
d439 1
a439 1
@@@@ -1755,14 +1794,14 @@@@ change_size()
d456 1
a456 1
@@@@ -1770,7 +1809,8 @@@@ change_size()
d466 1
a466 1
@@@@ -1781,7 +1821,6 @@@@ change_size()
@


1.4
log
@messy removal of sgtty.h
probably better to update, hopefully soon.
@
text
@d1 12
a12 4
$OpenBSD: patch-Wnn_uum_jhlp_c,v 1.3 2011/11/13 13:24:14 naddy Exp $
--- Wnn/uum/jhlp.c.orig	Sun Dec  8 16:18:39 2013
+++ Wnn/uum/jhlp.c	Sun Dec  8 17:24:56 2013
@@@@ -80,6 +80,9 @@@@ struct passwd *getpwuid();
d22 1
a22 1
@@@@ -88,9 +91,21 @@@@ jmp_buf kk_env;
d45 1
a45 1
@@@@ -101,7 +116,7 @@@@ jmp_buf kk_env;
d54 19
a72 1
@@@@ -166,14 +181,14 @@@@ char **argv;
d90 1
a90 1
@@@@ -185,12 +200,7 @@@@ char **argv;
d104 1
a104 1
@@@@ -233,8 +243,8 @@@@ char **argv;
d115 19
a133 1
@@@@ -263,9 +273,11 @@@@ char **argv;
d145 1
a145 1
@@@@ -312,7 +324,7 @@@@ char **argv;
d154 1
a154 1
@@@@ -492,7 +504,7 @@@@ static int do_X_opt()
d163 1
a163 1
@@@@ -502,7 +514,7 @@@@ static int do_k_opt()
d172 1
a172 1
@@@@ -512,7 +524,7 @@@@ static int do_c_opt()
d181 1
a181 1
@@@@ -528,8 +540,8 @@@@ static int do_l_opt()
d192 1
a192 1
@@@@ -538,7 +550,7 @@@@ static int do_D_opt()
d201 1
a201 1
@@@@ -581,14 +593,14 @@@@ char **argv;
d220 1
a220 1
@@@@ -600,7 +612,7 @@@@ char **argv;
d229 1
a229 1
@@@@ -642,11 +654,11 @@@@ j_term_init()
d244 1
a244 1
@@@@ -678,13 +690,13 @@@@ get_rubout()
d260 1
a260 1
@@@@ -705,7 +717,7 @@@@ j_term_init()
d269 1
a269 1
@@@@ -764,14 +776,15 @@@@ intfntype
d290 1
a290 1
@@@@ -1107,7 +1120,7 @@@@ char **argv;
d299 1
a299 1
@@@@ -1140,16 +1153,18 @@@@ char **argv;
d320 1
a320 1
@@@@ -1187,7 +1202,7 @@@@ char **argv;
d329 17
a345 1
@@@@ -1342,7 +1357,7 @@@@ open_ttyp()
d354 1
a354 1
@@@@ -1446,11 +1461,23 @@@@ open_ttyp()
d378 1
a378 1
@@@@ -1524,15 +1551,13 @@@@ do_end()
d397 1
a397 1
@@@@ -1562,9 +1587,11 @@@@ do_end()
d409 1
a409 1
@@@@ -1636,7 +1663,16 @@@@ ptyname(b, pty, no)
d426 1
a426 1
@@@@ -1755,14 +1791,14 @@@@ change_size()
d443 1
a443 1
@@@@ -1770,7 +1806,8 @@@@ change_size()
d453 1
a453 1
@@@@ -1781,7 +1818,6 @@@@ change_size()
@


1.3
log
@don't use union wait
@
text
@d1 3
a3 3
$OpenBSD: patch-Wnn_uum_jhlp_c,v 1.2 2000/04/20 22:59:21 espie Exp $
--- Wnn/uum/jhlp.c.orig	Sun Nov 13 06:00:12 2011
+++ Wnn/uum/jhlp.c	Sun Nov 13 06:05:52 2011
d14 33
a46 1
@@@@ -166,14 +169,14 @@@@ char **argv;
d64 1
a64 1
@@@@ -185,12 +188,7 @@@@ char **argv;
d78 1
a78 1
@@@@ -233,8 +231,8 @@@@ char **argv;
d89 1
a89 1
@@@@ -263,9 +261,11 @@@@ char **argv;
d101 10
a110 1
@@@@ -492,7 +492,7 @@@@ static int do_X_opt()
d119 1
a119 1
@@@@ -502,7 +502,7 @@@@ static int do_k_opt()
d128 1
a128 1
@@@@ -512,7 +512,7 @@@@ static int do_c_opt()
d137 1
a137 1
@@@@ -528,8 +528,8 @@@@ static int do_l_opt()
d148 1
a148 1
@@@@ -538,7 +538,7 @@@@ static int do_D_opt()
d157 1
a157 1
@@@@ -581,14 +581,14 @@@@ char **argv;
d176 50
a225 1
@@@@ -764,14 +764,15 @@@@ intfntype
d246 10
a255 1
@@@@ -1140,9 +1141,11 @@@@ char **argv;
d265 2
a266 1
 #ifdef linux
d268 27
a294 1
@@@@ -1446,11 +1449,23 @@@@ open_ttyp()
d318 20
a337 1
@@@@ -1562,9 +1577,11 @@@@ do_end()
d349 1
a349 1
@@@@ -1636,7 +1653,16 @@@@ ptyname(b, pty, no)
d366 1
a366 1
@@@@ -1755,14 +1781,14 @@@@ change_size()
d383 1
a383 1
@@@@ -1770,7 +1796,8 @@@@ change_size()
d393 1
a393 1
@@@@ -1781,7 +1808,6 @@@@ change_size()
@


1.2
log
@Handle window size changes.
Don't change the terminal name.
@
text
@d1 3
a3 3
$OpenBSD: patch-Wnn_uum_jhlp_c,v 1.1 2000/04/16 21:53:31 espie Exp $
--- Wnn/uum/jhlp.c.orig	Sun Apr 16 02:31:48 2000
+++ Wnn/uum/jhlp.c	Sun Apr 16 14:06:49 2000
d135 9
a143 2
@@@@ -771,7 +771,12 @@@@ chld_handler()
 #endif
d156 1
a156 1
@@@@ -1140,9 +1145,11 @@@@ char **argv;
d168 1
a168 1
@@@@ -1446,11 +1453,23 @@@@ open_ttyp()
d192 1
a192 1
@@@@ -1562,9 +1581,11 @@@@ do_end()
d204 1
a204 1
@@@@ -1636,7 +1657,16 @@@@ ptyname(b, pty, no)
d221 1
a221 1
@@@@ -1755,14 +1785,14 @@@@ change_size()
d238 1
a238 1
@@@@ -1770,7 +1800,8 @@@@ change_size()
d248 1
a248 1
@@@@ -1781,7 +1812,6 @@@@ change_size()
@


1.1
log
@Loads of changes, not quite finished yet.

- format man pages using new jgroff, so that we can install a full set
of documentation.
- move INSTALL script into a separate script, so that adding a new user
need not be done at the time of INSTALL.
- add a few strlcpy to fix a few holes. This stuff is rather bad, though.
- use terminfo instead of termcap, for better keycap names, fixing quite
a few bugs that made it impossible to build that version along the way...
- move scripts into /usr/local/bin instead of /usr/local/bin/Wnn4.

- use @@comment no checksum
in packing list, even though pkg_add does not support that yet.
Not quite completely ready, but getting there...
@
text
@d1 3
a3 3
$OpenBSD$
--- Wnn/uum/jhlp.c.orig	Sat Apr 15 21:09:13 2000
+++ Wnn/uum/jhlp.c	Sat Apr 15 21:38:38 2000
d161 25
a185 1
@@@@ -1562,9 +1569,11 @@@@ do_end()
d197 1
a197 1
@@@@ -1636,7 +1645,16 @@@@ ptyname(b, pty, no)
d214 35
@

