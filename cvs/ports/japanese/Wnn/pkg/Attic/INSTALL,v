head	1.3;
access;
symbols
	OPENBSD_2_6:1.2.0.4
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.2
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.1.0.2
	OPENBSD_2_4_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2000.04.16.21.53.39;	author espie;	state dead;
branches;
next	1.2;

1.2
date	98.11.22.00.13.44;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	98.07.29.01.31.18;	author espie;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Loads of changes, not quite finished yet.

- format man pages using new jgroff, so that we can install a full set
of documentation.
- move INSTALL script into a separate script, so that adding a new user
need not be done at the time of INSTALL.
- add a few strlcpy to fix a few holes. This stuff is rather bad, though.
- use terminfo instead of termcap, for better keycap names, fixing quite
a few bugs that made it impossible to build that version along the way...
- move scripts into /usr/local/bin instead of /usr/local/bin/Wnn4.

- use @@comment no checksum
in packing list, even though pkg_add does not support that yet.
Not quite completely ready, but getting there...
@
text
@#!/bin/sh
# an installation script for Wnn4.2

ask() {
    local question default answer

    question=$1
    default=$2
    if [ -z "${PACKAGE_BUILDING}" ]; then
	read "${question} (y/n) [${default}]? " answer
    fi
    if [ x${answer} = x ]; then
	answer=${default}
    fi
    echo ${answer}
}

yesno() {
    local dflt question answer

    question=$1
    dflt=$2
    while :; do
	answer=$(ask "${question}" "${dflt}")
	case "${answer}" in
	[Yy]*)		return 0;;
	[Nn]*)		return 1;;
	esac
	echo "Please answer yes or no."
    done
}

case $2 in
PRE-INSTALL)

    ## Hack /etc/master.passwd ##
    # check
    id_69=`id -u 69 2> /dev/null`
    id_wnn=`id -u wnn 2> /dev/null`
    if [ X"$id_wnn" != X ];then
	exit 0
    elif [ X"$id_69" != X ]; then
	cat <<EOF

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
This system already has an account whose name is not 'wnn' and ID
number is 69.

   '`id 69`'

For Wnn4.2 in this port or package, ID number of 'wnn' has to be 69.
Please try again after you delete the account.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
EOF
	exit 1
    fi

    # add an account 'wnn' to this system
    echo ""
    echo "You need an account 'wnn' whose ID number is 69"
    if yesno "Would you like to create it automatically?" y; then
	 gid=`id -g bin`
	 chpass -a "wnn:*:69:${gid}::::Wnn server:/root:/sbin/nologin"
    else
	echo "Please create it, and try again."
	exit 1
    fi
    ;;

POST-INSTALL)

    case $1 in
      ja-Wnn-4.2)
	sys_dirs="${PKG_PREFIX}/lib/wnn/ja_JP/dic/pubdic ${PKG_PREFIX}/lib/wnn/ja_JP/dic/wnncons"
	usr_dirs=${PKG_PREFIX}/lib/wnn/ja_JP/dic/usr
	wnntouch=${PKG_PREFIX}/bin/Wnn4/wnntouch
	wnnserver=${PKG_PREFIX}/bin/Wnn4/jserver
	wnnname=Wnn
	;;
      zh-Wnn-4.2)
	sys_dirs="${PKG_PREFIX}/lib/wnn/zh_CN/dic/sys ${PKG_PREFIX}/lib/wnn/zh_TW/dic/sys"
	usr_dirs="${PKG_PREFIX}/lib/wnn/zh_CN/dic/usr ${PKG_PREFIX}/lib/wnn/zh_TW/dic/usr"
	wnntouch=${PKG_PREFIX}/bin/cWnn4/cwnntouch
	wnnserver=${PKG_PREFIX}/bin/cWnn4/cserver
	wnnname=cWnn
	;;
      ko-Wnn-4.2)
	sys_dirs="${PKG_PREFIX}/lib/wnn/ko_KR/dic/sys"
	usr_dirs=${PKG_PREFIX}/lib/wnn/ko_KR/dic/usr
	wnntouch=${PKG_PREFIX}/bin/kWnn4/kwnntouch
	wnnserver=${PKG_PREFIX}/bin/kWnn4/kserver
	wnnname=kWnn
	;;
    esac

    for dir in $sys_dirs; do
      $wnntouch $dir/*
    done
    for dir in $usr_dirs; do
      if [ ! -d $dir ]; then
	mkdir -p $dir
      fi
      chown wnn $dir
    done
    ;;
esac
@


1.2
log
@remove a few looked over FreeBSD-isms.
@
text
@@


1.1
log
@
First cut at a japanese environment
@
text
@d10 1
a10 1
	read -p "${question} (y/n) [${default}]? " answer
d62 2
a63 2
	adduser -noconfig -uid 69 -group bin -shell /sbin/nologin \
		-home /root -batch wnn bin 
a104 14

    ## create a startup script ##
    startup_script=${PKG_PREFIX}/etc/rc.d/${wnnname}.sh
    if [ ! -f ${startup_script} ]; then
      echo "Installing ${startup_script} startup file.";
      echo '#!/bin/sh' > ${startup_script};
      echo "wnn=${wnnserver}" >> ${startup_script};
      echo 'if [ -f $wnn ]; then' >> ${startup_script};
      echo "    echo -n ' ${wnnname}'" >> ${startup_script};
      echo '    $wnn' >> ${startup_script};
      echo "fi" >> ${startup_script};
      chmod 755 ${startup_script};
      chown bin.bin ${startup_script};
    fi
@

