head	1.1;
access;
symbols
	OPENBSD_6_0:1.1.0.12
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.8
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.10
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.6
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.4
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.2
	OPENBSD_5_5_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2013.12.08.15.09.15;	author espie;	state Exp;
branches;
next	;


desc
@@


1.1
log
@switch to termios, add missing code (set_cbreak).
also switch from select to poll, as the select code won't work past fd #32...
@
text
@$OpenBSD$
--- sys/tty.c.orig	Sun Dec  8 16:06:46 2013
+++ sys/tty.c	Sun Dec  8 16:07:22 2013
@@@@ -76,8 +76,16 @@@@ Onew_ttyIcanon(on)
 	if( on )
 		buf.c_lflag |= (ECHO|ICANON);
 	else	buf.c_lflag &= ~(ECHO|ICANON);
+	if( on ){
+		buf.c_cc[VMIN]  = 1;
+		buf.c_cc[VTIME] = 0;
+		buf.c_lflag &= ~ICANON;
+	}else{
+		buf.c_cc[VMIN]  = 0;
+		buf.c_cc[VTIME] = ('D'-0x40);
+		buf.c_lflag |=  ICANON;
+	}
 	tcsetattr(fd, TCSADRAIN, &buf);
-	set_cbreak(fd,!on);
 	close(fd);
 }
 #endif
@
