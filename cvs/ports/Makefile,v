head	1.76;
access;
symbols
	OPENBSD_6_2:1.76.0.8
	OPENBSD_6_2_BASE:1.76
	OPENBSD_6_1:1.76.0.6
	OPENBSD_6_1_BASE:1.76
	OPENBSD_6_0:1.76.0.4
	OPENBSD_6_0_BASE:1.76
	OPENBSD_5_9:1.76.0.2
	OPENBSD_5_9_BASE:1.76
	OPENBSD_5_8:1.75.0.4
	OPENBSD_5_8_BASE:1.75
	OPENBSD_5_7:1.74.0.10
	OPENBSD_5_7_BASE:1.74
	OPENBSD_5_6:1.74.0.8
	OPENBSD_5_6_BASE:1.74
	OPENBSD_5_5:1.74.0.6
	OPENBSD_5_5_BASE:1.74
	OPENBSD_5_4:1.74.0.4
	OPENBSD_5_4_BASE:1.74
	OPENBSD_5_3:1.74.0.2
	OPENBSD_5_3_BASE:1.74
	OPENBSD_5_2:1.69.0.2
	OPENBSD_5_2_BASE:1.69
	OPENBSD_5_1_BASE:1.67
	OPENBSD_5_1:1.67.0.2
	pascal_20111114:1.1.1.2
	pascal:1.1.1
	OPENBSD_5_0:1.66.0.2
	OPENBSD_5_0_BASE:1.66
	OPENBSD_4_9:1.65.0.2
	OPENBSD_4_9_BASE:1.65
	OPENBSD_4_8:1.63.0.2
	OPENBSD_4_8_BASE:1.63
	OPENBSD_4_7:1.62.0.4
	OPENBSD_4_7_BASE:1.62
	OPENBSD_4_6:1.61.0.4
	OPENBSD_4_6_BASE:1.61
	OPENBSD_4_5:1.61.0.2
	OPENBSD_4_5_BASE:1.61
	form_20090209:1.1.1.1
	form:1.1.1.1
	sysutils/memtest86+:1.1.1
	OPENBSD_4_4:1.60.0.2
	OPENBSD_4_4_BASE:1.60
	OPENBSD_4_3:1.56.0.2
	OPENBSD_4_3_BASE:1.56
	OPENBSD_4_2:1.55.0.2
	OPENBSD_4_2_BASE:1.55
	OPENBSD_4_1:1.54.0.4
	OPENBSD_4_1_BASE:1.54
	OPENBSD_4_0:1.50.0.8
	OPENBSD_4_0_BASE:1.50
	OPENBSD_3_9:1.50.0.4
	OPENBSD_3_9_BASE:1.50
	OPENBSD_3_8:1.50.0.2
	OPENBSD_3_8_BASE:1.50
	OPENBSD_3_7:1.48.0.2
	OPENBSD_3_7_BASE:1.48
	OPENBSD_3_6:1.46.0.2
	OPENBSD_3_6_BASE:1.46
	OPENBSD_3_5:1.43.0.2
	OPENBSD_3_5_BASE:1.43
	OPENBSD_3_4:1.42.0.2
	OPENBSD_3_4_BASE:1.42
	OPENBSD_3_3:1.38.0.4
	OPENBSD_3_3_BASE:1.38
	OPENBSD_3_2:1.38.0.2
	OPENBSD_3_2_BASE:1.38
	OPENBSD_3_1:1.37.0.2
	OPENBSD_3_1_BASE:1.37
	OPENBSD_3_0:1.33.0.2
	OPENBSD_3_0_BASE:1.33
	OPENBSD_2_9_TRACKING_SWITCH:1.32
	OPENBSD_2_9:1.28.0.2
	OPENBSD_2_9_BASE:1.28
	OPENBSD_2_8:1.27.0.2
	OPENBSD_2_8_BASE:1.27
	OPENBSD_2_7:1.24.0.2
	OPENBSD_2_7_BASE:1.24
	OPENBSD_2_6:1.16.0.2
	OPENBSD_2_6_BASE:1.16
	OPENBSD_2_5:1.15.0.4
	OPENBSD_2_5_BASE:1.15
	OPENBSD_2_4:1.15.0.2
	OPENBSD_2_4_BASE:1.15
	OPENBSD_2_3:1.8.0.2
	OPENBSD_2_3_BASE:1.8;
locks; strict;
comment	@# @;


1.76
date	2015.08.19.17.06.51;	author naddy;	state Exp;
branches;
next	1.75;
commitid	yu2l4hhVhEoswJ49;

1.75
date	2015.04.13.13.46.58;	author naddy;	state Exp;
branches;
next	1.74;
commitid	DCyEwkkWNG9IVTNv;

1.74
date	2013.01.06.16.14.10;	author espie;	state Exp;
branches;
next	1.73;

1.73
date	2012.10.08.08.42.23;	author jasper;	state Exp;
branches;
next	1.72;

1.72
date	2012.09.04.19.05.45;	author jasper;	state Exp;
branches;
next	1.71;

1.71
date	2012.09.04.07.15.39;	author ajacoutot;	state Exp;
branches;
next	1.70;

1.70
date	2012.08.18.12.41.37;	author ajacoutot;	state Exp;
branches;
next	1.69;

1.69
date	2012.05.28.09.38.04;	author espie;	state Exp;
branches;
next	1.68;

1.68
date	2012.03.09.10.57.54;	author espie;	state Exp;
branches;
next	1.67;

1.67
date	2011.11.12.16.37.35;	author ajacoutot;	state Exp;
branches;
next	1.66;

1.66
date	2011.07.19.09.28.52;	author jasper;	state Exp;
branches;
next	1.65;

1.65
date	2010.08.20.23.11.07;	author espie;	state Exp;
branches;
next	1.64;

1.64
date	2010.08.20.15.02.24;	author espie;	state Exp;
branches;
next	1.63;

1.63
date	2010.04.20.10.03.36;	author espie;	state Exp;
branches;
next	1.62;

1.62
date	2009.10.12.10.25.40;	author espie;	state Exp;
branches;
next	1.61;

1.61
date	2008.08.20.00.04.30;	author espie;	state Exp;
branches;
next	1.60;

1.60
date	2008.07.04.15.43.39;	author sturm;	state Exp;
branches;
next	1.59;

1.59
date	2008.07.04.15.37.23;	author espie;	state Exp;
branches;
next	1.58;

1.58
date	2008.05.18.11.22.14;	author espie;	state Exp;
branches;
next	1.57;

1.57
date	2008.05.16.18.31.11;	author espie;	state Exp;
branches;
next	1.56;

1.56
date	2007.09.23.18.14.51;	author pvalchev;	state Exp;
branches;
next	1.55;

1.55
date	2007.07.28.12.58.34;	author espie;	state Exp;
branches;
next	1.54;

1.54
date	2006.11.27.15.38.01;	author espie;	state Exp;
branches;
next	1.53;

1.53
date	2006.10.30.17.49.04;	author ckuethe;	state Exp;
branches;
next	1.52;

1.52
date	2006.10.18.23.16.27;	author espie;	state Exp;
branches;
next	1.51;

1.51
date	2006.10.18.13.52.33;	author sturm;	state Exp;
branches;
next	1.50;

1.50
date	2005.09.02.00.43.50;	author pvalchev;	state Exp;
branches;
next	1.49;

1.49
date	2005.06.08.03.58.55;	author pvalchev;	state Exp;
branches;
next	1.48;

1.48
date	2005.03.02.20.51.07;	author pvalchev;	state Exp;
branches;
next	1.47;

1.47
date	2004.09.26.01.05.33;	author jolan;	state Exp;
branches;
next	1.46;

1.46
date	2004.07.20.12.01.13;	author espie;	state Exp;
branches;
next	1.45;

1.45
date	2004.06.21.21.28.29;	author xsa;	state Exp;
branches;
next	1.44;

1.44
date	2004.05.07.09.04.21;	author xsa;	state Exp;
branches;
next	1.43;

1.43
date	2003.12.15.17.56.40;	author espie;	state Exp;
branches;
next	1.42;

1.42
date	2003.06.06.15.52.50;	author pvalchev;	state Exp;
branches;
next	1.41;

1.41
date	2003.05.28.13.47.04;	author avsm;	state Exp;
branches;
next	1.40;

1.40
date	2003.05.12.22.15.53;	author pb;	state Exp;
branches;
next	1.39;

1.39
date	2003.05.10.13.28.08;	author avsm;	state Exp;
branches;
next	1.38;

1.38
date	2002.08.26.22.33.22;	author brad;	state Exp;
branches;
next	1.37;

1.37
date	2002.03.13.13.51.59;	author espie;	state Exp;
branches;
next	1.36;

1.36
date	2001.11.22.16.06.27;	author naddy;	state Exp;
branches;
next	1.35;

1.35
date	2001.11.12.14.19.17;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2001.11.12.14.17.33;	author espie;	state Exp;
branches;
next	1.33;

1.33
date	2001.08.29.16.09.10;	author heko;	state Exp;
branches;
next	1.32;

1.32
date	2001.08.11.16.17.58;	author kevlo;	state Exp;
branches;
next	1.31;

1.31
date	2001.08.01.20.46.14;	author naddy;	state Exp;
branches;
next	1.30;

1.30
date	2001.07.17.22.46.28;	author pvalchev;	state Exp;
branches;
next	1.29;

1.29
date	2001.05.23.03.31.45;	author dugsong;	state Exp;
branches;
next	1.28;

1.28
date	2001.04.18.14.35.07;	author espie;	state Exp;
branches;
next	1.27;

1.27
date	2000.10.02.09.07.43;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2000.07.14.23.01.54;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2000.06.09.19.34.31;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	2000.04.18.13.40.27;	author espie;	state Exp;
branches
	1.24.2.1;
next	1.23;

1.23
date	2000.04.09.16.26.13;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	2000.04.09.12.45.55;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2000.03.04.18.16.02;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2000.03.03.14.23.10;	author turan;	state Exp;
branches;
next	1.19;

1.19
date	2000.02.22.09.27.51;	author turan;	state Exp;
branches;
next	1.18;

1.18
date	2000.02.22.03.45.11;	author turan;	state Exp;
branches;
next	1.17;

1.17
date	2000.02.21.22.09.57;	author turan;	state Exp;
branches;
next	1.16;

1.16
date	99.07.27.21.56.35;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	98.09.24.20.31.28;	author marc;	state Exp;
branches;
next	1.14;

1.14
date	98.09.14.01.41.53;	author marc;	state Exp;
branches;
next	1.13;

1.13
date	98.08.05.22.12.03;	author marc;	state Exp;
branches;
next	1.12;

1.12
date	98.07.21.09.20.05;	author form;	state Exp;
branches;
next	1.11;

1.11
date	98.06.03.23.03.12;	author marc;	state Exp;
branches;
next	1.10;

1.10
date	98.05.17.04.32.00;	author angelos;	state Exp;
branches;
next	1.9;

1.9
date	98.04.29.05.04.13;	author angelos;	state Exp;
branches;
next	1.8;

1.8
date	98.02.06.13.28.00;	author niklas;	state Exp;
branches;
next	1.7;

1.7
date	97.12.03.04.12.31;	author angelos;	state Exp;
branches;
next	1.6;

1.6
date	97.12.02.10.58.17;	author niklas;	state Exp;
branches;
next	1.5;

1.5
date	97.12.02.10.38.24;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	97.12.02.10.34.45;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	97.12.02.08.59.31;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	97.12.02.00.32.33;	author angelos;	state Exp;
branches;
next	1.1;

1.1
date	97.11.27.23.44.36;	author niklas;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.02.09.14.42.32;	author form;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2011.11.14.12.45.49;	author pascal;	state Exp;
branches;
next	;

1.24.2.1
date	2000.09.15.04.39.30;	author marc;	state Exp;
branches;
next	;


desc
@@


1.76
log
@override ARCH too so INDEX builds are the same everywhere
diagnosed by espie@@; ok sthen@@ espie@@
@
text
@# $OpenBSD: Makefile,v 1.75 2015/04/13 13:46:58 naddy Exp $

.if !defined(BSD_OWN_MK)
.  include <bsd.own.mk>
.endif

PKGPATH =
MIRROR_MK ?= ${.CURDIR}/distfiles/Makefile
DISTFILES_DB ?= ${.CURDIR}/infrastructure/db/locate.database

.if defined(SUBDIR)
# nothing to do
.elif defined(key) || defined(name) || defined(category) || defined(author)

# set up subdirs from the index, assume it's up-to-date
_CMD = perl ${.CURDIR}/infrastructure/bin/retrieve-index index='${.CURDIR}/INDEX'
.  if defined(key)
_CMD += key='${key}'
.  endif
.  if defined(name)
_CMD += maintainer='${name}'
.  endif
.  if defined(category)
_CMD += category='${category}'
.  endif
.  if defined(maintainer)
_CMD += maintainer='${maintainer}'
.  endif
SUBDIR != ${_CMD}
.elif defined(SUBDIRLIST)
SUBDIR != sed -e 's,[ 	]*\#.*,,' -e '/^[ 	]*$$/d' ${SUBDIRLIST}
.else
SUBDIR += archivers
SUBDIR += astro
SUBDIR += audio
SUBDIR += benchmarks
SUBDIR += biology
SUBDIR += books
SUBDIR += cad
SUBDIR += chinese
SUBDIR += comms
SUBDIR += converters
SUBDIR += databases
SUBDIR += devel
SUBDIR += editors
SUBDIR += education
SUBDIR += emulators
SUBDIR += fonts
SUBDIR += games
SUBDIR += geo
SUBDIR += graphics
SUBDIR += inputmethods
SUBDIR += japanese
SUBDIR += java
SUBDIR += korean
SUBDIR += lang
SUBDIR += mail
SUBDIR += math
SUBDIR += meta
SUBDIR += misc
SUBDIR += multimedia
SUBDIR += net
SUBDIR += news
SUBDIR += plan9
SUBDIR += print
SUBDIR += productivity
SUBDIR += security
SUBDIR += shells
SUBDIR += sysutils
SUBDIR += telephony
SUBDIR += textproc
SUBDIR += www
SUBDIR += x11
.endif

.include <bsd.port.subdir.mk>

index:
	@@rm -f ${.CURDIR}/INDEX
	@@${_MAKE} USE_CCACHE=No ${.CURDIR}/INDEX

${.CURDIR}/INDEX:
	@@echo "Generating INDEX..."
	@@${_MAKE} describe MACHINE_ARCH=amd64 ARCH=amd64 ECHO_MSG="echo 1>&2" > ${.CURDIR}/INDEX
	@@echo "Done."

print-index:	${.CURDIR}/INDEX
	@@awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nL-deps:\t%s\nB-deps:\t%s\nR-deps:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9, $$10); }' < ${.CURDIR}/INDEX

print-licenses: ${.CURDIR}/INDEX
	@@printf "Port                                    PC PF DC DF Maint\n"
	@@awk -F\| '{printf("%-40.39s%-3.2s%-3.2s%-3.2s%-3.2s%-25.25s\n",$$2,$$12,$$13,$$14,$$15,$$6);}' < ${.CURDIR}/INDEX

search:	${.CURDIR}/INDEX
.if !defined(key) && !defined(name)
	@@echo "The search target requires a keyword or name parameter,"
	@@echo "e.g.: \"make search key=somekeyword\" \"make search name=somename\""
.else
.  if defined(key)
	@@egrep -i -- "${key}" ${.CURDIR}/INDEX | awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nL-deps:\t%s\nB-deps:\t%s\nR-deps:\t%s\nArchs:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9, $$10, $$11); }'
.  else
	@@awk -F\| '$$1 ~ /${name}/ { printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nL-deps:\t%s\nB-deps:\t%s\nR-deps:\t%s\nArchs:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9, $$10, $$11); }' ${.CURDIR}/INDEX
.  endif
.endif

homepages.html:
	@@echo '<html><ul>' >$@@
	@@${_MAKE} homepage-links ECHO_MSG='echo >&2' >>$@@
	@@echo '</ul></html>' >>$@@

distfiles-update-locatedb:
	@@PORTSDIR=${.CURDIR} /bin/sh ${.CURDIR}/infrastructure/fetch/distfiles-update-locatedb ${DISTFILES_DB}

pkglocatedb:
	@@pkg_mklocatedb -a -d ${.CURDIR}/packages/${MACHINE_ARCH}/all/ \
	    >${.CURDIR}/packages/${MACHINE_ARCH}/ftp/pkglocatedb

.PHONY: index search distfiles-update-locatedb \
	pkglocatedb print-licenses print-index
@


1.75
log
@switch the INDEX build to amd64, which nowadays builds more packages than i386
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.74 2013/01/06 16:14:10 espie Exp $
d84 1
a84 1
	@@${_MAKE} describe MACHINE_ARCH=amd64 ECHO_MSG="echo 1>&2" > ${.CURDIR}/INDEX
@


1.74
log
@stupid thing I should have done years ago: grab bsd.own.mk (and /etc/mk.conf)
first thing, so that we can override any definition in there.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2012/10/08 08:42:23 jasper Exp $
d84 1
a84 1
	@@${_MAKE} describe MACHINE_ARCH=i386 ECHO_MSG="echo 1>&2" > ${.CURDIR}/INDEX
@


1.73
log
@override USE_CCACHE to "No" when generating the index or hilarity ensues.

ok espie@@
@
text
@d1 5
a5 1
# $OpenBSD: Makefile,v 1.72 2012/09/04 19:05:45 jasper Exp $
@


1.72
log
@in soviet russia, category removes you
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2012/09/04 07:15:39 ajacoutot Exp $
d76 1
a76 1
	@@${_MAKE} ${.CURDIR}/INDEX
@


1.71
log
@-palm
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2012/08/18 12:41:37 ajacoutot Exp $
a62 1
SUBDIR += russian
@


1.70
log
@Remove irrelevant $FreeBSD RCS ids.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2012/05/28 09:38:04 espie Exp $
a59 1
SUBDIR += palm
@


1.69
log
@zap old readmes infrastructure, replaced by new age databases/ports-readmes
which is ways more accurate anyways.
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.68 2012/03/09 10:57:54 espie Exp $
# $FreeBSD: Makefile,v 1.36 1997/10/04 15:54:31 jkh Exp $
#
@


1.68
log
@remove last remnants of mirror-maker
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2011/11/12 16:37:35 ajacoutot Exp $
a6 1
PORTSTOP ?= yes
@


1.67
log
@Add new CATEGORY: meta, for meta-packages.

ok loop...
"sure, but ask naddy" espie@@
"sure but ask espie" naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2011/07/19 09:28:52 jasper Exp $
a9 1

a106 25
mirror-maker:
	@@mkdir -p ${MIRROR_MK:H}
.if !empty(LOCKDIR)
	@@echo "EXEC = " >${MIRROR_MK}
	@@echo 'LOCKDIR = ${LOCKDIR}' >>${MIRROR_MK}
	@@echo 'PORTSDIR = ${PORTSDIR}' >>${MIRROR_MK}
	@@echo 'LOCK_CMD = perl $${PORTSDIR}/infrastructure/bin/dolock' >>${MIRROR_MK}
	@@echo 'UNLOCK_CMD = rm -f' >>${MIRROR_MK}
	@@echo 'SIMPLE_LOCK = $${LOCK_CMD} $${LOCKDIR}/$$$$lock.lock; trap "$${UNLOCK_CMD} $${LOCKDIR}/$$$$lock.lock" 0 1 2 3 13 15' >>${MIRROR_MK}
.else
	@@echo "EXEC = exec" >${MIRROR_MK}
	@@echo 'SIMPLE_LOCK = :' >>${MIRROR_MK}
.endif

	@@echo '' >>${MIRROR_MK}
	@@echo "default:: ftp cdrom" >>${MIRROR_MK}
	@@echo ".PHONY: default all ftp cdrom .FORCE" >>${MIRROR_MK}
	@@echo ".FORCE:" >>${MIRROR_MK}
	@@_DONE_FILES=`mktemp /tmp/depends.XXXXXXXXX|| exit 1`; \
	export _DONE_FILES; \
	trap "rm -f $${_DONE_FILES}" 0 1 2 3 13 15; \
	${_MAKE} fetch-makefile \
		ECHO_MSG='echo >&2' \
		_FETCH_MAKEFILE=${MIRROR_MK}

d119 1
a119 1
.PHONY: mirror-maker index search distfiles-update-locatedb \
@


1.66
log
@enter fonts
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2010/08/20 23:11:07 espie Exp $
d59 1
@


1.65
log
@move LOCKDIR default to pkgpath.mk since it's shared with Makefile.
fix one missed dolock.

Thanks naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2010/08/20 15:02:24 espie Exp $
d48 1
@


1.64
log
@use scripts from bin
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2010/04/20 10:03:36 espie Exp $
a105 2
LOCKDIR ?=

d112 1
a112 1
	@@echo 'LOCK_CMD = perl $${PORTSDIR}/infrastructure/build/dolock' >>${MIRROR_MK}
@


1.63
log
@provide a _MAKE internal that does the cd ${.CURDIR} && exec,
use it to avoid the obj/ problem in /usr/ports.
provide a _MAKESYS internal for bsd.port.mk with SYSTRACE too
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2009/10/12 10:25:40 espie Exp $
d16 1
a16 1
_CMD = perl ${.CURDIR}/infrastructure/build/index-retrieve index='${.CURDIR}/INDEX'
@


1.62
log
@default locatedb is more useful with paths as well
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2008/08/20 00:04:30 espie Exp $
d80 1
a80 1
	@@${MAKE} ${.CURDIR}/INDEX
d84 1
a84 1
	@@${MAKE} describe MACHINE_ARCH=i386 ECHO_MSG="echo 1>&2" > ${.CURDIR}/INDEX
d129 1
a129 1
	${MAKE} fetch-makefile \
d135 1
a135 1
	@@${MAKE} homepage-links ECHO_MSG='echo >&2' >>$@@
@


1.61
log
@add .FORCE phony target to mirror-maker, so that you can set F=.FORCE to
force redoing something on every target easily.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2008/07/04 15:43:39 sturm Exp $
d142 1
a142 1
	@@pkg_mklocatedb -d ${.CURDIR}/packages/${MACHINE_ARCH}/all/ \
@


1.60
log
@need full path to lock for unlocking
ok espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2008/07/04 15:37:23 espie Exp $
d124 2
a125 1
	@@echo ".PHONY: default all ftp cdrom" >>${MIRROR_MK}
@


1.59
log
@let EXEC and SIMPLE_LOCK have sensible definitions, as noticed by
sturm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2008/05/18 11:22:14 espie Exp $
d116 1
a116 1
	@@echo 'SIMPLE_LOCK = $${LOCK_CMD} $${LOCKDIR}/$$$$lock.lock; trap "$${UNLOCK_CMD} $$$$lock.lock" 0 1 2 3 13 15' >>${MIRROR_MK}
@


1.58
log
@add a bit of glue so that mirror-maker will be able to use the same locks
as the rest of the tree
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2008/05/16 18:31:11 espie Exp $
a109 3
# Indirection needed for broken OSes that don't grok this exec
	@@echo "EXEC = exec" >${MIRROR_MK}
	@@echo "SIMPLE_LOCK = : ">>${MIRROR_MK}
d111 1
d118 1
@


1.57
log
@use new pkg_locatedb -d to get all packages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2007/09/23 18:14:51 pvalchev Exp $
d112 1
@


1.56
log
@when generating INDEX, force MACHINE_ARCH=i386 to generate a "MI"-index
(we will do better in the future, but for now this is ok)
ok espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2007/07/28 12:58:34 espie Exp $
d106 1
d111 12
a122 1
	@@echo "EXEC=exec" >${MIRROR_MK}
d141 1
a141 1
	@@pkg_mklocatedb ${.CURDIR}/packages/${MACHINE_ARCH}/all/* \
@


1.55
log
@make mirror-maker sturdier:
- pass an argument for the file into which we want to save the result, to
avoid getting it polluted with error messages (defaults to /dev/stdout for
debug).
- create the makefile fragment as a temp file and only copy it when complete.
- copy it in one chunk, so that one can read a partial mirror-maker file
and have it be usable.

This does allow for people to start a make mirror-maker in one shell, and
start fetching stuff right away, before mirror-maker is finished.

This also produces usable mirror-maker Makefiles even if the ports tree
contains bogus entries.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2006/11/27 15:38:01 espie Exp $
d84 1
a84 1
	@@${MAKE} describe ECHO_MSG="echo 1>&2" > ${.CURDIR}/INDEX
@


1.54
log
@same formatting clean-up as bsd.port.mk
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2006/10/30 17:49:04 ckuethe Exp $
d118 1
a118 1
		>>${MIRROR_MK}
@


1.53
log
@add "geo"
ok pval, ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2006/10/18 23:16:27 espie Exp $
d5 6
a10 1
PKGPATH=
d16 13
a28 13
_CMD=perl ${.CURDIR}/infrastructure/build/index-retrieve index='${.CURDIR}/INDEX'
.    if defined(key)
_CMD+=key='${key}'
.    endif
.    if defined(name)
_CMD+=maintainer='${name}'
.    endif
.    if defined(category)
_CMD+=category='${category}'
.    endif
.    if defined(maintainer)
_CMD+=maintainer='${maintainer}'
.    endif
a75 2
PORTSTOP?=	yes

d99 1
a99 1
. if defined(key)
d101 1
a101 1
. else
d103 1
a103 1
. endif
a106 2
MIRROR_MK?= ${.CURDIR}/distfiles/Makefile

a123 2

DISTFILES_DB?=${.CURDIR}/infrastructure/db/locate.database
@


1.52
log
@+inputmethods/anthy
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2006/10/18 13:52:33 sturm Exp $
d44 1
@


1.51
log
@as discussed on icb, remove too old to be of much use and unmaintained
mbone category
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2005/09/02 00:43:50 pvalchev Exp $
d45 1
@


1.50
log
@do not compress pkglocatedb so it can directly be used by locate(1)
after discussion with deraadt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2005/06/08 03:58:55 pvalchev Exp $
a50 1
SUBDIR += mbone
@


1.49
log
@clean commented out SUBDIRs we don't have; they will be added if needed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2005/03/02 20:51:07 pvalchev Exp $
d129 2
a130 2
	@@pkg_mklocatedb ${.CURDIR}/packages/${MACHINE_ARCH}/all/* | \
	    gzip >${.CURDIR}/packages/${MACHINE_ARCH}/ftp/pkglocatedb.gz
@


1.48
log
@add "pkglocatedb" target to build a pkg_mklocatedb(1) database; ok espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2004/09/26 01:05:33 jolan Exp $
a43 1
#SUBDIR += german
a65 1
#SUBDIR += vietnamese
@


1.47
log
@+telephony
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2004/07/20 12:01:13 espie Exp $
d130 4
d135 1
a135 1
	print-licenses print-index
@


1.46
log
@shortcut: if SUBDIR is defined, warp there directly.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2004/06/21 21:28:29 xsa Exp $
d65 1
@


1.45
log
@
new `multimedia' category;
pvalchev@@ espie@@ okay.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2004/05/07 09:04:21 xsa Exp $
d6 3
a8 1
.if defined(key) || defined(name) || defined(category) || defined(author)
d12 1
a12 1
.  if defined(key)
d14 2
a15 2
.  endif
.  if defined(name)
d17 2
a18 2
.  endif
.  if defined(category)
d20 2
a21 2
.  endif
.  if defined(maintainer)
d23 1
a23 1
.  endif
@


1.44
log
@
+ biology
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2003/12/15 17:56:40 espie Exp $
d52 1
@


1.43
log
@Check for duplicates in mirror-maker entries, build Makefiles that won't
heap tons of warnings with gnu-make (and that will be slightly smaller as well).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2003/06/06 15:52:50 pvalchev Exp $
d30 1
@


1.42
log
@remove "mystuff" from makefile
ok lots of people, "whatever" espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2003/05/28 13:47:04 avsm Exp $
d108 4
a111 1
	@@${MAKE} fetch-makefile \
@


1.41
log
@+books
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2003/05/12 22:15:53 pb Exp $
a64 3
.  if exists(mystuff) && !make(describe) && !make(fetch-makefile)
SUBDIR += mystuff
.  endif
@


1.40
log
@"make search name=foo" added .. matches only the Port:-line

ok henning@@, pval@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2003/05/10 13:28:08 avsm Exp $
d30 1
@


1.39
log
@put a -- before the egrep search key so that 'make search key=-blah'
works
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2002/08/26 22:33:22 brad Exp $
d6 1
a6 1
.if defined(key) || defined(category) || defined(author)
d13 3
d90 3
a92 3
.if !defined(key)
	@@echo "The search target requires a keyword parameter,"
	@@echo "e.g.: \"make search key=somekeyword\""
d94 1
d96 3
@


1.38
log
@don't include mystuff if using mirror-maker.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2002/03/13 13:51:59 espie Exp $
d91 1
a91 1
	@@egrep -i "${key}" ${.CURDIR}/INDEX | awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nL-deps:\t%s\nB-deps:\t%s\nR-deps:\t%s\nArchs:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9, $$10, $$11); }'
@


1.37
log
@Add rules to create a list of homepage links for all ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2001/11/22 16:06:27 naddy Exp $
d61 1
a61 1
.  if exists(mystuff) && !make(describe)
@


1.36
log
@match index-related targets to the new index format; ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2001/11/12 14:19:17 espie Exp $
d106 5
@


1.35
log
@add top-level directory `mystuff' to be used by porters for stuff they
haven't committed yet. The nice part is that dependencies get transparently
resolved to mystuff/dir if they aren't found in dir.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2001/11/12 14:17:33 espie Exp $
d80 1
a80 1
	@@awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nB-deps:\t%s\nR-deps:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9); }' < ${.CURDIR}/INDEX
d84 1
a84 1
	@@awk -F\| '{printf("%-40.39s%-3.2s%-3.2s%-3.2s%-3.2s%-25.25s\n",$$2,$$11,$$12,$$13,$$14,$$6);}' < ${.CURDIR}/INDEX
d91 1
a91 1
	@@egrep -i "${key}" ${.CURDIR}/INDEX | awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nB-deps:\t%s\nR-deps:\t%s\nArchs:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9, $$10); }'
@


1.34
log
@make -> ${MAKE}
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2001/08/29 16:09:10 heko Exp $
d61 3
@


1.33
log
@in make search, use egrep instead of grep so things like
make search key="(filter|proxy)" work.

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2001/08/01 20:46:14 naddy Exp $
d69 1
a69 1
	@@make ${.CURDIR}/INDEX
d73 1
a73 1
	@@make describe ECHO_MSG="echo 1>&2" > ${.CURDIR}/INDEX
d100 1
a100 1
	@@make fetch-makefile \
@


1.32
log
@add category "java"; discussed on icb
@
text
@d88 1
a88 1
	@@grep -i ${key} ${.CURDIR}/INDEX | awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nB-deps:\t%s\nR-deps:\t%s\nArchs:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9, $$10); }'
@


1.31
log
@add category "education"; discussed with pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2001/07/17 22:46:28 pvalchev Exp $
d40 1
@


1.30
log
@+ palm
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2001/05/23 03:31:45 dugsong Exp $
d34 1
@


1.29
log
@enable korean
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2001/04/18 14:35:07 espie Exp $
d47 1
@


1.28
log
@Allows the user to specify a SUBDIRLIST (with comments), to help
automated package builds.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2000/10/02 09:07:43 espie Exp $
d39 1
a39 1
#SUBDIR += korean
@


1.27
log
@+ productivity
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2000/07/14 23:01:54 espie Exp $
d20 2
@


1.26
log
@PKGPATH
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2000/06/09 19:34:31 espie Exp $
d47 1
@


1.25
log
@Add EXEC=exec indirection to mirror-maker,
so that broken OSes (slowlaris) can say 'make EXEC=/bin/ksh' and
use the target.
Thanks, Bob (beck@@)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2000/04/18 13:40:27 espie Exp $
d5 1
a5 1

d96 1
a96 1
		FULL_PACKAGE_NAME=Yes >>${MIRROR_MK}
@


1.24
log
@author -> maintainer, use consistent terminology
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2000/04/09 16:26:13 espie Exp $
d90 3
a92 1
	@@echo "default:: ftp cdrom" >${MIRROR_MK}
@


1.24.2.1
log
@bring cut-off Makefile into 2.7 branch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2000/07/14 23:01:54 espie Exp $
d5 1
a5 1
PKGPATH=
d90 1
a90 3
# Indirection needed for broken OSes that don't grok this exec
	@@echo "EXEC=exec" >${MIRROR_MK}
	@@echo "default:: ftp cdrom" >>${MIRROR_MK}
d94 1
a94 1
		>>${MIRROR_MK}
@


1.23
log
@If key, author, category is defined on the command line,
build SUBDIRS directly from INDEX.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2000/04/09 12:45:55 espie Exp $
d16 2
a17 2
.  if defined(author)
_CMD+=author='${author}'
@


1.22
log
@Porters support: create a locate database that holds all distfile contents
it knows how to scan without extracting anything.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2000/03/04 18:16:02 espie Exp $
d5 16
d55 1
@


1.21
log
@Add fetch-makefile to bsd.port.subdir.mk, mirror-maker to main Makefile.

Tweak fetch-makefile to take PERMIT_* into account, giving us the level
of control needed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2000/03/03 14:23:10 turan Exp $
d78 8
@


1.20
log
@nix LICENSE_TYPE.  This is much prettier now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2000/02/22 09:27:51 turan Exp $
d67 11
@


1.19
log
@minor tweaks
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2000/02/22 03:45:11 turan Exp $
d57 2
a58 2
	@@printf "Port                               PC PF DC DF L-Type    Maint\n"
	@@awk -F\| '{printf("%-35.34s%-3.2s%-3.2s%-3.2s%-3.2s%-10.9s%-20.20s\n",$$2,$$11,$$12,$$13,$$14,$$15,$$6);}' < ${.CURDIR}/INDEX
@


1.18
log
@add maintainer to print-licenses
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2000/02/21 22:09:57 turan Exp $
d58 1
a58 1
	@@awk -F\| '{printf("%-35.35s%-3.2s%-3.2s%-3.2s%-3.2s%-10.9s%-20.20s\n",$$2,$$11,$$12,$$13,$$14,$$15,$$6);}' < ${.CURDIR}/INDEX
@


1.17
log
@licensing info in make describe.
make print-licenses target
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 1999/07/27 21:56:35 espie Exp $
d57 2
a58 2
	@@printf "Port                                    P-CD\tP-FTP\tD-CD\tD-FTP\tL-Type\n"
	@@awk -F\| '{printf("%-35.35s\t%s\t%s\t%s\t%s\t%s\n",$$2,$$11,$$12,$$13,$$14,$$15);}' < ${.CURDIR}/INDEX
@


1.16
log
@While rebuilding INDEX, gives some indication of progress
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 1998/09/24 20:31:28 marc Exp $
d55 4
@


1.15
log
@update INDEX and add "Archs:" to make search output
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 1998/09/14 01:41:53 marc Exp $
d49 3
a51 3
	@@echo -n "Generating INDEX - please wait.."
	@@make describe ECHO_MSG="echo > /dev/null" > ${.CURDIR}/INDEX
	@@echo " Done."
@


1.14
log
@add mbone sub-directory to makefile
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 1998/08/05 22:12:03 marc Exp $
d61 1
a61 1
	@@grep -i ${key} ${.CURDIR}/INDEX | awk -F\| '{ printf("Port:\t%s\nPath:\t%s\nInfo:\t%s\nMaint:\t%s\nIndex:\t%s\nB-deps:\t%s\nR-deps:\t%s\n\n", $$1, $$2, $$4, $$6, $$7, $$8, $$9); }'
@


1.13
log
@add japanese sub-directory
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 1998/07/21 09:20:05 form Exp $
d25 1
a25 1
#SUBDIR += mbone
@


1.12
log
@add russian to makefile
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 1998/06/03 23:03:12 marc Exp $
d20 1
a20 1
#SUBDIR += japanese
@


1.11
log
@add cad directory
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 1998/05/17 04:32:00 angelos Exp $
d31 1
a31 1
#SUBDIR += russian
@


1.10
log
@Enable math subdir
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 1998/04/29 05:04:13 angelos Exp $
d9 1
a9 1
#SUBDIR += cad
@


1.9
log
@Add converters. The xfaces Makefile isn't really changed, probably
just touched locally.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 1998/02/06 13:28:00 niklas Exp $
d24 1
a24 1
#SUBDIR += math
@


1.8
log
@Make PORTSTOP overrideable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 1997/12/03 04:12:31 angelos Exp $
d12 1
a12 1
#SUBDIR += converters
@


1.7
log
@Go into print dir.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 1997/12/02 10:58:17 niklas Exp $
d40 1
a40 1
PORTSTOP=	yes
@


1.6
log
@Prepare for lang/ ports
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 1997/12/02 10:38:24 niklas Exp $
d30 1
a30 1
#SUBDIR += print
@


1.5
log
@x11 framework
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 1997/12/02 10:34:45 niklas Exp $
d22 1
a22 1
#SUBDIR += lang
@


1.4
log
@plan9 from outer space
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 1997/12/02 08:59:31 niklas Exp $
d38 1
a38 1
#SUBDIR += x11
@


1.3
log
@Dive into audio too
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 1997/12/02 00:32:33 angelos Exp $
d29 1
a29 1
#SUBDIR += plan9
@


1.2
log
@Add astro.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 1997/11/27 23:44:36 niklas Exp $
d7 1
a7 1
#SUBDIR += audio
@


1.1
log
@Add makefiles from FreeBSD adapted to our current port set
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 1997/10/04 15:54:31 jkh Exp $
d6 1
a6 1
#SUBDIR += astro
@


1.1.1.1
log
@Import Memtest86+ 2.11

Memtest86+ is thorough, stand alone memory test for Intel i386 architecture
systems, based on the well-known Memtest86 written by Chris Brady.

ok sturm@@
@
text
@d1 62
a62 46
# $OpenBSD$
# $RuOBSD: Makefile,v 1.4 2009/02/07 10:28:55 form Exp $

ONLY_FOR_ARCHS=		amd64 i386

COMMENT=		thorough, stand alone memory test
VERSION=		2.11
DISTNAME=		memtest86+-${VERSION}
CATEGORIES=		sysutils

HOMEPAGE=		http://www.memtest.org

MAINTAINER=		Oleg Safiullin <form@@openbsd.org>

# GPLv2
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MASTER_SITES=		${HOMEPAGE}/download/${VERSION}/

USE_GMAKE=		Yes
NO_REGRESS=		Yes

post-build:
	@@cd ${WRKBUILD} && sh ${WRKDIST}/makeiso.sh
	@@sed -e s,!!PREFIX!!,${TRUEPREFIX},g ${FILESDIR}/README.OpenBSD \
	    > ${WRKBUILD}/README.OpenBSD

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/memtest86+
	${INSTALL_DATA} ${WRKDIST}/README ${PREFIX}/share/memtest86+
	${INSTALL_DATA} ${WRKBUILD}/README.OpenBSD ${PREFIX}/share/memtest86+
	${INSTALL_DATA} ${WRKBUILD}/memtest ${PREFIX}/share/memtest86+
	${INSTALL_DATA} ${WRKBUILD}/memtest_s \
	    ${PREFIX}/share/memtest86+/memtest-serial
	${INSTALL_DATA} ${WRKDIST}/memtest.bin \
	    ${PREFIX}/share/memtest86+/memtest.floppy
	${INSTALL_DATA} ${WRKDIST}/memtest_s.bin \
	    ${PREFIX}/share/memtest86+/memtest-serial.floppy
	${INSTALL_DATA} ${WRKDIST}/memtest.iso ${PREFIX}/share/memtest86+
	${INSTALL_DATA} ${WRKDIST}/memtest_s.iso \
	    ${PREFIX}/share/memtest86+/memtest-serial.iso

.include <bsd.port.mk>
@


1.1.1.2
log
@import WIP gcc 4.6.2.

ok espie@@
@
text
@d1 2
a2 1
# $OpenBSD: Makefile,v 1.66 2011/10/04 07:08:54 espie Exp $
d4 1
a4 2
ONLY_FOR_ARCHS = alpha i386 m68k sparc sparc64 powerpc vax amd64
#BROKEN=adjust for types changes
d6 39
a44 193
V = 4.6.2
FULL_VERSION = $V
FULL_PKGVERSION = $V
BOOTSTRAP_GEN = 3
# XXX this needs libc.so.61.0 to build on i386
ADASTRAP = adastrap-i386-$V-${BOOTSTRAP_GEN}.tar.xz

PKGNAME-main =  gcc-${FULL_PKGVERSION}
PKGNAME-c++ =   g++-${FULL_PKGVERSION}
PKGNAME-estdc = libstdc++-${FULL_PKGVERSION}
PKGNAME-f95 =   g95-${FULL_PKGVERSION}
PKGNAME-java =  gcj-${FULL_PKGVERSION}
PKGNAME-objc =  gobjc-${FULL_PKGVERSION}
PKGNAME-ada =   gnat-${FULL_PKGVERSION}
#PKGNAME-go =	gccgo-${FULL_PKGVERSION}

SHARED_LIBS =	estdc++		11.0 \
		gfortran	2.0 \
		gcj		0.0 \
		gcj-tools	0.0 \
		gij		0.0 \
		objc		2.0 \
		ssp		0.0 \
		lto_plugin      0.0


PSEUDO_FLAVORS = no_c++ no_f95 no_objc no_java no_ada
FLAVOR ?= 

ONLY_FOR_ARCHS-ada = i386
ONLY_FOR_ARCHS-java = amd64 sparc64 i386
#ONLY_FOR_ARCHS-go = amd64 i386			# XXX

MULTI_PACKAGES = -main -f95 -objc -java -c++ -estdc -ada

.include <bsd.port.arch.mk>

# kill both C++ subpackages
.if !${BUILD_PACKAGES:M-c++}
BUILD_PACKAGES := ${BUILD_PACKAGES:N-estdc}
.endif

DISTFILES =  ${DISTNAME}.tar.bz2
SUPDISTFILES =	${ADASTRAP}:0

USE_LIBTOOL =	Yes

BUILD_DEPENDS += devel/bison


REGRESS_DEPENDS = 	devel/dejagnu \
			devel/autogen

DISTNAME =   	gcc-${FULL_VERSION}


MASTER_SITES =	${MASTER_SITE_GCC:=releases/gcc-$(FULL_VERSION)/}
MASTER_SITES0 =	ftp://quatramaran.ens.fr/pub/espie/

CONFIGURE_STYLE =	gnu
MODGNU_CONFIG_GUESS_DIRS =	${WRKSRC} ${WRKSRC}/gcc

LANGS = c
.if ${BUILD_PACKAGES:M-c++}
LANGS := ${LANGS},c++
REGRESS_DEPENDS += 	libstdc++->=4.6,<4.7:${BUILD_PKGPATH},-estdc
.endif
.if ${BUILD_PACKAGES:M-f95}
LANGS := ${LANGS},fortran
CONFIGURE_ARGS += --with-gmp=${LOCALBASE}
.endif
.if ${BUILD_PACKAGES:M-objc}
LANGS := ${LANGS},objc
.endif
.if ${BUILD_PACKAGES:M-java}
LANGS := ${LANGS},java
BUILD_DEPENDS += archivers/zip>=2.3p0
CONFIGURE_ARGS += --enable-libgcj
.endif
.if ${BUILD_PACKAGES:M-ada}
LANGS := ${LANGS},ada
DISTFILES += ${ADASTRAP}:0
CONFIGURE_ENV = ADAC=${WRKDIR}/bin/egcc GNATBIND=${WRKDIR}/bin/gnatbind
MAKE_ENV = ADAC=${WRKDIR}/bin/egcc GNATBIND=${WRKDIR}/bin/gnatbind
CC = ${WRKDIR}/bin/egcc
REGRESS_DEPENDS += ${BUILD_PKGPATH},-ada
.endif
#.if ${BUILD_PACKAGES:M-go}
#LANGS := ${LANGS},go
#.endif

post-extract:
.for f in egcc gnatbind gnatmake gnatlink
	echo "#! /bin/sh" >${WRKDIR}/bin/$f
	echo 'GNAT_ROOT=${WRKDIR}/bootstrap GCC_ROOT=${WRKDIR}/bootstrap exec ${WRKDIR}/bootstrap/bin/$f "$$@@"' >>${WRKDIR}/bin/$f
	chmod a+x ${WRKDIR}/bin/$f
.endfor
	ln -s /usr/bin/nm ${WRKDIR}/bin/enm
	echo "# This file automatically generated" >> ${WRKSRC}/libversions
.for l v in ${SHARED_LIBS}
	echo "LIB$l_LTVERSION = -version-info ${v:S/./:/}" >> ${WRKSRC}/libversions
.endfor

post-install:
.if ${BUILD_PACKAGES:M-ada}
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/adainclude
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/adalib
.endif
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/include
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/include-fixed
CONFIGURE_ENV += am_cv_func_iconv=no
CONFIGURE_ENV += ac_cv_prog_CONFIGURED_M4=/usr/bin/m4

# Note: the configure target passes CFLAGS to the configure script anyways.

CFLAGS = -O2 -g


CONFIGURE_ARGS += \
	--verbose \
	--program-transform-name=s,^,e, \
	--disable-nls  \
	--disable-checking \
	--with-system-zlib \
	--disable-libmudflap \
	--disable-libgomp \
	--disable-tls \
	--with-as=/usr/bin/as \
	--with-ld=/usr/bin/ld \
	--with-gnu-ld \
	--with-gnu-as \
	--enable-threads=posix \
	--enable-wchar_t \
	--enable-languages=${LANGS}

# This is needed, as internal cpp is no longer compatible with the
# visible beast
CONFIGURE_ARGS += --enable-cpp

CONFIGURE_ARGS += ${CONFIGURE_SHARED}

SEPARATE_BUILD = flavored

USE_GMAKE = yes

# you shouldn't skip bootstrap unless you know what you're doing
# use bootstrap-lean if you're pressed for space
ALL_TARGET = bootstrap

MAKE_FLAGS = libstdc___la_LDFLAGS='-version-info 31:0:0 -lm'


.if ${MACHINE_ARCH} == "m68k" || ${MACHINE_ARCH} == "sparc"  || ${MACHINE_ARCH} == "amd64"
PKG_ARGS += -DPIC=1
.else
PKG_ARGS += -DPIC=0
.endif

.if ${MACHINE_ARCH} == "powerpc"
PKG_ARGS += -DPPC=1
.else
PKG_ARGS += -DPPC=0
.endif

.if ${MACHINE_ARCH} == "i386" || ${MACHINE_ARCH} == "amd64"
PKG_ARGS += -DI386=1
.else
PKG_ARGS += -DI386=0
.endif

RUN_DEPENDS =		gcc-${FULL_PKGVERSION}:${BUILD_PKGPATH}
WANTLIB =		c

RUN_DEPENDS-main =
RUN_DEPENDS-estdc =
RUN_DEPENDS-java =

RUN_DEPENDS-c++ =	${RUN_DEPENDS} libstdc++->=4.6,<4.7:${BUILD_PKGPATH},-estdc
WANTLIB-main =		${WANTLIB} gmp mpc mpfr z
WANTLIB-c++ =		${WANTLIB} gmp mpc mpfr z
WANTLIB-estdc =		m
WANTLIB-f95 =		${WANTLIB} gmp m mpc mpfr z
WANTLIB-java =		${WANTLIB} gmp m mpc mpfr pthread z
WANTLIB-objc =		${WANTLIB} gmp mpc mpfr z

LIB_DEPENDS +=		devel/gmp>=4.2 \
			devel/mpfr \
			devel/libmpc
LIB_DEPENDS-estdc =

.if ${MACHINE_ARCH:Mamd64}
CONFIG=x86_64-unknown-openbsd${OSREV}
.endif
a46 11

ADA_PACKAGE = ${PACKAGE_REPOSITORY}/i386/all/${PKGNAME-ada}${PKG_SUFX}
GCC_PACKAGE = ${PACKAGE_REPOSITORY}/i386/all/${PKGNAME-main}${PKG_SUFX}

adastrap: ${ADA_PACKAGE} ${GCC_PACKAGE}
	mkdir -p ${WRKDIR}/prepare/bootstrap
	cd ${WRKDIR}/prepare/bootstrap && tar zxf ${ADA_PACKAGE}
	cd ${WRKDIR}/prepare/bootstrap && tar zxf ${GCC_PACKAGE}
	rm -rf ${WRKDIR}/prepare/bootstrap/{+*,info,man}
	cd ${WRKDIR}/prepare && tar cf - bootstrap | xz > ${FULLDISTDIR}/${ADASTRAP}

@


