head	1.2;
access;
symbols
	OPENBSD_4_1:1.1.0.2
	OPENBSD_4_1_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2007.03.21.17.28.50;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2007.01.26.23.19.32;	author steven;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to 1.8.3 (minor bug fixes); from maintainer Joachim Schipper
@
text
@$OpenBSD: patch-src_tcurses_c,v 1.1 2007/01/26 23:19:32 steven Exp $
--- src/tcurses.c.orig	Thu Jan 25 17:02:09 2007
+++ src/tcurses.c	Thu Jan 25 17:04:32 2007
@@@@ -582,6 +582,7 @@@@ again:
 			/* read in the multibyte sequence */
 			char *mbs = my_malloc(MB_CUR_MAX + 1);
 			int i, ch;
+			wchar_t wc;
 
 			mbs[0] = (char) wch;
 			nodelay(stdscr, TRUE);
@@@@ -594,12 +595,14 @@@@ again:
 			nodelay(stdscr, FALSE);
 
 			mbs[i] = '\0';
-			res = mbtowc((wchar_t *) (&wch), mbs, MB_CUR_MAX);
+			res = mbtowc(&wc, mbs, MB_CUR_MAX);
 			free(mbs);
 			if (res == -1)
 				return WEOF; /* error */
-			else
+			else {
 				res = OK;
+				wch = wc;
+			}
 		} else {
 			res = KEY_CODE_YES;
 #			if defined(KEY_RESIZE) && defined(USE_CURSES)
@


1.1
log
@upgrade to tin 1.8.2

from Joachim Schipper <j.schipper at math.uu.nl>

with a wide character bug fix by naddy@@, thanks
@
text
@d1 1
a1 1
$OpenBSD$
@

