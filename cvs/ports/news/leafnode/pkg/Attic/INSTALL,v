head	1.11;
access;
symbols
	OPENBSD_3_6:1.9.0.2
	OPENBSD_3_6_BASE:1.9
	OPENBSD_3_5:1.8.0.2
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.7.0.2
	OPENBSD_3_4_BASE:1.7
	OPENBSD_3_3:1.6.0.2
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.4.0.2
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.3.0.6
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.3.0.4
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_TRACKING_SWITCH:1.3
	OPENBSD_2_9:1.3.0.2
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_8:1.1.0.4
	OPENBSD_2_8_BASE:1.1
	OPENBSD_2_7:1.1.0.2;
locks; strict;
comment	@# @;


1.11
date	2004.11.23.10.54.04;	author alek;	state dead;
branches;
next	1.10;

1.10
date	2004.10.07.05.15.25;	author sturm;	state Exp;
branches;
next	1.9;

1.9
date	2004.06.24.03.16.55;	author brad;	state Exp;
branches;
next	1.8;

1.8
date	2003.11.08.21.55.50;	author sturm;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.23.19.11.10;	author sturm;	state Exp;
branches;
next	1.6;

1.6
date	2003.02.26.15.13.04;	author david;	state Exp;
branches;
next	1.5;

1.5
date	2003.01.21.16.58.11;	author marcm;	state Exp;
branches;
next	1.4;

1.4
date	2002.09.24.00.24.19;	author marcm;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	2001.03.07.06.33.32;	author fgsch;	state Exp;
branches
	1.3.6.1;
next	1.2;

1.2
date	2001.03.05.06.19.18;	author fgsch;	state Exp;
branches;
next	1.1;

1.1
date	2000.06.10.19.00.16;	author fgsch;	state Exp;
branches;
next	;

1.3.6.1
date	2003.01.28.19.11.52;	author marcm;	state Exp;
branches;
next	;

1.4.2.1
date	2003.01.22.07.02.47;	author marcm;	state Exp;
branches;
next	;


desc
@@


1.11
log
@- Replace INSTALL script with @@samples
- Bump PKGNAME

ok rohee@@
@
text
@#!/bin/sh
#
# $OpenBSD: INSTALL,v 1.10 2004/10/07 05:15:25 sturm Exp $

SPOOLDIR=/var/spool/news
SPOOL_DIRS='
leaf.node
failed.postings
interesting.groups
out.going
message.id
temp.files
'

set -e
PATH=/bin:/usr/bin:/sbin:/usr/sbin
PREFIX=${PKG_PREFIX:-/usr/local}

do_create_spool_dirs()
{
	if [ -d /var/spool/news ]
	then
		echo " Giving /var/spool/news to _news"
	else
		echo " Creating /var/spool/news"
		mkdir -p /var/spool/news
	fi
	chown _news:news /var/spool/news

	echo -n "Creating spool directories... "
	for d in ${SPOOL_DIRS}; do
		if [ ! -d "${SPOOLDIR}/$d" ]; then
			install -d -o _news -g news ${SPOOLDIR}/$d
		fi
	done

	cd ${SPOOLDIR}/message.id
	for a in 0 1 2 3 4 5 6 7 8 9; do
		for b in 0 1 2 3 4 5 6 7 8 9; do
			for c in 0 1 2 3 4 5 6 7 8 9; do
				install -d -o _news -g news $a$b$c
			done
		done
	done
	echo "ok"
}

# verify proper execution
#
if [ $# -ne 2 ]; then
	echo "usage: $0 distname { PRE-INSTALL | POST-INSTALL }" >&2
	exit 1
fi

# Verify/process the command
#
case $2 in
	PRE-INSTALL)
		;;
	POST-INSTALL)
		do_create_spool_dirs
		;;
	*)
		echo "usage: $0 distname { PRE-INSTALL | POST-INSTALL }" >&2
		exit 1
		;;
esac

exit 0
@


1.10
log
@update to leafnode 1.10.6

from maintainer rohee@@
@
text
@d3 1
a3 1
# $OpenBSD: INSTALL,v 1.9 2004/06/24 03:16:55 brad Exp $
@


1.9
log
@remove messages about user/group change.
@
text
@d3 1
a3 11
# $OpenBSD: INSTALL,v 1.8 2003/11/08 21:55:50 sturm Exp $

P_NAME=leafnode

DIRS='
leafnode
'

FILES='
leafnode/config
'
d19 1
a19 1
do_create_user()
d21 1
a21 1
	if id -u _news >/dev/null 2>/dev/null
d23 1
a23 1
		echo "User _news already exists... ok"
d25 2
a26 12
		echo -n "Adding user _news..."
		if [ -d /var/spool/news ]
		then
			echo " Giving /var/spool/news to _news"
		else
			echo " Creating /var/spool/news"
			mkdir -p /var/spool/news
		fi
		chown 519:news /var/spool/news

		user add -d /var/spool/news -g news -c 'NNTP server' -s /sbin/nologin -u 519 _news
		echo "ok"
d28 1
a28 1
}
a29 2
do_create_spool_dirs()
{
a47 58
do_post()
{
	DEST_PFX=${SYSCONFDIR}
	SOURCE_PFX=${PREFIX}/share/examples

	echo 
	echo "+--------------- ${P_NAME}"

	# install dirs if necessary
	for d in ${DIRS}; do
		if [ ! -d "${DEST_PFX}/$d" ]; then
			install -d ${DEST_PFX}/$d
		fi
	done

	# install or take note of existing config files
	for f in ${FILES}; do
		if [ -f "${DEST_PFX}/$f" ]; then
			OLD_CONFS="${OLD_CONFS} $f"
		else
			if ! install -m 644 ${SOURCE_PFX}/$f.example ${DEST_PFX}/$f; then
				echo "| ERROR: The following file could not be installed, exiting: ${DEST_PFX}/$f"
				exit 1
			fi
			NEW_CONFS="${NEW_CONFS} $f"
		fi
	done

	# print status report
	if [ -n "${NEW_CONFS}" ]; then
		echo "| The following NEW configuration files have been installed:"
		echo "|"
		for f in ${NEW_CONFS}; do
			echo "| ${DEST_PFX}/$f"
		done 
	fi
	
	if [ -n "${OLD_CONFS}" ]; then
		if [ -n "${NEW_CONFS}" ]; then
			echo "|"
		fi
		echo "| The following OLD configuration files were found and have NOT been"
		echo "| overwritten:"
		echo "|"
		for f in ${OLD_CONFS}; do
			echo "| ${DEST_PFX}/$f"
		done
		echo "|"
		echo "| You should however manually compare them to their equivalents in"
		echo "|"
		echo "| ${SOURCE_PFX}"
		echo "|"
		echo "| and update your configuration as needed." 
	fi
	echo "+--------------- ${P_NAME}"
	echo 
}

a58 1
		do_create_user
a61 1
		do_post
@


1.8
log
@update to leafnode 1.9.46

from rohee@@
@
text
@d3 1
a3 1
# $OpenBSD: INSTALL,v 1.7 2003/06/23 19:11:10 sturm Exp $
a127 14
do_warning()
{
	echo "+---------------"
	echo "| WARNING!"
	echo "|"
	echo "| This port has changed its user from 'news' to '_news'. If you"
	echo "| installed this port before, ensure all permissions are set"
	echo "| correctly by running as root"
	echo "|     find / -user news -exec chown _news {} \;"
	echo "| and then"
	echo "|     rmuser news"
	echo "+---------------"
}

a143 1
		do_warning
@


1.7
log
@new user naming schema

bump PKGNAME where necessary

rohee@@ ok leafnode
"you don't have to wait for oks" pval@@
@
text
@d3 1
a3 1
# $OpenBSD: INSTALL,v 1.6 2003/02/26 15:13:04 david Exp $
d36 10
a45 1
		user add -m -d /var/spool/news -g news -c 'NNTP server' -s /sbin/nologin -u 519 _news
@


1.6
log
@necessary is spelled necessary.
similar is spelled similar.
functionality is spelled functionality.
ok brad@@ jmc@@
@
text
@d3 1
a3 1
# $OpenBSD: INSTALL,v 1.5 2003/01/21 16:58:11 marcm Exp $
d31 1
a31 1
	if id -u news >/dev/null 2>/dev/null
d33 1
a33 1
		echo "User news already exists... ok"
d35 2
a36 2
		echo -n "Adding user news..."
		user add -m -d /var/spool/news -g news -c 'NNTP server' -s /sbin/nologin news
d46 1
a46 1
			install -d -o news -g news ${SPOOLDIR}/$d
d54 1
a54 1
				install -d -o news -g news $a$b$c
d119 14
d149 1
@


1.5
log
@Update to 1.9.32.  In addition to the general updates this fixes
Bugtraq #6490, a DoS vulnerability.

Also thanks to margarita@@ for the SYSCONFDIR cluestick :)

ok brad@@
@
text
@d3 1
a3 1
# $OpenBSD: INSTALL,v 1.4 2002/09/24 00:24:19 marcm Exp $
d69 1
a69 1
	# install dirs if neccessary
@


1.4
log
@Update to 1.9.26.  This fixes numerous bugs (security and otherwise)
since version 1.9.19 as mentioned by the developer on ports@@.

Also brought the port itself up to date and added myself as maintainer.

ok pvalchev@@ naddy@@
@
text
@d3 1
a3 1
# $OpenBSD: INSTALL,v 1.3 2001/03/07 06:33:32 fgsch Exp $
d8 1
a8 1
.
d12 1
a12 1
config
d36 1
a36 1
		user add -d /var/spool/news -g news -c 'NNTP server' -s /sbin/nologin news
d64 1
a64 1
	SOURCE_PFX=${PREFIX}/share/examples/${P_NAME}
d81 1
a81 1
			if ! install -m 644 ${SOURCE_PFX}/$f ${DEST_PFX}/$f; then
@


1.4.2.1
log
@SECURITY fix:
Update to 1.9.32 to fix Bugtraq #6490, a DoS vulnerability.

ok brad@@
@
text
@d3 1
a3 1
# $OpenBSD: INSTALL,v 1.4 2002/09/24 00:24:19 marcm Exp $
d8 1
a8 1
leafnode
d12 1
a12 1
leafnode/config
d36 1
a36 1
		user add -m -d /var/spool/news -g news -c 'NNTP server' -s /sbin/nologin news
d64 1
a64 1
	SOURCE_PFX=${PREFIX}/share/examples
d81 1
a81 1
			if ! install -m 644 ${SOURCE_PFX}/$f.example ${DEST_PFX}/$f; then
@


1.3
log
@Remove /var/run/news references; once again pointed by marm@@lectroid.net,
thanks!
@
text
@d1 1
a1 2
#! /bin/sh
# $OpenBSD: INSTALL,v 1.2 2001/03/05 06:19:18 fgsch Exp $
d3 21
a23 2
# Pre/post-installation setup of leafnode - based on majordomo INSTALL
# script from daniel@@reichardt.ch
d31 8
a38 9
  echo "Leafnode requires a user news to run properly."
  echo -n "Let's see if there already is a user news... "
  if id -u news >/dev/null 2>/dev/null
  then
    echo "yes"
  else
    echo "no"
    user add -d /var/spool/news -g news -c 'NNTP server' -s /sbin/nologin news
  fi
d41 1
a41 1
do_create_local_dirs()
d43 16
a58 15
  echo -n "Creating local directories... "
  if [ ! -d /var/spool/news ]; then
    install -d -o news -g news -m 2775 /var/spool/news
    install -d -o news -g news /var/spool/news/leaf.node
    install -d -o news -g news /var/spool/news/failed.postings
    install -d -o news -g news /var/spool/news/message.id
    install -d -o news -g news /var/spool/news/interesting.groups
    install -d -o news -g news /var/spool/news/out.going
    cd /var/spool/news/message.id; for a in 0 1 2 3 4 5 6 7 8 9; do
      for b in 0 1 2 3 4 5 6 7 8 9; do
        for c in 0 1 2 3 4 5 6 7 8 9; do
          install -d -o news -g news $a$b$c
    done; done; done
  fi
  echo "ok"
d61 1
a61 1
do_set_file_permissions()
d63 5
a67 9
  echo -n "Changing ownership of leafnode files... "
  chown news:news ${PREFIX}/bin/newsq
  chown news:news ${PREFIX}/sbin/applyfilter
  chown news:news ${PREFIX}/sbin/checkgroups
  chown news:news ${PREFIX}/sbin/fetchnews
  chown news:news ${PREFIX}/sbin/leafnode
  chown news:news ${PREFIX}/sbin/texpire
  echo "ok"
}
d69 48
a116 16
do_install_configuration()
{
  echo -n "Let's see if there is already a configuration file... "
  if [ -d /etc/leafnode -a -f /etc/leafnode/config ]; then
    echo "yes"
    echo "Please compare your existing configuration with"
    echo "${PREFIX}/share/doc/config.example"
  else
    echo "no"
    echo -n "Copying sample configuration file... "
    install -d -o news -g news /etc/leafnode
    install -o root -g news -m 640 \
      ${PREFIX}/share/doc/leafnode/config.example /etc/leafnode/config
    echo "ok"
    echo "Please review new configuration /etc/leafnode/config"
  fi
d119 2
d122 2
a123 2
    echo "usage: $0 distname { PRE-INSTALL | POST-INSTALL }" >&2
    exit 1
d126 2
d129 11
a139 12
    PRE-INSTALL)
	do_create_user
	;;
    POST-INSTALL)
	do_create_local_dirs
	do_set_file_permissions
	do_install_configuration
	;;
    *)
	echo "usage: $0 distname { PRE-INSTALL | POST-INSTALL }" >&2
	exit 1
	;;
@


1.3.6.1
log
@SECURITY fix:
Update to 1.9.32 to fix Bugtraq #6490, a DoS vulnerability.

ok brad@@
@
text
@d1 2
a2 1
#!/bin/sh
d4 2
a5 21
# $OpenBSD: INSTALL,v 1.5 2003/01/21 16:58:11 marcm Exp $

P_NAME=leafnode

DIRS='
leafnode
'

FILES='
leafnode/config
'

SPOOLDIR=/var/spool/news
SPOOL_DIRS='
leaf.node
failed.postings
interesting.groups
out.going
message.id
temp.files
'
d13 9
a21 8
	if id -u news >/dev/null 2>/dev/null
	then
		echo "User news already exists... ok"
	else
		echo -n "Adding user news..."
		user add -m -d /var/spool/news -g news -c 'NNTP server' -s /sbin/nologin news
		echo "ok"
	fi
d24 1
a24 1
do_create_spool_dirs()
d26 15
a40 16
	echo -n "Creating spool directories... "
	for d in ${SPOOL_DIRS}; do
		if [ ! -d "${SPOOLDIR}/$d" ]; then
			install -d -o news -g news ${SPOOLDIR}/$d
		fi
	done

	cd ${SPOOLDIR}/message.id
	for a in 0 1 2 3 4 5 6 7 8 9; do
		for b in 0 1 2 3 4 5 6 7 8 9; do
			for c in 0 1 2 3 4 5 6 7 8 9; do
				install -d -o news -g news $a$b$c
			done
		done
	done
	echo "ok"
d43 1
a43 1
do_post()
d45 9
a53 2
	DEST_PFX=${SYSCONFDIR}
	SOURCE_PFX=${PREFIX}/share/examples
d55 16
a70 51
	echo 
	echo "+--------------- ${P_NAME}"

	# install dirs if neccessary
	for d in ${DIRS}; do
		if [ ! -d "${DEST_PFX}/$d" ]; then
			install -d ${DEST_PFX}/$d
		fi
	done

	# install or take note of existing config files
	for f in ${FILES}; do
		if [ -f "${DEST_PFX}/$f" ]; then
			OLD_CONFS="${OLD_CONFS} $f"
		else
			if ! install -m 644 ${SOURCE_PFX}/$f.example ${DEST_PFX}/$f; then
				echo "| ERROR: The following file could not be installed, exiting: ${DEST_PFX}/$f"
				exit 1
			fi
			NEW_CONFS="${NEW_CONFS} $f"
		fi
	done

	# print status report
	if [ -n "${NEW_CONFS}" ]; then
		echo "| The following NEW configuration files have been installed:"
		echo "|"
		for f in ${NEW_CONFS}; do
			echo "| ${DEST_PFX}/$f"
		done 
	fi
	
	if [ -n "${OLD_CONFS}" ]; then
		if [ -n "${NEW_CONFS}" ]; then
			echo "|"
		fi
		echo "| The following OLD configuration files were found and have NOT been"
		echo "| overwritten:"
		echo "|"
		for f in ${OLD_CONFS}; do
			echo "| ${DEST_PFX}/$f"
		done
		echo "|"
		echo "| You should however manually compare them to their equivalents in"
		echo "|"
		echo "| ${SOURCE_PFX}"
		echo "|"
		echo "| and update your configuration as needed." 
	fi
	echo "+--------------- ${P_NAME}"
	echo 
a72 2
# verify proper execution
#
d74 2
a75 2
	echo "usage: $0 distname { PRE-INSTALL | POST-INSTALL }" >&2
	exit 1
a77 2
# Verify/process the command
#
d79 12
a90 11
	PRE-INSTALL)
		do_create_user
		;;
	POST-INSTALL)
		do_create_spool_dirs
		do_post
		;;
	*)
		echo "usage: $0 distname { PRE-INSTALL | POST-INSTALL }" >&2
		exit 1
		;;
@


1.2
log
@Add missing 's' when creating dir; noticed by marcm@@lectroid.net.
@
text
@d2 1
a2 1
# $OpenBSD: INSTALL,v 1.1 2000/06/10 19:00:16 fgsch Exp $
a26 3
  if [ ! -d /var/run/news ]; then
    install -d -o news -g news /var/run/news
  fi
@


1.1
log
@Update to 1.9.14; fake.
@
text
@d2 1
a2 1
# $OpenBSD$
d33 1
a33 1
    install -d -o news -g news /var/spool/news/failed.posting
@

