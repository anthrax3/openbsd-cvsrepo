head	1.1;
access;
symbols
	OPENBSD_6_1:1.1.0.4
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.2
	OPENBSD_6_0_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2016.03.06.12.16.26;	author ajacoutot;	state Exp;
branches;
next	;
commitid	y2Wsex20IkpSey1y;


desc
@@


1.1
log
@Update to p11-kit-0.23.2.
@
text
@$OpenBSD$

From 6c4ef3f492d88acca931174519b7aa1215cc1a18 Mon Sep 17 00:00:00 2001
From: Pankaj <pankaj.s01@@samsung.com>
Date: Tue, 5 Jan 2016 09:52:00 +0000
Subject: Avoiding redundant check

--- p11-kit/modules.c.orig	Wed Oct 21 08:20:53 2015
+++ p11-kit/modules.c	Sat Mar  5 09:57:47 2016
@@@@ -2326,17 +2326,15 @@@@ p11_module_load_inlock_reentrant (CK_FUNCTION_LIST *mo
 		}
 
 		/* If this was newly allocated, add it to the list */
-		if (rv == CKR_OK && allocated) {
+		if (allocated) {
 			if (!p11_dict_set (gl.modules, allocated, allocated) ||
 			    !p11_dict_set (gl.unmanaged_by_funcs, module, allocated))
 				return_val_if_reached (CKR_HOST_MEMORY);
 			allocated = NULL;
 		}
 
-		if (rv == CKR_OK) {
 			/* WARNING: Reentrancy can occur here */
 			rv = prepare_module_inlock_reentrant (mod, flags, result);
-		}
 
 		free (allocated);
 	}
@
