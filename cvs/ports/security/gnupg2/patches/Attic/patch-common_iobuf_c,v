head	1.1;
access;
symbols
	OPENBSD_5_3:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2013.10.09.07.56.26;	author jasper;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2013.10.09.07.56.26;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-common_iobuf_c was initially added on branch OPENBSD_5_3.
@
text
@@


1.1.2.1
log
@revert previous which changed way too many things.

while here, apply the actual fix for the issue.
@
text
@a0 31
$OpenBSD$

Security fix for CVE-2013-4402,  denial of service via infinite recursion
backported from debian/patches/CVE-2013-4402.patch

--- common/iobuf.c.orig	Tue Mar 27 10:00:37 2012
+++ common/iobuf.c	Thu Jul  4 20:18:52 2013
@@@@ -52,6 +52,10 @@@@
    be aware that there is no fsync support for the stdio backend.  */
 #undef FILE_FILTER_USES_STDIO
 
+/* To avoid a potential DoS with compression packets we better limit
+   the number of filters in a chain.  */
+#define MAX_NESTING_FILTER 64
+
 /*-- End configurable part.  --*/
 
 
@@@@ -1612,6 +1616,12 @@@@ iobuf_push_filter2 (iobuf_t a,
 
   if (a->use == 2 && (rc = iobuf_flush (a)))
     return rc;
+
+    if (a->subno >= MAX_NESTING_FILTER) {
+        log_error ("i/o filter too deeply nested - corrupted data?\n");
+        return GPG_ERR_BAD_DATA;
+    }
+
   /* make a copy of the current stream, so that
    * A is the new stream and B the original one.
    * The contents of the buffers are transferred to the
@

