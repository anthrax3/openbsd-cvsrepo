head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2014.07.14.11.27.36;	author bluhm;	state dead;
branches;
next	1.1;
commitid	RXOLl8Zx5qfQLGPV;

1.1
date	2014.07.12.21.52.25;	author bluhm;	state Exp;
branches;
next	;
commitid	1ivfntRcbceP1XMm;


desc
@@


1.2
log
@update p5-Net-SSLeay to 1.65
All local patches to support LibreSSL have been applied upstream.
@
text
@$OpenBSD: patch-constants_c,v 1.1 2014/07/12 21:52:25 bluhm Exp $
--- constants.c.orig	Thu May  8 22:46:07 2014
+++ constants.c	Sat Jul 12 15:39:18 2014
@@@@ -3656,12 +3656,12 @@@@ constant (const char *name, size_t len) {
     break;
   case 23:
     /* Names all of length 23.  */
-    /* F_GET_CLIENT_MASTER_KEY F_SSL_USE_RSAPRIVATEKEY NID_pkcs8ShroudedKeyBag
-       NID_pkcs9_messageDigest NID_stateOrProvinceName OP_CRYPTOPRO_TLSEXT_BUG
-       R_BAD_RESPONSE_ARGUMENT R_PUBLIC_KEY_IS_NOT_RSA X509_PURPOSE_SMIME_SIGN
-       X509_PURPOSE_SSL_CLIENT X509_PURPOSE_SSL_SERVER X509_TRUST_OCSP_REQUEST
-       X509_V_FLAG_INHIBIT_ANY X509_V_FLAG_INHIBIT_MAP X509_V_FLAG_POLICY_MASK
-       X509_V_FLAG_X509_STRICT */
+    /* F_GET_CLIENT_MASTER_KEY F_SSL_USE_RSAPRIVATEKEY LIBRESSL_VERSION_NUMBER
+       NID_pkcs8ShroudedKeyBag NID_pkcs9_messageDigest NID_stateOrProvinceName
+       OP_CRYPTOPRO_TLSEXT_BUG R_BAD_RESPONSE_ARGUMENT R_PUBLIC_KEY_IS_NOT_RSA
+       X509_PURPOSE_SMIME_SIGN X509_PURPOSE_SSL_CLIENT X509_PURPOSE_SSL_SERVER
+       X509_TRUST_OCSP_REQUEST X509_V_FLAG_INHIBIT_ANY X509_V_FLAG_INHIBIT_MAP
+       X509_V_FLAG_POLICY_MASK X509_V_FLAG_X509_STRICT */
     /* Offset 17 gives the best switch position.  */
     switch (name[17]) {
     case 'A':
@@@@ -3772,6 +3772,18 @@@@ constant (const char *name, size_t len) {
         
 #ifdef NID_pkcs8ShroudedKeyBag
         return NID_pkcs8ShroudedKeyBag;
+#else
+        goto not_there;
+#endif
+
+      }
+      break;
+    case 'N':
+      if (!memcmp(name, "LIBRESSL_VERSION_NUMBER", 23)) {
+      /*                                  ^            */
+        
+#ifdef LIBRESSL_VERSION_NUMBER
+        return LIBRESSL_VERSION_NUMBER;
 #else
         goto not_there;
 #endif
@


1.1
log
@Patch p5-Net-SSLeay to compile and test with LibreSSL.  Now the
version check in the configure script also matches on LibreSSL, the
#if in the XS code got a additional defined(LIBRESSL_VERSION_NUMBER)
and Net::SSLeay::LIBRESSL_VERSION_NUMBER is exported into the perl
name space.
OK giovanni@@
@
text
@d1 1
a1 1
$OpenBSD$
@

