head	1.2;
access;
symbols
	OPENBSD_2_7:1.1.0.2;
locks; strict;
comment	@ * @;


1.2
date	2000.11.02.17.39.47;	author espie;	state dead;
branches;
next	1.1;

1.1
date	2000.08.03.00.04.47;	author brad;	state Exp;
branches;
next	;


desc
@@


1.2
log
@r10 vanished.
r11 includes most patches.

+ gcc -shared to build object module.
@
text
@$OpenBSD: patch-clients_ftp_ftp.c,v 1.1 2000/08/03 00:04:47 brad Exp $

This patch prevents some file handles from accidentally being closed.

--- clients/ftp/ftp.c.orig	Wed Aug  2 19:11:35 2000
+++ clients/ftp/ftp.c	Wed Aug  2 19:14:29 2000
@@@@ -913,6 +913,10 @@@@
     if (closefunc != NULL)
 	(*closefunc)(fin);
     fclose(dout);
+    if(data >= 0) {
+	close(data);
+	data = -1;
+    }
     getreply(0);
     Signal(SIGINT, oldintr);
     if (oldintp)
@@@@ -1252,6 +1256,10 @@@@
 
     gettimeofday(&stop, (struct timezone *)0);
     fclose(din);
+    if(data >= 0) {
+	close(data);
+	data = -1;
+    }
     getreply(0);
 
     if (bytes > 0 && is_retr) {
@


1.1
log
@add socks5-v1.0r10.patch5.txt patch
--
This patch prevents some file handles from accidentally being closed.
@
text
@d1 1
a1 1
$OpenBSD$
@

