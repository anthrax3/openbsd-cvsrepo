head	1.8;
access;
symbols
	OPENBSD_6_2:1.8.0.6
	OPENBSD_6_2_BASE:1.8
	OPENBSD_6_1:1.8.0.4
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.8.0.2
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.6.0.4
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.6
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.4.0.2
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.3.0.4
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.2
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2
	robert_20121010:1.1.1.1
	robert:1.1.1;
locks; strict;
comment	@# @;


1.8
date	2016.05.02.14.52.48;	author espie;	state Exp;
branches;
next	1.7;
commitid	kmCjisfJdqN5E3OM;

1.7
date	2016.03.16.16.46.33;	author naddy;	state Exp;
branches;
next	1.6;
commitid	4Ekn8nPgVVHWLTwe;

1.6
date	2014.11.25.09.41.27;	author ajacoutot;	state Exp;
branches;
next	1.5;
commitid	PPhqi0Q4u8stiSD9;

1.5
date	2014.11.25.09.29.46;	author robert;	state Exp;
branches;
next	1.4;
commitid	hA7myapnXB6lfCv5;

1.4
date	2014.06.04.08.50.08;	author robert;	state Exp;
branches;
next	1.3;
commitid	Wi2Pin98sO2ec4ze;

1.3
date	2013.03.11.11.41.26;	author espie;	state Exp;
branches
	1.3.4.1;
next	1.2;

1.2
date	2012.10.10.08.31.42;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2012.10.10.08.26.55;	author robert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.10.10.08.26.55;	author robert;	state Exp;
branches;
next	;

1.3.4.1
date	2014.06.04.08.51.46;	author robert;	state Exp;
branches;
next	;
commitid	KmajhdqLTgc6joQP;


desc
@@


1.8
log
@pass "safe" values of BSDSRCDIR and BSDOBJDIR on the command line.
Those ports use bsd.obj.mk, which doesn't like it if BSDSRCDIR doesn't point
to a defined place.

(found by doing a bulk on a chroot in a somewhat more hostile setup than usual)
@
text
@# $OpenBSD: Makefile,v 1.7 2016/03/16 16:46:33 naddy Exp $

COMMENT=	Pluggable Authentication Module

V=		20141014
DISTNAME=	freebsd_pam-${V}
PKGNAME=	openpam-${V}

CATEGORIES=	security

SHARED_LIBS+=	pam	5.0

HOMEPAGE=	http://www.openpam.org/

MAINTAINER=	Robert Nagy <robert@@openbsd.org>

# BSD
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += util

MASTER_SITES=	http://nerd.hu/distfiles/

WRKSRC=	${WRKDIST}/libpam

MAKE_FLAGS += 	BSDSRCDIR=${WRKDIST} BSDOBJDIR=${WRKBUILD}
MAKE_ENV+=	PAM_MOD_DIR=${TRUEPREFIX}/lib/security

PAM_MODULES=	deny echo exec nologin permit rootok \
		self bsdauth group

NO_TEST=	Yes

pre-build:
	cd ${WRKSRC} && ${MAKE} ${MAKE_FLAGS} obj

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/lib/security
	${INSTALL_DATA_DIR} ${PREFIX}/include/security
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/pam

	${INSTALL} ${FILESDIR}/system ${PREFIX}/share/examples/pam

.for _l in libpam.a libpam.so.5.0 libpam_p.a
	${INSTALL} ${WRKSRC}/libpam/obj/${_l} ${PREFIX}/lib
.endfor
.for _i in openpam openpam_attr openpam_version pam_appl pam_constants pam_modules pam_types
	${INSTALL} ${WRKDIST}/openpam/include/security/${_i}.h ${PREFIX}/include/security
.endfor
	${INSTALL} ${WRKSRC}/libpam/security/pam_mod_misc.h ${PREFIX}/include/security

.for _m in ${PAM_MODULES}
	${INSTALL} ${WRKSRC}/modules/pam_${_m}/obj/libpam_${_m}.so.5.0 ${PREFIX}/lib/security/pam_${_m}.so
	${INSTALL} ${WRKSRC}/modules/pam_${_m}/pam_${_m}.8 ${PREFIX}/man/man8
.endfor

.include <bsd.port.mk>
@


1.7
log
@remove SHARED_ONLY from ports that don't use any MODULES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2014/11/25 09:41:27 ajacoutot Exp $
d26 1
d35 1
a35 1
	cd ${WRKSRC} && ${MAKE} obj
@


1.6
log
@NO_TEST.
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.5 2014/11/25 09:29:46 robert Exp $

SHARED_ONLY=	Yes
@


1.5
log
@sync with the recent freebsd pam code
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2014/06/04 08:50:08 robert Exp $
d32 2
@


1.4
log
@apply security patch for CVE-2014-3879 which fixes an incorrect error
handling in PAM policy parser
http://www.freebsd.org/security/advisories/FreeBSD-SA-14:13.pam.asc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2013/03/11 11:41:26 espie Exp $
d7 1
a7 1
V=		20121009
a9 1
REVISION=	1
@


1.3
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2012/10/10 08:31:42 ajacoutot Exp $
d10 1
a10 1
REVISION=	0
@


1.3.4.1
log
@apply security patch for CVE-2014-3879 which fixes an incorrect error
handling in PAM policy parser
http://www.freebsd.org/security/advisories/FreeBSD-SA-14:13.pam.asc

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2013/03/11 11:41:26 espie Exp $
d10 1
a10 1
REVISION=	1
@


1.2
log
@RCS IDs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2012/10/10 08:26:55 robert Exp $
a21 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d10 1
@


1.1.1.1
log
@import openpam

this version comes from the freebsd sources and it has
a bsdauth module added.

ok ajacoutot@@
@
text
@@
