head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2016.12.17.14.58.31;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	MFuneOA792oMhnFq;

1.2
date	2016.11.10.08.54.43;	author ajacoutot;	state Exp;
branches;
next	1.1;
commitid	jmdAgfKWF3m32wbq;

1.1
date	2016.11.10.06.01.45;	author jca;	state Exp;
branches;
next	;
commitid	ijROsPze4Svlcnwi;


desc
@@


1.3
log
@Update to heimdal-7.0.3.
This is still an RC but the final version is supposed to come out in a
couple of days. Committing early to catch regressions and all.
Not much depends on this in ports anyway...
@
text
@$OpenBSD$

Search /usr/local/{include,lib} for libcom_err.

--- tools/krb5-config.in.orig	Tue Nov 29 02:35:28 2016
+++ tools/krb5-config.in	Sat Dec 17 15:34:10 2016
@@@@ -229,7 +229,7 @@@@ if test "$do_libs" = "yes"; then
     if test "$lib_krb5" = yes; then
 	lib_flags="$lib_flags -lkrb5"
     fi
-    deplibs="$deplibs @@LIB_pkinit@@ -lcom_err"
+    deplibs="$deplibs @@LIB_pkinit@@ -L${LOCALBASE}/lib -lcom_err"
     deplibs="$deplibs @@LIB_hcrypto_appl@@ -lasn1 -lwind -lheimbase -lroken"
     deplibs="$deplibs @@LIB_crypt@@ @@PTHREAD_LIBADD@@ @@LIB_dlopen@@"
     deplibs="$deplibs @@LIB_door_create@@ @@LIBS@@"
@@@@ -248,7 +248,7 @@@@ fi
 if test "$do_cflags" = "yes"; then
     cflags=""
     if test X"${includedir}" != X/usr/include; then
-	cflags="-I${includedir} $cflags"
+	cflags="-I${includedir} -I${LOCALBASE}/include $cflags"
     fi
     echo $cflags
 fi
@


1.2
log
@Use SUBST_CMD at pre-configure time instead of a home made substitution.
@
text
@d1 1
a1 1
$OpenBSD: patch-tools_krb5-config_in,v 1.1 2016/11/10 06:01:45 jca Exp $
d3 1
a3 2
- help ld.so(1) find libs out of its default search path
- help ld(1) find libcom_err in ${LOCALBASE}
d5 19
a23 3
--- tools/krb5-config.in.orig	Tue Nov  1 02:23:30 2016
+++ tools/krb5-config.in	Tue Nov  1 02:23:53 2016
@@@@ -120,7 +120,7 @@@@ if test "$print_exec_prefix" = "yes"; then
a24 7
 
 if test "$do_libs" = "yes"; then
-    lib_flags="-L${libdir}"
+    lib_flags="-L${libdir} -R${libdir} -L${LOCALBASE}/lib"
     case $library in
     gssapi)
 	lib_flags="$lib_flags -lgssapi -lheimntlm"
@


1.1
log
@Tweak krb5-config to fix rpath and search /usr/local/lib for libcom_err

Problem reported by Jiri B.
@
text
@d1 1
a1 1
$OpenBSD$
d13 1
a13 1
+    lib_flags="-L${libdir} -R${libdir} -L%%LOCALBASE%%/lib"
@

