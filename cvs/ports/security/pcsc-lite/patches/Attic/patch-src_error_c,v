head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2017.06.08.19.34.03;	author dcoppa;	state dead;
branches;
next	1.1;
commitid	7wEAcjHXWy8EnA3t;

1.1
date	2017.06.06.14.58.39;	author dcoppa;	state Exp;
branches;
next	;
commitid	aB8P9jpyVciH7erx;


desc
@@


1.2
log
@
Remove local hack and switch to gcc from ports.

I'm not sure and there could even be security implications...

https://github.com/LudovicRousseau/PCSC/commit/eab1d67295e4e1d5c12bbca77bc57c50fd384a4e
@
text
@$OpenBSD: patch-src_error_c,v 1.1 2017/06/06 14:58:39 dcoppa Exp $

Index: src/error.c
--- src/error.c.orig
+++ src/error.c
@@@@ -81,9 +81,7 @@@@ PCSC_API const char* pcsc_stringify_error(const LONG p
  */
 PCSC_API const char* pcsc_stringify_error(const LONG pcscError)
 {
-	/* Use a Thread-local storage so that the returned buffer
-	 * is thread safe */
-	static __thread char strError[75];
+	static char strError[75];
 	const char *msg = NULL;
 
 	switch (pcscError)
@@@@ -228,16 +226,16 @@@@ PCSC_API const char* pcsc_stringify_error(const LONG p
 			pcscError);
 	};
 
-	if (msg)
-		(void)strncpy(strError, msg, sizeof(strError));
-	else
+	if (msg) {
+		return msg;
+	} else {
 		(void)snprintf(strError, sizeof(strError)-1, "Unknown error: 0x%08lX",
 			pcscError);
+		/* add a null byte */
+		strError[sizeof(strError)-1] = '\0';
 
-	/* add a null byte */
-	strError[sizeof(strError)-1] = '\0';
-
-	return strError;
+		return strError;
+	}
 }
 #endif
 
@


1.1
log
@
Update to pcsc-lite-1.8.21
@
text
@d1 1
a1 1
$OpenBSD$
@

