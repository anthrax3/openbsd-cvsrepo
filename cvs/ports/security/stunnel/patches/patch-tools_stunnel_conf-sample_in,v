head	1.15;
access;
symbols
	OPENBSD_6_0:1.14.0.4
	OPENBSD_6_0_BASE:1.14
	OPENBSD_5_9:1.14.0.2
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.13.0.4
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.12.0.2
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.10.0.4
	OPENBSD_5_6_BASE:1.10
	OPENBSD_5_5:1.10.0.2
	OPENBSD_5_5_BASE:1.10
	OPENBSD_5_4:1.9.0.8
	OPENBSD_5_4_BASE:1.9
	OPENBSD_5_3:1.9.0.6
	OPENBSD_5_3_BASE:1.9
	OPENBSD_5_2:1.9.0.4
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.9
	OPENBSD_5_1:1.9.0.2
	OPENBSD_5_0:1.7.0.10
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.8
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.6
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.4
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.7.0.2
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.6.0.10
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.8
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.6
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.4
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.6.0.2
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.5.0.2
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.3.0.2
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.2.0.4
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.1.0.4
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_5:1.1.0.2
	OPENBSD_3_5_BASE:1.1;
locks; strict;
comment	@# @;


1.15
date	2016.11.09.23.14.31;	author gsoares;	state Exp;
branches;
next	1.14;
commitid	D4zIQfKk3T2ktLB0;

1.14
date	2015.10.14.02.05.06;	author gsoares;	state Exp;
branches;
next	1.13;
commitid	gPubP3Dxu5GSVcMn;

1.13
date	2015.06.25.14.44.30;	author gsoares;	state Exp;
branches;
next	1.12;
commitid	AXFYLLYdz3t8Z0uo;

1.12
date	2014.10.27.13.16.48;	author gonzalo;	state Exp;
branches;
next	1.11;
commitid	JUKS0VMgG5D7FF8c;

1.11
date	2014.08.22.02.22.25;	author gsoares;	state Exp;
branches;
next	1.10;
commitid	SfE8xQWohtYXKyVR;

1.10
date	2014.01.03.20.20.58;	author gsoares;	state Exp;
branches;
next	1.9;

1.9
date	2011.11.30.19.37.21;	author sthen;	state Exp;
branches;
next	1.8;

1.8
date	2011.09.15.00.42.21;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2009.05.28.18.08.49;	author jakob;	state Exp;
branches;
next	1.6;

1.6
date	2006.09.27.15.30.11;	author jakob;	state Exp;
branches;
next	1.5;

1.5
date	2006.04.20.16.01.52;	author aanriot;	state Exp;
branches;
next	1.4;

1.4
date	2006.03.23.15.49.53;	author jakob;	state Exp;
branches;
next	1.3;

1.3
date	2005.10.22.18.00.32;	author jakob;	state Exp;
branches;
next	1.2;

1.2
date	2004.12.27.08.24.44;	author jakob;	state Exp;
branches;
next	1.1;

1.1
date	2004.02.16.12.33.18;	author jakob;	state Exp;
branches;
next	;


desc
@@


1.15
log
@update to 5.37
OK benoit@@
@
text
@$OpenBSD: patch-tools_stunnel_conf-sample_in,v 1.14 2015/10/14 02:05:06 gsoares Exp $
--- tools/stunnel.conf-sample.in.orig	Tue Jul  5 18:27:57 2016
+++ tools/stunnel.conf-sample.in	Thu Nov  3 23:16:09 2016
@@@@ -7,17 +7,18 @@@@
 ; * Global options                                                         *
 ; **************************************************************************
 
+chroot = /var/stunnel/
 ; It is recommended to drop root privileges if stunnel is started by root
-;setuid = nobody
-;setgid = @@DEFAULT_GROUP@@
+setuid = _stunnel
+setgid = _stunnel
 
 ; PID file is created inside the chroot jail (if enabled)
-;pid = @@localstatedir@@/run/stunnel.pid
+pid = /stunnel.pid
 
 ; Debugging stuff (may be useful for troubleshooting)
 ;foreground = yes
 ;debug = info
-;output = @@localstatedir@@/log/stunnel.log
+;output = stunnel.log
 
 ; Enable FIPS 140-2 mode if needed for compliance
 ;fips = yes
@@@@ -37,7 +38,7 @@@@
 ; * Include all configuration file fragments from the specified folder     *
 ; **************************************************************************
 
-;include = @@sysconfdir@@/stunnel/conf.d
+;include = ${SYSCONFDIR}/stunnel/conf.d
 
 ; **************************************************************************
 ; * Service definitions (remove all services for inetd mode)               *
@@@@ -50,72 +51,72 @@@@
 ; a hardcoded path of the stunnel package, as it is not related to the
 ; stunnel configuration in @@sysconfdir@@/stunnel/.
 
-[gmail-pop3]
-client = yes
-accept = 127.0.0.1:110
-connect = pop.gmail.com:995
-verifyChain = yes
-CApath = /etc/ssl/certs
-checkHost = pop.gmail.com
-OCSPaia = yes
+;[gmail-pop3]
+;client = yes
+;accept = 127.0.0.1:110
+;connect = pop.gmail.com:995
+;verifyChain = yes
+;CApath = ${SYSCONFDIR}/ssl/certs
+;checkHost = pop.gmail.com
+;OCSPaia = yes
 
-[gmail-imap]
-client = yes
-accept = 127.0.0.1:143
-connect = imap.gmail.com:993
-verifyChain = yes
-CApath = /etc/ssl/certs
-checkHost = imap.gmail.com
-OCSPaia = yes
+;[gmail-imap]
+;client = yes
+;accept = 127.0.0.1:143
+;connect = imap.gmail.com:993
+;verifyChain = yes
+;CApath = ${SYSCONFDIR}/ssl/certs
+;checkHost = imap.gmail.com
+;OCSPaia = yes
 
-[gmail-smtp]
-client = yes
-accept = 127.0.0.1:25
-connect = smtp.gmail.com:465
-verifyChain = yes
-CApath = /etc/ssl/certs
-checkHost = smtp.gmail.com
-OCSPaia = yes
+;[gmail-smtp]
+;client = yes
+;accept = 127.0.0.1:25
+;connect = smtp.gmail.com:465
+;verifyChain = yes
+;CApath = ${SYSCONFDIR}/ssl/certs
+;checkHost = smtp.gmail.com
+;OCSPaia = yes
 
 ; ***************************************** Example TLS server mode services
 
-;[pop3s]
-;accept  = 995
-;connect = 110
-;cert = @@sysconfdir@@/stunnel/stunnel.pem
+[pop3s]
+accept  = 995
+connect = 110
+cert = ${SYSCONFDIR}/stunnel/stunnel.pem
 
-;[imaps]
-;accept  = 993
-;connect = 143
-;cert = @@sysconfdir@@/stunnel/stunnel.pem
+[imaps]
+accept  = 993
+connect = 143
+cert = ${SYSCONFDIR}/stunnel/stunnel.pem
 
-;[ssmtp]
-;accept  = 465
-;connect = 25
-;cert = @@sysconfdir@@/stunnel/stunnel.pem
+[ssmtp]
+accept  = 465
+connect = 25
+cert = ${SYSCONFDIR}/stunnel/stunnel.pem
 
 ; TLS front-end to a web server
 ;[https]
 ;accept  = 443
 ;connect = 80
-;cert = @@sysconfdir@@/stunnel/stunnel.pem
+;cert = ${SYSCONFDIR}/stunnel/stunnel.pem
 ; "TIMEOUTclose = 0" is a workaround for a design flaw in Microsoft SChannel
 ; Microsoft implementations do not use TLS close-notify alert and thus they
 ; are vulnerable to truncation attacks
 ;TIMEOUTclose = 0
 
 ; Remote shell protected with PSK-authenticated TLS
-; Create "@@sysconfdir@@/stunnel/secrets.txt" containing IDENTITY:KEY pairs
+; Create "${SYSCONFDIR}/stunnel/secrets.txt" containing IDENTITY:KEY pairs
 ;[shell]
 ;accept = 1337
 ;exec = /bin/sh
 ;execArgs = sh -i
 ;ciphers = PSK
-;PSKsecrets = @@sysconfdir@@/stunnel/secrets.txt
+;PSKsecrets = ${SYSCONFDIR}/stunnel/secrets.txt
 
 ; Non-standard MySQL-over-TLS encapsulation connecting the Unix socket
 ;[mysql]
-;cert = @@sysconfdir@@/stunnel/stunnel.pem
+;cert = ${SYSCONFDIR}/stunnel/stunnel.pem
 ;accept = 3307
 ;connect = /run/mysqld/mysqld.sock
 
@


1.14
log
@*** empty log message ***
@
text
@d1 3
a3 3
$OpenBSD: patch-tools_stunnel_conf-sample_in,v 1.13 2015/06/25 14:44:30 gsoares Exp $
--- tools/stunnel.conf-sample.in.orig	Wed Sep 23 11:05:10 2015
+++ tools/stunnel.conf-sample.in	Tue Oct  6 06:10:53 2015
d44 1
a44 1
-verify = 2
d52 1
a52 1
+;verify = 2
d61 1
a61 1
-verify = 2
d69 1
a69 1
+;verify = 2
d78 1
a78 1
-verify = 2
d86 1
a86 1
+;verify = 2
@


1.13
log
@- update to 3.19;
- switch threading model to pthread since that it is the default process model in stunnel;
- fix stunnel.pem path in pkg/MESSAGE;
- add patches to make it build with libressl;
- fix some hardcoding paths in tools/stunnel.conf-sample.in.

Tweaks and Feedback:
jca@@ yasuoka@@ jasper@@ brad@@ and Markus Lude, thanks !

tested by yasuoka@@ and Markus Lude on @@sparc64(markus's tests against 3.18 version, but no many changes to 3.19, assuming that should work too...)...

full changelog at:
https://www.stunnel.org/sdf_ChangeLog.html
@
text
@d1 3
a3 3
$OpenBSD$
--- tools/stunnel.conf-sample.in.orig	Fri Jun 12 05:23:01 2015
+++ tools/stunnel.conf-sample.in	Mon Jun 22 02:02:57 2015
d36 3
a38 3
@@@@ -45,64 +46,64 @@@@
 
 ; ***************************************** Example TLS client mode services
d47 1
d55 1
d64 1
d72 1
d81 1
d89 1
d100 1
a100 1
+cert = ${SYSCONFDIR}/ssl/stunnel.pem
d109 1
a109 1
+cert = ${SYSCONFDIR}/ssl/stunnel.pem
d118 1
a118 1
+cert = ${SYSCONFDIR}/ssl/stunnel.pem
d125 1
a125 1
+;cert = ${SYSCONFDIR}/ssl/stunnel.pem
d133 1
a133 1
+; Create "${SYSCONFDIR}/ssl/secrets.txt" containing IDENTITY:KEY pairs
d140 8
a147 1
+;PSKsecrets = ${SYSCONFDIR}/ssl/secrets.txt
a148 1
 ; vim:ft=dosini
@


1.12
log
@Update for Stunnel to 5.06:

Security bugfixes

    OpenSSL DLLs updated to version 1.0.1j.
https://www.openssl.org/news/secadv_20141015.txt
    The insecure SSLv2 protocol is now disabled by default. It can be
enabled with "options = -NO_SSLv2".
    The insecure SSLv3 protocol is now disabled by default. It can be
enabled with "options = -NO_SSLv3".
    Default sslVersion changed to "all" (also in FIPS mode) to
autonegotiate the highest supported TLS version.

New features

    Added missing SSL options to match OpenSSL 1.0.1j.
    New "-options" commandline option to display the list of supported
SSL options.

Bugfixes

    Fixed FORK threading build regression bug.


OK gsoares@@ (maintainer) OK schwarze@@
@
text
@d1 7
a7 9
$OpenBSD: patch-tools_stunnel_conf-sample_in,v 1.11 2014/08/22 02:22:25 gsoares Exp $

--- tools/stunnel.conf-sample.in.orig	Wed Oct 15 09:04:20 2014
+++ tools/stunnel.conf-sample.in	Thu Oct 23 10:32:30 2014
@@@@ -9,13 +9,13 @@@@
 
 ; A copy of some devices and system files is needed within the chroot jail
 ; Chroot conflicts with configuration file reload and many other features
-;chroot = @@prefix@@/var/lib/stunnel/
d9 3
a11 3
 ; Chroot jail can be escaped if setuid option is not used
-setuid = nobody
-setgid = @@DEFAULT_GROUP@@
d16 1
a16 1
-;pid = @@prefix@@/var/run/stunnel.pid
d20 14
a33 2
 ;debug = 7
@@@@ -26,8 +26,8 @@@@ setgid = @@DEFAULT_GROUP@@
d35 4
d40 95
a134 20
 ; Certificate/key is needed in server mode and optional in client mode
-cert = @@prefix@@/etc/stunnel/mail.pem
-;key = @@prefix@@/etc/stunnel/mail.pem
+cert = @@sysconfdir@@/ssl/stunnel.pem
+;key = @@sysconfdir@@/ssl/private/stunnel.key
 
 ; Authentication stuff needs to be configured to prevent MITM attacks
 ; It is not enabled by default!
@@@@ -36,12 +36,12 @@@@ cert = @@prefix@@/etc/stunnel/mail.pem
 ; CApath is located inside chroot jail
 ;CApath = /certs
 ; It's often easier to use CAfile
-;CAfile = @@prefix@@/etc/stunnel/certs.pem
+;CAfile = @@sysconfdir@@/ssl/cert.pem
 ; Don't forget to c_rehash CRLpath
 ; CRLpath is located inside chroot jail
 ;CRLpath = /crls
 ; Alternatively CRLfile can be used
-;CRLfile = @@prefix@@/etc/stunnel/crls.pem
+;CRLfile = @@sysconfdir@@/ssl/crls.pem
d136 1
a136 2
 ; Enable support for the insecure SSLv2 protocol
 ;options = -NO_SSLv2
@


1.11
log
@update to 5.03
OK kili@@
@
text
@d1 1
a1 1
$OpenBSD: patch-tools_stunnel_conf-sample_in,v 1.10 2014/01/03 20:20:58 gsoares Exp $
d3 2
a4 2
--- tools/stunnel.conf-sample.in.orig	Thu May  8 05:31:52 2014
+++ tools/stunnel.conf-sample.in	Wed Aug 20 19:18:23 2014
d47 2
a48 2
 ; Disable support for insecure SSLv2 protocol
 options = NO_SSLv2
@


1.10
log
@missing RCS id.
@
text
@d1 1
a1 1
$OpenBSD$
d3 3
a5 3
--- tools/stunnel.conf-sample.in.orig	Tue Nov 22 22:20:37 2011
+++ tools/stunnel.conf-sample.in	Wed Nov 30 19:32:57 2011
@@@@ -9,10 +9,10 @@@@
d9 1
a9 1
-chroot = @@prefix@@/var/lib/stunnel/
d17 7
a23 3
 ; PID is created inside the chroot jail
 pid = /stunnel.pid
@@@@ -26,8 +26,8 @@@@ pid = /stunnel.pid
@


1.9
log
@update to stunnel 4.49
@
text
@d1 2
@


1.8
log
@update to stunnel 4.43, ok jakob@@, reads good to william@@
- take maintainer, suggested by jakob
- pid is now created inside the chroot jail, note you may want to set
"pid = /stunnel.pid" in config.
@
text
@d1 3
a3 3
--- tools/stunnel.conf-sample.in.orig	Sun Jul 24 06:51:56 2011
+++ tools/stunnel.conf-sample.in	Wed Sep  7 12:06:13 2011
@@@@ -8,10 +8,10 @@@@
d17 2
a18 2
@@@@ -25,8 +25,8 @@@@ pid = /stunnel.pid
 ; *****************************************************************************
d28 1
a28 1
@@@@ -35,12 +35,12 @@@@ cert = @@prefix@@/etc/stunnel/mail.pem
@


1.7
log
@update to stunnel v4.27
@
text
@d1 3
a3 4
--- tools/stunnel.conf-sample.in.orig	Thu Apr 16 11:10:09 2009
+++ tools/stunnel.conf-sample.in	Sun May 17 00:58:19 2009
@@@@ -3,18 +3,17 @@@@
 ; Please make sure you understand them (especially the effect of the chroot jail)
d5 2
a6 10
 ; Certificate/key is needed in server mode and optional in client mode
-cert = @@prefix@@/etc/stunnel/mail.pem
-;key = @@prefix@@/etc/stunnel/mail.pem
+cert = @@sysconfdir@@/ssl/private/stunnel.pem
+;key = @@sysconfdir@@/ssl/private/stunnel.key
 
 ; Protocol version (all, SSLv2, SSLv3, TLSv1)
 sslVersion = SSLv3
 
 ; Some security enhancements for UNIX systems - comment them out on Win32
d8 2
a11 3
-; PID is created inside the chroot jail
-pid = /stunnel.pid
+chroot = /var/stunnel/
a13 1
+pid = /var/run/stunnel.pid
d15 14
a28 3
 ; Some performance tunings
 socket = l:TCP_NODELAY=1
@@@@ -30,12 +29,12 @@@@ socket = r:TCP_NODELAY=1
d37 1
a37 1
 ; Alternatively you can use CRLfile
d41 2
a42 2
 ; Some debugging stuff useful for troubleshooting
 ;debug = 7
@


1.6
log
@stunnel v4.18
@
text
@d1 2
a2 2
--- tools/stunnel.conf-sample.in.orig	Thu Aug 31 21:02:30 2006
+++ tools/stunnel.conf-sample.in	Wed Sep 27 16:40:43 2006
d4 1
a4 1
 ; Please make sure you understand them (especially the effect of chroot jail)
d19 1
a19 1
-; PID is created inside chroot jail
d33 1
a33 1
+;CAfile = @@sysconfdir@@/ssl/certs.pem
@


1.5
log
@- use the same directory for the key as mentionned in MESSAGE.
- bump PKGNAME.

ok jakob@@
@
text
@d1 3
a3 3
--- tools/stunnel.conf-sample.in.orig	Sat Jan  7 14:58:50 2006
+++ tools/stunnel.conf-sample.in	Thu Mar 23 16:43:58 2006
@@@@ -3,15 +3,15 @@@@
d12 3
d18 3
a20 1
-setgid = nogroup
a23 2
 ; PID is created inside chroot jail
-pid = /stunnel.pid
d28 1
a28 1
@@@@ -27,12 +27,12 @@@@ socket = r:TCP_NODELAY=1
@


1.4
log
@stunnel 4.15
@
text
@d9 1
a9 1
+cert = @@sysconfdir@@/ssl/stunnel.pem
@


1.3
log
@stunnel v4.13
@
text
@d1 3
a3 6
--- tools/stunnel.conf-sample.in.orig	Thu Sep 22 10:11:48 2005
+++ tools/stunnel.conf-sample.in	Sat Oct 22 19:45:44 2005
@@@@ -1,17 +1,18 @@@@
 ; Sample stunnel configuration file by Michal Trojnara 2002-2005
+# Modified for OpenBSD by Michael Schubert 2003
 ; Some options used here may not be adequate for your particular configuration
d9 2
a10 2
+cert = @@sysconfdir@@/ssl/private/stunnel.pem
+;key = @@sysconfdir@@/ssl/etc/mail.pem
d13 1
a13 1
-chroot = @@prefix@@/var/stunnel/
d25 1
a25 1
@@@@ -27,12 +28,12 @@@@
@


1.2
log
@stunnel 4.06
@
text
@d1 2
a2 3
$OpenBSD: patch-tools_stunnel_conf-sample_in,v 1.1 2004/02/16 12:33:18 jakob Exp $
--- tools/stunnel.conf-sample.in.orig	Sat Nov  6 21:54:03 2004
+++ tools/stunnel.conf-sample.in	Mon Dec 27 09:14:36 2004
d4 1
a4 1
 ; Sample stunnel configuration file by Michal Trojnara 2002-2004
d28 2
a29 2
@@@@ -26,11 +27,11 @@@@ socket = r:TCP_NODELAY=1
 ; Don't forget to c_rehash CApath;  CApath is located inside chroot jail:
d31 1
a31 1
 ; It's often easier to use CAfile:
d34 2
a35 1
 ; Don't forget to c_rehash CRLpath;  CRLpath is located inside chroot jail:
d37 1
a37 1
 ; Alternatively you can use CRLfile:
@


1.1
log
@update to v4.05
add chroot/privdrop from Michael Schubert
@
text
@d1 5
a5 6
$OpenBSD$
--- tools/stunnel.conf-sample.in.orig	2004-01-26 20:26:18.000000000 +0100
+++ tools/stunnel.conf-sample.in	2004-02-16 13:10:46.000000000 +0100
@@@@ -1,13 +1,14 @@@@
 # Sample stunnel configuration file
 # Copyright by Michal Trojnara 2002
d7 2
d10 1
a10 1
 # Comment it out on Win32
d12 1
a12 1
-chroot = @@prefix@@/var/run/stunnel/
d14 4
a17 3
+chroot = @@localstatedir@@/stunnel/
 # PID is created inside chroot jail
-pid = /stunnel.pid
d20 1
a20 1
+pid = /var/run/stunnel.pid
d23 3
d27 13
a39 17
 # Workaround for Eudora bug
 #options = DONT_INSERT_EMPTY_FRAGMENTS
@@@@ -16,13 +17,13 @@@@ setgid = nogroup
 #verify = 2
 # don't forget about c_rehash CApath
 # it is located inside chroot jail:
-#CApath = /certs
+#CApath = @@sysconfdir@@/ssl/certs
 # or simply use CAfile instead:
-#CAfile = @@prefix@@/etc/stunnel/certs.pem
+#CAfile = @@sysconfdir@@/ssl/certs.pem
 # CRL path or file (inside chroot jail):
-#CRLpath = /crls
+#CRLpath = @@sysconfdir@@/ssl/crls
 # or simply use CAfile instead:
-#CRLfile = @@prefix@@/etc/stunnel/crls.pem
+#CRLfile = @@sysconfdir@@/ssl/crls.pem
d41 2
a42 2
 # Some debugging stuff
 #debug = 7
@

