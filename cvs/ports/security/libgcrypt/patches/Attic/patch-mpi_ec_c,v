head	1.1;
access;
symbols
	OPENBSD_5_8:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2016.02.29.12.57.20;	author jasper;	state dead;
branches
	1.1.2.1;
next	;
commitid	NBddf5DSnQfB5QK6;

1.1.2.1
date	2016.02.29.12.57.20;	author jasper;	state Exp;
branches;
next	;
commitid	NBddf5DSnQfB5QK6;


desc
@@


1.1
log
@file patch-mpi_ec_c was initially added on branch OPENBSD_5_8.
@
text
@@


1.1.2.1
log
@CVE-2015-7511 libgcrypt: side-channel attack on ECDH with Weierstrass curves

ok aja@@
@
text
@a0 41
$OpenBSD$

CVE-2015-7511 libgcrypt: side-channel attack on ECDH with Weierstrass curves
https://bugzilla.redhat.com/show_bug.cgi?id=1306184
http://git.gnupg.org/cgi-bin/gitweb.cgi?p=libgcrypt.git;a=blobdiff;f=mpi/ec.c;h=4d59a7e56bce7aa3eeeaae94a9fb2523c4a0eedb;hp=9394d89d43821b13ab99bd55f73fcbd80add71b3;hb=88e1358962e902ff1cbec8d53ba3eee46407851a;hpb=f88adee3e1f3e2de7d63f92f90bfb3078afd3b4f

--- mpi/ec.c.orig	Fri Feb 27 10:54:03 2015
+++ mpi/ec.c	Mon Feb 29 13:49:06 2016
@@@@ -1106,17 +1106,27 @@@@ _gcry_mpi_ec_mul_point (mpi_point_t result,
   unsigned int i, loops;
   mpi_point_struct p1, p2, p1inv;
 
-  if (ctx->model == MPI_EC_TWISTEDEDWARDS)
+  if (ctx->model == MPI_EC_TWISTEDEDWARDS
+      || (ctx->model == MPI_EC_WEIERSTRASS
+          && mpi_is_secure (scalar)))
     {
       /* Simple left to right binary method.  GECC Algorithm 3.27 */
       unsigned int nbits;
       int j;
 
       nbits = mpi_get_nbits (scalar);
-      mpi_set_ui (result->x, 0);
-      mpi_set_ui (result->y, 1);
-      mpi_set_ui (result->z, 1);
-
+      if (ctx->model == MPI_EC_WEIERSTRASS)
+       {
+          mpi_set_ui (result->x, 1);
+          mpi_set_ui (result->y, 1);
+          mpi_set_ui (result->z, 0);
+       }
+      else
+       {
+          mpi_set_ui (result->x, 0);
+          mpi_set_ui (result->y, 1);
+          mpi_set_ui (result->z, 1);
+        }
       if (mpi_is_secure (scalar))
         {
           /* If SCALAR is in secure memory we assume that it is the
@

