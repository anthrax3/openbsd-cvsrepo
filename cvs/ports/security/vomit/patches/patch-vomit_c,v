head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.16
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.14
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.10
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.12
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.8
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.6
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.4
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.2
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.2.0.12
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.10
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.8
	OPENBSD_5_0:1.2.0.6
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.4
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2013.06.19.03.43.46;	author lteo;	state Exp;
branches;
next	1.2;

1.2
date	2010.04.21.22.31.19;	author alek;	state Exp;
branches;
next	1.1;

1.1
date	2010.04.21.22.07.22;	author alek;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Do not use pcap-int.h as it will be removed from /usr/include soon.

"looks reasonable" millert@@
OK dcoppa@@ matthew@@ sthen@@
@
text
@$OpenBSD: patch-vomit_c,v 1.2 2010/04/21 22:31:19 alek Exp $
--- vomit.c.orig	Wed Dec 12 14:41:51 2001
+++ vomit.c	Sun Mar 31 14:51:00 2013
@@@@ -42,9 +42,6 @@@@
 #include <netdb.h>
 #include <pcap.h>
 #include <pcap.h>
-#ifdef BSD
-#include <pcap-int.h>
-#endif
 #include <event.h>
 
 #include "config.h"
@@@@ -60,6 +57,7 @@@@
 int debug;
 int pcap_off;
 pcap_t *pcap_pd;
+struct event sighup_ev, sigint_ev, sigterm_ev;
 
 int
 cleanup(void)
@@@@ -69,11 +67,9 @@@@ cleanup(void)
 }
 
 void
-sigcb(int sig)
+sigcb(int sig, short event, void *data)
 {
-	extern int event_gotsig;
-
-	event_gotsig = 1;
+	cleanup();
 }
 
 void
@@@@ -92,7 +88,6 @@@@ main(int argc, char **argv)
 {
 	extern char *optarg;
 	extern int optind;
-	extern int (*event_sigcb)(void);
 	int ch;
 	char *name = argv[0];
 	char *fromfile = NULL;
@@@@ -127,12 +122,13 @@@@ main(int argc, char **argv)
 
 	if ((pcap_off = pcap_dloff(pcap_pd)) < 0)
 		errx(1, "couldn't determine link layer offset");
-	
-	signal(SIGHUP, sigcb);
-	signal(SIGINT, sigcb);
-	signal(SIGTERM, sigcb);
 
-	event_sigcb = cleanup;
+	signal_set(&sighup_ev, SIGHUP, sigcb, NULL);
+	signal_add(&sighup_ev, NULL);
+	signal_set(&sigint_ev, SIGINT, sigcb, NULL);
+	signal_add(&sigint_ev, NULL);
+	signal_set(&sigterm_ev, SIGTERM, sigcb, NULL);
+	signal_add(&sigterm_ev, NULL);
 
 	voip_init();
 
@


1.2
log
@fix variable name in patch adjusting port to new libevent api; noticed also by nicm@@
@
text
@d1 14
a14 4
$OpenBSD: patch-vomit_c,v 1.1 2010/04/21 22:07:22 alek Exp $
--- vomit.c.orig	Wed Dec 12 20:41:51 2001
+++ vomit.c	Wed Apr 21 23:49:31 2010
@@@@ -60,6 +60,7 @@@@
d22 1
a22 1
@@@@ -69,11 +70,9 @@@@ cleanup(void)
d36 1
a36 1
@@@@ -92,7 +91,6 @@@@ main(int argc, char **argv)
d44 1
a44 1
@@@@ -127,12 +125,13 @@@@ main(int argc, char **argv)
@


1.1
log
@adjust to the new libevent api after recent libevent update
@
text
@d1 1
a1 1
$OpenBSD$
d46 4
a49 4
+	signal_set(&sighup_ev, SIGINT, sigcb, NULL);
+	signal_add(&sighup_ev, NULL);
+	signal_set(&sighup_ev, SIGTERM, sigcb, NULL);
+	signal_add(&sighup_ev, NULL);
@

