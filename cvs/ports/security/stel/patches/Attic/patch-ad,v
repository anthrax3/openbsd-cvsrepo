head	1.3;
access;
symbols
	OPENBSD_2_9_TRACKING_SWITCH:1.2
	OPENBSD_2_9:1.2.0.10
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.8
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.6
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.2.0.4
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.2
	OPENBSD_2_5_BASE:1.2
	turan_1998-Nov-18:1.1.1.1
	turan:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2001.09.29.21.27.50;	author naddy;	state dead;
branches;
next	1.2;

1.2
date	98.11.29.09.50.32;	author turan;	state Exp;
branches;
next	1.1;

1.1
date	98.11.19.03.22.35;	author turan;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.11.19.03.22.35;	author turan;	state Exp;
branches;
next	;


desc
@@


1.3
log
@- make conform with update-patches
- fix build, dunno if it works
@
text
@--- stel/makeio.c.orig	Fri Apr 26 12:29:27 1996
+++ stel/makeio.c	Sun Nov 29 04:44:21 1998
@@@@ -21,7 +21,8 @@@@
 #include <sys/time.h>
 #include <netinet/in.h>
 #include <pwd.h>
-#include "regex.h"
+#include <time.h>
+#include <regex.h>
 
 #ifdef HAS_SYS_PARAM_H
 #include <sys/param.h>
@@@@ -33,7 +34,7 @@@@
 #endif
 #endif
 
-#include "skey.h"
+#include <skey.h>
 #include "defs.h"
 
 #define ESCAPE_CMD	"escape"
@@@@ -74,7 +75,7 @@@@
 #define CONTROL(x)	((x) & 0x1f)		/* CTRL(x) is not portable */
 static int		escape = CONTROL(']');
 static long		oldmask;
-static long		start;
+static time_t		start;
 static char		skeybuf[SKEYBUFSIZE];
 static unsigned long	userstrokes, traffic, xfertraffic;
 
@@@@ -364,7 +365,15 @@@@
 
 				p = (char *)strtok(line +
 						strlen(LOG_CMD), " \t");
-				strcpy(logfilename, p ? p : tmpnam(NULL));
+				if (p) {
+					strcpy(logfilename, p);
+				} else {
+					strncpy(logfilename,"/tmp/stel.XXXXXXXXXX",256);
+					if (mkstemp(logfilename) == -1) {
+						perror(logfilename);
+						break;
+					}
+				}
 				if ((logfh = open(logfilename,
 					O_WRONLY | O_CREAT, 0600)) == -1) {
 					perror(logfilename);
@@@@ -650,6 +659,9 @@@@
 	printf("\n");
 
 	if ((char *)getenv("SKEYPADFILE") != NULL) {
+/* 
+ * We are not using mjr's des mode.  Don't bother asking.
+ *
 		if (automjr) {
 			cprintf("(using mjr DES padding mode)\n");
 			cprintf("using skeypadfile %s\n",
@@@@ -666,17 +678,18 @@@@
 			if (buf[0] == 'y')
 				desmode = 1;
 		}
+*/
 	}
 
 	/* Crunch seed and password into starting key */
-	if(desmode ? deskeycrunch(key, seed, passwd) :
-		keycrunch(key,seed,passwd) != 0) {
+	/* OpenBSD does not have deskeycrunch */
+	if(keycrunch(key,seed,passwd) != 0) {
 		cprintf("key crunch failed\n");
 		return(NULL);
 	}
 
 	while(n-- != 0)
-		fff(key);
+		f(key);
 	btoe(buf, key);
 	return(buf);
 }
@


1.2
log
@do not ask to use mjr des mode
@
text
@@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
+++ stel/makeio.c	Wed Nov 18 02:36:56 1998
d48 15
a62 1
@@@@ -669,14 +678,14 @@@@
@


1.1.1.1
log
@added stel port
@
text
@@
