head	1.3;
access;
symbols
	OPENBSD_4_7:1.2.0.6
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.4
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.2
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.1.0.30
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.28
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.26
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.24
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.22
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.20
	OPENBSD_3_9_BASE:1.1
	OPENBSD_3_8:1.1.0.18
	OPENBSD_3_8_BASE:1.1
	OPENBSD_3_7:1.1.0.16
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.14
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_5:1.1.0.12
	OPENBSD_3_5_BASE:1.1
	OPENBSD_3_4:1.1.0.10
	OPENBSD_3_4_BASE:1.1
	OPENBSD_3_3:1.1.0.8
	OPENBSD_3_3_BASE:1.1
	OPENBSD_3_2:1.1.0.6
	OPENBSD_3_2_BASE:1.1
	OPENBSD_3_1:1.1.0.4
	OPENBSD_3_1_BASE:1.1
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2010.06.23.18.13.55;	author landry;	state dead;
branches;
next	1.2;

1.2
date	2008.11.01.00.04.13;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.29.21.27.50;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Do we really need a '96 'Secure Telnet Daemon' when we have OpenSSH in
base ? srsly ?
No cries of despair within a week on ports@@, 'Put the port away' jasper@@
@
text
@$OpenBSD: patch-stel_makeio_c,v 1.2 2008/11/01 00:04:13 jasper Exp $
--- stel/makeio.c.orig	Fri Apr 26 18:29:27 1996
+++ stel/makeio.c	Fri Oct 31 22:16:27 2008
@@@@ -21,7 +21,8 @@@@ static char *rcsid = "@@(#) $Id: makeio.c,v 1.114 1996/
 #include <sys/time.h>
 #include <netinet/in.h>
 #include <pwd.h>
-#include "regex.h"
+#include <time.h>
+#include <regex.h>
 
 #ifdef HAS_SYS_PARAM_H
 #include <sys/param.h>
@@@@ -33,7 +34,7 @@@@ static char *rcsid = "@@(#) $Id: makeio.c,v 1.114 1996/
 #endif
 #endif
 
-#include "skey.h"
+#include <skey.h>
 #include "defs.h"
 
 #define ESCAPE_CMD	"escape"
@@@@ -74,7 +75,7 @@@@ long	crc32val;
 #define CONTROL(x)	((x) & 0x1f)		/* CTRL(x) is not portable */
 static int		escape = CONTROL(']');
 static long		oldmask;
-static long		start;
+static time_t		start;
 static char		skeybuf[SKEYBUFSIZE];
 static unsigned long	userstrokes, traffic, xfertraffic;
 
@@@@ -364,7 +365,15 @@@@ int		*len;
 
 				p = (char *)strtok(line +
 						strlen(LOG_CMD), " \t");
-				strcpy(logfilename, p ? p : tmpnam(NULL));
+				if (p) {
+					strcpy(logfilename, p);
+				} else {
+					strncpy(logfilename,"/tmp/stel.XXXXXXXXXX",256);
+					if (mkstemp(logfilename) == -1) {
+						perror(logfilename);
+						break;
+					}
+				}
 				if ((logfh = open(logfilename,
 					O_WRONLY | O_CREAT, 0600)) == -1) {
 					perror(logfilename);
@@@@ -650,6 +659,9 @@@@ int	automjr;
 	printf("\n");
 
 	if ((char *)getenv("SKEYPADFILE") != NULL) {
+/* 
+ * We are not using mjr's des mode.  Don't bother asking.
+ *
 		if (automjr) {
 			cprintf("(using mjr DES padding mode)\n");
 			cprintf("using skeypadfile %s\n",
@@@@ -666,17 +678,18 @@@@ int	automjr;
 			if (buf[0] == 'y')
 				desmode = 1;
 		}
+*/
 	}
 
 	/* Crunch seed and password into starting key */
-	if(desmode ? deskeycrunch(key, seed, passwd) :
-		keycrunch(key,seed,passwd) != 0) {
+	/* OpenBSD does not have deskeycrunch */
+	if(keycrunch(key,seed,passwd) != 0) {
 		cprintf("key crunch failed\n");
 		return(NULL);
 	}
 
 	while(n-- != 0)
-		fff(key);
+		f(key);
 	btoe(buf, key);
 	return(buf);
 }
@


1.2
log
@- tweak DESCR and MESSAGE
- regen patches and PLIST
- tweak to LIB_DEPENDS
@
text
@d1 1
a1 1
$OpenBSD: patch-stel_makeio_c,v 1.1 2001/09/29 21:27:50 naddy Exp $
@


1.1
log
@- make conform with update-patches
- fix build, dunno if it works
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 2
+++ stel/makeio.c	Sat Sep 29 22:55:22 2001
@@@@ -21,7 +21,8 @@@@ static char *rcsid = "@@(#) $Id: makeio.c
d14 1
a14 1
@@@@ -33,7 +34,7 @@@@ static char *rcsid = "@@(#) $Id: makeio.c
@

