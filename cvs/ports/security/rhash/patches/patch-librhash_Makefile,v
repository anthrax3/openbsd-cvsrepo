head     1.1;
branch   1.1.1;
access   ;
symbols  dcoppa_20170809:1.1.1.1 dcoppa:1.1.1;
locks    ; strict;
comment  @# @;


1.1
date     2017.08.08.22.04.57;  author dcoppa;  state Exp;
branches 1.1.1.1;
next     ;
commitid        7CHmkcW4fX8Nygep;

1.1.1.1
date     2017.08.08.22.04.57;  author dcoppa;  state Exp;
branches ;
next     ;
commitid        7CHmkcW4fX8Nygep;


desc
@@



1.1
log
@Initial revision
@
text
@$OpenBSD$

Index: librhash/Makefile
--- librhash/Makefile.orig
+++ librhash/Makefile
@@@@ -2,10 +2,10 @@@@
 CC      ?= gcc
 AR      ?= ar
 #NOTE: NDEBUG turns off asserts
-OPTFLAGS   = -O2 -DNDEBUG -fomit-frame-pointer -ffunction-sections -fdata-sections
+OPTFLAGS   = -DNDEBUG -fomit-frame-pointer -ffunction-sections -fdata-sections
 OPTLDFLAGS =
-CFLAGS     = $(OPTFLAGS)
-LDFLAGS    = $(OPTLDFLAGS)
+CFLAGS     += $(OPTFLAGS)
+LDFLAGS    += $(OPTLDFLAGS)
 ADDCFLAGS  =
 LIBCFLAGS  =
 ADDLDFLAGS =
@@@@ -187,9 +187,8 @@@@ test-dll: $(DLLNAME) test_hashes.o
 
 # shared and static libraries
 $(SONAME): $(SOURCES)
-	sed -n '1s/.*/{ global:/p; s/^RHASH_API.* \([a-z0-9_]\+\)(.*/  \1;/p; $$s/.*/local: *; };/p' $(SO_HEADERS) > exports.sym
-	$(CC) -fpic $(ALLCFLAGS) -shared $(SOURCES) -Wl,--version-script,exports.sym,-soname,$(SONAME) $(LIBLDFLAGS) -o $@@
-	ln -s $(SONAME) $(SOLINK)
+	sed -n '1s/.*/{ global:/p; s/^RHASH_API.* \([a-z0-9_]*\)(.*/  \1;/p; $$s/.*/local: *; };/p' $(SO_HEADERS) > exports.sym
+	$(CC) -fpic $(ALLCFLAGS) -shared $(SOURCES) -Wl,--version-script,exports.sym $(LIBLDFLAGS) -o $@@
 # use 'nm -Cg --defined-only $@@' to view exported symbols
 
 $(LIBRARY): $(OBJECTS)
@


1.1.1.1
log
@
Import RHash, a console utility and library for computing and
verifying hash sums of files.
New dependency for an upcoming update to CMake-3.9.

Suggestion and testing, rsadowski@@
OK rsadowski@@

@
text
@@
