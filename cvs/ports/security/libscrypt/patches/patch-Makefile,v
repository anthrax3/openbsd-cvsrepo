head	1.2;
access;
symbols
	OPENBSD_6_0:1.2.0.10
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.6
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.8
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.4
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.2
	OPENBSD_5_6_BASE:1.2
	benoit_20140315:1.1.1.1
	benoit:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2014.05.08.20.49.41;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2014.03.15.13.37.18;	author benoit;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2014.03.15.13.37.18;	author benoit;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to libscrypt 1.19, from maintainer LEVAI Daniel, edited by me to
bump shlib major as the function libscrypt_hexconvert is no longer exported
@
text
@$OpenBSD: patch-Makefile,v 1.1.1.1 2014/03/15 13:37:18 benoit Exp $
- respect ports CFLAGS
- use OpenBSD shared library naming
- sys.mk defines CFLAGS and LDFLAGS so don't use conditional value assignments
  for those.
- we don't patch the install-osx target, because we don't use it
--- Makefile.orig	Tue May  6 11:42:07 2014
+++ Makefile	Thu May  8 21:41:43 2014
@@@@ -5,20 +5,19 @@@@ MAKE_DIR     ?= install -d
 INSTALL_DATA ?= install
 
 CC?=gcc
-CFLAGS?=-O2 -Wall -g -D_FORTIFY_SOURCE=2 -fstack-protector -fPIC
-LDFLAGS?=-Wl,-z,now -Wl,-z,relro -Wl,-soname,libscrypt.so.0 -Wl,--version-script=libscrypt.version
+CFLAGS=-Wall -g -D_FORTIFY_SOURCE=2 -fstack-protector -fPIC ${PORTS_CFLAGS}
+LDFLAGS=-Wl,-z,now -Wl,-z,relro -Wl,--version-script=libscrypt.version
 CFLAGS_EXTRA?=-Wl,-rpath=.
 
 all: reference
 
 OBJS= crypto_scrypt-nosse.o sha256.o crypto_scrypt-hexconvert.o crypto-mcf.o b64.o crypto-scrypt-saltgen.o crypto_scrypt-check.o crypto_scrypt-hash.o slowequals.o
 
-libscrypt.so.0: $(OBJS) 
-	$(CC)  $(LDFLAGS) -shared -o libscrypt.so.0  $(OBJS) -lm -lc
+libscrypt.so.${LIBscrypt_VERSION}: $(OBJS) 
+	$(CC)  $(LDFLAGS) -shared -o libscrypt.so.${LIBscrypt_VERSION}  $(OBJS) -lm -lc
 	ar rcs libscrypt.a  $(OBJS)
 
-reference: libscrypt.so.0 main.o b64.o crypto_scrypt-hexconvert.o
-	ln -s -f libscrypt.so.0 libscrypt.so
+reference: libscrypt.so.${LIBscrypt_VERSION} main.o b64.o crypto_scrypt-hexconvert.o
 	$(CC) -Wall -o reference main.o b64.o crypto_scrypt-hexconvert.o $(CFLAGS_EXTRA) -L.  -lscrypt
 
 clean:
@@@@ -33,11 +32,10 @@@@ devtest:
 	splint crypto-scrypt-saltgen.c +posixlib -compdef
 	valgrind ./reference
 
-install: libscrypt.so.0
-	$(MAKE_DIR) $(DESTDIR) $(DESTDIR)$(PREFIX) $(DESTDIR)$(LIBDIR) $(DESTDIR)$(INCLUDEDIR)
-	$(INSTALL_DATA) -pm 0755 libscrypt.so.0 $(DESTDIR)$(LIBDIR)
-	cd $(DESTDIR)$(LIBDIR) && ln -s -f libscrypt.so.0 $(DESTDIR)$(LIBDIR)/libscrypt.so
-	$(INSTALL_DATA) -pm 0644 libscrypt.h  $(DESTDIR)$(INCLUDEDIR)
+install: libscrypt.so.${LIBscrypt_VERSION}
+	$(MAKE_DIR) $(LIBDIR) $(INCLUDEDIR)
+	$(INSTALL_DATA) -pm 0755 libscrypt.so.${LIBscrypt_VERSION} $(LIBDIR)
+	$(INSTALL_DATA) -pm 0644 libscrypt.h  $(INCLUDEDIR)
 
 install-osx: libscrypt.so.0
 	$(MAKE_DIR) $(DESTDIR) $(DESTDIR)$(PREFIX) $(DESTDIR)$(LIBDIR) $(DESTDIR)$(INCLUDEDIR)
@@@@ -46,4 +44,4 @@@@ install-osx: libscrypt.so.0
 	$(INSTALL_DATA) -pm 0644 libscrypt.h  $(DESTDIR)$(INCLUDEDIR)
 
 install-static: libscrypt.a
-	$(INSTALL_DATA) -pm 0644 libscrypt.a $(DESTDIR)$(LIBDIR)
+	$(INSTALL_DATA) -pm 0644 libscrypt.a $(LIBDIR)
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
a8 2
--- Makefile.orig	Thu Feb 27 02:05:51 2014
+++ Makefile	Mon Mar 10 12:38:53 2014
d21 1
a21 1
 OBJS= crypto_scrypt-nosse.o sha256.o crypto_scrypt-hexconvert.o crypto-mcf.o b64.o crypto-scrypt-saltgen.o crypto_scrypt-check.o crypto_scrypt-hash.o
d24 1
a24 1
-	$(CC)  $(LDFLAGS) -shared -o libscrypt.so.0 -lc -lm  $(OBJS)
d26 1
a26 1
+	$(CC)  $(LDFLAGS) -shared -o libscrypt.so.${LIBscrypt_VERSION} -lc -lm  $(OBJS)
d29 1
a29 1
-reference: libscrypt.so.0 main.o b64.o
d31 2
a32 2
+reference: libscrypt.so.${LIBscrypt_VERSION} main.o b64.o
 	$(CC) -Wall -o reference main.o  b64.o $(CFLAGS_EXTRA) -L.  -lscrypt
d36 1
a36 1
 	splint crypto-scrypt-saltgen.c +posixlib
d48 5
@


1.1.1.1
log
@Import libscrypt.

Shared library that implements the scrypt key derivation function.

from maintainer Daniel Levai, ok sthen@@
@
text
@@
