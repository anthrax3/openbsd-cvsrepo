head	1.3;
access;
symbols
	OPENBSD_6_0:1.3.0.6
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.4
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.2.0.4
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.2
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.1.1.1.0.20
	OPENBSD_5_5_BASE:1.1.1.1
	OPENBSD_5_4:1.1.1.1.0.18
	OPENBSD_5_4_BASE:1.1.1.1
	OPENBSD_5_3:1.1.1.1.0.16
	OPENBSD_5_3_BASE:1.1.1.1
	OPENBSD_5_2:1.1.1.1.0.14
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.12
	OPENBSD_5_0:1.1.1.1.0.10
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.8
	OPENBSD_4_9_BASE:1.1.1.1
	OPENBSD_4_8:1.1.1.1.0.6
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.4
	OPENBSD_4_7_BASE:1.1.1.1
	OPENBSD_4_6:1.1.1.1.0.2
	OPENBSD_4_6_BASE:1.1.1.1
	benoit_20090602:1.1.1.1
	benoit:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2015.05.01.17.40.58;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	J6UrblqNyWdPyLOl;

1.2
date	2014.04.15.11.38.53;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2009.06.02.08.36.02;	author benoit;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.06.02.08.36.02;	author benoit;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Consistency in endian.h includes.
@
text
@$OpenBSD: patch-samdump2_c,v 1.2 2014/04/15 11:38:53 naddy Exp $
--- samdump2.c.orig	Fri Apr 20 14:27:00 2012
+++ samdump2.c	Mon Apr 14 20:00:36 2014
@@@@ -41,8 +41,13 @@@@
 #ifdef BYTE_ORDER
 #if BYTE_ORDER == LITTLE_ENDIAN
 #elif BYTE_ORDER == BIG_ENDIAN
+#ifndef __OpenBSD__
 #include <byteswap.h>
 #else
+#include <endian.h>
+#define __bswap_32 __swap32
+#endif
+#else
 #warning "Doesn't define a standard ENDIAN type"
 #endif
 #else
@@@@ -72,7 +77,7 @@@@ void str_to_key(unsigned char *str,unsigned char *key)
 	for (i=0;i<8;i++) {
 		key[i] = (key[i]<<1);
 	}
-	des_set_odd_parity((des_cblock *)key);
+	DES_set_odd_parity((DES_cblock *)key);
 }
 
 /*
@@@@ -210,8 +215,8 @@@@ unsigned char* utf16_to_utf8 (unsigned char *dest, uns
   unsigned char hbootkey[0x20];
   
   /* Des */
-  des_key_schedule ks1, ks2;
-  des_cblock deskey1, deskey2;
+  DES_key_schedule ks1, ks2;
+  DES_cblock deskey1, deskey2;
   
   int i, j;
   
@@@@ -419,15 +424,15 @@@@ unsigned char* utf16_to_utf8 (unsigned char *dest, uns
       
       /* Get the two decrpt keys. */
       sid_to_key1(rid,(unsigned char *)deskey1);
-      des_set_key_checked((des_cblock *)deskey1,ks1);
+      DES_set_key_checked((DES_cblock *)deskey1,&ks1);
       sid_to_key2(rid,(unsigned char *)deskey2);
-      des_set_key_unchecked((des_cblock *)deskey2,ks2);
+      DES_set_key_unchecked((DES_cblock *)deskey2,&ks2);
       
       /* Decrypt the lanman password hash as two 8 byte blocks. */
-      des_ecb_encrypt((des_cblock *)obfkey,
-		      (des_cblock *)fb, ks1, DES_DECRYPT);
-      des_ecb_encrypt((des_cblock *)(obfkey + 8),
-		      (des_cblock *)&fb[8], ks2, DES_DECRYPT);
+      DES_ecb_encrypt((DES_cblock *)obfkey,
+		      (DES_cblock *)fb, &ks1, DES_DECRYPT);
+      DES_ecb_encrypt((DES_cblock *)(obfkey + 8),
+		      (DES_cblock *)&fb[8], &ks2, DES_DECRYPT);
       
       
       
@@@@ -472,16 +477,16 @@@@ unsigned char* utf16_to_utf8 (unsigned char *dest, uns
       if (lm_size != 0x14) {
 	/* Get the two decrpt keys. */
 	sid_to_key1(rid,(unsigned char *)deskey1);
-	des_set_key((des_cblock *)deskey1,ks1);
+	DES_set_key((DES_cblock *)deskey1,&ks1);
 	sid_to_key2(rid,(unsigned char *)deskey2);
-	des_set_key((des_cblock *)deskey2,ks2);
+	DES_set_key((DES_cblock *)deskey2,&ks2);
       }
 
       /* Decrypt the NT md4 password hash as two 8 byte blocks. */
-      des_ecb_encrypt((des_cblock *)obfkey,
-		      (des_cblock *)fb, ks1, DES_DECRYPT);
-      des_ecb_encrypt((des_cblock *)(obfkey + 8),
-		      (des_cblock *)&fb[8], ks2, DES_DECRYPT);
+      DES_ecb_encrypt((DES_cblock *)obfkey,
+		      (DES_cblock *)fb, &ks1, DES_DECRYPT);
+      DES_ecb_encrypt((DES_cblock *)(obfkey + 8),
+		      (DES_cblock *)&fb[8], &ks2, DES_DECRYPT);
       
       /* sf27 wrap to sf25 */
       //sf27( obfkey, (int*)&rid, fb );
@


1.2
log
@switch from the ancient des_ API to DES_; ok benoit@@
@
text
@d1 1
a1 1
$OpenBSD: patch-samdump2_c,v 1.1.1.1 2009/06/02 08:36:02 benoit Exp $
d11 1
a11 1
+#include <sys/endian.h>
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD$
--- samdump2.c.orig	Thu Oct  2 15:44:47 2008
+++ samdump2.c	Thu May 28 23:24:23 2009
@@@@ -41,7 +41,12 @@@@
d10 1
a10 1
+#else
d14 1
a14 1
 #else
d17 66
@


1.1.1.1
log
@import samdump2

samdump2 is a tool for dumping Windows 2k/NT/XP password hashes.

with some tweaks by and ok ajacoutot@@
@
text
@@
