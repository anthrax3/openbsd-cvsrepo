head	1.1;
access;
symbols
	OPENBSD_5_6:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2014.11.13.10.14.27;	author ajacoutot;	state dead;
branches
	1.1.2.1;
next	;
commitid	AUoYt1fX5gZI7Te3;

1.1.2.1
date	2014.11.13.10.14.27;	author ajacoutot;	state Exp;
branches;
next	;
commitid	AUoYt1fX5gZI7Te3;


desc
@@


1.1
log
@file patch-lib_gnutls_ecc_c was initially added on branch OPENBSD_5_6.
@
text
@@


1.1.2.1
log
@Merge upstream fix for CVE-2014-8564.
@
text
@a0 29
$OpenBSD$

CVE-2014-8564
https://gitorious.org/gnutls/gnutls/commit/470ade2a99ec5bcfb1b191b175bc1943aa50f359

--- lib/gnutls_ecc.c.orig	Sun Nov 10 18:59:14 2013
+++ lib/gnutls_ecc.c	Thu Nov 13 11:09:35 2014
@@@@ -53,6 +53,10 @@@@ _gnutls_ecc_ansi_x963_export(gnutls_ecc_curve_t curve,
 
 	/* pad and store x */
 	byte_size = (_gnutls_mpi_get_nbits(x) + 7) / 8;
+	if (numlen < byte_size) {
+		return gnutls_assert_val(GNUTLS_E_INVALID_REQUEST);
+	}
+
 	size = out->size - (1 + (numlen - byte_size));
 	ret =
 	    _gnutls_mpi_print(x, &out->data[1 + (numlen - byte_size)],
@@@@ -61,6 +65,10 @@@@ _gnutls_ecc_ansi_x963_export(gnutls_ecc_curve_t curve,
 		return gnutls_assert_val(ret);
 
 	byte_size = (_gnutls_mpi_get_nbits(y) + 7) / 8;
+	if (numlen < byte_size) {
+		return gnutls_assert_val(GNUTLS_E_INVALID_REQUEST);
+	}
+
 	size = out->size - (1 + (numlen + numlen - byte_size));
 	ret =
 	    _gnutls_mpi_print(y,
@

