head	1.26;
access;
symbols
	OPENBSD_6_2:1.26.0.2
	OPENBSD_6_2_BASE:1.26
	OPENBSD_6_1:1.25.0.2
	OPENBSD_6_1_BASE:1.25
	OPENBSD_6_0:1.21.0.2
	OPENBSD_6_0_BASE:1.21
	OPENBSD_5_9:1.16.0.2
	OPENBSD_5_9_BASE:1.16
	OPENBSD_5_8:1.10.0.4
	OPENBSD_5_8_BASE:1.10
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.1.1.1.0.2
	OPENBSD_5_6_BASE:1.1.1.1
	sthen_20140715:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.26
date	2017.05.25.14.39.24;	author sthen;	state Exp;
branches;
next	1.25;
commitid	WZlfx8OcU54OY0JQ;

1.25
date	2017.03.28.14.14.01;	author sthen;	state Exp;
branches;
next	1.24;
commitid	73StlvNxOSmesLk6;

1.24
date	2017.01.26.14.40.04;	author sthen;	state Exp;
branches;
next	1.23;
commitid	oq0yVWBMfG5vzB0h;

1.23
date	2016.09.26.11.11.42;	author sthen;	state Exp;
branches;
next	1.22;
commitid	1FcDSjtE21uNK5Hg;

1.22
date	2016.09.22.21.18.06;	author sthen;	state Exp;
branches;
next	1.21;
commitid	sZBRIu0NJbai2dcC;

1.21
date	2016.05.04.08.07.03;	author sthen;	state Exp;
branches;
next	1.20;
commitid	erNKesw4a5ziWW34;

1.20
date	2016.03.19.12.16.04;	author sthen;	state Exp;
branches;
next	1.19;
commitid	S4Lgq2iZI4zJjJKe;

1.19
date	2016.03.11.23.03.21;	author naddy;	state Exp;
branches;
next	1.18;
commitid	gGRDwY9dCtFfKKUi;

1.18
date	2016.03.07.10.58.49;	author sthen;	state Exp;
branches;
next	1.17;
commitid	RGpiBBBbFf9GIw4i;

1.17
date	2016.03.01.15.37.53;	author sthen;	state Exp;
branches;
next	1.16;
commitid	fBNj0UqnaPJ7yE5n;

1.16
date	2016.01.29.15.23.43;	author sthen;	state Exp;
branches
	1.16.2.1;
next	1.15;
commitid	cKpYdGQWWf3vOvFy;

1.15
date	2016.01.28.22.50.59;	author sthen;	state Exp;
branches;
next	1.14;
commitid	dVUrVbZCcWKAtxH7;

1.14
date	2016.01.28.15.51.38;	author sthen;	state Exp;
branches;
next	1.13;
commitid	9Lx4bGAEeno5EE0H;

1.13
date	2015.12.03.19.39.59;	author sthen;	state Exp;
branches;
next	1.12;
commitid	i6QGKwCKHSM8CCU2;

1.12
date	2015.12.03.16.21.30;	author sthen;	state Exp;
branches;
next	1.11;
commitid	gqrRvToH5Qi3p2oL;

1.11
date	2015.09.12.19.29.34;	author sthen;	state Exp;
branches;
next	1.10;
commitid	fMikk6wXACSXOUi4;

1.10
date	2015.07.19.00.39.01;	author sthen;	state Exp;
branches
	1.10.4.1;
next	1.9;
commitid	69s5NbQN3ELZS2bY;

1.9
date	2015.07.19.00.06.42;	author sthen;	state Exp;
branches;
next	1.8;
commitid	p3Xi77KnUQ0t7WKH;

1.8
date	2015.07.09.14.49.35;	author sthen;	state Exp;
branches;
next	1.7;
commitid	xwIxCo7UCOPsWbO8;

1.7
date	2015.06.13.11.30.00;	author sthen;	state Exp;
branches;
next	1.6;
commitid	qvfBIhHrYK0UFJ3j;

1.6
date	2015.06.11.15.30.17;	author sthen;	state Exp;
branches;
next	1.5;
commitid	UR1xslwg583cUTZq;

1.5
date	2015.03.19.16.22.04;	author sthen;	state Exp;
branches;
next	1.4;
commitid	IY5fJQvRKiILfhFH;

1.4
date	2015.01.09.18.36.32;	author sthen;	state Exp;
branches
	1.4.2.1;
next	1.3;
commitid	sJ94KwyfXVcU1mL1;

1.3
date	2014.10.15.15.01.11;	author sthen;	state Exp;
branches;
next	1.2;
commitid	uJ9MNu3YvEMuWoK4;

1.2
date	2014.08.21.23.15.57;	author sthen;	state Exp;
branches;
next	1.1;
commitid	NO71pj0o43c1310h;

1.1
date	2014.07.15.22.23.16;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;
commitid	5fqjZDa67qkUBY8y;

1.1.1.1
date	2014.07.15.22.23.16;	author sthen;	state Exp;
branches
	1.1.1.1.2.1;
next	;
commitid	5fqjZDa67qkUBY8y;

1.1.1.1.2.1
date	2015.03.20.13.02.34;	author jasper;	state Exp;
branches;
next	;
commitid	FiVva2uqSgi8rBdO;

1.4.2.1
date	2015.03.20.12.24.27;	author jasper;	state Exp;
branches;
next	1.4.2.2;
commitid	a3dOgVRQnlrY7wXf;

1.4.2.2
date	2015.06.13.11.31.15;	author sthen;	state Exp;
branches;
next	1.4.2.3;
commitid	PBfR49pyak0xStxo;

1.4.2.3
date	2015.06.13.11.33.04;	author sthen;	state Exp;
branches;
next	1.4.2.4;
commitid	xgdVwfDRmEtVoKCX;

1.4.2.4
date	2015.07.09.14.50.40;	author sthen;	state Exp;
branches;
next	;
commitid	R4bInOTLRFydfX1M;

1.10.4.1
date	2015.12.08.00.50.51;	author sthen;	state Exp;
branches;
next	1.10.4.2;
commitid	WqXzVRlXbKQ8edZg;

1.10.4.2
date	2016.01.29.15.31.17;	author sthen;	state Exp;
branches;
next	;
commitid	3XiSNnGVWMznJSlg;

1.16.2.1
date	2016.03.19.12.20.31;	author sthen;	state Exp;
branches;
next	;
commitid	DF7JIUfJh8EzVAgV;


desc
@@


1.26
log
@update to OpenSSL-1.0.2l
@
text
@# $OpenBSD: Makefile,v 1.25 2017/03/28 14:14:01 sthen Exp $

COMMENT=	TLS/SSL library and tools

PORTROACH=	limit:^1\.0\.
V=		1.0.2l
DISTNAME=	openssl-$V
PKGNAME=	openssl-$V

SHLIBVER=	5.1
SHARED_LIBS=	crypto ${SHLIBVER} \
		ssl ${SHLIBVER}

CATEGORIES=	security net

HOMEPAGE=	http://www.openssl.org/

MAINTAINER=	Stuart Henderson <sthen@@openbsd.org>

# OpenSSL
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += c

MASTER_SITES=	https://www.openssl.org/source/ \
		https://www.openssl.org/source/old/${V:C/.$//}/ \
		ftp://ftp.openssl.org/source/

FAKE_FLAGS=	MANDIR=${PREFIX}/lib/eopenssl/man

CONFIGURE_STYLE=	simple
CONFIGURE_SCRIPT=	config
CONFIGURE_ARGS+=	--prefix=${PREFIX} \
			--openssldir=${PREFIX}/share/eopenssl \
	                --install_prefix=${WRKINST} \
			no-threads no-krb5 \
			no-rc5 no-ssl2 no-ssl3 \
			shared

# install to unusual directory name - this port is *not* intended to be
# picked up by configure scripts without explicitly CPPFLAGS/LDFLAGS.
# common names like lib/openssl, openssl/lib, etc, *do* get picked up.
MAKE_FLAGS+=	CC="${CC}" \
		LIBDIR="lib/eopenssl" \
		LIBRPATH="${TRUEPREFIX}/lib/eopenssl" \
		PORTCFLAGS="${CFLAGS}" \
		SHLIB_VERSION_NUMBER=${SHLIBVER} \
		SHLIB_MAJOR=${SHLIBVER:R} \
		SHLIB_MINOR=${SHLIBVER:E}
MAKE_ENV+=	LIBRPATH="${TRUEPREFIX}/lib/eopenssl"

post-configure:
	cd ${WRKSRC}; ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} \
	    ${MAKE_FLAGS} -f ${MAKE_FILE} depend

# include/openssl and pkgconfig files are moved here, doing that in
# OpenSSL's build infrastructure needs a bunch more patching.
post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/include/eopenssl
.for i j in openssl eopenssl libssl libessl libcrypto libecrypto
	mv ${PREFIX}/lib/eopenssl/pkgconfig/$i.pc ${PREFIX}/lib/pkgconfig/$j.pc
.endfor
	rmdir ${PREFIX}/lib/eopenssl/pkgconfig/
	mv ${PREFIX}/include/openssl ${PREFIX}/include/eopenssl/
	mv ${PREFIX}/bin/openssl ${PREFIX}/bin/eopenssl
	mv ${PREFIX}/bin/c_rehash ${PREFIX}/share/eopenssl/misc/
	rm -f ${PREFIX}/lib/eopenssl/lib{crypto,ssl}.so

.include <bsd.port.mk>
@


1.25
log
@add portroach limit to 1.0.x
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2017/01/26 14:40:04 sthen Exp $
d6 1
a6 1
V=		1.0.2k
d10 1
a10 1
SHLIBVER=	5.0
@


1.24
log
@update to openssl-1.0.2k
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2016/09/26 11:11:42 sthen Exp $
d5 1
@


1.23
log
@update to OpenSSL 1.0.2j, "A bug fix which included a CRL sanity check
was added to OpenSSL 1.1.0 but was omitted from OpenSSL 1.0.2i. As a
result any attempt to use CRLs in OpenSSL 1.0.2i will crash with a null
pointer exception."

(not moved to 1.1.0 yet, so today's critical fix for CVE-2016-6309
doesn't apply).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2016/09/22 21:18:06 sthen Exp $
d5 1
a5 1
V=		1.0.2j
@


1.22
log
@security update to OpenSSL 1.0.2i
major library bump because dtls1_clear_record_buffer() was removed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2016/05/04 08:07:03 sthen Exp $
d5 1
a5 1
V=		1.0.2i
@


1.21
log
@update to OpenSSL-1.0.2h:

*) Prevent padding oracle in AES-NI CBC MAC check
*) Fix EVP_EncodeUpdate overflow
*) Fix EVP_EncryptUpdate overflow
*) Prevent ASN.1 BIO excessive memory allocation
*) EBCDIC overread
*) Modify behavior of ALPN to invoke callback after SNI/servername
callback, such that updates to the SSL_CTX affect ALPN.
*) Remove LOW from the DEFAULT cipher list, removing single DES
from the default.
*) Only remove the SSLv2 methods with the no-ssl2-method option.
When the methods are enabled and ssl2 is disabled the methods return
NULL.  (i.e. restore ABI compat with pre-1.0.2g cf. SSLv2_*_method)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2016/03/19 12:16:04 sthen Exp $
d5 1
a5 1
V=		1.0.2h
d9 1
a9 1
SHLIBVER=	4.1
@


1.20
log
@add fallback MASTER_SITES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2016/03/11 23:03:21 naddy Exp $
d5 1
a5 2
V=		1.0.2g
REVISION=	1
d9 1
a9 1
SHLIBVER=	4.0
@


1.19
log
@remove NO_SHARED_LIBS and merge PFRAG.shared into PLIST; ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2016/03/07 10:58:49 sthen Exp $
d26 1
@


1.18
log
@now that sslscan uses a special build, disable ssl3/rc5 again in openssl port
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2016/03/01 15:37:53 sthen Exp $
d6 1
a6 1
REVISION=	0
d36 2
a37 1
			no-rc5 no-ssl2 no-ssl3
a49 8

.include <bsd.port.arch.mk>

.if ${NO_SHARED_LIBS} == "Yes"
CONFIGURE_ARGS+=	no-shared
.else
CONFIGURE_ARGS+=	shared
.endif
@


1.17
log
@security update to OpenSSL 1.0.2g, for the few things in ports which use it
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2016/01/29 15:23:43 sthen Exp $
d6 1
d35 2
a36 1
			no-threads no-krb5
@


1.16
log
@fix the installed pkg-config files, issue reported a while ago by
Wladimir J. van der Laan
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2016/01/28 22:50:59 sthen Exp $
d5 1
a5 2
V=		1.0.2f
REVISION=	1
d9 1
a9 1
SHLIBVER=	3.0
@


1.16.2.1
log
@MFC: add fallback MASTER_SITES.

Note the security fixes aren't backported yet due to the ABI break.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2016/01/29 15:23:43 sthen Exp $
a25 1
		https://www.openssl.org/source/old/${V:C/.$//}/ \
@


1.15
log
@cherrypick patch from OpenSSL_1_0_2-stable upstream:
Correct number of arguments in BIO_get_conn_int_port macro.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2016/01/28 15:51:38 sthen Exp $
d6 1
a6 1
REVISION=	0
@


1.14
log
@security update to openssl-1.0.2f
http://www.openssl.org/news/openssl-1.0.2-notes.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2015/12/03 19:39:59 sthen Exp $
d6 1
@


1.13
log
@The upstream distfile was quietly re-rolled.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2015/12/03 16:21:30 sthen Exp $
d5 1
a5 2
V=		1.0.2e
REVISION=	0
@


1.12
log
@update to OpenSSL 1.0.2e, patching around the pod2mantest script missing
in the distribution tar file.

- BN_mod_exp may produce incorrect results on x86_64 (CVE-2015-3193, Aug 13)

- Certificate verify crash with missing PSS parameter (CVE-2015-3194, Aug 27)

- X509_ATTRIBUTE memory leak (CVE-2015-3195, Nov 9)

(plus the advisory mentions an issue fixed in 1.0.2d)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2015/09/12 19:29:34 sthen Exp $
d6 1
@


1.11
log
@update to openssl-1.0.2d
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2015/07/19 00:39:01 sthen Exp $
d5 1
a5 1
V=		1.0.2d
d13 1
a13 1
CATEGORIES=	security net games
@


1.10
log
@tweak port
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2015/07/19 00:06:42 sthen Exp $
d5 1
a5 2
V=		1.0.1p
REVISION=	1
d9 1
a9 1
SHLIBVER=	2.0
@


1.10.4.1
log
@update OpenSSL in 5.8-stable to 1.0.1q
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2015/12/03 19:39:59 sthen Exp $
d5 2
a6 1
V=		1.0.1q
d14 1
a14 1
CATEGORIES=	security net
@


1.10.4.2
log
@update to openssl-1.0.1r
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10.4.1 2015/12/08 00:50:51 sthen Exp $
d5 1
a5 1
V=		1.0.1r
@


1.9
log
@Reenable crappy old protocols, mainly for use with sslscan (which connects
to a server to identify supported SSL/TLS methods) - note that this port is
not used generally within OpenBSD, only for testing and special cases.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2015/07/09 14:49:35 sthen Exp $
d6 1
a6 1
REVISION=	0
d14 1
a14 1
CATEGORIES=	security net
@


1.8
log
@security update to openssl-1.0.1o (libressl is not affected by this problem)

During certificate verification, OpenSSL (starting from version 1.0.1n and
1.0.2b) will attempt to find an alternative certificate chain if the first
attempt to build such a chain fails. An error in the implementation of this
logic can mean that an attacker could cause certain checks on untrusted
certificates to be bypassed, such as the CA flag, enabling them to use a valid
leaf certificate to act as a CA and "issue" an invalid certificate.

This issue will impact any application that verifies certificates including
SSL/TLS/DTLS clients and SSL/TLS/DTLS servers using client authentication.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2015/06/13 11:30:00 sthen Exp $
d6 1
d10 1
a10 1
SHLIBVER=	1.1
d35 1
a35 2
			no-threads \
			no-rc5 no-krb5 no-ssl2 no-ssl3
@


1.7
log
@update to openssl-1.0.1o, restoring ABI
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2015/06/11 15:30:17 sthen Exp $
d5 1
a5 1
V=		1.0.1o
@


1.6
log
@update to openssl-1.0.1n; http://www.openssl.org/news/secadv_20150611.txt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2015/03/19 16:22:04 sthen Exp $
d5 1
a5 1
V=		1.0.1n
@


1.5
log
@SECURITY update to OpenSSL 1.0.1m

http://openssl.org/news/secadv_20150319.txt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2015/01/09 18:36:32 sthen Exp $
d5 1
a5 1
V=		1.0.1m
d9 1
a9 1
SHLIBVER=	1.0
@


1.4
log
@update to openssl 1.0.1k
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2014/10/15 15:01:11 sthen Exp $
d5 1
a5 1
V=		1.0.1k
@


1.4.2.1
log
@SECURITY update to OpenSSL 1.0.1m

http://openssl.org/news/secadv_20150319.txt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2015/03/19 16:22:04 sthen Exp $
d5 1
a5 1
V=		1.0.1m
@


1.4.2.2
log
@MFC: update to openssl-1.0.1n; http://www.openssl.org/news/secadv_20150611.txt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2015/06/13 11:30:00 sthen Exp $
d5 1
a5 1
V=		1.0.1o
d9 1
a9 1
SHLIBVER=	1.1
@


1.4.2.3
log
@forced whitespace-only commit to note that previous commit log should have read:

update to openssl-1.0.1o; http://www.openssl.org/news/secadv_20150611.txt
(bugs were fixed in 1.0.1n, but this had an ABI change - 1.0.1o restores the
interface compatibility).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4.2.2 2015/06/13 11:31:15 sthen Exp $
d59 1
a59 1
		${MAKE_FLAGS} -f ${MAKE_FILE} depend
@


1.4.2.4
log
@MFC security update to openssl-1.0.1o (libressl is not affected by this problem)

During certificate verification, OpenSSL (starting from version 1.0.1n and
1.0.2b) will attempt to find an alternative certificate chain if the first
attempt to build such a chain fails. An error in the implementation of this
logic can mean that an attacker could cause certain checks on untrusted
certificates to be bypassed, such as the CA flag, enabling them to use a valid
leaf certificate to act as a CA and "issue" an invalid certificate.

This issue will impact any application that verifies certificates including
SSL/TLS/DTLS clients and SSL/TLS/DTLS servers using client authentication.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2015/07/09 14:49:35 sthen Exp $
d5 1
a5 1
V=		1.0.1p
d59 1
a59 1
	    ${MAKE_FLAGS} -f ${MAKE_FILE} depend
@


1.3
log
@update to openssl-1.0.1j, build with no-ssl3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2014/08/21 23:15:57 sthen Exp $
d5 1
a5 1
V=		1.0.1j
d9 1
a9 1
SHLIBVER=	0.1
@


1.2
log
@security update to OpenSSL 1.0.1i
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2014/07/15 22:23:16 sthen Exp $
d5 1
a5 1
V=		1.0.1i
d35 1
a35 1
			no-rc5 no-krb5 no-ssl2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d5 1
a5 1
V=		1.0.1h
d9 1
a9 1
SHLIBVER=	0.0
d24 2
a25 1
MASTER_SITES=	https://www.openssl.org/source/
@


1.1.1.1
log
@Add a port for openssl-1.0.1h, carefully installing files outside of
standard paths searched for by third-party software to ensure that it's
not picked up by autoconf-type programs. This is not intended for general
use, but allows us to continue using specific software relying on APIs
which have been removed from LibReSSL, and for test/comparison purposes.

Various feedback from zhuk@@ and jca@@, earlier version ok zhuk@@ (with only
minor file/path shuffling since then).
@
text
@@


1.1.1.1.2.1
log
@SECURITY update to OpenSSL 1.0.1m

http://openssl.org/news/secadv_20150319.txt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2015/03/19 16:22:04 sthen Exp $
d5 1
a5 1
V=		1.0.1m
d9 1
a9 1
SHLIBVER=	1.0
d24 1
a24 2
MASTER_SITES=	https://www.openssl.org/source/ \
		ftp://ftp.openssl.org/source/
d34 1
a34 1
			no-rc5 no-krb5 no-ssl2 no-ssl3
@

