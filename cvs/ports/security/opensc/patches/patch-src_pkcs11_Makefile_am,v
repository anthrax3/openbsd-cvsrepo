head	1.2;
access;
symbols
	OPENBSD_6_2:1.2.0.2
	OPENBSD_6_2_BASE:1.2
	OPENBSD_6_1:1.1.0.4
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.2
	OPENBSD_6_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2017.08.16.14.39.07;	author dcoppa;	state Exp;
branches;
next	1.1;
commitid	sxlhCSaDJsyqyye2;

1.1
date	2016.06.07.14.08.44;	author dcoppa;	state Exp;
branches;
next	;
commitid	l7AcnKz9UPVHsET0;


desc
@@


1.2
log
@
Update to OpenSC-0.17.0
@
text
@$OpenBSD: patch-src_pkcs11_Makefile_am,v 1.1 2016/06/07 14:08:44 dcoppa Exp $
Index: src/pkcs11/Makefile.am
--- src/pkcs11/Makefile.am.orig
+++ src/pkcs11/Makefile.am
@@@@ -1,7 +1,9 @@@@
 include $(top_srcdir)/win32/ltrc.inc
 
+override libdir = $(prefix)/lib/pkcs11
+
 MAINTAINERCLEANFILES = $(srcdir)/Makefile.in $(srcdir)/versioninfo-pkcs11.rc $(srcdir)/versioninfo-pkcs11-spy.rc
-EXTRA_DIST = Makefile.mak versioninfo-pkcs11.rc.in versioninfo-pkcs11-spy.rc.in opensc-pkcs11.pc.in
+EXTRA_DIST = Makefile.mak versioninfo-pkcs11.rc.in versioninfo-pkcs11-spy.rc.in
 
 lib_LTLIBRARIES = opensc-pkcs11.la pkcs11-spy.la onepin-opensc-pkcs11.la
 
@@@@ -20,16 +22,13 @@@@ OPENSC_PKCS11_LIBS = \
 	$(top_builddir)/src/common/libcompat.la \
 	$(OPTIONAL_OPENSSL_LIBS) $(PTHREAD_LIBS)
 
-pkgconfigdir = $(libdir)/pkgconfig
-pkgconfig_DATA = opensc-pkcs11.pc
-DISTCLEANFILES = $(pkgconfig_DATA)
-
 opensc_pkcs11_la_SOURCES = $(OPENSC_PKCS11_SRC) $(OPENSC_PKCS11_INC)
 opensc_pkcs11_la_CFLAGS = $(OPENSC_PKCS11_CFLAGS)
 opensc_pkcs11_la_LIBADD = $(OPENSC_PKCS11_LIBS)
 opensc_pkcs11_la_LDFLAGS = $(AM_LDFLAGS) \
 	-export-symbols "$(srcdir)/pkcs11.exports" \
 	-module -shared -avoid-version -no-undefined
+opensc_pkcs11_la_LIBTOOLFLAGS = --tag=disable-static
 
 onepin_opensc_pkcs11_la_SOURCES = $(OPENSC_PKCS11_SRC) $(OPENSC_PKCS11_INC)
 onepin_opensc_pkcs11_la_CFLAGS = -DMODULE_APP_NAME=\"onepin-opensc-pkcs11\" $(OPENSC_PKCS11_CFLAGS)
@@@@ -37,6 +36,7 @@@@ onepin_opensc_pkcs11_la_LIBADD = $(OPENSC_PKCS11_LIBS)
 onepin_opensc_pkcs11_la_LDFLAGS = $(AM_LDFLAGS) \
         -export-symbols "$(srcdir)/pkcs11.exports" \
         -module -shared -avoid-version -no-undefined
+onepin_opensc_pkcs11_la_LIBTOOLFLAGS = --tag=disable-static
 
 pkcs11_spy_la_SOURCES = pkcs11-spy.c pkcs11-display.c pkcs11-display.h pkcs11.exports
 pkcs11_spy_la_CFLAGS = $(OPTIONAL_OPENSSL_CFLAGS)
@@@@ -48,6 +48,7 @@@@ pkcs11_spy_la_LIBADD = \
 pkcs11_spy_la_LDFLAGS = $(AM_LDFLAGS) \
 	-export-symbols "$(srcdir)/pkcs11.exports" \
 	-module -shared -avoid-version -no-undefined
+pkcs11_spy_la_LIBTOOLFLAGS = --tag=disable-static
 
 if WIN32
 opensc_pkcs11_la_SOURCES += versioninfo-pkcs11.rc
@@@@ -60,13 +61,4 @@@@ install-exec-hook:
 	for l in opensc-pkcs11.dll pkcs11-spy.dll; do \
 		mv "$(DESTDIR)$(libdir)/$$l" "$(DESTDIR)$(bindir)/$$l"; \
 	done
-else
-# see http://wiki.cacert.org/wiki/Pkcs11TaskForce
-install-exec-hook:
-	$(MKDIR_P) "$(DESTDIR)$(pkcs11dir)"
-	for l in opensc-pkcs11$(DYN_LIB_EXT) onepin-opensc-pkcs11$(DYN_LIB_EXT) pkcs11-spy$(DYN_LIB_EXT); do \
-		rm -f "$(DESTDIR)$(pkcs11dir)/$$l"; \
-		$(LN_S) ../$$l "$(DESTDIR)$(pkcs11dir)/$$l"; \
-	done
-
 endif
@


1.1
log
@
Update to OpenSC-0.16.0
@
text
@d1 5
a5 4
$OpenBSD$
--- src/pkcs11/Makefile.am.orig	Fri Jun  3 11:19:51 2016
+++ src/pkcs11/Makefile.am	Tue Jun  7 14:53:12 2016
@@@@ -1,5 +1,7 @@@@
d11 2
a12 1
 EXTRA_DIST = Makefile.mak versioninfo-pkcs11.rc.in versioninfo-pkcs11-spy.rc.in
d14 13
a26 1
@@@@ -24,6 +26,7 @@@@ opensc_pkcs11_la_LIBADD = $(OPENSC_PKCS11_LIBS)
d33 2
a34 2
 onepin_opensc_pkcs11_la_CFLAGS = -DMODULE_APP_NAME=\"onepin-opensc-pkcs11\" $(AM_CFLAGS)
@@@@ -31,6 +34,7 @@@@ onepin_opensc_pkcs11_la_LIBADD = $(OPENSC_PKCS11_LIBS)
d41 2
a42 2
 pkcs11_spy_la_LIBADD = \
@@@@ -41,6 +45,7 @@@@ pkcs11_spy_la_LIBADD = \
d50 1
a50 1
@@@@ -53,13 +58,4 @@@@ install-exec-hook:
@

