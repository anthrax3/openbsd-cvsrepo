head	1.5;
access;
symbols
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.4
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.1.0.6
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2016.06.07.14.08.44;	author dcoppa;	state dead;
branches;
next	1.4;
commitid	l7AcnKz9UPVHsET0;

1.4
date	2015.06.15.09.36.42;	author dcoppa;	state Exp;
branches;
next	1.3;
commitid	Btb2eEYTGka5Ro15;

1.3
date	2015.04.24.12.53.24;	author dcoppa;	state Exp;
branches;
next	1.2;
commitid	cD3MUggrfcEyTRe3;

1.2
date	2014.08.13.06.18.47;	author dcoppa;	state Exp;
branches;
next	1.1;
commitid	wLtXJ1GO1ThIVpGo;

1.1
date	2013.06.07.13.27.58;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.5
log
@
Update to OpenSC-0.16.0
@
text
@$OpenBSD: patch-src_pkcs11_Makefile_in,v 1.4 2015/06/15 09:36:42 dcoppa Exp $

Do not install shared modules under ${PREFIX}/lib/ and avoid the
nasty symlink dance

Use --tag=disable-static to disable libtool static archives for
modules

--- src/pkcs11/Makefile.in.orig	Sat May 16 22:30:43 2015
+++ src/pkcs11/Makefile.in	Mon Jun 15 11:18:27 2015
@@@@ -77,7 +77,7 @@@@ am__nobase_list = $(am__nobase_strip_setup); \
 am__base_list = \
   sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
-am__installdirs = "$(DESTDIR)$(libdir)"
+am__installdirs = "$(DESTDIR)$(pkcs11dir)"
 LTLIBRARIES = $(lib_LTLIBRARIES)
 am__DEPENDENCIES_1 =
 am__DEPENDENCIES_2 = $(top_builddir)/src/libopensc/libopensc.la \
@@@@ -217,6 +217,7 @@@@ LIBOBJS = @@LIBOBJS@@
 LIBRARY_BITNESS = @@LIBRARY_BITNESS@@
 LIBS = @@LIBS@@
 LIBTOOL = @@LIBTOOL@@
+LIBTOOLFLAGS = --tag=disable-static
 LIPO = @@LIPO@@
 LN_S = @@LN_S@@
 LTLIBOBJS = @@LTLIBOBJS@@
@@@@ -429,25 +430,25 @@@@ versioninfo-pkcs11-spy.rc: $(top_builddir)/config.stat
 	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@@
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
-	@@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
+	test -z "$(pkcs11dir)" || $(MKDIR_P) "$(DESTDIR)$(pkcs11dir)"
+	@@list='$(lib_LTLIBRARIES)'; test -n "$(pkcs11dir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
 	    list2="$$list2 $$p"; \
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
-	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
-	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
+	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(pkcs11dir)'"; \
+	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(pkcs11dir)"; \
 	}
 
 uninstall-libLTLIBRARIES:
 	@@$(NORMAL_UNINSTALL)
-	@@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
+	@@list='$(lib_LTLIBRARIES)'; test -n "$(pkcs11dir)" || list=; \
 	for p in $$list; do \
 	  $(am__strip_dir) \
-	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=uninstall rm -f '$(DESTDIR)$(libdir)/$$f'"; \
-	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=uninstall rm -f "$(DESTDIR)$(libdir)/$$f"; \
+	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=uninstall rm -f '$(DESTDIR)$(pkcs11dir)/$$f'"; \
+	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=uninstall rm -f "$(DESTDIR)$(pkcs11dir)/$$f"; \
 	done
 
 clean-libLTLIBRARIES:
@@@@ -461,9 +462,9 @@@@ clean-libLTLIBRARIES:
 onepin-opensc-pkcs11.la: $(onepin_opensc_pkcs11_la_OBJECTS) $(onepin_opensc_pkcs11_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(onepin_opensc_pkcs11_la_LINK) -rpath $(libdir) $(onepin_opensc_pkcs11_la_OBJECTS) $(onepin_opensc_pkcs11_la_LIBADD) $(LIBS)
 opensc-pkcs11.la: $(opensc_pkcs11_la_OBJECTS) $(opensc_pkcs11_la_DEPENDENCIES) 
-	$(AM_V_CCLD)$(opensc_pkcs11_la_LINK) -rpath $(libdir) $(opensc_pkcs11_la_OBJECTS) $(opensc_pkcs11_la_LIBADD) $(LIBS)
+	$(AM_V_CCLD)$(opensc_pkcs11_la_LINK) -rpath $(pkcs11dir) $(opensc_pkcs11_la_OBJECTS) $(opensc_pkcs11_la_LIBADD) $(LIBS)
 pkcs11-spy.la: $(pkcs11_spy_la_OBJECTS) $(pkcs11_spy_la_DEPENDENCIES) 
-	$(AM_V_CCLD)$(pkcs11_spy_la_LINK) -rpath $(libdir) $(pkcs11_spy_la_OBJECTS) $(pkcs11_spy_la_LIBADD) $(LIBS)
+	$(AM_V_CCLD)$(pkcs11_spy_la_LINK) -rpath $(pkcs11dir) $(pkcs11_spy_la_OBJECTS) $(pkcs11_spy_la_LIBADD) $(LIBS)
 
 mostlyclean-compile:
 	-rm -f *.$(OBJEXT)
@@@@ -699,7 +700,7 @@@@ check-am: all-am
 check: check-am
 all-am: Makefile $(LTLIBRARIES) $(SCRIPTS)
 installdirs:
-	for dir in "$(DESTDIR)$(libdir)"; do \
+	for dir in "$(DESTDIR)$(pkcs11dir)"; do \
 	  test -z "$$dir" || $(MKDIR_P) "$$dir"; \
 	done
 install: install-am
@@@@ -759,7 +760,6 @@@@ install-dvi-am:
 
 install-exec-am: install-libLTLIBRARIES
 	@@$(NORMAL_INSTALL)
-	$(MAKE) $(AM_MAKEFLAGS) install-exec-hook
 install-html: install-html-am
 
 install-html-am:
@@@@ -807,7 +807,7 @@@@ uninstall-am: uninstall-libLTLIBRARIES
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-exec-hook \
+	install-dvi-am install-exec install-exec-am \
 	install-html install-html-am install-info install-info-am \
 	install-libLTLIBRARIES install-man install-pdf install-pdf-am \
 	install-ps install-ps-am install-strip installcheck \
@@@@ -831,18 +831,6 @@@@ pkcs11-jar: jar-dir
 	cp opensc_pkcs11_install.js jar-dir
 	signtool -Z"opensc-pkcs11.jar" -i"opensc_pkcs11_install.js" \
 		 -k"testcert" jar-dir
-
-@@WIN32_TRUE@@install-exec-hook:
-@@WIN32_TRUE@@	$(MKDIR_P) "$(DESTDIR)$(libdir)"
-@@WIN32_TRUE@@	for l in opensc-pkcs11.dll pkcs11-spy.dll; do \
-@@WIN32_TRUE@@		mv "$(DESTDIR)$(libdir)/$$l" "$(DESTDIR)$(bindir)/$$l"; \
-@@WIN32_TRUE@@	done
-@@WIN32_FALSE@@install-exec-hook:
-@@WIN32_FALSE@@	$(MKDIR_P) "$(DESTDIR)$(pkcs11dir)"
-@@WIN32_FALSE@@	for l in opensc-pkcs11$(PKCS11_SUFFIX) onepin-opensc-pkcs11$(PKCS11_SUFFIX) pkcs11-spy$(PKCS11_SUFFIX); do \
-@@WIN32_FALSE@@		rm -f "$(DESTDIR)$(pkcs11dir)/$$l"; \
-@@WIN32_FALSE@@		$(LN_S) ../$$l "$(DESTDIR)$(pkcs11dir)/$$l"; \
-@@WIN32_FALSE@@	done
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
@


1.4
log
@
Upstream rerolled their tarball; bump.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_pkcs11_Makefile_in,v 1.3 2015/04/24 12:53:24 dcoppa Exp $
@


1.3
log
@
Update to opensc-0.15.0
@
text
@d1 1
a1 1
$OpenBSD: patch-src_pkcs11_Makefile_in,v 1.2 2014/08/13 06:18:47 dcoppa Exp $
d9 2
a10 2
--- src/pkcs11/Makefile.in.orig	Wed Apr  8 18:11:24 2015
+++ src/pkcs11/Makefile.in	Fri Apr 24 13:21:34 2015
d20 1
a20 1
@@@@ -213,6 +213,7 @@@@ LIBOBJS = @@LIBOBJS@@
d28 1
a28 1
@@@@ -424,25 +425,25 @@@@ versioninfo-pkcs11-spy.rc: $(top_builddir)/config.stat
d61 1
a61 1
@@@@ -456,9 +457,9 @@@@ clean-libLTLIBRARIES:
d73 1
a73 1
@@@@ -694,7 +695,7 @@@@ check-am: all-am
d82 1
a82 1
@@@@ -754,7 +755,6 @@@@ install-dvi-am:
d90 1
a90 1
@@@@ -802,7 +802,7 @@@@ uninstall-am: uninstall-libLTLIBRARIES
d99 1
a99 1
@@@@ -826,18 +826,6 @@@@ pkcs11-jar: jar-dir
@


1.2
log
@
Update to opensc-0.14.0
@
text
@d1 1
a1 1
$OpenBSD: patch-src_pkcs11_Makefile_in,v 1.1 2013/06/07 13:27:58 dcoppa Exp $
d9 2
a10 2
--- src/pkcs11/Makefile.in.orig	Mon Jun 30 20:38:01 2014
+++ src/pkcs11/Makefile.in	Wed Aug 13 07:42:08 2014
d20 1
a20 1
@@@@ -212,6 +212,7 @@@@ LIBOBJS = @@LIBOBJS@@
d28 1
a28 1
@@@@ -423,25 +424,25 @@@@ versioninfo-pkcs11-spy.rc: $(top_builddir)/config.stat
d61 1
a61 1
@@@@ -455,9 +456,9 @@@@ clean-libLTLIBRARIES:
d73 1
a73 1
@@@@ -693,7 +694,7 @@@@ check-am: all-am
d82 1
a82 1
@@@@ -753,7 +754,6 @@@@ install-dvi-am:
d90 1
a90 1
@@@@ -801,7 +801,7 @@@@ uninstall-am: uninstall-libLTLIBRARIES
d99 1
a99 1
@@@@ -825,18 +825,6 @@@@ pkcs11-jar: jar-dir
@


1.1
log
@Update to opensc-0.13.0.
Take maintainership.

OK sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
d9 3
a11 3
--- src/pkcs11/Makefile.in.orig	Tue Dec  4 15:43:58 2012
+++ src/pkcs11/Makefile.in	Thu Jun  6 10:28:53 2013
@@@@ -74,7 +74,7 @@@@ am__nobase_list = $(am__nobase_strip_setup); \
d20 1
a20 1
@@@@ -190,6 +190,7 @@@@ LIBOBJS = @@LIBOBJS@@
d28 2
a29 2
@@@@ -385,25 +386,25 @@@@ $(ACLOCAL_M4):  $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
d61 3
a63 3
@@@@ -424,9 +425,9 @@@@ $(top_builddir)/win32/versioninfo.lo:  \
 	$(top_builddir)/win32/$(am__dirstamp) \
 	$(top_builddir)/win32/$(DEPDIR)/$(am__dirstamp)
d73 1
a73 1
@@@@ -566,7 +567,7 @@@@ check-am: all-am
d82 1
a82 1
@@@@ -628,7 +629,6 @@@@ install-dvi-am:
d90 1
a90 1
@@@@ -676,7 +676,7 @@@@ uninstall-am: uninstall-libLTLIBRARIES
d99 1
a99 1
@@@@ -700,18 +700,6 @@@@ pkcs11-jar: jar-dir
d111 1
a111 1
-@@WIN32_FALSE@@	for l in opensc-pkcs11$(PKCS11_SUFFIX) pkcs11-spy$(PKCS11_SUFFIX); do \
@

