head	1.23;
access;
symbols
	OPENBSD_6_0:1.23.0.6
	OPENBSD_6_0_BASE:1.23
	OPENBSD_5_9:1.23.0.2
	OPENBSD_5_9_BASE:1.23
	OPENBSD_5_8:1.23.0.4
	OPENBSD_5_8_BASE:1.23
	OPENBSD_5_7:1.22.0.2
	OPENBSD_5_7_BASE:1.22
	OPENBSD_5_6:1.19.0.2
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.18.0.2
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.16.0.2
	OPENBSD_5_4_BASE:1.16
	OPENBSD_5_3:1.11.0.2
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.10.0.2
	OPENBSD_5_2_BASE:1.10
	robert_20120511:1.1.1.1
	robert:1.1.1;
locks; strict;
comment	@# @;


1.23
date	2015.05.17.16.04.10;	author robert;	state Exp;
branches;
next	1.22;
commitid	0X7kBHcWUrz7LVZd;

1.22
date	2014.09.14.05.58.07;	author ajacoutot;	state Exp;
branches;
next	1.21;
commitid	Wm0mDRCXhQhfZWj1;

1.21
date	2014.09.13.18.09.22;	author brad;	state Exp;
branches;
next	1.20;
commitid	PpbRjVZdAmlrmi8q;

1.20
date	2014.08.10.10.11.47;	author espie;	state Exp;
branches;
next	1.19;
commitid	P5JeeGPxtOlVWV5b;

1.19
date	2014.04.29.07.32.20;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2014.01.25.13.18.04;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2014.01.19.09.57.55;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2013.06.12.20.36.34;	author brad;	state Exp;
branches;
next	1.15;

1.15
date	2013.06.06.13.57.48;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2013.06.05.14.38.08;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2013.05.25.00.33.10;	author brad;	state Exp;
branches;
next	1.12;

1.12
date	2013.03.11.11.41.28;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2012.09.07.13.39.43;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2012.06.25.18.54.07;	author robert;	state Exp;
branches;
next	1.9;

1.9
date	2012.05.18.13.05.15;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2012.05.18.11.30.09;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2012.05.18.10.28.05;	author robert;	state Exp;
branches;
next	1.6;

1.6
date	2012.05.16.13.47.18;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2012.05.16.09.36.53;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2012.05.15.09.47.03;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2012.05.15.07.20.37;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2012.05.11.09.38.28;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2012.05.11.09.24.23;	author robert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.05.11.09.24.23;	author robert;	state Exp;
branches;
next	;


desc
@@


1.23
log
@update to 3.1.5
@
text
@# $OpenBSD: Makefile,v 1.22 2014/09/14 05:58:07 ajacoutot Exp $

COMMENT-main=		Samhain Intrusion Detection System - documentation
COMMENT-client=		Samhain Intrusion Detection System - client
COMMENT-server=		Samhain Intrusion Detection System - server

VERSION=		3.1.5
DISTNAME=		samhain-${VERSION}
FULLPKGNAME-main=	samhain-docs-${VERSION}
FULLPKGPATH-main=	security/samhain,-main
FULLPKGNAME-client=	samhain-${VERSION}
FULLPKGPATH-client=	security/samhain,-client
PKGNAME-server=		samhain-server-${VERSION}

CATEGORIES=		security

HOMEPAGE=		http://la-samhna.de/samhain/
MASTER_SITES=		http://nerd.hu/distfiles/

MAINTAINER=		Robert Nagy <robert@@openbsd.org>

# GPLv2
PERMIT_PACKAGE_CDROM=	Yes

CONFIGURE_STYLE=	gnu
CONFIGURE_ARGS=		--enable-login-watch \
			--with-state-dir=/var/samhain \
			--enable-suidcheck \
			--enable-identity=_yule \
			--enable-network=server

NO_TEST=		Yes

MULTI_PACKAGES=		-main
FLAVORS=		mysql postgresql
FLAVOR?=

SUBST_VARS=		FLAVOR

.if ${FLAVOR} == "mysql"
MULTI_PACKAGES+=	-server
RUN_DEPENDS-server+=	security/samhain,-main
LIB_DEPENDS-server+=	databases/mariadb,-main
WANTLIB-server+=	c crypto m mysqlclient pthread ssl z
CONFIGURE_ARGS+=	--with-database=mysql \
			--enable-xml-log \
			--with-cflags=-I${LOCALBASE}/include/mysql \
			--with-libs=-L${LOCALBASE}/lib/mysql
.elif ${FLAVOR} == "postgresql"
MULTI_PACKAGES+=	-server
RUN_DEPENDS-server+=	security/samhain,-main
LIB_DEPENDS-server+=	databases/postgresql,-main
WANTLIB-server+=	c m pq
CONFIGURE_ARGS+=	--with-database=postgresql \
			--enable-xml-log
.elif empty(FLAVOR)
MULTI_PACKAGES+=	-client
RUN_DEPENDS-client+=	security/samhain,-main
WANTLIB-client+=	c pthread z
CONFIGURE_ARGS+=	--enable-network=client
.else
ERRORS+=		"Fatal: conflicting or unknown flavors: ${FLAVOR}";
.endif

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/samhain
	${INSTALL_DATA} ${WRKSRC}/README ${PREFIX}/share/doc/samhain/README
.if empty(FLAVOR)
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/samhain
	${INSTALL_DATA} ${WRKSRC}/samhainrc ${PREFIX}/share/examples/samhain/
	${INSTALL_PROGRAM} -c -m 700 \
		${WRKSRC}/samhain_setpwd ${PREFIX}/sbin
.else
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/yule
	${INSTALL_DATA} ${WRKSRC}/yulerc.template \
		${PREFIX}/share/examples/yule/yulerc
	${INSTALL_DATA} ${WRKSRC}/sql_init/samhain.${FLAVOR:S/postgresql/postgres/}.init \
		${PREFIX}/share/examples/yule/samhain.${FLAVOR}.init
.endif

.include <bsd.port.mk>
@


1.22
log
@MySQL -> MariaDB in READMEs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2014/09/13 18:09:22 brad Exp $
d7 1
a7 1
VERSION=		3.0.4
a14 4
REVISION-main=		3
REVISION-client=	9
REVISION-server=	13

d18 1
a18 1
MASTER_SITES=		http://blade2k.humppa.hu/
d44 1
a44 1
WANTLIB-server+=	c crypto m mysqlclient ssl z
@


1.21
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2014/08/10 10:11:47 espie Exp $
d17 1
a17 1
REVISION-server=	12
@


1.20
log
@more appropriate uses of INSTALL_PROGRAM.
Unhardcode chown.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2014/04/29 07:32:20 ajacoutot Exp $
d17 1
a17 1
REVISION-server=	11
d47 1
a47 1
LIB_DEPENDS-server+=	databases/mysql,-main
@


1.19
log
@We have AI_ADDRCONFIG now.

ok robert@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2014/01/25 13:18:04 espie Exp $
d75 1
a75 1
	${INSTALL} -c -s -o root -g bin -m 700 \
@


1.18
log
@iick, passwd directly in binary file
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2014/01/19 09:57:55 ajacoutot Exp $
d16 2
a17 2
REVISION-client=	8
REVISION-server=	10
a29 1
CONFIGURE_ENV=		CPPFLAGS="-DAI_ADDRCONFIG=0"
@


1.17
log
@Set @@mode explicitely.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2013/06/12 20:36:34 brad Exp $
d16 1
a16 1
REVISION-client=	7
@


1.16
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2013/06/06 13:57:48 ajacoutot Exp $
d17 1
a17 1
REVISION-server=	9
@


1.15
log
@Revert the mysql->MariaDB blurb in the READMEs.
It seems the MariaDB move will be reverted.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2013/06/05 14:38:08 ajacoutot Exp $
d17 1
a17 1
REVISION-server=	8
d48 1
a48 1
LIB_DEPENDS-server+=	databases/mariadb,-main
@


1.14
log
@mysql -> MariaDB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2013/05/25 00:33:10 brad Exp $
d17 1
a17 1
REVISION-server=	7
@


1.13
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2013/03/11 11:41:28 espie Exp $
d17 1
a17 1
REVISION-server=	6
@


1.12
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2012/09/07 13:39:43 ajacoutot Exp $
d17 1
a17 1
REVISION-server=	5
d48 1
a48 1
LIB_DEPENDS-server+=	databases/mysql,-main
@


1.11
log
@Properly enable xml logs.
Use @@extraunexec instead of @@extra.
Always start the server in check mode.

from robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2012/06/25 18:54:07 robert Exp $
a27 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d37 1
a37 1
NO_REGRESS=		Yes
@


1.10
log
@--enable-xml-log is needed for both the client and the server so enable
it by default
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2012/05/18 13:05:15 ajacoutot Exp $
d15 3
a17 3
REVISION-main=		2
REVISION-client=	6
REVISION-server=	4
a37 1
			--enable-xml-log \
d54 1
d62 2
a63 1
CONFIGURE_ARGS+=	--with-database=postgresql
@


1.9
log
@No need for @@extraunexec here, @@extra is enough.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2012/05/18 11:30:09 ajacoutot Exp $
d16 1
a16 1
REVISION-client=	5
d38 1
a54 1
			--enable-xml-log \
d62 1
a62 2
CONFIGURE_ARGS+=	--with-database=postgresql \
			--enable-xml-log
@


1.8
log
@typo: Zabbix -> Samhain
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2012/05/18 10:28:05 robert Exp $
d16 1
a16 1
REVISION-client=	4
@


1.7
log
@Add support for te samhain in-binary password so that remote logging
works and add a readme on how to set this up properly.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2012/05/16 13:47:18 ajacoutot Exp $
d17 1
a17 1
REVISION-server=	3
@


1.6
log
@Unbreak on a clean box: fix the way FLAVOR are handled.
spotted by sthen@@

ok sthen@@ robert@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2012/05/16 09:36:53 ajacoutot Exp $
d16 2
a17 2
REVISION-client=	3
REVISION-server=	2
d79 2
@


1.5
log
@Fix dependency loop; spotted by robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2012/05/15 09:47:03 ajacoutot Exp $
d15 3
a17 3
REVISION-main=		1
REVISION-client=	2
REVISION-server=	1
a42 1
PSEUDO_FLAVORS=		no_server
d44 1
a44 1
FLAVOR?=		no_server
d48 1
a48 5
# if non-backend-related flavors are added, add them to
# the following line as ":L:Nflavor1:Nflavor2" so that
# they don't trigger a "Conflicting flavors" error.
BACKEND=		${FLAVOR}
.if ${BACKEND} == "mysql"
d57 1
a57 1
.elif ${BACKEND} == "postgresql"
d64 1
a64 1
.elif ${BACKEND} == "no_server"
d76 1
a76 1
.if ${FLAVOR:L:Mno_server}
@


1.4
log
@Make -server and -client RUN_DEPENDS on -main.
Make DESCR consisten.

ok robert@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2012/05/15 07:20:37 ajacoutot Exp $
d15 3
a17 3
REVISION-main=		0
REVISION-client=	1
REVISION-server=	0
d55 1
a55 1
RUN_DEPENDS+=		${BASE_PKGPATH},-main
d64 1
a64 1
RUN_DEPENDS+=		${BASE_PKGPATH},-main
d71 1
a71 1
RUN_DEPENDS+=		${BASE_PKGPATH},-main
@


1.3
log
@Tweak error message; FLAVORs can be either conflicting or unknown.
No pkg change.

ok robert@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2012/05/11 09:38:28 ajacoutot Exp $
d3 1
a3 1
COMMENT-main=		Samhain Intrusion Detection System
d15 3
a17 1
REVISION-client=	0
d55 1
d64 1
d71 1
@


1.2
log
@No need to specify localstatedir, gnu CONFIGURE_STYLE takes care of it.
Remove content of /var/samhain/* with pkg_delete -c.

ok robert@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2012/05/11 09:24:23 robert Exp $
d70 1
a70 1
ERRORS+=		"Fatal: Conflicting flavors: ${FLAVOR}";
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d15 2
a32 1
			--localstatedir=/var \
d47 3
a49 3
#if non-backend-related flavors are added, add them to
#the following line as ":L:Nflavor1:Nflavor2" so that
#they don't trigger a "Conflicting flavors" error.
@


1.1.1.1
log
@import of samhain:
Samhain is an open source file integrity and host-based intrusion
detection system for Linux and Unix. It can run as a daemon process,
and and thus can remember file changes - contrary to a tool that runs
from cron, if a file is modified you will get only one report, while
subsequent checks of that file will ignore the modification as it is
already reported (unless the file is modified again).

ok jasper@@
@
text
@@
