head	1.2;
access;
symbols
	OPENBSD_6_0:1.2.0.4
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2;
locks; strict;
comment	@# @;


1.2
date	2016.01.31.13.35.28;	author jasper;	state Exp;
branches;
next	1.1;
commitid	k99LE1HtWpllP5Ve;

1.1
date	2016.01.18.13.29.04;	author jasper;	state Exp;
branches;
next	;
commitid	9mR24CBVBieQ1eLk;


desc
@@


1.2
log
@autoconf bits for pledge
@
text
@$OpenBSD: patch-pwgen_c,v 1.1 2016/01/18 13:29:04 jasper Exp $
--- pwgen.c.orig	Tue Oct 28 02:00:39 2014
+++ pwgen.c	Mon Jan 18 14:38:37 2016
@@@@ -7,6 +7,8 @@@@
  * License.
  */
 
+#include "config.h"
+
 #include <stdio.h>
 #include <unistd.h>
 #include <stdlib.h>
@@@@ -94,6 +96,12 @@@@ int main(int argc, char **argv)
 	char	*buf, *tmp;
 	void	(*pwgen)(char *inbuf, int size, int pw_flags);
 
+#ifdef HAVE_PLEDGE
+	if (pledge("stdio rpath", NULL) == -1) {
+		fprintf(stderr, "pledge\n");
+		exit(1);
+	}
+#endif
 	pwgen = pw_phonemes;
 	pw_number = pw_random_number;
 	if (isatty(1))
@@@@ -162,6 +170,13 @@@@ int main(int argc, char **argv)
 			break;
 		}
 	}
+#ifdef HAVE_PLEDGE
+	/* Done with SHA1 seed file, drop rpath */
+	if (pledge("stdio", NULL) == -1) {
+		fprintf(stderr, "pledge");
+		exit (1);
+	}
+#endif
 	if (optind < argc) {
 		pw_length = strtol(argv[optind], &tmp, 0);
 		if (pw_length < 5)
@


1.1
log
@pledge pwgen

ok robert@@ (MAINTAINER, sthen@@
@
text
@d1 13
a13 4
$OpenBSD$
--- pwgen.c.orig	Mon Jan 18 08:32:18 2016
+++ pwgen.c	Mon Jan 18 08:33:06 2016
@@@@ -94,6 +94,10 @@@@ int main(int argc, char **argv)
d17 1
d22 1
d26 1
a26 2
@@@@ -161,6 +165,11 @@@@ int main(int argc, char **argv)
 			usage();
d29 2
a30 1
+	}
d35 2
a36 1
 	}
d39 1
@

