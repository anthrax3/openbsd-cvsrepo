head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.50
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.48
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.44
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.46
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.42
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.40
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.38
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.36
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.34
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.32
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.30
	OPENBSD_5_0:1.3.0.28
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.26
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.24
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.22
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.20
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.18
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.16
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.14
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.12
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.10
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.8
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.6
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.4
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.2.0.12
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.10
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.8
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.6
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.4
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.2.0.2
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.1.1.1.0.4
	OPENBSD_3_0_BASE:1.1.1.1
	OPENBSD_2_9_TRACKING_SWITCH:1.1.1.1
	OPENBSD_2_9:1.1.1.1.0.2
	OPENBSD_2_9_BASE:1.1.1.1
	danh_2001-Jan-05:1.1.1.1
	danh:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2005.03.15.01.37.06;	author mjc;	state Exp;
branches;
next	1.2;

1.2
date	2002.02.24.00.15.30;	author pvalchev;	state Exp;
branches;
next	1.1;

1.1
date	2001.01.05.23.25.07;	author danh;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.01.05.23.25.07;	author danh;	state Exp;
branches;
next	;


desc
@@


1.3
log
@make program use LIBNET_ERRBUF_SIZE instead of having
libnet write errors to un-malloc()ed char *

bump PKGNAME

ok naddy@@
@
text
@$OpenBSD: patch-despoof_c,v 1.2 2002/02/24 00:15:30 pvalchev Exp $
--- despoof.c.orig	Tue Jul 25 07:51:24 2000
+++ despoof.c	Mon Mar 14 10:51:17 2005
@@@@ -34,7 +34,7 @@@@ struct bpf_program pcapfilter;
 struct in_addr net, mask;
 pcap_t *pd;
 char pcap_err[PCAP_ERRBUF_SIZE];
-u_char *ebuf;
+u_char ebuf[LIBNET_ERRBUF_SIZE];
 char *dev;
 struct libnet_link_int *l;
 int num_of_questions, link_offset, verbose, target_answers, unexpected, inquery;
@@@@ -150,7 +150,7 @@@@ void grab_packet(u_char *data1, struct p
 
   if (targetaddr == ip->ip_src.s_addr) 
   {
-    if (((inquery == 1) && (icmp->icmp_type == ICMP_ECHOREPLY)) || ((inquery == 2) && (icmp->icmp_type == ICMP_TIMESTAMPREPLY)) || ((inquery == 3) && (sport == ntohs(tcphdr->th_dport))))
+    if (((inquery == 1) && (icmp->icmp_type == ICMP_ECHOREPLY)) || ((inquery == 2) && (icmp->icmp_type == ICMP_TSTAMPREPLY)) || ((inquery == 3) && (sport == ntohs(tcphdr->th_dport))))
     {
       if (ttlval == ip->ip_ttl)
       {
@@@@ -285,7 +285,7 @@@@ void usage(char *prog)
   fprintf(stderr,"    -a set ACK flag on TCP packets\n");
   fprintf(stderr,"    -h this help screen\n");
   fprintf(stderr,"    -v verbose\n");
-  fprintf(stderr,"  -d device to grab local IP or sniff from, default is eth0\n");
+  fprintf(stderr,"  -d device to grab local IP or sniff from\n");
   fprintf(stderr,"  -l local port to bind to, default is 80\n");
   fprintf(stderr,"  -p target port to send to, default is 80\n");
   fprintf(stderr,"  -i inquery packet type to send/receive, types include the following:\n");
@@@@ -306,12 +306,12 @@@@ int main(int argc, char **argv)
   extern int optind;
   extern int optopt;
   extern int opterr;
-  char ch;
+  int ch;
   int spoof = 0, setdev = 0, timeout = 10, ttl = 0;
   u_long dst_ip = 0;
   pid_t pid;
   
-  dev = "eth0"; /* default */
+  dev = NULL;
   verbose = 0;
   prog = argv[0];
   sport = 80;
@@@@ -408,6 +408,16 @@@@ int main(int argc, char **argv)
     fprintf(stderr, "=== and spoof your source IP address at the same time.\n");
     usage(prog);
     exit(-1);
+  }
+
+  if (dev == NULL) 
+  {
+    dev = pcap_lookupdev(pcap_err);
+    if (dev == NULL) 
+    {
+      fprintf(stderr, "=== No devices found.\n");
+      exit(-1);
+    }
   }
 
   if(!spoof)
@


1.2
log
@more char c = getopt(...) fixed
@
text
@d1 12
a12 3
$OpenBSD: patch-despoof_c,v 1.1.1.1 2001/01/05 23:25:07 danh Exp $
--- despoof.c.orig	Tue Jul 25 08:51:24 2000
+++ despoof.c	Sat Feb 23 17:10:52 2002
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
$OpenBSD: update-patches,v 1.3 2000/06/09 17:08:37 espie Exp $
--- despoof.c.orig	Tue Jul 25 10:51:24 2000
+++ despoof.c	Fri Jan  5 18:15:03 2001
d22 7
a28 1
@@@@ -311,7 +311,7 @@@@ int main(int argc, char **argv)
@


1.1.1.1
log
@command-line anti-spoofing detection utility

Submitted by:	Brian Caswell <bmc@@mitre.org>
@
text
@@
