head	1.2;
access;
symbols
	OPENBSD_4_4:1.1.0.2
	OPENBSD_4_4_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2008.09.14.15.00.43;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2008.04.16.19.46.01;	author mbalmer;	state Exp;
branches;
next	;


desc
@@


1.2
log
@SECURITY and other bug fixes.

- A vulnerability in ClamAV's chm-parser allowed remote attackers to
cause a denial of service (application crash) via a malformed CHM file
(CVE-2008-1389).

- A vulnerability in libclamav would allow attackers to cause a
denial of service via vectors related to an out-of-memory condition
(CVE-2008-3912).

- Multiple memory leaks were found in ClamAV that could possibly allow
attackers to cause a denial of service via excessive memory consumption
(CVE-2008-3913).

- A number of unspecified vulnerabilities in ClamAV were reported that
have an unknown impact and attack vectors related to file descriptor
leaks (CVE-2008-3914).

various OpenBSD patches rolled in upstream. thanks to sturm@@
for looking over systrace.filter (needed for the test of sendmsg()
in configure to enable FD passing).
@
text
@$OpenBSD: patch-clamd_clamd_c,v 1.1 2008/04/16 19:46:01 mbalmer Exp $
--- clamd/clamd.c.orig	Thu Mar  6 19:41:03 2008
+++ clamd/clamd.c	Mon Apr 14 21:54:34 2008
@@@@ -374,12 +374,18 @@@@ int main(int argc, char **argv)
 
     /* fork into background */
     if(!cfgopt(copt, "Foreground")->enabled) {
+	for (ret = 0; ret < nlsockets; ret++)
+		fcntl(lsockets[ret], F_SETFL, fcntl(lsockets[ret], F_GETFL)
+		    | O_NONBLOCK);
 	if(daemonize() == -1) {
 	    logg("!daemonize() failed\n");
 	    logg_close();
 	    freecfg(copt);
 	    return 1;
 	}
+	for (ret = 0; ret < nlsockets; ret++)
+		fcntl(lsockets[ret], F_SETFL, fcntl(lsockets[ret], F_GETFL)
+		    & ~O_NONBLOCK);
 	if(!debug_mode)
 	    if(chdir("/") == -1)
 		logg("^Can't change current working directory to root\n");
@


1.1
log
@Update ClamAV to version 0.93, which fixes mostly security problems, at
least one highly critical (remote). See http://secunia.com/advisories/29000
for details.

Thanks to kurt@@ for helping analyzing the threaded code issues.
@
text
@d1 1
a1 1
$OpenBSD$
@

