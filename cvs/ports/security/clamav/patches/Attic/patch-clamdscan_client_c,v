head	1.10;
access;
symbols
	OPENBSD_4_4:1.9.0.2
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.8.0.2
	OPENBSD_4_3_BASE:1.8
	OPENBSD_4_2:1.6.0.2
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.5.0.2
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.4.0.2
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.3.0.4
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.2
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2
	clamav_20050109:1.1.1.1
	mbalmer:1.1.1;
locks; strict;
comment	@# @;


1.10
date	2008.09.14.15.00.43;	author sthen;	state dead;
branches;
next	1.9;

1.9
date	2008.04.16.19.46.01;	author mbalmer;	state Exp;
branches;
next	1.8;

1.8
date	2007.12.30.22.42.38;	author bernd;	state Exp;
branches;
next	1.7;

1.7
date	2007.08.25.10.08.28;	author mbalmer;	state Exp;
branches;
next	1.6;

1.6
date	2007.03.25.11.24.02;	author mbalmer;	state Exp;
branches;
next	1.5;

1.5
date	2007.02.28.20.31.08;	author mbalmer;	state Exp;
branches
	1.5.2.1;
next	1.4;

1.4
date	2006.08.15.18.48.22;	author mbalmer;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	2005.05.12.14.55.21;	author mbalmer;	state Exp;
branches
	1.3.2.1
	1.3.4.1;
next	1.2;

1.2
date	2005.01.27.19.47.47;	author mbalmer;	state Exp;
branches;
next	1.1;

1.1
date	2005.01.09.17.07.52;	author mbalmer;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.01.09.17.07.52;	author mbalmer;	state Exp;
branches;
next	;

1.3.2.1
date	2006.08.20.10.11.17;	author sturm;	state Exp;
branches;
next	;

1.3.4.1
date	2006.08.20.10.11.40;	author sturm;	state Exp;
branches;
next	1.3.4.2;

1.3.4.2
date	2007.03.16.21.31.20;	author sturm;	state Exp;
branches;
next	1.3.4.3;

1.3.4.3
date	2007.03.28.19.53.19;	author sturm;	state Exp;
branches;
next	;

1.4.2.1
date	2007.03.16.22.12.34;	author sturm;	state Exp;
branches;
next	1.4.2.2;

1.4.2.2
date	2007.04.02.14.02.01;	author sturm;	state Exp;
branches;
next	1.4.2.3;

1.4.2.3
date	2007.09.12.14.51.58;	author sturm;	state Exp;
branches;
next	;

1.5.2.1
date	2007.05.01.16.24.35;	author sturm;	state Exp;
branches;
next	1.5.2.2;

1.5.2.2
date	2007.09.12.14.48.06;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.10
log
@SECURITY and other bug fixes.

- A vulnerability in ClamAV's chm-parser allowed remote attackers to
cause a denial of service (application crash) via a malformed CHM file
(CVE-2008-1389).

- A vulnerability in libclamav would allow attackers to cause a
denial of service via vectors related to an out-of-memory condition
(CVE-2008-3912).

- Multiple memory leaks were found in ClamAV that could possibly allow
attackers to cause a denial of service via excessive memory consumption
(CVE-2008-3913).

- A number of unspecified vulnerabilities in ClamAV were reported that
have an unknown impact and attack vectors related to file descriptor
leaks (CVE-2008-3914).

various OpenBSD patches rolled in upstream. thanks to sturm@@
for looking over systrace.filter (needed for the test of sendmsg()
in configure to enable FD passing).
@
text
@$OpenBSD: patch-clamdscan_client_c,v 1.9 2008/04/16 19:46:01 mbalmer Exp $
--- clamdscan/client.c.orig	Wed Apr  2 22:17:13 2008
+++ clamdscan/client.c	Mon Apr 14 18:41:12 2008
@@@@ -26,6 +26,7 @@@@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <sys/socket.h>
+#include <sys/param.h>
 #include <sys/un.h>
 #include <netinet/in.h>
 #include <arpa/inet.h>
@@@@ -233,18 +234,18 @@@@ static int dsstream(int sockd, const struct optstruct 
 static char *abpath(const char *filename)
 {
 	struct stat foo;
-	char *fullpath, cwd[200];
+	char *fullpath, cwd[MAXPATHLEN];
 
     if(stat(filename, &foo) == -1) {
 	logg("^Can't access file %s\n", filename);
 	perror(filename);
 	return NULL;
     } else {
-	fullpath = malloc(200 + strlen(filename) + 10);
+	fullpath = malloc(sizeof(cwd) + strlen(filename) + 10);
 #ifdef C_CYGWIN
 	sprintf(fullpath, "%s", filename);
 #else
-	if(!getcwd(cwd, 200)) {
+	if(!getcwd(cwd, MAXPATHLEN)) {
 	    logg("^Can't get absolute pathname of current working directory.\n");
 	    return NULL;
 	}
@


1.9
log
@Update ClamAV to version 0.93, which fixes mostly security problems, at
least one highly critical (remote). See http://secunia.com/advisories/29000
for details.

Thanks to kurt@@ for helping analyzing the threaded code issues.
@
text
@d1 1
a1 1
$OpenBSD: patch-clamdscan_client_c,v 1.7 2007/08/25 10:08:28 mbalmer Exp $
@


1.8
log
@Security update to clamav-0.92. (CVE-2007-6335)

"ClamAV libclamav MEW PE File Integer Overflow Vulnerability"

More info:
http://labs.idefense.com/intelligence/vulnerabilities/display.php?id=634

Similar diff submitted by grunk@@ on ports@@.

test & ok mbalmer@@ (MAINTAINER)
@
text
@d2 2
a3 2
--- clamdscan/client.c.orig	Thu Dec  6 13:58:52 2007
+++ clamdscan/client.c	Tue Dec 18 10:18:09 2007
d12 1
a12 1
@@@@ -281,18 +282,18 @@@@ static int dsstream(int sockd, const struct optstruct 
@


1.7
log
@Update ClamAV to version 0.91.2.

Note to -stable ports maintainers:  This should probably be put into -stable
since the ClamAV people do not provide virus data to outdated scan engines.

ok simon
@
text
@d1 3
a3 3
$OpenBSD: patch-clamdscan_client_c,v 1.6 2007/03/25 11:24:02 mbalmer Exp $
--- clamdscan/client.c.orig	Sat Mar 31 20:59:16 2007
+++ clamdscan/client.c	Sat Aug 25 09:35:06 2007
d12 1
a12 1
@@@@ -286,18 +287,18 @@@@ static int dsstream(int sockd, const struct optstruct 
@


1.6
log
@Update to ClamAV 0.90.1.  Work done mostly by Stuart Henderson, with some
tweaks by myself.
@
text
@d1 4
a4 4
$OpenBSD: patch-clamdscan_client_c,v 1.5 2007/02/28 20:31:08 mbalmer Exp $
--- clamdscan/client.c.orig	Wed Feb 28 00:44:45 2007
+++ clamdscan/client.c	Tue Mar 13 09:33:36 2007
@@@@ -27,6 +27,7 @@@@
d12 1
a12 1
@@@@ -287,18 +288,18 @@@@ static int dsstream(int sockd, const str
@


1.5
log
@Update to ClamAV 0.90.  A lot of improvments and bugfixes, see www.clamav.net
for all details.

ok nikolay
@
text
@d1 3
a3 3
$OpenBSD: patch-clamdscan_client_c,v 1.4 2006/08/15 18:48:22 mbalmer Exp $
--- clamdscan/client.c.orig	Sun Feb 11 01:20:56 2007
+++ clamdscan/client.c	Wed Feb 14 08:31:04 2007
d12 1
a12 1
@@@@ -288,18 +289,18 @@@@ static int dsstream(int sockd, const str
d24 2
a25 2
-	fullpath = mcalloc(200 + strlen(filename) + 10, sizeof(char));
+	fullpath = mcalloc(sizeof(cwd) + strlen(filename) + 10, sizeof(char));
d30 1
a30 1
+	if(!getcwd(cwd, sizeof(cwd))) {
@


1.5.2.1
log
@MFC:
Update to ClamAV 0.90.1.  Work done mostly by Stuart Henderson, with some
tweaks by myself.
---
Security update to ClamAV 0.90.2.  This containe three import security
fixes:

- ClamAV CAB File Unstore Buffer Overflow Vulnerability
- File descriptor leak in CHM handler
- PDF fd leak

From the original annoucement:

**Important note**: on April 16th CHM, CAB and PDF handlers will be
disabled for 0.90 and 0.90.1 users through the dynamic engine
configuration module (DCONF). Please upgrade to 0.90.2 immediately.
@
text
@d1 3
a3 3
$OpenBSD: patch-clamdscan_client_c,v 1.6 2007/03/25 11:24:02 mbalmer Exp $
--- clamdscan/client.c.orig	Wed Feb 28 00:44:45 2007
+++ clamdscan/client.c	Tue Mar 13 09:33:36 2007
d12 1
a12 1
@@@@ -287,18 +288,18 @@@@ static int dsstream(int sockd, const str
d24 2
a25 2
-	fullpath = malloc(200 + strlen(filename) + 10);
+	fullpath = malloc(sizeof(cwd) + strlen(filename) + 10);
d30 1
a30 1
+	if(!getcwd(cwd, MAXPATHLEN)) {
@


1.5.2.2
log
@MFC:
Update ClamAV to version 0.91.2

work done by ajacoutot@@
@
text
@d1 4
a4 4
$OpenBSD: patch-clamdscan_client_c,v 1.5.2.1 2007/05/01 16:24:35 sturm Exp $
--- clamdscan/client.c.orig	Sat Mar 31 20:59:16 2007
+++ clamdscan/client.c	Thu Aug 30 10:52:35 2007
@@@@ -26,6 +26,7 @@@@
d12 1
a12 1
@@@@ -286,18 +287,18 @@@@ static int dsstream(int sockd, const str
@


1.4
log
@security update to 0.88.4
ok pvalchev
@
text
@d1 4
a4 4
$OpenBSD: patch-clamdscan_client_c,v 1.3 2005/05/12 14:55:21 mbalmer Exp $
--- clamdscan/client.c.orig	Thu Apr 20 10:52:19 2006
+++ clamdscan/client.c	Fri Jul 28 02:28:02 2006
@@@@ -26,6 +26,7 @@@@
d12 2
a13 2
@@@@ -294,18 +295,18 @@@@ int dsstream(int sockd, const struct opt
 char *abpath(const char *filename)
d20 1
a20 1
 	mprintf("@@Can't access file %s\n", filename);
d31 1
a31 1
 	    mprintf("@@Can't get absolute pathname of current working directory.\n");
@


1.4.2.1
log
@MFC:
Update to ClamAV 0.90.  A lot of improvments and bugfixes, see www.clamav.net
for all details.
@
text
@d1 4
a4 4
$OpenBSD: patch-clamdscan_client_c,v 1.5 2007/02/28 20:31:08 mbalmer Exp $
--- clamdscan/client.c.orig	Sun Feb 11 01:20:56 2007
+++ clamdscan/client.c	Wed Feb 14 08:31:04 2007
@@@@ -27,6 +27,7 @@@@
d12 2
a13 2
@@@@ -288,18 +289,18 @@@@ static int dsstream(int sockd, const str
 static char *abpath(const char *filename)
d20 1
a20 1
 	logg("^Can't access file %s\n", filename);
d31 1
a31 1
 	    logg("^Can't get absolute pathname of current working directory.\n");
@


1.4.2.2
log
@MFC:
Update to ClamAV 0.90.1.  Work done mostly by Stuart Henderson, with some
tweaks by myself.
@
text
@d1 3
a3 3
$OpenBSD: patch-clamdscan_client_c,v 1.4.2.1 2007/03/16 22:12:34 sturm Exp $
--- clamdscan/client.c.orig	Wed Feb 28 01:44:45 2007
+++ clamdscan/client.c	Mon Apr  2 15:58:03 2007
d12 1
a12 1
@@@@ -287,18 +288,18 @@@@ static int dsstream(int sockd, const str
d24 2
a25 2
-	fullpath = malloc(200 + strlen(filename) + 10);
+	fullpath = malloc(sizeof(cwd) + strlen(filename) + 10);
d30 1
a30 1
+	if(!getcwd(cwd, MAXPATHLEN)) {
@


1.4.2.3
log
@MFC:
Update ClamAV to version 0.91.2

work done by ajacoutot@@
@
text
@d1 4
a4 4
$OpenBSD: patch-clamdscan_client_c,v 1.4.2.2 2007/04/02 14:02:01 sturm Exp $
--- clamdscan/client.c.orig	Sat Mar 31 20:59:16 2007
+++ clamdscan/client.c	Thu Aug 30 10:52:25 2007
@@@@ -26,6 +26,7 @@@@
d12 1
a12 1
@@@@ -286,18 +287,18 @@@@ static int dsstream(int sockd, const str
@


1.3
log
@Update to ClamAV version 0.85
@
text
@d1 3
a3 3
$OpenBSD$
--- clamdscan/client.c.orig	Sun Feb  6 20:28:03 2005
+++ clamdscan/client.c	Sun Apr 10 10:00:25 2005
d12 1
a12 1
@@@@ -283,18 +284,18 @@@@ int dsstream(int sockd, const struct opt
@


1.3.4.1
log
@MFC:
security update to 0.88.4
@
text
@d1 3
a3 3
$OpenBSD: patch-clamdscan_client_c,v 1.3 2005/05/12 14:55:21 mbalmer Exp $
--- clamdscan/client.c.orig	Thu Apr 20 18:52:19 2006
+++ clamdscan/client.c	Wed Aug 16 22:25:33 2006
d12 1
a12 1
@@@@ -294,18 +295,18 @@@@ int dsstream(int sockd, const struct opt
@


1.3.4.2
log
@MFC:
Update to ClamAV 0.90.  A lot of improvments and bugfixes, see www.clamav.net
for all details.
@
text
@d1 4
a4 4
$OpenBSD: patch-clamdscan_client_c,v 1.3.4.1 2006/08/20 10:11:40 sturm Exp $
--- clamdscan/client.c.orig	Sun Feb 11 01:20:56 2007
+++ clamdscan/client.c	Fri Mar 16 19:08:37 2007
@@@@ -27,6 +27,7 @@@@
d12 2
a13 2
@@@@ -288,18 +289,18 @@@@ static int dsstream(int sockd, const str
 static char *abpath(const char *filename)
d20 1
a20 1
 	logg("^Can't access file %s\n", filename);
d31 1
a31 1
 	    logg("^Can't get absolute pathname of current working directory.\n");
@


1.3.4.3
log
@MFC:
Update to ClamAV 0.90.1.  Work done mostly by Stuart Henderson, with some
tweaks by myself.
@
text
@d1 3
a3 3
$OpenBSD: patch-clamdscan_client_c,v 1.3.4.2 2007/03/16 21:31:20 sturm Exp $
--- clamdscan/client.c.orig	Wed Feb 28 01:44:45 2007
+++ clamdscan/client.c	Wed Mar 28 21:45:23 2007
d12 1
a12 1
@@@@ -287,18 +288,18 @@@@ static int dsstream(int sockd, const str
d24 2
a25 2
-	fullpath = malloc(200 + strlen(filename) + 10);
+	fullpath = malloc(sizeof(cwd) + strlen(filename) + 10);
d30 1
a30 1
+	if(!getcwd(cwd, MAXPATHLEN)) {
@


1.3.2.1
log
@MFC:
security update to 0.88.4
@
text
@d1 3
a3 3
$OpenBSD: patch-clamdscan_client_c,v 1.3 2005/05/12 14:55:21 mbalmer Exp $
--- clamdscan/client.c.orig	Thu Apr 20 18:52:19 2006
+++ clamdscan/client.c	Wed Aug 16 22:25:02 2006
d12 1
a12 1
@@@@ -294,18 +295,18 @@@@ int dsstream(int sockd, const struct opt
@


1.2
log
@Upgrade to ClamAV 0.81 on popular request.

ok alek@@
@
text
@d2 4
a5 3
--- clamdscan/client.c.orig	Sun Jan  9 12:24:58 2005
+++ clamdscan/client.c	Sun Jan  9 12:27:44 2005
@@@@ -25,6 +25,7 @@@@
a6 1
 #include <unistd.h>
d12 1
a12 1
@@@@ -186,18 +187,18 @@@@ int dsstream(int sockd)
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@Clam Antivirus is a free virus scanner with a command line scanner, a
scanning daemon (clamd), signature update from the net (freshclam), and
a sendmail-milter (clamav-milter).

ok alek@@
@
text
@@
