head	1.5;
access;
symbols
	OPENBSD_4_7:1.4.0.18
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.16
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.14
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.12
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.10
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.8
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.6
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.4
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.4.0.2
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.3.0.2
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.2.0.4
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.5
date	2010.04.26.01.32.38;	author jakemsr;	state dead;
branches;
next	1.4;

1.4
date	2005.10.26.02.45.23;	author jolan;	state Exp;
branches;
next	1.3;

1.3
date	2005.04.04.15.35.45;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.06.03.36.24;	author jolan;	state Exp;
branches;
next	1.1;

1.1
date	2004.07.11.06.27.07;	author jolan;	state Exp;
branches;
next	;


desc
@@


1.5
log
@sndio supported as default audio output method

ok jolan@@ (MAINTAINER)
@
text
@$OpenBSD: patch-speech_tools_audio_voxware_cc,v 1.4 2005/10/26 02:45:23 jolan Exp $
--- speech_tools/audio/voxware.cc.orig	Fri Apr 30 11:56:49 2004
+++ speech_tools/audio/voxware.cc	Wed Aug  4 20:05:58 2004
@@@@ -61,11 +61,12 @@@@
 #include "EST_error.h"
 
 #ifdef SUPPORT_FREEBSD16
-#include <machine/soundcard.h>
+#include <soundcard.h>
 #include <fcntl.h>
 int freebsd16_supported = TRUE;
 int linux16_supported = FALSE;
 static char *aud_sys_name = "FreeBSD";
+static int stereo_only = 0;
 #endif
 
 #ifdef SUPPORT_LINUX16
@@@@ -157,7 +158,7 @@@@ int play_voxware_wave(EST_Wave &inwave, 
     if (al.present("-audiodevice"))
 	audiodevice = al.val("-audiodevice");
     else
-	audiodevice = "/dev/dsp";
+	audiodevice = "/dev/audio";
 
     if ((audio = open(audiodevice,O_WRONLY)) == -1)
     {
@@@@ -284,7 +285,7 @@@@ int record_voxware_wave(EST_Wave &inwave
     if (al.present("-audiodevice"))
 	audiodevice = al.val("-audiodevice");
     else
-	audiodevice = "/dev/dsp";
+	audiodevice = "/dev/audio";
 
     sample_rate = al.ival("-sample_rate");
     
@


1.4
log
@revert resampling stuff because it breaks audio output on big endian
systems

noticed by joris@@
@
text
@d1 1
a1 1
$OpenBSD: patch-speech_tools_audio_voxware_cc,v 1.2 2004/08/06 03:36:24 jolan Exp $
@


1.3
log
@fix audio output if the audio device can't do 16000 Hz, by activating
resampling.
@
text
@d2 3
a4 3
--- speech_tools/audio/voxware.cc.orig	Fri Apr 30 18:56:49 2004
+++ speech_tools/audio/voxware.cc	Mon Apr  4 16:42:40 2005
@@@@ -61,11 +61,13 @@@@
a14 1
+static int resample = 0;
d18 1
a18 18
@@@@ -116,11 +118,15 @@@@ static int sb_set_sample_rate(int sbdevi
     int fmt;
     int sfmts;
     int stereo=0;
+    int ssamp_rate=0;
     int sstereo;
     int channels=1;
 
     ioctl(sbdevice,SNDCTL_DSP_RESET,0);
-    ioctl(sbdevice,SNDCTL_DSP_SPEED,&samp_rate);
+    ssamp_rate = samp_rate;
+    ioctl(sbdevice,SNDCTL_DSP_SPEED,&ssamp_rate);
+    if (samp_rate != ssamp_rate)
+    	resample = ssamp_rate;
     sstereo = stereo;
     ioctl(sbdevice,SNDCTL_DSP_STEREO,&sstereo);
     /* Some devices don't do mono even when you ask them nicely */
@@@@ -157,7 +163,7 @@@@ int play_voxware_wave(EST_Wave &inwave, 
d27 1
a27 13
@@@@ -172,6 +178,11 @@@@ int play_voxware_wave(EST_Wave &inwave, 
     sample_rate = inwave.sample_rate();
 
     actual_fmt = sb_set_sample_rate(audio,sample_rate);
+    if (resample) {
+    	inwave.resample(resample);
+	sample_rate = inwave.sample_rate();
+	num_samples = inwave.num_samples();
+    }
 
     if (stereo_only)
     {
@@@@ -284,7 +295,7 @@@@ int record_voxware_wave(EST_Wave &inwave
@


1.2
log
@update to 1.95-beta
@
text
@d1 4
a4 4
$OpenBSD: patch-speech_tools_audio_voxware_cc,v 1.1 2004/07/11 06:27:07 jolan Exp $
--- speech_tools/audio/voxware.cc.orig	Fri Apr 30 11:56:49 2004
+++ speech_tools/audio/voxware.cc	Wed Aug  4 20:05:58 2004
@@@@ -61,11 +61,12 @@@@
d15 1
d19 18
a36 1
@@@@ -157,7 +158,7 @@@@ int play_voxware_wave(EST_Wave &inwave, 
d45 13
a57 1
@@@@ -284,7 +285,7 @@@@ int record_voxware_wave(EST_Wave &inwave
@


1.1
log
@$ cvs import ...
I ports/audio/festival/core

real fucking cute. fuck you, you fucking fuck!
@
text
@d1 4
a4 4
$OpenBSD$
--- speech_tools/audio/voxware.cc.orig	2002-12-02 08:14:58.000000000 -0600
+++ speech_tools/audio/voxware.cc	2004-05-13 21:13:03.000000000 -0500
@@@@ -61,7 +61,7 @@@@
d13 6
a18 1
@@@@ -150,7 +150,7 @@@@ int play_voxware_wave(EST_Wave &inwave, 
d27 1
a27 1
@@@@ -262,7 +262,7 @@@@ int record_voxware_wave(EST_Wave &inwave
@

