head	1.3;
access;
symbols
	OPENBSD_4_6:1.2.0.16
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.14
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.12
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.10
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.8
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.6
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.4
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.2
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.1.0.10
	OPENBSD_3_8_BASE:1.1
	OPENBSD_3_7:1.1.0.8
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.6
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_5:1.1.0.4
	OPENBSD_3_5_BASE:1.1
	OPENBSD_3_4:1.1.0.2
	OPENBSD_3_4_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2009.12.16.07.49.29;	author jakemsr;	state dead;
branches;
next	1.2;

1.2
date	2005.10.04.20.16.04;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.18.07.40.55;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to xmp-3.0.0
from Alexandr Shadchin
@
text
@$OpenBSD: patch-src_drivers_openbsd_c,v 1.2 2005/10/04 20:16:04 espie Exp $
--- src/drivers/openbsd.c.orig	Fri Dec 29 19:08:08 2000
+++ src/drivers/openbsd.c	Tue Oct  4 22:12:46 2005
@@@@ -39,7 +39,6 @@@@ static void shutdown (void);
 static void dummy () { }
 
 static char *help[] = {
-    "gain=val", "Audio output gain (0 to 255)",
     "buffer=val", "Audio buffer size (default is 32768)",
     NULL
 };
@@@@ -75,35 +74,36 @@@@ struct xmp_drv_info drv_openbsd = {
 static int setaudio (struct xmp_control *ctl)
 {
     audio_info_t ainfo;
-    int gain = 128;
     int bsize = 32 * 1024;
     char *token;
     char **parm = ctl->parm;
 
     parm_init ();
-    chkparm1 ("gain", gain = atoi (token));
     chkparm1 ("buffer", bsize = atoi (token));
     parm_end ();
 
-    if (gain < AUDIO_MIN_GAIN)
-	gain = AUDIO_MIN_GAIN;
-    if (gain > AUDIO_MAX_GAIN)
-	gain = AUDIO_MAX_GAIN;
-
     AUDIO_INITINFO (&ainfo);
 
+    ainfo.mode = AUMODE_PLAY;
     ainfo.play.sample_rate = ctl->freq;
     ainfo.play.channels = ctl->outfmt & XMP_FMT_MONO ? 1 : 2;
     ainfo.play.precision = ctl->resol;
     ainfo.play.encoding = ctl->resol > 8 ?
 	AUDIO_ENCODING_SLINEAR : AUDIO_ENCODING_ULINEAR;
-    ainfo.play.gain = gain;
     ainfo.play.buffer_size = bsize;
 
     if (ioctl (audio_fd, AUDIO_SETINFO, &ainfo) == -1) {
 	close (audio_fd);
 	return XMP_ERR_DINIT;
     }
+
+    ioctl (audio_fd, AUDIO_GETINFO, &ainfo);
+    ctl->freq = ainfo.play.sample_rate;
+    if (ainfo.play.channels == 2)
+    	ctl->outfmt &= ~XMP_FMT_MONO;
+    else
+    	ctl->outfmt |= XMP_FMT_MONO;
+    ctl->resol = ainfo.play.precision;
 
     drv_openbsd.description = "OpenBSD PCM audio";
     return XMP_OK;
@


1.2
log
@re-read parameters after set.
fixes issues with soundcards that can't handle all frequencies or any
number of channels.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_drivers_openbsd_c,v 1.1 2003/05/18 07:40:55 naddy Exp $
@


1.1
log
@Update to 2.0.4, add XMMS plugin.
@
text
@d1 3
a3 3
$OpenBSD$
--- src/drivers/openbsd.c.orig	Sat May 17 14:40:43 2003
+++ src/drivers/openbsd.c	Sat May 17 15:15:37 2003
d12 1
a12 1
@@@@ -75,29 +74,22 @@@@ struct xmp_drv_info drv_openbsd = {
d43 14
@

