head	1.3;
access;
symbols
	libao_0_6_0:1.1.1.1 libao:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2001.03.17.23.45.47;	author naddy;	state dead;
branches;
next	1.2;

1.2
date	2001.03.16.11.58.46;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2001.03.14.01.54.09;	author todd;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.03.14.01.54.09;	author todd;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Remove OSS plug-in and replace with "sun" one for our native audio API.
@
text
@$OpenBSD: patch-src_plugins_oss_ao_oss_c,v 1.2 2001/03/16 11:58:46 naddy Exp $
--- src/plugins/oss/ao_oss.c.orig	Sat Feb 24 02:31:48 2001
+++ src/plugins/oss/ao_oss.c	Thu Mar 15 21:27:15 2001
@@@@ -112,29 +112,15 @@@@ ao_internal_t *plugin_open(uint_32 bits,
 			goto ERR;
 		}
 	} else {
-		/* default: first try the devfs path */
-		state->dev = strdup("/dev/sound/dsp");
+		state->dev = strdup("/dev/sound");
 		state->fd=open(state->dev,O_WRONLY);
 		if(state->fd < 0) 
 		{
-			/* no? then try the traditional path */
-			char *err = strdup(strerror(errno));
-			char *dev = strdup(state->dev);
-			free(state->dev);
-			state->dev = strdup("/dev/dsp");
-			state->fd=open(state->dev,O_WRONLY);
-			if(state->fd < 0) 
-			{
-				fprintf(stderr,
-					"libao - error: Could not open either default device:\n"
-					"  %s - %s\n"
-					"  %s - %s\n",
-					err, dev,
-					strerror(errno), state->dev);
-				free(err);
-				free(dev);
-				goto ERR;
-			}
+			fprintf(stderr,
+				"libao - error: Could not open default device:\n",
+				"  %s - %s\n",
+				strerror(errno), state->dev);
+			goto ERR;
 		}
 	}
 
@@@@ -198,7 +184,9 @@@@ void plugin_close(ao_internal_t *state)
 int plugin_get_latency(ao_internal_t *state)
 {
 	int odelay = 0;
+#ifdef SNDCTL_DSP_GETODELAY
 	ioctl(((ao_oss_internal_t *)state)->fd, SNDCTL_DSP_GETODELAY, &odelay);
+#endif
 	return odelay;
 }
 
@


1.2
log
@Create arts/esd/oss flavors; defaults to oss.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@Initial revision
@
text
@d3 3
a5 2
+++ src/plugins/oss/ao_oss.c	Tue Mar 13 15:27:15 2001
@@@@ -113,28 +113,15 @@@@ ao_internal_t *plugin_open(uint_32 bits,
d8 1
a8 1
 		/* default: first try the devfs path */
d40 1
a40 1
@@@@ -198,7 +185,9 @@@@ void plugin_close(ao_internal_t *state)
@


1.1.1.1
log
@Libao is a cross-platform audio library that allows programs to output
audio using a simple API on a wide variety of platforms.  It currently
supports:
.   * Null output
.   * WAV files
.   * OSS (Open Sound System)
.   * ESD (ESounD or Enlighten Sound Daemon)
.   * ALSA (Advanced Linux Sound Architecture)
.   * Solaris (untested)
.   * IRIX (untested)

.. thanks to naddy@@ for beating oss into shape!
@
text
@@
