head	1.10;
access;
symbols
	OPENBSD_5_8:1.7.0.4
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_5:1.4.0.2
	OPENBSD_5_5_BASE:1.4;
locks; strict;
comment	@# @;


1.10
date	2017.08.24.09.06.10;	author dcoppa;	state dead;
branches;
next	1.9;
commitid	L18tOeap7UVHq1a6;

1.9
date	2017.08.11.09.44.08;	author dcoppa;	state Exp;
branches;
next	1.8;
commitid	J58AR5VE1GXG1rpR;

1.8
date	2015.08.26.05.56.22;	author dcoppa;	state dead;
branches;
next	1.7;
commitid	y9wqGRrrECd7SlET;

1.7
date	2015.03.20.14.59.36;	author dcoppa;	state Exp;
branches;
next	1.6;
commitid	tzaKvkdfFo0uzMlR;

1.6
date	2014.05.20.14.51.46;	author dcoppa;	state dead;
branches;
next	1.5;

1.5
date	2014.03.27.09.28.06;	author dcoppa;	state Exp;
branches;
next	1.4;

1.4
date	2014.01.13.08.46.45;	author dcoppa;	state Exp;
branches;
next	1.3;

1.3
date	2012.05.04.10.32.33;	author dcoppa;	state dead;
branches;
next	1.2;

1.2
date	2012.04.21.13.38.47;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2012.04.19.21.39.08;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.10
log
@
Update to a newer snapshot (pianobar-2017.04.26)
@
text
@$OpenBSD: patch-src_ui_act_c,v 1.9 2017/08/11 09:44:08 dcoppa Exp $

commit 2a8865ad0d7c4976f43d99ed258c84ae4f95b0ce
Author: Lars-Dominik Braun <lars@@6xq.net>
Date:   Wed Apr 26 14:47:25 2017 +0200

Fix use-after-free when deleting station

Index: src/ui_act.c
--- src/ui_act.c.orig
+++ src/ui_act.c
@@@@ -240,11 +240,13 @@@@ BarUiActCallback(BarUiActDeleteStation) {
 				/* drain playlist */
 				PianoDestroyPlaylist (PianoListNextP (app->playlist));
 				app->playlist->head.next = NULL;
+				selSong = NULL;
 			}
 			app->nextStation = NULL;
 			/* XXX: usually we shoudnâ€™t touch cur*, but DELETE_STATION destroys
 			 * station struct */
 			app->curStation = NULL;
+			selStation = NULL;
 		}
 		BarUiActDefaultEventcmd ("stationdelete");
 	}
@


1.9
log
@
Fix use-after-free when deleting station
(upstream git commit 2a8865ad0d7c4976f43d99ed258c84ae4f95b0ce)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.8
log
@
Update to a newer snapshot (2015.08.04)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_ui_act_c,v 1.7 2015/03/20 14:59:36 dcoppa Exp $
d3 1
a3 1
commit 1cd5c5ec77ea43088982a439b58499be87c62087
d5 1
a5 1
Date:   Sat Mar 7 16:01:26 2015 +0100
d7 1
a7 2
Fix upcoming songs assertion failure
This should not be an assertion, it is expected to happen.
d9 17
a25 13
--- src/ui_act.c.orig	Sun Sep 28 08:17:29 2014
+++ src/ui_act.c	Fri Mar 20 09:44:47 2015
@@@@ -496,9 +496,7 @@@@ BarUiActCallback(BarUiActTempBanSong) {
 /*	print upcoming songs
  */
 BarUiActCallback(BarUiActPrintUpcoming) {
-	assert (selSong != NULL);
-
-	PianoSong_t *nextSong = PianoListNextP (selSong);
+	PianoSong_t * const nextSong = PianoListNextP (selSong);
 	if (nextSong != NULL) {
 		BarUiListSongs (&app->settings, nextSong, NULL);
 	} else {
@


1.7
log
@
Merge bugfixes from upstream:

Fix upcoming songs assertion failure
(git commit 1cd5c5ec77ea43088982a439b58499be87c62087)

player: Ignore volume change before playback started
(git commit 310900e4be52d11388792d776d9f6b89380bbecd)

player: Fix initial track volume
(git commit 0005ea3873202ddefaae6466a932c159c08fd1c3)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.6
log
@
Update to 2014.04.22 snapshot.

It now uses ffmpeg instead of faad+libmad.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_ui_act_c,v 1.5 2014/03/27 09:28:06 dcoppa Exp $
d3 1
a3 1
commit b91dada75f804ccca64644f6d40276db4815f4b3
d5 1
a5 1
Date: Sun Jan 12 13:51:01 2014 +0100
d7 2
a8 1
Return if station info request fails
d10 13
a22 31
commit ebfd7d45c6b8eb5b2a1ee6e97a3f21f5f5bf9b43
Author: Cody P Schafer <devel@@codyps.com>
Date:   Thu Mar 13 11:14:21 2014 -0700

fix warnings now noted due to format string checking

--- src/ui_act.c.orig	Sun Sep 15 15:54:04 2013
+++ src/ui_act.c	Thu Mar 27 10:18:13 2014
@@@@ -675,8 +675,12 @@@@ BarUiActCallback(BarUiActManageStation) {
 	reqData.station = selStation;
 
 	BarUiMsg (&app->settings, MSG_INFO, "Fetching station info... ");
-	BarUiActDefaultPianoCall (PIANO_REQUEST_GET_STATION_INFO, &reqData);
+	const bool bret = BarUiActDefaultPianoCall (PIANO_REQUEST_GET_STATION_INFO,
+			&reqData);
 	BarUiActDefaultEventcmd ("stationfetchinfo");
+	if (!bret) {
+		return;
+	}
 
 	/* enable submenus depending on data availability */
 	strcpy (question, "Delete ");
@@@@ -720,7 +724,7 @@@@ BarUiActCallback(BarUiActManageStation) {
 		return;
 	}
 
-	BarUiMsg (&app->settings, MSG_QUESTION, question);
+	BarUiMsg (&app->settings, MSG_QUESTION, "%s", question);
 	if (BarReadline (selectBuf, sizeof (selectBuf), allowedActions, &app->input,
 					BAR_RL_FULLRETURN, -1)) {
 		if (selectBuf[0] == 'a') {
@


1.5
log
@
format string fixes from upstream
(git commit ebfd7d45c6b8eb5b2a1ee6e97a3f21f5f5bf9b43)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_ui_act_c,v 1.4 2014/01/13 08:46:45 dcoppa Exp $
@


1.4
log
@A couple of ui-related fixes from upstream:

Return if station info request fails
(upstream git commit b91dada75f804ccca64644f6d40276db4815f4b3)

Added Ctrl-u to readline, fixed several issues (multibyte,
\0-termination), and refactored readline code
(upstream git commit 9d5682f8acf991b060119a39bc8aa447175cd294)
@
text
@d1 1
a1 1
$OpenBSD$
d9 6
d16 1
a16 1
+++ src/ui_act.c	Mon Jan 13 08:00:39 2014
d31 9
@


1.3
log
@Update to a new snapshot dated 2012-05-02.
Makes pianobar work again, after the umpteenth change to Pandora API.

New dependencies: devel/json-c, security/libgcrypt
@
text
@d1 1
a1 1
$OpenBSD: patch-src_ui_act_c,v 1.2 2012/04/21 13:38:47 dcoppa Exp $
d3 3
a5 6
Strict pthread implementations (like OpenBSD's rthreads with
PTHREAD_MUTEX_TYPE_STRICT_NP set) don't allow unlocking a mutex
that is not locked, resulting in abort() being called. Always
aquiring the lock before unlocking it while skipping to the next
song fixes this.
(upstream git commit bbed23df60c4bfc067b4f7c03574cfe11cc8bb60)
d7 6
a12 4
--- src/ui_act.c.orig	Fri Apr 20 09:01:59 2012
+++ src/ui_act.c	Sat Apr 21 15:26:21 2012
@@@@ -50,6 +50,8 @@@@ static inline void BarUiDoSkipSong (struct audioPlayer
 	assert (player != NULL);
d14 8
a21 5
 	player->doQuit = 1;
+	/* unlocking an unlocked mutex is forbidden by some implementations */
+	pthread_mutex_trylock (&player->pauseMutex);
 	pthread_mutex_unlock (&player->pauseMutex);
 }
d23 2
@


1.2
log
@Sync patch; committed upstream (no pkg change)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_ui_act_c,v 1.1 2012/04/19 21:39:08 dcoppa Exp $
@


1.1
log
@Bandaid fix to avoid unlocking a non-locked mutex.
PTHREAD_MUTEX_STRICT_NP is merciless ;-)
@
text
@d1 1
a1 1
$OpenBSD$
d3 6
a8 1
Bandaid fix to avoid unlocking a non-locked mutex.
d10 3
a12 3
--- src/ui_act.c.orig	Thu Apr 19 22:12:37 2012
+++ src/ui_act.c	Thu Apr 19 22:14:18 2012
@@@@ -50,6 +50,7 @@@@ static inline void BarUiDoSkipSong (struct audioPlayer
d16 1
@

