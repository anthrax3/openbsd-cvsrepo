head	1.5;
access;
symbols
	OPENBSD_6_2:1.5.0.6
	OPENBSD_6_2_BASE:1.5
	OPENBSD_6_1:1.5.0.4
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.2
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.4
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.1.0.2
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2016.05.24.09.13.14;	author dcoppa;	state Exp;
branches;
next	1.4;
commitid	qYjmTTWNWNpcFRaQ;

1.4
date	2015.07.24.15.03.38;	author dcoppa;	state Exp;
branches;
next	1.3;
commitid	J1GuYoKPGZOBBq4C;

1.3
date	2015.07.10.17.30.30;	author dcoppa;	state Exp;
branches;
next	1.2;
commitid	HD9hazwsxzJoNgNO;

1.2
date	2015.06.12.09.50.42;	author dcoppa;	state Exp;
branches;
next	1.1;
commitid	ukZdYNNURvb4aoA3;

1.1
date	2014.09.04.12.33.27;	author dcoppa;	state Exp;
branches;
next	;
commitid	X21woT3ICTss46TU;


desc
@@


1.5
log
@
Fix size of value passed to setsockopt
(git commit d723b45fc42e04b9179ba29c65efc9484ec2924c)

Upgrade TLS suites for OpenSSL
(part of git commit c72ebd29f239793218f2248c3f8b48a7b3e0a541)
@
text
@$OpenBSD: patch-src_server_c,v 1.4 2015/07/24 15:03:38 dcoppa Exp $

commit c2eec4582ad6f5f759d8b9a3c7f9bf78aa59f656
Author: Felix Morgner <felix.morgner@@gmail.com>
Date:   Mon Jul 6 11:20:34 2015 +0200

Fixed mutiple possible null-pointer derefences

commit 71893121fbce7762f5cd9e6a98c4ead7e5cd6211
Author: Omri Mor <omri50@@gmail.com>
Date:   Sun Jul 12 12:34:18 2015 +0300

Null pointer references

commit d723b45fc42e04b9179ba29c65efc9484ec2924c
Author: Patrick Mooney <pmooney@@pfmooney.com>
Date:   Sun Feb 21 02:11:34 2016 -0600

Fix size of value passed to setsockopt

--- src/server.c.orig	Sat Jun 20 00:58:46 2015
+++ src/server.c	Tue May 24 10:20:55 2016
@@@@ -95,15 +95,22 @@@@ void checkIPversions()
 struct sockaddr_storage** Server_setupAddressesAndPorts()
 {
 	struct sockaddr_storage** addresses = calloc(2, sizeof(void*));
+	if(!addresses)
+		Log_fatal("Not enough memory to allocate addresses");
 
 	struct sockaddr_storage* v4address = calloc(1, sizeof(struct sockaddr_storage));
+	if(!v4address)
+		Log_fatal("Not enough memory to allocate IPv4 address");
 	v4address->ss_family = AF_INET;
+
 	struct sockaddr_storage* v6address = calloc(1, sizeof(struct sockaddr_storage));
+	if(!v6address)
+		Log_fatal("Not enough memory to allocate IPv6 address");
 	v6address->ss_family = AF_INET6;
 
 #if defined(__NetBSD__) || defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__APPLE__)
-	v4address->ss_len = sizeof(struct sockaddr_storage);
-	v6address->ss_len = sizeof(struct sockaddr_storage);
+	v4address->ss_len = sizeof(struct sockaddr_in);
+	v6address->ss_len = sizeof(struct sockaddr_in6);
 #endif
 
 	int error = 0;
@@@@ -208,7 +215,7 @@@@ void Server_runLoop(struct pollfd* pollfds)
 
 void Server_setupTCPSockets(struct sockaddr_storage* addresses[2], struct pollfd* pollfds)
 {
-	uint8_t yes = 1;
+	int yes = 1;
 	int sockets[2];
 
 	if (hasv4) {
@


1.4
log
@
More fixes for null pointer references into server.c
(upstream git commit 71893121fbce7762f5cd9e6a98c4ead7e5cd6211)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_server_c,v 1.3 2015/07/10 17:30:30 dcoppa Exp $
d15 6
d22 1
a22 1
+++ src/server.c	Fri Jul 24 16:51:57 2015
d48 9
@


1.3
log
@
Bugfixing update to umurmur-0.2.16a
@
text
@d1 1
a1 1
$OpenBSD: patch-src_server_c,v 1.2 2015/06/12 09:50:42 dcoppa Exp $
d9 6
d16 1
a16 1
+++ src/server.c	Fri Jul 10 19:04:32 2015
a24 1
 	v4address->ss_family = AF_INET;
d27 1
d30 2
a32 2
+	if(!v4address)
+		Log_fatal("Not enough memory to allocate IPv6 address");
@


1.2
log
@
Update to umurmur-0.2.16
@
text
@d1 23
a23 4
$OpenBSD: patch-src_server_c,v 1.1 2014/09/04 12:33:27 dcoppa Exp $
--- src/server.c.orig	Tue Apr  7 12:01:12 2015
+++ src/server.c	Fri Jun 12 11:05:38 2015
@@@@ -103,8 +103,8 @@@@ struct sockaddr_storage** Server_setupAddressesAndPort
d25 2
@


1.1
log
@
Update to umurmur-0.2.15
@
text
@d1 4
a4 4
$OpenBSD$
--- src/server.c.orig	Thu Sep  4 13:41:55 2014
+++ src/server.c	Thu Sep  4 13:42:29 2014
@@@@ -102,8 +102,8 @@@@ struct sockaddr_storage** Server_setupAddressesAndPort
@

