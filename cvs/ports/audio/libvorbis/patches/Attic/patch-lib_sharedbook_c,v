head	1.1;
access;
symbols
	OPENBSD_4_6:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2010.01.02.23.12.35;	author william;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2010.01.02.23.12.35;	author william;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-lib_sharedbook_c was initially added on branch OPENBSD_4_6.
@
text
@@


1.1.2.1
log
@SECURITY FIX

Resolves:

CVE-2008-1419
CVE-2008-1420
CVE-2008-1423
CVE-2009-2663
CVE-2009-3379
and adds upstream-r14811_huffman_sanity_checks

from ubuntu via naddy@@, thanks

help and ok jasper@@
@
text
@a0 25
$OpenBSD$

SECURITY FIX

fix denial of service via underpopulated Huffman trees


--- lib/sharedbook.c.orig	Mon Jul 23 20:09:47 2007
+++ lib/sharedbook.c	Tue Dec  1 22:53:21 2009
@@@@ -124,7 +124,14 @@@@ ogg_uint32_t *_make_words(long *l,long n,long sparseco
     }else
       if(sparsecount==0)count++;
   }
-    
+  
+  /* sanity check the huffman tree; an underpopulated tree must be rejected. */
+  for(i=1;i<33;i++)
+    if(marker[i] & (0xffffffffUL>>(32-i))){
+      _ogg_free(r);
+      return(NULL);
+    }
+
   /* bitreverse the words because our bitwise packer/unpacker is LSb
      endian */
   for(i=0,count=0;i<n;i++){
@

