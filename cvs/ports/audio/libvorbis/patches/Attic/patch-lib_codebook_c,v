head	1.4;
access;
symbols
	OPENBSD_4_7:1.3.0.2
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.1.0.6
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.4
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.2
	OPENBSD_4_4_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2010.06.03.15.48.36;	author naddy;	state dead;
branches;
next	1.3;

1.3
date	2009.11.24.21.43.14;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2009.07.13.15.48.55;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2008.05.17.19.58.25;	author naddy;	state Exp;
branches
	1.1.6.1;
next	;

1.1.6.1
date	2010.01.02.23.12.35;	author william;	state Exp;
branches;
next	;


desc
@@


1.4
log
@update to 1.3.1; with and ok pea@@
@
text
@$OpenBSD: patch-lib_codebook_c,v 1.3 2009/11/24 21:43:14 naddy Exp $
--- lib/codebook.c.orig	Thu Jul  9 11:12:08 2009
+++ lib/codebook.c	Tue Nov 24 22:00:01 2009
@@@@ -198,6 +198,7 @@@@ int vorbis_staticbook_unpack(oggpack_buffer *opb,stati
       for(i=0;i<s->entries;){
         long num=oggpack_read(opb,_ilog(s->entries-i));
         if(num==-1)goto _eofout;
+        if(length>32)goto _errout;
         for(j=0;j<num && i<s->entries;j++,i++)
           s->lengthlist[i]=length;
         length++;
@


1.3
log
@SECURITY:
Fix handling of malformed Vorbis streams that would crash libvorbis.
CVE-2008-1420 (improved), CVE-2009-3379.  From xiph.org SVN.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@update to 1.2.3: mostly bug fixes
@
text
@d1 11
a11 21
$OpenBSD: patch-lib_codebook_c,v 1.1 2008/05/17 19:58:25 naddy Exp $
--- lib/codebook.c.orig	Sat May 17 21:25:08 2008
+++ lib/codebook.c	Sat May 17 21:26:54 2008
@@@@ -159,6 +159,8 @@@@ int vorbis_staticbook_unpack(oggpack_buffer *opb,stati
   s->entries=oggpack_read(opb,24);
   if(s->entries==-1)goto _eofout;
 
+  if(_ilog(s->dim)+_ilog(s->entries)>24)goto _eofout;
+
   /* codeword ordering.... length ordered or unordered? */
   switch((int)oggpack_read(opb,1)){
   case 0:
@@@@ -225,7 +227,7 @@@@ int vorbis_staticbook_unpack(oggpack_buffer *opb,stati
       int quantvals=0;
       switch(s->maptype){
       case 1:
-	quantvals=_book_maptype1_quantvals(s);
+	quantvals=(s->dim==0?0:_book_maptype1_quantvals(s));
 	break;
       case 2:
 	quantvals=s->entries*s->dim;
@


1.1
log
@SECURITY fixes from Xiph SVN:
* add code to prevent heap attacks by exploiting dim=bignum and
  partition_codewords = partion_values
* correctly handle the nonsensical codebook.dim==0 case
* dd checks/rejection for absurdly huge codebooks

CVE-2008-1419, CVE-2008-1420, CVE-2008-1423
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.6.1
log
@SECURITY FIX

Resolves:

CVE-2008-1419
CVE-2008-1420
CVE-2008-1423
CVE-2009-2663
CVE-2009-3379
and adds upstream-r14811_huffman_sanity_checks

from ubuntu via naddy@@, thanks

help and ok jasper@@
@
text
@d2 5
a6 21

SECURITY FIX

Resolves CVE-2009-3379


--- lib/codebook.c.orig	Mon Jul 23 20:09:47 2007
+++ lib/codebook.c	Thu Dec 17 21:52:31 2009
@@@@ -196,6 +196,7 @@@@ int vorbis_staticbook_unpack(oggpack_buffer *opb,stati
       for(i=0;i<s->entries;){
 	long num=oggpack_read(opb,_ilog(s->entries-i));
 	if(num==-1)goto _eofout;
+        if(length>32)goto _errout;
 	for(j=0;j<num && i<s->entries;j++,i++)
 	  s->lengthlist[i]=length;
 	length++;
@@@@ -220,6 +221,7 @@@@ int vorbis_staticbook_unpack(oggpack_buffer *opb,stati
     s->q_delta=oggpack_read(opb,32);
     s->q_quant=oggpack_read(opb,4)+1;
     s->q_sequencep=oggpack_read(opb,1);
+    if(s->q_sequencep==-1)goto _eofout;
d8 6
a13 1
     {
d15 7
@


