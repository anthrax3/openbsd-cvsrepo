head	1.2;
access;
symbols
	OPENBSD_3_3:1.1.0.20
	OPENBSD_3_3_BASE:1.1
	OPENBSD_3_2:1.1.0.18
	OPENBSD_3_2_BASE:1.1
	OPENBSD_3_1:1.1.0.16
	OPENBSD_3_1_BASE:1.1
	OPENBSD_3_0:1.1.0.14
	OPENBSD_3_0_BASE:1.1
	OPENBSD_2_9_TRACKING_SWITCH:1.1
	OPENBSD_2_9:1.1.0.12
	OPENBSD_2_9_BASE:1.1
	OPENBSD_2_8:1.1.0.10
	OPENBSD_2_8_BASE:1.1
	OPENBSD_2_7:1.1.0.8
	OPENBSD_2_7_BASE:1.1
	OPENBSD_2_6:1.1.0.6
	OPENBSD_2_6_BASE:1.1
	OPENBSD_2_5:1.1.0.4
	OPENBSD_2_5_BASE:1.1
	OPENBSD_2_4:1.1.0.2
	OPENBSD_2_4_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2003.09.01.03.08.52;	author krw;	state dead;
branches;
next	1.1;

1.1
date	98.08.07.08.45.03;	author downsj;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Fix <scsi.h> breakage. Make patches conform to current standards.

ok naddy@@.
@
text
@*** plat_freebsd.c.old	Fri Aug  7 01:35:19 1998
--- plat_freebsd.c	Fri Aug  7 01:41:00 1998
***************
*** 355,368 ****
  	if (fstatfs(stbuf.st_rdev, &buf) == 0)
  		return (-3);
  
! #if defined(__NetBSD__) || defined(__FreeBSD__) || defined(__OpenBSD__)
  	rval = ioctl(d->fd, CDIOCALLOW);
  	if (rval == 0)
  #endif
  	    rval = ioctl(d->fd, CDIOCEJECT);
! #if defined(__NetBSD__) || defined(__FreeBSD__) || defined(__OpenBSD__)
  	if (rval == 0)
  	    rval = ioctl(d->fd, CDIOCPREVENT);
  #endif
  	return rval;
  }
--- 355,374 ----
  	if (fstatfs(stbuf.st_rdev, &buf) == 0)
  		return (-3);
  
! #if defined(__NetBSD__) || defined(__FreeBSD__)
  	rval = ioctl(d->fd, CDIOCALLOW);
  	if (rval == 0)
  #endif
  	    rval = ioctl(d->fd, CDIOCEJECT);
! #if defined(__NetBSD__) || defined(__FreeBSD__)
  	if (rval == 0)
  	    rval = ioctl(d->fd, CDIOCPREVENT);
+ #endif
+ #if defined(__OpenBSD__)
+ 	if (rval == 0) {
+ 	    (void) close(d->fd);
+ 	    d->fd = -1;
+ 	}
  #endif
  	return rval;
  }
@


1.1
log
@Make the eject button in workman actually, well, work.
(People test the things they add to ports, right?)
@
text
@@

