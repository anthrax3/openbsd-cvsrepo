head	1.2;
access;
symbols
	OPENBSD_5_9:1.1.0.20
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.22
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.18
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.16
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.14
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.12
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.10
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.8
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.6
	OPENBSD_5_0:1.1.0.4
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2016.04.29.21.20.36;	author zhuk;	state dead;
branches;
next	1.1;
commitid	jLKJQnZluyuYhQUu;

1.1
date	2010.12.21.18.16.30;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Remove another bunch of KDE3 ports: outdated, superseded and useless ones.
@
text
@$OpenBSD: patch-amarok_src_mediadevice_mtp_mtpmediadevice_cpp,v 1.1 2010/12/21 18:16:30 jasper Exp $

Make compatible with newer libmtp API's.

--- amarok/src/mediadevice/mtp/mtpmediadevice.cpp.orig	Fri Dec  3 19:14:37 2010
+++ amarok/src/mediadevice/mtp/mtpmediadevice.cpp	Fri Dec  3 19:41:00 2010
@@@@ -296,9 +296,10 @@@@ MediaItem
 
     m_critical_mutex.lock();
     debug() << "Sending track... " << bundle.url().path().utf8() << endl;
+    trackmeta->parent_id = parent_id;
     int ret = LIBMTP_Send_Track_From_File(
         m_device, bundle.url().path().utf8(), trackmeta,
-        progressCallback, this, parent_id
+        progressCallback, this
     );
     m_critical_mutex.unlock();
 
@@@@ -380,7 +381,7 @@@@ MtpMediaDevice::getDefaultParentId( void )
     // Otherwise look for a folder called "Music"
     else if( m_folders != 0 )
     {
-        parent_id = folderNameToID( "Music", m_folders );
+        parent_id = folderNameToID( (char *)"Music", m_folders );
         if( !parent_id )
         {
             debug() << "Parent folder could not be found. Going to use top level." << endl;
@@@@ -529,7 +530,8 @@@@ LIBMTP_album_t
         for( MtpMediaItem *it = dynamic_cast<MtpMediaItem*>(items->first()); it; it = dynamic_cast<MtpMediaItem*>(items->next()) )
             album_object->tracks[i++] = it->track()->id();
         album_object->no_tracks = items->count();
-        ret = LIBMTP_Create_New_Album( m_device, album_object, 0 );
+        album_object->parent_id = 0;
+        ret = LIBMTP_Create_New_Album( m_device, album_object );
         if( ret != 0 )
         {
             debug() << "creating album failed : " << ret << endl;
@@@@ -608,7 +610,7 @@@@ MtpMediaDevice::createFolder( const char *name, uint32
 {
     debug() << "Creating new folder '" << name << "' as a child of "<< parent_id << endl;
     char *name_copy = qstrdup( name );
-    uint32_t new_folder_id = LIBMTP_Create_Folder( m_device, name_copy, parent_id );
+    uint32_t new_folder_id = LIBMTP_Create_Folder( m_device, name_copy, parent_id, 0 );
     delete(name_copy);
     debug() << "New folder ID: " << new_folder_id << endl;
     if( new_folder_id == 0 )
@@@@ -913,7 +915,8 @@@@ MtpMediaDevice::playlistFromItem( MtpMediaItem *item )
     if( item->playlist()->id() == 0 )
     {
         debug() << "creating new playlist : " << metadata->name << endl;
-        int ret = LIBMTP_Create_New_Playlist( m_device, metadata, 0 );
+	metadata->parent_id = 0;
+        int ret = LIBMTP_Create_New_Playlist( m_device, metadata );
         if( ret == 0 )
         {
             item->playlist()->setId( metadata->playlist_id );
@


1.1
log
@- fix after recent libmtp update

ok LEVAI Daniel
@
text
@d1 1
a1 1
$OpenBSD$
@

