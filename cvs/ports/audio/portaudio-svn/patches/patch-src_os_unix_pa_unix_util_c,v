head	1.2;
access;
symbols
	OPENBSD_6_0:1.2.0.14
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.10
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.12
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.8
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.6
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.4
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.2
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.1.0.4
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.2
	OPENBSD_5_2_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2013.03.12.00.59.50;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2012.05.19.06.04.22;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to portaudio revision 1851.

Mostly from Holger Mikolon <holger at mikolon dot com>

ok sthen@@
@
text
@$OpenBSD$
--- src/os/unix/pa_unix_util.c.orig	Thu Jul  5 23:44:45 2012
+++ src/os/unix/pa_unix_util.c	Thu Jul  5 23:49:33 2012
@@@@ -251,6 +251,7 @@@@ static PaError BoostPriority( PaUnixThread* self )
 
     assert( self );
 
+#if defined(_POSIX_THREAD_PRIORITY_SCHEDULINGG) && (_POSIX_THREAD_PRIORITY_SCHEDULING > 0)
     if( pthread_setschedparam( self->thread, SCHED_FIFO, &spm ) != 0 )
     {
         PA_UNLESS( errno == EPERM, paInternalError );  /* Lack permission to raise priority */
@@@@ -261,6 +262,7 @@@@ static PaError BoostPriority( PaUnixThread* self )
     {
         result = 1; /* Success */
     }
+#endif
 error:
     return result;
 }
@@@@ -299,8 +301,10 @@@@ PaError PaUnixThread_New( PaUnixThread* self, void* (*
 #endif
 
     PA_UNLESS( !pthread_attr_init( &attr ), paInternalError );
+#if defined(_POSIX_THREAD_PRIORITY_SCHEDULING) && (_POSIX_THREAD_PRIORITY_SCHEDULING > 0)
     /* Priority relative to other processes */
     PA_UNLESS( !pthread_attr_setscope( &attr, PTHREAD_SCOPE_SYSTEM ), paInternalError );   
+#endif
 
     PA_UNLESS( !pthread_create( &self->thread, &attr, threadFunc, threadArg ), paInternalError );
     started = 1;
@@@@ -347,7 +351,9 @@@@ PaError PaUnixThread_New( PaUnixThread* self, void* (*
         {
             int policy;
             struct sched_param spm;
+#if defined(_POSIX_THREAD_PRIORITY_SCHEDULING) && (_POSIX_THREAD_PRIORITY_SCHEDULING > 0)
             pthread_getschedparam(self->thread, &policy, &spm);
+#endif
         }
     }
     
@


1.1
log
@Add missing _POSIX_THREAD_PRIORITY_SCHEDULING checks.

from Brad
@
text
@d2 3
a4 3
--- src/os/unix/pa_unix_util.c.orig	Wed May 16 20:58:26 2012
+++ src/os/unix/pa_unix_util.c	Wed May 16 21:06:25 2012
@@@@ -218,6 +218,7 @@@@ static PaError BoostPriority( PaUnixThread* self )
d12 1
a12 1
@@@@ -228,6 +229,7 @@@@ static PaError BoostPriority( PaUnixThread* self )
d20 1
a20 1
@@@@ -266,8 +268,10 @@@@ PaError PaUnixThread_New( PaUnixThread* self, void* (*
d31 1
a31 1
@@@@ -314,7 +318,9 @@@@ PaError PaUnixThread_New( PaUnixThread* self, void* (*
@

