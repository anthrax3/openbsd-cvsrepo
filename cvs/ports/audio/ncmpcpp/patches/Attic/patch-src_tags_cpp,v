head	1.4;
access;
symbols;
locks; strict;
comment	@# @;


1.4
date	2015.07.06.06.04.57;	author dcoppa;	state dead;
branches;
next	1.3;
commitid	vhkHzVIK0Z2IZapT;

1.3
date	2015.06.19.16.23.33;	author dcoppa;	state Exp;
branches;
next	1.2;
commitid	i7FsZbeWIeuLfNOM;

1.2
date	2014.11.07.09.02.29;	author dcoppa;	state dead;
branches;
next	1.1;
commitid	AMgmx1Ybcy7ABeqd;

1.1
date	2014.11.04.10.52.25;	author dcoppa;	state Exp;
branches;
next	;
commitid	fulzChkVDvqZ6DFu;


desc
@@


1.4
log
@
Update to ncmpcpp-0.6.5
@
text
@$OpenBSD: patch-src_tags_cpp,v 1.3 2015/06/19 16:23:33 dcoppa Exp $

commit d54de65990dbe852762e5292c5b27186d16fcc02
Author: Andrzej Rybczak <electricityispower@@gmail.com>
Date:   Mon May 18 00:05:49 2015 +0200

tags: remove xiph tag DESCRIPTION as it's parsed as COMMENT by MPD

--- src/tags.cpp.orig	Sat May  2 21:16:11 2015
+++ src/tags.cpp	Fri Jun 19 16:29:53 2015
@@@@ -184,6 +184,8 @@@@ void writeXiphComments(const MPD::MutableSong &s, TagL
 	tag->removeField("TRACK");
 	// remove field DISC, some taggers use it as DISCNUMBER
 	tag->removeField("DISC");
+	// remove field DESCRIPTION, it's displayed as COMMENT
+	tag->removeField("DESCRIPTION");
 	writeXiph("TITLE", tagList(s, &MPD::Song::getTitle));
 	writeXiph("ARTIST", tagList(s, &MPD::Song::getArtist));
 	writeXiph("ALBUMARTIST", tagList(s, &MPD::Song::getAlbumArtist));
@


1.3
log
@
Merge several fixes from the '0.6.x' stable branch:

help: correct a typo
(git commit 8a5a0078e9a08f1d792299521da7482a99aba8b6)

actions: respect regular expression config when searching in text
fields
(git commit aa8c47d5782664b7d9786e1195f7950e29ee9a21)

tag editor: when numbering tracks, discard other track tags if
present
(git commit 4d4b7c542fed615cf8699e093fa8b31eacc9f7ce)

tags: remove xiph tag DESCRIPTION as it's parsed as COMMENT by MPD
(git commit d54de65990dbe852762e5292c5b27186d16fcc02)

lastfm: use sink argument and fix possible usage of m_service after
delete
(git commit 20a4e486cc36e40afc202e3794772e402b1d3c0f)

song: show name if it's available
(git commit a3d536b4228637067df9697c11bcf3434883a943)

status: fix assertion failure on window resize without active mpd
connection
(git commit 310d280cef4cc93738412efbd80ada4322df9d17)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@
Bugfixing update to ncmpcpp-0.6.1
@
text
@d1 1
a1 1
$OpenBSD: patch-src_tags_cpp,v 1.1 2014/11/04 10:52:25 dcoppa Exp $
d3 1
a3 1
commit 6402b6f9c9aad20180079d8b35f55267634028f2
d5 1
a5 1
Date:   Tue Oct 28 20:07:07 2014 +0100
d7 1
a7 1
tags: writeID3v2Tags: write comment tag properly
d9 11
a19 39
--- src/tags.cpp.orig	Sat Oct 25 17:16:07 2014
+++ src/tags.cpp	Tue Nov  4 10:32:30 2014
@@@@ -31,10 +31,12 @@@@
 #include <vorbisfile.h>
 #include <tag.h>
 #include <textidentificationframe.h>
+#include <commentsframe.h>
 #include <xiphcomment.h>
 
 #include "global.h"
 #include "settings.h"
+#include "utility/string.h"
 #include "utility/wide_string.h"
 
 namespace {//
@@@@ -151,9 +153,20 @@@@ void writeID3v2Tags(const MPD::MutableSong &s, TagLib:
 		tag->removeFrames(type);
 		if (!list.isEmpty())
 		{
-			auto frame = new TagLib::ID3v2::TextIdentificationFrame(type, TagLib::String::UTF8);
-			frame->setText(list);
-			tag->addFrame(frame);
+			if (type == "COMM") // comment needs to be handled separately
+			{
+				auto frame = new TagLib::ID3v2::CommentsFrame(TagLib::String::UTF8);
+				// apparently there can't be multiple comments,
+				// so if there is more than one, join them.
+				frame->setText(join(list, TagLib::String(Config.tags_separator, TagLib::String::UTF8)));
+				tag->addFrame(frame);
+			}
+			else
+			{
+				auto frame = new TagLib::ID3v2::TextIdentificationFrame(type, TagLib::String::UTF8);
+				frame->setText(list);
+				tag->addFrame(frame);
+			}
 		}
 	};
 	writeID3v2("TIT2", tagList(s, &MPD::Song::getTitle));
@


1.1
log
@
window: initScreen: initialize readline; fixes segmentation fault
in rl_resize_terminal on SIGWINCH
(upstream git commit 7e2900511cfa8a41984144b1be03d8108abd8798)

tags: writeID3v2Tags: write comment tag properly
(upstream git commit 6402b6f9c9aad20180079d8b35f55267634028f2)

ncmpcpp: ignore SIGPIPE, not SIGINT
(upstream git commit 9e6b8533f1606fdc2535aad88817b50b8e4ad663)
@
text
@d1 1
a1 1
$OpenBSD$
@

