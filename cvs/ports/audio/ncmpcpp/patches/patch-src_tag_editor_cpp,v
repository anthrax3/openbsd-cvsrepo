head	1.6;
access;
symbols
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.2;
locks; strict;
comment	@# @;


1.6
date	2016.11.29.11.35.00;	author dcoppa;	state Exp;
branches;
next	1.5;
commitid	e97ySGp8kUF1Mw1W;

1.5
date	2015.07.06.06.04.57;	author dcoppa;	state dead;
branches;
next	1.4;
commitid	vhkHzVIK0Z2IZapT;

1.4
date	2015.06.19.16.23.33;	author dcoppa;	state Exp;
branches;
next	1.3;
commitid	i7FsZbeWIeuLfNOM;

1.3
date	2012.03.18.17.09.27;	author dcoppa;	state dead;
branches;
next	1.2;

1.2
date	2012.02.03.11.48.52;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2011.11.29.12.07.18;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.6
log
@
Show detailed error message if writing tags fails
(upstream git commit 3868e32b9216e14247e0534061d1d02f3b8ab65d)

Show meaningful error message if MPD_PORT is not a number
(upstream git commit 8dde3944ee1878a7f26dd24bfe5e31f4e72c05b1)

lyrics: fix loading of files with DOS line endings
(upstream git commit dac0d4602f810d8f43e18beefdd43068e40308c3)

window: prevent ncurses from defining macros
(upstream git commit 6b73f0ebe1c05cb2b3b6973662e7b6c95eba4530)
@
text
@$OpenBSD$

commit 3868e32b9216e14247e0534061d1d02f3b8ab65d
Author: Andrzej Rybczak <electricityispower@@gmail.com>
Date:   Sun Nov 20 19:38:11 2016 +0100

Show detailed error message if writing tags fails

--- src/tag_editor.cpp.orig	Mon Oct 31 12:24:35 2016
+++ src/tag_editor.cpp	Tue Nov 29 11:54:04 2016
@@@@ -797,8 +797,8 @@@@ void TagEditor::runAction()
 				Statusbar::printf("Writing tags in \"%1%\"...", (*it)->getName());
 				if (!Tags::write(**it))
 				{
-					const char msg[] = "Error while writing tags in \"%1%\"";
-					Statusbar::printf(msg, wideShorten((*it)->getURI(), COLS-const_strlen(msg)).c_str());
+					Statusbar::printf("Error while writing tags to \"%1%\": %2%",
+					                  (*it)->getName(), strerror(errno));
 					success = 0;
 					break;
 				}
@


1.5
log
@
Update to ncmpcpp-0.6.5
@
text
@d1 1
a1 1
$OpenBSD: patch-src_tag_editor_cpp,v 1.4 2015/06/19 16:23:33 dcoppa Exp $
d3 1
a3 1
commit 4d4b7c542fed615cf8699e093fa8b31eacc9f7ce
d5 1
a5 1
Date:   Sat Jun 13 20:28:28 2015 +0200
d7 1
a7 2
tag editor: when numbering tracks, discard other track tags if
present
d9 13
a21 11
--- src/tag_editor.cpp.orig	Sat May  2 21:16:11 2015
+++ src/tag_editor.cpp	Fri Jun 19 16:29:25 2015
@@@@ -479,6 +479,8 @@@@ void TagEditor::enterPressed()
 					(*it)->setTrack(boost::lexical_cast<std::string>(i) + "/" + boost::lexical_cast<std::string>(EditedSongs.size()));
 				else
 					(*it)->setTrack(boost::lexical_cast<std::string>(i));
+				// discard other track number tags
+				(*it)->setTrack("", 1);
 			}
 			Statusbar::print("Tracks numbered");
 		}
@


1.4
log
@
Merge several fixes from the '0.6.x' stable branch:

help: correct a typo
(git commit 8a5a0078e9a08f1d792299521da7482a99aba8b6)

actions: respect regular expression config when searching in text
fields
(git commit aa8c47d5782664b7d9786e1195f7950e29ee9a21)

tag editor: when numbering tracks, discard other track tags if
present
(git commit 4d4b7c542fed615cf8699e093fa8b31eacc9f7ce)

tags: remove xiph tag DESCRIPTION as it's parsed as COMMENT by MPD
(git commit d54de65990dbe852762e5292c5b27186d16fcc02)

lastfm: use sink argument and fix possible usage of m_service after
delete
(git commit 20a4e486cc36e40afc202e3794772e402b1d3c0f)

song: show name if it's available
(git commit a3d536b4228637067df9697c11bcf3434883a943)

status: fix assertion failure on window resize without active mpd
connection
(git commit 310d280cef4cc93738412efbd80ada4322df9d17)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.3
log
@Update to ncmpcpp-0.5.9
@
text
@d1 1
a1 1
$OpenBSD: patch-src_tag_editor_cpp,v 1.2 2012/02/03 11:48:52 dcoppa Exp $
d3 3
a5 2
fix segfault if LocateSong is used in tag editor
(upstream git commit 70e9ebe7a309229825d157a8dd567cd4b4774a45)
d7 2
a8 2
fix going to right column when filename is highlighted in middle
one (upstream git commit 8e3b0620f0f7f00af76405c1ac5001dd8eb5885b)
d10 11
a20 54
fix going to wrong directory in tag editor
(upstream git commit 78cd46b7568e92bbecaa358bae21f3079ecf11ae)

--- src/tag_editor.cpp.orig	Tue Oct 11 21:27:41 2011
+++ src/tag_editor.cpp	Fri Feb  3 11:24:39 2012
@@@@ -39,6 +39,7 @@@@
 #include "song_info.h"
 #include "playlist.h"
 
+using Global::myScreen;
 using Global::MainHeight;
 using Global::MainStartY;
 
@@@@ -185,8 +186,6 @@@@ std::basic_string<my_char_t> TagEditor::Title()
 
 void TagEditor::SwitchTo()
 {
-	using Global::myScreen;
-	
 	if (myScreen == this)
 		return;
 	
@@@@ -809,7 +808,7 @@@@ void TagEditor::NextColumn()
 		w = TagTypes;
 		TagTypes->HighlightColor(Config.active_column_color);
 	}
-	else if (w == TagTypes && TagTypes->Choice() < 12 && !Tags->ReallyEmpty())
+	else if (w == TagTypes && TagTypes->Choice() < 13 && !Tags->ReallyEmpty())
 	{
 		TagTypes->HighlightColor(Config.main_highlight_color);
 		w->Refresh();
@@@@ -854,6 +853,9 @@@@ void TagEditor::PrevColumn()
 
 void TagEditor::LocateSong(const MPD::Song &s)
 {
+	if (myScreen == this)
+		return;
+
 	if (s.GetDirectory().empty())
 		return;
 	
@@@@ -872,7 +874,11 @@@@ void TagEditor::LocateSong(const MPD::Song &s)
 	if (itsBrowsedDir != s.GetDirectory())
 	{
 		itsBrowsedDir = s.GetDirectory();
-		itsBrowsedDir = itsBrowsedDir.substr(0, itsBrowsedDir.rfind('/'));
+		size_t last_slash = itsBrowsedDir.rfind('/');
+		if (last_slash != std::string::npos)
+			itsBrowsedDir = itsBrowsedDir.substr(0, last_slash);
+		else
+			itsBrowsedDir = "/";
 		if (itsBrowsedDir.empty())
 			itsBrowsedDir = "/";
 		Dirs->Clear();
@


1.2
log
@*** empty log message ***
@
text
@d1 1
a1 1
$OpenBSD: patch-src_tag_editor_cpp,v 1.1 2011/11/29 12:07:18 dcoppa Exp $
@


1.1
log
@Bugfixes from upstream:

in tag editor, fix going to right column when filename is highlighted
in middle one
(upstream git commit 8e3b0620f0f7f00af76405c1ac5001dd8eb5885b)

fix going to wrong directory in tag editor
(upstream git commit 78cd46b7568e92bbecaa358bae21f3079ecf11ae)

display more detailed info if connection to MPD couldn't be
estabilished (upstream git commit 62157909d5d2008b90bef74a21fdab164f391728)
@
text
@d1 4
a4 1
$OpenBSD$
d13 19
a31 2
+++ src/tag_editor.cpp	Tue Nov 29 12:26:46 2011
@@@@ -809,7 +809,7 @@@@ void TagEditor::NextColumn()
d40 11
a50 1
@@@@ -872,7 +872,11 @@@@ void TagEditor::LocateSong(const MPD::Song &s)
@

