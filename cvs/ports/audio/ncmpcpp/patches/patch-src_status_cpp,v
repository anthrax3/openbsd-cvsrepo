head	1.8;
access;
symbols
	OPENBSD_6_2:1.8.0.2
	OPENBSD_6_2_BASE:1.8
	OPENBSD_6_1:1.6.0.8
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.6.0.6
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.2
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.4
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.3.0.8
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.6
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.2;
locks; strict;
comment	@# @;


1.8
date	2017.08.31.15.58.26;	author dcoppa;	state Exp;
branches;
next	1.7;
commitid	kKZxlJKCqJYAbdxf;

1.7
date	2017.06.09.15.09.51;	author dcoppa;	state Exp;
branches;
next	1.6;
commitid	DKD7n5H8P40ztgwn;

1.6
date	2015.07.06.06.04.57;	author dcoppa;	state Exp;
branches;
next	1.5;
commitid	vhkHzVIK0Z2IZapT;

1.5
date	2015.06.19.16.23.33;	author dcoppa;	state Exp;
branches;
next	1.4;
commitid	i7FsZbeWIeuLfNOM;

1.4
date	2014.10.27.08.30.20;	author dcoppa;	state Exp;
branches;
next	1.3;
commitid	86rVHxEf8nbwRlNz;

1.3
date	2012.10.25.13.43.42;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2012.03.18.17.09.27;	author dcoppa;	state dead;
branches;
next	1.1;

1.1
date	2011.12.30.10.10.16;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.8
log
@
Fix intermittent failures when using --quiet.
Using '--quiet' command line argument no longer results in a crash
(upstream git commit db28618929b9ec11e831d5a44437757f6195497d)

Mark songs as added to playlist immediately.
Fix a situation in which songs added to playlist from media library
or playlist editor screens would not be immediately marked as such
(upstream git commit c340a6ba9a322985b8d50ab477631689b6b8f55a)
@
text
@$OpenBSD: patch-src_status_cpp,v 1.7 2017/06/09 15:09:51 dcoppa Exp $

missing header

commit c340a6ba9a322985b8d50ab477631689b6b8f55a
Author: Andrzej Rybczak <andrzej@@rybczak.net>
Date:   Thu Aug 31 08:19:13 2017

Mark songs as added to playlist immediately

Index: src/status.cpp
--- src/status.cpp.orig
+++ src/status.cpp
@@@@ -21,6 +21,7 @@@@
 #include <boost/date_time/posix_time/posix_time.hpp>
 #include <netinet/tcp.h>
 #include <netinet/in.h>
+#include <sys/socket.h>
 
 #include "curses/menu_impl.h"
 #include "screens/browser.h"
@@@@ -439,6 +440,13 @@@@ void Status::Changes::playlist(unsigned previous_versi
 
 	myPlaylist->reloadTotalLength();
 	myPlaylist->reloadRemaining();
+
+	if (isVisible(myLibrary)
+	    && !myLibrary->isActiveWindow(myLibrary->Songs))
+		myLibrary->Songs.refresh();
+	if (isVisible(myPlaylistEditor)
+	    && !myPlaylistEditor->isActiveWindow(myPlaylistEditor->Content))
+		myPlaylistEditor->Content.refresh();
 }
 
 void Status::Changes::storedPlaylists()
@


1.7
log
@
Update to ncmpcpp-0.8
@
text
@d1 1
a1 1
$OpenBSD: patch-src_status_cpp,v 1.6 2015/07/06 06:04:57 dcoppa Exp $
d5 6
d22 14
@


1.6
log
@
Update to ncmpcpp-0.6.5
@
text
@d1 1
a1 1
$OpenBSD: patch-src_status_cpp,v 1.5 2015/06/19 16:23:33 dcoppa Exp $
d5 3
a7 2
--- src/status.cpp.orig	Sat May  2 21:16:11 2015
+++ src/status.cpp	Fri Jun 19 16:32:23 2015
d14 2
a15 2
 #include "browser.h"
 #include "charset.h"
@


1.5
log
@
Merge several fixes from the '0.6.x' stable branch:

help: correct a typo
(git commit 8a5a0078e9a08f1d792299521da7482a99aba8b6)

actions: respect regular expression config when searching in text
fields
(git commit aa8c47d5782664b7d9786e1195f7950e29ee9a21)

tag editor: when numbering tracks, discard other track tags if
present
(git commit 4d4b7c542fed615cf8699e093fa8b31eacc9f7ce)

tags: remove xiph tag DESCRIPTION as it's parsed as COMMENT by MPD
(git commit d54de65990dbe852762e5292c5b27186d16fcc02)

lastfm: use sink argument and fix possible usage of m_service after
delete
(git commit 20a4e486cc36e40afc202e3794772e402b1d3c0f)

song: show name if it's available
(git commit a3d536b4228637067df9697c11bcf3434883a943)

status: fix assertion failure on window resize without active mpd
connection
(git commit 310d280cef4cc93738412efbd80ada4322df9d17)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_status_cpp,v 1.4 2014/10/27 08:30:20 dcoppa Exp $
a4 7
commit 310d280cef4cc93738412efbd80ada4322df9d17
Author: Andrzej Rybczak <electricityispower@@gmail.com>
Date:   Sat Jun 13 20:55:09 2015 +0200

status: fix assertion failure on window resize without active mpd
connection

a14 9
@@@@ -557,7 +558,7 @@@@ void Status::Changes::elapsedTime(bool update_elapsed)
 		m_kbps = st.kbps();
 	}
 
-	if (m_player_state == MPD::psStop)
+	if (m_player_state == MPD::psUnknown || m_player_state == MPD::psStop)
 	{
 		if (Statusbar::isUnlocked() && Config.statusbar_visibility)
 			*wFooter << NC::XY(0, 1) << wclrtoeol;
@


1.4
log
@
Update to ncmpcpp-0.6
@
text
@d1 1
a1 1
$OpenBSD: patch-src_status_cpp,v 1.3 2012/10/25 13:43:42 dcoppa Exp $
d5 9
a13 2
--- src/status.cpp.orig	Mon Oct 27 07:07:10 2014
+++ src/status.cpp	Mon Oct 27 07:07:54 2014
d22 9
@


1.3
log
@- Check return values of system() calls (stolen from ubuntu)
- Fix manpage errors and remove USE_GROFF
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
Check return values of system() call
d5 10
a14 12
--- src/status.cpp.orig	Sun Apr  1 18:49:09 2012
+++ src/status.cpp	Thu Oct 25 15:14:57 2012
@@@@ -401,7 +401,8 @@@@ void NcmpcppStatusChanged(MPD::Connection *, MPD::Stat
 		if (myPlaylist->isPlaying())
 		{
 			if (!Config.execute_on_song_change.empty())
-				system(Config.execute_on_song_change.c_str());
+				if (system(Config.execute_on_song_change.c_str()) < 0)
+					ShowMessage("Couldn't execute \"%s\"", Config.execute_on_song_change.c_str());
 			
 #			ifdef HAVE_CURL_CURL_H
 			if (Config.fetch_lyrics_in_background)
@


1.2
log
@Update to ncmpcpp-0.5.9
@
text
@d1 1
a1 1
$OpenBSD: patch-src_status_cpp,v 1.1 2011/12/30 10:10:16 dcoppa Exp $
d3 1
a3 3
Bugfix: dollar sign in song title changes interface text colors
(upstream git commit e8f08ea8844ca878cc159babb68c033278d5b270)
cf. http://musicpd.org/mantis/view.php?id=3409
d5 12
a16 22
--- src/status.cpp.orig	Tue Oct 11 21:27:41 2011
+++ src/status.cpp	Fri Dec 30 10:45:05 2011
@@@@ -445,8 +445,8 @@@@ void NcmpcppStatusChanged(MPD::Connection *, MPD::Stat
 				}
 				
 				basic_buffer<my_char_t> first, second;
-				String2Buffer(TO_WSTRING(utf_to_locale_cpy(np.toString(Config.new_header_first_line))), first);
-				String2Buffer(TO_WSTRING(utf_to_locale_cpy(np.toString(Config.new_header_second_line))), second);
+				String2Buffer(TO_WSTRING(utf_to_locale_cpy(np.toString(Config.new_header_first_line, "$"))), first);
+				String2Buffer(TO_WSTRING(utf_to_locale_cpy(np.toString(Config.new_header_second_line, "$"))), second);
 				
 				size_t first_len = Window::Length(first.Str());
 				size_t first_margin = (std::max(tracklength.length()+1, VolumeState.length()))*2;
@@@@ -497,7 +497,7 @@@@ void NcmpcppStatusChanged(MPD::Connection *, MPD::Stat
 					tracklength += "]";
 				}
 				basic_buffer<my_char_t> np_song;
-				String2Buffer(TO_WSTRING(utf_to_locale_cpy(np.toString(Config.song_status_format))), np_song);
+				String2Buffer(TO_WSTRING(utf_to_locale_cpy(np.toString(Config.song_status_format, "$"))), np_song);
 				*wFooter << XY(0, 1) << wclrtoeol << player_state << fmtBoldEnd;
 				np_song.Write(*wFooter, playing_song_scroll_begin, wFooter->GetWidth()-player_state.length()-tracklength.length(), U(" ** "));
 				*wFooter << fmtBold << XY(wFooter->GetWidth()-tracklength.length(), 1) << tracklength;
@


1.1
log
@Bugfix: dollar sign in song title changes interface text colors
(upstream git commit e8f08ea8844ca878cc159babb68c033278d5b270)
cf. http://musicpd.org/mantis/view.php?id=3409
@
text
@d1 1
a1 1
$OpenBSD$
@

