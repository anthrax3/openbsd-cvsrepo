head	1.9;
access;
symbols
	OPENBSD_6_2:1.9.0.10
	OPENBSD_6_2_BASE:1.9
	OPENBSD_6_1:1.9.0.8
	OPENBSD_6_1_BASE:1.9
	OPENBSD_6_0:1.9.0.6
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.9.0.2
	OPENBSD_5_9_BASE:1.9
	OPENBSD_5_8:1.9.0.4
	OPENBSD_5_8_BASE:1.9
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	robert_20110925:1.1.1.1
	robert:1.1.1;
locks; strict;
comment	@# @;


1.9
date	2015.04.05.10.12.34;	author ajacoutot;	state Exp;
branches;
next	1.8;
commitid	ev3yKjGwHUSvx7iT;

1.8
date	2015.04.04.15.37.12;	author ajacoutot;	state Exp;
branches;
next	1.7;
commitid	jIxy8N41tKoKdllt;

1.7
date	2015.03.15.08.45.10;	author ajacoutot;	state Exp;
branches;
next	1.6;
commitid	3LmgQSBTsxkLqVn8;

1.6
date	2014.08.14.12.57.09;	author ajacoutot;	state Exp;
branches;
next	1.5;
commitid	T2jkXrMVjBkrm2eR;

1.5
date	2013.01.05.18.06.31;	author ajacoutot;	state dead;
branches;
next	1.4;

1.4
date	2012.11.27.19.29.54;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2011.10.01.08.37.30;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2011.09.25.09.43.36;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2011.09.25.09.30.52;	author robert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.09.25.09.30.52;	author robert;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Unbreak runtime by moving the ifdef OpenBSD block were it will match
before other blocks.
@
text
@$OpenBSD: patch-src_pulse_util_c,v 1.8 2015/04/04 15:37:12 ajacoutot Exp $

Implement pa_get_binary_name().

--- src/pulse/util.c.orig	Thu Feb 12 15:10:35 2015
+++ src/pulse/util.c	Sun Apr  5 11:46:45 2015
@@@@ -52,6 +52,11 @@@@
 #include <sys/sysctl.h>
 #endif
 
+#ifdef __OpenBSD__
+#include <libgen.h>
+#include <sys/sysctl.h>
+#endif
+
 #include <pulse/xmalloc.h>
 #include <pulse/timeval.h>
 
@@@@ -224,6 +229,30 @@@@ char *pa_get_binary_name(char *s, size_t l) {
         }
     }
 #endif
+
+#ifdef __OpenBSD__
+    {
+        size_t len;
+        char **buf;
+
+        int mib[] = { CTL_KERN, KERN_PROC_ARGS, getpid(), KERN_PROC_ARGV };
+
+        if (sysctl (mib, 4, NULL, &len, NULL, 0) == -1)
+            return NULL;
+
+        buf = (char *) pa_xmalloc(len);
+
+        if (sysctl(mib, 4, buf, &len, NULL, 0) == 0) {
+            pa_strlcpy(s, basename(*buf), l);
+            pa_xfree(buf);
+            return s;
+        }
+
+        pa_xfree(buf);
+
+        /* fall thru */
+    }
+#endif /* __OpenBSD__ */
 
 #if defined(HAVE_DLADDR) && defined(PA_GCC_WEAKREF)
     {
@


1.8
log
@Tweak our patch a bit.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_pulse_util_c,v 1.7 2015/03/15 08:45:10 ajacoutot Exp $
d6 1
a6 1
+++ src/pulse/util.c	Sat Apr  4 17:36:33 2015
d19 2
a20 2
@@@@ -277,6 +282,30 @@@@ char *pa_get_binary_name(char *s, size_t l) {
         /* fall thru */
d22 1
a22 1
 #endif /* OS_IS_DARWIN */
d48 2
a49 2
     errno = ENOENT;
     return NULL;
@


1.7
log
@Update to pulseaudio-6.0.

ok robert@@ (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_pulse_util_c,v 1.6 2014/08/14 12:57:09 ajacoutot Exp $
d6 1
a6 1
+++ src/pulse/util.c	Mon Feb 16 14:45:37 2015
d19 1
a19 1
@@@@ -277,6 +282,25 @@@@ char *pa_get_binary_name(char *s, size_t l) {
a25 1
+        int mib[] = { CTL_KERN, KERN_PROC_ARGS, getpid(), KERN_PROC_ARGV };
d29 6
a34 2
+        sysctl(mib, 4, NULL, &len, NULL, 0);
+        buf = (char **) pa_xmalloc(len);
d41 2
@


1.6
log
@Implement pa_get_binary_name().

ok robert@@ (maintainer)
@
text
@d1 1
a1 1
$OpenBSD$
d5 3
a7 3
--- src/pulse/util.c.orig	Tue Jan 21 14:39:57 2014
+++ src/pulse/util.c	Thu Aug 14 14:24:07 2014
@@@@ -54,6 +54,11 @@@@
d19 1
a19 1
@@@@ -244,6 +249,25 @@@@ char *pa_get_binary_name(char *s, size_t l) {
@


1.5
log
@Remove bogus patch.
@
text
@d1 9
a9 6
$OpenBSD: patch-src_pulse_util_c,v 1.4 2012/11/27 19:29:54 ajacoutot Exp $
--- src/pulse/util.c.orig	Mon Sep 26 17:51:42 2011
+++ src/pulse/util.c	Tue Nov 27 20:14:35 2012
@@@@ -33,6 +33,10 @@@@
 #include <unistd.h>
 #include <sys/types.h>
d12 2
a13 1
+extern char *__progname;
d16 7
a22 9
 #ifdef HAVE_PWD_H
 #include <pwd.h>
 #endif
@@@@ -203,6 +207,13 @@@@ char *pa_get_binary_name(char *s, size_t l) {
             pa_xfree(rp);
             return s;
         }
+    }
+#endif
d26 16
a41 4
+        s = __progname;
+        return s;
     }
 #endif
d43 2
@


1.4
log
@Use __progname for pa_get_binary_name().
Remove useless patches.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_pulse_util_c,v 1.3 2011/10/01 08:37:30 ajacoutot Exp $
@


1.3
log
@Update to pulseaudio-1.0.

Some refactoring: only enable what we really need (that is ossaudio(4)
for mixer control and events playing) -- disable everything else (avahi,
dbus, consolekit, x11, gconf...)

ok robert@@ (maintainer)
@
text
@d1 6
a6 6
$OpenBSD: patch-src_pulse_util_c,v 1.2 2011/09/25 09:43:36 ajacoutot Exp $
--- src/pulse/util.c.orig	Thu Sep  1 10:28:14 2011
+++ src/pulse/util.c	Fri Sep 30 14:50:32 2011
@@@@ -206,6 +206,13 @@@@ char *pa_get_binary_name(char *s, size_t l) {
     }
 #endif
d9 10
a18 3
+    {
+        s = "${TRUEPREFIX}/bin/pulseaudio";
+        return s;
d22 6
a27 2
 #if defined(HAVE_SYS_PRCTL_H) && defined(PR_GET_NAME)
     {
@


1.2
log
@LOCALBASE -> TRUEPREFIX
@
text
@d1 5
a5 5
$OpenBSD: patch-src_pulse_util_c,v 1.1.1.1 2011/09/25 09:30:52 robert Exp $
--- src/pulse/util.c.orig	Thu Jun 23 22:18:54 2011
+++ src/pulse/util.c	Wed Sep 21 13:03:15 2011
@@@@ -192,6 +192,13 @@@@ char *pa_get_binary_name(char *s, size_t l) {
 
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d10 1
a10 1
+        s = "${LOCALBASE}/bin/pulseaudio";
@


1.1.1.1
log
@import of pulseaudio 0.9.23 a cross-platform networked sound-server
many fixes from jasper@@ and me.
@
text
@@
