head	1.2;
access;
symbols
	OPENBSD_6_2:1.2.0.28
	OPENBSD_6_2_BASE:1.2
	OPENBSD_6_1:1.2.0.26
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.24
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.20
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.22
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.18
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.16
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.14
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.12
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.10
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.8
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.6
	OPENBSD_5_0:1.2.0.4
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.2
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2011.02.10.03.14.43;	author jakemsr;	state Exp;
branches;
next	1.1;

1.1
date	2010.06.03.16.09.37;	author pea;	state Exp;
branches;
next	;


desc
@@


1.2
log
@fix crash in the libao backend.  set the 'matrix' member of struct
ao_sample_format to NULL before passing the structure to libao functions.

ok espie@@, ajacoutot@@, naddy@@
@
text
@$OpenBSD: patch-src_plugins_ao_ao_c,v 1.1 2010/06/03 16:09:37 pea Exp $

explicitely set the 'char *matrix' member of ao_sample_format to NULL
instead of letting it be some random junk.

--- src/plugins/ao/ao.c.orig	Fri Feb 19 09:43:54 2010
+++ src/plugins/ao/ao.c	Sun Feb  6 11:13:39 2011
@@@@ -166,6 +166,7 @@@@ xmms_ao_new (xmms_output_t *output)
 		format.rate = 44100;
 		format.channels = 2;
 		format.byte_format = AO_FMT_NATIVE;
+		format.matrix = NULL;
 
 		device = ao_open_live (data->driver_id, &format, data->options);
 		if (!device && errno == AO_EOPENDEVICE) {
@@@@ -354,6 +355,7 @@@@ xmms_ao_try_format (gint driver_id, ao_option *options
 	fmt->channels = channels;
 	fmt->rate = samplerate;
 	fmt->byte_format = AO_FMT_NATIVE;
+	fmt->matrix = NULL;
 
 	return TRUE;
 }
@


1.1
log
@Fix after recent libao update

ok naddy@@
@
text
@d1 8
a8 9
$OpenBSD$
--- src/plugins/ao/ao.c.orig	Mon May 17 16:03:33 2010
+++ src/plugins/ao/ao.c	Mon May 17 16:07:34 2010
@@@@ -162,6 +162,7 @@@@ xmms_ao_new (xmms_output_t *output)
 
 		/* let's just use some common format to check if the device
 		 * name is valid */
+		memset(&format, 0, sizeof(format));
 		format.bits = 16;
d11 13
@

