head	1.1;
access;
symbols
	OPENBSD_6_0:1.1.0.16
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.12
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.14
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.10
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.8
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.6
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.4
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.2
	OPENBSD_5_3_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2013.01.17.13.30.32;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Update to grip-3.3.1.
Big clean-up while here.
@
text
@$OpenBSD$

buffer overflow detected when writing ID3v2 tags:
https://bugs.gentoo.org/show_bug.cgi?id=285105

--- src/id3.c.orig	Sat Jun 25 20:00:55 2005
+++ src/id3.c	Thu Jan 17 13:50:37 2013
@@@@ -252,8 +252,8 @@@@ gboolean ID3v2TagFile(char *filename, char *title, cha
       
       if ( frames[ i ] ) {
 	char *c_data = NULL;
-	char gen[ 5 ] = "(   )";
-	char trk[ 4 ] = "   ";
+	char gen[ 6 ] = "(   )"; /* max unsigned char: 255 */
+	char trk[ 3 ] = "  "; /* max CDDA tracks: 99 */
 	
 	switch( frameids[ i ] ) {
 	case ID3FID_TITLE:
@@@@ -278,12 +278,12 @@@@ gboolean ID3v2TagFile(char *filename, char *title, cha
 	  
 	case ID3FID_CONTENTTYPE:
 	  c_data = gen;
-	  sprintf( gen, "(%d)", genre ); /* XXX */
+	  snprintf( gen, 6, "(%d)", genre );
 	  break;
 	  
 	case ID3FID_TRACKNUM:
 	  c_data = trk;
-	  sprintf( trk, "%d", tracknum ); /* XXX */
+	  snprintf( trk, 3, "%d", tracknum );
 	  break;
 	  
 	default:
@
