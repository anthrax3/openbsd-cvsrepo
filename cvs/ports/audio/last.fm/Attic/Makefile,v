head	1.21;
access;
symbols
	OPENBSD_5_3:1.19.0.2
	OPENBSD_5_3_BASE:1.19
	OPENBSD_5_2:1.15.0.2
	OPENBSD_5_2_BASE:1.15
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.2
	OPENBSD_5_0:1.11.0.2
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.6.0.2
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2
	dcoppa_20100531:1.1.1.1
	dcoppa:1.1.1;
locks; strict;
comment	@# @;


1.21
date	2013.05.28.10.03.00;	author dcoppa;	state dead;
branches;
next	1.20;

1.20
date	2013.03.10.22.55.03;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2013.02.01.16.04.02;	author dcoppa;	state Exp;
branches;
next	1.18;

1.18
date	2013.01.04.15.50.26;	author dcoppa;	state Exp;
branches;
next	1.17;

1.17
date	2012.10.24.14.57.59;	author dcoppa;	state Exp;
branches;
next	1.16;

1.16
date	2012.09.18.20.39.25;	author dcoppa;	state Exp;
branches;
next	1.15;

1.15
date	2012.04.12.09.15.40;	author dcoppa;	state Exp;
branches;
next	1.14;

1.14
date	2011.10.18.12.17.26;	author dcoppa;	state Exp;
branches;
next	1.13;

1.13
date	2011.09.19.12.50.57;	author dcoppa;	state Exp;
branches;
next	1.12;

1.12
date	2011.09.16.08.26.10;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2011.06.08.15.19.13;	author dcoppa;	state Exp;
branches;
next	1.10;

1.10
date	2011.04.20.05.12.01;	author dcoppa;	state Exp;
branches;
next	1.9;

1.9
date	2011.03.31.07.47.09;	author dcoppa;	state Exp;
branches;
next	1.8;

1.8
date	2011.03.30.20.51.12;	author dcoppa;	state Exp;
branches;
next	1.7;

1.7
date	2011.03.30.14.00.48;	author dcoppa;	state Exp;
branches;
next	1.6;

1.6
date	2010.11.15.13.08.37;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2010.11.15.00.22.47;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2010.10.24.21.00.29;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.09.06.00.04.28;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2010.06.01.05.21.11;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2010.05.31.19.37.36;	author dcoppa;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.05.31.19.37.36;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.21
log
@Bye bye last.fm: marked broken since four months and nobody cared.
@
text
@# $OpenBSD: Makefile,v 1.20 2013/03/10 22:55:03 espie Exp $

BROKEN =		no support for the new Last.fm API v2.0

COMMENT =		official Last.fm client

VER =			1.5.4.27091
DISTNAME =		lastfm-${VER}+dfsg
PKGNAME =		last.fm-${VER}
REVISION =		9

SHARED_ONLY =		Yes

SHARED_LIBS =		Moose 0.0 \
			LastFmTools 0.0

CATEGORIES =		audio

HOMEPAGE =		http://www.last.fm/

MASTER_SITES =		http://dev.gentoo.org/~hwoarang/distfiles/

DISTFILES =		${DISTNAME}${EXTRACT_SUFX} \
			dbusextension-2.0.tar.bz2

DIST_SUBDIR =		lastfm

# GPLv2
PERMIT_PACKAGE_CDROM =	Yes

WANTLIB =		ICE QtDBus QtGui QtNetwork QtSql \
			QtXml SM X11 Xext Xi Xinerama Xrender \
			c fontconfig freetype gpod>=700 m mad \
			portaudio pthread sndio stdc++ z

MODULES =		x11/qt4

LIB_DEPENDS =		audio/libgpod \
			audio/libmad \
			audio/portaudio-svn \
			${MODQT4_LIB_DEPENDS}>=4.7.2

RUN_DEPENDS =		devel/desktop-file-utils \
			devel/xdg-utils

NO_TEST =		Yes

LASTFM_LIBDIR = ${PREFIX}/lib/last.fm
LASTFM_DATADIR = ${PREFIX}/share/last.fm
MOOSELIB = ${WRKBUILD}/bin/libMoose.so.${LIBMoose_VERSION}
TOOLSLIB = ${WRKBUILD}/bin/libLastFmTools.so.${LIBLastFmTools_VERSION}

post-extract:
	mv ${WRKDIR}/dbus ${WRKSRC}/src/extensions/

pre-patch:
	cd ${WRKSRC}; perl -pi -e "s/\r$$//"\
	 `find . -type f -name *.h -or -name *.cpp -or -name '*.pro*'`

pre-configure:
	${SUBST_CMD} \
	${WRKSRC}/src/libMoose/libMoose.pro \
	${WRKSRC}/src/libMoose/MooseCommon.cpp \
	${WRKSRC}/src/libUnicorn/libUnicorn.pro \
	${WRKSRC}/src/mediadevices/ipod/ipod.pro \
	${WRKSRC}/src/output/portAudio/portAudio.pro \
	${WRKSRC}/src/src.pro \
	${WRKSRC}/src/transcode/mad/mad.pro

do-configure:
	perl -pi -e "s/!!CXXFLAGS!!/${CXXFLAGS}/" \
		${WRKSRC}/src/libUnicorn/unicorn.pro.inc
	cd ${WRKBUILD} && QTDIR=${WRKDIR}/bin qmake4 -config release
	cd ${WRKBUILD}/src/extensions/dbus && \
		QTDIR=${WRKDIR}/bin qmake4 dbusextension.pro

post-build:
	cd ${WRKBUILD}/src/extensions/dbus && \
		exec ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} \
			${MAKE_FLAGS} -f ${MAKE_FILE} all

do-install:
	${INSTALL_PROGRAM} ${WRKBUILD}/bin/last.fm ${PREFIX}/bin/last.fm
	${INSTALL_DATA} ${MOOSELIB} ${PREFIX}/lib/
	${INSTALL_DATA} ${TOOLSLIB} ${PREFIX}/lib/
	${INSTALL_DATA_DIR} ${LASTFM_LIBDIR}/extensions
	${INSTALL_DATA} ${WRKBUILD}/bin/extensions/*.so \
		${LASTFM_LIBDIR}/extensions/
	${INSTALL_DATA_DIR} ${LASTFM_LIBDIR}/services
	${INSTALL_DATA} ${WRKBUILD}/bin/services/*.so \
		${LASTFM_LIBDIR}/services/
	${INSTALL_DATA_DIR} ${LASTFM_DATADIR}
	${INSTALL_DATA_DIR} ${LASTFM_DATADIR}/buttons
	${INSTALL_DATA_DIR} ${LASTFM_DATADIR}/icons
	${INSTALL_DATA_DIR} ${LASTFM_DATADIR}/i18n
	${INSTALL_DATA} ${WRKBUILD}/bin/data/*.{gif,mng,png} \
		${LASTFM_DATADIR}/
	${INSTALL_DATA} ${WRKBUILD}/bin/data/buttons/*.png \
		${LASTFM_DATADIR}/buttons/
	${INSTALL_DATA} ${WRKBUILD}/bin/data/icons/*.png \
		${LASTFM_DATADIR}/icons/
	${INSTALL_DATA} ${FILESDIR}/*.png ${LASTFM_DATADIR}/icons/
	cd ${WRKBUILD}/i18n && ${LOCALBASE}/bin/lrelease4 *.ts
	${INSTALL_DATA} ${WRKBUILD}/i18n/*.qm \
		${LASTFM_DATADIR}/i18n/
	${INSTALL_DATA_DIR} ${PREFIX}/share/applications
	${SUBST_CMD} -o ${SHAREOWN} -g ${SHAREGRP} \
		-c ${FILESDIR}/lastfm.desktop \
		${PREFIX}/share/applications/lastfm.desktop

.include <bsd.port.mk>
@


1.20
log
@PERMIT/REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2013/02/01 16:04:02 dcoppa Exp $
@


1.19
log
@Mark as broken: no support for the new Last.fm Web Services API v2.0

OK sthen@@, ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2013/01/04 15:50:26 dcoppa Exp $
a29 3
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM =Yes
PERMIT_DISTFILES_FTP =	Yes
d46 1
a46 1
NO_REGRESS =		Yes
@


1.18
log
@Drop maintainership
Last.fm is no longer able to provide radio streaming to my country
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.17 2012/10/24 14:57:59 dcoppa Exp $
@


1.17
log
@Add the dbus extension by Ken Rossato <rossatok@@umd.edu>.
This extension provides an MPRIS interface for controlling Last.fm
through D-Bus.

While here, fix some (portswise) inaccuracies.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2012/09/18 20:39:25 dcoppa Exp $
d8 1
a8 1
REVISION =		8
a15 2

MAINTAINER =		David Coppa <dcoppa@@openbsd.org>
@


1.16
log
@The desktop entry created for the last.fm player did not support
passing arguments, but this is needed when attempting to launch the
last.fm player from a browser via the uri handler (last.fm radio
links).
Fix it by replacing the "Exec=last.fm" line with "Exec=last.fm %U".

From gentoo linux
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2012/04/12 09:15:40 dcoppa Exp $
d8 1
a8 1
REVISION =		7
d21 6
a26 2
MASTER_SITES =		http://dev.gentoo.org/~hwoarang/distfiles/ \
			http://ftp.pardus.org.tr/pub/source/corporate2/
d34 2
a35 2
WANTLIB =		ICE QtGui>=8 QtNetwork>=7 QtSql>=7 \
			QtXml>=7 SM X11 Xext Xi Xinerama Xrender \
d56 3
d76 8
a83 1
	cd ${WRKDIST} && ${LOCALBASE}/bin/qmake4 -config release
d90 2
@


1.15
log
@Garbage collect patches/patch-src_playerlistener_cpp: it works fine
now that we have rthreads.

While here, fix WANTLIB.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/10/18 12:17:26 dcoppa Exp $
d8 1
a8 1
REVISION =		6
@


1.14
log
@Reduce linkage: make sure the binaries only link to the libraries
they really need
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/09/19 12:50:57 dcoppa Exp $
d8 1
a8 1
REVISION =		5
d30 4
a33 3
WANTLIB += X11 c m pthread sndio stdc++ z
WANTLIB += QtGui>=8 QtNetwork>=7 QtSql>=7
WANTLIB += QtXml>=7 gpod>=700 mad portaudio
@


1.13
log
@
The Unix (linux) client does not do fingerprinting, so don't build
it: this reduces package dependencies (dropped audio/libsamplerate
and math/fftw3).

iPods were identified by a directory timestamp, but it changed each
time the ipod was mounted. Instead identify a device by its
FirewireGuid.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/09/16 08:26:10 espie Exp $
d8 1
a8 1
REVISION =		4
@


1.12
log
@normalize pkgpath in bsd.port.mk
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/06/08 15:19:13 dcoppa Exp $
d8 1
a8 1
REVISION =		3
d13 1
a13 2
			LastFmTools 0.0 \
			LastFmFingerprint 0.0
d31 2
a32 2
WANTLIB += QtGui>=8 QtNetwork>=7 QtSql>=7 QtXml>=7
WANTLIB += fftw3f>=4 gpod>=600 mad samplerate>=1 portaudio
a37 1
			audio/libsamplerate \
a38 1
			math/fftw3,float \
a49 2
FPLIB = \
${WRKBUILD}/bin/libLastFmFingerprint.so.${LIBLastFmFingerprint_VERSION}
a56 2
	${WRKSRC}/src/libFingerprint/fplib/pro_qmake/fplib.pro \
	${WRKSRC}/src/libFingerprint/libFingerprint.pro \
a73 1
	${INSTALL_DATA} ${FPLIB} ${PREFIX}/lib/
@


1.11
log
@Better icon (48x48 instead of 32x32); small fixes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/04/20 05:12:01 dcoppa Exp $
d8 1
a8 1
REVISION =		2
@


1.10
log
@Tighten dependency on qt4>=4.7.2: on sparc64 last.fm crashes at
startup when using qt-4.7.0.

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/03/31 07:47:09 dcoppa Exp $
d8 1
a8 1
REVISION =		1
d82 1
@


1.9
log
@Add a backup site to MASTER_SITES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2011/03/30 20:51:12 dcoppa Exp $
d8 1
a8 1
REVISION =		0
d37 1
a37 2
LIB_DEPENDS =		math/fftw3,float \
			audio/libgpod \
d40 4
a43 1
			audio/portaudio-svn
@


1.8
log
@Install i18n language files
Get rid of the useless MS Windows icon (as.ico)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2011/03/30 14:00:48 dcoppa Exp $
d22 2
a23 1
MASTER_SITES =		http://dev.gentoo.org/~hwoarang/distfiles/
@


1.7
log
@Update to last.fm 1.5.4.27091

Still happy with gcc 3.3.5

Tested on sparc64 and i386
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/11/15 13:08:37 espie Exp $
d8 1
d85 1
d90 1
a90 1
	${INSTALL_DATA} ${WRKBUILD}/bin/data/icons/*.{ico,png} \
d93 3
@


1.6
log
@missed libspecs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/11/15 00:22:47 espie Exp $
d5 3
a7 4
DISTNAME =		last.fm-1.4.2.58240.src
EXTRACT_SUFX =		.tar.bz2
PKGNAME =		${DISTNAME:S/.src//}
REVISION =		0
d21 1
a21 1
MASTER_SITES =		${HOMEPAGE:S/www./cdn./}client/src/
d40 2
a41 2
RUN_DEPENDS =		devel/desktop-file-utils

a44 4
CONFIGURE_STYLE =	simple

WRKDIST =		${WRKDIR}/${DISTNAME:S/.src//}

d53 2
a54 2
	cd ${WRKSRC}; perl -i -pe 's/\r$$//' \
		`find . -type f -name *.h -or -name *.cpp`
a57 1
	${WRKSRC}/src/container.cpp \
d67 5
a71 3
# Use system portaudio.h
	@@rm -f \
	${WRKSRC}/src/output/portAudio/PortAudio/include/portaudio.h
d92 3
a94 7
	${INSTALL_DATA} ${FILESDIR}/lastfm.desktop \
		${PREFIX}/share/applications/

post-install:
	${SUBST_CMD} ${PREFIX}/share/applications/lastfm.desktop
	@@rm -f \
	${PREFIX}/share/applications/lastfm.desktop.beforesubst
@


1.5
log
@convert to new style depends
zap default spec that are not needed
convert libspecs as well
convert p* to REVISION.

No package changes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/10/24 21:00:29 ajacoutot Exp $
d31 2
a32 2
WANTLIB += QtGui.>=8 QtNetwork.>=7 QtSql.>=7 QtXml.>=7
WANTLIB += fftw3f.>=4 gpod.>=600.0 mad samplerate.>=1 portaudio
@


1.4
log
@Remove USE_X11.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/09/06 00:04:28 sthen Exp $
d36 6
a41 7
LIB_DEPENDS =		::x11/qt4 \
			::math/fftw3,float \
			::audio/libgpod \
			::audio/libmad \
			::audio/libsamplerate \
			::audio/portaudio-svn
RUN_DEPENDS =		::devel/desktop-file-utils
@


1.3
log
@new-style REVISIONS/LIB_DEPENDS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/06/01 05:21:11 dcoppa Exp $
a43 1
USE_X11 =		Yes
@


1.2
log
@Add missing runtime dependency on devel/desktop-file-utils, spotted
by ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/05/31 19:37:36 dcoppa Exp $
d7 2
a8 1
PKGNAME =		${DISTNAME:S/.src//}p0
d30 3
a32 1
WANTLIB =		X11 c m pthread sndio stdc++ z
d36 6
a41 6
LIB_DEPENDS =		QtGui.>=8,QtNetwork.>=7,QtSql.>=7,QtXml.>=7::x11/qt4 \
			fftw3f.>=4::math/fftw3,float \
			gpod.>=600.0::audio/libgpod \
			mad::audio/libmad \
			samplerate.>=1::audio/libsamplerate \
			portaudio::audio/portaudio-svn
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d7 1
a7 1
PKGNAME =		${DISTNAME:S/.src//}
d39 1
@


1.1.1.1
log
@Import audio/last.fm, the official Last.fm radio player application.

OK steven@@, sthen@@
@
text
@@
