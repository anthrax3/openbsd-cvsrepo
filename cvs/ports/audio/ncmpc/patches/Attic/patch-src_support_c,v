head	1.3;
access;
symbols
	OPENBSD_4_7:1.2.0.10
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.8
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.6
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.4
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.2
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.1.0.4
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.2
	OPENBSD_4_1_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2010.04.05.19.05.11;	author landry;	state dead;
branches;
next	1.2;

1.2
date	2007.09.19.19.15.13;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2007.01.11.17.36.40;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to ncmpc 0.16.1, from maintainer Tobias Ulmer, thanks!
@
text
@$OpenBSD: patch-src_support_c,v 1.2 2007/09/19 19:15:13 jasper Exp $
--- src/support.c.orig	Wed Sep 19 19:27:39 2007
+++ src/support.c	Wed Sep 19 19:37:42 2007
@@@@ -168,6 +168,7 @@@@ utf8_to_locale(char *utf8str)
   gchar *str;
   gsize rb, wb;
   GError *error;
+  const char *charset;
 
   if( noconvert )
     return g_strdup(utf8str);
@@@@ -175,15 +176,11 @@@@ utf8_to_locale(char *utf8str)
   rb = 0; /* bytes read */
   wb = 0; /* bytes written */
   error = NULL;
-  str=g_locale_from_utf8(utf8str, 
-			 strlen(utf8str),
-			 &wb, &rb,
-			 &error);
+  g_get_charset(&charset);
+  str = g_convert_with_fallback(
+      utf8str, -1, charset, "UTF-8", "?", &rb, &wb, &error);
   if( error )
     {
-      const char *charset;
-
-      g_get_charset(&charset);
       screen_status_printf(_("Error: Unable to convert characters to %s"),
 			   charset);
       D("utf8_to_locale(): %s\n", error->message);
@


1.2
log
@update ncmpc to an svn snapshot (6899),
includes lots of bug fixes and new features

ok Tobias Ulmer (MAINTAINER)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_support_c,v 1.1 2007/01/11 17:36:40 jasper Exp $
@


1.1
log
@replace broken chars with '?' and make the "Unable to convert..." message
go away.

from MAINTAINER (Tobias Ulmer <tobias@@tmux.org>)

"go ahead" bernd@@
@
text
@d1 4
a4 4
$OpenBSD$
--- src/support.c.orig	Sun Jan 23 18:37:41 2005
+++ src/support.c	Tue Jan  2 16:16:16 2007
@@@@ -149,6 +149,7 @@@@
d12 1
a12 1
@@@@ -156,15 +157,11 @@@@
@

