head	1.2;
access;
symbols
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_6:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2015.01.10.15.50.58;	author naddy;	state dead;
branches;
next	1.1;
commitid	fcbq5beq7jpL0DD1;

1.1
date	2014.11.25.20.42.18;	author naddy;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;
commitid	LTxpDiGi26jib3OV;

1.1.2.1
date	2014.11.27.16.01.54;	author naddy;	state Exp;
branches;
next	;
commitid	iWg4eYxTbsf7IBDi;

1.1.4.1
date	2014.11.27.16.02.07;	author naddy;	state Exp;
branches;
next	;
commitid	lwzkcwX5NiNwN8SC;


desc
@@


1.2
log
@maintenance update to flac 1.3.1, no significant user-visible changes
@
text
@$OpenBSD: patch-src_libFLAC_stream_decoder_c,v 1.1 2014/11/25 20:42:18 naddy Exp $

CVE-2014-8962: Heap buffer read overflow when processing ID3V2 metadata
CVE-2014-9028: Heap buffer write overflow in read_residual_partitioned_rice_ 

--- src/libFLAC/stream_decoder.c.orig	Sun May 26 11:30:33 2013
+++ src/libFLAC/stream_decoder.c	Tue Nov 25 20:58:16 2014
@@@@ -71,7 +71,7 @@@@ FLAC_API int FLAC_API_SUPPORTS_OGG_FLAC =
  *
  ***********************************************************************/
 
-static FLAC__byte ID3V2_TAG_[3] = { 'I', 'D', '3' };
+static const FLAC__byte ID3V2_TAG_[3] = { 'I', 'D', '3' };
 
 /***********************************************************************
  *
@@@@ -1365,6 +1365,10 @@@@ FLAC__bool find_metadata_(FLAC__StreamDecoder *decoder
 			id = 0;
 			continue;
 		}
+
+		if(id >= 3)
+			return false;
+
 		if(x == ID3V2_TAG_[id]) {
 			id++;
 			i = 0;
@@@@ -2705,7 +2709,8 @@@@ FLAC__bool read_residual_partitioned_rice_(FLAC__Strea
 		if(decoder->private_->frame.header.blocksize < predictor_order) {
 			send_error_to_client_(decoder, FLAC__STREAM_DECODER_ERROR_STATUS_LOST_SYNC);
 			decoder->protected_->state = FLAC__STREAM_DECODER_SEARCH_FOR_FRAME_SYNC;
-			return true;
+			/* We have received a potentially malicious bt stream. All we can do is error out to avoid a heap overflow. */
+			return false;
 		}
 	}
 	else {
@


1.1
log
@Security fixes for FLAC:
CVE-2014-8962: Heap buffer read overflow when processing ID3V2 metadata
CVE-2014-9028: Heap buffer write overflow in read_residual_partitioned_rice_
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@Security fixes for FLAC:
CVE-2014-8962: Heap buffer read overflow when processing ID3V2 metadata
CVE-2014-9028: Heap buffer write overflow in read_residual_partitioned_rice_
@
text
@d1 1
a1 1
$OpenBSD: patch-src_libFLAC_stream_decoder_c,v 1.1 2014/11/25 20:42:18 naddy Exp $
@


1.1.2.1
log
@Security fixes for FLAC:
CVE-2014-8962: Heap buffer read overflow when processing ID3V2 metadata
CVE-2014-9028: Heap buffer write overflow in read_residual_partitioned_rice_
@
text
@d1 1
a1 1
$OpenBSD: patch-src_libFLAC_stream_decoder_c,v 1.1 2014/11/25 20:42:18 naddy Exp $
@

