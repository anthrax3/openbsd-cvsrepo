head	1.5;
access;
symbols
	OPENBSD_4_6:1.4.0.4
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.2
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.3.0.22
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.20
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.18
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.16
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.14
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.12
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.10
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.8
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.6
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.4
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.3.0.2
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.1.0.4
	OPENBSD_3_3_BASE:1.1
	OPENBSD_3_2:1.1.0.2
	OPENBSD_3_2_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2009.12.19.22.59.27;	author jakemsr;	state dead;
branches;
next	1.4;

1.4
date	2008.08.21.14.11.14;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2003.08.25.20.59.10;	author avsm;	state Exp;
branches;
next	1.2;

1.2
date	2003.04.28.23.53.34;	author wcobb;	state Exp;
branches;
next	1.1;

1.1
date	2002.07.30.06.51.15;	author wcobb;	state Exp;
branches;
next	;


desc
@@


1.5
log
@- update to soundtracker-0.6.8
- use sndio for audio, kill esd flavor
- various cleanup

ok MAINTAINER
@
text
@$OpenBSD: patch-app_gui_c,v 1.4 2008/08/21 14:11:14 jasper Exp $
--- app/gui.c.orig	Mon May 20 15:06:48 2002
+++ app/gui.c	Thu Aug 21 15:54:06 2008
@@@@ -227,8 +227,6 @@@@ gui_save_wav_callback (gint reply,
 	write(audio_ctlpipe, &i, sizeof(i));
 	write(audio_ctlpipe, &l, sizeof(l));
 	write(audio_ctlpipe, data, l + 1);
-
-	gui_set_current_pattern(xm->pattern_order_table[0]);
 	wait_for_player();
     }
 }
@@@@ -474,7 +472,7 @@@@ keyevent (GtkWidget *widget,
 	sample_editor_handle_keys,
 	modinfo_page_handle_keys,
     };
-    gboolean pressed = (gboolean)data;
+    gboolean pressed = (gboolean)GPOINTER_TO_INT(data);
     gboolean handled = FALSE;
     gboolean entry_focus = GTK_IS_ENTRY(GTK_WINDOW(mainwindow)->focus_widget);
 
@@@@ -529,7 +527,7 @@@@ static void
 playlist_position_changed (Playlist *p,
 			   int newpos)
 {
-    if(gui_playing_mode) {
+    if(gui_playing_mode != 0) {
 	// This will only be executed when the user changes the song position manually
 	gui_mixer_set_songpos(newpos);
 	event_waiter_start(audio_songpos_ew);
@@@@ -577,8 +575,18 @@@@ gui_editpat_changed (GtkSpinButton *spin)
 {
     int n = gtk_spin_button_get_value_as_int(spin);
 
-    if(n != editing_pat)
+    if(n != editing_pat) {
 	gui_set_current_pattern(n);
+
+	/* If we are in 'playing pattern' mode and asynchronous
+	 * editing is disabled, make the audio thread jump to the new
+	 * pattern, too. I think it would be cool to have this for
+	 * 'playing song' mode, too, but then modifications in
+	 * gui_update_player_pos() will be necessary. */
+	if(gui_playing_mode == PLAYING_PATTERN && !ASYNCEDIT) {
+	    gui_mixer_set_pattern(n);
+	}
+    }
 }
 
 static void
@@@@ -870,8 +878,6 @@@@ play_song (void)
     write(audio_ctlpipe, &i, sizeof(i));
     write(audio_ctlpipe, &sp, sizeof(sp));
     write(audio_ctlpipe, &pp, sizeof(pp));
-
-    gui_set_current_pattern(xm->pattern_order_table[sp]);
     wait_for_player();
 }
 
@@@@ -1037,10 +1043,6 @@@@ gui_set_current_pattern (int p)
     gtk_spin_button_set_value(GTK_SPIN_BUTTON(spin_editpat), p);
     gui_update_pattern_data();
 
-    if(!GUI_ENABLED && !ASYNCEDIT) {
-	gui_mixer_set_pattern(p);
-    }
-
     xm_set_modified(m);
 }
 
@@@@ -1064,13 +1066,12 @@@@ offset_current_pattern (int offset)
     int nv;
 
     nv = gtk_spin_button_get_value_as_int(GTK_SPIN_BUTTON(spin_editpat)) + offset;
-
     if(nv < 0)
 	nv = 0;
     else if(nv > 255)
 	nv = 255;
 
-    gui_set_current_pattern(nv);
+    gtk_spin_button_set_value(GTK_SPIN_BUTTON(spin_editpat), nv);
 }
 
 void
@@@@ -1255,7 +1256,7 @@@@ gui_splash_set_label (const gchar *text,
     char buf[256];
 
     strcpy(buf, "SoundTracker v" VERSION " - ");
-    strncat(buf, text, 255-sizeof(buf));
+    strlcat(buf, text, sizeof buf);
 
     gtk_label_set_text(GTK_LABEL(gui_splash_label), buf);
 
@


1.4
log
@- remove gnome flavor
- regen patches

ok wcobb@@ (MAINTAINER)
@
text
@d1 1
a1 1
$OpenBSD: patch-app_gui_c,v 1.3 2003/08/25 20:59:10 avsm Exp $
@


1.3
log
@Fixup bad buffer length calculation that results in a negative number
-Wbounded warning spotted by nikolay@@, naddy@@ ok
@
text
@d1 3
a3 3
$OpenBSD: patch-app_gui_c,v 1.2 2003/04/28 23:53:34 wcobb Exp $
--- app/gui.c.orig	2002-05-20 06:06:48.000000000 -0700
+++ app/gui.c	2003-08-25 19:58:55.000000000 -0700
d31 1
a31 1
@@@@ -577,8 +575,18 @@@@ gui_editpat_changed (GtkSpinButton *spin
@


1.2
log
@Fix a crash bug when rendering to WAV files; from author.
@
text
@d1 3
a3 3
$OpenBSD$
--- app/gui.c.orig	Mon May 20 10:06:48 2002
+++ app/gui.c	Mon Apr 28 20:44:25 2003
d86 9
@


1.1
log
@LP64 fixes.
@
text
@d2 12
a13 3
--- app/gui.c.orig	Tue Jul 30 02:49:25 2002
+++ app/gui.c	Tue Jul 30 02:49:38 2002
@@@@ -474,7 +474,7 @@@@ keyevent (GtkWidget *widget,
d22 64
@

