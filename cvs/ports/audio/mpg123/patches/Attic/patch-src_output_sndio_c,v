head	1.2;
access;
symbols
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.12
	OPENBSD_5_0:1.1.0.10
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.8
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.6
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.4
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.2
	OPENBSD_4_6_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2012.05.02.19.58.16;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2009.04.28.19.07.26;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@maintenance update to 1.14.0
@
text
@$OpenBSD: patch-src_output_sndio_c,v 1.1 2009/04/28 19:07:26 naddy Exp $
--- src/output/sndio.c.orig	Wed Mar 25 00:36:02 2009
+++ src/output/sndio.c	Tue Mar 31 22:32:09 2009
@@@@ -46,6 +46,14 @@@@ static int open_sndio(audio_output_t *ao)
 		par.sig = 0;
 		par.bits = 16;
 		break;
+	case MPG123_ENC_SIGNED_32:
+		par.sig = 1;
+		par.bits = 32;
+		break;
+	case MPG123_ENC_UNSIGNED_32:
+		par.sig = 0;
+		par.bits = 32;
+		break;
 	case MPG123_ENC_UNSIGNED_8:
 		par.sig = 0;
 		par.bits = 8;
@@@@ -67,15 +75,27 @@@@ static int open_sndio(audio_output_t *ao)
 		sio_close(hdl);
 		return -1;
 	}
-	if ((par.bits != 8 && par.bits != 16) || par.le != SIO_LE_NATIVE) {
+	if ((par.bits != 8 && par.bits != 16 && par.bits != 32) ||
+	    par.le != SIO_LE_NATIVE) {
 		sio_close(hdl);
 		return -1;
 	}
 	ao->rate = par.rate;
 	ao->channels = par.pchan;
-	ao->format = (par.bits == 8) ?
-	    (par.sig ? MPG123_ENC_SIGNED_8 : MPG123_ENC_UNSIGNED_8) :
-	    (par.sig ? MPG123_ENC_SIGNED_16 : MPG123_ENC_UNSIGNED_16);
+	switch (par.bits) {
+	case 8:
+		ao->format = par.sig ? MPG123_ENC_SIGNED_8 :
+		    MPG123_ENC_UNSIGNED_8;
+		break;
+	case 16:
+		ao->format = par.sig ? MPG123_ENC_SIGNED_16 :
+		    MPG123_ENC_UNSIGNED_16;
+		break;
+	case 32:
+		ao->format = par.sig ? MPG123_ENC_SIGNED_32 :
+		    MPG123_ENC_UNSIGNED_32;
+		break;
+	}
 	ao->userptr = hdl;
 	return 0;
 }
@@@@ -83,6 +103,7 @@@@ static int open_sndio(audio_output_t *ao)
 static int get_formats_sndio(audio_output_t *ao)
 {
 	return (MPG123_ENC_SIGNED_16|MPG123_ENC_UNSIGNED_16|
+	    MPG123_ENC_SIGNED_32|MPG123_ENC_UNSIGNED_32|
 	    MPG123_ENC_UNSIGNED_8|MPG123_ENC_SIGNED_8);
 }
 
@


1.1
log
@update to 1.7.3; 32-bit audio is now supported
@
text
@d1 1
a1 1
$OpenBSD$
@

