head	1.2;
access;
symbols
	OPENBSD_5_4:1.1.0.10
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.8
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.6
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2013.10.11.17.28.18;	author bcallah;	state dead;
branches;
next	1.1;

1.1
date	2011.08.18.17.56.47;	author jasper;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2011.08.18.17.57.03;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update libmodplug to 0.8.8.4 - all the patches go away.
Bump minor.
Take MAINTAINER.
ok landry@@
@
text
@$OpenBSD: patch-src_load_ams_cpp,v 1.1 2011/08/18 17:56:47 jasper Exp $

AMSv2 off by one problem (related to SA45131/C)
From upstream git: 16d7a78efe14d345a6c5b241f88422ad0ee483ea

Fix AMS and DSM too large by one - SA45131/C
From upstream git: 26243ab9fe1171f70053e9aec4b20e9f7de9e4ef

--- src/load_ams.cpp.orig	Thu Aug 18 19:49:58 2011
+++ src/load_ams.cpp	Thu Aug 18 19:52:09 2011
@@@@ -52,7 +52,7 @@@@ BOOL CSoundFile::ReadAMS(LPCBYTE lpStream, DWORD dwMem
 	
 	if ((!lpStream) || (dwMemLength < 1024)) return FALSE;
 	if ((pfh->verhi != 0x01) || (strncmp(pfh->szHeader, "Extreme", 7))
-	 || (!pfh->patterns) || (!pfh->orders) || (!pfh->samples) || (pfh->samples > MAX_SAMPLES)
+	 || (!pfh->patterns) || (!pfh->orders) || (!pfh->samples) || (pfh->samples >= MAX_SAMPLES)
 	 || (pfh->patterns > MAX_PATTERNS) || (pfh->orders > MAX_ORDERS))
 	{
 		return ReadAMS2(lpStream, dwMemLength);
@@@@ -321,7 +321,7 @@@@ BOOL CSoundFile::ReadAMS2(LPCBYTE lpStream, DWORD dwMe
 	dwMemPos = pfh->titlelen + 8;
 	psh = (AMS2SONGHEADER *)(lpStream + dwMemPos);
 	if (((psh->version & 0xFF00) != 0x0200) || (!psh->instruments)
-	 || (psh->instruments > MAX_INSTRUMENTS) || (!psh->patterns) || (!psh->orders)) return FALSE;
+	 || (psh->instruments >= MAX_INSTRUMENTS) || (!psh->patterns) || (!psh->orders)) return FALSE;
 	dwMemPos += sizeof(AMS2SONGHEADER);
 	if (pfh->titlelen)
 	{
@


1.1
log
@Security fixes for CVE-2011-291{1,2,3,4,5}
Various integer overflows and off-by-one errors in libmodplug.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@Security fixes for CVE-2011-291{1,2,3,4,5}
Various integer overflows and off-by-one errors in libmodplug.
@
text
@@

