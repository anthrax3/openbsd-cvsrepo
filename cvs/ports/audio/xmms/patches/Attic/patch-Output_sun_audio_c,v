head	1.7;
access;
symbols
	OPENBSD_4_7:1.6.0.10
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.6.0.8
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.6
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.4
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.2
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.5.0.10
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.8
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.6
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.4
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.2
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.3.0.4
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.2
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.1.0.2
	OPENBSD_3_5_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2010.04.20.23.43.34;	author sthen;	state dead;
branches;
next	1.6;

1.6
date	2007.12.08.21.54.57;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2005.04.27.16.31.34;	author robert;	state Exp;
branches;
next	1.4;

1.4
date	2005.04.13.19.20.02;	author robert;	state Exp;
branches;
next	1.3;

1.3
date	2004.04.18.14.19.02;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2004.04.15.19.23.46;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2004.01.23.01.41.06;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Instead of just commenting out the Sun backend in the PLIST have the
autoconf script not build the backend at all. Fix mikmod WANTLIB while there.
From Brad, ok robert@@
@
text
@$OpenBSD: patch-Output_sun_audio_c,v 1.6 2007/12/08 21:54:57 ajacoutot Exp $
--- Output/sun/audio.c.orig	Sun Jun  2 15:42:03 2002
+++ Output/sun/audio.c	Fri Nov 23 18:38:44 2007
@@@@ -123,14 +123,12 @@@@ static void sun_setformat(AFormat fmt, int rate, int n
 	
 	sun = sun_format(fmt);
 
-	effect.format.sun = sun;
 	effect.format.xmms = fmt;
 	effect.frequency = rate;
 	effect.channels = nch;
 	effect.bps = sun_bps(sun, rate, nch);
 
 	output.format.sun = sun;
-	output.format.xmms = fmt;
 	output.frequency = rate;
 	output.channels = nch;
 	sun_setparams();
@@@@ -150,10 +148,10 @@@@ void sun_setparams(void)
 
 	AUDIO_INITINFO(&info);
 
-	info.mode = AUMODE_PLAY;
+	info.mode = AUMODE_PLAY_ALL;
 	if (ioctl(audio.fd, AUDIO_SETINFO, &info) != 0)
 	{
-		g_error("%s: cannot play (%s)", audio.devaudio,
+		g_warning("%s: cannot play (%s)", audio.devaudio,
 			strerror(errno));
 		return;
 	}
@@@@ -171,7 +169,7 @@@@ void sun_setparams(void)
 	strcpy(output.name, enc.name);
 	if (ioctl(audio.fd, AUDIO_SETINFO, &info) != 0)
 	{
-		g_error("%s: unsupported encoding: %s (%s)", audio.devaudio,
+		g_warning("%s: unsupported encoding: %s (%s)", audio.devaudio,
 			output.name, strerror(errno));
 		return;
 	}
@@@@ -182,7 +180,7 @@@@ void sun_setparams(void)
 	info.play.sample_rate = output.frequency;
 	if (ioctl(audio.fd, AUDIO_SETINFO, &info) < 0)
 	{
-		g_error("%s: cannot handle %i Hz (%s)", audio.devaudio,
+		g_warning("%s: cannot handle %i Hz (%s)", audio.devaudio,
 			output.frequency, strerror(errno));
 		return;
 	}
@@@@ -328,7 +326,7 @@@@ static inline void sun_write_audio(gpointer data, int 
 		output_time_offset += (output_bytes * 1000) / output.bps;
 		output_bytes = 0;
 		close(audio.fd);
-		audio.fd = open(audio.devaudio, O_RDWR);
+		audio.fd = open(audio.devaudio, O_WRONLY);
 		sun_setformat(new_format, new_frequency, new_channels);
 	}
 	if (effects_enabled() && ep && ep->mod_samples)
@@@@ -518,7 +516,7 @@@@ static void* sun_loop(void *arg)
 		{
 			audio.unpause = FALSE;
 			close(audio.fd);
-			audio.fd = open(audio.devaudio, O_RDWR);
+			audio.fd = open(audio.devaudio, O_WRONLY);
 			sun_setparams();
 			audio.paused = FALSE;
 		}
@@@@ -535,9 +533,9 @@@@ int sun_open(AFormat fmt, int rate, int nch)
 
 	AUDIO_INITINFO(&info);
 
-	if ((audio.fd = open(audio.devaudio, O_RDWR)) < 0)
+	if ((audio.fd = open(audio.devaudio, O_WRONLY)) < 0)
 	{
-		g_error("%s: %s", audio.devaudio, strerror(errno));
+		g_warning("%s: %s", audio.devaudio, strerror(errno));
 		return 0;
 	}
 
@


1.6
log
@- update to xmms-1.2.11

input from naddy@@, help and ok jakemsr@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Output_sun_audio_c,v 1.5 2005/04/27 16:31:34 robert Exp $
@


1.5
log
@open the audio device with the O_WRONLY flag instead of O_RDWR so
it should work with uaudio(4) too; from Urs Breinlinger <urs@@mailq.de>

fix the LIB_DEPENDS line of the -mp3 subpackage;
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 2
+++ Output/sun/audio.c	Wed Apr 27 18:13:18 2005
@@@@ -123,14 +123,12 @@@@
d19 6
a24 2
@@@@ -153,7 +151,7 @@@@
 	info.mode = AUMODE_PLAY;
d32 1
a32 1
@@@@ -171,7 +169,7 @@@@
d41 1
a41 1
@@@@ -182,7 +180,7 @@@@
d50 1
a50 1
@@@@ -328,7 +326,7 @@@@
d59 1
a59 1
@@@@ -518,7 +516,7 @@@@
d68 1
a68 1
@@@@ -535,9 +533,9 @@@@
@


1.4
log
@use g_warning(); instead of g_error();. This way xmms won't exit when there
are audio problems.
@
text
@d3 1
a3 1
+++ Output/sun/audio.c	Wed Apr 13 20:56:19 2005
d46 21
a66 1
@@@@ -537,7 +535,7 @@@@
d68 2
a69 1
 	if ((audio.fd = open(audio.devaudio, O_RDWR)) < 0)
@


1.3
log
@- change my MAINTAINER address to @@openbsd.org
- don't change O_RDWR to O_WRONLY
  in audio.c because O_RDWD is fine now
ok naddy@@
@
text
@d2 3
a4 3
--- Output/sun/audio.c.orig	Sun Apr 18 09:07:37 2004
+++ Output/sun/audio.c	Sun Apr 18 09:08:11 2004
@@@@ -123,7 +123,6 @@@@
a11 1
@@@@ -130,7 +129,6 @@@@
d19 36
@


1.2
log
@Update to 1.2.10; from new maintainer Robert Nagy <thuglife@@bsd.hu>.
@
text
@d2 3
a4 3
--- Output/sun/audio.c.orig	2002-06-02 15:42:03.000000000 +0200
+++ Output/sun/audio.c	2004-04-14 23:33:54.000000000 +0200
@@@@ -123,14 +123,12 @@@@ static void sun_setformat(AFormat fmt, i
d12 1
a19 27
@@@@ -328,7 +326,7 @@@@ static inline void sun_write_audio(gpoin
 		output_time_offset += (output_bytes * 1000) / output.bps;
 		output_bytes = 0;
 		close(audio.fd);
-		audio.fd = open(audio.devaudio, O_RDWR);
+		audio.fd = open(audio.devaudio, O_WRONLY);
 		sun_setformat(new_format, new_frequency, new_channels);
 	}
 	if (effects_enabled() && ep && ep->mod_samples)
@@@@ -518,7 +516,7 @@@@ static void* sun_loop(void *arg)
 		{
 			audio.unpause = FALSE;
 			close(audio.fd);
-			audio.fd = open(audio.devaudio, O_RDWR);
+			audio.fd = open(audio.devaudio, O_WRONLY);
 			sun_setparams();
 			audio.paused = FALSE;
 		}
@@@@ -535,7 +533,7 @@@@ int sun_open(AFormat fmt, int rate, int 
 
 	AUDIO_INITINFO(&info);
 
-	if ((audio.fd = open(audio.devaudio, O_RDWR)) < 0)
+	if ((audio.fd = open(audio.devaudio, O_WRONLY)) < 0)
 	{
 		g_error("%s: %s", audio.devaudio, strerror(errno));
 		return 0;
@


1.1
log
@Fix sun output plugin.  This only ever worked by accident.
@
text
@d2 3
a4 3
--- Output/sun/audio.c.orig	2004-01-22 20:42:58.000000000 +0100
+++ Output/sun/audio.c	2004-01-22 20:44:08.000000000 +0100
@@@@ -124,14 +124,12 @@@@ sun_setformat(AFormat fmt, gint rate, gi
d19 27
@

