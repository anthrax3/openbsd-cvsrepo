head	1.6;
access;
symbols
	OPENBSD_3_5:1.5.0.10
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.5.0.8
	OPENBSD_3_4_BASE:1.5
	OPENBSD_3_3:1.5.0.6
	OPENBSD_3_3_BASE:1.5
	OPENBSD_3_2:1.5.0.4
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.2
	OPENBSD_3_1_BASE:1.5
	OPENBSD_3_0:1.3.0.2
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_TRACKING_SWITCH:1.3
	vedge:1.1.1.1
	xmms:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2004.04.15.19.23.46;	author naddy;	state dead;
branches;
next	1.5;

1.5
date	2002.04.06.19.32.39;	author pvalchev;	state Exp;
branches;
next	1.4;

1.4
date	2002.02.05.04.07.57;	author pvalchev;	state Exp;
branches;
next	1.3;

1.3
date	2001.07.25.16.05.19;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2001.07.25.15.48.26;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2001.07.20.14.26.16;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.07.20.14.26.16;	author espie;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to 1.2.10; from new maintainer Robert Nagy <thuglife@@bsd.hu>.
@
text
@$OpenBSD: patch-xmms_pluginenum_c,v 1.5 2002/04/06 19:32:39 pvalchev Exp $
--- xmms/pluginenum.c.orig	Wed Jan  2 07:21:32 2002
+++ xmms/pluginenum.c	Sat Apr  6 12:15:28 2002
@@@@ -35,6 +35,10 @@@@
 # define RTLD_NOW 0
 #endif
 
+#if defined(__OpenBSD__) && !defined(__ELF__)
+# define SYMBOL_PREFIX "_"
+#endif
+
 
 gchar *plugin_dir_list[] =
 {
@@@@ -431,6 +435,12 @@@@ void cleanup_plugins(void)
 	while (node)
 	{
 		op = (OutputPlugin *) node->data;
+		if (op != NULL && op->cleanup != NULL) {
+			op->cleanup();
+			GDK_THREADS_LEAVE();
+			while (g_main_iteration(FALSE));
+			GDK_THREADS_ENTER();
+		}
 		close_dynamic_lib(op->handle);
 		node = node->next;
 	}
@


1.5
log
@better solution
@
text
@d1 1
a1 1
$OpenBSD: patch-xmms_pluginenum_c,v 1.4 2002/02/05 04:07:57 pvalchev Exp $
@


1.4
log
@Update to xmms-1.2.6.  From maintainer vedge@@csoft.org

Added mikmod & diskwriter subpackages.
@
text
@d1 15
a15 4
$OpenBSD$
--- xmms/pluginenum.c.orig	Fri Jan 18 06:44:35 2002
+++ xmms/pluginenum.c	Fri Jan 18 06:47:26 2002
@@@@ -431,6 +431,12 @@@@
@


1.3
log
@remove dummy versioning from plugins; ok espie@@
@
text
@d1 4
a4 84
$OpenBSD: patch-xmms_pluginenum_c,v 1.2 2001/07/25 15:48:26 naddy Exp $
--- xmms/pluginenum.c.orig	Mon Oct 16 15:37:56 2000
+++ xmms/pluginenum.c	Wed Jul 25 16:47:43 2001
@@@@ -33,6 +33,19 @@@@
 # define RTLD_NOW 0
 #endif
 
+#ifdef WITH_SYMBOL_UNDERSCORE
+# define IPLUGIN_SYM "_get_iplugin_info"
+# define OPLUGIN_SYM "_get_oplugin_info"
+# define EPLUGIN_SYM "_get_eplugin_info"
+# define GPLUGIN_SYM "_get_gplugin_info"
+# define VPLUGIN_SYM "_get_vplugin_info"
+#else
+# define IPLUGIN_SYM "get_iplugin_info"
+# define OPLUGIN_SYM "get_oplugin_info"
+# define EPLUGIN_SYM "get_eplugin_info"
+# define GPLUGIN_SYM "get_gplugin_info"
+# define VPLUGIN_SYM "get_vplugin_info"
+#endif
 
 gchar *plugin_dir_list[] =
 {
@@@@ -264,9 +277,9 @@@@ void add_plugin(gchar * filename)
 #endif /* HPUX */
 	{
 #ifdef HPUX
- 		if ((shl_findsym(&h, "get_iplugin_info", TYPE_PROCEDURE, (void*) &gpi)) == 0)
+ 		if ((shl_findsym(&h, IPLUGIN_SYM, TYPE_PROCEDURE, (void*) &gpi)) == 0)
 #else
-		if ((gpi = dlsym(h, "get_iplugin_info")) != NULL)
+		if ((gpi = dlsym(h, IPLUGIN_SYM)) != NULL)
 #endif
 		{
 			InputPlugin *p;
@@@@ -282,9 +295,9 @@@@ void add_plugin(gchar * filename)
 			ip_data->input_list = g_list_prepend(ip_data->input_list, p);
 		}
 #ifdef HPUX
-		else if ((shl_findsym(&h, "get_oplugin_info", TYPE_PROCEDURE, (void*) &gpi)) == 0)
+		else if ((shl_findsym(&h, OPLUGIN_SYM, TYPE_PROCEDURE, (void*) &gpi)) == 0)
 #else
-		else if ((gpi = dlsym(h, "get_oplugin_info")) != NULL)
+		else if ((gpi = dlsym(h, OPLUGIN_SYM)) != NULL)
 #endif
 		{
 			OutputPlugin *p;
@@@@ -295,9 +308,9 @@@@ void add_plugin(gchar * filename)
 			op_data->output_list = g_list_prepend(op_data->output_list, p);
 		}
 #ifdef HPUX
-		else if ((shl_findsym(&h, "get_eplugin_info", TYPE_PROCEDURE, (void *) &gpi)) == 0)
+		else if ((shl_findsym(&h, EPLUGIN_SYM, TYPE_PROCEDURE, (void *) &gpi)) == 0)
 #else
-		else if ((gpi = dlsym(h, "get_eplugin_info")) != NULL)
+		else if ((gpi = dlsym(h, EPLUGIN_SYM)) != NULL)
 #endif
 		{
 			EffectPlugin *p;
@@@@ -308,9 +321,9 @@@@ void add_plugin(gchar * filename)
 			ep_data->effect_list = g_list_prepend(ep_data->effect_list, p);
 		}
 #ifdef HPUX
-		else if ((shl_findsym(&h, "get_gplugin_info", TYPE_PROCEDURE, (void*) &gpi)) == 0)
+		else if ((shl_findsym(&h, GPLUGIN_SYM, TYPE_PROCEDURE, (void*) &gpi)) == 0)
 #else
-		else if ((gpi = dlsym(h, "get_gplugin_info")) != NULL)
+		else if ((gpi = dlsym(h, GPLUGIN_SYM)) != NULL)
 #endif 
 		{
 			GeneralPlugin *p;
@@@@ -322,9 +335,9 @@@@ void add_plugin(gchar * filename)
 			gp_data->general_list = g_list_prepend(gp_data->general_list, p);
 		}
 #ifdef HPUX
-		else if ((shl_findsym(&h, "get_vplugin_info", TYPE_PROCEDURE, (void *) &gpi)) == 0)
+		else if ((shl_findsym(&h, VPLUGIN_SYM, TYPE_PROCEDURE, (void *) &gpi)) == 0)
 #else
-		else if ((gpi = dlsym(h, "get_vplugin_info")) != NULL)
+		else if ((gpi = dlsym(h, VPLUGIN_SYM)) != NULL)
 #endif
 		{
 			VisPlugin *p;
@@@@ -422,6 +434,12 @@@@ void cleanup_plugins(void)
d8 5
a12 5
+		if(op && op->cleanup) {
+		    op->cleanup();
+		    GDK_THREADS_LEAVE();
+		    while(g_main_iteration(FALSE));
+		    GDK_THREADS_ENTER();
d14 3
a16 3
 #ifdef HPUX
                 h = op->handle;
                 shl_unload(*h);
@


1.2
log
@Cleanups:
- regen patches, add RCS keywords
- remove redundant dependencies
- remove unused libtool dependency
- add major version number to library dependencies
- don't build included gettext
- miscellaneous
@
text
@d1 1
a1 1
$OpenBSD$
a83 21
@@@@ -355,7 +368,7 @@@@ void add_plugin(gchar * filename)
 
 void scan_plugins(char *dirname)
 {
-	gchar *filename, *ext;
+	gchar *filename;
 	DIR *dir;
 	struct dirent *ent;
 	struct stat statbuf;
@@@@ -368,9 +381,8 @@@@ void scan_plugins(char *dirname)
 	{
 		filename = g_strdup_printf("%s/%s", dirname, ent->d_name);
 		if (!stat(filename, &statbuf) && S_ISREG(statbuf.st_mode) &&
-		    (ext = strrchr(ent->d_name, '.')) != NULL)
-			if (!strcmp(ext, SHARED_LIB_EXT))
-				add_plugin(filename);
+		    strstr(ent->d_name, SHARED_LIB_EXT))
+			add_plugin(filename);
 		g_free(filename);
 	}
 	closedir(dir);
@


1.1
log
@Initial revision
@
text
@d1 3
a3 2
--- xmms/pluginenum.c.orig	Thu Jul  5 21:10:37 2001
+++ xmms/pluginenum.c	Thu Jul  5 21:14:57 2001
d24 1
a24 1
@@@@ -264,9 +277,9 @@@@
d36 1
a36 1
@@@@ -282,9 +295,9 @@@@
d48 1
a48 1
@@@@ -295,9 +308,9 @@@@
d60 1
a60 1
@@@@ -308,9 +321,9 @@@@
d72 1
a72 1
@@@@ -322,9 +335,9 @@@@
d84 1
a84 1
@@@@ -355,7 +368,7 @@@@
d93 1
a93 1
@@@@ -368,9 +381,8 @@@@
d105 1
a105 1
@@@@ -422,6 +434,12 @@@@
@


1.1.1.1
log
@Initial import of xmms, based on vedge port plus a few changes.
- deactivate tests.
- no maintainer listed for now until I find out who Mr. `Vedge' actually
is...
@
text
@@
