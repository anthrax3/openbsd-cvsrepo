head	1.2;
access;
symbols
	OPENBSD_5_4:1.1.0.10
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.8
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.6
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2013.09.17.14.12.40;	author dcoppa;	state dead;
branches;
next	1.1;

1.1
date	2011.05.31.09.49.52;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to mutagen-1.22

ok giovanni@@
@
text
@$OpenBSD: patch-tools_mid3v2,v 1.1 2011/05/31 09:49:52 dcoppa Exp $

Add --TXXX support to mid3v2
(upstream revision r97)

--- tools/mid3v2.orig	Wed Dec 30 01:21:12 2009
+++ tools/mid3v2	Thu May 26 12:21:12 2011
@@@@ -89,7 +89,8 @@@@ def delete_frames(deletes, filenames):
 
 def write_files(edits, filenames):
     enc = locale.getpreferredencoding()
-    edits = [(frame[2:], value.decode(enc)) for (frame, value) in edits]
+    edits = [(frame[2:], value.decode(enc)) for (frame, value) in edits
+             if value]
 
     # preprocess:
     #   for all [frame,value] pairs in the edits list
@@@@ -128,11 +129,22 @@@@ def write_files(edits, filenames):
                         desc, lang = values[0], values[-1]
                     frame = mutagen.id3.COMM(
                         encoding=3, text=value, lang=lang, desc=desc)
+                    id3.add(frame)
+            elif frame == "TXXX":
+                for value in vlist:
+                    values = value.split(":", 1)
+                    if len(values) == 1:
+                        desc, value = "", values[0]
+                    else:
+                        desc, value = values[0], values[1]
+                    frame = mutagen.id3.TXXX(encoding=3, text=value, desc=desc)
+                    id3.add(frame)
             elif issubclass(mutagen.id3.Frames[frame], mutagen.id3.UrlFrame):
                 frame = mutagen.id3.Frames[frame](encoding=3, url=vlist)
+                id3.add(frame)
             else:
                 frame = mutagen.id3.Frames[frame](encoding=3, text=vlist)
-            id3.add(frame)
+                id3.add(frame)
         id3.save(filename)
 
 def list_tags(filenames):
@


1.1
log
@Update to mutagen-1.20
With a patch to handle 'TXXX' frames (from upstream svn).

OK giovanni@@, who has tested it using the Exaile music player
@
text
@d1 1
a1 1
$OpenBSD$
@

