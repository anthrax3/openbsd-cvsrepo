head	1.2;
access;
symbols
	OPENBSD_3_6:1.1.0.6
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_4:1.1.0.4
	OPENBSD_3_5:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2004.10.15.18.45.50;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2004.07.31.14.18.14;	author naddy;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2004.07.31.18.11.22;	author robert;	state Exp;
branches;
next	;

1.1.4.1
date	2004.07.31.18.12.27;	author robert;	state Exp;
branches;
next	;


desc
@@


1.2
log
@* Maintenance update to 12.17.6.
* Change sound support: enable native sun audio, drop emulated OSS.
@
text
@$OpenBSD: patch-wav_c,v 1.1 2004/07/31 14:18:14 naddy Exp $
--- wav.c.orig	Fri Jul 30 19:33:34 2004
+++ wav.c	Fri Jul 30 19:36:08 2004
@@@@ -917,6 +917,8 @@@@ int st_wavstartread(ft_t ft) 
 		} else if(strncmp(magic,"ICRD",4) == 0){
 			st_readdw(ft,&len); 
 			len = (len + 1) & ~1;
+			if (len > 254)
+			    break;
 			st_reads(ft,text,len);
 			if (strlen(ft->comment) + strlen(text) < 254)
 			{
@@@@ -926,6 +928,8 @@@@ int st_wavstartread(ft_t ft) 
 		} else if(strncmp(magic,"ISFT",4) == 0){
 			st_readdw(ft,&len); 
 			len = (len + 1) & ~1;
+			if (len > 254)
+			    break;
 			st_reads(ft,text,len);
 			if (strlen(ft->comment) + strlen(text) < 254)
 			{
@


1.1
log
@SECURITY:
Fix buffer overflow in WAV file handling.  Reported by Ulf Harnhammar.
ok robert@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@SECURITY:
Fix buffer overflow in WAV file handling.  Reported by Ulf Harnhammar.
ok brad@@
@
text
@@


1.1.2.1
log
@SECURITY:
Fix buffer overflow in WAV file handling.  Reported by Ulf Harnhammar.
ok brad@@
@
text
@@

