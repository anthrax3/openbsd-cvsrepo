head	1.2;
access;
symbols
	OPENBSD_4_4:1.1.0.14
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.12
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.10
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.8
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.6
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.4
	OPENBSD_3_8:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2008.12.11.08.40.25;	author pea;	state dead;
branches;
next	1.1;

1.1
date	2006.08.17.17.02.13;	author naddy;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2006.08.26.06.17.12;	author sturm;	state Exp;
branches;
next	;

1.1.4.1
date	2006.08.26.06.28.40;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to 1.64.0.
ok ajacoutot@@
@
text
@$OpenBSD: patch-lib_http_c,v 1.1 2006/08/17 17:02:13 naddy Exp $
--- lib/http.c.orig	Sat Apr  9 06:06:15 2005
+++ lib/http.c	Thu Aug 17 18:29:22 2006
@@@@ -212,7 +212,7 @@@@ httplib_parse_sc_header(const char *url,
     int rc;
     char *start;
     char versionbuf[64];
-    char stempbr[50];
+    char stempbr[MAX_ICY_STRING];
     URLINFO url_info;
     int url_path_len;
     int content_type_by_url;
@@@@ -328,7 +328,7 @@@@ httplib_parse_sc_header(const char *url,
     else if ((start = (char *)strstr(header, "SHOUTcast")) != NULL) {
 	strcpy(info->server, "SHOUTcast/");
 	if ((start = (char *)strstr(start, "Server/")) != NULL) {
-	    sscanf(start, "Server/%[^<]<", versionbuf);
+	    sscanf(start, "Server/%63[^<]<", versionbuf);
 	    strcat(info->server, versionbuf);
 	}
 
@@@@ -346,7 +346,7 @@@@ httplib_parse_sc_header(const char *url,
 	if (!info->server[0]) {
 	    strcpy(info->server, "icecast/");
 	    if ((start = (char *)strstr(start, "version ")) != NULL) {
-		sscanf(start, "version %[^<]<", versionbuf);
+		sscanf(start, "version %63[^<]<", versionbuf);
 		strcat(info->server, versionbuf);
 	    }
 	}
@


1.1
log
@fix header parsing; from Debian
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@fix buffer overflow when parsing HTTP headers
CVE-2006-3124
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_http_c,v 1.1 2006/08/17 17:02:13 naddy Exp $
@


1.1.2.1
log
@fix buffer overflow when parsing HTTP headers
CVE-2006-3124
@
text
@d1 20
a20 20
$OpenBSD: patch-lib_http_c,v 1.1 2006/08/17 17:02:13 naddy Exp $
--- lib/http.c.orig	Tue Aug 22 21:03:09 2006
+++ lib/http.c	Tue Aug 22 21:08:08 2006
@@@@ -191,7 +191,7 @@@@ error_code	httplib_parse_sc_header(char 
 			strcpy(info->server, "SHOUTcast/");
 			if ((start = (char *)strstr(start, "Server/")) != NULL)
 			{
-				sscanf(start, "Server/%[^<]<", versionbuf);
+				sscanf(start, "Server/%63[^<]<", versionbuf);
 				strcat(info->server, versionbuf);
 			}
 
@@@@ -201,7 +201,7 @@@@ error_code	httplib_parse_sc_header(char 
 			strcpy(info->server, "icecast/");
 			if ((start = (char *)strstr(start, "version ")) != NULL)
 			{
-				sscanf(start, "version %[^<]<", versionbuf);
+				sscanf(start, "version %63[^<]<", versionbuf);
 				strcat(info->server, versionbuf);
 			}
d22 9
@

