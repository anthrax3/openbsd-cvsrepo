head	1.6;
access;
symbols
	OPENBSD_3_1:1.4.0.2
	OPENBSD_3_1_BASE:1.4
	OPENBSD_3_0:1.3.0.2
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_TRACKING_SWITCH:1.3
	OPENBSD_2_9:1.2.0.4
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.2
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.1.0.2;
locks; strict;
comment	@ * @;


1.6
date	2002.08.02.13.03.28;	author brad;	state dead;
branches;
next	1.5;

1.5
date	2002.07.26.19.57.23;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	2002.03.05.15.35.13;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2001.08.04.05.03.20;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2000.10.06.00.17.46;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2000.08.06.09.24.44;	author brad;	state Exp;
branches;
next	;


desc
@@


1.6
log
@remove
@
text
@--- esdlib.c.orig	Wed Jun 19 09:45:14 2002
+++ esdlib.c	Fri Jul 19 18:26:44 2002
@@@@ -660,7 +660,7 @@@@ int esd_open_sound( const char *host )
 		setsid();
 		cmd = malloc(sizeof("esd  -spawnfd 999999") + (esd_spawn_options?strlen(esd_spawn_options):0));
 
-		sprintf(cmd, "esd %s -spawnfd %d", esd_spawn_options?esd_spawn_options:"", esd_pipe[1]);
+		sprintf(cmd, "exec esd %s -spawnfd %d", esd_spawn_options?esd_spawn_options:"", esd_pipe[1]);
 
 		execl("/bin/sh", "/bin/sh", "-c", cmd, NULL);
 		perror("execl");
@


1.5
log
@upgrade to esound 0.2.28
--
With some testing by: naddy@@
@
text
@@


1.4
log
@upgrade to esound 0.2.24
--
From: naddy@@
@
text
@d1 5
a5 8
--- esdlib.c.orig	Fri Jul 13 14:59:51 2001
+++ esdlib.c	Tue Mar  5 09:21:39 2002
@@@@ -20,6 +20,8 @@@@
 #include <arpa/inet.h>
 #include <errno.h>
 #include <sys/wait.h>
+#include <pwd.h>
+#include <limits.h>
d7 2
a8 1
 #include <sys/un.h>
d10 2
a11 35
@@@@ -1411,4 +1413,34 @@@@ int esd_close( int esd )
     */
 
     return close( esd );
+}
+
+char *
+esd_unix_socket_dir(void) {
+	static char *sockdir = NULL, sockdirbuf[PATH_MAX];
+	struct passwd *pw;
+
+	if (sockdir != NULL)
+		return (sockdir);
+	pw = getpwuid(getuid());
+	if (pw == NULL || pw->pw_dir == NULL) {
+		fprintf(stderr, "esd: could not find home directory\n");
+		exit(1);
+	}
+	snprintf(sockdirbuf, sizeof(sockdirbuf), "%s/.esd", pw->pw_dir);
+	endpwent();
+	sockdir = sockdirbuf;
+	return (sockdir);
+}
+
+char *
+esd_unix_socket_name(void) {
+	static char *sockname = NULL, socknamebuf[PATH_MAX];
+
+	if (sockname != NULL)
+		return (sockname);
+	snprintf(socknamebuf, sizeof(socknamebuf), "%s/socket",
+	    esd_unix_socket_dir());
+	sockname = socknamebuf;
+	return (sockname);
 }
@


1.3
log
@replace oss audio API usage with our native audio API.
--
Patches and code for native audio API support from:
Wilbern Cobb <cobb@@vedge.com.ar>
@
text
@d1 3
a3 3
--- esdlib.c.orig	Tue Nov 28 14:27:30 2000
+++ esdlib.c	Sun Jul 22 17:41:06 2001
@@@@ -19,6 +19,8 @@@@
d12 1
a12 1
@@@@ -1422,4 +1424,34 @@@@ int esd_close( int esd )
@


1.2
log
@upgrade to esound 0.2.20
@
text
@d1 2
a2 2
--- esdlib.c.orig	Mon Oct  2 12:44:18 2000
+++ esdlib.c	Thu Oct  5 19:39:59 2000
d12 1
a12 1
@@@@ -1422,4 +1424,34 @@@@
@


1.1
log
@add patches to fix /tmp races with esound. From: FreeBSD
--
Fix EsounD daemon and library insecurities noted on BugTraq.
Instead of an 0777 chock-full-o-races /tmp/.esd/, use a 0755 ~/.esd/.
Also, the ~/.esd/socket of course needs only be 0644.
@
text
@d1 2
a2 2
--- esdlib.c.orig	Sun Aug  6 04:49:10 2000
+++ esdlib.c	Sun Aug  6 04:51:37 2000
d12 1
a12 1
@@@@ -1421,4 +1423,34 @@@@
@

