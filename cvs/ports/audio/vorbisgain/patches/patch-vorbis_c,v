head	1.1;
access;
symbols
	OPENBSD_6_2:1.1.0.50
	OPENBSD_6_2_BASE:1.1
	OPENBSD_6_1:1.1.0.48
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.46
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.42
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.44
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.40
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.38
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.36
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.34
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.32
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.30
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.28
	OPENBSD_5_0:1.1.0.26
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.24
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.22
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.20
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.18
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.16
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.14
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.12
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.10
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.8
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.6
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.4
	OPENBSD_3_9_BASE:1.1
	OPENBSD_3_8:1.1.0.2
	OPENBSD_3_8_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2005.04.19.20.21.46;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.1
log
@snprintf() from maintainer Moritz Grimm <gtgbr at gmx.net>
@
text
@$OpenBSD$
--- vorbis.c.orig	Sun Apr 17 14:15:59 2005
+++ vorbis.c	Sun Apr 17 14:23:48 2005
@@@@ -659,28 +659,46 @@@@ int write_gains(const char *filename, fl
     /* Add new tags - unless ReplayGain tags are to be removed */
     if (!remove_tags)
     {
+        int ret;
+
         if (track_peak > NO_PEAK)
         {
-            sprintf(buffer, PEAK_FORMAT, track_peak);
-            vorbis_comment_add_tag(vc, TAG_TRACK_PEAK, buffer);
+            ret = snprintf(buffer, sizeof(buffer), PEAK_FORMAT, track_peak);
+            if (ret == -1 || ret >= sizeof(buffer)) {
+                fprintf(stderr, _("Truncation or format error occured in write_gains()\n"));
+                goto exit;
+            } else
+                vorbis_comment_add_tag(vc, TAG_TRACK_PEAK, buffer);
         }
 
         if (track_gain > NO_GAIN)
         {
-            sprintf(buffer, GAIN_FORMAT, track_gain);
-            vorbis_comment_add_tag(vc, TAG_TRACK_GAIN, buffer);
+            ret = snprintf(buffer, sizeof(buffer), GAIN_FORMAT, track_gain);
+            if (ret == -1 || ret >= sizeof(buffer)) {
+                fprintf(stderr, _("Truncation or format error occured in write_gains()\n"));
+                goto exit;
+            } else
+                vorbis_comment_add_tag(vc, TAG_TRACK_GAIN, buffer);
         }
 
         if (album_peak > NO_PEAK)
         {
-            sprintf(buffer, PEAK_FORMAT, album_peak);
-            vorbis_comment_add_tag(vc, TAG_ALBUM_PEAK, buffer);
+            ret = snprintf(buffer, sizeof(buffer), PEAK_FORMAT, album_peak);
+            if (ret == -1 || ret >= sizeof(buffer)) {
+                fprintf(stderr, _("Truncation or format error occured in write_gains()\n"));
+                goto exit;
+            } else
+                vorbis_comment_add_tag(vc, TAG_ALBUM_PEAK, buffer);
         }
 
         if (album_gain > NO_GAIN)
         {
-            sprintf(buffer, GAIN_FORMAT, album_gain);
-            vorbis_comment_add_tag(vc, TAG_ALBUM_GAIN, buffer);
+            ret = snprintf(buffer, sizeof(buffer), GAIN_FORMAT, album_gain);
+            if (ret == -1 || ret >= sizeof(buffer)) {
+                fprintf(stderr, _("Truncation or format error occured in write_gains()\n"));
+                goto exit;
+            } else
+                vorbis_comment_add_tag(vc, TAG_ALBUM_GAIN, buffer);
         }
     }
 
@
