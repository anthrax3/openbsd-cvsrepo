head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2015.10.28.19.01.39;	author dcoppa;	state dead;
branches;
next	1.1;
commitid	82xGBc2P5riezZud;

1.1
date	2015.10.26.16.03.56;	author dcoppa;	state Exp;
branches;
next	;
commitid	Xb1peMOncFQBAFWp;


desc
@@


1.2
log
@
Update to mpd-0.19.11
@
text
@$OpenBSD: patch-src_output_OutputCommand_cxx,v 1.1 2015/10/26 16:03:56 dcoppa Exp $

commit ac61d43720393803cb3f6bc5c74aea588e1ca68d
Author: Max Kellermann <max@@duempel.org>
Date:   Mon Oct 26 16:29:07 2015 +0100

output/Command: flush the mixer cache when enabling/disabling output

Fixes mixer lag (http://bugs.musicpd.org/view.php?id=4425).

--- src/output/OutputCommand.cxx.orig	Sat Oct 25 00:28:53 2014
+++ src/output/OutputCommand.cxx	Mon Oct 26 16:49:54 2015
@@@@ -30,6 +30,7 @@@@
 #include "Internal.hxx"
 #include "PlayerControl.hxx"
 #include "mixer/MixerControl.hxx"
+#include "mixer/Volume.hxx"
 #include "Idle.hxx"
 
 extern unsigned audio_output_state_version;
@@@@ -47,6 +48,11 @@@@ audio_output_enable_index(MultipleOutputs &outputs, un
 	ao.enabled = true;
 	idle_add(IDLE_OUTPUT);
 
+	if (ao.mixer != nullptr) {
+		InvalidateHardwareVolume();
+		idle_add(IDLE_MIXER);
+	}
+
 	ao.player_control->UpdateAudio();
 
 	++audio_output_state_version;
@@@@ -70,6 +76,7 @@@@ audio_output_disable_index(MultipleOutputs &outputs, u
 	Mixer *mixer = ao.mixer;
 	if (mixer != nullptr) {
 		mixer_close(mixer);
+		InvalidateHardwareVolume();
 		idle_add(IDLE_MIXER);
 	}
 
@@@@ -94,6 +101,7 @@@@ audio_output_toggle_index(MultipleOutputs &outputs, un
 		Mixer *mixer = ao.mixer;
 		if (mixer != nullptr) {
 			mixer_close(mixer);
+			InvalidateHardwareVolume();
 			idle_add(IDLE_MIXER);
 		}
 	}
@


1.1
log
@
Merge fixes from the upstream stable 'v0.19.x' branch:

decoder/ffmpeg: fix crash due to wrong avio_alloc_context() call
(git commit 1958f78cc1bd47ce1c9b57db41194f85aed942ab)

decoder/gme: call decoder_seek_error() on seek error
(git commit 93c97972b9cb41284f8af8b653e056484bbf4717)

output/Command: flush the mixer cache when enabling/disabling output
(git commit ac61d43720393803cb3f6bc5c74aea588e1ca68d)
@
text
@d1 1
a1 1
$OpenBSD$
@

