head	1.7;
access;
symbols
	OPENBSD_6_1:1.7.0.2
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.6.0.2
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_3:1.4.0.2
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.2.0.4
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.2
	OPENBSD_5_0:1.1.0.6
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.4
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2016.09.19.09.16.51;	author ajacoutot;	state Exp;
branches;
next	1.6;
commitid	5ZKBoypll2THXP84;

1.6
date	2016.05.22.15.44.23;	author ajacoutot;	state Exp;
branches;
next	1.5;
commitid	vH3eMUKprVwpH5el;

1.5
date	2013.03.19.08.49.14;	author ajacoutot;	state dead;
branches;
next	1.4;

1.4
date	2012.09.30.09.28.04;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2012.08.04.14.37.04;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2011.09.08.10.33.12;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.07.02.07.52.08;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Update to cups-2.2.0.
@
text
@$OpenBSD: patch-scheduler_auth_c,v 1.6 2016/05/22 15:44:23 ajacoutot Exp $
--- scheduler/auth.c.orig	Wed Sep 14 01:39:47 2016
+++ scheduler/auth.c	Sat Sep 17 15:26:03 2016
@@@@ -649,7 +649,7 @@@@ cupsdAuthorize(cupsd_client_t *con)	/* I - Client conn
 #  endif /* HAVE_SHADOW_H */
 
 
-	    pw = getpwnam(username);	/* Get the current password */
+	    pw = getpwnam_shadow(username);	/* Get the current password */
 	    endpwent();			/* Close the password file */
 
 	    if (!pw)
@


1.6
log
@Fix authentication, needs getpwnam_shadow(3).

breakage reported by Anthony Campbell
@
text
@d1 4
a4 4
$OpenBSD$
--- scheduler/auth.c.orig	Sun May 22 17:34:17 2016
+++ scheduler/auth.c	Sun May 22 17:35:08 2016
@@@@ -651,7 +651,7 @@@@ cupsdAuthorize(cupsd_client_t *con)	/* I - Client conn
@


1.5
log
@Update to cups-1.6.2.
@
text
@d1 12
a12 18
$OpenBSD: patch-scheduler_auth_c,v 1.4 2012/09/30 09:28:04 ajacoutot Exp $

https://www.cups.org/str.php?L4196

--- scheduler/auth.c.orig	Wed Aug 31 06:58:33 2011
+++ scheduler/auth.c	Wed Jul 25 17:28:20 2012
@@@@ -89,7 +89,11 @@@@ extern const char *cssmErrorString(int error);
 typedef struct xucred cupsd_ucred_t;
 #  define CUPSD_UCRED_UID(c) (c).cr_uid
 #else
+#  ifndef __OpenBSD__
 typedef struct ucred cupsd_ucred_t;
+#  else
+typedef struct sockpeercred cupsd_ucred_t;
+#  endif
 #  define CUPSD_UCRED_UID(c) (c).uid
 #endif /* HAVE_SYS_UCRED_H */
 #ifdef HAVE_KRB5_IPC_CLIENT_SET_TARGET_UID
@


1.4
log
@Upstream STR bug numbers.
@
text
@d1 1
a1 1
$OpenBSD: patch-scheduler_auth_c,v 1.3 2012/08/04 14:37:04 ajacoutot Exp $
@


1.3
log
@Major update to CUPS 1.6.1.
This package is now split between -main (the bloat) and -libs (i.e.
cups-libs; which only contains the base libraries which have no
external deps).
Most filters have moved to cups-filters, the split was needed because
cups depends on cups-filters which depends on cups

The nice side-effect is that this will simplify lots of things in tree.
@
text
@d1 1
a1 1
$OpenBSD: patch-scheduler_auth_c,v 1.2 2011/09/08 10:33:12 ajacoutot Exp $
d3 1
a3 1
XXX push upstream
@


1.2
log
@Major update to cups-1.5.0.

Thanks to landry@@ for the bulk testing.
@
text
@d1 7
a7 4
$OpenBSD: patch-scheduler_auth_c,v 1.1 2010/07/02 07:52:08 ajacoutot Exp $
--- scheduler/auth.c.orig	Fri May 20 05:49:49 2011
+++ scheduler/auth.c	Fri Sep  2 09:33:11 2011
@@@@ -89,7 +89,7 @@@@ extern const char *cssmErrorString(int error);
d11 3
a13 1
-typedef struct ucred cupsd_ucred_t;
d15 1
@


1.1
log
@Fix SO_PEERCRED fallout.

from Moritz Grimm.
@
text
@d1 4
a4 4
$OpenBSD$
--- scheduler/auth.c.orig	Fri Jul  2 09:21:55 2010
+++ scheduler/auth.c	Fri Jul  2 09:22:09 2010
@@@@ -94,7 +94,7 @@@@ extern const char *cssmErrorString(int error);
@

