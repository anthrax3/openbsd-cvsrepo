head	1.1;
access;
symbols
	OPENBSD_4_5:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2009.06.28.03.53.16;	author william;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2009.06.28.03.53.16;	author william;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-filter_hpgl-input_c was initially added on branch OPENBSD_4_5.
@
text
@@


1.1.2.1
log
@SECURITY FIX

Resolve these, from debian:

CVE-2007-4351
CVE-2007-5849
CVE-2007-6358
CVE-2008-0047
CVE-2008-0053
CVE-2008-0882
CVE-2008-1373
CVE-2008-1722, plus integer overflow patch from L2974: _cupsImageReadPNG()
CVE-2008-3639
CVE-2008-3640
CVE-2008-3641, without SP_select_pen() in STR #2911, and fix an
additional off-by-one (STR #2966)
CVE-2009-0163
CVE-2009-0949

ok robert@@
@
text
@a0 42
$OpenBSD$

CVE-2008-0053

--- filter/hpgl-input.c.orig	Wed Feb 22 14:21:50 2006
+++ filter/hpgl-input.c	Sat Jun 20 22:51:35 2009
@@@@ -56,6 +56,7 @@@@ ParseCommand(FILE    *fp,	/* I - File to read from */
 		i;		/* Looping var */
   char		buf[262144],	/* String buffer */
 		*bufptr;	/* Pointer into buffer */
+  float		temp;		/* Temporary parameter value */
   static param_t p[MAX_PARAMS];	/* Parameter buffer */
 
 
@@@@ -214,10 +215,10 @@@@ ParseCommand(FILE    *fp,	/* I - File to read from */
       case '-' :
       case '+' :
           ungetc(ch, fp);
-          fscanf(fp, "%f", &(p[num_params].value.number));
-          if (num_params < MAX_PARAMS)
+          if (fscanf(fp, "%f", &temp) == 1 && num_params < MAX_PARAMS)
           {
-            p[num_params].type = PARAM_RELATIVE;
+            p[num_params].type         = PARAM_RELATIVE;
+            p[num_params].value.number = temp;
             num_params ++;
           }
           break;
@@@@ -233,10 +234,10 @@@@ ParseCommand(FILE    *fp,	/* I - File to read from */
       case '9' :
       case '.' :
           ungetc(ch, fp);
-          fscanf(fp, "%f", &(p[num_params].value.number));
-          if (num_params < MAX_PARAMS)
+          if (fscanf(fp, "%f", &temp) == 1 && num_params < MAX_PARAMS)
           {
-            p[num_params].type = PARAM_ABSOLUTE;
+            p[num_params].type         = PARAM_ABSOLUTE;
+            p[num_params].value.number = temp;
             num_params ++;
           }
           break;
@

