head	1.6;
access;
symbols
	OPENBSD_5_4:1.3.0.2
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.1.0.2
	OPENBSD_5_2_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2014.01.08.18.13.56;	author ajacoutot;	state dead;
branches;
next	1.5;

1.5
date	2013.10.30.08.35.55;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2013.08.15.14.54.27;	author ajacoutot;	state dead;
branches;
next	1.3;

1.3
date	2013.03.19.08.49.14;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2012.08.04.14.37.04;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2012.02.16.22.12.08;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to cups-1.7.1.
@
text
@$OpenBSD: patch-scheduler_log_c,v 1.5 2013/10/30 08:35:55 ajacoutot Exp $

From upstream: fix job history.

--- scheduler/log.c.orig	Wed May 29 13:51:34 2013
+++ scheduler/log.c	Wed Oct 30 09:27:08 2013
@@@@ -496,12 +496,13 @@@@ cupsdLogJob(cupsd_job_t *job,		/* I - Job */
       */
 
       cupsd_joblog_t *temp;		/* Copy of log message */
+      size_t         log_len = strlen(log_line);
+					/* Length of log message */
 
-
-      if ((temp = malloc(sizeof(cupsd_joblog_t) + strlen(log_line))) != NULL)
+      if ((temp = malloc(sizeof(cupsd_joblog_t) + log_len)) != NULL)
       {
         temp->time = time(NULL);
-	strlcpy(temp->message, log_line, sizeof(temp->message));
+	memcpy(temp->message, log_line, log_len + 1);
       }
 
       if (!job->history)
@


1.5
log
@Fix job history, from upstream via Fedora.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.4
log
@Remove, we have 64-bit time_t.
@
text
@d1 1
a1 1
$OpenBSD: patch-scheduler_log_c,v 1.3 2013/03/19 08:49:14 ajacoutot Exp $
d3 1
a3 1
log.c:289: warning: passing argument 1 of 'localtime' from incompatible pointer type
d5 4
a8 13
--- scheduler/log.c.orig	Wed Dec 12 19:03:02 2012
+++ scheduler/log.c	Tue Mar 19 08:15:45 2013
@@@@ -251,6 +251,7 @@@@ char *					/* O - Date/time string */
 cupsdGetDateTime(struct timeval *t,	/* I - Time value or NULL for current */
                  cupsd_time_t   format)	/* I - Format to use */
 {
+  time_t tmp;
   struct timeval	curtime;	/* Current time value */
   struct tm		*date;		/* Date/time value */
   static struct timeval	last_time = { 0, 0 };
@@@@ -302,7 +303,8 @@@@ cupsdGetDateTime(struct timeval *t,	/* I - Time value 
     * (*BSD and Darwin store the timezone offset in the tm structure)
     */
d10 3
a12 3
-    date = localtime(&(t->tv_sec));
+    tmp = t->tv_sec;
+    date = localtime (&tmp);
d14 10
a23 2
     if (format == CUPSD_TIME_STANDARD)
       snprintf(s, sizeof(s), "[%02d/%s/%04d:%02d:%02d:%02d %+03ld%02ld]",
@


1.3
log
@Update to cups-1.6.2.
@
text
@d1 1
a1 1
$OpenBSD: patch-scheduler_log_c,v 1.2 2012/08/04 14:37:04 ajacoutot Exp $
@


1.2
log
@Major update to CUPS 1.6.1.
This package is now split between -main (the bloat) and -libs (i.e.
cups-libs; which only contains the base libraries which have no
external deps).
Most filters have moved to cups-filters, the split was needed because
cups depends on cups-filters which depends on cups

The nice side-effect is that this will simplify lots of things in tree.
@
text
@d1 1
a1 1
$OpenBSD$
d5 3
a7 3
--- scheduler/log.c.orig	Thu Jan  5 06:50:57 2012
+++ scheduler/log.c	Sat Feb  4 15:58:39 2012
@@@@ -235,6 +235,7 @@@@ char *					/* O - Date/time string */
d15 1
a15 1
@@@@ -286,7 +287,8 @@@@ cupsdGetDateTime(struct timeval *t,	/* I - Time value 
@


1.1
log
@Update to cups-1.5.2.
While here, create cups's printcap under /etc/cups/ because we are
running unpriviledged so we cannot touch /etc/printcap.
Tweak rc script accordingly.
@
text
@d5 2
a6 2
--- scheduler/log.c.orig	Mon Feb  6 13:30:19 2012
+++ scheduler/log.c	Mon Feb  6 13:31:24 2012
@

