head	1.9;
access;
symbols
	OPENBSD_5_4:1.8.0.6
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.4
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.8.0.2
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.2
	OPENBSD_5_0:1.5.0.4
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.2
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.4.0.2
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.9
date	2013.12.12.14.56.12;	author ajacoutot;	state dead;
branches;
next	1.8;

1.8
date	2012.04.11.15.47.48;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2012.02.17.15.44.16;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2011.08.25.10.39.46;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2011.01.02.07.31.23;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2010.05.07.16.08.54;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.04.12.16.34.49;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.03.21.14.39.40;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2009.12.10.10.57.21;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Remove foomatic-filters; dead upstream and superseded with cups-filters.
@
text
@$OpenBSD: patch-foomaticrip_c,v 1.8 2012/04/11 15:47:48 ajacoutot Exp $

From pkgsrc.
Prevent bogus 'Job does not start with "%!", is it PostScript?' errors.

--- foomaticrip.c.orig	Fri Mar 23 13:28:34 2012
+++ foomaticrip.c	Wed Apr 11 17:43:02 2012
@@@@ -180,7 +180,7 @@@@ char cupsfilterpath[PATH_MAX] = "/usr/local/lib/cups/f
                                 "/opt/cups/filter:"
                                 "/usr/lib/cups/filter";
 
-char modern_shell[64] = "/bin/bash";
+char modern_shell[64] = "/bin/ksh";
 
 void config_set_option(const char *key, const char *value)
 {
@@@@ -1076,6 +1076,7 @@@@ int print_file(const char *filename, int convert)
                 if (dup2(fileno(out), fileno(stdin)) < 0)
                     rip_die(EXIT_PRNERR_NORETRY_BAD_SETTINGS,
                             "Couldn't dup stdout of pdf-to-ps\n");
+		rewind(stdin);
 
                 ret = print_file("<STDIN>", 0);
 
@@@@ -1107,6 +1108,7 @@@@ int print_file(const char *filename, int convert)
             /* Read further data from the file converter and not from STDIN */
             if (dup2(fileno(fchandle), fileno(stdin)) < 0)
                 rip_die(EXIT_PRNERR_NORETRY_BAD_SETTINGS, "Couldn't dup fileconverterhandle\n");
+	    rewind(stdin);
 
             ret = print_file("<STDIN>", 0);
 
@


1.8
log
@Updtae to foomatic-filters-4.0.15.
@
text
@d1 1
a1 1
$OpenBSD: patch-foomaticrip_c,v 1.7 2012/02/17 15:44:16 ajacoutot Exp $
@


1.7
log
@Update to foomatic-filters-4.0.12.
@
text
@d1 1
a1 1
$OpenBSD: patch-foomaticrip_c,v 1.6 2011/08/25 10:39:46 ajacoutot Exp $
d6 2
a7 2
--- foomaticrip.c.orig	Fri Feb 10 22:28:45 2012
+++ foomaticrip.c	Fri Feb 17 16:39:46 2012
d17 1
a17 1
@@@@ -1071,6 +1071,7 @@@@ int print_file(const char *filename, int convert)
d25 1
a25 1
@@@@ -1102,6 +1103,7 @@@@ int print_file(const char *filename, int convert)
@


1.6
log
@Update to foomatic-filters-4.0.9.
@
text
@d1 1
a1 1
$OpenBSD: patch-foomaticrip_c,v 1.5 2011/01/02 07:31:23 ajacoutot Exp $
d6 12
a17 3
--- foomaticrip.c.orig	Mon Jul 25 23:29:09 2011
+++ foomaticrip.c	Thu Aug 25 12:11:40 2011
@@@@ -1068,6 +1068,7 @@@@ int print_file(const char *filename, int convert)
d25 1
a25 1
@@@@ -1099,6 +1100,7 @@@@ int print_file(const char *filename, int convert)
@


1.5
log
@Bugfix update to foomatic-filters-4.0.6.
@
text
@d1 1
a1 1
$OpenBSD: patch-foomaticrip_c,v 1.4 2010/05/07 16:08:54 ajacoutot Exp $
d6 3
a8 3
--- foomaticrip.c.orig	Wed Dec 15 17:19:21 2010
+++ foomaticrip.c	Sun Jan  2 08:01:07 2011
@@@@ -1059,6 +1059,7 @@@@ int print_file(const char *filename, int convert)
d16 1
a16 1
@@@@ -1090,6 +1091,7 @@@@ int print_file(const char *filename, int convert)
@


1.4
log
@Bring a couple of patches from pkgsrc that prevent bogus
'Job does not start with "%!", is it PostScript?' errors.

issue was reported by pirofti@@ some time ago
@
text
@d1 1
a1 1
$OpenBSD: patch-foomaticrip_c,v 1.3 2010/04/12 16:34:49 ajacoutot Exp $
d6 3
a8 3
--- foomaticrip.c.orig	Fri May  7 17:58:43 2010
+++ foomaticrip.c	Fri May  7 18:00:38 2010
@@@@ -1053,6 +1053,7 @@@@ int print_file(const char *filename, int convert)
d16 1
a16 1
@@@@ -1084,6 +1085,7 @@@@ int print_file(const char *filename, int convert)
@


1.3
log
@Use ksh as default "modern_shell".
@
text
@d1 12
a12 4
$OpenBSD: patch-foomaticrip_c,v 1.2 2010/03/21 14:39:40 ajacoutot Exp $
--- foomaticrip.c.orig	Mon Feb 15 13:57:40 2010
+++ foomaticrip.c	Sun Mar 21 15:28:12 2010
@@@@ -173,11 +173,11 @@@@ char echopath[PATH_MAX] = "echo";
d14 1
a14 6
 /* CUPS raster drivers are searched here */
 char cupsfilterpath[PATH_MAX] = "/usr/local/lib/cups/filter:"
-                                "/usr/local/libexec/cups/filter:"
+                                "${LOCALBASE}/libexec/cups/filter:"
                                 "/opt/cups/filter:"
                                 "/usr/lib/cups/filter";
d16 7
a22 2
-char modern_shell[64] = "/bin/bash";
+char modern_shell[64] = "/bin/ksh";
a23 2
 void config_set_option(const char *key, const char *value)
 {
@


1.2
log
@Update to foomatic-filters-4.0.4.
Get rid of the libgs dependency.
@
text
@d1 1
a1 1
$OpenBSD: patch-foomaticrip_c,v 1.1 2009/12/10 10:57:21 ajacoutot Exp $
d14 1
a14 1
+char modern_shell[64] = "/bin/sh";
@


1.1
log
@Update to foomatic-filters-4.0.3.
(rewritten from perl to c)
@
text
@d1 4
a4 4
$OpenBSD$
--- foomaticrip.c.orig	Wed Aug 19 20:08:41 2009
+++ foomaticrip.c	Thu Dec 10 11:21:04 2009
@@@@ -151,11 +151,11 @@@@ char echopath[PATH_MAX] = "echo";
@

