head	1.4;
access;
symbols
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2011.01.02.07.31.23;	author ajacoutot;	state dead;
branches;
next	1.3;

1.3
date	2010.11.11.12.55.24;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.08.22.06.56.25;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.04.27.14.01.43;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Bugfix update to foomatic-filters-4.0.6.
@
text
@$OpenBSD: patch-util_c,v 1.3 2010/11/11 12:55:24 ajacoutot Exp $

Upstream r240.

--- util.c.orig	Tue Aug 10 12:08:04 2010
+++ util.c	Thu Nov 11 13:46:24 2010
@@@@ -39,14 +39,15 @@@@ const char * temp_dir()
 
     if (!tmpdir)
     {
-        const char *dirs[] = { getenv("TMPDIR"), P_tmpdir, "/tmp", NULL };
-        const char **dir;
+        const char *dirs[] = { getenv("TMPDIR"), P_tmpdir, "/tmp" };
+        int i;
 
-        for (dir = dirs; *dir; dir++)
-            if (access(*dir, W_OK) == 0) {
-                tmpdir = *dir;
+        for (i = 0; i < (sizeof(dirs) / sizeof(dirs[0])); i++) {
+            if (access(dirs[i], W_OK) == 0) {
+                tmpdir = dirs[i];
                 break;
             }
+        }
         if (tmpdir)
         {
             _log("Storing temporary files in %s\n", tmpdir);
@@@@ -162,6 +163,7 @@@@ strcasestr (const char *haystack, const char *needle)
 }
 #endif
 
+#ifndef __OpenBSD__
 size_t strlcpy(char *dest, const char *src, size_t size)
 {
     char *pdest = dest;
@@@@ -201,6 +203,7 @@@@ size_t strlcat(char *dest, const char *src, size_t siz
 
     return len + (psrc - src);
 }
+#endif /* ! __OpenBSD__ */
 
 void strrepl(char *str, const char *chars, char repl)
 {
@


1.3
log
@Add a couple of upstream patches from Abel Abraham Camarillo Ojeda to
fix some lpr usages.
@
text
@d1 1
a1 1
$OpenBSD: patch-util_c,v 1.2 2010/08/22 06:56:25 ajacoutot Exp $
@


1.2
log
@Update to foomatic-filters-4.0.5.
@
text
@d1 4
a4 1
$OpenBSD: patch-util_c,v 1.1 2010/04/27 14:01:43 ajacoutot Exp $
d6 23
a28 2
+++ util.c	Sun Aug 22 07:15:52 2010
@@@@ -162,6 +162,7 @@@@ strcasestr (const char *haystack, const char *needle)
d36 1
a36 1
@@@@ -201,6 +202,7 @@@@ size_t strlcat(char *dest, const char *src, size_t siz
@


1.1
log
@Fix build on a clean machine by not checking for a file converter.
breakage reported by jasper@@

While here:
* remove the ppr stuffs
* remove bundled strlcpy / strlcat
@
text
@d1 6
a6 6
$OpenBSD$
--- util.c.orig	Mon Apr 19 10:28:13 2010
+++ util.c	Mon Apr 19 10:28:55 2010
@@@@ -138,6 +138,7 @@@@ int omit_shellescapes(int c) { return strchr(shellesca
 int omit_specialchars(int c) { return omit_unprintables(c) || omit_shellescapes(c); }
 int omit_whitespace(int c) { return c == ' ' || c == '\t'; }
d12 1
a12 1
@@@@ -177,6 +178,7 @@@@ size_t strlcat(char *dest, const char *src, size_t siz
@

