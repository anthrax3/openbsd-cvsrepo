head	1.2;
access;
symbols
	OPENBSD_3_5:1.1.1.1.0.14
	OPENBSD_3_5_BASE:1.1.1.1
	OPENBSD_3_4:1.1.1.1.0.12
	OPENBSD_3_4_BASE:1.1.1.1
	OPENBSD_3_3:1.1.1.1.0.10
	OPENBSD_3_3_BASE:1.1.1.1
	OPENBSD_3_2:1.1.1.1.0.8
	OPENBSD_3_2_BASE:1.1.1.1
	OPENBSD_3_1:1.1.1.1.0.6
	OPENBSD_3_1_BASE:1.1.1.1
	OPENBSD_3_0:1.1.1.1.0.4
	OPENBSD_3_0_BASE:1.1.1.1
	OPENBSD_2_9_TRACKING_SWITCH:1.1.1.1
	OPENBSD_2_9:1.1.1.1.0.2
	OPENBSD_2_9_BASE:1.1.1.1
	avsm-2001-01-12:1.1.1.1
	avsm:1.1.1;
locks; strict;
comment	@ * @;


1.2
date	2004.05.09.19.18.55;	author pvalchev;	state dead;
branches;
next	1.1;

1.1
date	2001.01.12.23.21.07;	author avsm;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.01.12.23.21.07;	author avsm;	state Exp;
branches;
next	;


desc
@@


1.2
log
@remove - this has been marked with IGNORE and been part of teTeX for over a year
@
text
@$OpenBSD: patch-psimage.c,v 1.1 2001/01/12 23:21:07 avsm Exp $

Cures a /tmp race condition when converting embedded eps/ps formats
to pdf, using external applications.  It needs cleaning up, and fallback
via autoconf before submission back to authors - avsm@@

--- psimage.c.orig	Fri Oct 13 21:36:47 2000
+++ psimage.c	Thu Jan 11 23:40:40 2001
@@@@ -113,10 +113,18 @@@@ pdf_obj *ps_include (char *file_name, 
 {
 #ifdef HAVE_SYSTEM
   pdf_obj *result = NULL;
-  char *tmp, *cmd;
+  char *cmd, tmp[30];
   FILE *pdf_file = NULL;
-  /* Get a full qualified tmp name */
-  tmp = tmpnam (NULL);
+  int fd = -1;
+
+  strlcpy(tmp, "/tmp/dvipdfm.XXXXXXXXXXXX", sizeof(tmp));
+  /* Get a full qualified tmp name and create it in one operation */
+  if ((fd=mkstemp(tmp)) == -1) {
+    fprintf(stderr, "\nError opening tmp file %s: %s\n", tmp, strerror(errno));
+    return NULL;
+  }
+  close(fd);
+
   if ((cmd = build_command_line (file_name, tmp))) {
     if (!system (cmd) && (pdf_file = MFOPEN (tmp, FOPEN_RBIN_MODE))) {
       result = pdf_include_page (pdf_file, p, res_name);
@@@@ -125,10 +133,11 @@@@ pdf_obj *ps_include (char *file_name, 
     }
     if (pdf_file) {
       MFCLOSE (pdf_file);
-      remove (tmp);
     }
     RELEASE (cmd);
   }
+
+  unlink(tmp);
   return result;
 #else
   fprintf (stderr, "\n\nCannot include PS/EPS files unless you have and enable system() command.\n");
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@- import of dvipdfm-0.13.2
- patch to cure /tmp race condition added; it needs cleaning up before
  submitting back to authors though (espie@@ ok)

--
Dvipdfm is a command-line DVI to PDF translator.

Its features include TeX \special's that approximate the functionality
of the PostScript pdfmarks used by Adobe Acrobat Distiller, the
ability to include PDF files and JPEG files as embedded images,
support for both Type1 and PK fonts, support for arbitrary linear
graphics transformations, a color stack accessible via \special's,
partial font embedding and stream compression for reduced output
file size, native, portable graphics via TPIC \specials, balanced
page and destination trees for improved reader access on very large
document files.

@
text
@@
