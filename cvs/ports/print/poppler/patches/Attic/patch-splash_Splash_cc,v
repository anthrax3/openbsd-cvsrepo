head	1.4;
access;
symbols
	OPENBSD_4_6:1.4.0.2
	OPENBSD_4_2:1.1.0.6
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_0:1.1.0.4
	OPENBSD_4_1:1.1.0.2;
locks; strict;
comment	@# @;


1.4
date	2009.10.26.19.23.46;	author kili;	state dead;
branches
	1.4.2.1;
next	1.3;

1.3
date	2009.10.15.20.43.40;	author kili;	state Exp;
branches;
next	1.2;

1.2
date	2007.12.07.19.55.58;	author kili;	state dead;
branches;
next	1.1;

1.1
date	2007.07.31.22.22.01;	author kili;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2007.08.02.09.47.32;	author ajacoutot;	state Exp;
branches;
next	;

1.1.4.1
date	2007.08.09.17.14.09;	author ajacoutot;	state Exp;
branches;
next	;

1.4.2.1
date	2009.11.12.02.14.55;	author william;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to poppler-0.12.1.

Contains the xpdf-3.02pl4 diffs and some additional bug fixes.

ok ajacoutot@@
@
text
@$OpenBSD: patch-splash_Splash_cc,v 1.3 2009/10/15 20:43:40 kili Exp $
--- splash/Splash.cc.orig	Wed Sep  2 20:48:16 2009
+++ splash/Splash.cc	Thu Oct 15 20:24:10 2009
@@@@ -27,6 +27,7 @@@@
 
 #include <stdlib.h>
 #include <string.h>
+#include <limits.h>
 #include "goo/gmem.h"
 #include "SplashErrorCodes.h"
 #include "SplashMath.h"
@@@@ -2001,6 +2002,9 @@@@ SplashError Splash::fillImageMask(SplashImageMaskSourc
   xq = w % scaledWidth;
 
   // allocate pixel buffer
+  if (yp < 0 || yp > INT_MAX - 1) {
+    return splashErrBadArg;
+  }
   pixBuf = (SplashColorPtr)gmallocn((yp + 1), w);
 
   // initialize the pixel pipe
@@@@ -2301,6 +2305,9 @@@@ SplashError Splash::drawImage(SplashImageSource src, v
   xq = w % scaledWidth;
 
   // allocate pixel buffers
+  if (yp < 0 || yp > INT_MAX - 1 || w > INT_MAX / nComps) {
+    return splashErrBadArg;
+  }
   colorBuf = (SplashColorPtr)gmallocn3((yp + 1), w, nComps);
   if (srcAlpha) {
     alphaBuf = (Guchar *)gmallocn((yp + 1), w);
@


1.4.2.1
log
@Apply xpdf security patches for:

CVE-2009-3603
CVE-2009-3604
CVE-2009-3606
CVE-2009-3608
CVE-2009-3609

from kili@@, thanks!

ok jasper@@
@
text
@d1 3
a3 12
xpdf security patches for:

CVE-2009-3603
CVE-2009-3604
CVE-2009-3606
CVE-2009-3608
CVE-2009-3609


$OpenBSD$
--- splash/Splash.cc.orig	Sat May  2 14:14:57 2009
+++ splash/Splash.cc	Sat Oct 24 21:47:42 2009
d12 1
a12 1
@@@@ -2001,7 +2002,10 @@@@ SplashError Splash::fillImageMask(SplashImageMaskSourc
a15 1
-  pixBuf = (SplashColorPtr)gmalloc((yp + 1) * w);
d19 1
a19 1
+  pixBuf = (SplashColorPtr)gmallocn(yp + 1, w);
d22 1
a22 2
   pipeInit(&pipe, 0, 0, state->fillPattern, NULL, state->fillAlpha,
@@@@ -2301,9 +2305,12 @@@@ SplashError Splash::drawImage(SplashImageSource src, v
a25 1
-  colorBuf = (SplashColorPtr)gmalloc((yp + 1) * w * nComps);
d29 1
a29 1
+  colorBuf = (SplashColorPtr)gmallocn(yp + 1, w * nComps);
d31 1
a31 5
-    alphaBuf = (Guchar *)gmalloc((yp + 1) * w);
+    alphaBuf = (Guchar *)gmallocn(yp + 1, w);
   } else {
     alphaBuf = NULL;
   }
@


1.3
log
@Merge security fixes from xpdf.

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@
SECURITY: Update to poppler 0.6.2 (fixes CVE-2007-3387).

ok landry@@
@
text
@d1 4
a4 11
$OpenBSD: patch-splash_Splash_cc,v 1.1 2007/07/31 22:22:01 kili Exp $

Fix CVE-2006-0301. From poppler mailinglist archives (also in the
POPPLER_0_4_X branch, but not merged into 0.5 until the xpdf 3.02
merge in the "unstable" 0.5.9 release).

--- splash/Splash.cc.orig	Mon Jul 24 21:04:51 2006
+++ splash/Splash.cc	Wed Jul 25 22:48:11 2007
@@@@ -950,6 +950,10 @@@@ void Splash::drawPixel(int x, int y, SplashColorPtr co
   int alpha2, ialpha2;
   Guchar t;
d6 8
a13 10
+  if ( (unsigned) x >= (unsigned) bitmap->getWidth() ||
+       (unsigned) y >= (unsigned) bitmap->getHeight())
+    return;
+
   if (noClip || state->clip->test(x, y)) {
     if (alpha != 1 || softMask || state->blendFunc) {
       blendFunc = state->blendFunc ? state->blendFunc : &blendNormal;
@@@@ -1243,6 +1247,11 @@@@ void Splash::drawSpan(int x0, int x1, int y, SplashPat
     updateModY(y);
   }
d15 5
a19 17
+  if ((unsigned) x0 >= (unsigned) bitmap->getWidth() ||
+      (unsigned) x1 >= (unsigned) bitmap->getWidth() ||
+      (unsigned) y >= (unsigned) bitmap->getHeight())
+    return;
+
   if (alpha != 1 || softMask || state->blendFunc) {
     blendFunc = state->blendFunc ? state->blendFunc : &blendNormal;
     if (softMask) {
@@@@ -1950,6 +1959,11 @@@@ void Splash::xorSpan(int x0, int x1, int y, SplashPatt
     updateModX(x1);
     updateModY(y);
   }
+
+  if ((unsigned) x0 >= (unsigned) bitmap->getWidth() ||
+      (unsigned) x1 >= (unsigned) bitmap->getWidth() ||
+      (unsigned) y >= (unsigned) bitmap->getHeight())
+    return;
d21 11
a31 2
   switch (bitmap->mode) {
   case splashModeMono1:
@


1.1
log
@
SECURITY:

CVE-2006-0301 (fixed upstream in 0.4 but not merged into
0.5 before the "unstable" 0.5.9 got the xpdf 3.02 merge).

CVE-2007-0104 (fixed in CVS and in development version by merging
xpdf 3.02, but not in the "stable" version).

CVE-2007-3387 (from xpdf patch).

While here, remove quotes from COMMENT-* and fix WANTLIB-*.

ok naddy@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@MFC (original commit kili@@):
- import patches from -current

CVE-2006-0301 (fixed upstream in 0.4 but not merged into 0.5 before the
"unstable" 0.5.9 got the xpdf 3.02 merge)

CVE-2007-0104 (fixed in CVS and in development version by merging xpdf
3.02, but not in the "stable" version)

CVE-2007-3387 (from xpdf patch)

ok sturm@@
@
text
@d2 8
a9 3
--- splash/Splash.cc.orig	Tue May 30 22:41:38 2006
+++ splash/Splash.cc	Wed Aug  1 10:35:11 2007
@@@@ -950,6 +950,10 @@@@ void Splash::drawPixel(int x, int y, Spl
d20 1
a20 1
@@@@ -1243,6 +1247,11 @@@@ void Splash::drawSpan(int x0, int x1, in
d32 1
a32 1
@@@@ -1950,6 +1959,11 @@@@ void Splash::xorSpan(int x0, int x1, int
@


1.1.2.1
log
@MFC (original commit kili@@):
- import patches from -current

CVE-2006-0301 (fixed upstream in 0.4 but not merged into 0.5 before the
"unstable" 0.5.9 got the xpdf 3.02 merge)

CVE-2007-0104 (fixed in CVS and in development version by merging xpdf
3.02, but not in the "stable" version)

CVE-2007-3387 (from xpdf patch)

ok sturm@@
@
text
@d2 8
a9 3
--- splash/Splash.cc.orig	Tue May 30 22:41:38 2006
+++ splash/Splash.cc	Wed Aug  1 10:43:03 2007
@@@@ -950,6 +950,10 @@@@ void Splash::drawPixel(int x, int y, Spl
d20 1
a20 1
@@@@ -1243,6 +1247,11 @@@@ void Splash::drawSpan(int x0, int x1, in
d32 1
a32 1
@@@@ -1950,6 +1959,11 @@@@ void Splash::xorSpan(int x0, int x1, int
@

