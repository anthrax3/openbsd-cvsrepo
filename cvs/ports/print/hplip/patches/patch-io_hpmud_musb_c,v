head	1.11;
access;
symbols
	OPENBSD_6_1:1.11.0.2
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.10.0.4
	OPENBSD_6_0_BASE:1.10
	OPENBSD_5_9:1.10.0.2
	OPENBSD_5_9_BASE:1.10
	OPENBSD_5_8:1.9.0.4
	OPENBSD_5_8_BASE:1.9
	OPENBSD_5_7:1.7.0.2
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.6.0.6
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.4
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.2
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.5.0.2
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.4.0.2
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.6
	OPENBSD_5_0:1.3.0.4
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.2
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.11
date	2016.10.27.08.35.26;	author ajacoutot;	state Exp;
branches;
next	1.10;
commitid	MWoQF9QTYwy5nC48;

1.10
date	2015.11.17.08.57.45;	author ajacoutot;	state Exp;
branches;
next	1.9;
commitid	tRS8kHY5YvNbAbpv;

1.9
date	2015.04.17.04.18.13;	author ajacoutot;	state Exp;
branches;
next	1.8;
commitid	bILtsWtTVnQjIsVx;

1.8
date	2015.03.15.08.46.52;	author ajacoutot;	state Exp;
branches;
next	1.7;
commitid	D8HQhpiLYeYblY7S;

1.7
date	2014.10.08.09.03.00;	author ajacoutot;	state Exp;
branches
	1.7.2.1;
next	1.6;
commitid	fkLZs2SMIuF5DwKr;

1.6
date	2013.03.08.06.51.46;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2012.12.10.16.00.12;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2012.06.26.06.17.11;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.10.31.07.43.44;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.03.21.11.07.43;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2009.07.13.08.14.28;	author ajacoutot;	state Exp;
branches;
next	;

1.7.2.1
date	2015.03.18.18.04.31;	author ajacoutot;	state Exp;
branches;
next	;
commitid	bIKGxXyCHeZ147n6;


desc
@@


1.11
log
@Update to hplip-3.16.10.
@
text
@$OpenBSD: patch-io_hpmud_musb_c,v 1.10 2015/11/17 08:57:45 ajacoutot Exp $

backwards memcpy

--- io/hpmud/musb.c.orig	Fri Oct 21 12:48:40 2016
+++ io/hpmud/musb.c	Thu Oct 27 10:27:48 2016
@@@@ -775,7 +775,7 @@@@ static int device_id(int fd, unsigned char *buffer, in
         len = size-1;   /* leave byte for zero termination */
     if (len > 2)
         len -= 2;
-    memcpy(buffer, buffer+2, len);    /* remove length */
+    memmove(buffer, buffer+2, len);    /* remove length */
     buffer[len]=0;
     DBG("read actual device_id successfully fd=%d len=%d\n", fd, len);
 
@@@@ -1262,7 +1262,7 @@@@ enum HPMUD_RESULT __attribute__ ((visibility ("hidden"
 
     if (*len)
     {
-        memcpy(buf, pd->id, *len > size ? size : *len);
+        memmove(buf, pd->id, *len > size ? size : *len);
         stat = HPMUD_R_OK;
     }
 
@


1.10
log
@Update to hplip-3.15.11.
@
text
@d1 1
a1 1
$OpenBSD: patch-io_hpmud_musb_c,v 1.9 2015/04/17 04:18:13 ajacoutot Exp $
d5 3
a7 3
--- io/hpmud/musb.c.orig	Thu Nov 12 11:29:02 2015
+++ io/hpmud/musb.c	Tue Nov 17 09:23:50 2015
@@@@ -774,7 +774,7 @@@@ static int device_id(int fd, unsigned char *buffer, in
d16 1
a16 1
@@@@ -1261,7 +1261,7 @@@@ enum HPMUD_RESULT __attribute__ ((visibility ("hidden"
@


1.9
log
@Update to hplip-3.15.4.
@
text
@d1 1
a1 1
$OpenBSD: patch-io_hpmud_musb_c,v 1.8 2015/03/15 08:46:52 ajacoutot Exp $
d5 3
a7 3
--- io/hpmud/musb.c.orig	Tue Apr 14 11:53:07 2015
+++ io/hpmud/musb.c	Fri Apr 17 05:54:22 2015
@@@@ -770,7 +770,7 @@@@ static int device_id(int fd, unsigned char *buffer, in
d16 1
a16 1
@@@@ -1256,7 +1256,7 @@@@ enum HPMUD_RESULT __attribute__ ((visibility ("hidden"
@


1.8
log
@Fix a backwards memcpy and some debug output.

reported by Alessandro DE LAURENZIS
memmove patch by from dcoppa@@
@
text
@d1 1
a1 3
$OpenBSD: patch-io_hpmud_musb_c,v 1.7 2014/10/08 09:03:00 ajacoutot Exp $

Fix probing HP PS 8250 printer, from FreeBSD.
d5 10
a14 33
--- io/hpmud/musb.c.orig	Thu Jan 29 13:20:45 2015
+++ io/hpmud/musb.c	Wed Mar 11 15:42:47 2015
@@@@ -25,6 +25,7 @@@@
 Author: Naga Samrat Chowdary Narla, Sarbeswar Meher
 \*****************************************************************************/
 
+#include <stdlib.h> /* atoi(3) */
 #include "hpmud.h"
 #include "hpmudi.h"
 #include <dlfcn.h>
@@@@ -139,8 +140,12 @@@@ static int get_string_descriptor(libusb_device_handle 
 
 		if (ret==0)
 		{
-			/* This retry is necessary for lj1000 and lj1005. des 12/12/07 */
-			BUG("get_string_descriptor zero result, retrying...");
+			/*
+			 * This retry is necessary for lj1000 and lj1005. des 12/12/07
+			 * Also HP Photosmart 42xx seems to suffer transient errors with serial id
+			 */
+			BUG("get_string_descriptor error result %d, retrying in 2 secs...", ret);
+			sleep(2);
 			continue;
 		}
 		break;
@@@@ -769,7 +774,7 @@@@ static int device_id(int fd, unsigned char *buffer, in
 		len = size-1;   /* leave byte for zero termination */
 	if (len > 2)
 		len -= 2;
-	memcpy(buffer, buffer+2, len);    /* remove length */
+	memmove(buffer, buffer+2, len);    /* remove length */
 	buffer[len]=0;
 	DBG("read actual device_id successfully fd=%d len=%d\n", fd, len);
d16 1
a16 1
@@@@ -1254,7 +1259,7 @@@@ enum HPMUD_RESULT __attribute__ ((visibility ("hidden"
d18 6
a23 6
 	if (*len)
 	{
-		memcpy(buf, pd->id, *len > size ? size : *len);
+		memmove(buf, pd->id, *len > size ? size : *len);
 		stat = HPMUD_R_OK;
 	}
@


1.7
log
@Update to hplip-3.14.10.
@
text
@d1 1
a1 1
$OpenBSD: patch-io_hpmud_musb_c,v 1.6 2013/03/08 06:51:46 ajacoutot Exp $
d5 4
a8 2
--- io/hpmud/musb.c.orig	Tue Oct  7 10:55:54 2014
+++ io/hpmud/musb.c	Wed Oct  8 10:32:17 2014
d32 18
@


1.7.2.1
log
@Unbreak runtime: fix backwards memcpy.
@
text
@d1 1
a1 1
$OpenBSD: patch-io_hpmud_musb_c,v 1.7 2014/10/08 09:03:00 ajacoutot Exp $
d5 2
a6 4
backwards memcpy

--- io/hpmud/musb.c.orig	Thu Jan 29 13:20:45 2015
+++ io/hpmud/musb.c	Wed Mar 11 15:42:47 2015
a29 18
@@@@ -769,7 +774,7 @@@@ static int device_id(int fd, unsigned char *buffer, in
 		len = size-1;   /* leave byte for zero termination */
 	if (len > 2)
 		len -= 2;
-	memcpy(buffer, buffer+2, len);    /* remove length */
+	memmove(buffer, buffer+2, len);    /* remove length */
 	buffer[len]=0;
 	DBG("read actual device_id successfully fd=%d len=%d\n", fd, len);
 
@@@@ -1254,7 +1259,7 @@@@ enum HPMUD_RESULT __attribute__ ((visibility ("hidden"
 
 	if (*len)
 	{
-		memcpy(buf, pd->id, *len > size ? size : *len);
+		memmove(buf, pd->id, *len > size ? size : *len);
 		stat = HPMUD_R_OK;
 	}
 
@


1.6
log
@Update to hplip-3.13.2.

Some parts of the tools are still somewhat WIP; however, thanks to a
donation from linuxfund.org this has been successfully tested on a HP
OfficeJet 7500 e910, using STP discovery over WiFi with automatic PPD
generation. Scanning, printing, cartridge information... working.
@
text
@d1 1
a1 1
$OpenBSD: patch-io_hpmud_musb_c,v 1.5 2012/12/10 16:00:12 ajacoutot Exp $
d5 2
a6 2
--- io/hpmud/musb.c.orig	Wed Feb 13 17:38:44 2013
+++ io/hpmud/musb.c	Fri Feb 22 15:05:18 2013
d15 1
a15 1
@@@@ -138,8 +139,12 @@@@ static int get_string_descriptor(libusb_device_handle 
@


1.5
log
@Update to hplip-3.12.11.
@
text
@d1 1
a1 1
$OpenBSD: patch-io_hpmud_musb_c,v 1.4 2012/06/26 06:17:11 ajacoutot Exp $
d5 2
a6 2
--- io/hpmud/musb.c.orig	Tue Nov 20 10:55:09 2012
+++ io/hpmud/musb.c	Mon Dec 10 16:43:14 2012
d15 1
a15 1
@@@@ -137,8 +138,12 @@@@ static int get_string_descriptor(libusb_device_handle 
@


1.4
log
@Update to hplip-3.12.6.
@
text
@d1 1
a1 1
$OpenBSD: patch-io_hpmud_musb_c,v 1.3 2010/10/31 07:43:44 ajacoutot Exp $
d5 2
a6 2
--- io/hpmud/musb.c.orig	Mon Jun 18 12:44:11 2012
+++ io/hpmud/musb.c	Tue Jun 26 07:48:38 2012
d8 1
a8 1
   Author: Naga Samrat Chowdary Narla, Sarbeswar Meher
d14 2
d17 13
a29 13
@@@@ -135,8 +136,10 @@@@ static int get_string_descriptor(libusb_device_handle 
 
       if (ret==0)
       {
-         /* This retry is necessary for lj1000 and lj1005. des 12/12/07 */
-         BUG("get_string_descriptor zero result, retrying...");
+         /* This retry is necessary for lj1000 and lj1005. des 12/12/07
+          Also HP Photosmart 42xx seems to suffer transient errors with serial id */
+         BUG("get_string_descriptor error result %d, retrying in 2 secs...", ret);
+         sleep(2);
          continue;
       }
       break;
@


1.3
log
@Update to hplip-3.10.9 and move to new REVISION.
@
text
@d1 1
a1 1
$OpenBSD: patch-io_hpmud_musb_c,v 1.2 2010/03/21 11:07:43 ajacoutot Exp $
d5 12
a16 4
--- io/hpmud/musb.c.orig	Sun Sep 26 19:07:25 2010
+++ io/hpmud/musb.c	Sun Oct 31 07:30:55 2010
@@@@ -127,8 +127,10 @@@@ static int get_string_descriptor(usb_dev_handle *dev, 
                0x409, tbuf, sizeof(tbuf), LIBUSB_CONTROL_REQ_TIMEOUT);
@


1.2
log
@Major update to hplip-3.10.2.
Take maintainership.
Tweak, flush and fix dependencies...

Add some example on how to use hplip.
@
text
@d1 1
a1 1
$OpenBSD: patch-io_hpmud_musb_c,v 1.1 2009/07/13 08:14:28 ajacoutot Exp $
d5 3
a7 3
--- io/hpmud/musb.c.orig	Thu Feb 25 00:07:17 2010
+++ io/hpmud/musb.c	Fri Mar 12 13:40:17 2010
@@@@ -125,8 +125,10 @@@@ static int get_string_descriptor(usb_dev_handle *dev, 
@


1.1
log
@Major update to hplip-3.9.6b.
Refer to the project homepage for the complete changelog.

This port now comes into 5 subpackages (ala Fedora):
- main: complete hplip functionnalities
- hpijs: deprecated hpijs printer driver
- hpcups: new-gen printer driver
- libs: libraries and helpers used by other subpackages
- gui: graphical tools (systray applet...)

It seems this version works a least as good as the previous one we had
in-tree. I could use some feedbacks for the fancier stuffs that hplip
provides (besides regular printing using hpcups and/or hpijs), like
printer communication, ink levels... because I have no hp equipment, but
at least, there was no regression reported.
(some features are Linux-only and are expected not to work)

Tested by several, thanks!
@
text
@d1 1
a1 1
$OpenBSD$
d5 3
a7 3
--- io/hpmud/musb.c.orig	Thu Jun 25 21:05:49 2009
+++ io/hpmud/musb.c	Thu Jul  2 14:46:21 2009
@@@@ -124,8 +124,10 @@@@ static int get_string_descriptor(usb_dev_handle *dev, 
@

