head	1.27;
access;
symbols
	OPENBSD_6_2:1.27.0.6
	OPENBSD_6_2_BASE:1.27
	OPENBSD_6_1:1.27.0.4
	OPENBSD_6_1_BASE:1.27
	OPENBSD_6_0:1.27.0.2
	OPENBSD_6_0_BASE:1.27
	OPENBSD_5_9:1.25.0.2
	OPENBSD_5_9_BASE:1.25
	OPENBSD_5_8:1.24.0.4
	OPENBSD_5_8_BASE:1.24
	OPENBSD_5_7:1.21.0.2
	OPENBSD_5_7_BASE:1.21
	OPENBSD_5_6:1.19.0.2
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.18.0.2
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.15.0.2
	OPENBSD_5_4_BASE:1.15
	OPENBSD_5_3:1.12.0.2
	OPENBSD_5_3_BASE:1.12
	OPENBSD_5_2:1.10.0.2
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.9
	OPENBSD_5_1:1.9.0.2
	OPENBSD_5_0:1.7.0.4
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.2
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.6.0.2
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.5.0.2
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.3.0.4
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.2
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.2.0.2
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.1.1.1.0.2
	OPENBSD_4_3_BASE:1.1.1.1
	ajacoutot_20071102:1.1.1.1
	ajacoutot:1.1.1;
locks; strict;
comment	@# @;


1.27
date	2016.05.05.08.25.31;	author ajacoutot;	state Exp;
branches;
next	1.26;
commitid	ubMtX6EiV5lbaZ4T;

1.26
date	2016.02.25.03.50.37;	author ajacoutot;	state Exp;
branches;
next	1.25;
commitid	lw9sQXvVXMJ9s4Jg;

1.25
date	2015.11.17.08.57.45;	author ajacoutot;	state Exp;
branches;
next	1.24;
commitid	tRS8kHY5YvNbAbpv;

1.24
date	2015.06.11.06.25.07;	author ajacoutot;	state Exp;
branches;
next	1.23;
commitid	9Ncc6W0OtIaJz6Qe;

1.23
date	2015.04.17.04.18.13;	author ajacoutot;	state Exp;
branches;
next	1.22;
commitid	bILtsWtTVnQjIsVx;

1.22
date	2015.03.15.08.46.52;	author ajacoutot;	state Exp;
branches;
next	1.21;
commitid	D8HQhpiLYeYblY7S;

1.21
date	2015.02.05.17.34.33;	author ajacoutot;	state Exp;
branches
	1.21.2.1;
next	1.20;
commitid	yACkirWvCqnjFF6L;

1.20
date	2014.10.08.09.03.00;	author ajacoutot;	state Exp;
branches;
next	1.19;
commitid	fkLZs2SMIuF5DwKr;

1.19
date	2014.03.13.22.37.27;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2013.10.15.14.21.00;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2013.08.22.10.49.25;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2013.08.11.09.54.17;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2013.07.12.08.07.05;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2013.05.21.16.46.43;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2013.03.08.06.51.46;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2013.01.20.07.32.08;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2012.09.11.10.52.16;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2012.06.26.06.17.11;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2012.01.17.09.54.27;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2011.10.09.07.42.29;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2010.09.08.07.13.16;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2010.03.21.11.07.43;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2009.08.20.08.07.48;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2009.07.13.08.14.28;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2009.02.02.10.47.12;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2008.03.15.10.18.30;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2007.11.02.15.48.55;	author ajacoutot;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.11.02.15.48.55;	author ajacoutot;	state Exp;
branches;
next	;

1.21.2.1
date	2015.03.18.18.04.31;	author ajacoutot;	state Exp;
branches;
next	;
commitid	bIKGxXyCHeZ147n6;


desc
@@


1.27
log
@Update to hplip-3.16.5.
@
text
@$OpenBSD: patch-installer_core_install_py,v 1.26 2016/02/25 03:50:37 ajacoutot Exp $
--- installer/core_install.py.orig	Wed May  4 07:23:15 2016
+++ installer/core_install.py	Thu May  5 10:06:53 2016
@@@@ -110,7 +110,7 @@@@ HPLIP_LIST=['*.py','*.pyc', 'base', 'copier','data','i
 
 PLUGIN_LIST=['fax/plugins/','prnt/plugins/','scan/plugins/']
 
-PLUGIN_STATE =['/var/lib/hp/hplip.state']
+PLUGIN_STATE =['/var/db/hp/hplip.state']
 
 
 # end
@@@@ -228,7 +228,7 @@@@ class CoreInstall(object):
         self.endian = utils.LITTLE_ENDIAN
         self.distro, self.distro_name, self.distro_version = DISTRO_UNKNOWN, '', DISTRO_VER_UNKNOWN
         self.distro_version_supported = False
-        self.install_location = '/usr'
+        self.install_location = '${PREFIX}'
         self.hplip_present = False
         self.have_dependencies = {}
         self.native_cups = True
@@@@ -342,7 +342,7 @@@@ class CoreInstall(object):
             'cups-devel':       (True,  ['base'], CUPS_DEV_STR, self.check_cups_devel, DEPENDENCY_COMPILE_TIME,'-','cups-config --version', GENERALDEP),
             'cups-image':       (True,  ['base'], CUPS_IMG_STR, self.check_cups_image, DEPENDENCY_COMPILE_TIME,'-','cups-config --version', GENERALDEP),
             'gcc' :             (True,  ['base'], GCC_STR, self.check_gcc, DEPENDENCY_COMPILE_TIME, '-','gcc --version',COMPILEDEP),
-            'make' :            (True,  ['base'], MAKE_STR, self.check_make, DEPENDENCY_COMPILE_TIME,'3.0','make --version',COMPILEDEP),
+            'make' :            (True,  ['base'], MAKE_STR, self.check_make, DEPENDENCY_COMPILE_TIME,'-','-',COMPILEDEP),
             'libpthread' :      (True,  ['base'], THREAD_STR, self.check_libpthread, DEPENDENCY_RUN_AND_COMPILE_TIME, '-','FUNC#get_libpthread_version', GENERALDEP),
             'gs':               (True,  ['base'], GS_STR, self.check_gs, DEPENDENCY_RUN_TIME, '7.05','gs --version', EXTERNALDEP),
             'libusb':           (True,  ['base'], USB_STR, self.check_libusb, DEPENDENCY_RUN_AND_COMPILE_TIME, '-','FUNC#get_libusb_version', GENERALDEP),
@@@@ -373,7 +373,7 @@@@ class CoreInstall(object):
         }
 
         python2_dep = {
-            'python2X':         (True,  ['base'], PYTHON_STR, self.check_python, DEPENDENCY_RUN_AND_COMPILE_TIME,'2.2','python --version',GENERALDEP),
+            'python2X':         (True,  ['base'], PYTHON_STR, self.check_python, DEPENDENCY_RUN_AND_COMPILE_TIME,'2.2','${MODPY_BIN} --version',GENERALDEP),
             'python-notify' :   (False, ['gui_qt5', 'gui_qt4'], PYNTF_STR, self.check_pynotify, DEPENDENCY_RUN_TIME,'-','python-notify --version',GENERALDEP), # Optional for libnotify style popups from hp-systray
             'pyqt4-dbus' :      (True,  ['gui_qt4'], QT4DBUS_STR, self.check_pyqt4_dbus, DEPENDENCY_RUN_TIME,'4.0','FUNC#get_pyQt4_version', GENERALDEP),
             'pyqt4':            (True,  ['gui_qt4'], QT4_STR, self.check_pyqt4, DEPENDENCY_RUN_TIME,'4.0','FUNC#get_pyQt4_version', GENERALDEP), # PyQt 4.x )
@@@@ -381,7 +381,7 @@@@ class CoreInstall(object):
             'pyqt5':            (True,  ['gui_qt5'], QT5_STR, self.check_pyqt5, DEPENDENCY_RUN_TIME,'5.0','FUNC#get_pyQt5_version', GENERALDEP), # PyQt 5.x )
             'python-dbus':      (True,  ['fax'], PYDBUS_STR, self.check_python_dbus, DEPENDENCY_RUN_TIME,'0.80.0','FUNC#get_python_dbus_ver', GENERALDEP),
             'python-xml'  :     (True,  ['base'], PYXML_STR, self.check_python_xml, DEPENDENCY_RUN_TIME,'-','FUNC#get_python_xml_version',GENERALDEP),
-            'python-devel' :    (True,  ['base'], PY_DEV_STR, self.check_python_devel, DEPENDENCY_COMPILE_TIME,'2.2','python --version',GENERALDEP),
+            'python-devel' :    (True,  ['base'], PY_DEV_STR, self.check_python_devel, DEPENDENCY_COMPILE_TIME,'2.2','${MODPY_BIN} --version',GENERALDEP),
             'pil':              (False, ['scan'], PIL_STR, self.check_pil, DEPENDENCY_RUN_TIME,'-','FUNC#get_pil_version',GENERALDEP),
             # Optional fax packages
             'reportlab':        (False, ['fax'], REPORTLAB_STR, self.check_reportlab, DEPENDENCY_RUN_TIME,'2.0','FUNC#get_reportlab_version',GENERALDEP),
@@@@ -881,7 +881,7 @@@@ class CoreInstall(object):
 
 
     def check_make(self):
-        return check_tool('make --version', 3.0)
+        return True
 
 
     def check_libusb(self):
@@@@ -890,14 +890,14 @@@@ class CoreInstall(object):
             if not check_lib('libusb'):
                 return False
             if self.distro_name != "rhel":
-                return len(locate_file_contains("usb.h", '/usr/include', 'usb_init'))
+                return len(locate_file_contains("usb.h", '${LOCALBASE}/include', 'usb_init'))
             else:
                 return True
         else:
             if not check_lib('libusb-1.0'):
                 return False
             if self.distro_name != "rhel":
-                return len(locate_file_contains("libusb.h", '/usr/include/libusb-1.0', 'libusb_init'))
+                return len(locate_file_contains("libusb.h", '${LOCALBASE}/include/libusb-1.0', 'libusb_init'))
             else:
                 return True
 
@@@@ -907,11 +907,10 @@@@ class CoreInstall(object):
 
 
     def check_libcrypto(self):
-        return check_lib("libcrypto") and check_file("crypto.h")
+        return True
 
-
     def check_libpthread(self):
-        return check_lib("libpthread") and check_file("pthread.h")
+        return True
 
 
     def check_libnetsnmp(self):
@@@@ -957,7 +956,7 @@@@ class CoreInstall(object):
 
 
     def check_sane_devel(self):
-        return len(locate_file_contains("sane.h", '/usr/include', 'extern SANE_Status sane_init'))
+        return len(locate_file_contains("sane.h", '${LOCALBASE}/include', 'extern SANE_Status sane_init'))
 
 
     def check_xsane(self):
@@@@ -1035,7 +1034,7 @@@@ class CoreInstall(object):
 
 
     def check_python_devel(self):
-        dir_list = glob.glob('/usr/include/python%d*'%sys.version_info[0])
+        dir_list = glob.glob('${LOCALBASE}/include/python%d*'%sys.version_info[0])
         Found = False
         for p in dir_list:
               if check_file('Python.h',dir=p):
@@@@ -1089,9 +1088,8 @@@@ class CoreInstall(object):
 
 
     def check_dbus(self):
-        log.debug("Checking for dbus running and header files present (dbus-devel)...")
-        return check_ps(['dbus-daemon'])  and \
-            len(locate_file_contains("dbus-message.h", '/usr/include', 'dbus_message_new_signal'))
+        log.debug("Checking for dbus header files...")
+        return check_file("dbus-message.h", "${LOCALBASE}/include")
 
 
     def check_cups_devel(self):
@@@@ -1109,12 +1107,12 @@@@ class CoreInstall(object):
 
 
     def check_cups_image(self):
-      return check_file("raster.h", "/usr/include/cups")
+      return check_file("raster.h", "${LOCALBASE}/include/cups")
 
 
     def check_hplip(self):
         log.debug("Checking for HPLIP...")
-        return locate_files('hplip.conf', '/etc/hp')
+        return locate_files('hplip.conf', '${SYSCONFDIR}/hp')
 
 
     def check_libtool(self):
@@@@ -1134,7 +1132,7 @@@@ class CoreInstall(object):
     def check_cupsddk(self):
         log.debug("Checking for cups-ddk...")
         # TODO: Compute these paths some way or another...
-        return check_file('media.defs', "/usr/share/cups/ppdc/")
+        return check_file('media.defs', "${LOCALBASE}/share/cups/ppdc/")
 
 
 
@@@@ -1185,7 +1183,7 @@@@ class CoreInstall(object):
 
     def check_hpaio(self):
         found = False
-        for path in ['/etc/sane.d/dll.conf','/etc/sane.d/dll.d/hpaio', '/etc/sane.d/dll.d/hplip']:
+        for path in ['${SYSCONFDIR}/sane.d/dll.conf','/etc/sane.d/dll.d/hpaio', '/etc/sane.d/dll.d/hplip']:
             log.debug("'Checking for hpaio' in '%s'..." % path)
             try:
                 f = open(path, 'r')
@@@@ -1214,12 +1212,12 @@@@ class CoreInstall(object):
         if pat.match(home_dir) is not None:
             usrlib_dir= pat.match(home_dir).group(1) + "lib/"
             if os.path.exists(usrlib_dir+'sane/libsane-hpaio.so.1'):
-                log.debug("'Updating hpaio' in '/etc/sane.d/dll.conf'...")
+                log.debug("'Updating hpaio' in '${SYSCONFDIR}/sane.d/dll.conf'...")
                 try:
-                    f = open('/etc/sane.d/dll.conf', 'r')
+                    f = open('${SYSCONFDIR}/sane.d/dll.conf', 'r')
                 except IOError:
-                    log.error("'/etc/sane.d/dll.conf' not found. Creating dll.conf file")
-                    cmd = self.passwordObj.getAuthCmd()%'touch /etc/sane.d/dll.conf'
+                    log.error("'${SYSCONFDIR}/sane.d/dll.conf' not found. Creating dll.conf file")
+                    cmd = self.passwordObj.getAuthCmd()%'touch ${SYSCONFDIR}/sane.d/dll.conf'
                     log.debug("cmd=%s"%cmd)
                     utils.run(cmd, self.passwordObj)
                 else:
@@@@ -1232,19 +1230,19 @@@@ class CoreInstall(object):
                     f.close()
 
                 if not found:
-                    st = os.stat('/etc/sane.d/dll.conf')
-                    cmd= self.passwordObj.getAuthCmd()%'chmod 777 /etc/sane.d/dll.conf'
+                    st = os.stat('${SYSCONFDIR}/sane.d/dll.conf')
+                    cmd= self.passwordObj.getAuthCmd()%'chmod 777 ${SYSCONFDIR}/sane.d/dll.conf'
                     log.debug("cmd=%s"%cmd)
                     utils.run(cmd, self.passwordObj)
                     try:
-                        f = open('/etc/sane.d/dll.conf', 'a+')
+                        f = open('${SYSCONFDIR}/sane.d/dll.conf', 'a+')
                     except IOError:
-                        log.error("'/etc/sane.d/dll.conf' not found. Creating dll.conf file")
+                        log.error("'${SYSCONFDIR}/sane.d/dll.conf' not found. Creating dll.conf file")
                     else:
                         f.write('hpaio')
                         f.close()
                     actv_permissions = st.st_mode &0o777
-                    cmd = 'chmod %o /etc/sane.d/dll.conf'%actv_permissions
+                    cmd = 'chmod %o ${SYSCONFDIR}/sane.d/dll.conf'%actv_permissions
                     cmd= self.passwordObj.getAuthCmd()%cmd
                     log.debug("cmd=%s"%cmd)
                     utils.run(cmd, self.passwordObj)
@@@@ -1667,11 +1665,14 @@@@ class CoreInstall(object):
 
 
     def check_wget(self):
-        if utils.which("wget"):
-            return True
+        if sys.platform.startswith('linux'):
+            if utils.which("wget"):
+                return True
+            else:
+                log.debug("wget is not installed")
+                return False
         else:
-            log.debug("wget is not installed")
-            return False
+            return True
 
     def check_avahi_utils(self):
         if utils.which("avahi-browse"):
@@@@ -1757,7 +1758,7 @@@@ class CoreInstall(object):
     def pre_build(self,distro_ver=None):
         cmds = []
         if self.get_distro_ver_data('fix_ppd_symlink', False,distro_ver):
-            cmds.append(self.passwordObj.getAuthCmd() % 'python ./installer/fix_symlink.py')
+            cmds.append(self.passwordObj.getAuthCmd() % '${MODPY_BIN} ./installer/fix_symlink.py')
 
         return cmds
 
@


1.26
log
@Update to hplip-3.16.2.
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.25 2015/11/17 08:57:45 ajacoutot Exp $
--- installer/core_install.py.orig	Mon Feb  8 10:43:42 2016
+++ installer/core_install.py	Wed Feb 10 09:14:55 2016
d13 1
a13 1
@@@@ -225,7 +225,7 @@@@ class CoreInstall(object):
d22 1
a22 1
@@@@ -335,7 +335,7 @@@@ class CoreInstall(object):
d31 1
a31 1
@@@@ -366,13 +366,13 @@@@ class CoreInstall(object):
d33 1
a33 1
         
d37 1
a37 1
             'python-notify' :   (False, ['gui_qt4'], PYNTF_STR, self.check_pynotify, DEPENDENCY_RUN_TIME,'-','python-notify --version',GENERALDEP), # Optional for libnotify style popups from hp-systray
d40 2
d49 1
a49 1
@@@@ -859,7 +859,7 @@@@ class CoreInstall(object):
d58 1
a58 1
@@@@ -868,14 +868,14 @@@@ class CoreInstall(object):
d75 1
a75 1
@@@@ -885,11 +885,10 @@@@ class CoreInstall(object):
d89 1
a89 1
@@@@ -935,7 +934,7 @@@@ class CoreInstall(object):
d98 1
a98 1
@@@@ -992,7 +991,7 @@@@ class CoreInstall(object):
d107 1
a107 1
@@@@ -1046,9 +1045,8 @@@@ class CoreInstall(object):
d119 1
a119 1
@@@@ -1066,12 +1064,12 @@@@ class CoreInstall(object):
d134 1
a134 1
@@@@ -1091,7 +1089,7 @@@@ class CoreInstall(object):
d143 1
a143 1
@@@@ -1142,7 +1140,7 @@@@ class CoreInstall(object):
d152 1
a152 1
@@@@ -1171,12 +1169,12 @@@@ class CoreInstall(object):
d169 1
a169 1
@@@@ -1189,19 +1187,19 @@@@ class CoreInstall(object):
d194 1
a194 1
@@@@ -1623,11 +1621,14 @@@@ class CoreInstall(object):
d213 1
a213 1
@@@@ -1713,7 +1714,7 @@@@ class CoreInstall(object):
@


1.25
log
@Update to hplip-3.15.11.
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.24 2015/06/11 06:25:07 ajacoutot Exp $
--- installer/core_install.py.orig	Thu Nov 12 11:28:50 2015
+++ installer/core_install.py	Tue Nov 17 09:23:50 2015
d47 1
a47 1
@@@@ -846,7 +846,7 @@@@ class CoreInstall(object):
d56 1
a56 1
@@@@ -855,14 +855,14 @@@@ class CoreInstall(object):
d73 1
a73 1
@@@@ -872,11 +872,10 @@@@ class CoreInstall(object):
d87 1
a87 1
@@@@ -922,7 +921,7 @@@@ class CoreInstall(object):
d96 1
a96 1
@@@@ -979,7 +978,7 @@@@ class CoreInstall(object):
d105 1
a105 1
@@@@ -1033,9 +1032,8 @@@@ class CoreInstall(object):
d117 1
a117 1
@@@@ -1053,12 +1051,12 @@@@ class CoreInstall(object):
d132 1
a132 1
@@@@ -1078,7 +1076,7 @@@@ class CoreInstall(object):
d141 1
a141 1
@@@@ -1129,7 +1127,7 @@@@ class CoreInstall(object):
d150 1
a150 1
@@@@ -1158,12 +1156,12 @@@@ class CoreInstall(object):
d167 1
a167 1
@@@@ -1176,19 +1174,19 @@@@ class CoreInstall(object):
d192 1
a192 1
@@@@ -1610,11 +1608,14 @@@@ class CoreInstall(object):
d211 1
a211 1
@@@@ -1700,7 +1701,7 @@@@ class CoreInstall(object):
@


1.24
log
@Update to hplip-3.15.6.
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.23 2015/04/17 04:18:13 ajacoutot Exp $
--- installer/core_install.py.orig	Sun Jun  7 21:25:11 2015
+++ installer/core_install.py	Thu Jun 11 08:15:21 2015
d13 1
a13 1
@@@@ -218,7 +218,7 @@@@ class CoreInstall(object):
d22 1
a22 1
@@@@ -327,7 +327,7 @@@@ class CoreInstall(object):
d31 1
a31 1
@@@@ -358,13 +358,13 @@@@ class CoreInstall(object):
d47 1
a47 1
@@@@ -838,7 +838,7 @@@@ class CoreInstall(object):
d56 1
a56 1
@@@@ -847,14 +847,14 @@@@ class CoreInstall(object):
d73 1
a73 1
@@@@ -864,11 +864,10 @@@@ class CoreInstall(object):
d87 1
a87 1
@@@@ -914,7 +913,7 @@@@ class CoreInstall(object):
d96 1
a96 1
@@@@ -971,7 +970,7 @@@@ class CoreInstall(object):
d105 1
a105 1
@@@@ -1025,9 +1024,8 @@@@ class CoreInstall(object):
d117 1
a117 1
@@@@ -1045,12 +1043,12 @@@@ class CoreInstall(object):
d132 1
a132 1
@@@@ -1070,7 +1068,7 @@@@ class CoreInstall(object):
d141 1
a141 1
@@@@ -1121,7 +1119,7 @@@@ class CoreInstall(object):
d150 1
a150 1
@@@@ -1150,12 +1148,12 @@@@ class CoreInstall(object):
d167 1
a167 1
@@@@ -1168,19 +1166,19 @@@@ class CoreInstall(object):
d192 1
a192 1
@@@@ -1573,11 +1571,14 @@@@ class CoreInstall(object):
d211 1
a211 1
@@@@ -1663,7 +1664,7 @@@@ class CoreInstall(object):
@


1.23
log
@Update to hplip-3.15.4.
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.22 2015/03/15 08:46:52 ajacoutot Exp $
--- installer/core_install.py.orig	Tue Apr 14 11:53:21 2015
+++ installer/core_install.py	Fri Apr 17 05:53:22 2015
d47 1
a47 1
@@@@ -837,7 +837,7 @@@@ class CoreInstall(object):
d56 1
a56 1
@@@@ -846,14 +846,14 @@@@ class CoreInstall(object):
d73 1
a73 1
@@@@ -863,11 +863,10 @@@@ class CoreInstall(object):
d87 1
a87 1
@@@@ -913,7 +912,7 @@@@ class CoreInstall(object):
d96 1
a96 1
@@@@ -970,7 +969,7 @@@@ class CoreInstall(object):
d105 1
a105 1
@@@@ -1024,9 +1023,8 @@@@ class CoreInstall(object):
d117 1
a117 1
@@@@ -1044,12 +1042,12 @@@@ class CoreInstall(object):
d132 1
a132 1
@@@@ -1069,9 +1067,9 @@@@ class CoreInstall(object):
d136 3
a138 6
-        #return check_tool("/usr/lib/cups/driver/drv list") and os.path.exists("/usr/share/cupsddk/include/media.defs")
-        return (check_file('drv', "/usr/lib/cups/driver") or check_file('drv', "/usr/lib64/cups/driver")) and \
-            check_file('media.defs', "/usr/share/cupsddk/include")
+        #return check_tool("${LOCALBASE}/libexec/cups/driver/drv list") and os.path.exists("${LOCALBASE}/share/cupsddk/include/media.defs")
+        return (check_file('drv', "${LOCALBASE}/libexec/cups/driver") or check_file('drv', "/usr/lib64/cups/driver")) and \
+            check_file('media.defs', "${LOCALBASE}/share/cupsddk/include")
a140 1
     def check_policykit(self):
d192 1
a192 1
@@@@ -1570,11 +1568,14 @@@@ class CoreInstall(object):
d211 1
a211 1
@@@@ -1657,7 +1658,7 @@@@ class CoreInstall(object):
@


1.22
log
@Fix a backwards memcpy and some debug output.

reported by Alessandro DE LAURENZIS
memmove patch by from dcoppa@@
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.21 2015/02/05 17:34:33 ajacoutot Exp $
--- installer/core_install.py.orig	Thu Jan 29 13:20:24 2015
+++ installer/core_install.py	Thu Mar 12 12:12:17 2015
d22 1
a22 1
@@@@ -328,7 +328,7 @@@@ class CoreInstall(object):
d31 1
a31 1
@@@@ -359,13 +359,13 @@@@ class CoreInstall(object):
d47 1
a47 1
@@@@ -838,7 +838,7 @@@@ class CoreInstall(object):
d56 1
a56 1
@@@@ -847,14 +847,14 @@@@ class CoreInstall(object):
d73 1
a73 1
@@@@ -864,11 +864,10 @@@@ class CoreInstall(object):
d87 1
a87 1
@@@@ -920,7 +919,7 @@@@ class CoreInstall(object):
d96 1
a96 1
@@@@ -977,7 +976,7 @@@@ class CoreInstall(object):
d105 1
a105 1
@@@@ -1031,9 +1030,8 @@@@ class CoreInstall(object):
d117 1
a117 1
@@@@ -1051,12 +1049,12 @@@@ class CoreInstall(object):
d132 1
a132 1
@@@@ -1076,9 +1074,9 @@@@ class CoreInstall(object):
d145 1
a145 1
@@@@ -1128,7 +1126,7 @@@@ class CoreInstall(object):
d154 1
a154 1
@@@@ -1157,12 +1155,12 @@@@ class CoreInstall(object):
d171 1
a171 1
@@@@ -1175,19 +1173,19 @@@@ class CoreInstall(object):
d196 1
a196 1
@@@@ -1580,11 +1578,14 @@@@ class CoreInstall(object):
d215 1
a215 1
@@@@ -1667,7 +1668,7 @@@@ class CoreInstall(object):
@


1.21
log
@Update to hplip-3.15.2.
@
text
@d1 1
a1 1
$OpenBSD: patch-installer_core_install_py,v 1.20 2014/10/08 09:03:00 ajacoutot Exp $
d3 1
a3 1
+++ installer/core_install.py	Thu Feb  5 16:58:33 2015
d96 9
@


1.21.2.1
log
@Unbreak runtime: fix backwards memcpy.
@
text
@d1 1
a1 1
$OpenBSD: patch-installer_core_install_py,v 1.21 2015/02/05 17:34:33 ajacoutot Exp $
d3 1
a3 1
+++ installer/core_install.py	Thu Mar 12 12:12:17 2015
a95 9
@@@@ -977,7 +976,7 @@@@ class CoreInstall(object):
 
 
     def check_python_devel(self):
-        dir_list = glob.glob('/usr/include/python%d*'%sys.version_info[0])
+        dir_list = glob.glob('${LOCALBASE}/include/python%d*'%sys.version_info[0])
         Found = False
         for p in dir_list:
               if check_file('Python.h',dir=p):
@


1.20
log
@Update to hplip-3.14.10.
@
text
@d1 13
a13 4
$OpenBSD: patch-installer_core_install_py,v 1.19 2014/03/13 22:37:27 ajacoutot Exp $
--- installer/core_install.py.orig	Tue Oct  7 10:55:35 2014
+++ installer/core_install.py	Wed Oct  8 10:32:17 2014
@@@@ -176,7 +176,7 @@@@ class CoreInstall(object):
d22 26
a47 1
@@@@ -760,7 +760,7 @@@@ class CoreInstall(object):
d56 1
a56 1
@@@@ -769,14 +769,14 @@@@ class CoreInstall(object):
d73 1
a73 1
@@@@ -786,11 +786,10 @@@@ class CoreInstall(object):
d87 1
a87 1
@@@@ -842,7 +841,7 @@@@ class CoreInstall(object):
d96 1
a96 1
@@@@ -943,9 +942,8 @@@@ class CoreInstall(object):
d108 1
a108 1
@@@@ -963,12 +961,12 @@@@ class CoreInstall(object):
d123 1
a123 1
@@@@ -988,9 +986,9 @@@@ class CoreInstall(object):
d136 71
a206 1
@@@@ -1598,7 +1596,7 @@@@ class CoreInstall(object):
@


1.19
log
@Update to hplip-3.14.3.
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.18 2013/10/15 14:21:00 ajacoutot Exp $
--- installer/core_install.py.orig	Thu Mar  6 06:08:35 2014
+++ installer/core_install.py	Thu Mar 13 23:24:11 2014
d13 1
a13 1
@@@@ -751,7 +751,7 @@@@ class CoreInstall(object):
d22 1
a22 1
@@@@ -760,14 +760,14 @@@@ class CoreInstall(object):
d39 1
a39 1
@@@@ -777,11 +777,10 @@@@ class CoreInstall(object):
d53 1
a53 1
@@@@ -833,7 +832,7 @@@@ class CoreInstall(object):
d62 1
a62 1
@@@@ -934,9 +933,8 @@@@ class CoreInstall(object):
d74 1
a74 1
@@@@ -954,12 +952,12 @@@@ class CoreInstall(object):
d89 1
a89 1
@@@@ -979,9 +977,9 @@@@ class CoreInstall(object):
d102 1
a102 1
@@@@ -1589,7 +1587,7 @@@@ class CoreInstall(object):
@


1.18
log
@Update to hplip-3.13.10.
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.17 2013/08/22 10:49:25 ajacoutot Exp $
--- installer/core_install.py.orig	Fri Oct 11 11:36:44 2013
+++ installer/core_install.py	Tue Oct 15 15:42:07 2013
d13 1
a13 1
@@@@ -750,7 +750,7 @@@@ class CoreInstall(object):
d22 1
a22 1
@@@@ -759,14 +759,14 @@@@ class CoreInstall(object):
d39 1
a39 1
@@@@ -776,11 +776,10 @@@@ class CoreInstall(object):
d53 1
a53 1
@@@@ -832,7 +831,7 @@@@ class CoreInstall(object):
d62 1
a62 1
@@@@ -933,9 +932,8 @@@@ class CoreInstall(object):
d74 1
a74 1
@@@@ -953,12 +951,12 @@@@ class CoreInstall(object):
d89 1
a89 1
@@@@ -978,9 +976,9 @@@@ class CoreInstall(object):
d102 1
a102 1
@@@@ -1588,7 +1586,7 @@@@ class CoreInstall(object):
@


1.17
log
@Update to hplip-3.13.8.
@
text
@d1 4
a4 4
$OpenBSD: patch-installer_core_install_py,v 1.16 2013/08/11 09:54:17 ajacoutot Exp $
--- installer/core_install.py.orig	Wed Aug  7 08:00:10 2013
+++ installer/core_install.py	Thu Aug 22 12:29:24 2013
@@@@ -174,7 +174,7 @@@@ class CoreInstall(object):
d13 1
a13 1
@@@@ -749,7 +749,7 @@@@ class CoreInstall(object):
d22 1
a22 1
@@@@ -758,14 +758,14 @@@@ class CoreInstall(object):
d39 1
a39 1
@@@@ -775,11 +775,10 @@@@ class CoreInstall(object):
d53 1
a53 1
@@@@ -831,7 +830,7 @@@@ class CoreInstall(object):
d62 1
a62 1
@@@@ -932,9 +931,8 @@@@ class CoreInstall(object):
d74 1
a74 1
@@@@ -952,12 +950,12 @@@@ class CoreInstall(object):
d89 1
a89 1
@@@@ -977,9 +975,9 @@@@ class CoreInstall(object):
d102 1
a102 1
@@@@ -1578,7 +1576,7 @@@@ class CoreInstall(object):
@


1.16
log
@* drop some configure args which are the default
* drop policykit support -- it is only needed for the automated binary
  plugin installation tool which only runs on Linux
* use regular foomatic-rip from foomatic-filters instead of the bundled
  foomatic-rip-hplip
* document how to manually install plugins
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.15 2013/07/12 08:07:05 ajacoutot Exp $
--- installer/core_install.py.orig	Fri Jun 21 08:54:15 2013
+++ installer/core_install.py	Fri Jul 12 09:43:56 2013
d13 1
a13 1
@@@@ -748,7 +748,7 @@@@ class CoreInstall(object):
d22 1
a22 1
@@@@ -757,14 +757,14 @@@@ class CoreInstall(object):
d39 1
a39 1
@@@@ -774,11 +774,10 @@@@ class CoreInstall(object):
d53 1
a53 1
@@@@ -830,7 +829,7 @@@@ class CoreInstall(object):
d62 1
a62 1
@@@@ -931,9 +930,8 @@@@ class CoreInstall(object):
d74 1
a74 1
@@@@ -951,12 +949,12 @@@@ class CoreInstall(object):
d89 1
a89 1
@@@@ -976,9 +974,9 @@@@ class CoreInstall(object):
d102 1
a102 1
@@@@ -1571,7 +1569,7 @@@@ class CoreInstall(object):
@


1.15
log
@Update to hplip-3.13.6.
@
text
@d1 1
a1 1
$OpenBSD: patch-installer_core_install_py,v 1.14 2013/05/21 16:46:43 ajacoutot Exp $
a101 9
@@@@ -987,7 +985,7 @@@@ class CoreInstall(object):
             return True
         elif check_file('50-localauthority.conf', "/etc/polkit-1/localauthority.conf.d") and check_file('org.freedesktop.PolicyKit1.service', "/usr/share/dbus-1/system-services"):
             return True
-        elif check_file('org.freedesktop.PolicyKit1.conf','/etc/dbus-1/system.d'):
+        elif check_file('org.freedesktop.PolicyKit1.conf','${SYSCONFDIR}/dbus-1/system.d'):
             return True
         else:
             return False
@


1.14
log
@Update to hplip-3.13.5.
@
text
@d1 4
a4 4
$OpenBSD: patch-installer_core_install_py,v 1.13 2013/03/08 06:51:46 ajacoutot Exp $
--- installer/core_install.py.orig	Fri May 10 12:05:46 2013
+++ installer/core_install.py	Tue May 21 18:38:19 2013
@@@@ -172,7 +172,7 @@@@ class CoreInstall(object):
d13 1
a13 1
@@@@ -746,7 +746,7 @@@@ class CoreInstall(object):
d22 1
a22 1
@@@@ -755,14 +755,14 @@@@ class CoreInstall(object):
d39 1
a39 1
@@@@ -772,11 +772,10 @@@@ class CoreInstall(object):
d53 1
a53 1
@@@@ -828,7 +827,7 @@@@ class CoreInstall(object):
d62 1
a62 1
@@@@ -929,9 +928,8 @@@@ class CoreInstall(object):
d74 1
a74 1
@@@@ -949,12 +947,12 @@@@ class CoreInstall(object):
d89 1
a89 1
@@@@ -974,9 +972,9 @@@@ class CoreInstall(object):
d102 1
a102 1
@@@@ -985,7 +983,7 @@@@ class CoreInstall(object):
d111 1
a111 1
@@@@ -1569,7 +1567,7 @@@@ class CoreInstall(object):
@


1.13
log
@Update to hplip-3.13.2.

Some parts of the tools are still somewhat WIP; however, thanks to a
donation from linuxfund.org this has been successfully tested on a HP
OfficeJet 7500 e910, using STP discovery over WiFi with automatic PPD
generation. Scanning, printing, cartridge information... working.
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.12 2013/01/20 07:32:08 ajacoutot Exp $
--- installer/core_install.py.orig	Wed Feb 13 17:35:01 2013
+++ installer/core_install.py	Fri Feb 22 15:10:42 2013
d111 1
a111 1
@@@@ -1558,7 +1556,7 @@@@ class CoreInstall(object):
@


1.12
log
@Make hp-check start to behave.
@
text
@d1 4
a4 4
$OpenBSD: patch-installer_core_install_py,v 1.11 2012/09/11 10:52:16 ajacoutot Exp $
--- installer/core_install.py.orig	Tue Nov 20 10:51:37 2012
+++ installer/core_install.py	Sat Jan 19 10:58:47 2013
@@@@ -218,7 +218,7 @@@@ class CoreInstall(object):
d13 1
a13 1
@@@@ -876,7 +876,7 @@@@ class CoreInstall(object):
d22 1
a22 1
@@@@ -885,14 +885,14 @@@@ class CoreInstall(object):
d39 1
a39 1
@@@@ -902,11 +902,10 @@@@ class CoreInstall(object):
d53 1
a53 1
@@@@ -958,7 +957,7 @@@@ class CoreInstall(object):
d62 1
a62 1
@@@@ -1059,9 +1058,8 @@@@ class CoreInstall(object):
d74 1
a74 1
@@@@ -1079,17 +1077,17 @@@@ class CoreInstall(object):
a87 8
-    def check_hpssd(self):
-        log.debug("Checking for hpssd...")
-        return check_ps(['hpssd'])
+#    def check_hpssd(self):
+#        log.debug("Checking for hpssd...")
+#        return check_ps(['hpssd'])
 
 
d89 1
a89 1
@@@@ -1109,14 +1107,14 @@@@ class CoreInstall(object):
d102 7
a108 9
         log.debug("Checking for PolicyKit...")
-        return (check_file('PolicyKit.conf', "/etc/PolicyKit") and check_file('org.gnome.PolicyKit.AuthorizationManager.service', "/usr/share/dbus-1/services")) or (check_file('50-localauthority.conf', "/etc/polkit-1/localauthority.conf.d") and check_file('org.freedesktop.PolicyKit1.service', "/usr/share/dbus-1/system-services"))
+        return (check_file('PolicyKit.conf', "/etc/PolicyKit") and check_file('org.gnome.PolicyKit.AuthorizationManager.service', "/usr/share/dbus-1/services")) or (check_file('org.freedesktop.PolicyKit1.service', "${LOCALBASE}/share/dbus-1/system-services"))
 
     def check_cupsext(self):
         log.debug("Checking 'cupsext' CUPS extension...")
@@@@ -1540,7 +1538,7 @@@@ class CoreInstall(object):
             cmd = self.su_sudo() % '/etc/init.d/cupsys restart'
 
d110 2
a111 6
-            cmd = self.su_sudo() % 'killall -HUP cupsd'
+            cmd = self.su_sudo() % 'pkill -HUP cupsd'
 
         self.run(cmd)
 
@@@@ -1883,7 +1881,7 @@@@ class CoreInstall(object):
d115 2
a116 2
-            cmds.append(self.su_sudo() % 'python ./installer/fix_symlink.py')
+            cmds.append(self.su_sudo() % '${MODPY_BIN} ./installer/fix_symlink.py')
a119 11
@@@@ -2058,8 +2056,8 @@@@ class CoreInstall(object):
         url = "http://hplip.sf.net/plugin.conf"
         home = sys_conf.get('dirs', 'home')
 
-        if os.path.exists('/etc/hp/plugin.conf'):
-            url = "file:///etc/hp/plugin.conf"
+        if os.path.exists('${SYSCONFDIR}/hp/plugin.conf'):
+            url = "file://${SYSCONFDIR}/hp/plugin.conf"
 
         elif os.path.exists(os.path.join(home, 'plugin.conf')):
             url = "file://" + os.path.join(home, 'plugin.conf')
@


1.11
log
@Update to hplip-3.12.9.
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.10 2012/06/26 06:17:11 ajacoutot Exp $
--- installer/core_install.py.orig	Tue Sep  4 14:31:53 2012
+++ installer/core_install.py	Tue Sep 11 08:05:33 2012
d112 1
a112 1
+        return (check_file('PolicyKit.conf', "${SYSCONFDIR}/PolicyKit") and check_file('org.gnome.PolicyKit.AuthorizationManager.service', "${LOCALBASE}/share/dbus-1/services")) or (check_file('50-localauthority.conf', "${SYSCONFDIR}/polkit-1/localauthority.conf.d") and check_file('org.freedesktop.PolicyKit1.service', "${LOCALBASE}/share/dbus-1/system-services"))
@


1.10
log
@Update to hplip-3.12.6.
@
text
@d1 4
a4 4
$OpenBSD: patch-installer_core_install_py,v 1.9 2012/01/17 09:54:27 ajacoutot Exp $
--- installer/core_install.py.orig	Mon Jun 18 12:41:59 2012
+++ installer/core_install.py	Tue Jun 26 07:40:21 2012
@@@@ -217,7 +217,7 @@@@ class CoreInstall(object):
d13 1
a13 1
@@@@ -871,7 +871,7 @@@@ class CoreInstall(object):
d22 1
a22 1
@@@@ -880,14 +880,14 @@@@ class CoreInstall(object):
d39 1
a39 1
@@@@ -897,11 +897,10 @@@@ class CoreInstall(object):
d53 1
a53 1
@@@@ -953,7 +952,7 @@@@ class CoreInstall(object):
d62 1
a62 1
@@@@ -1054,9 +1053,8 @@@@ class CoreInstall(object):
d74 1
a74 1
@@@@ -1074,17 +1072,17 @@@@ class CoreInstall(object):
d97 1
a97 1
@@@@ -1104,14 +1102,14 @@@@ class CoreInstall(object):
d116 1
a116 1
@@@@ -1530,7 +1528,7 @@@@ class CoreInstall(object):
d125 1
a125 1
@@@@ -1873,7 +1871,7 @@@@ class CoreInstall(object):
d134 1
a134 1
@@@@ -2048,8 +2046,8 @@@@ class CoreInstall(object):
@


1.9
log
@Update to hplip-3.11.12.
@
text
@d1 17
a17 17
$OpenBSD: patch-installer_core_install_py,v 1.8 2011/10/09 07:42:29 ajacoutot Exp $
--- installer/core_install.py.orig	Fri Dec  9 12:20:31 2011
+++ installer/core_install.py	Mon Jan 16 18:48:21 2012
@@@@ -191,7 +191,7 @@@@ class CoreInstall(object):
         self.endian = utils.LITTLE_ENDIAN
         self.distro, self.distro_name, self.distro_version = DISTRO_UNKNOWN, '', DISTRO_VER_UNKNOWN
         self.distro_version_supported = False
-        self.install_location = '/usr'
+        self.install_location = '${PREFIX}'
         self.hplip_present = False
         self.have_dependencies = {}
         self.native_cups = True
@@@@ -828,14 +828,14 @@@@ class CoreInstall(object):
 
 
     def check_make(self):
-        return check_tool('make --version', 3.0)
d19 25
a43 16
 
 
     def check_libusb(self):
         if not check_lib('libusb'):
             return False
 
-        return len(locate_file_contains("usb.h", '/usr/include', 'usb_init(void)'))
+        return len(locate_file_contains("usb.h", '${LOCALBASE}/include', 'usb_init(void)'))
 
 
     def check_libjpeg(self):
@@@@ -843,11 +843,11 @@@@ class CoreInstall(object):
 
 
     def check_libcrypto(self):
-        return check_lib("libcrypto") and check_file("crypto.h")
d45 25
a69 25
 
 
     def check_libpthread(self):
-        return check_lib("libpthread") and check_file("pthread.h")
+	return True
 
 
     def check_libnetsnmp(self):
@@@@ -899,7 +899,7 @@@@ class CoreInstall(object):
 
 
     def check_sane_devel(self):
-        return len(locate_file_contains("sane.h", '/usr/include', 'extern SANE_Status sane_init'))
+	return len(locate_file_contains("sane.h", '${LOCALBASE}/include', 'extern SANE_Status sane_init'))
 
 
     def check_xsane(self):
@@@@ -988,9 +988,8 @@@@ class CoreInstall(object):
 
 
     def check_dbus(self):
-        log.debug("Checking for dbus running and header files present (dbus-devel)...")
-        return check_ps(['dbus-daemon'])  and \
-            len(locate_file_contains("dbus-message.h", '/usr/include', 'dbus_message_new_signal'))
+        log.debug("Checking for dbus header files present (dbus-devel)...")
d71 8
a78 8
 
 
     def check_cups_devel(self):
@@@@ -1008,12 +1007,12 @@@@ class CoreInstall(object):
 
 
     def check_cups_image(self):
-      return check_file("raster.h", "/usr/include/cups")
d80 5
a84 5
 
 
     def check_hplip(self):
         log.debug("Checking for HPLIP...")
-        return locate_files('hplip.conf', '/etc/hp')
d86 19
a104 11
 
 
     def check_hpssd(self):
@@@@ -1038,14 +1037,14 @@@@ class CoreInstall(object):
     def check_cupsddk(self):
         log.debug("Checking for cups-ddk...")
         # TODO: Compute these paths some way or another...
-        #return check_tool("/usr/lib/cups/driver/drv list") and os.path.exists("/usr/share/cupsddk/include/media.defs")
-        return (check_file('drv', "/usr/lib/cups/driver") or check_file('drv', "/usr/lib64/cups/driver")) and \
-            check_file('media.defs', "/usr/share/cupsddk/include")
+        #return check_tool("${LOCALBASE}/libexec/cups/driver/drv list") and os.path.exists("/usr/share/cupsddk/include/media.defs")
d107 14
a120 14
 
 
     def check_policykit(self):
         log.debug("Checking for PolicyKit...")
-        return (check_file('PolicyKit.conf', "/etc/PolicyKit") and check_file('org.gnome.PolicyKit.AuthorizationManager.service', "/usr/share/dbus-1/services")) or (check_file('50-localauthority.conf', "/etc/polkit-1/localauthority.conf.d") and check_file('org.freedesktop.PolicyKit1.service', "/usr/share/dbus-1/system-services"))
+        return (check_file('PolicyKit.conf', "${SYSCONFDIR}/PolicyKit") and check_file('org.gnome.PolicyKit.AuthorizationManager.service', "${LOCALBASE}/share/dbus-1/services")) or (check_file('50-localauthority.conf', "${SYSCONFDIR}/polkit-1/localauthority.conf.d") and check_file('org.freedesktop.PolicyKit1.service', "${LOCALBASE}/share/dbus-1/system-services"))
 
     def check_pkg_mgr(self):
         """
@@@@ -1332,7 +1331,7 @@@@ class CoreInstall(object):
             cmd = self.su_sudo() % '/etc/init.d/cupsys restart'
 
         else:
-            cmd = self.su_sudo() % 'killall -HUP cupsd'
d122 8
a129 8
 
         self.run(cmd)
 
@@@@ -1659,7 +1658,7 @@@@ class CoreInstall(object):
     def pre_build(self):
         cmds = []
         if self.get_distro_ver_data('fix_ppd_symlink', False):
-            cmds.append(self.su_sudo() % 'python ./installer/fix_symlink.py')
d131 9
a139 9
 
         return cmds
 
@@@@ -1834,8 +1833,8 @@@@ class CoreInstall(object):
         url = "http://hplip.sf.net/plugin.conf"
         home = sys_conf.get('dirs', 'home')
 
-        if os.path.exists('/etc/hp/plugin.conf'):
-            url = "file:///etc/hp/plugin.conf"
d141 4
a144 4
+            url = "file:///${SYSCONFDIR}/hp/plugin.conf"
 
         elif os.path.exists(os.path.join(home, 'plugin.conf')):
             url = "file://" + os.path.join(home, 'plugin.conf')
@


1.8
log
@Update to hplip-3.11.10.
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.7 2010/09/08 07:13:16 ajacoutot Exp $
--- installer/core_install.py.orig	Sun Oct  2 05:06:03 2011
+++ installer/core_install.py	Sun Oct  9 09:17:00 2011
d13 1
a13 1
@@@@ -827,14 +827,14 @@@@ class CoreInstall(object):
d30 1
a30 1
@@@@ -842,11 +842,11 @@@@ class CoreInstall(object):
d44 1
a44 1
@@@@ -898,7 +898,7 @@@@ class CoreInstall(object):
d53 1
a53 1
@@@@ -987,9 +987,8 @@@@ class CoreInstall(object):
d65 1
a65 1
@@@@ -1007,12 +1006,12 @@@@ class CoreInstall(object):
d80 1
a80 1
@@@@ -1037,14 +1036,14 @@@@ class CoreInstall(object):
d99 1
a99 1
@@@@ -1328,7 +1327,7 @@@@ class CoreInstall(object):
d108 1
a108 1
@@@@ -1655,7 +1654,7 @@@@ class CoreInstall(object):
d117 1
a117 1
@@@@ -1825,8 +1824,8 @@@@ class CoreInstall(object):
@


1.7
log
@Update to hplip-3.10.6.
@
text
@d1 4
a4 4
$OpenBSD: patch-installer_core_install_py,v 1.6 2010/03/21 11:07:43 ajacoutot Exp $
--- installer/core_install.py.orig	Mon Jul 19 04:17:37 2010
+++ installer/core_install.py	Wed Sep  8 08:34:10 2010
@@@@ -190,7 +190,7 @@@@ class CoreInstall(object):
d13 1
a13 1
@@@@ -826,14 +826,14 @@@@ class CoreInstall(object):
d30 1
a30 1
@@@@ -841,11 +841,11 @@@@ class CoreInstall(object):
d44 1
a44 1
@@@@ -897,7 +897,7 @@@@ class CoreInstall(object):
d53 1
a53 1
@@@@ -986,9 +986,8 @@@@ class CoreInstall(object):
d65 1
a65 1
@@@@ -1006,12 +1005,12 @@@@ class CoreInstall(object):
d80 1
a80 1
@@@@ -1036,14 +1035,14 @@@@ class CoreInstall(object):
d99 1
a99 1
@@@@ -1327,7 +1326,7 @@@@ class CoreInstall(object):
d108 1
a108 1
@@@@ -1654,7 +1653,7 @@@@ class CoreInstall(object):
d117 1
a117 1
@@@@ -1824,8 +1823,8 @@@@ class CoreInstall(object):
@


1.6
log
@Major update to hplip-3.10.2.
Take maintainership.
Tweak, flush and fix dependencies...

Add some example on how to use hplip.
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.5 2009/08/20 08:07:48 ajacoutot Exp $
--- installer/core_install.py.orig	Thu Feb 25 00:07:12 2010
+++ installer/core_install.py	Fri Mar 12 13:46:51 2010
d108 1
a108 1
@@@@ -1649,7 +1648,7 @@@@ class CoreInstall(object):
d117 1
a117 1
@@@@ -1819,8 +1818,8 @@@@ class CoreInstall(object):
@


1.5
log
@Updated to hplip-3.9.8
Fix SHARED_LIBS.
sane-hpaio is a loadable module.
Move some PPD files from -hpijs to -hpcups.
@
text
@d1 17
a17 17
$OpenBSD: patch-installer_core_install_py,v 1.4 2009/07/13 08:14:28 ajacoutot Exp $
--- installer/core_install.py.orig	Tue Aug  4 23:37:17 2009
+++ installer/core_install.py	Thu Aug 20 09:24:11 2009
@@@@ -190,7 +190,7 @@@@ class CoreInstall(object):
         self.endian = utils.LITTLE_ENDIAN
         self.distro, self.distro_name, self.distro_version = DISTRO_UNKNOWN, '', DISTRO_VER_UNKNOWN
         self.distro_version_supported = False
-        self.install_location = '/usr'
+        self.install_location = '${PREFIX}'
         self.hplip_present = False
         self.have_dependencies = {}
         self.native_cups = True
@@@@ -825,14 +825,14 @@@@ class CoreInstall(object):
 
 
     def check_make(self):
-        return check_tool('make --version', 3.0)
d19 7
a25 7
 
 
     def check_libusb(self):
         if not check_lib('libusb'):
             return False
 
-        return len(locate_file_contains("usb.h", '/usr/include', 'usb_init(void)'))
d27 8
a34 8
 
 
     def check_libjpeg(self):
@@@@ -840,11 +840,11 @@@@ class CoreInstall(object):
 
 
     def check_libcrypto(self):
-        return check_lib("libcrypto") and check_file("crypto.h")
d36 24
a59 24
 
 
     def check_libpthread(self):
-        return check_lib("libpthread") and check_file("pthread.h")
+        return True
 
 
     def check_libnetsnmp(self):
@@@@ -896,7 +896,7 @@@@ class CoreInstall(object):
 
 
     def check_sane_devel(self):
-        return len(locate_file_contains("sane.h", '/usr/include', 'extern SANE_Status sane_init'))
+        return len(locate_file_contains("sane.h", '${LOCALBASE}/include', 'extern SANE_Status sane_init'))
 
 
     def check_xsane(self):
@@@@ -985,9 +985,8 @@@@ class CoreInstall(object):
 
 
     def check_dbus(self):
-        log.debug("Checking for dbus running and header files present (dbus-devel)...")
-        return check_ps(['dbus-daemon'])  and \
-            len(locate_file_contains("dbus-message.h", '/usr/include', 'dbus_message_new_signal'))
d62 8
a69 8
 
 
     def check_cups_devel(self):
@@@@ -1005,12 +1004,12 @@@@ class CoreInstall(object):
 
 
     def check_cups_image(self):
-      return check_file("raster.h", "/usr/include/cups")
d71 5
a75 5
 
 
     def check_hplip(self):
         log.debug("Checking for HPLIP...")
-        return locate_files('hplip.conf', '/etc/hp')
d77 10
a86 10
 
 
     def check_hpssd(self):
@@@@ -1035,14 +1034,14 @@@@ class CoreInstall(object):
     def check_cupsddk(self):
         log.debug("Checking for cups-ddk...")
         # TODO: Compute these paths some way or another...
-        #return check_tool("/usr/lib/cups/driver/drv list") and os.path.exists("/usr/share/cupsddk/include/media.defs")
-        return (check_file('drv', "/usr/lib/cups/driver") or check_file('drv', "/usr/lib64/cups/driver")) and \
-            check_file('media.defs', "/usr/share/cupsddk/include")
d90 14
a103 14
 
 
     def check_policykit(self):
         log.debug("Checking for PolicyKit...")
-        return check_file('PolicyKit.conf', "/etc/PolicyKit") and check_file('org.gnome.PolicyKit.AuthorizationManager.service', "/usr/share/dbus-1/services")
+        return check_file('PolicyKit.conf', "${SYSCONFDIR}/PolicyKit") and check_file('org.gnome.PolicyKit.AuthorizationManager.service', "${LOCALBASE}/share/dbus-1/services")
 
 
     def check_pkg_mgr(self):
@@@@ -1221,7 +1220,7 @@@@ class CoreInstall(object):
             cmd = self.su_sudo() % '/etc/init.d/cupsys restart'
 
         else:
-            cmd = self.su_sudo() % 'killall -HUP cupsd'
d105 8
a112 8
 
         self.run(cmd)
 
@@@@ -1536,7 +1535,7 @@@@ class CoreInstall(object):
     def pre_build(self):
         cmds = []
         if self.get_distro_ver_data('fix_ppd_symlink', False):
-            cmds.append(self.su_sudo() % 'python ./installer/fix_symlink.py')
d114 9
a122 9
 
         return cmds
 
@@@@ -1706,8 +1705,8 @@@@ class CoreInstall(object):
         url = "http://hplip.sf.net/plugin.conf"
         home = sys_conf.get('dirs', 'home')
 
-        if os.path.exists('/etc/hp/plugin.conf'):
-            url = "file:///etc/hp/plugin.conf"
d125 3
a127 3
 
         elif os.path.exists(os.path.join(home, 'plugin.conf')):
             url = "file://" + os.path.join(home, 'plugin.conf')
@


1.4
log
@Major update to hplip-3.9.6b.
Refer to the project homepage for the complete changelog.

This port now comes into 5 subpackages (ala Fedora):
- main: complete hplip functionnalities
- hpijs: deprecated hpijs printer driver
- hpcups: new-gen printer driver
- libs: libraries and helpers used by other subpackages
- gui: graphical tools (systray applet...)

It seems this version works a least as good as the previous one we had
in-tree. I could use some feedbacks for the fancier stuffs that hplip
provides (besides regular printing using hpcups and/or hpijs), like
printer communication, ink levels... because I have no hp equipment, but
at least, there was no regression reported.
(some features are Linux-only and are expected not to work)

Tested by several, thanks!
@
text
@d1 3
a3 3
$OpenBSD$
--- installer/core_install.py.orig	Thu Jun 25 21:05:43 2009
+++ installer/core_install.py	Thu Jul  2 18:36:05 2009
d13 1
a13 1
@@@@ -824,14 +824,14 @@@@ class CoreInstall(object):
d30 1
a30 1
@@@@ -839,11 +839,11 @@@@ class CoreInstall(object):
d44 1
a44 1
@@@@ -895,7 +895,7 @@@@ class CoreInstall(object):
d53 1
a53 1
@@@@ -984,9 +984,8 @@@@ class CoreInstall(object):
d65 1
a65 1
@@@@ -1004,12 +1003,12 @@@@ class CoreInstall(object):
d80 1
a80 1
@@@@ -1034,14 +1033,14 @@@@ class CoreInstall(object):
d99 1
a99 1
@@@@ -1220,7 +1219,7 @@@@ class CoreInstall(object):
d108 1
a108 1
@@@@ -1512,7 +1511,7 @@@@ class CoreInstall(object):
d117 1
a117 1
@@@@ -1681,8 +1680,8 @@@@ class CoreInstall(object):
@


1.3
log
@- SECURITY: fix for Secunia SA31470 -- patches adapted from RedHat
(CVE-2008-2940 CVE-2008-2941)
prodded by jasper@@
- fix some hardcoded paths and regen PLIST while here

ok jasper@@
@
text
@d1 13
a13 6
$OpenBSD: patch-installer_core_install_py,v 1.2 2008/03/15 10:18:30 ajacoutot Exp $
--- installer/core_install.py.orig	Tue Dec 11 19:41:47 2007
+++ installer/core_install.py	Mon Feb  2 10:51:04 2009
@@@@ -184,7 +184,7 @@@@ class CoreInstall(object):
             'reportlab':        (False, ['fax'], "Reportlab - PDF library for Python", self.check_reportlab), 
             'python23':         (True,  ['fax'], "Python 2.3 or greater - Required for fax functionality", self.check_python23),
a14 7
-            'ppdev':            (True,  ['parallel'], "ppdev - Parallel port support kernel module.", self.check_ppdev),
+            'ppdev':            (False,  ['parallel'], "ppdev - Parallel port support kernel module.", self.check_ppdev),
 
             'pyqt':             (True,  ['gui'], "PyQt - Qt interface for Python", self.check_pyqt),
 
@@@@ -545,23 +545,23 @@@@ class CoreInstall(object):
         return check_tool('gcc --version', 0) and check_tool('g++ --version', 0)
d18 2
a19 1
+        return check_tool('true', 0)
d25 2
a26 2
-        return len(locate_file_contains("usb.h", '/usr/include', 'usb_init(void)')) > 0
+        return len(locate_file_contains("usb.h", '${LOCALBASE}/include', 'usb_init(void)')) > 0
d30 2
a31 1
         return check_lib("libjpeg") and check_file("jpeglib.h")
d37 1
d42 1
d44 2
a45 3
         return check_lib("libnetsnmp") and check_file("net-snmp-config.h")
@@@@ -599,7 +599,7 @@@@ class CoreInstall(object):
         return check_lib('libsane')
d48 3
a50 2
-        return len(locate_file_contains("sane.h", '/usr/include', 'extern SANE_Status sane_init')) > 0
+        return len(locate_file_contains("sane.h", '${LOCALBASE}/include', 'extern SANE_Status sane_init')) > 0
d53 19
a71 2
         if os.getenv('DISPLAY'):
@@@@ -683,7 +683,7 @@@@ class CoreInstall(object):
d75 3
a77 2
-        return check_ps(['hpiod', 'hpssd']) and locate_files('hplip.conf', '/etc/hp')
+        return check_ps(['hpiod', 'hpssd']) and locate_files('hplip.conf', '${SYSCONFDIR}/hp')
d80 48
a127 1
         log.debug("Checking for hpssd...")
@


1.2
log
@- update to version 2.7.12 (should be the latest 2.7.* release; we'll
see about updating to the 2.8.* version later)
- enable gui interface

Thanks to Predrag Punosevac <punosevac at math.arizona dot edu> for the
reminder
@
text
@d1 3
a3 3
$OpenBSD: patch-installer_core_install_py,v 1.1.1.1 2007/11/02 15:48:55 ajacoutot Exp $
--- installer/core_install.py.orig	Fri Mar  7 09:28:37 2008
+++ installer/core_install.py	Fri Mar  7 09:32:04 2008
d25 1
a25 1
+        return len(locate_file_contains("usb.h", '!!LOCALBASE!!/include', 'usb_init(void)')) > 0
d46 1
a46 1
+        return len(locate_file_contains("sane.h", '!!LOCALBASE!!/include', 'extern SANE_Status sane_init')) > 0
d50 9
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD$
--- installer/core_install.py.orig	Fri Oct 12 18:50:01 2007
+++ installer/core_install.py	Sat Oct 27 17:03:15 2007
@@@@ -182,9 +182,9 @@@@ class CoreInstall(object):
d11 1
a11 2
-            'pyqt':             (True,  ['gui'], "PyQt - Qt interface for Python", self.check_pyqt),
+            'pyqt':             (False,  ['gui'], "PyQt - Qt interface for Python", self.check_pyqt),
d13 1
a13 3
             'libnetsnmp-devel': (True,  ['network'], "libnetsnmp-devel - SNMP networking library development files", self.check_libnetsnmp),
             'libcrypto':        (True,  ['network'], "libcrypto - OpenSSL cryptographic library", self.check_libcrypto),
@@@@ -543,23 +543,23 @@@@ class CoreInstall(object):
d26 1
a26 1
         
d41 1
a41 1
@@@@ -597,7 +597,7 @@@@ class CoreInstall(object):
@


1.1.1.1
log
@Import hplip-2.7.10

This port contains 3 subpackages:

* hplip
HPLIP is an HP developed solution for printing, scanning, and faxing
with HP inkjet and laser based printers in Unix.
The HPLIP project provides printing support for 1,248 printer models,
including Deskjet, Officejet, Photosmart, PSC (Print Scan Copy),
Business Inkjet, LaserJet, Edgeline MFP, and LaserJet MFP.

* hpijs (supersed print/hpijs)
The Hewlett-Packard Co. Linux Inkjet Driver Project is an add-on to the
GNU Ghostscript application. This driver is based on the Hewlett Packard
Appliance APDK for deskjet printers.

* hplip-docs
Documentation for HPLIP in HTML format.


feedback from winiger@@, reviewed by bernd@@
"looks correct" jasper@@ , "works for me" sthen@@
@
text
@@
