head	1.4;
access;
symbols
	OPENBSD_6_1:1.3.0.28
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.26
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.22
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.24
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.20
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.18
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.16
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.14
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.12
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.10
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.8
	OPENBSD_5_0:1.3.0.6
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.4
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.2
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.2.0.30
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.28
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.26
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.24
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.22
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.20
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.18
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.16
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.14
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.12
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.10
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.8
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.6
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.4
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.2
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.1.0.2
	OPENBSD_3_2_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2017.08.23.07.45.00;	author jca;	state Exp;
branches;
next	1.3;
commitid	D1cWsejxO8OldXBP;

1.3
date	2010.05.19.14.55.00;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2002.11.13.17.15.49;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2002.07.07.17.03.37;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to mpage-2.5.7 (move to gplv2+)

from Ian McWilliam (maintainer)
@
text
@$OpenBSD: patch-post_c,v 1.3 2010/05/19 14:55:00 espie Exp $
Index: post.c
--- post.c.orig
+++ post.c
@@@@ -361,6 +361,7 @@@@ ps_copyprolog(fd, outfd)
  FILE *fd;
  FILE *outfd;
 {
+    size_t len;
 
     Debug(DB_PSDOC, "%%ps_copyprolog: adding mpage prolog\n", 0);
     if (!have_showsheet) {
@@@@ -407,15 +408,17 @@@@ ps_copyprolog(fd, outfd)
                  */
                 if (tex1)
                     free(tex1);
-                tex1 = malloc(strlen(currline)+1);
-                strcpy(tex1, currline);
+                len = strlen(currline)+1;
+                tex1 = malloc(len);
+                (void)strlcpy(tex1, currline, len);
                 fprintf(outfd, "%s", currline);
 
                 fgets(currline, LINESIZE-1, fd);
                 if (tex2)
                     free(tex2);
-                tex2 = malloc(strlen(currline)+1);
-                strcpy(tex2, currline);
+                len = strlen(currline)+1;
+                tex2 = malloc(len);
+                (void)strlcpy(tex2, currline, len);
             }
         }
         fprintf(outfd, "%s", currline);
@@@@ -440,7 +443,7 @@@@ ps_roff_copyprolog(fd, outfd)
  /*       if (strcmp(currline, "xi\n") == 0) */
         if (strstr(currline, "xi\n")) {
             fprintf(outfd, "%%%s", currline); 
-            strcpy(ps_roff_xi, currline);
+            (void)strlcpy(ps_roff_xi, currline, sizeof(ps_roff_xi));
         }
         else if (strncmp(currline, "%%Page:", 7) == 0) {
             fprintf(outfd, "/p { } def\n");
@@@@ -1021,6 +1024,8 @@@@ post_one_line(line, fd, outfd, indoc, flush_page)
  int * indoc;
  int flush_page;
 {
+        size_t len;
+
         if (strncmp(line, "%%BeginDocument", 15) == 0) {
             (*indoc)++;
         }
@@@@ -1071,15 +1076,17 @@@@ post_one_line(line, fd, outfd, indoc, flush_page)
                      */
                     if (tex1)
                         free(tex1);
-                    tex1 = malloc(strlen(line)+1);
-                    strcpy(tex1, line);
+                    len = strlen(line)+1;
+                    tex1 = malloc(len);
+                    (void)strlcpy(tex1, line, len);
                     fprintf(outfd, "%s", line);
                     flush_page ?  memgets(line, LINESIZE-1) :
                                   fgets(line, LINESIZE-1, fd);
                     if (tex2)
                         free(tex2);
-                    tex2 = malloc(strlen(line)+1);
-                    strcpy(tex2, line);
+                    len = strlen(line)+1;
+                    tex2 = malloc(len);
+                    (void)strlcpy(tex2, line, len);
                 } 
             }
 	}
@


1.3
log
@fix declaration order (gcc4)
@
text
@d1 5
a5 4
$OpenBSD: patch-post_c,v 1.2 2002/11/13 17:15:49 naddy Exp $
--- post.c.orig	Wed Oct 16 23:45:54 2002
+++ post.c	Wed May 19 14:52:00 2010
@@@@ -353,6 +353,7 @@@@ ps_copyprolog(fd, outfd)
d13 1
a13 1
@@@@ -399,15 +400,17 @@@@ ps_copyprolog(fd, outfd)
d35 1
a35 1
@@@@ -432,7 +435,7 @@@@ ps_roff_copyprolog(fd, outfd)
d44 1
a44 1
@@@@ -1013,6 +1016,8 @@@@ post_one_line(line, fd, outfd, indoc, flush_page)
d53 1
a53 1
@@@@ -1063,15 +1068,17 @@@@ post_one_line(line, fd, outfd, indoc, flush_page)
@


1.2
log
@Update to 2.5.3:  Various bug fixes.
From: Ian McWilliam <i.mcwilliam@@uws.edu.au>
@
text
@d1 1
a1 1
$OpenBSD: patch-post_c,v 1.1 2002/07/07 17:03:37 naddy Exp $
d3 1
a3 1
+++ post.c	Wed Nov 13 18:04:56 2002
d43 1
a43 1
@@@@ -1013,6 +1016,8 @@@@ post_one_line(line, fd, outfd, indoc, fl
d52 1
a52 1
@@@@ -1063,15 +1068,17 @@@@ post_one_line(line, fd, outfd, indoc, fl
@


1.1
log
@* Update to 2.5.2.
* All-around clean-up.
* Fix licensing information.

Once upon a time okayed by maintainer.
@
text
@d1 3
a3 3
$OpenBSD$
--- post.c.orig	Wed Nov 14 19:59:55 2001
+++ post.c	Sun May 19 01:01:41 2002
d12 1
a12 1
@@@@ -395,15 +396,17 @@@@ ps_copyprolog(fd, outfd)
d34 1
a34 1
@@@@ -428,7 +431,7 @@@@ ps_roff_copyprolog(fd, outfd)
d43 1
a43 1
@@@@ -1009,6 +1012,8 @@@@ post_one_line(line, fd, outfd, indoc, fl
d50 1
a50 1
             *indoc = 1;
d52 22
a73 22
@@@@ -1058,15 +1063,17 @@@@ post_one_line(line, fd, outfd, indoc, fl
                  */
                 if (tex1)
                     free(tex1);
-                tex1 = malloc(strlen(line)+1);
-                strcpy(tex1, line);
+                len = strlen(line)+1;
+                tex1 = malloc(len);
+                (void)strlcpy(tex1, line, len);
                 fprintf(outfd, "%s", line);
                 flush_page ?  memgets(line, LINESIZE-1) :
                               fgets(line, LINESIZE-1, fd);
                 if (tex2)
                     free(tex2);
-                tex2 = malloc(strlen(line)+1);
-                strcpy(tex2, line);
+                len = strlen(line)+1;
+                tex2 = malloc(len);
+                (void)strlcpy(tex2, line, len);
             } 
         }
         fprintf(outfd, "%s", line);
@

