head	1.6;
access;
symbols
	OPENBSD_6_0:1.6.0.12
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.8
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.10
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.6
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.4
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.2
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.5.0.4
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_3:1.5.0.2
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.4.0.2
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2;
locks; strict;
comment	@# @;


1.6
date	2013.12.24.15.18.38;	author kili;	state Exp;
branches;
next	1.5;

1.5
date	2012.08.22.06.24.17;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2012.07.11.10.26.31;	author kili;	state Exp;
branches;
next	1.3;

1.3
date	2011.11.16.12.43.23;	author kili;	state Exp;
branches;
next	1.2;

1.2
date	2011.07.06.13.49.17;	author kili;	state Exp;
branches;
next	1.1;

1.1
date	2011.06.08.19.15.48;	author kili;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Intermediate update to ghostscript-9.07.

9.10 will follow in a few days.

Thanks to aja@@ for doing some testing.
@
text
@$OpenBSD: patch-base_unix-dll_mak,v 1.5 2012/08/22 06:24:17 ajacoutot Exp $
--- base/unix-dll.mak.orig	Thu Feb 14 08:58:13 2013
+++ base/unix-dll.mak	Tue Sep 17 20:11:00 2013
@@@@ -24,10 +24,6 @@@@
 #  export LD_LIBRARY_PATH=/insert-path-here/sobin
 #  export GS_LIB=/insert-path-here/lib
 
-# Location for building shared object
-SODIRPREFIX=so
-SODEBUGDIRPREFIX=sodebug
-
 # ------------------- Ghostscript shared object --------------------------- #
 
 # Shared object names
@@@@ -35,12 +31,16 @@@@ SODEBUGDIRPREFIX=sodebug
 # simple loader (no support for display device)
 GSSOC_XENAME=$(GS)c$(XE)
 GSSOC_XE=$(BINDIR)/$(GSSOC_XENAME)
-GSSOC=$(BINDIR)/$(GSSOC_XENAME)
+GSSOC-Yes=
+GSSOC-No=$(BINDIR)/$(GSSOC_XENAME)
+GSSOC=$(GSSOC-$(USE_GTK))
 
 # loader suporting display device using Gtk+
 GSSOX_XENAME=$(GS)x$(XE)
 GSSOX_XE=$(BINDIR)/$(GSSOX_XENAME)
-GSSOX=$(BINDIR)/$(GSSOX_XENAME)
+GSSOX-Yes=$(BINDIR)/$(GSSOX_XENAME)
+GSSOX-No=
+GSSOX=$(GSSOX-$(USE_GTK))
 
 # shared library
 GS_SONAME_BASE=lib$(GS)
@@@@ -48,16 +48,10 @@@@ GS_SONAME_BASE=lib$(GS)
 # GNU/Linux
 GS_SOEXT=$(DYNANIC_LIB_EXT)
 GS_SONAME=$(GS_SONAME_BASE).$(GS_SOEXT)
-GS_SONAME_MAJOR=$(GS_SONAME).$(GS_VERSION_MAJOR)
-GS_SONAME_MAJOR_MINOR=$(GS_SONAME).$(GS_VERSION_MAJOR).$(GS_VERSION_MINOR)
-#LDFLAGS_SO=-shared -Wl,-soname=$(GS_SONAME_MAJOR)
+GS_SONAME_MAJOR=$(GS_SONAME).$(basename $(LIBgs_VERSION))
+GS_SONAME_MAJOR_MINOR=$(GS_SONAME).$(LIBgs_VERSION)
+LDFLAGS_SO=-shared
 
-# NOTE: the value of LD_SET_DT_SONAME for, for example, Solaris ld, must contain the
-# trailing space to separation it from the value of the option. For GNU ld and
-# similar linkers it must containt the trailing "=" 
-LDFLAGS_SO=-shared -Wl,$(LD_SET_DT_SONAME)$(LDFLAGS_SO_PREFIX)$(GS_SONAME_MAJOR)
-
-
 # MacOS X
 #GS_SOEXT=dylib
 #GS_SONAME=$(GS_SONAME_BASE).$(GS_SOEXT)
@@@@ -84,13 +78,13 @@@@ $(GS_SO_MAJOR): $(GS_SO_MAJOR_MINOR)
 	ln -s $(GS_SONAME_MAJOR_MINOR) $(GS_SO_MAJOR)
 
 # Build the small Ghostscript loaders, with Gtk+ and without
-$(GSSOC_XE): $(GS_SO) $(PSSRC)$(SOC_LOADER)
-	$(GLCC) -g -o $(GSSOC_XE) $(PSSRC)dxmainc.c \
-	-L$(BINDIR) -l$(GS)
+$(GSSOC_XE): $(GS_SO) $(PSSRC)dxmainc.c
+	$(GLCC) -g $(SOC_CFLAGS) -o $(GSSOC_XE) $(PSSRC)dxmainc.c \
+	-L$(BINDIR) $(LDFLAGS) -l$(GS) $(SOC_LIBS)
 
-$(GSSOX_XE): $(GS_SO) $(PSSRC)$(SOC_LOADER)
-	$(GLCC) -g $(SOC_CFLAGS) -o $(GSSOX_XE) $(PSSRC)$(SOC_LOADER) \
-	-L$(BINDIR) -l$(GS) $(SOC_LIBS)
+$(GSSOX_XE): $(GS_SO) $(PSSRC)dxmain.c
+	$(GLCC) -g $(SOC_CFLAGS) -o $(GSSOX_XE) $(PSSRC)dxmain.c \
+	-L$(BINDIR) $(LDFLAGS) -l$(GS) $(SOC_LIBS)
 
 # ------------------------- Recursive make targets ------------------------- #
 
@@@@ -105,6 +99,13 @@@@ SODEFS_FINAL=\
  STDIO_IMPLEMENTATION=c\
  BUILDDIRPREFIX=$(BUILDDIRPREFIX)
 
+# NOTE: moved somewhere else:
+# + BINDIR=$(BINDIR)\
+# + GLGENDIR=$(GLGENDIR)\
+# + GLOBJDIR=$(GLOBJDIR)\
+# + PSGENDIR=$(PSGENDIR)\
+# + PSOBJDIR=$(PSOBJDIR)
+
 # This is a bit nasty; because of the directory name rewriting that happens
 # on a recursive build, we have to recurse twice before we are sure that
 # all the targets are correct.
@@@@ -123,19 +124,27 @@@@ sodebug:
 	fi
 	$(MAKE) so-subtarget$(FOR_MAC) GENOPT='-DDEBUG' BUILDDIRPREFIX=$(SODEBUGDIRPREFIX)
 
+# NOTE: Differs from gs-9.02, may be wrong
 so-subtarget:
 	$(MAKE) $(SODEFS) GENOPT='$(GENOPT)' LDFLAGS='$(LDFLAGS)'\
 	 CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(AC_CFLAGS) $(XCFLAGS)' prefix=$(prefix)\
+	 USE_GTK=$(USE_GTK) \
 	 directories
 	$(MAKE) $(SODEFS) GENOPT='$(GENOPT)' LDFLAGS='$(LDFLAGS)'\
 	 CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(AC_CFLAGS) $(XCFLAGS)' prefix=$(prefix)\
+	 USE_GTK=$(USE_GTK) \
 	 $(AUXDIR)/echogs$(XEAUX) $(AUXDIR)/genarch$(XEAUX)
 	$(MAKE) $(SODEFS) GENOPT='$(GENOPT)' LDFLAGS='$(LDFLAGS) $(LDFLAGS_SO)'\
-	 CFLAGS='$(CFLAGS_STANDARD) $(CFLAGS_SO) $(GCFLAGS) $(AC_CFLAGS) $(XCFLAGS)'\
+	 CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(AC_CFLAGS) $(XCFLAGS)'\
+	 USE_GTK=$(USE_GTK) \
 	 prefix=$(prefix)
+	@@echo USE_GTK = $(USE_GTK)
+	@@echo GSSOC = $(GSSOC)
+	@@echo GSSOX = $(GSSOX)
 	$(MAKE) $(SODEFS_FINAL) GENOPT='$(GENOPT)' LDFLAGS='$(LDFLAGS)'\
 	 CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(AC_CFLAGS) $(XCFLAGS)' prefix=$(prefix)\
-	 $(GSSOC_XE) $(GSSOX_XE)
+	 USE_GTK=$(USE_GTK) \
+	 $(GSSOC) $(GSSOX)
 
 # special so-subtarget for MAC OS X
 so-subtarget_1:
@@@@ -167,13 +176,11 @@@@ install-so-subtarget: so-subtarget$(FOR_MAC)
 	-mkdir -p $(DESTDIR)$(bindir)
 	-mkdir -p $(DESTDIR)$(libdir)
 	-mkdir -p $(DESTDIR)$(gsincludedir)
+	[ "$(USE_GTK)" = Yes ] || \
 	$(INSTALL_PROGRAM) $(GSSOC) $(DESTDIR)$(bindir)/$(GSSOC_XENAME)
+	[ "$(USE_GTK)" = No ] || \
 	$(INSTALL_PROGRAM) $(GSSOX) $(DESTDIR)$(bindir)/$(GSSOX_XENAME)
 	$(INSTALL_PROGRAM) $(BINDIR)/$(GS_SONAME_MAJOR_MINOR) $(DESTDIR)$(libdir)/$(GS_SONAME_MAJOR_MINOR)
-	$(RM_) $(DESTDIR)$(libdir)/$(GS_SONAME)
-	ln -s $(GS_SONAME_MAJOR_MINOR) $(DESTDIR)$(libdir)/$(GS_SONAME)
-	$(RM_) $(DESTDIR)$(libdir)/$(GS_SONAME_MAJOR)
-	ln -s $(GS_SONAME_MAJOR_MINOR) $(DESTDIR)$(libdir)/$(GS_SONAME_MAJOR)
 	$(INSTALL_DATA) $(PSSRC)iapi.h $(DESTDIR)$(gsincludedir)iapi.h
 	$(INSTALL_DATA) $(PSSRC)ierrors.h $(DESTDIR)$(gsincludedir)ierrors.h
 	$(INSTALL_DATA) $(GLSRC)gdevdsp.h $(DESTDIR)$(gsincludedir)gdevdsp.h
@@@@ -185,6 +192,8 @@@@ sodebuginstall:
 	$(MAKE) soinstall-subtarget GENOPT='-DDEBUG' BUILDDIRPREFIX=$(SODEBUGDIRPREFIX)
 
 soinstall-subtarget: install-so install-scripts install-data $(INSTALL_SHARED) $(INSTALL_CONTRIB)
+
+# NOTE: target SODIRS moved somewhere else.
 
 # Clean targets
 soclean:
@


1.5
log
@Update to ghostscript-9.06.
This fixes a crash when using PDF printing with gtk-print.

ok kili@@ (maintainer)
@
text
@d1 3
a3 3
$OpenBSD: patch-base_unix-dll_mak,v 1.4 2012/07/11 10:26:31 kili Exp $
--- base/unix-dll.mak.orig	Wed Aug  8 10:01:36 2012
+++ base/unix-dll.mak	Fri Aug 17 15:12:56 2012
d74 1
a74 1
@@@@ -100,6 +94,13 @@@@ SODEFS=\
d88 1
a88 1
@@@@ -118,19 +119,27 @@@@ sodebug:
d110 1
a110 1
 	$(MAKE) $(SODEFS) GENOPT='$(GENOPT)' LDFLAGS='$(LDFLAGS)'\
d118 1
a118 1
@@@@ -162,13 +171,11 @@@@ install-so-subtarget: so-subtarget$(FOR_MAC)
d134 1
a134 1
@@@@ -180,6 +187,8 @@@@ sodebuginstall:
@


1.4
log
@Update ghostscript to 9.05.

THe following devices had been added:

        cdnj500, eplcolor, eplmono, inkcov, pamcmyk4, plan, planc,
        plang, plank, planm, tiff48nc, tiff64nc, tiffscaled,
        tiffscaled24, tiffscaled8, tiffsep1, txtwrite

The following devices had been removed:

        cgm24, cgm8, cgmmono, imdi, lx5000, wtscmyk, wtsimdi

No objections from aja@@ two or three days ago.
@
text
@d1 4
a4 4
$OpenBSD: patch-base_unix-dll_mak,v 1.3 2011/11/16 12:43:23 kili Exp $
--- base/unix-dll.mak.orig	Wed Feb  8 09:48:48 2012
+++ base/unix-dll.mak	Sun Jul  8 16:04:24 2012
@@@@ -23,10 +23,6 @@@@
d15 1
a15 1
@@@@ -34,12 +30,16 @@@@ SODEBUGDIRPREFIX=sodebug
d34 1
a34 1
@@@@ -47,16 +47,10 @@@@ GS_SONAME_BASE=lib$(GS)
d36 1
a36 1
 GS_SOEXT=so
d54 1
a54 1
@@@@ -83,13 +77,13 @@@@ $(GS_SO_MAJOR): $(GS_SO_MAJOR_MINOR)
d74 1
a74 1
@@@@ -99,6 +93,13 @@@@ SODEFS=\
d88 1
a88 1
@@@@ -117,19 +118,27 @@@@ sodebug:
d118 1
a118 1
@@@@ -161,13 +170,11 @@@@ install-so-subtarget: so-subtarget$(FOR_MAC)
d134 1
a134 1
@@@@ -179,6 +186,8 @@@@ sodebuginstall:
@


1.3
log
@Update to ghostscript-9.04.

Enable jbig2dec support.

New devices still not enabled (I've to resort the
device list anyway).

ok ajacoutot@@
@
text
@d1 3
a3 3
$OpenBSD: patch-base_unix-dll_mak,v 1.2 2011/07/06 13:49:17 kili Exp $
--- base/unix-dll.mak.orig	Fri Aug  5 13:12:20 2011
+++ base/unix-dll.mak	Mon Nov 14 18:48:00 2011
d90 1
a90 1
 	$(MAKE) so-subtarget GENOPT='-DDEBUG' BUILDDIRPREFIX=$(SODEBUGDIRPREFIX)
d95 1
a95 1
 	 CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(XCFLAGS)' prefix=$(prefix)\
d99 1
a99 1
 	 CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(XCFLAGS)' prefix=$(prefix)\
d103 2
a104 2
-	 CFLAGS='$(CFLAGS_STANDARD) $(CFLAGS_SO) $(GCFLAGS) $(XCFLAGS)'\
+	 CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(XCFLAGS)'\
d111 1
a111 1
 	 CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(XCFLAGS)' prefix=$(prefix)\
d116 3
a118 3
 install-so:
 	$(MAKE) install-so-subtarget BUILDDIRPREFIX=$(SODIRPREFIX)
@@@@ -145,13 +154,11 @@@@ install-so-subtarget: so-subtarget
d134 1
a134 1
@@@@ -163,6 +170,8 @@@@ sodebuginstall:
@


1.2
log
@Update to gs-9.02 to fix the google maps problem with pdf2ps.

Drop gstoraster (formerly known as ps2raster); it is replaced
by the new gstoraster package.

Also Drop pstopxl, it's currently broken (at least since gs-9.00).
If anyone needs it, please let me know (or patch/repair it yourself
and send me a diff). Note that it would need rather heavy patching
or it had to depend on gnu grep.

ok aja@@
@
text
@d1 3
a3 3
$OpenBSD: patch-base_unix-dll_mak,v 1.1 2011/06/08 19:15:48 kili Exp $
--- base/unix-dll.mak.orig	Tue Jan 18 11:22:12 2011
+++ base/unix-dll.mak	Tue Jun 28 13:50:10 2011
d9 2
a10 2
-SOOBJRELDIR=../soobj
-SOBINRELDIR=../sobin
d15 1
a15 1
@@@@ -34,12 +30,16 @@@@ SOBINRELDIR=../sobin
d19 1
a19 1
-GSSOC=$(BINDIR)/$(SOBINRELDIR)/$(GSSOC_XENAME)
d27 1
a27 1
-GSSOX=$(BINDIR)/$(SOBINRELDIR)/$(GSSOX_XENAME)
d34 1
a34 1
@@@@ -47,16 +47,11 @@@@ GS_SONAME_BASE=lib$(GS)
d49 1
a49 1
 
d54 1
a54 1
@@@@ -83,25 +78,25 @@@@ $(GS_SO_MAJOR): $(GS_SO_MAJOR_MINOR)
d74 1
a74 3
 SODEFS=\
- GS_XE=$(BINDIR)/$(SOBINRELDIR)/$(GS_SONAME_MAJOR_MINOR)\
+ GS_XE=$(BINDIR)/$(GS_SONAME_MAJOR_MINOR)\
d76 13
a88 17
- DISPLAY_DEV=$(DD)$(SOOBJRELDIR)/display.dev\
- BINDIR=$(BINDIR)/$(SOBINRELDIR)\
- GLGENDIR=$(GLGENDIR)/$(SOOBJRELDIR)\
- GLOBJDIR=$(GLOBJDIR)/$(SOOBJRELDIR)\
- PSGENDIR=$(PSGENDIR)/$(SOOBJRELDIR)\
- PSOBJDIR=$(PSOBJDIR)/$(SOOBJRELDIR)
+ DISPLAY_DEV=$(DD)display.dev\
+ BINDIR=$(BINDIR)\
+ GLGENDIR=$(GLGENDIR)\
+ GLOBJDIR=$(GLOBJDIR)\
+ PSGENDIR=$(PSGENDIR)\
+ PSOBJDIR=$(PSOBJDIR)
 
 
 # Normal shared object
@@@@ -110,8 +105,8 @@@@ so: SODIRS
 	  then echo "Warning: this target requires gmake";\
d90 1
a90 7
 	$(MAKE) $(SODEFS) LDFLAGS='$(LDFLAGS)' CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(XCFLAGS)' prefix=$(prefix) \
-                $(GLOBJDIR)/$(SOOBJRELDIR)/echogs$(XEAUX) $(GLOBJDIR)/$(SOOBJRELDIR)/genarch$(XEAUX)
-	$(MAKE) $(SODEFS) LDFLAGS='$(LDFLAGS) $(LDFLAGS_SO)' CFLAGS='$(CFLAGS_STANDARD) $(CFLAGS_SO) $(GCFLAGS) $(XCFLAGS)' \
+                ${ECHOGS_XE} $(GENARCH_XE)
+	$(MAKE) $(SODEFS) LDFLAGS='$(LDFLAGS) $(LDFLAGS_SO)' CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(XCFLAGS)' \
                 prefix=$(prefix)
 	$(MAKE) $(SODEFS) LDFLAGS='$(LDFLAGS)' CFLAGS='$(CFLAGS_STANDARD) $(GCFLAGS) $(XCFLAGS)' prefix=$(prefix) $(GSSOC) $(GSSOX)
d92 27
a118 1
@@@@ -139,13 +134,11 @@@@ install-so: so
d126 1
a126 1
-	$(INSTALL_PROGRAM) $(BINDIR)/$(SOBINRELDIR)/$(GS_SONAME_MAJOR_MINOR) $(DESTDIR)$(libdir)/$(GS_SONAME_MAJOR_MINOR)
a130 1
+	$(INSTALL_PROGRAM) $(BINDIR)/$(GS_SONAME_MAJOR_MINOR) $(DESTDIR)$(libdir)/$(GS_SONAME_MAJOR_MINOR)
d134 6
a139 1
@@@@ -154,17 +147,17 @@@@ soinstall: install-so install-scripts install-data $(I
d141 2
a142 23
 # Make the build directories
 SODIRS: STDDIRS
-	@@if test ! -d $(BINDIR)/$(SOBINRELDIR); then mkdir -p $(BINDIR)/$(SOBINRELDIR); fi
-	@@if test ! -d $(GLGENDIR)/$(SOOBJRELDIR); then mkdir -p $(GLGENDIR)/$(SOOBJRELDIR); fi
-	@@if test ! -d $(GLOBJDIR)/$(SOOBJRELDIR); then mkdir -p $(GLOBJDIR)/$(SOOBJRELDIR); fi
-	@@if test ! -d $(PSGENDIR)/$(SOOBJRELDIR); then mkdir -p $(PSGENDIR)/$(SOOBJRELDIR); fi
-	@@if test ! -d $(PSOBJDIR)/$(SOOBJRELDIR); then mkdir -p $(PSOBJDIR)/$(SOOBJRELDIR); fi
+	@@if test ! -d $(BINDIR); then mkdir -p $(BINDIR); fi
+	@@if test ! -d $(GLGENDIR); then mkdir -p $(GLGENDIR); fi
+	@@if test ! -d $(GLOBJDIR); then mkdir -p $(GLOBJDIR); fi
+	@@if test ! -d $(PSGENDIR); then mkdir -p $(PSGENDIR); fi
+	@@if test ! -d $(PSOBJDIR); then mkdir -p $(PSOBJDIR); fi
 
 
 soclean: SODIRS
 	$(MAKE) $(SODEFS) clean
-	$(RM_) $(BINDIR)/$(SOBINRELDIR)/$(GS_SONAME)
-	$(RM_) $(BINDIR)/$(SOBINRELDIR)/$(GS_SONAME_MAJOR)
+	$(RM_) $(BINDIR)/$(GS_SONAME)
+	$(RM_) $(BINDIR)/$(GS_SONAME_MAJOR)
 	$(RM_) $(GSSOC)
 	$(RM_) $(GSSOX)
 	@@-rmdir $(BINDIR)/$(SOBINRELDIR) $(GLGENDIR)/$(SOOBJRELDIR) $(GLOBJDIR)/$(SOOBJRELDIR) $(PSGENDIR)/$(SOOBJRELDIR) $(PSOBJDIR)/$(SOOBJRELDIR) || true 
@


1.1
log
@Update to ghostscript-9.00.

ok landry@@ (after putting it in a bulk build... thanks)
@
text
@d1 3
a3 3
$OpenBSD$
--- base/unix-dll.mak.orig	Fri Jul 23 10:22:43 2010
+++ base/unix-dll.mak	Sun Nov 14 22:05:26 2010
d34 1
a34 1
@@@@ -47,9 +47,9 @@@@ GS_SONAME_BASE=lib$(GS)
d40 1
a40 1
-LDFLAGS_SO=-shared -Wl,-soname=$(GS_SONAME_MAJOR)
d45 6
d53 2
a54 1
@@@@ -77,25 +77,25 @@@@ $(GS_SO_MAJOR): $(GS_SO_MAJOR_MINOR)
d60 1
a60 1
-	$(LDFLAGS) -L$(BINDIR) -l$(GS)
d67 1
a67 1
-	$(LDFLAGS) -L$(BINDIR) -l$(GS) $(SOC_LIBS)
d93 1
a93 1
@@@@ -104,8 +104,8 @@@@ so: SODIRS
d104 1
a104 1
@@@@ -133,13 +133,11 @@@@ install-so: so
d121 1
a121 1
@@@@ -148,17 +146,17 @@@@ soinstall: install-so install-scripts install-data $(I
@

