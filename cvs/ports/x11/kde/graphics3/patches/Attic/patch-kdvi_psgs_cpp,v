head	1.1;
access;
symbols
	OPENBSD_3_3:1.1.0.4
	OPENBSD_3_2:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2003.04.10.18.59.40;	author brad;	state dead;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2003.04.10.18.59.40;	author brad;	state Exp;
branches;
next	;

1.1.4.1
date	2003.05.02.18.49.29;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-kdvi_psgs_cpp was initially added on branch OPENBSD_3_2.
@
text
@@


1.1.4.1
log
@Fix security issue mentioned in this advisory
http://www.kde.org/info/security/advisory-20030409-1.txt
@
text
@a0 32
$OpenBSD$
--- kdvi/psgs.cpp.orig	Sun Sep 15 23:12:40 2002
+++ kdvi/psgs.cpp	Wed Apr 23 18:00:42 2003
@@@@ -59,6 +59,12 @@@@ void ghostscript_interface::setSize(doub
   DiskCache->clear();
 }
 
+void ghostscript_interface::setIncludePath(const QString &_includePath) {
+  if (_includePath.isEmpty())
+     includePath = "*"; // Allow all files
+  else
+     includePath = _includePath+"/*";
+}
 
 void ghostscript_interface::setPostScript(int page, QString PostScript) {
   pageInfo *info = new pageInfo(PostScript);
@@@@ -125,11 +131,13 @@@@ void ghostscript_interface::gs_generate_
   // Step 2: Call GS with the File
   KProcess proc;
   proc << "gs";
-  proc << "-dNOPAUSE" << "-dBATCH" << "-sDEVICE=png256";
+  proc << "-dSAFER" << "-dPARANOIDSAFER" << "-dDELAYSAFER" << "-dNOPAUSE" << "-dBATCH" << "-sDEVICE=png256";
   proc << QString("-sOutputFile=%1").arg(filename);
+  proc << QString("-sExtraIncludePath=%1").arg(includePath);
   proc << QString("-g%1x%2").arg(pixel_page_w).arg(pixel_page_h); // page size in pixels
   proc << QString("-r%1").arg(resolution);                       // resolution in dpi
-  proc << PSfile.name();
+  proc << "-c" << "<< /PermitFileReading [ ExtraIncludePath ] /PermitFileWriting [] /PermitFileControl [] >> setuserparams .locksafe";
+  proc << "-f" << PSfile.name();
   proc.start(KProcess::Block);
   PSfile.unlink();
   emit(setStatusBarText(QString::null));
@


1.1.2.1
log
@Fix security issue mentioned in this advisory

http://www.kde.org/info/security/advisory-20030409-1.txt

as well as applying the other security related fixes from KDE 3.0.5b.
@
text
@a0 32
$OpenBSD$
--- kdvi/psgs.cpp.orig	Wed Sep 26 13:47:24 2001
+++ kdvi/psgs.cpp	Thu Apr 10 02:05:05 2003
@@@@ -54,6 +54,12 @@@@ void ghostscript_interface::setSize(doub
   DiskCache->clear();
 }
 
+void ghostscript_interface::setIncludePath(const QString &_includePath) {
+  if (_includePath.isEmpty())
+     includePath = "*"; // Allow all files
+  else
+     includePath = _includePath+"/*";
+}
 
 void ghostscript_interface::setPostScript(int page, QString PostScript) {
   pageInfo *info = new pageInfo(PostScript);
@@@@ -120,11 +126,13 @@@@ void ghostscript_interface::gs_generate_
   // Step 2: Call GS with the File
   KProcess proc;
   proc << "gs";
-  proc << "-dNOPAUSE" << "-dBATCH" << "-sDEVICE=png256";
+  proc << "-dSAFER" << "-dPARANOIDSAFER" << "-dDELAYSAFER" << "-dNOPAUSE" << "-dBATCH" << "-sDEVICE=png256";
   proc << QString("-sOutputFile=%1").arg(filename);
+  proc << QString("-sExtraIncludePath=%1").arg(includePath);
   proc << QString("-g%1x%2").arg(pixel_page_w).arg(pixel_page_h); // page size in pixels
   proc << QString("-r%1").arg(resolution);                       // resolution in dpi
-  proc << PSfile.name();
+  proc << "-c" << "<< /PermitFileReading [ ExtraIncludePath ] /PermitFileWriting [] /PermitFileControl [] >> setuserparams .locksafe";
+  proc << "-f" << PSfile.name();
   proc.start(KProcess::Block);
   PSfile.unlink();
 }
@

