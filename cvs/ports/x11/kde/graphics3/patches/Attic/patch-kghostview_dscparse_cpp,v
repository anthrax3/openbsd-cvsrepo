head	1.2;
access;
symbols
	OPENBSD_3_2:1.1.0.2
	OPENBSD_3_2_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2002.10.28.21.44.32;	author espie;	state dead;
branches;
next	1.1;

1.1
date	2002.09.28.22.50.30;	author brad;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2002.12.26.22.28.18;	author pvalchev;	state dead;
branches;
next	1.1.2.2;

1.1.2.2
date	2003.04.10.18.59.40;	author brad;	state Exp;
branches;
next	;


desc
@@


1.2
log
@3.0.4 update, most of it.
i18n packlists to check yet...
@
text
@$OpenBSD: patch-kghostview_dscparse_cpp,v 1.1 2002/09/28 22:50:30 brad Exp $
--- kghostview/dscparse.cpp.orig	Sun Feb 17 12:38:24 2002
+++ kghostview/dscparse.cpp	Sat Sep 28 18:15:56 2002
@@@@ -973,9 +973,13 @@@@ dsc_read_line(CDSC *dsc)
 	     */
 	    char begindata[MAXSTR+1];
 	    int cnt;
+	    unsigned int num;
 	    const char *numberof, *bytesorlines;
-	    memcpy(begindata, dsc->line, dsc->line_length);
-	    begindata[dsc->line_length] = '\0';
+	    if ((num = dsc->line_length) >= sizeof(begindata)-1)
+		num = sizeof(begindata)-1;
+
+	    memcpy(begindata, dsc->line, num);
+	    begindata[num] = '\0';
 	    numberof = strtok(begindata+12, " \r\n");
 	    strtok(NULL, " \r\n");	/* dump type */
 	    bytesorlines = strtok(NULL, " \r\n");
@


1.1
log
@fix buffer overflow issue with kghostview.
--
Patch from: Dirk Mueller <mueller@@kde.org> via espie@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@MFC:
Security update: 3.0.5a. Fixes numerous vulnerabilities.
@
text
@d1 1
a1 1
$OpenBSD: patch-kghostview_dscparse_cpp,v 1.1 2002/09/28 22:50:30 brad Exp $
@


1.1.2.2
log
@Fix security issue mentioned in this advisory

http://www.kde.org/info/security/advisory-20030409-1.txt

as well as applying the other security related fixes from KDE 3.0.5b.
@
text
@d1 19
a19 12
$OpenBSD$
--- kghostview/dscparse.cpp.orig	Sat Sep 28 14:29:16 2002
+++ kghostview/dscparse.cpp	Thu Apr 10 02:05:05 2003
@@@@ -2316,7 +2316,7 @@@@ dsc_private int
 dsc_check_match_prompt(CDSC *dsc, const char *str, int count)
 {
     if (count != 0) {
-	char buf[MAXSTR+MAXSTR];
+	char buf[MAXSTR+MAXSTR] = "";
 	if (dsc->line_length < (unsigned int)(sizeof(buf)/2-1))  {
 	    strncpy(buf, dsc->line, dsc->line_length);
 	    buf[dsc->line_length] = '\0';
@


