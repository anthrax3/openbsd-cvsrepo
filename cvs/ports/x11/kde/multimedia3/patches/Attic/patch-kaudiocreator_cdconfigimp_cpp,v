head	1.4;
access;
symbols
	OPENBSD_3_4:1.2.0.2
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.1.0.2
	OPENBSD_3_3_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2004.02.01.14.59.23;	author espie;	state dead;
branches;
next	1.3;

1.3
date	2003.12.07.20.19.15;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2003.06.12.19.16.16;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.27.19.53.58;	author espie;	state Exp;
branches;
next	;


desc
@@


1.4
log
@basic import of kde 3.1.95, still missing a few parts.

TODO:
- compile the missing packages.
- redo konsole fixes for our ttys.
- figure out why kuickshow is broken.
- make sure we get all dependencies.
- repair kscd.
- find out why nsplugins does not like the native jdk.
- figure out how to get kvim to work.
- change filenames or adjust check-lib-depends to cope.
@
text
@$OpenBSD: patch-kaudiocreator_cdconfigimp_cpp,v 1.3 2003/12/07 20:19:15 espie Exp $
--- kaudiocreator/cdconfigimp.cpp.orig	2003-09-02 03:17:41.000000000 +0200
+++ kaudiocreator/cdconfigimp.cpp	2003-12-04 19:37:22.000000000 +0100
@@@@ -82,6 +82,11 @@@@ extern "C"
 }
 #endif
 
+#if defined(__NetBSD__) || defined(__OpenBSD__)
+#include <sys/ioctl.h>
+#include <sys/cdio.h>
+#endif
+
 #include <kdebug.h>
 #include <kurl.h>
 #include <kprotocolmanager.h>
@@@@ -139,14 +144,24 @@@@ int FixupTOC(cdrom_drive *d, int tracks)
   start_of_first_data_as_in_toc = -1;
   hack_track = -1;
   if (d->ioctl_fd != -1) {
+#ifdef __linux__
     struct cdrom_multisession ms_str;
     ms_str.addr_format = CDROM_LBA;
     if (ioctl(d->ioctl_fd, CDROMMULTISESSION, &ms_str) == -1)
       return -1;
-    if (ms_str.addr.lba > 100) {
+#define ms_addr (ms_str.addr.lba)
+#endif
+#if defined(__NetBSD__) || defined(__OpenBSD__)
+  int ms_addr;
+  ms_addr = 0;   /* last session */
+  if (ioctl(d->ioctl_fd, CDIOREADMSADDR, &ms_addr) == -1)
+        return -1;
+#endif
+
+    if (ms_addr > 100) {
       for (j = tracks-1; j >= 0; j--)
         if (j > 0 && !IS_AUDIO(d,j) && IS_AUDIO(d,j-1)) {
-          if (d->disc_toc[j].dwStartSector > ms_str.addr.lba - 11400) {
+          if (d->disc_toc[j].dwStartSector > ms_addr - 11400) {
             /* The next two code lines are the purpose of duplicating this
              * function, all others are an exact copy of paranoias FixupTOC().
              * The gory details: CD-Extra consist of N audio-tracks in the
@@@@ -167,7 +182,7 @@@@ int FixupTOC(cdrom_drive *d, int tracks)
              * length is only implicitely given.  Bloody sh*.  */
             start_of_first_data_as_in_toc = d->disc_toc[j].dwStartSector;
             hack_track = j + 1;
-            d->disc_toc[j].dwStartSector = ms_str.addr.lba - 11400;
+            d->disc_toc[j].dwStartSector = ms_addr - 11400;
           }
           break;
         }
@


1.3
log
@update to 3.1.4
@
text
@d1 1
a1 1
$OpenBSD: patch-kaudiocreator_cdconfigimp_cpp,v 1.2 2003/06/12 19:16:16 espie Exp $
@


1.2
log
@Update to kde 3.1.2 (requires recent autoconf).
Fix some build issues, mainly in kdebindings and kdemultimedia.
@
text
@d1 4
a4 12
$OpenBSD: patch-kaudiocreator_cdconfigimp_cpp,v 1.1 2003/01/27 19:53:58 espie Exp $
--- kaudiocreator/cdconfigimp.cpp.orig	Wed May  7 13:46:47 2003
+++ kaudiocreator/cdconfigimp.cpp	Wed Jun 11 09:17:09 2003
@@@@ -75,12 +75,19 @@@@ extern "C"
 {
 /* This is in support for the Mega Hack, if cdparanoia ever is fixed, or we
    use another ripping library we can remove this.  */
+#ifdef __linux__
 #include <linux/cdrom.h>
+#endif
 #include <sys/ioctl.h>
 
d16 1
a16 1
@@@@ -138,14 +145,24 @@@@ int FixupTOC(cdrom_drive *d, int tracks)
d43 1
a43 1
@@@@ -166,7 +183,7 @@@@ int FixupTOC(cdrom_drive *d, int tracks)
@


1.1
log
@kdemultimedia 3.1, with fixes for kaudiocdcreator that used to be in
kdebase...
@
text
@d1 5
a5 5
$OpenBSD$
--- kaudiocreator/cdconfigimp.cpp.orig	Sun Oct 27 00:20:12 2002
+++ kaudiocreator/cdconfigimp.cpp	Sat Jan  4 18:34:53 2003
@@@@ -59,8 +59,13 @@@@ extern "C"
 
d12 4
d17 1
d20 5
a24 4
 
 #if HAVE_LAME
 #include <lame/lame.h>
@@@@ -114,14 +119,24 @@@@ int FixupTOC(cdrom_drive *d, int tracks)
d51 1
a51 1
@@@@ -142,7 +157,7 @@@@ int FixupTOC(cdrom_drive *d, int tracks)
@

