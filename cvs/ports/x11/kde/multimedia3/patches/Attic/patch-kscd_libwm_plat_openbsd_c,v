head	1.8;
access;
symbols
	OPENBSD_5_9:1.7.0.34
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.36
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.32
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.30
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.28
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.26
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.24
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.22
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.20
	OPENBSD_5_0:1.7.0.18
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.16
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.14
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.12
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.7.0.10
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.7.0.8
	OPENBSD_4_5_BASE:1.7
	OPENBSD_4_4:1.7.0.6
	OPENBSD_4_4_BASE:1.7
	OPENBSD_4_3:1.7.0.4
	OPENBSD_4_3_BASE:1.7
	OPENBSD_4_2:1.7.0.2
	OPENBSD_4_2_BASE:1.7
	OPENBSD_4_1:1.6.0.6
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.4
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.6.0.2
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.5.0.2
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.4.0.2
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.3.0.4
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.2
	OPENBSD_3_5_BASE:1.3
	kde:1.1.1.1
	espie:1.1.1;
locks; strict;
comment	@# @;


1.8
date	2016.04.29.21.10.23;	author zhuk;	state dead;
branches;
next	1.7;
commitid	u9TvebbKy1wgQMr9;

1.7
date	2007.05.25.09.49.55;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2006.02.16.08.25.11;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2005.06.04.12.12.10;	author naddy;	state Exp;
branches;
next	1.4;

1.4
date	2004.09.18.09.36.44;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2004.02.01.23.59.17;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2002.05.23.14.37.22;	author espie;	state dead;
branches;
next	1.1;

1.1
date	2002.04.20.17.08.42;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2002.04.20.17.08.42;	author espie;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Remove KDE3 applications that have well-working KDE4+ counterparts.
@
text
@$OpenBSD: patch-kscd_libwm_plat_openbsd_c,v 1.7 2007/05/25 09:49:55 espie Exp $
--- kscd/libwm/plat_openbsd.c.orig	Sat Sep 10 10:19:56 2005
+++ kscd/libwm/plat_openbsd.c	Thu May 24 16:28:25 2007
@@@@ -57,7 +57,6 @@@@
 #include <sys/scsiio.h>
 #include <scsi/scsi_all.h>
 #include <scsi/cd.h>
-#include <scsi/scsi_cd.h>
 
 #include "include/wm_struct.h"
 #include "include/wm_cdtext.h"
@@@@ -127,10 +126,9 @@@@ wmcd_open(struct wm_drive *d)
   
   find_drive_struct(vendor, model, rev);
   
-  (d->init)(d);
-  
   d->fd = fd;
-  
+  if (d->proto->gen_init)
+  	return (d->proto->gen_init)(d);
   return (0);
 } /* wmcd_open() */
 
@@@@ -314,7 +312,7 @@@@ gen_get_cdlen(struct wm_drive *d, int *frames)
  * Play the CD from one position to another (both in frames.)
  */
 int
-gen_play(struct wm_drive *d, int start, int end)
+gen_play(struct wm_drive *d, int start, int end, int realstart)
 {
   struct ioc_play_msf	msf;
   
@


1.7
log
@update a large subset of kde 3 to 3.5.7.
Simplify the infrastructure a bit, and let it compile with libfam, now...
@
text
@d1 1
a1 1
$OpenBSD: patch-kscd_libwm_plat_openbsd_c,v 1.6 2006/02/16 08:25:11 espie Exp $
@


1.6
log
@3.5.1, finally
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
+++ kscd/libwm/plat_openbsd.c	Wed Feb 15 12:13:03 2006
d25 1
a25 1
@@@@ -314,7 +312,7 @@@@ gen_get_cdlen(struct wm_drive *d, int *f
@


1.5
log
@scsi/scsi_cd.h is gone
@
text
@d1 3
a3 3
$OpenBSD: patch-kscd_libwm_plat_openbsd_c,v 1.4 2004/09/18 09:36:44 espie Exp $
--- kscd/libwm/plat_openbsd.c.orig	Mon May 23 06:06:56 2005
+++ kscd/libwm/plat_openbsd.c	Sat Jun  4 05:00:08 2005
@


1.4
log
@update to kde 3.3.0.
@
text
@d1 12
a12 4
$OpenBSD: patch-kscd_libwm_plat_openbsd_c,v 1.3 2004/02/01 23:59:17 espie Exp $
--- kscd/libwm/plat_openbsd.c.orig	Sat May 22 22:56:56 2004
+++ kscd/libwm/plat_openbsd.c	Tue Sep  7 17:25:44 2004
@@@@ -127,10 +127,9 @@@@ wmcd_open(struct wm_drive *d)
d25 1
a25 1
@@@@ -314,7 +313,7 @@@@ gen_get_cdlen(struct wm_drive *d, int *f
@


1.3
log
@forgotten patches.
@
text
@d1 4
a4 4
$OpenBSD$
--- kscd/libwm/plat_openbsd.c.orig	2004-02-01 00:05:09.000000000 +0100
+++ kscd/libwm/plat_openbsd.c	2004-02-01 00:08:59.000000000 +0100
@@@@ -129,10 +129,9 @@@@ wmcd_open(struct wm_drive *d)
d17 1
a17 1
@@@@ -316,7 +315,7 @@@@ gen_get_cdlen(struct wm_drive *d, int *f
@


1.2
log
@Update to kde 3.0.1.
Mostly remove integrated patches, and adapt a few plists.
There may be minor pieces yet to do...
@
text
@d1 4
a4 35
$OpenBSD: patch-kscd_libwm_plat_openbsd_c,v 1.1 2002/04/20 17:08:42 espie Exp $
--- kscd/libwm/plat_openbsd.c.orig	Tue Apr 10 19:34:52 2001
+++ kscd/libwm/plat_openbsd.c	Sat Apr 20 04:59:59 2002
@@@@ -44,6 +44,8 @@@@ static char plat_openbsd[] = "$Id: plat_
 #include <sys/stat.h>
 
 #include "include/wm_config.h"
+#include "include/wm_cdrom.h"
+#include "include/wm_helpers.h"
 
 /* this is for glibc 2.x which defines the ust structure in ustat.h not stat.h */
 #ifdef __GLIBC__
@@@@ -56,6 +58,7 @@@@ static char plat_openbsd[] = "$Id: plat_
 #include <sys/cdio.h>
 #include <sys/scsiio.h>
 #include <scsi/scsi_all.h>
+#include <scsi/cd.h>
 #include <scsi/scsi_cd.h>
 
 #include "include/wm_struct.h"
@@@@ -81,6 +84,9 @@@@ gen_init(struct wm_drive *d)
 } /* gen_init() */
 
 
+char *cds[] = {"/dev/rcd0c", "/dev/rcd1c", "/dev/acd0c", NULL};
+
+
 /*
  * Open the CD device and figure out what kind of drive is attached.
  */
@@@@ -92,6 +98,7 @@@@ wmcd_open(struct wm_drive *d)
   char vendor[32] = WM_STR_GENVENDOR;
   char  model[32] = WM_STR_GENMODEL;
   char    rev[32] = WM_STR_GENREV;
+  int i;
d6 1
a6 4
   if (d->fd >= 0)		/* Device already open? */
     {
@@@@ -100,18 +107,24 @@@@ wmcd_open(struct wm_drive *d)
     }
d8 3
a10 2
   if (cd_device == NULL)
-    cd_device = DEFAULT_CD_DEVICE;
d12 7
a18 30
-  d->fd = open(cd_device, 0);
+    {
+      for (i = 0; cds[i] != NULL; i++)
+      {
+      	  cd_device = cds[i];
+	  d->fd = open(cd_device, O_RDONLY);
+	  if (d->fd >= 0)
+	    break;
+      }
+    }
+  else
+  	d->fd = open(cd_device, O_RDONLY);
   if (d->fd < 0)
     {
-      if (errno == EACCES)
-	{
-          return -EACCES;
-	}
-      
+      if (errno == EIO)
       /* No CD in drive. */
-      return (1);
+      	return 1;
+      else
+      	return -errno;
     }
   
   /* Now fill in the relevant parts of the wm_drive structure. */
@@@@ -244,7 +257,7 @@@@ gen_get_drive_status(struct wm_drive *d,
  * Get the number of tracks on the CD.
d21 2
a22 2
-gen_get_trackcount(struct wm_drive *d, int tracks)
+gen_get_trackcount(struct wm_drive *d, int *tracks)
d24 1
a24 1
   struct ioc_toc_header	hdr;
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@initial attempt at a kdemultimedia package.
enough patches to make everything compiles, lots of patches to
rename the internal mpeglib and workman libraries to something that
doesn't conflict with the rest of the ports tree.

kscd works, noatun and skins as well.

mpeglib seems to have some threads issue yet, but it compiles.
@
text
@@
