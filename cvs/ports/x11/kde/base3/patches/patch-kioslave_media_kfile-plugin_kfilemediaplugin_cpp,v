head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.40
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.38
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.34
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.36
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.32
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.30
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.28
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.26
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.24
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.22
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.20
	OPENBSD_5_0:1.3.0.18
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.16
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.14
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.12
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.10
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.8
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.6
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.4
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.2
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.1.0.2
	OPENBSD_4_1_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2007.05.28.20.15.55;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2007.05.25.09.49.54;	author espie;	state dead;
branches;
next	1.1;

1.1
date	2007.01.28.13.18.50;	author espie;	state Exp;
branches;
next	;


desc
@@


1.3
log
@forgotten patch. Noticed by brad@@
@
text
@$OpenBSD$
--- kioslave/media/kfile-plugin/kfilemediaplugin.cpp.orig	Mon May 14 20:25:23 2007
+++ kioslave/media/kfile-plugin/kfilemediaplugin.cpp	Mon May 14 20:26:53 2007
@@@@ -33,6 +33,7 @@@@
 #ifdef HAVE_STATVFS
 # include <sys/statvfs.h>
 #else
+# include <sys/param.h>
 # include <sys/mount.h>
 # define statvfs statfs
 # define f_frsize f_bsize
@


1.2
log
@update a large subset of kde 3 to 3.5.7.
Simplify the infrastructure a bit, and let it compile with libfam, now...
@
text
@d1 11
a11 31
$OpenBSD: patch-kioslave_media_kfile-plugin_kfilemediaplugin_cpp,v 1.1 2007/01/28 13:18:50 espie Exp $
--- kioslave/media/kfile-plugin/kfilemediaplugin.cpp.orig	Wed Jan 17 00:17:09 2007
+++ kioslave/media/kfile-plugin/kfilemediaplugin.cpp	Wed Jan 17 00:22:49 2007
@@@@ -29,7 +29,8 @@@@
 #include <qapplication.h>
 #include <qfile.h>
 
-#include <sys/statvfs.h>
+#include <sys/param.h>
+#include <sys/mount.h>
 
 typedef KGenericFactory<KFileMediaPlugin> KFileMediaPluginFactory;
 K_EXPORT_COMPONENT_FACTORY(kfile_media, KFileMediaPluginFactory("kio_media"))
@@@@ -99,13 +100,13 @@@@ bool KFileMediaPlugin::readInfo(KFileMet
 		m_used = 0;
 		m_free = 0;
 
-		struct statvfs vfs;
+		struct statfs vfs;
 		memset(&vfs, 0, sizeof(vfs));
 
-		if ( ::statvfs(QFile::encodeName(mount_point), &vfs) != -1 )
+		if ( ::statfs(QFile::encodeName(mount_point), &vfs) != -1 )
 		{
-			m_total = static_cast<KIO::filesize_t>(vfs.f_blocks) * static_cast<KIO::filesize_t>(vfs.f_frsize);
-			m_free = static_cast<KIO::filesize_t>(vfs.f_bavail) * static_cast<KIO::filesize_t>(vfs.f_frsize);
+			m_total = static_cast<KIO::filesize_t>(vfs.f_blocks) * static_cast<KIO::filesize_t>(vfs.f_bsize);
+			m_free = static_cast<KIO::filesize_t>(vfs.f_bavail) * static_cast<KIO::filesize_t>(vfs.f_bsize);
 			m_used = m_total - m_free;
 
 			int percent = 0;
@


1.1
log
@kde 3.5.6 update, missing bindings and l10n.
@
text
@d1 1
a1 1
$OpenBSD$
@

