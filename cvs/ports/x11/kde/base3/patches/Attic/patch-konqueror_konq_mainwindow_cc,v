head	1.6;
access;
symbols
	OPENBSD_4_0:1.5.0.4
	OPENBSD_4_1:1.5.0.2
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.1.0.2
	OPENBSD_3_6_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2007.10.24.21.52.16;	author espie;	state dead;
branches;
next	1.5;

1.5
date	2007.08.25.08.03.02;	author espie;	state Exp;
branches
	1.5.2.1
	1.5.4.1;
next	1.4;

1.4
date	2005.03.29.21.18.35;	author espie;	state dead;
branches;
next	1.3;

1.3
date	2005.02.27.08.15.40;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2004.09.18.09.46.36;	author espie;	state dead;
branches;
next	1.1;

1.1
date	2004.08.14.18.03.48;	author brad;	state Exp;
branches;
next	;

1.5.2.1
date	2007.09.01.17.48.54;	author ajacoutot;	state Exp;
branches;
next	;

1.5.4.1
date	2007.09.01.17.51.40;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.6
log
@update to 3.5.8
@
text
@$OpenBSD: patch-konqueror_konq_mainwindow_cc,v 1.5 2007/08/25 08:03:02 espie Exp $
--- konqueror/konq_mainwindow.cc.orig	Mon May 14 09:55:47 2007
+++ konqueror/konq_mainwindow.cc	Wed Aug 15 13:55:38 2007
@@@@ -611,12 +611,11 @@@@ void KonqMainWindow::openURL( KonqView *_view, const K
   }
   else // no known serviceType, use KonqRun
   {
-      if ( ( view && view == m_currentView ) ||
-              ( !view && !req.newTab ) ) // startup with argument
+      if ( ( !view || view->url().isEmpty() ) && !req.newTab ) // startup with argument
       {
           // Show it for now in the location bar, but we'll need to store it in the view
           // later on (can't do it yet since either view == 0 or updateHistoryEntry will be called).
-          kdDebug(1202) << "setLocationBarURL : url = " << url << endl;
+          kdDebug(1202) << "setLocationBarURL (startup) : url = " << url << endl;
           setLocationBarURL( url );
       }
 
@@@@ -819,8 +818,6 @@@@ bool KonqMainWindow::openView( QString serviceType, co
         if ( childView )
         {
             enableAllActions( true );
-
-            m_pViewManager->setActivePart( childView->part() );
             m_currentView = childView;
         }
       }
@


1.5
log
@CVE-2007-4224
CVE-2007-3820
@
text
@d1 1
a1 1
$OpenBSD$
@


1.5.4.1
log
@- backport security fixes
CVE-2007-4224
CVE-2007-3820

ok sturm@@
@
text
@d1 4
a4 4
$OpenBSD: patch-konqueror_konq_mainwindow_cc,v 1.5 2007/08/25 08:03:02 espie Exp $
--- konqueror/konq_mainwindow.cc.orig	Sun Jul 23 16:23:24 2006
+++ konqueror/konq_mainwindow.cc	Thu Aug 30 10:06:59 2007
@@@@ -608,12 +608,11 @@@@ void KonqMainWindow::openURL( KonqView *
d19 1
a19 1
@@@@ -816,8 +815,6 @@@@ bool KonqMainWindow::openView( QString s
@


1.5.2.1
log
@- backport security fixes
CVE-2007-4224
CVE-2007-3820

input and ok sturm@@
@
text
@d1 4
a4 4
$OpenBSD: patch-konqueror_konq_mainwindow_cc,v 1.5 2007/08/25 08:03:02 espie Exp $
--- konqueror/konq_mainwindow.cc.orig	Mon Jan 15 12:32:12 2007
+++ konqueror/konq_mainwindow.cc	Thu Aug 30 10:24:17 2007
@@@@ -611,12 +611,11 @@@@ void KonqMainWindow::openURL( KonqView *
d19 1
a19 1
@@@@ -819,8 +818,6 @@@@ bool KonqMainWindow::openView( QString s
@


1.4
log
@most of kde 3.4, will finish getting fixed in tree... ;-)
@
text
@d1 22
a22 26
$OpenBSD: patch-konqueror_konq_mainwindow_cc,v 1.3 2005/02/27 08:15:40 brad Exp $
--- konqueror/konq_mainwindow.cc.orig	Sun Feb 27 03:07:36 2005
+++ konqueror/konq_mainwindow.cc	Sun Feb 27 03:09:54 2005
@@@@ -2252,6 +2252,17 @@@@ KonqView * KonqMainWindow::childView( KP
     QString viewName = view->viewName();
     kdDebug() << "       - viewName=" << viewName << "   "
               << "frame names:" << view->frameNames().join( "," ) << endl;
+
+    // First look for a hostextension containing this frame name
+    KParts::BrowserHostExtension *ext = KParts::BrowserHostExtension::childObject( view->part() );
+    if ( ext )
+    {
+      ext = ext->findFrameParent(callingPart, name);
+      kdDebug() << "BrowserHostExtension found part " << ext << endl;
+      if (!ext)
+         continue; // Don't use this window
+    }
+
     if ( !viewName.isEmpty() && viewName == name )
     {
       kdDebug() << "found existing view by name: " << view << endl;
@@@@ -2260,13 +2271,6 @@@@ KonqView * KonqMainWindow::childView( KP
       if ( part )
         *part = view->part();
       return view;
-    }
d24 4
a27 8
-    // First look for a hostextension containing this frame name
-    KParts::BrowserHostExtension *ext = KParts::BrowserHostExtension::childObject( view->part() );
-    if ( ext )
-    {
-      ext = ext->findFrameParent(callingPart, name);
     }
 
 //    KParts::BrowserHostExtension* ext = KonqView::hostExtension( view->part(), name );
@


1.3
log
@post-3.3.2-kdebase-htmlframes2.patch
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@removed patches, better synched global patches.
@
text
@d1 4
a4 59
$OpenBSD: patch-konqueror_konq_mainwindow_cc,v 1.1 2004/08/14 18:03:48 brad Exp $
--- konqueror/konq_mainwindow.cc.orig	Sun May 30 07:41:54 2004
+++ konqueror/konq_mainwindow.cc	Fri Aug 13 17:08:05 2004
@@@@ -856,6 +856,7 @@@@ void KonqMainWindow::slotOpenURLRequest(
 {
   kdDebug(1202) << "KonqMainWindow::slotOpenURLRequest frameName=" << args.frameName << endl;
 
+  KParts::ReadOnlyPart *callingPart = static_cast<KParts::ReadOnlyPart *>( sender()->parent() );
   QString frameName = args.frameName;
 
   if ( !frameName.isEmpty() )
@@@@ -876,11 +877,11 @@@@ void KonqMainWindow::slotOpenURLRequest(
          frameName.lower() != _parent )
     {
       KParts::BrowserHostExtension *hostExtension = 0;
-      KonqView *view = childView( frameName, &hostExtension, 0 );
+      KonqView *view = childView( callingPart, frameName, &hostExtension, 0 );
       if ( !view )
       {
         KonqMainWindow *mainWindow = 0;
-        view = findChildView( frameName, &mainWindow, &hostExtension, 0 );
+        view = findChildView( callingPart, frameName, &mainWindow, &hostExtension, 0 );
 
         if ( !view || !mainWindow )
         {
@@@@ -903,8 +904,7 @@@@ void KonqMainWindow::slotOpenURLRequest(
     }
   }
 
-  KParts::ReadOnlyPart *part = static_cast<KParts::ReadOnlyPart *>( sender()->parent() );
-  KonqView *view = childView( part );
+  KonqView *view = childView( callingPart );
   openURL( view, url, args );
 }
 
@@@@ -1039,7 +1039,7 @@@@ void KonqMainWindow::slotCreateNewWindow
     if ( !args.frameName.isEmpty() && args.frameName.lower() != "_blank" )
     {
         KParts::BrowserHostExtension *hostExtension = 0;
-        if ( findChildView( args.frameName, &mainWindow, &hostExtension, &part ) )
+        if ( findChildView( 0, args.frameName, &mainWindow, &hostExtension, &part ) )
         {
             // Found a view. If url isn't empty, we should open it - but this never happens currently
             // findChildView put the resulting part in 'part', so we can just return now
@@@@ -2091,9 +2091,9 @@@@ KonqView * KonqMainWindow::childView( KP
     return 0L;
 }
 
-KonqView * KonqMainWindow::childView( const QString &name, KParts::BrowserHostExtension **hostExtension, KParts::ReadOnlyPart **part )
+KonqView * KonqMainWindow::childView( KParts::ReadOnlyPart *callingPart, const QString &name, KParts::BrowserHostExtension **hostExtension, KParts::ReadOnlyPart **part )
 {
-  //kdDebug() << "KonqMainWindow::childView this=" << this << " looking for " << name << endl;
+  kdDebug() << "KonqMainWindow::childView this=" << this << " looking for " << name << endl;
 
   MapViews::ConstIterator it = m_mapViews.begin();
   MapViews::ConstIterator end = m_mapViews.end();
@@@@ -2101,11 +2101,11 @@@@ KonqView * KonqMainWindow::childView( co
   {
     KonqView* view = it.data();
d6 4
a9 17
-    //kdDebug() << "       - viewName=" << viewName << "   "
-    //          << "frame names:" << view->frameNames().join( "," ) << endl;
+    kdDebug() << "       - viewName=" << viewName << "   "
+              << "frame names:" << view->frameNames().join( "," ) << endl;
     if ( !viewName.isEmpty() && viewName == name )
     {
-      //kdDebug() << "found existing view by name: " << view << endl;
+      kdDebug() << "found existing view by name: " << view << endl;
       if ( hostExtension )
         *hostExtension = 0;
       if ( part )
@@@@ -2114,8 +2114,13 @@@@ KonqView * KonqMainWindow::childView( co
     }
 
     // First look for a hostextension containing this frame name
-    // (KonqView looks for it recursively)
-    KParts::BrowserHostExtension* ext = KonqView::hostExtension( view->part(), name );
d14 3
d18 2
a19 4
+    
+//    KParts::BrowserHostExtension* ext = KonqView::hostExtension( view->part(), name );
 
     if ( ext )
d21 13
a33 11
@@@@ -2125,7 +2130,7 @@@@ KonqView * KonqMainWindow::childView( co
       {
         if ( frameIt.current()->name() == name )
         {
-          //kdDebug() << "found a frame of name " << name << " : " << frameIt.current() << endl;
+          kdDebug() << "found a frame of name " << name << " : " << frameIt.current() << endl;
           if ( hostExtension )
             *hostExtension = ext;
           if ( part )
@@@@ -2140,7 +2145,7 @@@@ KonqView * KonqMainWindow::childView( co
 }
d35 1
a35 15
 // static
-KonqView * KonqMainWindow::findChildView( const QString &name, KonqMainWindow **mainWindow, KParts::BrowserHostExtension **hostExtension, KParts::ReadOnlyPart **part )
+KonqView * KonqMainWindow::findChildView( KParts::ReadOnlyPart *callingPart, const QString &name, KonqMainWindow **mainWindow, KParts::BrowserHostExtension **hostExtension, KParts::ReadOnlyPart **part )
 {
   if ( !s_lstViews )
     return 0;
@@@@ -2148,7 +2153,7 @@@@ KonqView * KonqMainWindow::findChildView
   QPtrListIterator<KonqMainWindow> it( *s_lstViews );
   for (; it.current(); ++it )
   {
-    KonqView *res = it.current()->childView( name, hostExtension, part );
+    KonqView *res = it.current()->childView( callingPart, name, hostExtension, part );
     if ( res )
     {
       if ( mainWindow )
@


1.1
log
@fix 3 security issues.

http://www.kde.org/info/security/advisory-20040811-1.txt
http://www.kde.org/info/security/advisory-20040811-2.txt
http://www.kde.org/info/security/advisory-20040811-3.txt

ok naddy@@
@
text
@d1 1
a1 1
$OpenBSD$
@

