head	1.11;
access;
symbols
	OPENBSD_4_3:1.10.0.6
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.10.0.4
	OPENBSD_4_2_BASE:1.10
	OPENBSD_4_1:1.10.0.2
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.9.0.2
	OPENBSD_4_0_BASE:1.9
	OPENBSD_3_9:1.8.0.4
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.8.0.2
	OPENBSD_3_8_BASE:1.8
	OPENBSD_3_7:1.7.0.2
	OPENBSD_3_7_BASE:1.7
	OPENBSD_3_6:1.5.0.4
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.5.0.2
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.3.0.2
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.2.0.2
	OPENBSD_3_3_BASE:1.2;
locks; strict;
comment	@# @;


1.11
date	2008.03.25.17.34.14;	author espie;	state dead;
branches;
next	1.10;

1.10
date	2006.10.12.23.12.18;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2006.06.03.12.47.30;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2005.03.29.21.18.35;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2005.01.31.16.58.22;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2004.09.18.09.36.43;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2004.02.01.14.59.22;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2003.12.07.20.19.13;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2003.04.05.14.53.38;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2003.01.27.19.22.50;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.07.00.19.34;	author espie;	state Exp;
branches;
next	;


desc
@@


1.11
log
@3.5.9
@
text
@$OpenBSD: patch-kdesu_kdesu_kdesu_cpp,v 1.10 2006/10/12 23:12:18 espie Exp $
--- kdesu/kdesu/kdesu.cpp.orig	Mon May 22 20:13:07 2006
+++ kdesu/kdesu/kdesu.cpp	Sun May 28 23:11:24 2006
@@@@ -113,7 +113,8 @@@@ int main(int argc, char *argv[])
     unsetenv( "SESSION_MANAGER" );
     KApplication app;
     // but propagate it to the started app
-    setenv( "SESSION_MANAGER", session_manager.data(), 1 );
+    if (!session_manager.isNull())
+	setenv( "SESSION_MANAGER", session_manager.data(), 1 );
     
     {
         KStartupInfoId id;
@


1.10
log
@Update to 3.5.5
@
text
@d1 1
a1 1
$OpenBSD: patch-kdesu_kdesu_kdesu_cpp,v 1.9 2006/06/03 12:47:30 espie Exp $
@


1.9
log
@minor update to 3.5.3, integrate libidn support (some more changes to come
to WANTLIB in packages dependent on KDE).
@
text
@d1 1
a1 1
$OpenBSD: patch-kdesu_kdesu_kdesu_cpp,v 1.8 2005/03/29 21:18:35 espie Exp $
a13 30
@@@@ -331,10 +332,12 @@@@ static int startApp()
     KConfig *config = KGlobal::config();
     config->setGroup("Passwords");
     int timeout = config->readNumEntry("Timeout", defTimeout);
+    bool useSudo = config->readBoolEntry("Sudo", defSudo);
 
     // Check if we need a password
     SuProcess proc;
     proc.setUser(auth_user);
+    proc.setUseSudo(useSudo);
     int needpw = proc.checkNeedPassword();
     if (needpw < 0)
     {
@@@@ -357,7 +360,7 @@@@ static int startApp()
         KStartupInfoData data;
         data.setSilent( KStartupInfoData::Yes );
         KStartupInfo::sendChange( id, data );
-        KDEsuDialog dlg(user, auth_user, keep && !terminal,icon, withIgnoreButton);
+        KDEsuDialog dlg(user, auth_user, keep && !terminal,icon, useSudo, withIgnoreButton);
 	if (prompt)
 	    dlg.addLine(i18n("Command:"), command);
         if ((priority != 50) || (scheduler != SuProcess::SchedNormal))
@@@@ -410,6 +413,7 @@@@ static int startApp()
         proc.setTerminal(terminal);
         proc.setErase(true);
         proc.setUser(user);
+ 	proc.setUseSudo(useSudo);
         if (!new_dcop)
         {
             proc.setXOnly(true);
@


1.8
log
@most of kde 3.4, will finish getting fixed in tree... ;-)
@
text
@d1 4
a4 4
$OpenBSD: patch-kdesu_kdesu_kdesu_cpp,v 1.7 2005/01/31 16:58:22 espie Exp $
--- kdesu/kdesu/kdesu.cpp.orig	Tue Oct  5 16:57:50 2004
+++ kdesu/kdesu/kdesu.cpp	Wed Mar 23 11:50:58 2005
@@@@ -112,7 +112,8 @@@@ int main(int argc, char *argv[])
d14 1
a14 1
@@@@ -329,10 +330,12 @@@@ static int startApp()
d27 1
a27 1
@@@@ -355,7 +358,7 @@@@ static int startApp()
d31 2
a32 2
-        KDEsuDialog dlg(user, auth_user, keep && !terminal, icon);
+        KDEsuDialog dlg(user, auth_user, keep && !terminal, icon, useSudo);
d36 1
a36 1
@@@@ -408,6 +411,7 @@@@ static int startApp()
@


1.7
log
@allow kdesu to start up even with no env SESSION_MANAGER.
@
text
@d1 4
a4 4
$OpenBSD: patch-kdesu_kdesu_kdesu_cpp,v 1.6 2004/09/18 09:36:43 espie Exp $
--- kdesu/kdesu/kdesu.cpp.orig	Sun Nov 28 18:26:12 2004
+++ kdesu/kdesu/kdesu.cpp	Mon Jan 31 17:44:27 2005
@@@@ -111,7 +111,8 @@@@ int main(int argc, char *argv[])
d14 1
a14 1
@@@@ -325,10 +326,12 @@@@ static int startApp()
d27 1
a27 1
@@@@ -351,7 +354,7 @@@@ static int startApp()
d36 1
a36 1
@@@@ -404,6 +407,7 @@@@ static int startApp()
@


1.6
log
@update to kde 3.3.0.
@
text
@d1 14
a14 4
$OpenBSD: patch-kdesu_kdesu_kdesu_cpp,v 1.5 2004/02/01 14:59:22 espie Exp $
--- kdesu/kdesu/kdesu.cpp.orig	Tue Jun 22 19:32:48 2004
+++ kdesu/kdesu/kdesu.cpp	Mon Sep  6 11:43:53 2004
@@@@ -321,10 +321,12 @@@@ static int startApp()
d27 1
a27 1
@@@@ -347,7 +349,7 @@@@ static int startApp()
d36 1
a36 1
@@@@ -400,6 +402,7 @@@@ static int startApp()
@


1.5
log
@basic import of kde 3.1.95, still missing a few parts.

TODO:
- compile the missing packages.
- redo konsole fixes for our ttys.
- figure out why kuickshow is broken.
- make sure we get all dependencies.
- repair kscd.
- find out why nsplugins does not like the native jdk.
- figure out how to get kvim to work.
- change filenames or adjust check-lib-depends to cope.
@
text
@d1 4
a4 4
$OpenBSD: patch-kdesu_kdesu_kdesu_cpp,v 1.4 2003/12/07 20:19:13 espie Exp $
--- kdesu/kdesu/kdesu.cpp.orig	2003-08-01 09:46:21.000000000 +0200
+++ kdesu/kdesu/kdesu.cpp	2004-01-21 01:23:01.000000000 +0100
@@@@ -313,10 +313,12 @@@@ static int startApp()
d17 1
a17 1
@@@@ -339,7 +341,7 @@@@ static int startApp()
d21 4
a24 3
-        KDEsuDialog dlg(user, auth_user, keep && !terminal);
+        KDEsuDialog dlg(user, auth_user, keep && !terminal, useSudo);
         dlg.addLine(i18n("Command:"), command);
d26 1
a26 2
         {
@@@@ -390,6 +392,7 @@@@ static int startApp()
@


1.4
log
@update to 3.1.4
@
text
@d1 4
a4 4
$OpenBSD: patch-kdesu_kdesu_kdesu_cpp,v 1.3 2003/04/05 14:53:38 espie Exp $
--- kdesu/kdesu/kdesu.cpp.orig	2003-09-01 13:31:18.000000000 +0200
+++ kdesu/kdesu/kdesu.cpp	2003-12-04 02:56:13.000000000 +0100
@@@@ -275,10 +275,12 @@@@ int main(int argc, char *argv[])
d17 17
a33 17
@@@@ -301,7 +303,7 @@@@ int main(int argc, char *argv[])
 	KStartupInfoData data;
 	data.setSilent( KStartupInfoData::Yes );
 	KStartupInfo::sendChange( id, data );
-	KDEsuDialog dlg(user, auth_user, keep && !terminal);
+	KDEsuDialog dlg(user, auth_user, keep && !terminal, useSudo);
 	dlg.addLine(i18n("Command:"), command);
 	if ((priority != 50) || (scheduler != SuProcess::SchedNormal)) 
 	{
@@@@ -344,6 +346,7 @@@@ int main(int argc, char *argv[])
 	proc.setTerminal(terminal);
 	proc.setErase(true);
 	proc.setUser(user);
+	proc.setUseSudo(useSudo);
 	if (!new_dcop)
 	{
 	    proc.setXOnly(true);
@


1.3
log
@Update most of kde to 3.1.1.
Needs rebuild to check against XFree 4.3.0.
@
text
@d1 4
a4 4
$OpenBSD: patch-kdesu_kdesu_kdesu_cpp,v 1.2 2003/01/27 19:22:50 espie Exp $
--- kdesu/kdesu/kdesu.cpp.orig	Sun Mar  2 19:34:38 2003
+++ kdesu/kdesu/kdesu.cpp	Sun Mar 30 17:01:53 2003
@@@@ -274,10 +274,12 @@@@ int main(int argc, char *argv[])
d17 1
a17 1
@@@@ -300,7 +302,7 @@@@ int main(int argc, char *argv[])
d26 1
a26 1
@@@@ -343,6 +345,7 @@@@ int main(int argc, char *argv[])
@


1.2
log
@kdebase 3.1:
- use kcontrol/nics/nic.cpp from kde-current to access getifaddrs...
IPv4 masks are not printed properly yet.
- konsole fixes for utmp
- ksysguardd mostly working. Should unify with Net/FreeBSD
- clock and timezone fixes mostly from Flinn Mueller.
- uses kxkb_pic lib, thanks to Matthieu.
@
text
@d1 4
a4 4
$OpenBSD: patch-kdesu_kdesu_kdesu_cpp,v 1.1 2003/01/07 00:19:34 espie Exp $
--- kdesu/kdesu/kdesu.cpp.orig	Sun Sep 15 23:08:45 2002
+++ kdesu/kdesu/kdesu.cpp	Thu Jan  9 23:22:00 2003
@@@@ -266,10 +266,12 @@@@ int main(int argc, char *argv[])
d17 7
a23 8
@@@@ -287,7 +289,8 @@@@ int main(int argc, char *argv[])
     QCString password;
     if (needpw)
     {
-	KDEsuDialog *dlg = new KDEsuDialog(user, auth_user, keep && !terminal);
+	KDEsuDialog *dlg = new KDEsuDialog(user, auth_user, keep && !terminal, 
+	    useSudo);
 	dlg->addLine(i18n("Command:"), command);
d26 1
a26 1
@@@@ -326,6 +329,7 @@@@ int main(int argc, char *argv[])
@


1.1
log
@Full support for sudo in kcontrol
@
text
@d1 4
a4 4
$OpenBSD$
--- kdesu/kdesu/kdesu.cpp.orig	Tue Jan  7 00:59:51 2003
+++ kdesu/kdesu/kdesu.cpp	Tue Jan  7 01:12:51 2003
@@@@ -267,10 +267,12 @@@@ int main(int argc, char *argv[])
d17 1
a17 1
@@@@ -288,7 +290,8 @@@@ int main(int argc, char *argv[])
d27 1
a27 1
@@@@ -327,6 +330,7 @@@@ int main(int argc, char *argv[])
@

