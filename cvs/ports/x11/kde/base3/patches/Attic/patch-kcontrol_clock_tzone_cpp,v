head	1.3;
access;
symbols
	OPENBSD_3_8:1.2.0.8
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.6
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.4
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.1.0.4
	OPENBSD_3_4_BASE:1.1
	OPENBSD_3_3:1.1.0.2
	OPENBSD_3_3_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2005.11.29.14.00.12;	author espie;	state dead;
branches;
next	1.2;

1.2
date	2004.02.01.14.59.22;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.27.19.22.50;	author espie;	state Exp;
branches;
next	;


desc
@@


1.3
log
@KDE 3.5.0, the beginning...

(samba/cups subpackages to fix library issues)
@
text
@$OpenBSD: patch-kcontrol_clock_tzone_cpp,v 1.2 2004/02/01 14:59:22 espie Exp $
--- kcontrol/clock/tzone.cpp.orig	2004-01-17 13:47:47.000000000 +0100
+++ kcontrol/clock/tzone.cpp	2004-01-21 01:20:49.000000000 +0100
@@@@ -50,8 +50,14 @@@@
 #include <sys/stat.h>
 
 #define ZONEINFODIR	"/usr/share/lib/zoneinfo"
+#define FIND_BINARY	"/bin/find"
 #define INITFILE	"/etc/default/init"
 #endif
+#ifdef __OpenBSD__
+#define ZONEINFODIR	"/usr/share/zoneinfo"
+#define FIND_BINARY	"/usr/bin/find"
+#include <sys/param.h>
+#endif
 
 Tzone::Tzone(QWidget * parent, const char *name)
   : QGroupBox(parent, name)
@@@@ -86,14 +92,15 @@@@ void Tzone::fillTimeZones()
 
     tzonelist->insertItem(i18n("[No selection]"));
 
-#if defined(USE_SOLARIS)	// MARCO
+#if defined(USE_SOLARIS) || defined(__OpenBSD__)	// MARCO
 
     FILE *fp;
     char buf[MAXPATHLEN];
+    char *p = buf + strlen(ZONEINFODIR) + 1;
 
     snprintf(buf, MAXPATHLEN,
-             "/bin/find %s \\( -name src -prune \\) -o -type f -print | /bin/cut -b %d-",
-             ZONEINFODIR, strlen(ZONEINFODIR) + 2);
+             "%s %s \\( -name src -prune \\) -o -type f -print",
+	     FIND_BINARY, ZONEINFODIR);
 
     fp = popen(buf, "r");
     if (fp)
@@@@ -101,8 +108,8 @@@@ void Tzone::fillTimeZones()
         while(fgets(buf, MAXPATHLEN - 1, fp) != NULL)
         {
             buf[strlen(buf) - 1] = '\0';
-            list << i18n(buf);
-            tzonenames << buf;
+            list << i18n(p);
+            tzonenames << p;
         }
         pclose(fp);
     }
@@@@ -166,6 +173,14 @@@@ void Tzone::load()
         }
         pclose(fp);
     }
+#elif defined(__OpenBSD__)
+	char buffer[MAXPATHLEN];
+	int n;
+	n = readlink("/etc/localtime", buffer, sizeof(buffer)-1);
+	if (n != -1) {
+		buffer[n] = 0;
+		sCurrentlySet = buffer + strlen(ZONEINFODIR)+1;
+	}
 #else
     QFile f("/etc/timezone");
     if(f.open(IO_ReadOnly))
@@@@ -264,6 +279,7 @@@@ void Tzone::save()
 
         QString val = selectedzone;
 #else
+#if !defined(__OpenBSD__)
         QFile fTimezoneFile("/etc/timezone");
 
         if (fTimezoneFile.open(IO_WriteOnly | IO_Truncate) )
@@@@ -273,6 +289,7 @@@@ void Tzone::save()
             fTimezoneFile.close();
         }
 
+#endif
         tz = "/usr/share/zoneinfo/" + selectedzone;
 
         kdDebug() << "Set time zone " << tz << endl;
@@@@ -294,7 +311,9 @@@@ void Tzone::save()
 
     } else {
 #if !defined(USE_SOLARIS) // Do not update the System!
+#if !defined(__OpenBSD__)
         unlink( "/etc/timezone" );
+#endif
         unlink( "/etc/localtime" );
 
         setenv("TZ", "", 1);
@


1.2
log
@basic import of kde 3.1.95, still missing a few parts.

TODO:
- compile the missing packages.
- redo konsole fixes for our ttys.
- figure out why kuickshow is broken.
- make sure we get all dependencies.
- repair kscd.
- find out why nsplugins does not like the native jdk.
- figure out how to get kvim to work.
- change filenames or adjust check-lib-depends to cope.
@
text
@d1 1
a1 1
$OpenBSD: patch-kcontrol_clock_tzone_cpp,v 1.1 2003/01/27 19:22:50 espie Exp $
@


1.1
log
@kdebase 3.1:
- use kcontrol/nics/nic.cpp from kde-current to access getifaddrs...
IPv4 masks are not printed properly yet.
- konsole fixes for utmp
- ksysguardd mostly working. Should unify with Net/FreeBSD
- clock and timezone fixes mostly from Flinn Mueller.
- uses kxkb_pic lib, thanks to Matthieu.
@
text
@d1 3
a3 3
$OpenBSD$
--- kcontrol/clock/tzone.cpp.orig	Mon Jan 13 10:23:21 2003
+++ kcontrol/clock/tzone.cpp	Mon Jan 13 11:51:56 2003
d18 2
a19 2
   : QWidget (parent, name)
@@@@ -94,14 +100,15 @@@@ void Tzone::fillTimeZones()
d38 1
a38 1
@@@@ -109,8 +116,8 @@@@ void Tzone::fillTimeZones()
d49 1
a49 1
@@@@ -174,6 +181,14 @@@@ void Tzone::load()
d64 1
a64 1
@@@@ -272,6 +287,7 @@@@ void Tzone::save()
d72 1
a72 1
@@@@ -281,6 +297,7 @@@@ void Tzone::save()
d80 1
a80 1
@@@@ -299,7 +316,9 @@@@ void Tzone::save()
@

