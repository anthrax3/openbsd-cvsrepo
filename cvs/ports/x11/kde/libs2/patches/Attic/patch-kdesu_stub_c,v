head	1.4;
access;
symbols
	OPENBSD_2_9:1.3.0.2
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_8:1.1.1.1.0.2
	OPENBSD_2_8_BASE:1.1.1.1
	espie:1.1.1.1
	kde:1.1.1;
locks; strict;
comment	@# @;


1.4
date	2001.06.08.13.24.20;	author lebel;	state dead;
branches;
next	1.3;

1.3
date	2001.03.14.00.17.32;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2000.11.27.20.41.59;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2000.10.09.22.37.53;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2000.10.09.22.37.53;	author espie;	state Exp;
branches;
next	;


desc
@@


1.4
log
@update to kdelibs-2.1.2:
- remove patch-kdesu_stub_c since its now included by default.
@
text
@$OpenBSD: patch-kdesu_stub_c,v 1.3 2001/03/14 00:17:32 espie Exp $
--- kdesu/kdesu_stub.c.orig	Sat Mar 10 15:22:48 2001
+++ kdesu/kdesu_stub.c	Sat Mar 10 15:48:03 2001
@@@@ -276,9 +276,11 @@@@ int main()
 	xsetenv("DISPLAY", params[P_DISPLAY].value);
 	if (params[P_DISPLAY_AUTH].value[0]) 
 	{
-	    fname = tmpnam(0L);
-	    fout = fopen(fname, "w");
-	    if (!fout) 
+	    int fd;
+	    strcpy(fname, "/tmp/kdesu.XXXXXXXXXX");
+
+	    fd = mkstemp(fname);
+	    if (fd == -1 || (fout = fdopen(fd, "w")) == NULL)
 	    {
 		perror("kdesu_stub: fopen()");
 		exit(1);
@@@@ -286,7 +288,19 @@@@ int main()
 	    fprintf(fout, "add %s %s\n", params[P_DISPLAY].value,
 		    params[P_DISPLAY_AUTH].value);
 	    fclose(fout);
-	    tmpnam(xauthority);
+	    strcpy(xauthority, "/tmp/xauth.XXXXXXXXXX");
+	    {
+		int fd;
+
+		fd = mkstemp(xauthority);
+		if (fd == -1)
+		{
+		    perror("kdesu_stub: mkstemp()");
+		    exit(1);
+		}
+		else
+		    close(fd);
+	    }
 	    xsetenv("XAUTHORITY", xauthority);
 	    sprintf(command, "xauth source %s >/dev/null 2>&1", fname);
 	    if (system(command))
@@@@ -305,9 +319,11 @@@@ int main()
 	auth = xstrsep(params[P_ICE_AUTH].value);
 	if (host[0]) 
 	{
-	    fname = tmpnam(0L);
-	    fout = fopen(fname, "w");
-	    if (!fout) 
+	    int fd;
+	    strcpy(fname, "/tmp/kdesu.XXXXXXXXXX");
+
+	    fd = mkstemp(fname);
+	    if (fd == -1 || (fout = fdopen(fd, "w")) == NULL)
 	    {
 		perror("kdesu_stub: fopen()");
 		exit(1);
@@@@ -318,7 +334,19 @@@@ int main()
 	    for (i=0; host[i]; i++)
 		fprintf(fout, "add DCOP \"\" %s %s\n", host[i], auth[i]);
 	    fclose(fout);
-	    tmpnam(iceauthority);
+	    strcpy(iceauthority, "/tmp/iceauth.XXXXXXXXXX");
+	    {
+		int fd;
+
+		fd = mkstemp(iceauthority);
+		if (fd == -1)
+		{
+		    perror("kdesu_stub: mkstemp()");
+		    exit(1);
+		}
+		else
+		    close(fd);
+	    }
 	    xsetenv("ICEAUTHORITY", iceauthority);
 	    sprintf(command, "iceauth source %s >/dev/null 2>&1", fname);
 	    if (system(command))
@


1.3
log
@Another patch that went through the cracks.
@
text
@d1 1
a1 1
$OpenBSD: update-patches,v 1.3 2000/06/09 17:08:37 espie Exp $
@


1.2
log
@Patches based on Maurice Nonneke's work, to handle arts' audio subsystem
better.
@
text
@d1 4
a4 3
--- kdesu/kdesu_stub.c.orig	Tue Sep 12 11:14:17 2000
+++ kdesu/kdesu_stub.c	Sun Nov 26 16:53:02 2000
@@@@ -276,9 +276,17 @@@@ int main()
d8 3
a10 1
+#ifdef HAVE_MKSTEMP
a15 5
+#else
 	    fname = tmpnam(0L);
 	    fout = fopen(fname, "w");
 	    if (!fout) 
+#endif
d19 1
a19 1
@@@@ -286,7 +294,23 @@@@ int main()
d23 1
a23 1
+#ifdef HAVE_MKSTEMP
a36 3
+#else
 	    tmpnam(xauthority);
+#endif
d40 1
a40 1
@@@@ -305,9 +329,17 @@@@ int main()
d44 3
a46 1
+#ifdef HAVE_MKSTEMP
a51 5
+#else
 	    fname = tmpnam(0L);
 	    fout = fopen(fname, "w");
 	    if (!fout) 
+#endif
d55 1
a55 1
@@@@ -318,7 +350,23 @@@@ int main()
d59 1
a59 1
+#ifdef HAVE_MKSTEMP
a72 3
+#else
 	    tmpnam(iceauthority);
+#endif
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
--- kdesu/kdesu_stub.c.orig	Tue Jul 25 17:21:49 2000
+++ kdesu/kdesu_stub.c	Sat Sep 30 13:24:11 2000
@@@@ -278,9 +278,17 @@@@ int main()
d21 1
a21 1
@@@@ -288,7 +296,23 @@@@ int main()
d45 1
a45 1
@@@@ -307,9 +331,17 @@@@ int main()
d63 1
a63 1
@@@@ -320,7 +352,23 @@@@ int main()
@


1.1.1.1
log
@initial import of kde2 libraries, work in progress.
@
text
@@
