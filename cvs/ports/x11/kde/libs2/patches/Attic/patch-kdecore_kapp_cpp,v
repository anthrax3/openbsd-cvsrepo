head	1.2;
access;
symbols
	OPENBSD_3_1:1.2.0.2;
locks; strict;
comment	@# @;


1.2
date	2001.04.22.13.20.46;	author espie;	state dead;
branches
	1.2.2.1;
next	1.1;

1.1
date	2001.03.30.12.31.11;	author espie;	state Exp;
branches;
next	;

1.2.2.1
date	2003.01.07.00.12.40;	author brad;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Some brute-force fixes.
- insist on using pass_all systematically everywhere on OpenBSD.
libtool can't be trusted with that, the darn stupid thing wants a shared
libgcc half the time.
- acknowledge that build won't even work without shared libraries. There
are symbol collisions all over the place.
- disable debugging messages, so that the result looks sane.
- remove the konsole kludge, it didn't work anyways, and I figured out how
to do it from konsole_grantpty.
- insist on using zsh in sh compatibility mode instead of our somewhat
buggy ksh.
@
text
@$OpenBSD: patch-kdecore_kapp_cpp,v 1.1 2001/03/30 12:31:11 espie Exp $
--- kdecore/kapp.cpp.orig	Thu Mar 29 03:22:54 2001
+++ kdecore/kapp.cpp	Thu Mar 29 03:28:30 2001
@@@@ -618,10 +618,19 @@@@ public:
   }
 };
 
+#include <sys/types.h>
+#include <grp.h>
+
+gid_t getgroupid(const char *n)
+{
+  struct group *g = getgrnam(n);
+  return g ? g->gr_gid : -1;
+}
+
 void KApplication::init(bool GUIenabled)
 {
   if ((getuid() != geteuid()) ||
-      (getgid() != getegid()))
+      (getgid() != getegid() && getegid() != getgroupid("utmp")))
   {
      fprintf(stderr, "The KDE libraries are not designed to run with suid privileges.\n");
      ::exit(127);
@


1.2.2.1
log
@- add patches from auditing effort for KDE 2.2
- bump PKGNAME's

http://www.kde.org/info/security/advisory-20021220-1.txt
@
text
@d1 6
a6 11
$OpenBSD$
--- kdecore/kapp.cpp.orig	Tue Sep  4 19:06:38 2001
+++ kdecore/kapp.cpp	Sun Jan  5 16:04:15 2003
@@@@ -2163,6 +2163,8 @@@@ bool checkAccess(const QString& pathname
   int pos = dirName.findRev('/');
   if ( pos == -1 )
     return false;   // No path in argument. This is evil, we won't allow this
+  else if ( pos == 0 ) // don't turn e.g. /root into an empty string
+      pos = 1;
 
   dirName.truncate(pos); // strip everything starting from the last '/'
d8 17
@


1.1
log
@Repair konsole. The kde guys sure have some funky way to handle security.
@
text
@d1 1
a1 1
$OpenBSD: update-patches,v 1.3 2000/06/09 17:08:37 espie Exp $
@

