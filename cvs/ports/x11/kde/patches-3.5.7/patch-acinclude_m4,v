head	1.6;
access;
symbols
	OPENBSD_6_1:1.6.0.4
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.6.0.2
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.5.0.8
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.10
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.6
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.4
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.2
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.4.0.2
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.2.0.6
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.4
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.14
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.12
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.10
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.8
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.6
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.4
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.2
	OPENBSD_4_3_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2016.07.17.21.00.16;	author zhuk;	state Exp;
branches;
next	1.5;
commitid	QpxAo8621KSOScVs;

1.5
date	2013.10.22.11.34.10;	author zhuk;	state Exp;
branches;
next	1.4;

1.4
date	2013.06.03.20.07.39;	author zhuk;	state Exp;
branches;
next	1.3;

1.3
date	2013.01.23.21.10.38;	author zhuk;	state Exp;
branches;
next	1.2;

1.2
date	2011.07.06.15.01.13;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2007.12.11.07.55.05;	author jakemsr;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Move KDE3's KDM and kcheckpass to BSD authentication.

This effectively unbreaks KDE3 after recent changes in getpw* land,
same way as it was done for KDE4.
@
text
@$OpenBSD: patch-acinclude_m4,v 1.5 2013/10/22 11:34:10 zhuk Exp $
--- acinclude.m4.orig	Wed Aug 20 20:00:01 2008
+++ acinclude.m4	Sun Jul 17 14:38:00 2016
@@@@ -614,11 +614,11 @@@@ AC_DEFUN([KDE_SUBST_PROGRAMS],
         if test -n "$MEINPROC" -a "$MEINPROC" != "compiled"; then
  	    kde_sharedirs="/usr/share/kde /usr/local/share /usr/share /opt/kde3/share /opt/kde/share $prefix/share"
             test -n "$KDEDIR" && kde_sharedirs="$KDEDIR/share $kde_sharedirs"
-            AC_FIND_FILE(apps/ksgmltools2/customization/kde-chunk.xsl, $kde_sharedirs, KDE_XSL_STYLESHEET)
+            AC_FIND_FILE(apps.kde3/ksgmltools2/customization/kde-chunk.xsl, $kde_sharedirs, KDE_XSL_STYLESHEET)
 	    if test "$KDE_XSL_STYLESHEET" = "NO"; then
 		KDE_XSL_STYLESHEET=""
 	    else
-                KDE_XSL_STYLESHEET="$KDE_XSL_STYLESHEET/apps/ksgmltools2/customization/kde-chunk.xsl"
+                KDE_XSL_STYLESHEET="$KDE_XSL_STYLESHEET/apps.kde3/ksgmltools2/customization/kde-chunk.xsl"
 	    fi
         fi
 
@@@@ -1809,7 +1809,7 @@@@ AC_CACHE_VAL(ac_cv_have_kde,
 
 if test "$kde_qtver" = 1; then
   kde_check_header="ksock.h"
-  kde_check_lib="libkdecore.la"
+  kde_check_lib="libkonsolepart.la"
 else
   kde_check_header="ksharedptr.h"
   kde_check_lib="libkio.la"
@@@@ -1830,8 +1830,8 @@@@ So, check this please and use another prefix!])
 fi
 
 kde_libdirs="$kde_libs_prefix/lib${kdelibsuff} /usr/lib/kde/lib${kdelibsuff} /usr/local/kde/lib${kdelibsuff} /usr/kde/lib${kdelibsuff} /usr/lib${kdelibsuff}/kde /usr/lib${kdelibsuff}/kde3 /usr/lib${kdelibsuff} /usr/X11R6/lib${kdelibsuff} /usr/local/lib${kdelibsuff} /opt/kde3/lib${kdelibsuff} /opt/kde/lib${kdelibsuff} /usr/X11R6/kde/lib${kdelibsuff}"
-test -n "$KDEDIR" && kde_libdirs="$KDEDIR/lib${kdelibsuff} $KDEDIR $kde_libdirs"
-kde_libdirs="$ac_kde_libraries $libdir $kde_libdirs"
+test -n "$KDEDIR" && kde_libdirs="$KDEDIR/lib${kdelibsuff}/kde3 $KDEDIR/lib${kdelibsuff} $KDEDIR $kde_libdirs"
+kde_libdirs="$kde_libdirs $ac_kde_libraries $libdir"
 AC_FIND_FILE($kde_check_lib, $kde_libdirs, kde_libdir)
 ac_kde_libraries="$kde_libdir"
 
@@@@ -4238,12 +4238,24 @@@@ AC_DEFUN([KDE_SHADOWPASSWD], [
 
 ])
 
+AC_DEFUN([KDE_BSDAUTH], [
+  case $host in
+  *-*-freebsd* | *-*-netbsd* | *-*-openbsd*)
+    use_bsdauth=yes ;;
+  *)
+    use_bsdauth=no ;;
+  esac
+])
+
 AC_DEFUN([KDE_PASSWDLIBS], [
   AC_REQUIRE([KDE_MISC_TESTS]) dnl for LIBCRYPT
   AC_REQUIRE([KDE_PAM])
   AC_REQUIRE([KDE_SHADOWPASSWD])
+  AC_REQUIRE([KDE_BSDAUTH])
 
-  if test "x$use_pam" = "xyes"; then 
+  if test "x$use_bsdauth" = "xyes"; then 
+    PASSWDLIBS=
+  elif test "x$use_pam" = "xyes"; then 
     PASSWDLIBS="$PAMLIBS"
   else
     PASSWDLIBS="$LIBCRYPT $LIBSHADOW $LIBGEN"
@@@@ -4254,7 +4266,7 @@@@ AC_DEFUN([KDE_PASSWDLIBS], [
   dnl root to read, so kcheckpass needs to be root (even when using pam, since pam
   dnl may need to read /etc/master.passwd).
   case $host in
-  *-*-freebsd*)
+  *-*-freebsd*|*-*-openbsd*)
     SETUIDFLAGS="-m 4755 -o root"
     ;;
   *)
@@@@ -4419,7 +4431,10 @@@@ AC_DEFUN([KDE_CHECK_LIBPTHREAD],
 
   dnl Un-special-case for FreeBSD.
   if test "x$LIBPTHREAD" = "xPTHREAD" ; then
-    LIBPTHREAD=""
+    case $host_os in
+	openbsd*) LIBPTHREAD="-pthread" ;;
+	*) LIBPTHREAD="" ;;
+    esac
   fi
 
   AC_SUBST(LIBPTHREAD)
@@@@ -4650,2 +4665,3 @@@@ fi
 AC_DEFUN([KDE_CHECK_PYTHON],
 [
+  KDE_CHECK_PYTHON_INTERN("2.7", [
@@@@ -4663,2 +4679,3 @@@@ AC_DEFUN([KDE_CHECK_PYTHON],
         ])
+       ])
       ])
@


1.5
log
@Do a massive change on the placement of some KDE3 apps data:

  * share/apps => share/apps.kde3
  * share/doc/HTML => share/doc/HTML.kde3

This is a part of KDE3/4 deconflicting work.

Build tested in a bulk by landry@@, also sat over a week on ports@@.
Run-time tested with some KDE3 apps, including KMail, taxipilot, yakuake...

"do it" landry@@
@
text
@d1 3
a3 3
$OpenBSD: patch-acinclude_m4,v 1.4 2013/06/03 20:07:39 zhuk Exp $
--- acinclude.m4.orig	Wed Aug 20 20:05:01 2008
+++ acinclude.m4	Wed Oct  9 18:12:08 2013
d27 1
a27 1
@@@@ -1830,7 +1830,7 @@@@ So, check this please and use another prefix!])
d32 1
d34 1
a34 1
 kde_libdirs="$ac_kde_libraries $libdir $kde_libdirs"
d37 37
a73 1
@@@@ -4419,7 +4419,10 @@@@ AC_DEFUN([KDE_CHECK_LIBPTHREAD],
d85 1
a85 1
@@@@ -4650,2 +4653,3 @@@@ fi
d89 1
a89 1
@@@@ -4663,2 +4667,3 @@@@ AC_DEFUN([KDE_CHECK_PYTHON],
@


1.4
log
@Move last users of Python 2.5 to the old new (or new old?) Python 2.7 land.

A few iterations with testing done by and ok landry@@
Also prodding from ajacoutot@@, fgsch@@ and others
@
text
@d1 17
a17 3
$OpenBSD: patch-acinclude_m4,v 1.3 2013/01/23 21:10:38 zhuk Exp $
--- acinclude.m4.orig	Wed Aug 20 19:52:36 2008
+++ acinclude.m4	Fri May  3 12:21:11 2013
@


1.3
log
@Move KDE 3 headers from ${PREFIX}/include to ${PREFIX}/include/kde.
Updates to dependant ports to follow.

Tested in a bulk, input and okay by landry@@
Reviewed by aja@@ too
@
text
@d1 3
a3 3
$OpenBSD: patch-acinclude_m4,v 1.2 2011/07/06 15:01:13 dcoppa Exp $
--- acinclude.m4.orig	Wed Aug 20 19:37:50 2008
+++ acinclude.m4	Thu Nov 22 00:17:24 2012
d34 8
@


1.2
log
@
regen
@
text
@d1 21
a21 3
$OpenBSD: patch-acinclude_m4,v 1.1 2007/12/11 07:55:05 jakemsr Exp $
--- acinclude.m4.orig	Wed Aug 20 18:00:01 2008
+++ acinclude.m4	Wed Jul  6 16:58:17 2011
@


1.1
log
@
use -pthread instead of -lpthread for pthreads linkage

fix some WANTLIB/LIB_DEPENDS in akode and amarok while here

bulk build tested by steven@@, "go ahead" espie@@ a while ago
@
text
@d1 4
a4 4
$OpenBSD$
--- acinclude.m4.orig	Fri Apr  6 06:23:11 2007
+++ acinclude.m4	Sun Oct 21 05:27:14 2007
@@@@ -4394,7 +4394,10 @@@@ AC_DEFUN([KDE_CHECK_LIBPTHREAD],
@

