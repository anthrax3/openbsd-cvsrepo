head	1.2;
access;
symbols
	OPENBSD_3_1:1.1.0.2
	OPENBSD_3_1_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2002.09.11.17.43.42;	author espie;	state dead;
branches;
next	1.1;

1.1
date	2002.04.08.23.12.26;	author espie;	state Exp;
branches;
next	;


desc
@@


1.2
log
@ditch the files.
@
text
@$OpenBSD: patch-kdesu_kdesud_secure_cpp,v 1.1 2002/04/08 23:12:26 espie Exp $
--- kdesu/kdesud/secure.cpp.orig	Mon Apr  8 22:47:14 2002
+++ kdesu/kdesud/secure.cpp	Mon Apr  8 22:51:26 2002
@@@@ -42,6 +42,20 @@@@ SocketSecurity::SocketSecurity(int sockf
 }
 
 #else
+# if defined(HAVE_GETPEEREID)
+SocketSecurity::SocketSecurity(int sockfd)
+{
+    uid_t euid;
+    gid_t egid;
+    if (getpeereid(sockfd, &euid, &egid) == 0) {
+	cred.uid = euid;
+	cred.gid = egid;
+	cred.pid = -1;
+	ok = true;
+    }
+}
+
+# else
 
 
 /**
@@@@ -63,4 +77,5 @@@@ SocketSecurity::SocketSecurity(int sockf
     ok = true;
 }
 
+# endif
 #endif
@


1.1
log
@use getpeereid
@
text
@d1 1
a1 1
$OpenBSD$
@

