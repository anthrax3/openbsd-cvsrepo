head	1.2;
access;
symbols
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2011.10.30.15.16.13;	author dcoppa;	state dead;
branches;
next	1.1;

1.1
date	2011.04.24.17.32.24;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to fluxbox-1.3.2
@
text
@$OpenBSD: patch-src_ClientMenu_cc,v 1.1 2011/04/24 17:32:24 dcoppa Exp $

Fix a crash when deiconifying apps
(commit a53017cc3bad26906b99ac473513a10847c40bc0)

--- src/ClientMenu.cc.orig	Tue Apr 19 11:28:50 2011
+++ src/ClientMenu.cc	Tue Apr 19 11:30:51 2011
@@@@ -52,15 +52,17 @@@@ class ClientMenuItem: public FbTk::MenuItem { (public)
             return;
 
         // this MenuItem object can get destroyed as a result of focus(), so we
-        // must get a local copy of the parent menu
+        // must get a local copy of anything we want to use here
+        // AFTER ~ClientMenuItem() is called.
         FbTk::Menu *parent = menu();
+        FocusControl& focus_control = m_client.screen().focusControl();
 
         m_client.focus();
         fbwin->raise();
         if ((mods & ControlMask) == 0) {
             // Ignore any focus changes due to this menu closing
             // (even in StrictMouseFocus mode)
-            m_client.screen().focusControl().ignoreAtPointer(true);
+            focus_control.ignoreAtPointer(true);
             parent->hide();
         }
     }
@


1.1
log
@Update to fluxbox-1.3.1 plus some patches to fix a couple of crashers
(above all, a use-after-free crash on restart/exit).

OK landry@@
Maintainer timed out
@
text
@d1 1
a1 1
$OpenBSD$
@

