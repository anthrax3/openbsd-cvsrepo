head	1.3;
access;
symbols
	zhuk_20170728:1.1.1.1 zhuk:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2017.07.30.15.12.45;	author espie;	state Exp;
branches;
next	1.2;
commitid	bilRtj9eY8HvaaQ1;

1.2
date	2017.07.29.00.07.13;	author zhuk;	state Exp;
branches;
next	1.1;
commitid	PLavWrVVGir1L8eQ;

1.1
date	2017.07.28.00.34.42;	author zhuk;	state Exp;
branches
	1.1.1.1;
next	;
commitid	eSkWObnXRXVPIURA;

1.1.1.1
date	2017.07.28.00.34.42;	author zhuk;	state Exp;
branches;
next	;
commitid	eSkWObnXRXVPIURA;


desc
@@


1.3
log
@so all the moving and churning around did diddly squat at fixing the
actual problem.
Comment out the missing files again
@
text
@# $OpenBSD: Makefile,v 1.2 2017/07/29 00:07:13 zhuk Exp $

COMMENT-html =		HTML documentation for Qt5
COMMENT-qch =		qdoc-compiled documentation for Qt5

PKGNAME =		qt5-docs-${QT5_VERSION}
PKGNAME-html =		qt5-html-${QT5_VERSION}
PKGNAME-qch =		qt5-qch-${QT5_VERSION}

REVISION-html =		1
REVISION-qch =		0

MULTI_PACKAGES =	-html -qch
SUBPACKAGE ?=		-html

WANTLIB-qch =
WANTLIB-html =

DOC_COMPONENTS = \
		qt3d \
		qtactiveqt \
		qtbase \
		qtcanvas3d \
		qtcharts \
		qtconnectivity \
		qtdatavis3d \
		qtdeclarative \
		qtdoc \
		qtgamepad \
		qtgraphicaleffects \
		qtimageformats \
		qtlocation \
		qtmultimedia \
		qtnetworkauth \
		qtpurchasing \
		qtquickcontrols \
		qtquickcontrols2 \
		qtremoteobjects \
		qtscript \
		qtscxml \
		qtsensors \
		qtserialbus \
		qtserialport \
		qtspeech \
		qtsvg \
		qttools \
		qtvirtualkeyboard \
		qtwebchannel \
		qtwebkit \
		qtwebsockets \
		qtx11extras \
		qtxmlpatterns

MASTER_SITES0 =	http://download.qt.io/community_releases/${DIST_VERSION:R}/${QT5_WEBKIT_VERSION}-final/
DISTFILES =	${DOC_COMPONENTS:Nqtwebkit:C/$/-opensource-src-${QT5_DIST_VERSION}${EXTRACT_SUFX}/}
DISTFILES +=	qtwebkit-opensource-src-${QT5_WEBKIT_VERSION}${EXTRACT_SUFX}

MODQT5_USE_GCC4_MODULE =No
CONFIGURE_STYLE =	none

BUILD_DEPENDS =		x11/qt5/qttools>=${QT5_VERSION},<${QT5_NEXT_VERSION} \
			x11/qt5/qtbase,-global>=${QT5_VERSION},<${QT5_NEXT_VERSION}

RUN_DEPENDS =		x11/qt5/qtbase,-global

NO_TEST =		Yes

PKG_ARCH =		*
WRKDIST =		${WRKDIR}

ALL_TARGET =		html_docs qch_docs
FAKE_TARGET =		install_html_docs install_qch_docs

QTTOOLS =		qdoc \
			qhelpgenerator \
			qtattributionsscanner
MASTER_CONF =		${WRKBUILD}/master.qdocconf

DOCDIR =		${PREFIX}/share/doc/qt5

# N.B.: .qch files are built using .qhp ones, generated by qdoc in html_docs

# XXX this will make qtwebkit same version as other Qt modules
BUILDDIR =		${WRKBUILD}
QT_INSTALL_DOCS =	${DOCDIR}
QT_VER =		${QT5_VERSION:R}
QT_VERSION =		${QT5_VERSION}
QT_VERSION_TAG =	${QT5_VERSION:C/\.//g}

MAKE_ENV =		BUILDDIR=${BUILDDIR} \
			QT_INSTALL_DOCS=${QT_INSTALL_DOCS} \
			QT_VER=${QT_VER} \
			QT_VERSION=${QT_VERSION} \
			QT_VERSION_TAG=${QT_VERSION_TAG}

do-build:
	find ${WRKSRC}/qt*/ -name '*.qdocconf' >${MASTER_CONF}
	${SETENV} ${MAKE_ENV} \
	${MODQT5_LIBDIR}/bin/qdoc --single-exec \
	                          --outputdir ${WRKBUILD} \
	                          --installdir ${DOCDIR} \
	                          ${MASTER_CONF}
	@@for qhp in ${WRKBUILD}/html/*.qhp; do \
		qch=${WRKBUILD}/`basename $${qhp%.qhp}.qch`; \
		echo "building $$qch"; \
		${SETENV} ${MAKE_ENV} \
		${MODQT5_LIBDIR}/bin/qhelpgenerator $$qhp -o $$qch; \
	done
	rm -f ${WRKBUILD}/html/.index

do-install:
	${INSTALL_DATA_DIR} ${DOCDIR}
	cp -R ${WRKBUILD}/*.qch ${WRKBUILD}/html ${WRKBUILD}/images \
	      ${DOCDIR}

.include <bsd.port.mk>
@


1.2
log
@Rework the process of building Qt5 documentation:

Now all documentation is built using a separate port using
the --single-exec option of qdoc. This gaves significant speedup
as well as fixing quiet a few interlinking problems.

All -qch, -html and -docindex subpackages of Qt modules ports are
removed. The qt5-html and qt5-qch are now provided by x11/qt5/docs
instead of meta/qt5, thus REVISION set from the start.

This commit should fix problems with building Qt5 documentation
that people started seeing after switching to Clang. We also could
zap some interdependencies between Qt5 modules as well, but that's
a different story.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2017/07/28 00:34:42 zhuk Exp $
d10 1
a10 1
REVISION-html =		0
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.template,v 1.76 2017/02/25 16:04:20 danj Exp $
d19 34
a52 1
.include "../qt5.components.mk"
a54 1
DOC_COMPONENTS =${QT5_COMPONENTS:Nqttranslations:Nqtwebkit-examples}
@


1.1.1.1
log
@Import new Qt5 offline documentation port.

Now all the documentation is built at once: much faster and allowing
interlinks between Qt modules to work better. This should also fix some
packaging issues people are seeing after switching to Clang (the reason
is still unknown, unfortunately).

To be linked to builds a bit later.
@
text
@@
