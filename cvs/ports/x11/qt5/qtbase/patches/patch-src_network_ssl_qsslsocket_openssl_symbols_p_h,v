head	1.3;
access;
symbols
	OPENBSD_6_1:1.1.0.2
	OPENBSD_6_1_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2017.07.21.15.28.25;	author zhuk;	state Exp;
branches;
next	1.2;
commitid	7BuLAeEnoqn4hZar;

1.2
date	2017.07.17.08.34.37;	author zhuk;	state Exp;
branches;
next	1.1;
commitid	3tUsNizeEEvC87c0;

1.1
date	2017.01.27.16.13.08;	author zhuk;	state Exp;
branches;
next	;
commitid	QZuellQgImf7lyCn;


desc
@@


1.3
log
@Fix OpenSSL (actually, LibreSSL) run-time detection code.

Original report from Brendan Doyle <doyle.brendan@@yandex.com>, thanks.
@
text
@$OpenBSD: patch-src_network_ssl_qsslsocket_openssl_symbols_p_h,v 1.2 2017/07/17 08:34:37 zhuk Exp $
Unbreak build with LibreSSL.
See also https://github.com/libressl-portable/openbsd/issues/33
Index: src/network/ssl/qsslsocket_openssl_symbols_p.h
--- src/network/ssl/qsslsocket_openssl_symbols_p.h.orig
+++ src/network/ssl/qsslsocket_openssl_symbols_p.h
@@@@ -228,7 +228,7 @@@@ int q_BIO_read(BIO *a, void *b, int c);
 Q_AUTOTEST_EXPORT BIO_METHOD *q_BIO_s_mem();
 Q_AUTOTEST_EXPORT int q_BIO_write(BIO *a, const void *b, int c);
 int q_BN_num_bits(const BIGNUM *a);
-#if OPENSSL_VERSION_NUMBER >= 0x10100000L
+#if !defined(BN_is_word)
 int q_BN_is_word(BIGNUM *a, BN_ULONG w);
 #else
 // BN_is_word is implemented purely as a
@@@@ -599,6 +599,9 @@@@ void q_SSL_get0_alpn_selected(const SSL *ssl, const un
                               unsigned *len);
 #endif
 #endif // OPENSSL_VERSION_NUMBER >= 0x1000100fL ...
+
+int q_SSL_CTX_set1_groups(SSL_CTX *ctx, const int *groups, size_t ngroups);
+#define q_SSL_CTX_set1_curves(ctx,curves,ncurves) q_SSL_CTX_set1_groups((ctx),(curves),(ncurves))
 
 // Helper function
 class QDateTime;
@


1.2
log
@Update from Qt 5.6.2 (LTS) to Qt 5.9.1 (LTS).

Tested with both GCC and CLang (less through).

This forces updating x11/py-qt5, which forces update of devel/py-sip,
which forces update of x11/py-qt4, but, thankfully, no breakage detected.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_network_ssl_qsslsocket_openssl_symbols_p_h,v 1.1 2017/01/27 16:13:08 zhuk Exp $
d7 11
a17 1
@@@@ -600,6 +600,9 @@@@ void q_SSL_get0_alpn_selected(const SSL *ssl, const un
d20 1
a20 1
 
d23 1
a23 1
+
a25 1
 QDateTime q_getTimeFromASN1(const ASN1_TIME *aTime);
@


1.1
log
@Fix after recent LibreSSL changes.

Nowadays we have fake SSL_CTRL_SET_CURVES macro, and SSL_CTX_set1_curves
defined as synonym to SSL_CTX_set1_groups. So use the latter instead
of the former.

The patch should be tweaked furthermore before proposing it upstream,
but for now we can at least build things again.
@
text
@d1 1
a1 1
$OpenBSD$
d4 5
a8 4
--- src/network/ssl/qsslsocket_openssl_symbols_p.h.orig	Fri Jan 27 18:33:13 2017
+++ src/network/ssl/qsslsocket_openssl_symbols_p.h	Fri Jan 27 18:59:44 2017
@@@@ -551,6 +551,9 @@@@ void q_SSL_get0_next_proto_negotiated(const SSL *s, co
                                       unsigned *len);
@

