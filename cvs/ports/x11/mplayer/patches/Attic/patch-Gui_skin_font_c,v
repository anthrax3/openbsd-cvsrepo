head	1.1;
access;
symbols
	OPENBSD_3_4:1.1.0.4
	OPENBSD_3_5:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2004.07.04.12.15.58;	author robert;	state dead;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2004.07.04.12.15.58;	author robert;	state Exp;
branches;
next	;

1.1.4.1
date	2004.07.06.22.26.17;	author robert;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-Gui_skin_font_c was initially added on branch OPENBSD_3_5.
@
text
@@


1.1.4.1
log
@SECURITY:

Fix several vulnerabilities in MPlayer's GUI.
http://www.mplayerhq.hu/homepage/design7/news.html

ok brad@@
@
text
@a0 31
$OpenBSD$
--- Gui/skin/font.c.orig	Thu Mar 20 13:42:15 2003
+++ Gui/skin/font.c	Sat Jul  3 05:30:36 2004
@@@@ -27,7 +27,7 @@@@
 
  if ( ( Fonts[id]=calloc( 1,sizeof( bmpFont ) ) ) == NULL ) return -1;
 
- strcpy( Fonts[id]->name,name );
+ strlcpy( Fonts[id]->name,name,128 ); // FIXME: as defined in font.h
  for ( i=0;i<256;i++ ) 
    Fonts[id]->Fnt[i].x=Fonts[id]->Fnt[i].y=Fonts[id]->Fnt[i].sx=Fonts[id]->Fnt[i].sy=-1;
 
@@@@ -60,7 +60,8 @@@@
  
  if ( id < 0 ) return id;
 
- strcpy( tmp,path ); strcat( tmp,fname ); strcat( tmp,".fnt" );
+ strlcpy( tmp,path,sizeof( tmp ) );
+ strlcat( tmp,fname,sizeof( tmp ) ); strlcat( tmp,".fnt",sizeof( tmp ) );
  if ( ( f=fopen( tmp,"rt" ) ) == NULL ) 
    { free( Fonts[id] ); return -3; }
    
@@@@ -93,7 +94,7 @@@@
      {
       if ( !strcmp( command,"image" ) )
        {
-        strcpy( tmp,path ); strcat( tmp,param );
+        strlcpy( tmp,path,sizeof( tmp )  ); strlcat( tmp,param,sizeof( tmp ) );
         mp_dbg( MSGT_GPLAYER,MSGL_DBG2,"[font] font imagefile: %s\n",tmp );
         if ( skinBPRead( tmp,&Fonts[id]->Bitmap ) ) return -4;
        }
@


1.1.2.1
log
@SECURITY:

Fix several vulnerabilities in MPlayer's GUI.
http://www.mplayerhq.hu/homepage/design7/news.html

ok brad@@
@
text
@a0 31
$OpenBSD$
--- Gui/skin/font.c.orig	Thu Mar 20 13:42:15 2003
+++ Gui/skin/font.c	Sat Jul  3 05:30:36 2004
@@@@ -27,7 +27,7 @@@@
 
  if ( ( Fonts[id]=calloc( 1,sizeof( bmpFont ) ) ) == NULL ) return -1;
 
- strcpy( Fonts[id]->name,name );
+ strlcpy( Fonts[id]->name,name,128 ); // FIXME: as defined in font.h
  for ( i=0;i<256;i++ ) 
    Fonts[id]->Fnt[i].x=Fonts[id]->Fnt[i].y=Fonts[id]->Fnt[i].sx=Fonts[id]->Fnt[i].sy=-1;
 
@@@@ -60,7 +60,8 @@@@
  
  if ( id < 0 ) return id;
 
- strcpy( tmp,path ); strcat( tmp,fname ); strcat( tmp,".fnt" );
+ strlcpy( tmp,path,sizeof( tmp ) );
+ strlcat( tmp,fname,sizeof( tmp ) ); strlcat( tmp,".fnt",sizeof( tmp ) );
  if ( ( f=fopen( tmp,"rt" ) ) == NULL ) 
    { free( Fonts[id] ); return -3; }
    
@@@@ -93,7 +94,7 @@@@
      {
       if ( !strcmp( command,"image" ) )
        {
-        strcpy( tmp,path ); strcat( tmp,param );
+        strlcpy( tmp,path,sizeof( tmp )  ); strlcat( tmp,param,sizeof( tmp ) );
         mp_dbg( MSGT_GPLAYER,MSGL_DBG2,"[font] font imagefile: %s\n",tmp );
         if ( skinBPRead( tmp,&Fonts[id]->Bitmap ) ) return -4;
        }
@

