head	1.4;
access;
symbols
	OPENBSD_5_5:1.3.0.2
	OPENBSD_5_5_BASE:1.3;
locks; strict;
comment	@# @;


1.4
date	2014.05.16.01.34.50;	author brad;	state dead;
branches;
next	1.3;

1.3
date	2014.02.19.19.12.43;	author ratchov;	state Exp;
branches;
next	1.2;

1.2
date	2014.02.07.09.37.05;	author yasuoka;	state Exp;
branches;
next	1.1;

1.1
date	2014.01.31.10.44.56;	author ratchov;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to FFmpeg 20140412 snapshot. From 2.2 branch.

Update to MPlayer 20140412 snapshot.

Take MAINTAINER for MPlayer. ok edd@@

ok ajacoutot@@
@
text
@$OpenBSD: patch-libao2_ao_sndio_c,v 1.3 2014/02/19 19:12:43 ratchov Exp $
--- libao2/ao_sndio.c.orig	Mon Jan  6 23:02:58 2014
+++ libao2/ao_sndio.c	Tue Feb 18 14:31:47 2014
@@@@ -103,6 +103,8 @@@@ static int init(int rate, int channels, int format, in
     }
     sio_initpar(&par);
     par.bits = af_fmt2bits(format);
+    par.bps = (par.bits + 7) >> 3;
+    par.msb = 1;
     par.sig = (format & AF_FORMAT_SIGN_MASK) == AF_FORMAT_SI;
     if (par.bits > 8)
         par.le = (format & AF_FORMAT_END_MASK) == AF_FORMAT_LE;
@@@@ -118,7 +120,7 @@@@ static int init(int rate, int channels, int format, in
         mp_msg(MSGT_AO, MSGL_ERR, "ao2: couldn't get params\n");
         goto err_out;
     }
-    if (par.bps != SIO_BPS(par.bits)) {
+    if (par.bits < 8 * par.bps && !par.msb) {
         mp_msg(MSGT_AO, MSGL_ERR, "ao2: unsupported format\n");
         goto err_out;
     }
@@@@ -132,6 +134,8 @@@@ static int init(int rate, int channels, int format, in
     ao_data.format |= par.sig ? AF_FORMAT_SI : AF_FORMAT_US;
     if (par.bits > 8)
         ao_data.format |= par.le ? AF_FORMAT_LE : AF_FORMAT_BE;
+    else
+        ao_data.format |= AF_FORMAT_NE;
     ao_data.channels = par.pchan;
     ao_data.bps = bpf * par.rate;
     ao_data.buffersize = par.bufsz * bpf;
@


1.3
log
@Fix playback of s24le audio. Tested by edd@@, yasuoka@@ and brad@@

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@Specify `msb' field properly.  This is required to play {s,u}24be
audio.

ok sthen ratchov
@
text
@d1 14
a14 13
$OpenBSD: patch-libao2_ao_sndio_c,v 1.1 2014/01/31 10:44:56 ratchov Exp $
--- libao2/ao_sndio.c.orig	Tue Jan  7 07:02:58 2014
+++ libao2/ao_sndio.c	Thu Feb  6 21:38:57 2014
@@@@ -110,6 +110,10 @@@@ static int init(int rate, int channels, int format, in
     par.pchan = channels;
     par.appbufsz = par.rate * 250 / 1000;    /* 250ms buffer */
     par.round = par.rate * 10 / 1000;        /*  10ms block size */
+
+    if (par.bits < SIO_BPS(par.bits) * 8)
+	par.msb = (par.le)? 0 : 1;
+
     if (!sio_setpar(hdl, &par)) {
         mp_msg(MSGT_AO, MSGL_ERR, "ao2: couldn't set params\n");
d16 7
a22 1
@@@@ -132,6 +136,8 @@@@ static int init(int rate, int channels, int format, in
@


1.1
log
@Mplayer requires the byte-order flag to be set for 8-bit formats
as well. Fixes playback of 8-bit audio files.
ok brad@@
@
text
@d1 15
a15 4
$OpenBSD$
--- libao2/ao_sndio.c.orig	Fri Jan 31 11:09:00 2014
+++ libao2/ao_sndio.c	Fri Jan 31 11:10:33 2014
@@@@ -132,6 +132,8 @@@@ static int init(int rate, int channels, int format, in
@

