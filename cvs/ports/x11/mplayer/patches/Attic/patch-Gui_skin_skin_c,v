head	1.3;
access;
symbols
	OPENBSD_3_4:1.3.0.4
	OPENBSD_3_5:1.3.0.2;
locks; strict;
comment	@# @;


1.3
date	2002.08.18.11.26.48;	author espie;	state dead;
branches
	1.3.2.1
	1.3.4.1;
next	1.2;

1.2
date	2002.06.27.22.03.49;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2002.06.08.02.07.37;	author drahn;	state Exp;
branches;
next	;

1.3.2.1
date	2004.07.04.12.15.58;	author robert;	state Exp;
branches;
next	;

1.3.4.1
date	2004.07.06.22.26.17;	author robert;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to 0.90pre6, mostly from maintainer.
@
text
@$OpenBSD: patch-Gui_skin_skin_c,v 1.2 2002/06/27 22:03:49 espie Exp $
--- Gui/skin/skin.c.orig	Tue May 28 16:12:33 2002
+++ Gui/skin/skin.c	Wed Jun 12 16:08:20 2002
@@@@ -74,7 +74,7 @@@@ int skinBPRead( char * fname, txSample *
  return i;
 }
 
-int __section( char * in )
+int skin__section( char * in )
 {
  strlower( in );
  defList=NULL;
@@@@ -83,7 +83,7 @@@@ int __section( char * in )
  return 0;
 }
 
-int __end( char * in )
+int skin__end( char * in )
 {
  if ( strlen( winList ) ) winList[0]=0;
   else defList=NULL;
@@@@ -91,7 +91,7 @@@@ int __end( char * in )
  return 0;
 }
 
-int __window( char * in )
+int skin__window( char * in )
 {
  CHECKDEFLIST( "window" );
 
@@@@ -101,7 +101,7 @@@@ int __window( char * in )
  return 0;
 }
 
-int __base( char * in )
+int skin__base( char * in )
 {
  unsigned char fname[512];
  unsigned char tmp[512];
@@@@ -188,7 +188,7 @@@@ int __base( char * in )
  return 0;
 }
 
-int __background( char * in )
+int skin__background( char * in )
 {
  CHECKDEFLIST( "background" );
  CHECKWINLIST( "background" );
@@@@ -203,7 +203,7 @@@@ int __background( char * in )
  return 0;
 }
 
-int __button( char * in )
+int skin__button( char * in )
 {
  unsigned char   fname[512];
  unsigned char   tmp[512];
@@@@ -246,7 +246,7 @@@@ int __button( char * in )
  return 0;
 }
 
-int __selected( char * in )
+int skin__selected( char * in )
 {
  unsigned char   fname[512];
  unsigned char   tmp[512];
@@@@ -265,7 +265,7 @@@@ int __selected( char * in )
  return 0;
 }
 
-int __menu( char * in )
+int skin__menu( char * in )
 { // menu = number,x,y,sx,sy,msg
  int             x,y,sx,sy,msg;
  unsigned char   tmp[64];
@@@@ -297,7 +297,7 @@@@ int __menu( char * in )
  return 0;
 }
 
-int __hpotmeter( char * in )
+int skin__hpotmeter( char * in )
 { // hpotmeter=buttonbitmaps,sx,sy,phasebitmaps,phases,default value,x,y,sx,sy,msg
  int             x,y,psx,psy,ph,sx,sy,msg,d;
  unsigned char   tmp[512];
@@@@ -354,7 +354,7 @@@@ int __hpotmeter( char * in )
  return 0;
 }
 
-int __potmeter( char * in )
+int skin__potmeter( char * in )
 { // potmeter=phasebitmaps,phases,default value,x,y,sx,sy,msg
  int             x,y,ph,sx,sy,msg,d;
  unsigned char   tmp[512];
@@@@ -397,7 +397,7 @@@@ int __potmeter( char * in )
  return 0;
 }
 
-int __font( char * in )
+int skin__font( char * in )
 { // font=fontname,fontid
  char    name[512];
  char    id[512];
@@@@ -426,7 +426,7 @@@@ int __font( char * in )
  return 0;
 }
 
-int __slabel( char * in )
+int skin__slabel( char * in )
 {
  char    tmp[512];
  char    sid[63];
@@@@ -460,7 +460,7 @@@@ int __slabel( char * in )
  return 0;
 }
 
-int __dlabel( char * in )
+int skin__dlabel( char * in )
 { // dlabel=x,y,sx,align,fontid,string ...
  char    tmp[512];
  char    sid[63];
@@@@ -496,7 +496,7 @@@@ int __dlabel( char * in )
  return 0;
 }
 
-int __decoration( char * in )
+int skin__decoration( char * in )
 {
  char    tmp[512];
 
@@@@ -521,20 +521,20 @@@@ typedef struct
 
 _item skinItem[] =
  {
-  { "section",     __section     },
-  { "end",         __end         },
-  { "window",      __window      },
-  { "base",        __base        },
-  { "button",      __button      },
-  { "selected",    __selected    },
-  { "background",  __background  },
-  { "hpotmeter",   __hpotmeter   },
-  { "potmeter",    __potmeter    },
-  { "font",        __font        },
-  { "slabel",      __slabel      },
-  { "dlabel",      __dlabel      },
-  { "decoration",  __decoration  },
-  { "menu",        __menu        }
+  { "section",     skin__section     },
+  { "end",         skin__end         },
+  { "window",      skin__window      },
+  { "base",        skin__base        },
+  { "button",      skin__button      },
+  { "selected",    skin__selected    },
+  { "background",  skin__background  },
+  { "hpotmeter",   skin__hpotmeter   },
+  { "potmeter",    skin__potmeter    },
+  { "font",        skin__font        },
+  { "slabel",      skin__slabel      },
+  { "dlabel",      skin__dlabel      },
+  { "decoration",  skin__decoration  },
+  { "menu",        skin__menu        }
  };
 
 #define ITEMS (int)( sizeof( skinItem )/sizeof( _item ) )
@


1.3.4.1
log
@SECURITY:

Fix several vulnerabilities in MPlayer's GUI.
http://www.mplayerhq.hu/homepage/design7/news.html

ok brad@@
@
text
@d1 27
a27 4
$OpenBSD$
--- Gui/skin/skin.c.orig	Tue Jun  3 19:36:25 2003
+++ Gui/skin/skin.c	Sat Jul  3 05:30:36 2004
@@@@ -116,7 +116,7 @@@@
d31 75
a105 96
- strcpy( window_name,strlower( in ) );
+ strlcpy( window_name,strlower( in ),sizeof( window_name ) );
  if ( !strncmp( in,"main",4 ) ) { currSection=&skinAppMPlayer->main; currSubItem=&skinAppMPlayer->NumberOfItems; currSubItems=skinAppMPlayer->Items; }
   else if ( !strncmp( in,"sub",3 ) ) currSection=&skinAppMPlayer->sub;
    else if ( !strncmp( in,"playbar",7 ) ) { currSection=&skinAppMPlayer->bar; currSubItem=&skinAppMPlayer->NumberOfBarItems; currSubItems=skinAppMPlayer->barItems; }
@@@@ -147,7 +147,7 @@@@
    defList->main.x=x;
    defList->main.y=y;
    defList->main.type=itBase;
-   strcpy( tmp,path ); strcat( tmp,fname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&defList->main.Bitmap ) ) return 1;
    defList->main.width=defList->main.Bitmap.Width;
    defList->main.height=defList->main.Bitmap.Height;
@@@@ -162,7 +162,7 @@@@
  if ( !strcmp( window_name,"sub" ) )
   {
    defList->sub.type=itBase;
-   strcpy( tmp,path ); strcat( tmp,fname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&defList->sub.Bitmap ) ) return 1;
    defList->sub.x=x;
    defList->sub.y=y;
@@@@ -179,7 +179,7 @@@@
   {
    defList->menuIsPresent=1;
    defList->menuBase.type=itBase;
-   strcpy( tmp,path ); strcat( tmp,fname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&defList->menuBase.Bitmap ) ) return 1;
    defList->menuBase.width=defList->menuBase.Bitmap.Width;
    defList->menuBase.height=defList->menuBase.Bitmap.Height;
@@@@ -197,7 +197,7 @@@@
    defList->bar.x=x;
    defList->bar.y=y;
    defList->bar.type=itBase;
-   strcpy( tmp,path ); strcat( tmp,fname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&defList->bar.Bitmap ) ) return 1;
    defList->bar.width=defList->bar.Bitmap.Width;
    defList->bar.height=defList->bar.Bitmap.Height;
@@@@ -268,7 +268,7 @@@@
  currSubItems[ *currSubItem ].Bitmap.Image=NULL;
  if ( strcmp( fname,"NULL" ) )
   {
-   strcpy( tmp,path ); strcat( tmp,fname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&currSubItems[ *currSubItem ].Bitmap ) ) return 1;
   }
 
@@@@ -289,7 +289,7 @@@@
 
  cutItem( in,fname,',',0 );
  defList->menuSelected.type=itBase;
- strcpy( tmp,path ); strcat( tmp,fname );
+ strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
  mp_dbg( MSGT_GPLAYER,MSGL_DBG2,"\n[skin] selected: %s\n",fname );
  if ( skinBPRead( tmp,&defList->menuSelected.Bitmap ) ) return 1;
  defList->menuSelected.width=defList->menuSelected.Bitmap.Width;
@@@@ -381,14 +381,14 @@@@
  item->Bitmap.Image=NULL;
  if ( strcmp( phfname,"NULL" ) )
   {
-   strcpy( tmp,path ); strcat( tmp,phfname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, phfname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&item->Bitmap ) ) return 1;
   }
 
  item->Mask.Image=NULL;
  if ( strcmp( pfname,"NULL" ) )
   {
-   strcpy( tmp,path ); strcat( tmp,pfname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, pfname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&item->Mask ) ) return 1;
   }
  return 0;
@@@@ -445,7 +445,7 @@@@
  item->Bitmap.Image=NULL;
  if ( strcmp( phfname,"NULL" ) )
   {
-   strcpy( tmp,path ); strcat( tmp,phfname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, phfname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&item->Bitmap ) ) return 1;
   }
  return 0;
@@@@ -655,7 +655,12 @@@@
 FILE * skinFile;
 
 void setname( char * item1, char * item2 )
-{ strcpy( fn,item1 ); strcat( fn,"/" ); strcat( fn,item2 ); strcpy( path,fn ); strcat( path,"/" ); strcat( fn,"/skin" ); }
+{
+  strlcpy(fn, item1, sizeof( fn ));
+  strlcat(fn, "/", sizeof( fn )); strlcat(fn, item2, sizeof( fn ));
+  strlcpy(path, fn, sizeof( path )); strlcat(path, "/", sizeof( path ));
+  strlcat(fn, "/skin", sizeof( fn ));
+}
d107 2
a108 1
 int skinRead( char * dname )
d110 55
@


1.3.2.1
log
@SECURITY:

Fix several vulnerabilities in MPlayer's GUI.
http://www.mplayerhq.hu/homepage/design7/news.html

ok brad@@
@
text
@d1 27
a27 4
$OpenBSD$
--- Gui/skin/skin.c.orig	Tue Jun  3 19:36:25 2003
+++ Gui/skin/skin.c	Sat Jul  3 05:30:36 2004
@@@@ -116,7 +116,7 @@@@
d31 75
a105 96
- strcpy( window_name,strlower( in ) );
+ strlcpy( window_name,strlower( in ),sizeof( window_name ) );
  if ( !strncmp( in,"main",4 ) ) { currSection=&skinAppMPlayer->main; currSubItem=&skinAppMPlayer->NumberOfItems; currSubItems=skinAppMPlayer->Items; }
   else if ( !strncmp( in,"sub",3 ) ) currSection=&skinAppMPlayer->sub;
    else if ( !strncmp( in,"playbar",7 ) ) { currSection=&skinAppMPlayer->bar; currSubItem=&skinAppMPlayer->NumberOfBarItems; currSubItems=skinAppMPlayer->barItems; }
@@@@ -147,7 +147,7 @@@@
    defList->main.x=x;
    defList->main.y=y;
    defList->main.type=itBase;
-   strcpy( tmp,path ); strcat( tmp,fname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&defList->main.Bitmap ) ) return 1;
    defList->main.width=defList->main.Bitmap.Width;
    defList->main.height=defList->main.Bitmap.Height;
@@@@ -162,7 +162,7 @@@@
  if ( !strcmp( window_name,"sub" ) )
   {
    defList->sub.type=itBase;
-   strcpy( tmp,path ); strcat( tmp,fname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&defList->sub.Bitmap ) ) return 1;
    defList->sub.x=x;
    defList->sub.y=y;
@@@@ -179,7 +179,7 @@@@
   {
    defList->menuIsPresent=1;
    defList->menuBase.type=itBase;
-   strcpy( tmp,path ); strcat( tmp,fname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&defList->menuBase.Bitmap ) ) return 1;
    defList->menuBase.width=defList->menuBase.Bitmap.Width;
    defList->menuBase.height=defList->menuBase.Bitmap.Height;
@@@@ -197,7 +197,7 @@@@
    defList->bar.x=x;
    defList->bar.y=y;
    defList->bar.type=itBase;
-   strcpy( tmp,path ); strcat( tmp,fname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&defList->bar.Bitmap ) ) return 1;
    defList->bar.width=defList->bar.Bitmap.Width;
    defList->bar.height=defList->bar.Bitmap.Height;
@@@@ -268,7 +268,7 @@@@
  currSubItems[ *currSubItem ].Bitmap.Image=NULL;
  if ( strcmp( fname,"NULL" ) )
   {
-   strcpy( tmp,path ); strcat( tmp,fname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&currSubItems[ *currSubItem ].Bitmap ) ) return 1;
   }
 
@@@@ -289,7 +289,7 @@@@
 
  cutItem( in,fname,',',0 );
  defList->menuSelected.type=itBase;
- strcpy( tmp,path ); strcat( tmp,fname );
+ strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, fname, sizeof( tmp )); 
  mp_dbg( MSGT_GPLAYER,MSGL_DBG2,"\n[skin] selected: %s\n",fname );
  if ( skinBPRead( tmp,&defList->menuSelected.Bitmap ) ) return 1;
  defList->menuSelected.width=defList->menuSelected.Bitmap.Width;
@@@@ -381,14 +381,14 @@@@
  item->Bitmap.Image=NULL;
  if ( strcmp( phfname,"NULL" ) )
   {
-   strcpy( tmp,path ); strcat( tmp,phfname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, phfname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&item->Bitmap ) ) return 1;
   }
 
  item->Mask.Image=NULL;
  if ( strcmp( pfname,"NULL" ) )
   {
-   strcpy( tmp,path ); strcat( tmp,pfname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, pfname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&item->Mask ) ) return 1;
   }
  return 0;
@@@@ -445,7 +445,7 @@@@
  item->Bitmap.Image=NULL;
  if ( strcmp( phfname,"NULL" ) )
   {
-   strcpy( tmp,path ); strcat( tmp,phfname );
+   strlcpy(tmp, path, sizeof( tmp )); strlcat(tmp, phfname, sizeof( tmp )); 
    if ( skinBPRead( tmp,&item->Bitmap ) ) return 1;
   }
  return 0;
@@@@ -655,7 +655,12 @@@@
 FILE * skinFile;
 
 void setname( char * item1, char * item2 )
-{ strcpy( fn,item1 ); strcat( fn,"/" ); strcat( fn,item2 ); strcpy( path,fn ); strcat( path,"/" ); strcat( fn,"/skin" ); }
+{
+  strlcpy(fn, item1, sizeof( fn ));
+  strlcat(fn, "/", sizeof( fn )); strlcat(fn, item2, sizeof( fn ));
+  strlcpy(path, fn, sizeof( path )); strlcat(path, "/", sizeof( path ));
+  strlcat(fn, "/skin", sizeof( fn ));
+}
d107 2
a108 1
 int skinRead( char * dname )
d110 55
@


1.2
log
@Update to 0.90pre5
Most work by Biorn, some testing by pval and me.
@
text
@d1 1
a1 1
$OpenBSD: patch-Gui_skin_skin_c,v 1.1 2002/06/08 02:07:37 drahn Exp $
@


1.1
log
@Userland symbols are not supposed to start with __, reserved for
system/compiler usage. ok pvalchev@@
@
text
@d1 4
a4 4
$OpenBSD$
--- Gui/skin/skin.c.orig	Wed May 15 17:57:43 2002
+++ Gui/skin/skin.c	Wed May 15 17:57:47 2002
@@@@ -76,7 +76,7 @@@@ int skinBPRead( char * fname, txSample *
d13 1
a13 1
@@@@ -85,7 +85,7 @@@@ int __section( char * in )
d22 1
a22 1
@@@@ -93,7 +93,7 @@@@ int __end( char * in )
d31 1
a31 1
@@@@ -103,7 +103,7 @@@@ int __window( char * in )
d40 1
a40 1
@@@@ -187,7 +187,7 @@@@ int __base( char * in )
d49 1
a49 1
@@@@ -202,7 +202,7 @@@@ int __background( char * in )
d58 1
a58 1
@@@@ -245,7 +245,7 @@@@ int __button( char * in )
d67 1
a67 1
@@@@ -264,7 +264,7 @@@@ int __selected( char * in )
d76 1
a76 1
@@@@ -296,7 +296,7 @@@@ int __menu( char * in )
d85 1
a85 1
@@@@ -353,7 +353,7 @@@@ int __hpotmeter( char * in )
d94 1
a94 1
@@@@ -396,7 +396,7 @@@@ int __potmeter( char * in )
d103 1
a103 1
@@@@ -432,7 +432,7 @@@@ int __font( char * in )
d112 1
a112 1
@@@@ -466,7 +466,7 @@@@ int __slabel( char * in )
d121 1
a121 1
@@@@ -502,7 +502,7 @@@@ int __dlabel( char * in )
d130 1
a130 1
@@@@ -527,20 +527,20 @@@@ typedef struct
@

