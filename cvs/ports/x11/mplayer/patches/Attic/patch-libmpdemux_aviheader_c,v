head	1.2;
access;
symbols
	OPENBSD_3_9:1.1.0.6
	OPENBSD_3_8:1.1.0.4
	OPENBSD_3_7:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2006.07.19.21.40.47;	author robert;	state dead;
branches;
next	1.1;

1.1
date	2006.04.06.21.47.43;	author biorn;	state Exp;
branches
	1.1.2.1
	1.1.4.1
	1.1.6.1;
next	;

1.1.2.1
date	2006.04.08.14.33.43;	author sturm;	state Exp;
branches;
next	;

1.1.4.1
date	2006.04.08.14.34.26;	author sturm;	state Exp;
branches;
next	;

1.1.6.1
date	2006.05.01.17.53.42;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to versio 1.0pre8; include the speex and mpcdec codecs by default;
this version of mplayer now uses gtk2;

ok biorn@@ and tested by many
@
text
@$OpenBSD: patch-libmpdemux_aviheader_c,v 1.1 2006/04/06 21:47:43 biorn Exp $
--- libmpdemux/aviheader.c.orig	Thu Apr  6 20:46:29 2006
+++ libmpdemux/aviheader.c	Thu Apr  6 20:50:41 2006
@@@@ -224,11 +224,13 @@@@ while(1){
 	  
       print_avisuperindex_chunk(s);
 
-      msize = sizeof (uint32_t) * s->wLongsPerEntry * s->nEntriesInUse;
-      s->aIndex = malloc(msize);
-      memset (s->aIndex, 0, msize);
-      s->stdidx = malloc (s->nEntriesInUse * sizeof (avistdindex_chunk));
-      memset (s->stdidx, 0, s->nEntriesInUse * sizeof (avistdindex_chunk));
+      //// Check and fix this useless crap
+      if(s->wLongsPerEntry != sizeof (avisuperindex_entry)/4) {
+          mp_msg (MSGT_HEADER, MSGL_WARN, "Broken super index chunk size: %u\n",s->wLongsPerEntry);
+          s->wLongsPerEntry = sizeof(avisuperindex_entry)/4;
+      }
+      s->aIndex = calloc(s->nEntriesInUse, sizeof (avisuperindex_entry));
+      s->stdidx = calloc(s->nEntriesInUse, sizeof (avistdindex_chunk));
 
       // now the real index of indices
       for (i=0; i<s->nEntriesInUse; i++) {
@


1.1
log
@Protect from integer overflows. See CVE-2006-1502
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.6.1
log
@MFC:
Protect from integer overflows. See CVE-2006-1502
@
text
@d1 1
a1 1
$OpenBSD: patch-libmpdemux_aviheader_c,v 1.1.6.1 2006/05/01 17:48:17 sturm Exp $
@


1.1.4.1
log
@MFC:
Protect from integer overflows. See CVE-2006-1502
@
text
@d1 1
a1 1
$OpenBSD: patch-libmpdemux_aviheader_c,v 1.1 2006/04/06 21:47:43 biorn Exp $
@


1.1.2.1
log
@MFC:
Protect from integer overflows. See CVE-2006-1502
@
text
@d1 4
a4 4
$OpenBSD: patch-libmpdemux_aviheader_c,v 1.1 2006/04/06 21:47:43 biorn Exp $
--- libmpdemux/aviheader.c.orig	Wed Oct 20 04:13:33 2004
+++ libmpdemux/aviheader.c	Fri Apr  7 21:40:22 2006
@@@@ -243,11 +243,13 @@@@ while(1){
@

