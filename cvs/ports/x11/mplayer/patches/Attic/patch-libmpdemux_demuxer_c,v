head	1.4;
access;
symbols
	OPENBSD_3_9:1.3.0.2
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_5:1.1.0.4
	OPENBSD_3_6:1.1.0.2;
locks; strict;
comment	@# @;


1.4
date	2006.07.19.21.40.47;	author robert;	state dead;
branches;
next	1.3;

1.3
date	2006.01.17.07.41.58;	author jakemsr;	state Exp;
branches;
next	1.2;

1.2
date	2005.09.04.23.51.52;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2005.01.22.10.44.54;	author robert;	state dead;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2005.01.22.10.44.54;	author robert;	state Exp;
branches;
next	;

1.1.4.1
date	2005.01.22.10.50.59;	author robert;	state Exp;
branches;
next	;


desc
@@


1.4
log
@update to versio 1.0pre8; include the speex and mpcdec codecs by default;
this version of mplayer now uses gtk2;

ok biorn@@ and tested by many
@
text
@$OpenBSD: patch-libmpdemux_demuxer_c,v 1.3 2006/01/17 07:41:58 jakemsr Exp $
--- libmpdemux/demuxer.c.orig	Sun Apr  3 07:08:26 2005
+++ libmpdemux/demuxer.c	Sun Dec 25 19:45:16 2005
@@@@ -168,7 +168,7 @@@@ extern int tv_param_on;
 
 extern int demux_tv_fill_buffer(demuxer_t *demux, demux_stream_t *ds);
 extern int demux_open_tv(demuxer_t *demuxer);
-#if defined(USE_TV) && (defined(HAVE_TV_V4L) || defined(HAVE_TV_V4L2))
+#if defined(USE_TV) && (defined(HAVE_TV_V4L) || defined(HAVE_TV_V4L2) || defined(HAVE_TV_BSDBT848))
 extern void demux_close_tv(demuxer_t *demuxer);
 #endif
 #endif
@@@@ -199,7 +199,7 @@@@ void free_demuxer(demuxer_t *demuxer){
       demux_close_nuv(demuxer); break;
     case DEMUXER_TYPE_MPEG_TY:
       demux_close_ty(demuxer); break;
-#if defined(USE_TV) && (defined(HAVE_TV_V4L) || defined(HAVE_TV_V4L2))
+#if defined(USE_TV) && (defined(HAVE_TV_V4L) || defined(HAVE_TV_V4L2) || defined(HAVE_TV_BSDBT848))
     case DEMUXER_TYPE_TV:
 	demux_close_tv(demuxer); break;
 #endif
@@@@ -1350,7 +1350,12 @@@@ switch(file_format){
 
  case DEMUXER_TYPE_MPEG_TY: 
  case DEMUXER_TYPE_MPEG_PS: {
-  sh_video=d_video->sh;sh_video->ds=d_video;
+  if (d_video)
+    sh_video=d_video->sh;
+  else
+    sh_video = NULL;
+  if (sh_video)
+    sh_video->ds=d_video;
 //  if(demuxer->stream->type!=STREAMTYPE_VCD) demuxer->movi_start=0; // for VCD
 
   if(audio_id!=-2) {
@@@@ -1404,8 +1409,8 @@@@ pts_from_bps=0; // !!!
 if ((sh_video=demuxer->video->sh) && sh_video->bih)
   mp_msg(MSGT_DEMUX,MSGL_INFO,"VIDEO:  [%.4s]  %ldx%ld  %dbpp  %5.3f fps  %5.1f kbps (%4.1f kbyte/s)\n",
     (char *)&sh_video->bih->biCompression,
-    sh_video->bih->biWidth,
-    sh_video->bih->biHeight,
+    (long) sh_video->bih->biWidth,
+    (long) sh_video->bih->biHeight,
     sh_video->bih->biBitCount,
     sh_video->fps,
     sh_video->i_bps*0.008f,
@


1.3
log
@enable bktr(4) support, and enhance the bktr(4) support by:
- adding support for setting the channel set
- making it use audio(4) instead of ossaudio(3)
- making it explicitly mute the tuner on exit
- use the tuner as default video source, as opposed to RCA

ok biorn@@, robert@@
@
text
@d1 1
a1 1
$OpenBSD: patch-libmpdemux_demuxer_c,v 1.2 2005/09/04 23:51:52 espie Exp $
@


1.2
log
@fix a few more obvious coredumps and bad dereferences.
@
text
@d1 21
a21 3
$OpenBSD$
--- libmpdemux/demuxer.c.orig	Sat Sep  3 14:28:45 2005
+++ libmpdemux/demuxer.c	Sat Sep  3 14:40:33 2005
@


1.1
log
@file patch-libmpdemux_demuxer_c was initially added on branch OPENBSD_3_6.
@
text
@d1 28
@


1.1.4.1
log
@SECURITY:
fix multiple overflow vulnerabilties; bump PKGNAME;
http://www.vuxml.org/openbsd/4a667f60-5468-11d9-a47f-00065bd5b0b6.html

ok brad@@
@
text
@a0 81
$OpenBSD$
--- libmpdemux/demuxer.c.orig	Mon Dec  8 20:33:38 2003
+++ libmpdemux/demuxer.c	Wed Dec 29 14:51:46 2004
@@@@ -121,7 +121,6 @@@@ extern void demux_close_y4m(demuxer_t *d
 extern void demux_close_mf(demuxer_t* demuxer);
 extern void demux_close_roq(demuxer_t* demuxer);
 extern void demux_close_film(demuxer_t* demuxer);
-extern void demux_close_bmp(demuxer_t* demuxer);
 extern void demux_close_fli(demuxer_t* demuxer);
 extern void demux_close_nuv(demuxer_t* demuxer);
 extern void demux_close_audio(demuxer_t* demuxer);
@@@@ -170,8 +169,6 @@@@ void free_demuxer(demuxer_t *demuxer){
       demux_close_roq(demuxer);  break;
     case DEMUXER_TYPE_FILM:
       demux_close_film(demuxer); break;
-    case DEMUXER_TYPE_BMP:
-      demux_close_bmp(demuxer); break;
     case DEMUXER_TYPE_FLI:
       demux_close_fli(demuxer); break;
     case DEMUXER_TYPE_NUV:
@@@@ -283,7 +280,6 @@@@ void ds_read_packet(demux_stream_t *ds,s
 int demux_mf_fill_buffer( demuxer_t *demux);
 int demux_roq_fill_buffer(demuxer_t *demux);
 int demux_film_fill_buffer(demuxer_t *demux);
-int demux_bmp_fill_buffer(demuxer_t *demux);
 int demux_fli_fill_buffer(demuxer_t *demux);
 int demux_mpg_es_fill_buffer(demuxer_t *demux);
 int demux_mpg_fill_buffer(demuxer_t *demux);
@@@@ -321,7 +317,6 @@@@ int demux_fill_buffer(demuxer_t *demux,d
     case DEMUXER_TYPE_MF: return demux_mf_fill_buffer(demux);
     case DEMUXER_TYPE_ROQ: return demux_roq_fill_buffer(demux);
     case DEMUXER_TYPE_FILM: return demux_film_fill_buffer(demux);
-    case DEMUXER_TYPE_BMP: return demux_bmp_fill_buffer(demux);
     case DEMUXER_TYPE_FLI: return demux_fli_fill_buffer(demux);
     case DEMUXER_TYPE_MPEG_TY: return demux_ty_fill_buffer( demux );
     case DEMUXER_TYPE_MPEG4_ES:
@@@@ -574,7 +569,6 @@@@ int mov_read_header(demuxer_t* demuxer);
 int demux_open_fli(demuxer_t* demuxer);
 int demux_open_mf(demuxer_t* demuxer);
 int demux_open_film(demuxer_t* demuxer);
-int demux_open_bmp(demuxer_t* demuxer);
 int demux_open_roq(demuxer_t* demuxer);
 #ifdef HAVE_LIBDV095
 int demux_open_rawdv(demuxer_t* demuxer);
@@@@ -598,7 +592,6 @@@@ extern int demux_rawaudio_open(demuxer_t
 extern int demux_rawvideo_open(demuxer_t* demuxer);
 extern int smjpeg_check_file(demuxer_t *demuxer);
 extern int demux_open_smjpeg(demuxer_t* demuxer);
-extern int bmp_check_file(demuxer_t *demuxer);
 extern int demux_xmms_open(demuxer_t* demuxer);
 extern int gif_check_file(demuxer_t *demuxer);
 extern int demux_open_gif(demuxer_t* demuxer);
@@@@ -856,17 +849,6 @@@@ if(file_format==DEMUXER_TYPE_UNKNOWN || 
   }
 }
 #endif
-//=============== Try to open as BMP file: =================
-if(file_format==DEMUXER_TYPE_UNKNOWN || file_format==DEMUXER_TYPE_BMP){
-  demuxer=new_demuxer(stream,DEMUXER_TYPE_BMP,audio_id,video_id,dvdsub_id);
-  if(bmp_check_file(demuxer)){
-      mp_msg(MSGT_DEMUXER,MSGL_INFO,MSGTR_Detected_XXX_FileFormat,"BMP");
-      file_format=DEMUXER_TYPE_BMP;
-  } else {
-      free_demuxer(demuxer);
-      demuxer = NULL;
-  }
-}
 #ifdef HAVE_OGGVORBIS
 //=============== Try to open as Ogg file: =================
 if(file_format==DEMUXER_TYPE_UNKNOWN || file_format==DEMUXER_TYPE_OGG){
@@@@ -1124,10 +1106,6 @@@@ switch(file_format){
   break;
  }
 #endif
- case DEMUXER_TYPE_BMP: {
-  if (!demux_open_bmp(demuxer)) return NULL;
-  break;
- }
  case DEMUXER_TYPE_ROQ: {
   if (!demux_open_roq(demuxer)) return NULL;
   break;
@


1.1.2.1
log
@SECURITY:
fix multiple overflow vulnerabilties; bump PKGNAME;
http://www.vuxml.org/openbsd/4a667f60-5468-11d9-a47f-00065bd5b0b6.html

ok bra@@
@
text
@a0 81
$OpenBSD$
--- libmpdemux/demuxer.c.orig	Sat Apr 17 18:46:40 2004
+++ libmpdemux/demuxer.c	Wed Dec 29 15:34:38 2004
@@@@ -121,7 +121,6 @@@@ extern void demux_close_y4m(demuxer_t *d
 extern void demux_close_mf(demuxer_t* demuxer);
 extern void demux_close_roq(demuxer_t* demuxer);
 extern void demux_close_film(demuxer_t* demuxer);
-extern void demux_close_bmp(demuxer_t* demuxer);
 extern void demux_close_fli(demuxer_t* demuxer);
 extern void demux_close_nsv(demuxer_t* demuxer);
 extern void demux_close_nuv(demuxer_t* demuxer);
@@@@ -172,8 +171,6 @@@@ void free_demuxer(demuxer_t *demuxer){
       demux_close_roq(demuxer);  break;
     case DEMUXER_TYPE_FILM:
       demux_close_film(demuxer); break;
-    case DEMUXER_TYPE_BMP:
-      demux_close_bmp(demuxer); break;
     case DEMUXER_TYPE_FLI:
       demux_close_fli(demuxer); break;
     case DEMUXER_TYPE_NSV:
@@@@ -290,7 +287,6 @@@@ void ds_read_packet(demux_stream_t *ds,s
 int demux_mf_fill_buffer( demuxer_t *demux);
 int demux_roq_fill_buffer(demuxer_t *demux);
 int demux_film_fill_buffer(demuxer_t *demux);
-int demux_bmp_fill_buffer(demuxer_t *demux);
 int demux_fli_fill_buffer(demuxer_t *demux);
 int demux_mpg_es_fill_buffer(demuxer_t *demux);
 int demux_mpg_fill_buffer(demuxer_t *demux);
@@@@ -330,7 +326,6 @@@@ int demux_fill_buffer(demuxer_t *demux,d
     case DEMUXER_TYPE_MF: return demux_mf_fill_buffer(demux);
     case DEMUXER_TYPE_ROQ: return demux_roq_fill_buffer(demux);
     case DEMUXER_TYPE_FILM: return demux_film_fill_buffer(demux);
-    case DEMUXER_TYPE_BMP: return demux_bmp_fill_buffer(demux);
     case DEMUXER_TYPE_FLI: return demux_fli_fill_buffer(demux);
     case DEMUXER_TYPE_MPEG_TY: return demux_ty_fill_buffer( demux );
     case DEMUXER_TYPE_MPEG4_ES:
@@@@ -587,7 +582,6 @@@@ int mov_read_header(demuxer_t* demuxer);
 int demux_open_fli(demuxer_t* demuxer);
 int demux_open_mf(demuxer_t* demuxer);
 int demux_open_film(demuxer_t* demuxer);
-int demux_open_bmp(demuxer_t* demuxer);
 int demux_open_roq(demuxer_t* demuxer);
 #ifdef HAVE_LIBDV095
 int demux_open_rawdv(demuxer_t* demuxer);
@@@@ -613,7 +607,6 @@@@ extern int demux_rawaudio_open(demuxer_t
 extern int demux_rawvideo_open(demuxer_t* demuxer);
 extern int smjpeg_check_file(demuxer_t *demuxer);
 extern int demux_open_smjpeg(demuxer_t* demuxer);
-extern int bmp_check_file(demuxer_t *demuxer);
 extern int demux_xmms_open(demuxer_t* demuxer);
 extern int gif_check_file(demuxer_t *demuxer);
 extern int demux_open_gif(demuxer_t* demuxer);
@@@@ -884,17 +877,6 @@@@ if(file_format==DEMUXER_TYPE_UNKNOWN || 
   }
 }
 #endif
-//=============== Try to open as BMP file: =================
-if(file_format==DEMUXER_TYPE_UNKNOWN || file_format==DEMUXER_TYPE_BMP){
-  demuxer=new_demuxer(stream,DEMUXER_TYPE_BMP,audio_id,video_id,dvdsub_id);
-  if(bmp_check_file(demuxer)){
-      mp_msg(MSGT_DEMUXER,MSGL_INFO,MSGTR_Detected_XXX_FileFormat,"BMP");
-      file_format=DEMUXER_TYPE_BMP;
-  } else {
-      free_demuxer(demuxer);
-      demuxer = NULL;
-  }
-}
 #ifdef HAVE_OGGVORBIS
 //=============== Try to open as Ogg file: =================
 if(file_format==DEMUXER_TYPE_UNKNOWN || file_format==DEMUXER_TYPE_OGG){
@@@@ -1165,10 +1147,6 @@@@ switch(file_format){
   break;
  }
 #endif
- case DEMUXER_TYPE_BMP: {
-  if (!demux_open_bmp(demuxer)) return NULL;
-  break;
- }
  case DEMUXER_TYPE_ROQ: {
   if (!demux_open_roq(demuxer)) return NULL;
   break;
@

