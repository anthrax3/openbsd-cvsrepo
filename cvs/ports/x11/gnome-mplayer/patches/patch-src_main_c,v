head	1.29;
access;
symbols
	OPENBSD_6_2:1.29.0.14
	OPENBSD_6_2_BASE:1.29
	OPENBSD_6_1:1.29.0.12
	OPENBSD_6_1_BASE:1.29
	OPENBSD_6_0:1.29.0.10
	OPENBSD_6_0_BASE:1.29
	OPENBSD_5_9:1.29.0.6
	OPENBSD_5_9_BASE:1.29
	OPENBSD_5_8:1.29.0.8
	OPENBSD_5_8_BASE:1.29
	OPENBSD_5_7:1.29.0.4
	OPENBSD_5_7_BASE:1.29
	OPENBSD_5_6:1.29.0.2
	OPENBSD_5_6_BASE:1.29
	OPENBSD_5_5:1.27.0.2
	OPENBSD_5_5_BASE:1.27
	OPENBSD_5_4:1.26.0.2
	OPENBSD_5_4_BASE:1.26
	OPENBSD_5_3:1.23.0.2
	OPENBSD_5_3_BASE:1.23
	OPENBSD_5_2:1.21.0.2
	OPENBSD_5_2_BASE:1.21
	OPENBSD_5_1_BASE:1.16
	OPENBSD_5_1:1.16.0.2
	OPENBSD_5_0:1.11.0.2
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.9.0.2
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.6.0.2
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.3.0.2
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.1.0.2
	OPENBSD_4_6_BASE:1.1;
locks; strict;
comment	@# @;


1.29
date	2014.04.29.13.39.22;	author dcoppa;	state Exp;
branches;
next	1.28;

1.28
date	2014.03.18.06.50.18;	author dcoppa;	state Exp;
branches;
next	1.27;

1.27
date	2013.10.07.10.22.38;	author dcoppa;	state Exp;
branches;
next	1.26;

1.26
date	2013.05.27.11.43.08;	author dcoppa;	state Exp;
branches;
next	1.25;

1.25
date	2013.05.24.13.34.11;	author dcoppa;	state Exp;
branches;
next	1.24;

1.24
date	2013.05.24.08.31.38;	author dcoppa;	state Exp;
branches;
next	1.23;

1.23
date	2012.12.19.15.04.36;	author dcoppa;	state Exp;
branches;
next	1.22;

1.22
date	2012.10.31.13.22.03;	author dcoppa;	state dead;
branches;
next	1.21;

1.21
date	2012.05.03.15.19.08;	author dcoppa;	state Exp;
branches;
next	1.20;

1.20
date	2012.04.10.13.30.37;	author dcoppa;	state dead;
branches;
next	1.19;

1.19
date	2012.04.06.10.14.44;	author dcoppa;	state Exp;
branches;
next	1.18;

1.18
date	2012.04.06.07.01.39;	author dcoppa;	state Exp;
branches;
next	1.17;

1.17
date	2012.03.26.14.41.16;	author dcoppa;	state dead;
branches;
next	1.16;

1.16
date	2012.01.23.16.14.40;	author dcoppa;	state Exp;
branches;
next	1.15;

1.15
date	2012.01.23.13.06.32;	author dcoppa;	state Exp;
branches;
next	1.14;

1.14
date	2012.01.11.12.45.25;	author dcoppa;	state Exp;
branches;
next	1.13;

1.13
date	2012.01.09.12.10.22;	author dcoppa;	state dead;
branches;
next	1.12;

1.12
date	2011.09.21.12.20.07;	author dcoppa;	state Exp;
branches;
next	1.11;

1.11
date	2011.07.12.08.12.29;	author dcoppa;	state Exp;
branches;
next	1.10;

1.10
date	2011.04.28.11.47.48;	author dcoppa;	state dead;
branches;
next	1.9;

1.9
date	2010.12.31.12.03.55;	author dcoppa;	state Exp;
branches;
next	1.8;

1.8
date	2010.11.15.11.11.34;	author dcoppa;	state Exp;
branches;
next	1.7;

1.7
date	2010.11.08.15.04.15;	author dcoppa;	state Exp;
branches;
next	1.6;

1.6
date	2010.07.08.06.29.12;	author dcoppa;	state Exp;
branches;
next	1.5;

1.5
date	2010.05.10.08.30.55;	author dcoppa;	state Exp;
branches;
next	1.4;

1.4
date	2010.03.29.12.16.07;	author dcoppa;	state Exp;
branches;
next	1.3;

1.3
date	2009.11.06.16.57.23;	author edd;	state Exp;
branches;
next	1.2;

1.2
date	2009.10.31.12.26.25;	author edd;	state Exp;
branches;
next	1.1;

1.1
date	2009.04.14.09.38.39;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.29
log
@
Update to final 1.0.9 release.
@
text
@$OpenBSD: patch-src_main_c,v 1.28 2014/03/18 06:50:18 dcoppa Exp $

Fix problem with remembered softvol not being loaded

--- src/main.c.orig	Tue Apr 29 14:48:12 2014
+++ src/main.c	Tue Apr 29 14:50:25 2014
@@@@ -88,7 +88,6 @@@@ static GOptionEntry entries[] = {
      N_("Last software volume percentage- only applied when remember_softvol is set to TRUE"),
      NULL},
     {"mixer", 0, 0, G_OPTION_ARG_STRING, &(audio_device.alsa_mixer), N_("Mixer to use"), NULL},
-    {"volume", 0, 0, G_OPTION_ARG_INT, &(pref_volume), N_("Set initial volume percentage"), NULL},
     // note that sizeof(gint)==sizeof(gboolean), so we can give &showcontrols here
     {"showcontrols", 0, 0, G_OPTION_ARG_INT, &showcontrols, N_("Show the controls in window"),
      "[0|1]"},
@@@@ -841,7 +840,6 @@@@ int main(int argc, char *argv[])
     update_control_flag = FALSE;
     skip_fixed_allocation_on_show = FALSE;
     skip_fixed_allocation_on_hide = FALSE;
-    pref_volume = -1;
     use_mplayer2 = FALSE;
     enable_global_menu = FALSE;
     cover_art_uri = NULL;
@@@@ -910,9 +908,6 @@@@ int main(int argc, char *argv[])
     pplevel = gm_pref_store_get_int(gm_store, PPLEVEL);
 #ifndef HAVE_ASOUNDLIB
     volume = gm_pref_store_get_int(gm_store, VOLUME);
-    if (pref_volume == -1) {
-        pref_volume = volume;
-    }
 #endif
     audio_channels = gm_pref_store_get_int(gm_store, AUDIO_CHANNELS);
     use_hw_audio = gm_pref_store_get_boolean(gm_store, USE_HW_AUDIO);
@@@@ -1058,7 +1053,9 @@@@ int main(int argc, char *argv[])
         printf(_("gmtk v%s\n"), gmtk_version());
         printf("GTK %i.%i.%i\n", GTK_MAJOR_VERSION, GTK_MINOR_VERSION, GTK_MICRO_VERSION);
         printf("GLIB %i.%i.%i\n", GLIB_MAJOR_VERSION, GLIB_MINOR_VERSION, GLIB_MICRO_VERSION);
+#ifdef LIBGDA_ENABLED
         printf("GDA Enabled\n");
+#endif
     }
 
     if (cache_size == 0)
@@@@ -1326,14 +1323,7 @@@@ int main(int argc, char *argv[])
     //gm_audio_get_volume(&audio_device);
     set_media_player_attributes(media);
     if (softvol) {
-        if (pref_volume != -1) {
-            audio_device.volume = (gdouble) pref_volume / 100.0;
-            gm_log(verbose, G_LOG_LEVEL_INFO, "The volume on '%s' is %f", audio_device.description,
-                   audio_device.volume);
-            volume = audio_device.volume * 100;
-        } else {
-            audio_device.volume = volume / 100.0;
-        }
+        audio_device.volume = volume / 100.0;
     }
     gm_log(verbose, G_LOG_LEVEL_DEBUG, "Volume is %lf Audio Device Volume = %f", volume, audio_device.volume);
 
@


1.28
log
@
Prevent window from going fullscreen on startup when embedded
(upstream svn revision r2468)

Fix fullscreen mode hanging when control menu goes thru show/hide
(upstream svn revision r2469)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.27 2013/10/07 10:22:38 dcoppa Exp $
d5 2
a6 5
Prevent window from going fullscreen on startup when embedded
(upstream svn revision r2468)

--- src/main.c.orig	Mon Nov 25 20:44:09 2013
+++ src/main.c	Thu Mar 13 11:00:24 2014
a58 9
@@@@ -1395,7 +1385,7 @@@@ int main(int argc, char *argv[])
     // put the request to update the volume into the list of tasks to complete
     g_idle_add(hookup_volume, NULL);
     g_idle_add(set_volume, NULL);
-    if (fullscreen)
+    if (fullscreen && embed_window == 0)
         g_idle_add(set_fullscreen, NULL);
     gtk_main();
     return 0;
@


1.27
log
@Update to gnome-mplayer-1.0.9alpha
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.26 2013/05/27 11:43:08 dcoppa Exp $
d5 5
a9 2
--- src/main.c.orig	Mon Oct  7 10:34:53 2013
+++ src/main.c	Mon Oct  7 10:38:49 2013
d62 9
@


1.26
log
@I've changed my mind: disable cover art support, it's fubar.

While here, simplify volume-related patches.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.25 2013/05/24 13:34:11 dcoppa Exp $
a3 1
(upstream svn revision r2424)
d5 3
a7 11
--- src/main.c.orig	Mon Feb 18 15:58:47 2013
+++ src/main.c	Mon May 27 12:48:57 2013
@@@@ -65,7 +65,6 @@@@ static gchar *tv_input;
 static gint tv_width;
 static gint tv_height;
 static gint tv_fps;
-static gint pref_volume;
 
 typedef struct _PlayData {
     gchar uri[4096];
@@@@ -89,7 +88,6 @@@@ static GOptionEntry entries[] = {
d15 1
a15 1
@@@@ -832,7 +830,6 @@@@ int main(int argc, char *argv[])
d23 11
a33 1
@@@@ -1042,7 +1039,9 @@@@ int main(int argc, char *argv[])
d43 1
a43 10
@@@@ -1084,6 +1083,7 @@@@ int main(int argc, char *argv[])
         if (remember_softvol && volume_softvol != -1) {
             gm_log(verbose, G_LOG_LEVEL_INFO, "Using last volume of %f%%", volume_softvol * 100.0);
             volume = (gdouble) volume_softvol *100.0;
+            audio_device.volume = volume / 100.0;
         } else {
             volume = 100.0;
         }
@@@@ -1308,16 +1308,11 @@@@ int main(int argc, char *argv[])
     // disabling this line seems to help with hangs on startup when using pulseaudio
d46 1
a46 1
-    if (!softvol) {
d52 2
d55 1
a55 4
-    } else {
-        audio_device.volume = volume / 100.0;
+    if (softvol) {
+            audio_device.volume = volume / 100.0;
d57 2
a58 5
+    gm_log(verbose, G_LOG_LEVEL_DEBUG, "Volume is %lf Audio Device Volume = %f", volume, audio_device.volume);
+
 #ifdef GTK2_12_ENABLED
     gtk_scale_button_set_value(GTK_SCALE_BUTTON(vol_slider), audio_device.volume);
 #else
@


1.25
log
@
Unbreak cover art support
@
text
@d1 1
a1 9
$OpenBSD: patch-src_main_c,v 1.24 2013/05/24 08:31:38 dcoppa Exp $

Make --volume work with and without softvol enabled
(upstream svn revision r2426)

Unbreak cover art support

Set pref_volume to stored volume when asound is disabled
(upstream svn revision r2427)
d7 1
a7 1
+++ src/main.c	Fri May 24 14:29:58 2013
d16 17
a32 36
@@@@ -344,7 +343,6 @@@@ gint play_iter(GtkTreeIter * playiter, gint restart_se
     while (gtk_events_pending())
         gtk_main_iteration();
 
-    /*
        // wait for metadata to be available on this item
        if (!streaming_media(uri) && !device_name(uri)) {
        i = 0;
@@@@ -364,7 +362,7 @@@@ gint play_iter(GtkTreeIter * playiter, gint restart_se
        &artist, ALBUM_COLUMN, &album, AUDIO_CODEC_COLUMN,
        &audio_codec, VIDEO_CODEC_COLUMN, &video_codec,
        VIDEO_WIDTH_COLUMN, &width, VIDEO_HEIGHT_COLUMN, &height,
-       DEMUXER_COLUMN, &demuxer, COVERART_COLUMN, &pixbuf,
+       DEMUXER_COLUMN, &demuxer, COVERART_COLUMN, &cover_art_file,
        SUBTITLE_COLUMN, &subtitle, AUDIOFILE_COLUMN, &audiofile,
        COUNT_COLUMN, &count, PLAYLIST_COLUMN, &playlist,
        PLAYABLE_COLUMN, &playable, -1);
@@@@ -392,7 +390,6 @@@@ gint play_iter(GtkTreeIter * playiter, gint restart_se
        }
 
        }
-     */
     // reset audio meter
     for (i = 0; i < METER_BARS; i++) {
         buckets[i] = 0;
@@@@ -900,6 +897,9 @@@@ int main(int argc, char *argv[])
     pplevel = gm_pref_store_get_int(gm_store, PPLEVEL);
 #ifndef HAVE_ASOUNDLIB
     volume = gm_pref_store_get_int(gm_store, VOLUME);
+    if (pref_volume == -1) {
+        pref_volume = volume;
+    }
 #endif
     audio_channels = gm_pref_store_get_int(gm_store, AUDIO_CHANNELS);
     use_hw_audio = gm_pref_store_get_boolean(gm_store, USE_HW_AUDIO);
@@@@ -1042,7 +1042,9 @@@@ int main(int argc, char *argv[])
d42 1
a42 1
@@@@ -1084,6 +1086,7 @@@@ int main(int argc, char *argv[])
d50 1
a50 1
@@@@ -1308,16 +1311,18 @@@@ int main(int argc, char *argv[])
d55 8
a63 6
         if (pref_volume != -1) {
             audio_device.volume = (gdouble) pref_volume / 100.0;
             gm_log(verbose, G_LOG_LEVEL_INFO, "The volume on '%s' is %f", audio_device.description,
                    audio_device.volume);
             volume = audio_device.volume * 100;
+        } else {
a64 3
         }
-    } else {
-        audio_device.volume = volume / 100.0;
@


1.24
log
@Update to gnome-mplayer-1.0.8
@
text
@d1 6
a6 1
$OpenBSD: patch-src_main_c,v 1.23 2012/12/19 15:04:36 dcoppa Exp $
a13 3
Make --volume work with and without softvol enabled
(upstream svn revision r2426)

d15 1
a15 1
+++ src/main.c	Fri May 24 09:56:06 2013
d24 26
a49 1
@@@@ -900,6 +899,9 @@@@ int main(int argc, char *argv[])
d59 1
a59 1
@@@@ -1042,7 +1044,9 @@@@ int main(int argc, char *argv[])
d69 1
a69 1
@@@@ -1084,6 +1088,7 @@@@ int main(int argc, char *argv[])
d77 1
a77 1
@@@@ -1308,16 +1313,18 @@@@ int main(int argc, char *argv[])
@


1.23
log
@Some improvements in the audio department:

Fix some problems on initial volume setup
(upstream svn revision r2378)

Don't monitor system volume when running in softvol mode
(upstream svn revision r2377)
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 2
Fix some problems on initial volume setup
(upstream svn revision r2378)
d6 45
a50 4
--- src/main.c.orig	Wed Dec 19 13:36:07 2012
+++ src/main.c	Wed Dec 19 15:23:05 2012
@@@@ -1288,7 +1288,6 @@@@ int main(int argc, char *argv[])
     gm_audio_update_device(&audio_device);
a52 1
-    gm_audio_set_server_volume_update_callback(&audio_device, set_volume);
d54 18
a71 10
 
     if (!softvol) {
@@@@ -1362,6 +1361,7 @@@@ int main(int argc, char *argv[])
     safe_to_save_default_playlist = TRUE;
 
     // put the request to update the volume into the list of tasks to complete
+    g_idle_add(hookup_volume, NULL);
     g_idle_add(set_volume, NULL);
     gtk_main();
 
@


1.22
log
@Update to gnome-mplayer-1.0.7.
Switch to gtk+3.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.21 2012/05/03 15:19:08 dcoppa Exp $
d3 2
a4 2
Globally initialize libCURL
(upstream svn revision r2242)
d6 17
a22 19
--- src/main.c.orig	Fri Apr  6 15:19:25 2012
+++ src/main.c	Thu May  3 15:06:04 2012
@@@@ -778,7 +778,6 @@@@ int main(int argc, char *argv[])
     use_xscrnsaver = FALSE;
     screensaver_disabled = FALSE;
     update_control_flag = FALSE;
-    gchar *filename;
     skip_fixed_allocation_on_show = FALSE;
     skip_fixed_allocation_on_hide = FALSE;
     pref_volume = -1;
@@@@ -1017,6 +1016,11 @@@@ int main(int argc, char *argv[])
     if (verbose) {
         printf("Using audio device: %s\n", audio_device_name);
     }
+#ifdef HAVE_MUSICBRAINZ
+    if (curl_global_init(CURL_GLOBAL_ALL) != 0) {
+        printf("CURL initialization failed\n");
+    }
+#endif
a23 2
     if (softvol) {
         if (verbose)
@


1.21
log
@Several bugfixes from upstream svn (see patches for details)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.20
log
@Update to 1.0.6
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.19 2012/04/06 10:14:44 dcoppa Exp $
d3 2
a4 2
Separate delete and destroy events
(upstream svn revisions r2232 & r2233)
d6 19
a24 23
Remove deprecated slide_away code to unbreak with glib-2.32
(upstream svn revision r2234)

--- src/main.c.orig	Thu Mar 22 05:58:16 2012
+++ src/main.c	Fri Apr  6 11:42:28 2012
@@@@ -594,6 +594,7 @@@@ static void hup_handler(int signum)
 {
     // printf("handling signal %i\n",signum);
     delete_callback(NULL, NULL, NULL);
+    g_idle_add(set_destroy, NULL);
 }
 #endif
 
@@@@ -734,7 +735,6 @@@@ int main(int argc, char *argv[])
     subtitle_fuzziness = 0;
     disable_embeddedfonts = FALSE;
     quit_on_complete = FALSE;
-    slide_away = NULL;
     verbose = 0;
     reallyverbose = 0;
     embedding_disabled = FALSE;
@@@@ -1066,8 +1066,6 @@@@ int main(int argc, char *argv[])
     create_window(embed_window);
d26 2
a27 6
     autopause = FALSE;
-    slide_away = g_mutex_new();
-    mplayer_complete_cond = g_cond_new();
 #ifdef GIO_ENABLED
     idledata->caching = g_mutex_new();
     idledata->caching_complete = g_cond_new();
@


1.19
log
@Bugfixes from upstream
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.18 2012/04/06 07:01:39 dcoppa Exp $
@


1.18
log
@Remove deprecated slide_away code to unbreak with glib-2.32

committed upstream
@
text
@d1 4
a4 1
$OpenBSD$
d7 1
d9 11
a19 3
--- src/main.c.orig	Fri Apr  6 08:48:41 2012
+++ src/main.c	Fri Apr  6 08:49:39 2012
@@@@ -734,7 +734,6 @@@@ int main(int argc, char *argv[])
d27 1
a27 1
@@@@ -1066,8 +1065,6 @@@@ int main(int argc, char *argv[])
@


1.17
log
@Update gmtk and gnome-mplayer to 1.0.6beta1
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.16 2012/01/23 16:14:40 dcoppa Exp $
d3 1
a3 2
Fix problem with directory vs dvd detection
(upstream svn revision r2201)
d5 11
a15 27
Enable dark theme only when using GTK+3
(upstream svn revision r2205)

--- src/main.c.orig	Fri Dec 16 20:55:51 2011
+++ src/main.c	Mon Jan 23 17:06:45 2012
@@@@ -658,7 +658,10 @@@@ int main(int argc, char *argv[])
     gdouble volume = 100.0;
     gchar *accelerator_keys;
     gchar **parse;
+#ifdef GTK3_ENABLED
     GtkSettings *gtk_settings;
+#endif
+    int stat_result;
 
 #ifndef OS_WIN32
     struct sigaction sa;
@@@@ -1053,10 +1056,12 @@@@ int main(int argc, char *argv[])
                            G_TYPE_FLOAT, G_TYPE_FLOAT, G_TYPE_BOOLEAN);
 
     // only use dark theme if not embedded, otherwise use the default theme                                       
+#ifdef GTK3_ENABLED
     if (embed_window <= 0) {
         gtk_settings = gtk_settings_get_default();
         g_object_set(G_OBJECT(gtk_settings), "gtk-application-prefer-dark-theme", TRUE, NULL);
     }
+#endif
 
d18 6
a23 42
@@@@ -1078,14 +1083,15 @@@@ int main(int argc, char *argv[])
             g_object_unref(file);
         }
         filename = g_filename_from_uri(uri, NULL, NULL);
-        g_stat(filename, &buf);
+        stat_result = g_stat(filename, &buf);
         g_free(filename);
 #else
-        g_stat(argv[fileindex], &buf);
+        stat_result = g_stat(argv[fileindex], &buf);
 #endif
 
         if (verbose) {
             printf("opening %s\n", argv[fileindex]);
+            printf("stat_result = %i\n", stat_result);
             printf("is block %i\n", S_ISBLK(buf.st_mode));
             printf("is character %i\n", S_ISCHR(buf.st_mode));
             printf("is reg %i\n", S_ISREG(buf.st_mode));
@@@@ -1093,7 +1099,7 @@@@ int main(int argc, char *argv[])
             printf("playlist %i\n", playlist);
             printf("embedded in window id 0x%x\n", embed_window);
         }
-        if (S_ISBLK(buf.st_mode)) {
+        if (stat_result == 0 && S_ISBLK(buf.st_mode)) {
             // might have a block device, so could be a DVD
 
 #ifdef HAVE_SYS_MOUNT_H
@@@@ -1148,11 +1154,11 @@@@ int main(int argc, char *argv[])
                     playiter = TRUE;
                 }
             }
-        } else if (S_ISDIR(buf.st_mode)) {
+        } else if (stat_result == 0 && S_ISDIR(buf.st_mode)) {
             uri = g_strdup_printf("%s/VIDEO_TS", argv[fileindex]);
-            stat(uri, &buf);
+            stat_result = g_stat(uri, &buf);
             g_free(uri);
-            if (S_ISDIR(buf.st_mode)) {
+            if (stat_result == 0 && S_ISDIR(buf.st_mode)) {
                 add_item_to_playlist("dvdnav://", 0);
                 gtk_tree_model_get_iter_first(GTK_TREE_MODEL(playliststore), &iter);
                 gmtk_media_player_set_media_type(GMTK_MEDIA_PLAYER(media), TYPE_DVD);
@


1.16
log
@Revert to 'xv' as default vo.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.15 2012/01/23 13:06:32 dcoppa Exp $
@


1.15
log
@Play on the safe side: not all machines support xv video output
(loongson comes to mind), and thus use 'x11' by default.

While here, enable dark theme only when using GTK+3 (fixes warning
at startup).
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.14 2012/01/11 12:45:25 dcoppa Exp $
d10 3
a12 2
+++ src/main.c	Mon Jan 23 13:48:03 2012
@@@@ -659,6 +659,7 @@@@ int main(int argc, char *argv[])
d15 1
d17 1
d22 1
a22 1
@@@@ -1053,10 +1054,12 @@@@ int main(int argc, char *argv[])
d35 1
a35 1
@@@@ -1078,14 +1081,15 @@@@ int main(int argc, char *argv[])
d53 1
a53 1
@@@@ -1093,7 +1097,7 @@@@ int main(int argc, char *argv[])
d62 1
a62 1
@@@@ -1148,11 +1152,11 @@@@ int main(int argc, char *argv[])
@


1.14
log
@Fix problem with directory vs dvd detection
(upstream svn revision r2201)
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
d10 1
a10 1
+++ src/main.c	Wed Jan 11 13:39:39 2012
d19 14
a32 1
@@@@ -1078,14 +1079,15 @@@@ int main(int argc, char *argv[])
d50 1
a50 1
@@@@ -1093,7 +1095,7 @@@@ int main(int argc, char *argv[])
d59 1
a59 1
@@@@ -1148,11 +1150,11 @@@@ int main(int argc, char *argv[])
@


1.13
log
@Update to gnome-mplayer-1.0.5
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.12 2011/09/21 12:20:07 dcoppa Exp $
d3 2
a4 2
Raise event on incomplete QuickTime file, and mark it for retry
(fix apple.com/trailers) - upstream svn revision r2152
d6 35
a40 8
Set CDDB media type as TYPE_CD
(upstream svn revision r2165)

--- src/main.c.orig	Mon Jun 27 16:59:45 2011
+++ src/main.c	Wed Sep 21 13:31:40 2011
@@@@ -534,6 +534,7 @@@@ gint play_iter(GtkTreeIter * playiter, gint restart_se
     idledata->width = width;
     idledata->height = height;
d42 16
a57 13
+    idledata->retry_on_full_cache = FALSE;
     idledata->cachepercent = -1.0;
     g_strlcpy(idledata->info, uri, 1024);
     set_media_info(idledata);
@@@@ -560,6 +561,8 @@@@ gint play_iter(GtkTreeIter * playiter, gint restart_se
         } else if (g_str_has_prefix(uri, "dvd") || g_str_has_prefix(uri, "dvdnav")) {
             gmtk_media_player_set_media_type(GMTK_MEDIA_PLAYER(media), TYPE_DVD);
         } else if (g_str_has_prefix(uri, "cdda")) {
+            gmtk_media_player_set_media_type(GMTK_MEDIA_PLAYER(media), TYPE_CD);
+        } else if (g_str_has_prefix(uri, "cddb")) {
             gmtk_media_player_set_media_type(GMTK_MEDIA_PLAYER(media), TYPE_CD);
         } else if (g_str_has_prefix(uri, "vcd")) {
             gmtk_media_player_set_media_type(GMTK_MEDIA_PLAYER(media), TYPE_VCD);
@


1.12
log
@Backport some bugfixes from upstream svn:

Bugfix: ATTRIBUTE_FORCE_CACHE not being processed
(upstream svn revision r2172)

Bugfix: correctly set/initialize the media_device attribute
(upstream svn revision r2165)

Fix handling of mouse, panel and controls visibility when
going to/returning from fullscreen (upstream svn r2167 - r2169)

Bugfix: 'f' not going to/returning from fullscreen
(upstream svn revision r2161)

Set CDDB media type as TYPE_CD
(upstream svn revision r2165)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.11 2011/07/12 08:12:29 dcoppa Exp $
@


1.11
log
@Fix trailers.apple.com. It works well now (yay!)

From upstream svn
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
d10 1
a10 1
+++ src/main.c	Mon Jul 11 10:19:19 2011
d15 1
a15 1
+	idledata->retry_on_full_cache = FALSE;
d19 9
@


1.10
log
@Update to gnome-mplayer-1.0.3.
This now uses gsettings/dconf configuration system.
Most of my local patches have been merged upstream.

dconf clue stick by ajacoutot@@

Tested by Antti Harri on YouTube using the flashvideoreplacer
extension for firefox (thanks!)

please go ahead fgsch@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.9 2010/12/31 12:03:55 dcoppa Exp $
d3 2
a4 5
set some sane defaults:
use mplayer's software volume control (see pkg/MESSAGE)
disable bar animation in full screen
use xscrnsaver controls over gnome-power-manager
start with volume at 50% by default
d6 10
a15 56
--- src/main.c.orig	Tue Oct 19 18:33:40 2010
+++ src/main.c	Mon Nov 15 11:49:10 2010
@@@@ -689,8 +689,8 @@@@ int main(int argc, char *argv[])
     playlist_visible = FALSE;
     disable_fullscreen = FALSE;
     disable_framedrop = FALSE;
-    softvol = FALSE;
-    remember_softvol = FALSE;
+    softvol = TRUE;
+    remember_softvol = TRUE;
     volume_softvol = -1;
     volume_gain = 0;
     subtitlefont = NULL;
@@@@ -705,8 +705,9 @@@@ int main(int argc, char *argv[])
     reallyverbose = 0;
     embedding_disabled = FALSE;
     disable_pause_on_click = FALSE;
-    disable_animation = FALSE;
+    disable_animation = TRUE;
     auto_hide_timeout = 3;
+    mouse_over_controls = FALSE;
     use_mediakeys = TRUE;
     use_defaultpl = FALSE;
     mplayer_bin = NULL;
@@@@ -744,7 +745,7 @@@@ int main(int argc, char *argv[])
     start_second = 0;
     play_length = 0;
     save_loc = TRUE;
-    use_xscrnsaver = FALSE;
+    use_xscrnsaver = TRUE;
     screensaver_disabled = FALSE;
     update_control_flag = FALSE;
     gchar *filename;
@@@@ -796,9 +797,10 @@@@ int main(int argc, char *argv[])
     audio_channels = gm_pref_store_get_int(gm_store, AUDIO_CHANNELS);
     use_hw_audio = gm_pref_store_get_boolean(gm_store, USE_HW_AUDIO);
     fullscreen = gm_pref_store_get_boolean(gm_store, FULLSCREEN);
-    softvol = gm_pref_store_get_boolean(gm_store, SOFTVOL);
-    remember_softvol = gm_pref_store_get_boolean(gm_store, REMEMBER_SOFTVOL);
-    volume_softvol = gm_pref_store_get_int(gm_store, VOLUME_SOFTVOL);
+    softvol = gm_pref_store_get_boolean_with_default(gm_store, SOFTVOL, softvol);
+    remember_softvol = gm_pref_store_get_boolean_with_default(gm_store, REMEMBER_SOFTVOL, remember_softvol);
+    volume_softvol = gm_pref_store_get_int_with_default(gm_store, VOLUME_SOFTVOL, volume_softvol);
+    if (volume_softvol == -1) volume_softvol = 50;
     volume_gain = gm_pref_store_get_int(gm_store, VOLUME_GAIN);
     forcecache = gm_pref_store_get_boolean(gm_store, FORCECACHE);
     vertical_layout = gm_pref_store_get_boolean(gm_store, VERTICAL);
@@@@ -815,7 +817,7 @@@@ int main(int argc, char *argv[])
     disable_ass = gm_pref_store_get_boolean(gm_store, DISABLEASS);
     disable_embeddedfonts = gm_pref_store_get_boolean(gm_store, DISABLEEMBEDDEDFONTS);
     disable_pause_on_click = gm_pref_store_get_boolean(gm_store, DISABLEPAUSEONCLICK);
-    disable_animation = gm_pref_store_get_boolean(gm_store, DISABLEANIMATION);
+    disable_animation = gm_pref_store_get_boolean_with_default(gm_store, DISABLEANIMATION, disable_animation);
     auto_hide_timeout =
         gm_pref_store_get_int_with_default(gm_store, AUTOHIDETIMEOUT, auto_hide_timeout);
     disable_cover_art_fetch = gm_pref_store_get_boolean(gm_store, DISABLE_COVER_ART_FETCH);
@


1.9
log
@Sync patch comments with reality
No functional changes, no bump.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.8 2010/11/15 11:11:34 dcoppa Exp $
@


1.8
log
@Backport a fix from upstream: don't hide controls and mouse in
fullscreen mode when mouse is over controls.

While here, make our defaults really work as it was intended.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.7 2010/11/08 15:04:15 dcoppa Exp $
d7 1
@


1.7
log
@Update to gnome-mplayer 1.0.0 and drop GConf dependency.

Suggestions about volume defaults by landry@@

OK landry@@
"go ahead" jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.6 2010/07/08 06:29:12 dcoppa Exp $
d9 2
a10 2
+++ src/main.c	Mon Nov  8 15:43:36 2010
@@@@ -689,9 +689,9 @@@@ int main(int argc, char *argv[])
a15 1
-    volume_softvol = -1;
d18 1
a18 1
+    volume_softvol = 50;
d21 1
a21 2
     subtitle_codepage = NULL;
@@@@ -705,7 +705,7 @@@@ int main(int argc, char *argv[])
d28 1
d31 2
a32 1
@@@@ -744,7 +744,7 @@@@ int main(int argc, char *argv[])
d41 23
@


1.6
log
@Apply some small bugfixes from upstream: see patches for descriptions.
@
text
@d1 1
a1 5
$OpenBSD: patch-src_main_c,v 1.5 2010/05/10 08:30:55 dcoppa Exp $

fixes from upstream svn:
fix memory leak when we have an invalid item to play
change metadata timeout count from 10 to 50 (fix upstream bug #391)
d8 3
a10 21
--- src/main.c.orig	Thu Feb 25 17:01:41 2010
+++ src/main.c	Wed May  5 08:57:01 2010
@@@@ -260,6 +260,8 @@@@ gint play_iter(GtkTreeIter * playiter, gint restart_se
     } else {
         if (verbose > 1)
             printf("iter is invalid, nothing to play\n");
+        g_free(thread_data);
+        thread_data = NULL;
         return 0;
     }
 
@@@@ -281,7 +283,7 @@@@ gint play_iter(GtkTreeIter * playiter, gint restart_se
     if (!streaming_media(uri) && !device_name(uri)) {
         i = 0;
         if (playable) {
-            while (demuxer == NULL && i < 10) {
+            while (demuxer == NULL && i < 50) {
                 g_free(title);
                 g_free(artist);
                 g_free(album);
@@@@ -688,7 +690,7 @@@@ int main(int argc, char *argv[])
d15 2
d18 2
a19 2
     remember_softvol = FALSE;
     volume_softvol = -1;
d21 3
a23 1
@@@@ -703,7 +705,7 @@@@ int main(int argc, char *argv[])
d32 1
a32 1
@@@@ -742,7 +744,7 @@@@ int main(int argc, char *argv[])
d39 2
a40 2
 
     sa.sa_handler = hup_handler;
@


1.5
log
@Bring two useful bugfixes in (from upstream).
While here, adjust WANTLIB.

OK landry@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.4 2010/03/29 12:16:07 dcoppa Exp $
d3 1
a3 1
fix from upstream svn:
@


1.4
log
@update to 0.9.9.2

OK landry@@, ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD$
d5 1
d13 1
a13 1
+++ src/main.c	Wed Mar 24 11:08:38 2010
d23 9
@


1.3
log
@Several fixes for gnome-mplayer volume control from maintainer David
Coppa.

OK sthen@@, landry@@
@
text
@d1 4
a4 1
$OpenBSD: patch-src_main_c,v 1.2 2009/10/31 12:26:25 edd Exp $
a6 1

d9 1
d11 9
a19 7
fix from upstream svn (update volume control)

--- src/main.c.orig	Thu Sep 17 09:56:06 2009
+++ src/main.c	Fri Nov  6 05:22:16 2009
@@@@ -422,27 +422,13 @@@@ gint play_iter(GtkTreeIter * playiter, gint restart_se
         g_strlcpy(thread_data->subtitle, subtitle, 1024);
         g_free(subtitle);
a20 14
-    /*
-       #ifdef HAVE_ASOUNDLIB
-       if (!softvol && ao != NULL
-       && (g_ascii_strcasecmp(ao, "alsa") == 0
-       || (use_pulse_flat_volume && g_ascii_strcasecmp(ao, "pulse") == 0))) {
-       volume = (gint) get_alsa_volume(TRUE);
-       idledata->volume = volume;
-       #if GTK2_12_ENABLED
-       gtk_scale_button_set_value(GTK_SCALE_BUTTON(vol_slider), volume);
-       #else
-       gtk_range_set_value(GTK_RANGE(vol_slider), volume);
-       #endif
-       }
-       #endif
d22 1
a22 16
-       #if GTK2_12_ENABLED
-       volume = gtk_scale_button_get_value(GTK_SCALE_BUTTON(vol_slider));
-       #else
-       volume = gtk_range_get_value(GTK_RANGE(vol_slider));
-       #endif
-     */
+#if GTK2_12_ENABLED
+    volume = gtk_scale_button_get_value(GTK_SCALE_BUTTON(vol_slider));
+#else
+    volume = gtk_range_get_value(GTK_RANGE(vol_slider));
+#endif
+
     if (g_ascii_strcasecmp(thread_data->filename, "") != 0) {
         if (!device_name(thread_data->filename) && !streaming_media(thread_data->filename)) {
             if (!g_file_test(thread_data->filename, G_FILE_TEST_EXISTS)) {
@@@@ -699,7 +685,7 @@@@ int main(int argc, char *argv[])
d28 4
a31 4
     subtitlefont = NULL;
     subtitle_codepage = NULL;
     subtitle_color = NULL;
@@@@ -711,7 +697,7 @@@@ int main(int argc, char *argv[])
d40 9
@


1.2
log
@update to gnome-mplayer-0.9.8

From MAINTAINER David Coppa with some reccommendations from landry@@ and
myself, namely:

 - comments in patches.
 - remove fullscreen bar animation by default.
 - fix an issue regarding the volume defaulting to zero.
 - message regarding gconfd-2

OK landry@@

Thanks
@
text
@d1 1
a1 1
$OpenBSD$
d8 39
a46 3
--- src/main.c.orig	Thu Sep 17 17:56:06 2009
+++ src/main.c	Sat Oct 17 17:53:22 2009
@@@@ -699,7 +699,7 @@@@ int main(int argc, char *argv[])
d55 1
a55 1
@@@@ -711,7 +711,7 @@@@ int main(int argc, char *argv[])
@


1.1
log
@- Change bitrate divisor from 1024 to 1000
Fix cache display problem when used as browser plugin

- Fix problem with default auto_hide value

adapted from upstream svn by David Coppa (maintainer)
@
text
@d2 26
a27 11
--- src/main.c.orig	Mon Apr 13 18:04:28 2009
+++ src/main.c	Mon Apr 13 18:06:07 2009
@@@@ -599,7 +599,7 @@@@ int main(int argc, char *argv[])
     disable_embeddedfonts = read_preference_bool(DISABLEEMBEDDEDFONTS);
     disable_pause_on_click = read_preference_bool(DISABLEPAUSEONCLICK);
     disable_animation = read_preference_bool(DISABLEANIMATION);
-    auto_hide_timeout = read_preference_int(AUTOHIDETIMEOUT);
+    auto_hide_timeout = read_preference_int_with_default(AUTOHIDETIMEOUT,auto_hide_timeout);
     disable_cover_art_fetch = read_preference_bool(DISABLE_COVER_ART_FETCH);
     use_mediakeys = read_preference_bool(USE_MEDIAKEYS);
     metadata_codepage = read_preference_string(METADATACODEPAGE);
@

