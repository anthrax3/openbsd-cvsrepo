head	1.5;
access;
symbols
	OPENBSD_5_0:1.4.0.6
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.4
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.2
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.3.0.20
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.18
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.16
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.14
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.12
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.10
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.8
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.6
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.4
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.2
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.2.0.6
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.4
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.1.1.1.0.16
	OPENBSD_3_4_BASE:1.1.1.1
	OPENBSD_3_3:1.1.1.1.0.14
	OPENBSD_3_3_BASE:1.1.1.1
	OPENBSD_3_2:1.1.1.1.0.12
	OPENBSD_3_2_BASE:1.1.1.1
	OPENBSD_3_1:1.1.1.1.0.10
	OPENBSD_3_1_BASE:1.1.1.1
	OPENBSD_3_0:1.1.1.1.0.8
	OPENBSD_3_0_BASE:1.1.1.1
	OPENBSD_2_9_TRACKING_SWITCH:1.1.1.1
	OPENBSD_2_9:1.1.1.1.0.6
	OPENBSD_2_9_BASE:1.1.1.1
	OPENBSD_2_8:1.1.1.1.0.4
	OPENBSD_2_8_BASE:1.1.1.1
	OPENBSD_2_7:1.1.1.1.0.2
	OPENBSD_2_7_BASE:1.1.1.1
	XVIEW_3_2_1:1.1.1.1
	XVIEW:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2011.11.15.21.40.45;	author jasper;	state dead;
branches;
next	1.4;

1.4
date	2010.05.28.01.13.54;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2005.04.18.11.48.20;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2003.12.30.00.47.24;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2000.04.02.15.25.17;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2000.04.02.15.25.17;	author espie;	state Exp;
branches;
next	;


desc
@@


1.5
log
@remove xview and ports using it; speaking of old unmaintained crufty toolkits..

prompted by naddy@@
ok sthen@@ wub@@
@
text
@$OpenBSD: p-libxview-textsw-txt_again_c,v 1.4 2010/05/28 01:13:54 espie Exp $
--- lib/libxview/textsw/txt_again.c.orig	Tue Jun 29 07:17:32 1993
+++ lib/libxview/textsw/txt_again.c	Sun May 23 14:16:14 2010
@@@@ -28,6 +28,8 @@@@ Pkg_private CHAR    *STRNCPY();
 Pkg_private Es_index textsw_do_input();
 Pkg_private Es_index textsw_do_pending_delete();
 
+static int textsw_string_min_free();
+
 string_t        null_string = {0, 0, 0};
 
 #define	TEXT_DELIMITER	"\\"
@@@@ -182,6 +184,7 @@@@ textsw_string_min_free(ptr_to_string, min_free_desired
  * Following is stolen from 3.2ALPHA sprintf(str, fmt, va_alist) SIDE_EFFECT:
  * TXTSW_STRING_FREE(ptr_to_string) is modified by this routine.
  */
+#ifndef __OpenBSD__
 #ifndef SVR4
 
 /* VARARGS2 */
@@@@ -325,6 +328,31 @@@@ va_dcl
 
 #endif /* SVR4 */
 
+#else /* __OpenBSD__ */
+/*inspiration taken from sprintf.c */
+
+static int
+textsw_printf(register string_t *ptr_to_string, char  *fmt, ...)
+{ 
+    FILE            _strbuf;
+    int             result;
+    va_list         args;
+    _strbuf._flags = __SWR | __SSTR;
+    _strbuf._bf._base = _strbuf._p = (char *) TXTSW_STRING_FREE(ptr_to_string);
+    _strbuf._bf._size = _strbuf._w = ptr_to_string->max_length - TXTSW_STRING_LENGTH(ptr_to_string);
+    VA_START(args, fmt);
+    result = vfprintf (&_strbuf, fmt, args);
+    va_end(args);
+    TXTSW_STRING_FREE(ptr_to_string) = (char *) _strbuf._p;
+#ifndef lint
+    if (result >= 0)
+    putc('\0', &_strbuf);
+#endif
+    return (result); 
+}
+
+#endif /* __OpenBSD__ */
+
 static	void
 textsw_record_buf(again, buffer, buffer_length)
     register string_t *again;
@@@@ -619,6 +647,8 @@@@ textsw_record_trash_insert(textsw)
  */
 /* VARARGS2 */
 
+#ifndef __OpenBSD__
+
 static int
 #ifdef ANSI_FUNC_PROTO
 textsw_scanf(register string_t *ptr_to_string, register char  *fmt, ...)
@@@@ -705,6 +735,38 @@@@ va_dcl
 
 #endif /* OW_I18N */
 }
+#else /* __OpenBSD__ */
+/*inspiration/code taken from sscanf.c */
+
+static int
+eofread(cookie, buf, len)
+        void *cookie;
+        char *buf;
+        int len;
+{
+
+        return (0);
+}   
+
+static int
+textsw_scanf(register string_t *ptr_to_string, char  *fmt, ...)
+{
+    FILE            _strbuf;
+    int             result;
+    va_list         args;
+
+    memset(&_strbuf, 0, sizeof _strbuf);
+    _strbuf._flags = __SRD;
+    _strbuf._bf._base = _strbuf._p = (char *) TXTSW_STRING_BASE(ptr_to_string);
+    _strbuf._bf._size = _strbuf._r = TXTSW_STRING_LENGTH(ptr_to_string);
+    _strbuf._read = eofread;
+    VA_START(args, fmt);
+    result = __svfscanf(&_strbuf, fmt, args);
+    va_end(args);
+    TXTSW_STRING_BASE(ptr_to_string) = (char *) _strbuf._p;
+    return (result);
+}       
+#endif /* __OpenBSD__ */
 
 static int
 textsw_next_is_delimiter(again)
@


1.4
log
@no fix, just regen patches
@
text
@d1 1
a1 1
$OpenBSD: p-libxview-textsw-txt_again_c,v 1.3 2005/04/18 11:48:20 espie Exp $
@


1.3
log
@prepare xview for libc changes.
xview is abusing FILE, by making its own in order to coerce vfscanf to
give it stuff it shouldn't.

This is absolutely awful code. The clean way would be to duplicate the
vfscanf code there.  But hey, C doesn't have stringstreams, so it must
suffer.

Fix independently reinvented, looks a lot like NetBSD's.
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
+++ lib/libxview/textsw/txt_again.c	Sun Apr 17 23:59:11 2005
d13 1
a13 1
@@@@ -182,6 +184,7 @@@@ textsw_string_min_free(ptr_to_string, mi
@


1.2
log
@Regen patches with recent update-patches.
@
text
@d1 3
a3 2
--- lib/libxview/textsw/txt_again.c.orig	1993-06-29 07:17:32.000000000 +0200
+++ lib/libxview/textsw/txt_again.c	2003-12-30 01:31:13.000000000 +0100
d62 1
a62 1
@@@@ -705,6 +735,39 @@@@ va_dcl
d86 1
a90 2
+    _strbuf._ub._base = NULL;
+    _strbuf._lb._base = NULL;
@


1.1
log
@Initial revision
@
text
@d1 2
a2 2
--- ./lib/libxview/textsw/txt_again.c.orig	Tue Jun 29 07:17:32 1993
+++ ./lib/libxview/textsw/txt_again.c	Sat Apr  1 18:25:29 2000
@


1.1.1.1
log
@Xview's return.
Cleaned up so that lib depends on config:build, and lndir it
instead of mucking with the source dir.

All patches put into config/patches, separated and renamed
(yes, this is a LARGE fucker).

Fake

xview/clients to come.

Currently installs under /usr/X11R6, some more patches to X needed to fix
that.

@
text
@@
