head	1.3;
access;
symbols
	OPENBSD_5_7:1.2.0.4
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.2
	OPENBSD_5_6_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2015.05.24.07.16.31;	author ajacoutot;	state dead;
branches;
next	1.2;
commitid	ppIzpTyUJwYSsnNW;

1.2
date	2014.05.05.08.34.08;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2014.04.28.17.35.35;	author brad;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to vlc-2.2.1.

from brad (maintainer)
@
text
@$OpenBSD: patch-src_audio_output_common_c,v 1.2 2014/05/05 08:34:08 brad Exp $

Deal with newer FFmpeg API.

--- src/audio_output/common.c.orig	Thu Apr 24 22:10:46 2014
+++ src/audio_output/common.c	Thu Apr 24 22:11:25 2014
@@@@ -650,6 +650,42 @@@@ void aout_ChannelReorder( uint8_t *p_buf, int i_buffer
     }
 }
 
+/**
+ * Interleaves audio samples within a block of samples.
+ * \param dst destination buffer for interleaved samples
+ * \param src source buffer with consecutive planes of samples
+ * \param samples number of samples (per channel/per plane)
+ * \param chans channels/planes count
+ * \param fourcc sample format (must be a linear sample format)
+ * \note The samples must be naturally aligned in memory.
+ * \warning Destination and source buffers MUST NOT overlap.
+ */
+void aout_Interleave( void *restrict dst, const void *restrict src,
+                      unsigned samples, unsigned chans, vlc_fourcc_t fourcc )
+{
+#define INTERLEAVE_TYPE(type) \
+do { \
+    type *d = dst; \
+    const type *s = src; \
+    for( size_t i = 0; i < chans; i++ ) { \
+        for( size_t j = 0, k = 0; j < samples; j++, k += chans ) \
+            d[k] = *(s++); \
+        d++; \
+    } \
+} while(0)
+
+    switch( fourcc )
+    {
+        case VLC_CODEC_U8:   INTERLEAVE_TYPE(uint8_t);  break;
+        case VLC_CODEC_S16N: INTERLEAVE_TYPE(uint16_t); break;
+        case VLC_CODEC_FL32: INTERLEAVE_TYPE(float);    break;
+        case VLC_CODEC_S32N: INTERLEAVE_TYPE(int32_t);  break;
+        case VLC_CODEC_FL64: INTERLEAVE_TYPE(double);   break;
+        default:             assert(0);
+    }
+#undef INTERLEAVE_TYPE
+}
+
 /*****************************************************************************
  * aout_ChannelExtract:
  *****************************************************************************/
@


1.2
log
@Add a comment to the top of the patches.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_audio_output_common_c,v 1.1 2014/04/28 17:35:35 brad Exp $
@


1.1
log
@Update VLC's avcodec plugin to use the avcodec_decode_audio4() API for decoding
audio.

ok ajacoutot@@
@
text
@d1 4
a4 1
$OpenBSD$
@

