head	1.1;
access;
symbols
	OPENBSD_5_3:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2013.06.13.14.50.27;	author ajacoutot;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2013.06.13.14.50.27;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-dbus_dbus-sysdeps-win_c was initially added on branch OPENBSD_5_3.
@
text
@@


1.1.2.1
log
@CVE-2013-2168: Fix misuse of va_list that could be used as a denial of
service for system services.
@
text
@a0 34
$OpenBSD$

From 954d75b2b64e4799f360d2a6bf9cff6d9fee37e7 Mon Sep 17 00:00:00 2001
From: Simon McVittie <simon.mcvittie@@collabora.co.uk>
Date: Mon, 10 Jun 2013 17:06:47 +0000
Subject: CVE-2013-2168: _dbus_printf_string_upper_bound: copy the va_list for each use

--- dbus/dbus-sysdeps-win.c.orig	Fri Sep 28 21:17:25 2012
+++ dbus/dbus-sysdeps-win.c	Thu Jun 13 16:45:19 2013
@@@@ -538,9 +538,12 @@@@ int _dbus_printf_string_upper_bound (const char *forma
   char buf[1024];
   int bufsize;
   int len;
+  va_list args_copy;
 
   bufsize = sizeof (buf);
-  len = _vsnprintf (buf, bufsize - 1, format, args);
+  DBUS_VA_COPY (args_copy, args);
+  len = _vsnprintf (buf, bufsize - 1, format, args_copy);
+  va_end (args_copy);
 
   while (len == -1) /* try again */
     {
@@@@ -553,7 +556,9 @@@@ int _dbus_printf_string_upper_bound (const char *forma
       if (p == NULL)
         return -1;
 
-      len = _vsnprintf (p, bufsize - 1, format, args);
+      DBUS_VA_COPY (args_copy, args);
+      len = _vsnprintf (p, bufsize - 1, format, args_copy);
+      va_end (args_copy);
       free (p);
     }
 
@

