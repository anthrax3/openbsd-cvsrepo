head	1.13;
access;
symbols
	OPENBSD_5_7:1.12.0.6
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.12.0.4
	OPENBSD_5_6_BASE:1.12
	OPENBSD_5_5:1.12.0.2
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.11.0.4
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.2
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.10.0.4
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.2
	OPENBSD_5_0:1.7.0.2
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.6.0.2
	OPENBSD_4_9_BASE:1.6;
locks; strict;
comment	@ * @;


1.13
date	2015.04.04.09.18.54;	author ajacoutot;	state dead;
branches;
next	1.12;
commitid	ASfg8cnNcfyvsjWM;

1.12
date	2013.08.10.15.47.06;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2013.01.01.14.36.11;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2011.12.20.14.27.46;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2011.10.29.14.37.43;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2011.08.31.15.09.33;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2011.06.03.16.51.23;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2010.12.27.14.50.24;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2010.12.16.07.13.59;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2010.12.14.18.45.54;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.12.01.19.57.52;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.10.29.12.54.44;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.10.28.21.10.07;	author robert;	state Exp;
branches;
next	;


desc
@@


1.13
log
@Subpackage dbus into -main and -suid (which contains the
dbus-daemon-launch-helper setuid helper binary).
Applications installing files under /usr/local/share/dbus-1/system-services/
*must* now RUN_DEPENDS on x11/dbus,-suid.
This was requested by reyk@@ some time ago.

While here, rename the rc scrip to "messagebus" which is what upstream
recommends.
discussed with landry@@ and jasper@@

Bump and dependency changes coming in a few...
@
text
@#!/bin/sh
#
# $OpenBSD: dbus_daemon.rc,v 1.12 2013/08/10 15:47:06 ajacoutot Exp $

daemon="${TRUEPREFIX}/bin/dbus-daemon --system"

. /etc/rc.d/rc.subr

rc_pre() {
	[ ! -h /var/db/dbus/machine-id ] && \
		ln -sf ${SYSCONFDIR}/machine-id /var/db/dbus/machine-id
	rm -f /var/run/dbus/pid
	install -d -o _dbus -g _dbus /var/run/dbus
}

rc_cmd $1
@


1.12
log
@Remove compat glue.
@
text
@d3 1
a3 1
# $OpenBSD: dbus_daemon.rc,v 1.11 2013/01/01 14:36:11 ajacoutot Exp $
@


1.11
log
@Install the unique machine identifier file under /etc/machine-id and add
a /var/db/dbus/machine-id symlink pointing to it. /etc/machine-id is the
"new" path to store this data nowadays.
@
text
@d3 1
a3 1
# $OpenBSD: dbus_daemon.rc,v 1.10 2011/12/20 14:27:46 ajacoutot Exp $
a9 3
	# XXX remove after OPENBSD_5_4 is branched
	[ -f /var/db/dbus/machine-id -a ! -h /var/db/dbus/machine-id ] && \
		mv /var/db/dbus/machine-id ${SYSCONFDIR}/machine-id
@


1.10
log
@Add --system to daemon instead of daemon_flags to make it mandatory.
While here make sure the pid file is not around anymore on startup
(which can happen after a crash and prevent DBus from starting again).
@
text
@d3 1
a3 1
# $OpenBSD: dbus_daemon.rc,v 1.9 2011/10/29 14:37:43 ajacoutot Exp $
d10 5
@


1.9
log
@Tweak rc script and don't try to install under /var/... we already sample
it.
@
text
@d3 1
a3 1
# $OpenBSD: dbus_daemon.rc,v 1.8 2011/08/31 15:09:33 ajacoutot Exp $
d5 1
a5 2
daemon="${TRUEPREFIX}/bin/dbus-daemon"
daemon_flags="--system"
d10 1
@


1.8
log
@Fix comment.
@
text
@d3 1
a3 1
# $OpenBSD: dbus_daemon.rc,v 1.7 2011/06/03 16:51:23 ajacoutot Exp $
a10 4
	# XXX remove after 5.1 is branched
	[ -f ${SYSCONFDIR}/dbus-1/machine-id ] && \
		mv ${SYSCONFDIR}/dbus-1/machine-id /var/db/dbus/
	rm -f /var/run/dbus/pid
@


1.7
log
@Bugfix update to dbus-1.4.10.
@
text
@d3 1
a3 1
# $OpenBSD: dbus_daemon.rc,v 1.6 2010/12/27 14:50:24 ajacoutot Exp $
d11 1
a11 1
	# XXX remove after 5.0
@


1.6
log
@Simplify after recent rc.subr change.
The framework is now stable and we will start documenting it (at last).
@
text
@d3 1
a3 1
# $OpenBSD: dbus_daemon.rc,v 1.5 2010/12/16 07:13:59 ajacoutot Exp $
d11 3
@


1.5
log
@There seems to be an annoying runtime regression with session bus after
the last update which I failed to see in my tests.
While this is being worked on, let's revert for now so that people don't
run into it. Other parts of the D-DBus gang update are fine (glib and
python). Also keep the recent rc script tweak.

Sorry about that...
@
text
@d3 1
a3 3
# $OpenBSD: dbus_daemon.rc,v 1.3 2010/12/01 19:57:52 ajacoutot Exp $

. /etc/rc.d/rc.subr
d7 2
@


1.4
log
@It makes more sense to deal with the pidfile in pre, not post.
@
text
@@


1.3
log
@Quiet up rc_post.
@
text
@d3 1
a3 1
# $OpenBSD: dbus_daemon.rc,v 1.2 2010/10/29 12:54:44 ajacoutot Exp $
d11 1
a12 4
}

rc_post() {
	rm -f /var/run/dbus/pid
@


1.2
log
@Add RCS IDs to rc scripts.
@
text
@d3 1
a3 1
# $OpenBSD$
d15 1
a15 1
	rm /var/run/dbus/pid
@


1.1
log
@After discussion with $french and $german, we are renaming the rc scripts from
dash to underscore so that we are consitent with the foo_bar_flags
variable.
@
text
@d2 2
@

