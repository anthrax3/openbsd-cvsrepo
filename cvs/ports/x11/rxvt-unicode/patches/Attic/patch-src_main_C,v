head	1.6;
access;
symbols
	OPENBSD_5_0:1.5.0.2
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.3.0.2
	OPENBSD_4_9_BASE:1.3;
locks; strict;
comment	@# @;


1.6
date	2011.12.22.11.29.33;	author dcoppa;	state dead;
branches;
next	1.5;

1.5
date	2011.07.05.15.08.49;	author dcoppa;	state Exp;
branches;
next	1.4;

1.4
date	2011.05.25.07.53.07;	author dcoppa;	state Exp;
branches;
next	1.3;

1.3
date	2010.12.23.08.45.57;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2010.12.01.07.33.05;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2010.11.25.13.19.36;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to rxvt-unicode-9.14.

From maintainer Levai Daniel with tweaks by me
@
text
@$OpenBSD: patch-src_main_C,v 1.5 2011/07/05 15:08:49 dcoppa Exp $

Fix a bug causing artifacts at the bottom of the screen when using
rxvt-unicode without hints
(From: https://awesome.naquadah.org/wiki/Urxvt_Hints)

--- src/main.C.orig	Mon May  2 11:42:28 2011
+++ src/main.C	Mon May 23 16:34:12 2011
@@@@ -708,6 +708,8 @@@@ rxvt_term::window_calc (unsigned int newwidth, unsigne
 
   ncol = width  / fwidth;
   nrow = height / fheight;
+  width = ncol * fwidth;
+  height = nrow * fheight;
 }
 
 /*----------------------------------------------------------------------*/
@


1.5
log
@Update to rxvt-unicode-9.12

Many thanks to Emanuele Giaquinta (upstream developer) for his
prompt collaboration.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_C,v 1.4 2011/05/25 07:53:07 dcoppa Exp $
@


1.4
log
@Update to rxvt-unicode-9.11

tested/ok Levai Daniel (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_C,v 1.3 2010/12/23 08:45:57 dcoppa Exp $
d3 1
a3 1
Fix a bug causing artifacts on the bottom of the screen when using
@


1.3
log
@Bugfix update to rxvt-unicode-9.10
@
text
@d1 9
a9 49
$OpenBSD: patch-src_main_C,v 1.2 2010/12/01 07:33:05 dcoppa Exp $
--- src/main.C.orig	Mon Dec 13 17:37:52 2010
+++ src/main.C	Thu Dec 23 09:34:09 2010
@@@@ -80,7 +80,7 @@@@ rxvt_set_locale (const char *locale) NOTHROW
 void
 rxvt_push_locale (const char *locale) NOTHROW
 {
-  strcpy (savelocale, curlocale);
+  strlcpy (savelocale, curlocale, sizeof(savelocale));
   rxvt_set_locale (locale);
 }
 
@@@@ -402,14 +402,16 @@@@ print_x_error (Display *dpy, XErrorEvent *event)
     rxvt_warn ("An X Error occurred, trying to continue after report.\n");
     rxvt_warn ("%s:  %s\n", mesg, buffer);
     XGetErrorDatabaseText(dpy, mtype, "MajorCode", "Request Major code %d", mesg, BUFSIZ);
-    rxvt_warn (strncat (mesg, "\n", BUFSIZ), event->request_code);
-    sprintf(number, "%d", event->request_code);
+    strlcat (mesg, "\n", sizeof (mesg));
+    rxvt_warn (mesg, event->request_code);
+    snprintf (number, sizeof (number), "%d", event->request_code);
     XGetErrorDatabaseText(dpy, "XRequest", number, "", buffer, BUFSIZ);
     rxvt_warn ("(which is %s)\n", buffer);
     if (event->request_code >= 128) {
         XGetErrorDatabaseText(dpy, mtype, "MinorCode", "Request Minor code %d",
                               mesg, BUFSIZ);
-        rxvt_warn (strncat (mesg, "\n", BUFSIZ), event->minor_code);
+        strlcat (mesg, "\n", BUFSIZ);
+        rxvt_warn (mesg, event->minor_code);
     }
     if ((event->error_code == BadWindow) ||
                (event->error_code == BadPixmap) ||
@@@@ -430,11 +432,13 @@@@ print_x_error (Display *dpy, XErrorEvent *event)
         else
             XGetErrorDatabaseText(dpy, mtype, "ResourceID", "ResourceID 0x%x",
                                   mesg, BUFSIZ);
-        rxvt_warn (strncat (mesg, "\n", BUFSIZ), event->resourceid);
+        strlcat (mesg, "\n", BUFSIZ);
+        rxvt_warn (mesg, event->resourceid);
     }
     XGetErrorDatabaseText(dpy, mtype, "ErrorSerial", "Error Serial #%d",
                           mesg, BUFSIZ);
-    rxvt_warn (strncat (mesg, "\n", BUFSIZ), event->serial);
+    strlcat (mesg, "\n", BUFSIZ);
+    rxvt_warn (mesg, event->serial);
 }
 #endif
 
@@@@ -717,6 +721,8 @@@@ rxvt_term::window_calc (unsigned int newwidth, unsigne
a17 81
@@@@ -962,26 +968,26 @@@@ rxvt_term::set_colorfgbg ()
   const char *xpmb = "";
   char fstr[sizeof ("default") + 1], bstr[sizeof ("default") + 1];
 
-  strcpy (fstr, "default");
-  strcpy (bstr, "default");
+  strlcpy (fstr, "default", sizeof (fstr));
+  strlcpy (bstr, "default", sizeof (bstr));
   for (i = Color_Black; i <= Color_White; i++)
     if (pix_colors[Color_fg] == pix_colors[i])
       {
-        sprintf (fstr, "%d", (i - Color_Black));
+        snprintf (fstr, sizeof (fstr), "%d", (i - Color_Black));
         break;
       }
 
   for (i = Color_Black; i <= Color_White; i++)
     if (pix_colors[Color_bg] == pix_colors[i])
       {
-        sprintf (bstr, "%d", (i - Color_Black));
+        snprintf (bstr, sizeof (bstr), "%d", (i - Color_Black));
 #ifdef BG_IMAGE_FROM_FILE
         xpmb = "default;";
 #endif
         break;
       }
 
-  sprintf (env_colorfgbg, "COLORFGBG=%s;%s%s", fstr, xpmb, bstr);
+  snprintf (env_colorfgbg, sizeof (env_colorfgbg), "COLORFGBG=%s;%s%s", fstr, xpmb, bstr);
 }
 
 /*----------------------------------------------------------------------*/
@@@@ -1182,8 +1188,8 @@@@ rxvt_term::IMisRunning ()
   /* get current locale modifier */
   if (char *p = XSetLocaleModifiers (0))
     {
-      strcpy (server, "@@server=");
-      strncat (server, p + 4, IMBUFSIZ - 9); /* skip "@@im=" */
+      strlcpy (server, "@@server=", sizeof (server));
+      strlcat (server, p + 4, sizeof (server)); /* skip "@@im=" */
 
       if (p = strchr (server + 1, '@@'))      /* first one only */
         *p = '\0';
@@@@ -1412,16 +1418,16 @@@@ foundpet:
       char *def_string;
       char pat[512];
 
-      sprintf (pat,
-               "-*-*-*-R-*-*-%d-*-*-*-*-*-*,"
-               "-*-*-*-R-*-*-%d-*-*-*-*-*-*,"
-               "-*-*-*-R-*-*-%d-*-*-*-*-*-*,"
-               "-*-*-*-R-*-*-%d-*-*-*-*-*-*,"
-               "-*-*-*-R-*-*-%d-*-*-*-*-*-*,"
-               "*",
-               fheight,
-               fheight + 1, fheight - 1,
-               fheight - 2, fheight + 2);
+      snprintf (pat, sizeof (pat),
+                "-*-*-*-R-*-*-%d-*-*-*-*-*-*,"
+                "-*-*-*-R-*-*-%d-*-*-*-*-*-*,"
+                "-*-*-*-R-*-*-%d-*-*-*-*-*-*,"
+                "-*-*-*-R-*-*-%d-*-*-*-*-*-*,"
+                "-*-*-*-R-*-*-%d-*-*-*-*-*-*,"
+                "*",
+                fheight,
+                fheight + 1, fheight - 1,
+                fheight - 2, fheight + 2);
 
       fs = XCreateFontSet (dpy, rs[Rs_imFont] ? rs[Rs_imFont] : pat,
                            &missing_charset_list, &missing_charset_count, &def_string);
@@@@ -1560,8 +1566,8 @@@@ rxvt_term::im_cb ()
         {
           if (*s[i])
             {
-              strcpy (buf, "@@im=");
-              strncat (buf, s[i], IMBUFSIZ - 5);
+              strlcpy (buf, "@@im=", sizeof (buf));
+              strlcat (buf, s[i], sizeof (buf));
               if (IM_get_IC (buf))
                 {
                   found = true;
@


1.2
log
@Fix a problem of getting artifacts on the bottom of the screen when
using rxvt-unicode without hints.

From awesome wm wiki, via jasper@@
@
text
@d1 3
a3 3
$OpenBSD: patch-src_main_C,v 1.1 2010/11/25 13:19:36 dcoppa Exp $
--- src/main.C.orig	Wed Nov  3 22:00:52 2010
+++ src/main.C	Wed Dec  1 08:18:19 2010
d13 1
a13 1
@@@@ -390,14 +390,16 @@@@ print_x_error (Display *dpy, XErrorEvent *event)
d33 1
a33 1
@@@@ -418,11 +420,13 @@@@ print_x_error (Display *dpy, XErrorEvent *event)
d49 1
a49 1
@@@@ -705,6 +709,8 @@@@ rxvt_term::window_calc (unsigned int newwidth, unsigne
d58 1
a58 1
@@@@ -950,26 +956,26 @@@@ rxvt_term::set_colorfgbg ()
d90 1
a90 1
@@@@ -1170,8 +1176,8 @@@@ rxvt_term::IMisRunning ()
d101 1
a101 1
@@@@ -1400,16 +1406,16 @@@@ foundpet:
d128 1
a128 1
@@@@ -1548,8 +1554,8 @@@@ rxvt_term::im_cb ()
@


1.1
log
@Update to rxvt-unicode-9.09

From LEVAI Daniel, with tweaks by me.
He's also the new maintainer of this port.
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
+++ src/main.C	Sun Nov 14 15:04:04 2010
d49 10
a58 1
@@@@ -950,26 +954,26 @@@@ rxvt_term::set_colorfgbg ()
d90 1
a90 1
@@@@ -1170,8 +1174,8 @@@@ rxvt_term::IMisRunning ()
d101 1
a101 1
@@@@ -1400,16 +1404,16 @@@@ foundpet:
d128 1
a128 1
@@@@ -1548,8 +1552,8 @@@@ rxvt_term::im_cb ()
@

