head	1.9;
access;
symbols
	OPENBSD_5_9:1.7.0.2
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_2:1.2.0.4
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.2;
locks; strict;
comment	@# @;


1.9
date	2016.03.01.10.13.57;	author dcoppa;	state dead;
branches;
next	1.8;
commitid	hwJ0JPO3A0Sgrv9D;

1.8
date	2016.02.26.13.20.32;	author dcoppa;	state Exp;
branches;
next	1.7;
commitid	sJdA3HuQmfFuvUtn;

1.7
date	2016.01.29.11.56.31;	author dcoppa;	state Exp;
branches;
next	1.6;
commitid	alzXhbKmYV3C511k;

1.6
date	2013.11.08.06.57.49;	author dcoppa;	state dead;
branches;
next	1.5;

1.5
date	2013.09.27.15.56.40;	author dcoppa;	state Exp;
branches;
next	1.4;

1.4
date	2012.12.28.12.12.38;	author sthen;	state dead;
branches;
next	1.3;

1.3
date	2012.08.29.14.45.36;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2012.01.23.08.10.41;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2011.12.22.11.29.33;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.9
log
@
Switch to the proper Makefile-goo
@
text
@$OpenBSD: patch-libev_ev_c,v 1.8 2016/02/26 13:20:32 dcoppa Exp $

Unbreak build on arm

--- libev/ev.c.orig	Fri Jan 29 11:39:26 2016
+++ libev/ev.c	Fri Jan 29 11:42:26 2016
@@@@ -191,7 +191,7 @@@@
 # undef ECB_NO_THREADS
 # define ECB_NO_THREADS 1
 #endif
-#if EV_NO_SMP
+#if defined(EV_NO_SMP) || defined(__arm__) || defined (__sparc__)
 # undef EV_NO_SMP
 # define ECB_NO_SMP 1
 #endif
@


1.8
log
@
Unbreak on sparc, no multiprocessor support like on arm
@
text
@d1 1
a1 1
$OpenBSD: patch-libev_ev_c,v 1.7 2016/01/29 11:56:31 dcoppa Exp $
@


1.7
log
@
Unbreak build on arm (as usual, EV_NO_SMP)
@
text
@d1 1
a1 1
$OpenBSD$
d12 1
a12 1
+#if defined(EV_NO_SMP) || defined(__arm__)
@


1.6
log
@Update to rxvt-unicode-9.19
@
text
@d1 14
a14 15
$OpenBSD: patch-libev_ev_c,v 1.5 2013/09/27 15:56:40 dcoppa Exp $
--- libev/ev.c.orig	Fri Sep 27 17:51:03 2013
+++ libev/ev.c	Fri Sep 27 17:51:20 2013
@@@@ -637,6 +637,12 @@@@ struct signalfd_siginfo
       #define ECB_MEMORY_FENCE_RELEASE __asm__ __volatile__ ("")
     #elif defined __ia64__
       #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("mf"       : : : "memory")
+    #elif defined __m68k__
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ (""         : : : "memory")
+    #elif defined __m88k__
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("tb1 0,%%r0,128" : : : "memory")
+    #elif defined __sh__
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ (""         : : : "memory")
     #endif
   #endif
a15 10
@@@@ -1053,6 +1059,9 @@@@ ecb_inline ecb_bool ecb_little_endian (void) { return 
     || defined __alpha__ \
     || defined __hppa__ \
     || defined __ia64__ \
+    || defined __m68k__ \
+    || defined __m88k__ \
+    || defined __sh__ \
     || defined _M_IX86 || defined _M_AMD64 || defined _M_IA64
   #define ECB_STDFP 1
   #include <string.h> /* for memcpy */
@


1.5
log
@sync bundled libev with devel/libev (miod's patch to add support
for m68k, m88k and sh)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.4
log
@update to urxvt 9.16, from maintainer LEVAI Daniel, tests/ok dcoppa@@ abieber@@
@
text
@d1 13
a13 15
$OpenBSD: patch-libev_ev_c,v 1.3 2012/08/29 14:45:36 dcoppa Exp $
--- libev/ev.c.orig	Thu Jan 19 18:55:00 2012
+++ libev/ev.c	Wed Aug 29 10:04:02 2012
@@@@ -562,6 +562,14 @@@@ struct signalfd_siginfo
       #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("membar #LoadStore | #LoadLoad | #StoreStore | #StoreLoad | " : : : "memory")
       #define ECB_MEMORY_FENCE_ACQUIRE __asm__ __volatile__ ("membar #LoadStore | #LoadLoad" : : : "memory")
       #define ECB_MEMORY_FENCE_RELEASE __asm__ __volatile__ ("membar #LoadStore |             #StoreStore")
+    #elif defined(__s390__) || defined(__s390x__)
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("bcr 15,0" : : : "memory")
+    #elif defined(__mips__)
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("sync" : : : "memory")
+    #elif defined(__alpha__)
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("mb" : : : "memory")
+    #elif defined(__hppa__)
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("sync" : : : "memory")
d17 10
@


1.3
log
@Remove ugly workaround and sync internal libenv with devel/libenv

Maintainer's ok
@
text
@d1 1
a1 1
$OpenBSD: patch-libev_ev_c,v 1.2 2012/01/23 08:10:41 dcoppa Exp $
@


1.2
log
@Bugfix update to rxvt-unicode-9.15

ok maintainer
ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-libev_ev_c,v 1.1 2011/12/22 11:29:33 dcoppa Exp $
d3 15
a17 6
+++ libev/ev.c	Sun Jan 22 18:04:25 2012
@@@@ -921,7 +921,6 @@@@ ecb_function_ ecb_bool ecb_little_endian (void) { retu
  * alternatively, you can remove this #error and link against libpthread,
  * which will then provide the memory fences.
  */
-# error "memory fences not defined for your architecture, please report"
a18 2
 
 #ifndef ECB_MEMORY_FENCE
@


1.1
log
@Update to rxvt-unicode-9.14.

From maintainer Levai Daniel with tweaks by me
@
text
@d1 4
a4 4
$OpenBSD$
--- libev/ev.c.orig	Thu Dec 22 10:54:44 2011
+++ libev/ev.c	Thu Dec 22 10:55:30 2011
@@@@ -882,7 +882,6 @@@@ ecb_function_ ecb_bool ecb_little_endian (void) { retu
@

