head	1.4;
access;
symbols
	OPENBSD_6_2:1.4.0.2
	OPENBSD_6_2_BASE:1.4
	OPENBSD_6_1:1.2.0.6
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.4
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.1.0.24
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.20
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.18
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.16
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.14
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.12
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.10
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.8
	OPENBSD_5_0:1.1.0.6
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.4
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2017.04.17.08.49.23;	author sthen;	state Exp;
branches;
next	1.3;
commitid	Fe7zYsf4DF5TXUoS;

1.3
date	2017.04.16.12.43.20;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	63W5LV3b3zfwkOvg;

1.2
date	2015.10.20.13.38.35;	author dcoppa;	state Exp;
branches;
next	1.1;
commitid	jYEhRDrfWXXMJRnz;

1.1
date	2010.04.13.16.28.44;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.4
log
@revert previous; xdm mention was in a line which was removed in the patch
@
text
@$OpenBSD: patch-exec_xlogout,v 1.2 2015/10/20 13:38:35 dcoppa Exp $

fix xlogout script on OpenBSD
use some sane defaults for X session names: that's a best effort 
task :-)

--- exec/xlogout.orig	Tue Apr 13 12:58:08 2010
+++ exec/xlogout	Tue Apr 13 13:00:31 2010
@@@@ -1,49 +1,5 @@@@
-#!/bin/bash
+#!/bin/sh
 
-# xlogout - logs user out of its X session
-# Linux specific since uses /proc
+XSESS=$(pgrep -U `id -u` -f '(Xsession|cwm|fvwm|gnome-session|openbox|openbox-session|startkde|xfce4-session|xinit|xinitrc|xsession)')
 
-# get display name without screen number
-[ -z "$DISPLAY" ] && exit 1
-DPY=${DISPLAY:1}
-DPY=${DPY/.*/}
-echo "DPY=${DPY}"
-
-# get X pid
-XPID=`< /tmp/.X${DPY}-lock`
-XPID=`echo $XPID`
-echo "XPID=$XPID"
-
-# get pid of xdm (or gdm, kdm, etc). usually it's parent of X
-XDMPID=`ps -o ppid --pid=$XPID | awk '{if (FNR != 1) print $1}'`
-echo "XDMPID=$XDMPID"
-
-# recursivly find child of xdm that was started in home dir - 
-# it's user's session start up script
-function pid_scan()
-{
-
-    rm -f $PF
-    while [ $# != 0 ]; do
-        ps --no-headers -o pid --ppid=$1 >> $PF
-        shift
-    done
-    for pid in `< $PF`; do
-        if cwd=`ls -al /proc/$pid/cwd 2>/dev/null`; then
-            cwd=`sed 's/.*-> //' <<< $cwd`
-            [ "$cwd" == "$HOME" ] && echo $pid && return
-        fi
-    done
-    pids=`< $PF`
-    [ -n "$pids" ] && pid_scan `< $PF`;
-}
-
-PF=/tmp/$$-pids
-SPID=`pid_scan $XDMPID`
-rm -f $PF
-
-[ -z "$SPID" ] && exit 1
-echo "Session start up script"
-ps -o uid,pid,ppid,sess,cmd --pid $SPID
-kill -SIGTERM -$SPID
-
+for pid in ${XSESS} ; do kill ${pid} ; done
@


1.3
log
@xdm -> xenodm.
@
text
@d32 1
a32 1
-# recursivly find child of xenodm that was started in home dir - 
@


1.2
log
@
Various bugfixes and enhancements.
Didn't touch this port for a long time...
@
text
@d1 1
a1 1
$OpenBSD: patch-exec_xlogout,v 1.1 2010/04/13 16:28:44 dcoppa Exp $
d32 1
a32 1
-# recursivly find child of xdm that was started in home dir - 
@


1.1
log
@Update to 6.0 and add myself as MAINTAINER

OK landry@@, ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD$
d15 1
a15 1
+XSESS=$(pgrep -U `id -u` -f '(Xsession|cwm|fvwm|gnome-session|startkde|xfce4-session|xinit|xinitrc|xsession)')
@

