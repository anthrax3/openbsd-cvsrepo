head	1.5;
access;
symbols
	OPENBSD_6_1:1.3.0.2
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.2.0.2
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.1.1.1.0.2
	OPENBSD_5_9_BASE:1.1.1.1
	zhuk_20160103:1.1.1.1
	zhuk:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2017.05.29.08.28.02;	author espie;	state Exp;
branches;
next	1.4;
commitid	FDXa1pVonoDQLmJc;

1.4
date	2017.04.10.11.46.36;	author sthen;	state Exp;
branches;
next	1.3;
commitid	HY6VNZxjJWzKQFDV;

1.3
date	2016.12.25.14.34.40;	author zhuk;	state Exp;
branches;
next	1.2;
commitid	l6KSNN1DfB6ABkhu;

1.2
date	2016.03.18.23.12.21;	author naddy;	state Exp;
branches;
next	1.1;
commitid	KZAl4KEiw6a3Jixw;

1.1
date	2016.01.03.16.42.15;	author zhuk;	state Exp;
branches
	1.1.1.1;
next	;
commitid	VZxs4OxkxzuHw3dc;

1.1.1.1
date	2016.01.03.16.42.15;	author zhuk;	state Exp;
branches;
next	;
commitid	VZxs4OxkxzuHw3dc;


desc
@@


1.5
log
@somehow, my previous builds if polkit-qt,qt5 always managed to find a
libestdc++ on the machine.  I guess that I've now removed enough gcc
that this becomes obviously wrong. fix for clang.
@
text
@# $OpenBSD: Makefile,v 1.4 2017/04/10 11:46:36 sthen Exp $

COMMENT=	PolicyKit authentication agent for Qt

V=		0.112.0
DISTNAME=	polkit-qt-1-${V}
REVISION=	3

SHARED_LIBS +=  polkit-qt-agent-1         2.0 # 0.99
SHARED_LIBS +=  polkit-qt-core-1          2.0 # 0.99
SHARED_LIBS +=  polkit-qt-gui-1           2.0 # 0.99
# XXX keep versions below in sync with above, due to patch-PolkitQt-1Config_cmake_in
SHARED_LIBS +=  polkit-qt5-agent-1        2.0 # 0.99
SHARED_LIBS +=  polkit-qt5-core-1         2.0 # 0.99
SHARED_LIBS +=  polkit-qt5-gui-1          2.0 # 0.99

CATEGORIES=	x11 sysutils

EXTRACT_SUFX=	.tar.bz2

HOMEPAGE=	http://techbase.kde.org/Polkit-Qt-1

MAINTAINER=	Antoine Jacoutot <ajacoutot@@openbsd.org>

# LGPLv2+
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += gio-2.0 glib-2.0 gmodule-2.0 gobject-2.0
WANTLIB += gthread-2.0 m polkit-agent-1 polkit-gobject-1

MASTER_SITES=	${MASTER_SITE_KDE:=stable/apps/KDE4.x/admin/}

FLAVORS=	qt5
FLAVOR?=

MODULES=	devel/cmake

BUILD_DEPENDS=	devel/automoc

LIB_DEPENDS=	sysutils/polkit

# polkit(8) almost always needs to know the "active" session
RUN_DEPENDS +=	sysutils/consolekit

CONFIGURE_ARGS= -DCMAKE_SHARED_LINKER_FLAGS:STRING="-L${LOCALBASE}/lib"

#
# We use PKGSTEM+CMAKESTEM instead of simple QT5=5 because otherwise
# update-plist will fail in both qt4 and qt5 cases:
#  * for qt4 it'll drop ${QT5} from plist;
#  * for qt5 it'll use ${FLAVORS} instead, see the
#    PKG_ARGS+=-DFLAVORS=${FLAVOR_EXT:Q} line in bsd.port.mk.
#

.if ${FLAVOR:Mqt5}
FULLPKGNAME=	polkit-qt5-${V}
MODULES+=	x11/qt5
CONFIGURE_ARGS+=-DUSE_QT5=Yes \
		-DOPENBSD_STDCPP=${OPENBSD_STDCPP}
WANTLIB+=	Qt5Core Qt5DBus Qt5Gui Qt5Widgets
PKGSTEM=	polkit-qt5-
CMAKESTEM=	PolkitQt5-1
.else
FULLPKGNAME=	polkit-qt4-${V}
MODULES+=	x11/qt4
CONFIGURE_ARGS+=-DUSE_QT4=Yes \
		-DOPENBSD_STDCPP=
WANTLIB+=	QtDBus QtGui ${LIBCXX}
PKGSTEM=	polkit-qt-
CMAKESTEM=	PolkitQt-1
.endif

# N.B.: run update-plist with qt4 FLAVOR
SUBST_VARS=	PKGSTEM CMAKESTEM

NO_TEST=	Yes

pre-configure:
	${SUBST_CMD} ${WRKSRC}/PolkitQt-1Config.cmake.in

.include <bsd.port.mk>
.if ${PROPERTIES:Mclang}
OPENBSD_STDCPP = c++ c++abi pthread
.else
OPENBSD_STDCPP = estdc++
.endif
@


1.4
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2016/12/25 14:34:40 zhuk Exp $
d59 1
a59 1
		-DOPENBSD_STDCPP=estdc++
d82 5
@


1.3
log
@Adapt to new x11/qt5 layout, mostly REVISION bumps due to changed deps.

The devel/kf5 to be handled separately, please wait.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2016/03/18 23:12:21 naddy Exp $
d68 1
a68 1
WANTLIB+=	QtDBus QtGui stdc++
@


1.2
log
@remove SHARED_ONLY from ports that only use modules that neither set nor
read this variable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2016/01/03 16:42:15 zhuk Exp $
d7 1
a7 1
REVISION=	2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.18 2015/08/15 11:13:42 ajacoutot Exp $

SHARED_ONLY=	Yes
@


1.1.1.1
log
@Re-import Polkit-Qt. It supports both Qt4 and Qt5 versions now, which
could be built and installed simultaneously from the same sources.
The PKGSTEM+CMAKESTEM variables in SUBST_VARS look like somewhat ugly,
but this way update-plist does its job correctly for default FLAVOR
at least.

One more patch added speficially for Qt5 case, forcing linking to
libestdc++.

While here, added NO_TEST and fixed COMMENT.

Much input & okay aja@@ (MAINTAINER).

Next steps are: switching bulk builds from x11/polkit-qt4 to x11/polkit-qt,
and then removing the former.
@
text
@@
