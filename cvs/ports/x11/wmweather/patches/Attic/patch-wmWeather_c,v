head	1.2;
access;
symbols
	OPENBSD_4_0:1.1.1.1.0.24
	OPENBSD_4_0_BASE:1.1.1.1
	OPENBSD_3_9:1.1.1.1.0.22
	OPENBSD_3_9_BASE:1.1.1.1
	OPENBSD_3_8:1.1.1.1.0.20
	OPENBSD_3_8_BASE:1.1.1.1
	OPENBSD_3_7:1.1.1.1.0.18
	OPENBSD_3_7_BASE:1.1.1.1
	OPENBSD_3_6:1.1.1.1.0.16
	OPENBSD_3_6_BASE:1.1.1.1
	OPENBSD_3_5:1.1.1.1.0.14
	OPENBSD_3_5_BASE:1.1.1.1
	OPENBSD_3_4:1.1.1.1.0.12
	OPENBSD_3_4_BASE:1.1.1.1
	OPENBSD_3_3:1.1.1.1.0.10
	OPENBSD_3_3_BASE:1.1.1.1
	OPENBSD_3_2:1.1.1.1.0.8
	OPENBSD_3_2_BASE:1.1.1.1
	OPENBSD_3_1:1.1.1.1.0.6
	OPENBSD_3_1_BASE:1.1.1.1
	OPENBSD_3_0:1.1.1.1.0.4
	OPENBSD_3_0_BASE:1.1.1.1
	OPENBSD_2_9_TRACKING_SWITCH:1.1.1.1
	OPENBSD_2_9:1.1.1.1.0.2
	OPENBSD_2_9_BASE:1.1.1.1
	naddy_20010109:1.1.1.1
	naddy:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2007.02.04.10.37.58;	author wilfried;	state dead;
branches;
next	1.1;

1.1
date	2001.01.09.22.13.42;	author naddy;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.01.09.22.13.42;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update wmweather to 2.4.3, from Vlad Glagolev with some cleanup from me
@
text
@$OpenBSD: patch-wmWeather_c,v 1.1 2001/01/09 22:13:42 naddy Exp $
--- Src/wmWeather.c.orig	Tue May  4 22:20:04 1999
+++ Src/wmWeather.c	Tue Jan  9 18:54:59 2001
@@@@ -229,12 +229,12 @@@@ char		dir[5];
 int 		Year, Month, Day;
 int		Hours, Mins, Secs;
 int		UpdateLTHour = 0.0, UpdateLTMin = 0.0, UpdateUTHour, UpdateUTMin;
-long		CurrentLocalTime;
+time_t		CurrentLocalTime;
 double		UpdateUT, UpdateLT, UT, LT, DT, hour24();
 
 
 double		jd(), CurrentJD;
-char		command[1024], Line[512], FileName[10];
+char		command[1024], Line[512], FileName[1024];
 int		Tens, q, digit, chr;
 double		Pressure, Temperature, sgn, Humidity, DewPoint, WindChill, val;
 double		Direction, Speed;
@@@@ -416,7 +416,7 @@@@ FILE		*fp;
     	    /*
     	     *  Read in weather data
     	     */
-	    sprintf(FileName, "%s/.wmWeatherReports/%s.dat", getenv("HOME"), StationID);
+	    snprintf(FileName, sizeof(FileName), "%s/.wmWeatherReports/%s.dat", getenv("HOME"), StationID);
     	    if ((fp = fopen(FileName, "r")) != NULL){
 
 	    	fgets(Line, 512, fp);
@@@@ -713,7 +713,7 @@@@ FILE		*fp;
 	            q = 0;
 		    i = (int)(Direction/360.0*16.0 + 0.5);
 		    if (i>15) i = 0;
-		    strcpy(dir, CompassDirection[i]);
+		    strlcpy(dir, CompassDirection[i], sizeof(dir));
 		    len = strlen(dir);
 		    for (j=0; j<len; ++j){
 			digit = (int)dir[j] - 48;
@@@@ -816,7 +816,7 @@@@ UpToDate = 0;
 	    /*
 	     *  Execute Perl script to grab the Latest METAR Report
 	     */
-	    sprintf(command, "GrabWeather %s &", StationID);
+	    snprintf(command, sizeof(command), "GrabWeather %s &", StationID);
 	    system(command);
 
 	    ForceDownload = 0;
@@@@ -868,7 +868,7 @@@@ void ParseCMDLine(int argc, char *argv[]
 		print_usage();
 		exit(-1);
 	    }
-            strcpy(BackColor, argv[++i]);
+            strlcpy(BackColor, argv[++i], sizeof(BackColor));
 
         } else if (!strcmp(argv[i], "-tc")){
 
@@@@ -877,7 +877,7 @@@@ void ParseCMDLine(int argc, char *argv[]
 		print_usage();
 		exit(-1);
 	    }
-            strcpy(StationTimeColor, argv[++i]);
+            strlcpy(StationTimeColor, argv[++i], sizeof(StationTimeColor));
 
         } else if (!strcmp(argv[i], "-lc")){
 
@@@@ -886,7 +886,7 @@@@ void ParseCMDLine(int argc, char *argv[]
 		print_usage();
 		exit(-1);
 	    }
-            strcpy(LabelColor, argv[++i]);
+            strlcpy(LabelColor, argv[++i], sizeof(LabelColor));
 
         } else if (!strcmp(argv[i], "-wgc")){
 
@@@@ -895,7 +895,7 @@@@ void ParseCMDLine(int argc, char *argv[]
 		print_usage();
 		exit(-1);
 	    }
-            strcpy(WindGustColor, argv[++i]);
+            strlcpy(WindGustColor, argv[++i], sizeof(WindGustColor));
 
         } else if (!strcmp(argv[i], "-dc")){
 
@@@@ -904,7 +904,7 @@@@ void ParseCMDLine(int argc, char *argv[]
 		print_usage();
 		exit(-1);
 	    }
-            strcpy(DataColor, argv[++i]);
+            strlcpy(DataColor, argv[++i], sizeof(DataColor));
 
          } else if (!strcmp(argv[i], "-beaufort")){
  
@@@@ -944,7 +944,7 @@@@ void ParseCMDLine(int argc, char *argv[]
 		print_usage();
 		exit(-1);
 	    }
-            strcpy(StationID, StringToUpper(argv[++i]));
+            strlcpy(StationID, StringToUpper(argv[++i]), sizeof(StationID));
 
         } else if (!strcmp(argv[i], "-delay")) {
 
@@@@ -1131,7 +1131,7 @@@@ void ButtonPressEvent(XButtonEvent *xev)
     if (GotDoubleClick1) {
 	GotFirstClick1 = 0;
 	GotDoubleClick1 = 0;
-	sprintf(Command, "xmessage -center -file %s/.wmWeatherReports/%s.TXT &", getenv("HOME"), StationID);
+	snprintf(Command, sizeof(Command), "xmessage -center -file %s/.wmWeatherReports/%s.TXT &", getenv("HOME"), StationID);
 	system(Command);
     }
 
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@Import of wmWeather 1.31.
Submitted by Peter Stromberg <home@@wilfried.net>.

wmWeather monitors local weather conditions (temperature, dew point, pressure,
humidity and wind direction and speed).
@
text
@@
