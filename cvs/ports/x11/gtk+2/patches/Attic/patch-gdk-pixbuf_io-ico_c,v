head	1.1;
access;
symbols
	OPENBSD_3_5:1.1.0.4
	OPENBSD_3_4:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2004.09.30.04.22.54;	author brad;	state dead;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2004.09.30.04.22.54;	author brad;	state Exp;
branches;
next	;

1.1.4.1
date	2004.09.30.04.25.22;	author brad;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-gdk-pixbuf_io-ico_c was initially added on branch OPENBSD_3_4.
@
text
@@


1.1.4.1
log
@fixes a DoS issue with the BMP decoder, integer overflow and heap-based
buffer overflow with the XPM decoder, and integer overflow with the ICO
decoder.

CAN-2004-0753, CAN-2004-0782, CAN-2004-0788
@
text
@a0 18
$OpenBSD$
--- gdk-pixbuf/io-ico.c.orig	2003-06-28 13:04:59.000000000 -0700
+++ gdk-pixbuf/io-ico.c	2004-09-27 09:27:33.000000000 -0700
@@@@ -321,6 +321,14 @@@@ static void DecodeHeader(guchar *Data, g
 	
 	State->HeaderSize+=I;
 	
+	if (State->HeaderSize < 0) {
+		g_set_error (error,
+			     GDK_PIXBUF_ERROR,
+			     GDK_PIXBUF_ERROR_CORRUPT_IMAGE,
+			     _("Invalid header in icon"));
+		return;
+	}
+
  	if (State->HeaderSize>State->BytesInHeaderBuf) {
 	        guchar *tmp=g_try_realloc(State->HeaderBuf,State->HeaderSize);
 		if (!tmp) {
@


1.1.2.1
log
@fixes a DoS issue with the BMP decoder, integer overflow and heap-based
buffer overflow with the XPM decoder, and integer overflow with the ICO
decoder.

CAN-2004-0753, CAN-2004-0782, CAN-2004-0788
@
text
@a0 18
$OpenBSD$
--- gdk-pixbuf/io-ico.c.orig	2003-03-20 16:14:33.000000000 -0800
+++ gdk-pixbuf/io-ico.c	2004-09-27 09:43:30.000000000 -0700
@@@@ -329,6 +329,14 @@@@ static void DecodeHeader(guchar *Data, g
 	
 	State->HeaderSize+=I;
 	
+	if (State->HeaderSize < 0) {
+		g_set_error (error,
+			     GDK_PIXBUF_ERROR,
+			     GDK_PIXBUF_ERROR_CORRUPT_IMAGE,
+			     _("Invalid header in icon"));
+		return;
+	}
+
  	if (State->HeaderSize>State->BytesInHeaderBuf) {
 	        guchar *tmp=g_try_realloc(State->HeaderBuf,State->HeaderSize);
 		if (!tmp) {
@

