head	1.7;
access;
symbols
	OPENBSD_4_4:1.6.0.8
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.6
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.4
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.6.0.2
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.5.0.4
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.2
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.4.0.6
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.4.0.4
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.4.0.2
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.1.1.1.0.2
	OPENBSD_3_5_BASE:1.1.1.1
	jose_2003-nov-19:1.1.1.1
	jose:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2009.01.16.00.02.32;	author sthen;	state dead;
branches;
next	1.6;

1.6
date	2006.10.18.14.27.43;	author naddy;	state Exp;
branches;
next	1.5;

1.5
date	2006.01.08.20.56.08;	author naddy;	state Exp;
branches;
next	1.4;

1.4
date	2004.08.07.06.16.39;	author kevlo;	state Exp;
branches;
next	1.3;

1.3
date	2004.07.03.21.05.52;	author jolan;	state Exp;
branches;
next	1.2;

1.2
date	2004.05.20.21.25.46;	author miod;	state Exp;
branches;
next	1.1;

1.1
date	2003.11.19.15.45.58;	author jose;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.11.19.15.45.58;	author jose;	state Exp;
branches;
next	;


desc
@@


1.7
log
@update to 8.4.19, from new maintainer Stuart Cassoff.
@
text
@$OpenBSD: patch-tcl_m4,v 1.6 2006/10/18 14:27:43 naddy Exp $
--- tcl.m4.orig	Thu Jul 29 23:57:48 2004
+++ tcl.m4	Wed Oct 18 16:08:46 2006
@@@@ -1256,24 +1256,42 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 	    TCL_LIB_VERSIONS_OK=nodots
 	    ;;
 	OpenBSD-*)
-	    SHLIB_LD="${CC} -shared"
-	    SHLIB_LD_LIBS='${LIBS}'
-	    SHLIB_SUFFIX=".so"
-	    DL_OBJS="tclLoadDl.o"
-	    DL_LIBS=""
-	    CC_SEARCH_FLAGS=""
-	    LD_SEARCH_FLAGS=""
-	    AC_MSG_CHECKING(for ELF)
-	    AC_EGREP_CPP(yes, [
+	    case `machine` in
+	    luna88k|mvme88k|vax)
+		SHLIB_CFLAGS=""
+		SHLIB_LD="echo tclLdAout $CC \{$SHLIB_CFLAGS\} | `pwd`/tclsh -r"
+		SHLIB_LD_LIBS='${LIBS}'
+		SHLIB_SUFFIX=".a"
+		DL_OBJS="tclLoadAout.o"
+		DL_LIBS=""
+		LDFLAGS=""
+		CC_SEARCH_FLAGS='-L${LIB_RUNTIME_DIR}'
+		LD_SEARCH_FLAGS=${CC_SEARCH_FLAGS}
+		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.a'
+		;;
+	    *)
+		SHLIB_CFLAGS="-fPIC"
+		SHLIB_LD="${CC} -shared ${SHLIB_CFLAGS}"
+	        SHLIB_LD_LIBS=""
+		SHLIB_SUFFIX=".so"
+		DL_OBJS="tclLoadDl.o"
+		DL_LIBS=""
+		CC_SEARCH_FLAGS='-Wl,-rpath,${LIB_RUNTIME_DIR}'
+		LD_SEARCH_FLAGS=${CC_SEARCH_FLAGS}
+		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.so.${LIBtk84_VERSION}'
+		AC_MSG_CHECKING(for ELF)
+		AC_EGREP_CPP(yes, [
 #ifdef __ELF__
 	yes
 #endif
-	    ],
-		[AC_MSG_RESULT(yes)
-		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.so.1.0'],
-		[AC_MSG_RESULT(no)
-		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.so.1.0']
-	    )
+	        ],
+		    AC_MSG_RESULT(yes)
+		    [ LDFLAGS=-Wl,-export-dynamic ],
+		    AC_MSG_RESULT(no)
+		    LDFLAGS=""
+	        )
+		;;
+	    esac
 
 	    # OpenBSD doesn't do version numbers with dots.
 	    UNSHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.a'
@


1.6
log
@unconditionally use -fPIC; sync patches
@
text
@d1 1
a1 1
$OpenBSD: patch-tcl_m4,v 1.5 2006/01/08 20:56:08 naddy Exp $
@


1.5
log
@SHARED_LIBS
@
text
@d1 4
a4 4
$OpenBSD: patch-tcl_m4,v 1.4 2004/08/07 06:16:39 kevlo Exp $
--- tcl.m4.orig	Sat Aug  7 13:40:15 2004
+++ tcl.m4	Sat Aug  7 13:44:10 2004
@@@@ -1256,24 +1256,48 @@@@ dnl AC_CHECK_TOOL(AR, ar)
d31 1
a31 7
+		# OpenBSD/SPARC[64] needs -fPIC, -fpic will not do.
+		case `machine` in
+		sparc|sparc64)
+		    SHLIB_CFLAGS="-fPIC";;
+		*)
+		    SHLIB_CFLAGS="-fpic";;
+		esac
@


1.4
log
@update to tk 8.4.7
@
text
@d1 1
a1 1
$OpenBSD$
d45 1
a45 1
+		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.so.1.0'
@


1.3
log
@hppa has shared libs now
@
text
@d1 5
a5 5
--- tcl.m4.orig	Mon Mar  1 18:04:48 2004
+++ tcl.m4	Sat Jul  3 14:09:56 2004
@@@@ -1209,7 +1209,7 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 	    CC_SEARCH_FLAGS=""
 	    LD_SEARCH_FLAGS=""
d7 10
a16 16
-	NetBSD-*|FreeBSD-[[1-2]].*|OpenBSD-*)
+	NetBSD-*|FreeBSD-[[1-2]].*)
 	    # Not available on all versions:  check for include file.
 	    AC_CHECK_HEADER(dlfcn.h, [
 		# NetBSD/SPARC needs -fPIC, -fpic will not do.
@@@@ -1245,6 +1245,55 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 		LD_SEARCH_FLAGS=${CC_SEARCH_FLAGS}
 		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.a'
 	    ])
+
+	    # FreeBSD doesn't handle version numbers with dots.
+
+	    UNSHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.a'
+	    TCL_LIB_VERSIONS_OK=nodots
+	    ;;
+	OpenBSD-*)
d34 1
a34 1
+			SHLIB_CFLAGS="-fPIC";;
d36 1
a36 1
+			SHLIB_CFLAGS="-fpic";;
d39 1
a39 1
+		SHLIB_LD_LIBS=""
d48 10
a57 4
+#ifdef __ELF__
+	yes
+#endif
+		],
d62 1
a62 1
+		)
d66 2
a67 2
 	    # FreeBSD doesn't handle version numbers with dots.
 
@


1.2
log
@Correctly configure tcl and tk 8.4 on architectures which lack shared
libraries, though hppa might need more work.

prodded by jolan@@; ok jolan@@ pval@@
@
text
@d1 2
a2 2
--- tcl.m4.orig	2004-03-02 00:04:48.000000000 +0000
+++ tcl.m4	2004-05-17 12:40:54.000000000 +0000
d12 10
a21 4
@@@@ -1251,6 +1251,56 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 	    UNSHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.a'
 	    TCL_LIB_VERSIONS_OK=nodots
 	    ;;
d24 1
a24 2
+	    hppa|luna88k|mvme88k|vax)
+		# XXX not sure tclLdAout will work on hppa...
d65 3
a67 9
+
+	    # FreeBSD doesn't handle version numbers with dots.
+
+	    UNSHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.a'
+	    TCL_LIB_VERSIONS_OK=nodots
+	    ;;
 	FreeBSD-*)
 	    # FreeBSD 3.* and greater have ELF.
 	    SHLIB_CFLAGS="-fPIC"
@


1.1
log
@Initial revision
@
text
@d1 8
a8 4
--- tcl.m4.orig	2003-07-21 18:29:44.000000000 -0400
+++ tcl.m4	2003-08-20 23:56:13.000000000 -0400
@@@@ -1189,16 +1189,21 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 	NetBSD-*|FreeBSD-[[1-2]].*|OpenBSD-*)
d11 21
a31 3
-		# NetBSD/SPARC needs -fPIC, -fpic will not do.
-		SHLIB_CFLAGS="-fPIC"
-		SHLIB_LD="ld -Bshareable -x"
d40 5
a44 7
 		SHLIB_LD_LIBS=""
 		SHLIB_SUFFIX=".so"
 		DL_OBJS="tclLoadDl.o"
 		DL_LIBS=""
-		LDFLAGS=""
 		CC_SEARCH_FLAGS='-Wl,-rpath,${LIB_RUNTIME_DIR}'
-		LD_SEARCH_FLAGS='-rpath ${LIB_RUNTIME_DIR}'
d47 7
a53 8
 		AC_MSG_CHECKING(for ELF)
 		AC_EGREP_CPP(yes, [
 #ifdef __ELF__
@@@@ -1206,9 +1211,9 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 #endif
 		],
 		    AC_MSG_RESULT(yes)
-		    SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.so',
d55 1
a55 2
 		    AC_MSG_RESULT(no)
-		    SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.so.1.0'
d57 12
a68 3
 		)
 	    ], [
 		SHLIB_CFLAGS=""
@


1.1.1.1
log
@
i've had this sitting in my tree for about a month but i haven't been
sitting still long enough to import it right.

import of tcl/tk 8.4.4. tested by many, feedback from kevlo, mattheui,
many others ... thank you, ok'd by naddy@@
@
text
@@
