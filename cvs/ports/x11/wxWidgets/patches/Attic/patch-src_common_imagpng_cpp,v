head	1.3;
access;
symbols
	OPENBSD_4_8:1.2.0.4
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.2
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_5:1.1.0.4
	OPENBSD_4_6:1.1.0.2
	OPENBSD_4_6_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2010.11.02.13.10.52;	author dcoppa;	state dead;
branches;
next	1.2;

1.2
date	2009.09.10.21.23.28;	author landry;	state Exp;
branches;
next	1.1;

1.1
date	2009.06.05.17.28.57;	author jasper;	state Exp;
branches
	1.1.4.1;
next	;

1.1.4.1
date	2009.08.20.03.51.14;	author william;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to wxWidgets-2.8.11

Successfully tested in a bulk build by landry@@

OK steven@@, landry@@
@
text
@$OpenBSD: patch-src_common_imagpng_cpp,v 1.2 2009/09/10 21:23:28 landry Exp $

Security fix for part 1 or SA35292 (wxWidgets Double Free Vulnerability).
Patch from upstream svn -r60875.

--- src/common/imagpng.cpp.orig	Fri Mar  6 13:10:56 2009
+++ src/common/imagpng.cpp	Fri Sep  4 23:57:40 2009
@@@@ -568,18 +568,16 @@@@ wxPNGHandler::LoadFile(wxImage *image,
     if (!image->Ok())
         goto error;
 
-    lines = (unsigned char **)malloc( (size_t)(height * sizeof(unsigned char *)) );
+    // initialize all line pointers to NULL to ensure that they can be safely
+    // free()d if an error occurs before all of them could be allocated
+    lines = (unsigned char **)calloc(height, sizeof(unsigned char *));
     if ( !lines )
         goto error;
 
     for (i = 0; i < height; i++)
     {
         if ((lines[i] = (unsigned char *)malloc( (size_t)(width * (sizeof(unsigned char) * 4)))) == NULL)
-        {
-            for ( unsigned int n = 0; n < i; n++ )
-                free( lines[n] );
             goto error;
-        }
     }
 
     png_read_image( png_ptr, lines );
@


1.2
log
@Update to wxWidgets 2.8.10.
Tested in a bulk build by (thanks!) and ok sthen@@ jasper@@.
Diff looks alright to steven@@.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_common_imagpng_cpp,v 1.1 2009/06/05 17:28:57 jasper Exp $
@


1.1
log
@- add SECURITY FIX for the first part of SA35292
wxWidgets Double Free Vulnerability

patch from upstream
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
a8 3
--- src/common/imagpng.cpp.orig	Thu Jun  4 18:43:31 2009
+++ src/common/imagpng.cpp	Thu Jun  4 18:45:25 2009
@@@@ -566,18 +566,16 @@@@ wxPNGHandler::LoadFile(wxImage *image,
@


1.1.4.1
log
@SECURITY FIX

MFC:

Resolve SA35292:

wxWidgets Double Free Vulnerability (from upstream svn)

ok robert@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_common_imagpng_cpp,v 1.1 2009/06/05 17:28:57 jasper Exp $
@

