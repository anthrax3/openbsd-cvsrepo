head	1.3;
access;
symbols
	OPENBSD_6_0:1.3.0.36
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.32
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.34
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.30
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.28
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.26
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.24
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.22
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.20
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.18
	OPENBSD_5_0:1.3.0.16
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.14
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.12
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.10
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.8
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.6
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.4
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.2
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.2.0.4
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.2
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.1.1.1.0.10
	OPENBSD_4_0_BASE:1.1.1.1
	OPENBSD_3_9:1.1.1.1.0.8
	OPENBSD_3_9_BASE:1.1.1.1
	OPENBSD_3_8:1.1.1.1.0.6
	OPENBSD_3_8_BASE:1.1.1.1
	OPENBSD_3_7:1.1.1.1.0.4
	OPENBSD_3_7_BASE:1.1.1.1
	OPENBSD_3_6:1.1.1.1.0.2
	OPENBSD_3_6_BASE:1.1.1.1
	todd-Jul-16:1.1.1.1
	todd:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2007.10.23.11.28.10;	author steven;	state Exp;
branches;
next	1.2;

1.2
date	2006.10.12.14.09.33;	author alek;	state Exp;
branches;
next	1.1;

1.1
date	2004.07.16.21.01.35;	author todd;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.07.16.21.01.35;	author todd;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to 2.8.6

tested by various people
@
text
@$OpenBSD: patch-src_common_db_cpp,v 1.2 2006/10/12 14:09:33 alek Exp $
--- src/common/db.cpp.orig	Tue Sep 25 10:51:21 2007
+++ src/common/db.cpp	Tue Oct  2 11:53:18 2007
@@@@ -70,6 +70,19 @@@@ wxChar const *SQL_CATALOG_FILENAME     = wxT("catalog.
 #endif // wxUSE_THREADS
 #endif
 
+#ifndef ___SQLTCHAR
+#define ___SQLTCHAR SQLCHAR
+#endif
+
+FILE*	fopen_create(char *path, char *mode)
+{
+	// Only open the file if it does not already exist
+	int fd = open(path, O_WRONLY | O_CREAT | O_EXCL, 0600);
+	if (fd < 0)
+		return NULL;
+	return fdopen(fd, mode);
+}
+
 // SQL Log defaults to be used by GetDbConnection
 wxDbSqlLogState SQLLOGstate = sqlLogOFF;
 
@


1.2
log
@Update to 2.6.3; now there is only one version -- gtk2
@
text
@d1 5
a5 5
$OpenBSD$
--- src/common/db.cpp.orig	Tue Jan 17 12:14:16 2006
+++ src/common/db.cpp	Thu Jun  1 02:33:00 2006
@@@@ -72,6 +72,19 @@@@ wxChar const *SQL_CATALOG_FILENAME     =
     extern wxList TablesInUse;
@


1.1
log
@Initial revision
@
text
@d2 3
a4 3
--- src/common/db.cpp.orig	Mon Dec 16 23:56:26 2002
+++ src/common/db.cpp	Sat May  3 10:59:20 2003
@@@@ -81,6 +81,15 @@@@ wxChar const *SQL_CATALOG_FILENAME     =
d8 4
d15 1
a15 1
+	int fd = open(path, O_WRONLY | O_CREAT | O_EXCL, 0600)
a23 31
@@@@ -2994,7 +3003,7 @@@@ bool wxDb::Catalog(const wxChar *userID,
     wxChar    typeName[30+1];
     SDWORD    precision, length;
 
-    FILE *fp = fopen(fileName.c_str(),wxT("wt"));
+    FILE *fp = fopen_create(fileName.c_str(),wxT("wt"));
     if (fp == NULL)
         return(FALSE);
 
@@@@ -3331,7 +3340,10 @@@@ bool wxDb::SetSqlLogging(wxDbSqlLogState
     {
         if (fpSqlLog == 0)
         {
-            fpSqlLog = fopen(filename, (append ? wxT("at") : wxT("wt")));
+            if (append)
+		fpSqlLog = fopen(filename, wxT("at"));
+	    else
+		fpSqlLog = fopen_create(filename, wxT("wt"));
             if (fpSqlLog == NULL)
                 return(FALSE);
         }
@@@@ -3442,8 +3454,7 @@@@ wxDBMS wxDb::Dbms(void)
         return(dbmsType);
 
     wxChar baseName[25+1];
-    wxStrncpy(baseName,dbInf.dbmsName,25);
-    baseName[25] = 0;
+    strlcpy(baseName,dbInf.dbmsName,sizeof(baseName));
 
     // RGG 20001025 : add support for Interbase
     // GT : Integrated to base classes on 20001121
@


1.1.1.1
log
@wxWidgets 2.4.2, C++ cross-platform GUI toolkit

www: http://www.wxwidgets.org/

from Andrew Dalgleish   < openbsd at ajd dot net dot au >
many thanks for much persistence!
@
text
@@
