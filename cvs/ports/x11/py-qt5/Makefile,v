head	1.10;
access;
symbols
	OPENBSD_6_0:1.3.0.2
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.1.1.1.0.2
	OPENBSD_5_9_BASE:1.1.1.1
	sthen_20151126:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.10
date	2017.01.21.18.25.02;	author zhuk;	state Exp;
branches;
next	1.9;
commitid	Ye8Ic6lrVSCce6MA;

1.9
date	2017.01.03.19.29.36;	author landry;	state Exp;
branches;
next	1.8;
commitid	FAKLTaNEcdKqwguF;

1.8
date	2016.12.28.07.26.57;	author zhuk;	state Exp;
branches;
next	1.7;
commitid	lOuRGmymp66MvP5Z;

1.7
date	2016.12.28.07.01.47;	author landry;	state Exp;
branches;
next	1.6;
commitid	gCGDjGjV3stW7HU9;

1.6
date	2016.12.25.14.34.40;	author zhuk;	state Exp;
branches;
next	1.5;
commitid	l6KSNN1DfB6ABkhu;

1.5
date	2016.08.30.16.02.17;	author landry;	state Exp;
branches;
next	1.4;
commitid	qtj3cFQ3YRC3ukUB;

1.4
date	2016.08.16.06.44.39;	author jasper;	state Exp;
branches;
next	1.3;
commitid	caqPKfDVUoeYJJgS;

1.3
date	2016.03.20.16.12.27;	author naddy;	state Exp;
branches;
next	1.2;
commitid	guiZq8cnNbVyyHzx;

1.2
date	2016.03.06.11.57.17;	author zhuk;	state Exp;
branches;
next	1.1;
commitid	lLZSnNRs4Yj5rh8v;

1.1
date	2015.11.26.00.32.31;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;
commitid	fJD7EKxCDu1B799i;

1.1.1.1
date	2015.11.26.00.32.31;	author sthen;	state Exp;
branches;
next	;
commitid	fJD7EKxCDu1B799i;


desc
@@


1.10
log
@Having comms/qtserialport and x11/qt5/qtserialport not conflicting
is not enough for stable builds: all their dependees should depend
on either <5.6 or >=5.6 version as well.

Issue reported by naddy@@
@
text
@# $OpenBSD: Makefile,v 1.9 2017/01/03 19:29:36 landry Exp $

COMMENT-main=	python Qt5 bindings
COMMENT-docs=	py-qt5 documentation

V=		5.7
DISTNAME=	PyQt5_gpl-${V}
PKGNAME=	py-qt5-${V}
PKGNAME-main=	py-qt5-${V}
PKGNAME-docs=	py-qt5-docs-${V}
REVISION-main=	3

CATEGORIES=	x11 devel

HOMEPAGE=	http://www.riverbankcomputing.co.uk/software/pyqt/intro

# GPLv3 with exceptions for use with certain named open-source licenses
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += ${MODPY_WANTLIB} c dbus-1 m pthread
WANTLIB += Enginio GL Qt5Bluetooth Qt5Core Qt5DBus Qt5Designer
WANTLIB += Qt5Gui Qt5Help Qt5Multimedia Qt5MultimediaWidgets Qt5Network
WANTLIB += Qt5OpenGL Qt5Positioning Qt5PrintSupport Qt5Qml Qt5Quick
WANTLIB += Qt5QuickWidgets Qt5Sensors Qt5SerialPort Qt5Sql Qt5Svg
WANTLIB += Qt5Test Qt5WebChannel Qt5WebKit Qt5WebKitWidgets Qt5WebSockets
WANTLIB += Qt5Widgets Qt5X11Extras Qt5Xml Qt5XmlPatterns
WANTLIB += Qt5Location Qt5Nfc

MULTI_PACKAGES=	-main -docs

WANTLIB-docs=
LIB_DEPENDS-docs=
RUN_DEPENDS-docs=
PKG_ARCH-docs=	*

FLAVORS =	python3
FLAVOR ?=

.if ${FLAVOR:Mpython3}
FULLPKGNAME-main=	${PKGNAME-main:S/^py-/py3-/}
FULLPKGPATH-main=	x11/py-qt5,-main${MODPY_FLAVOR}
FULLPKGNAME-docs=	${PKGNAME-docs:S/^py-/py3-/}
FULLPKGPATH-docs=	x11/py-qt5,-docs${MODPY_FLAVOR}
.endif
REVISION-docs=		0

BUILD_DEPENDS=	${RUN_DEPENDS}
RUN_DEPENDS=	devel/py-sip${MODPY_FLAVOR}>=4.18.1 \
		x11/dbus-python${MODPY_FLAVOR}
LIB_DEPENDS=	${MODPY_LIB_DEPENDS} \
		x11/qt5/qtconnectivity \
		x11/qt5/qtdeclarative \
		x11/qt5/qtenginio \
		x11/qt5/qtlocation \
		x11/qt5/qtmultimedia \
		x11/qt5/qtserialport \
		x11/qt5/qtsensors \
		x11/qt5/qtsvg \
		x11/qt5/qttools \
		x11/qt5/qtwebchannel \
		x11/qt5/qtwebkit \
		x11/qt5/qtwebsockets \
		x11/qt5/qtx11extras \
		x11/qt5/qtxmlpatterns

NO_TEST=	Yes

MASTER_SITES=	${MASTER_SITE_SOURCEFORGE:=pyqt/}

MODULES=	devel/gettext \
		lang/python \
		x11/qt5

CONFIGURE_STYLE=simple
CONFIGURE_SCRIPT=${MODPY_BIN} configure.py
CONFIGURE_ARGS=	--verbose \
		--qmake="${LOCALBASE}/bin/qmake-qt5" \
		--sip="${LOCALBASE}/bin/sip${MODPY_BIN_SUFFIX}" \
		--bindir="${PREFIX}/bin" \
		--destdir="${MODPY_SITEPKG}" \
		--sipdir="${PREFIX}/share/sip/PyQt5${MODPY_BIN_SUFFIX}" \
		--vendorid-incdir="${MODPY_INCDIR}" \
		--vendorid-libdir="${MODPY_LIBDIR}" \
		--no-qsci-api \
		INCDIR_QT=${MODQT_INCDIR} \
		LIBDIR="${X11BASE}/lib ${LOCALBASE}/lib" \
		LIBDIR_QT=${MODQT_LIBDIR} \
		CC=${CC} \
		CXX=${CXX} \
		CFLAGS="${CFLAGS}" \
		CXXFLAGS="${CXXFLAGS}"
FAKE_FLAGS=	INSTALL_ROOT=${DESTDIR}
CONFIGURE_ENV=	LOCALBASE=${LOCALBASE}

SUBST_VARS +=	MODPY_MAJOR_VERSION

# the distfile has pyuic for both python 2 and 3, normally both are
# installed and they're selected at runtime. this breaks bytecode
# compilation for package generation, so just rm the wrong files.
pre-configure:
.if ${FLAVOR:Mpython3}
	rm -fr ${WRKSRC}/pyuic/uic/port_v2
.else
	rm -fr ${WRKSRC}/pyuic/uic/port_v3
.endif

post-install:
	${MODPY_BIN} ${MODPY_LIBDIR}/compileall.py ${WRKINST}/${MODPY_SITEPKG}
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/${MODPY_PY_PREFIX}qt5
	cp -R ${WRKSRC}/doc/* ${PREFIX}/share/doc/${MODPY_PY_PREFIX}qt5
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share/doc/${MODPY_PY_PREFIX}qt5/*
.for b in pylupdate pyrcc pyuic
	mv -f ${PREFIX}/bin/$b5 ${PREFIX}/bin/$b5${MODPY_BIN_SUFFIX}
.endfor
	mv -f ${PREFIX}/lib/qt5/plugins/PyQt5/libpyqt5qmlplugin{,${MODPY_BIN_SUFFIX}}.so
	mv -f ${PREFIX}/lib/qt5/plugins/designer/libpyqt5{,${MODPY_BIN_SUFFIX}}.so

.include <bsd.port.mk>
@


1.9
log
@bump ports depending on python3 in x11, thanks portbump(1) for the heavy lifting !
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2016/12/28 07:26:57 zhuk Exp $
d11 1
a11 1
REVISION-main=	2
@


1.8
log
@Bump after LIB_DEPENDS change, package could get built by accident,
as it happened on my machine.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2016/12/28 07:01:47 landry Exp $
d11 1
a11 1
REVISION-main=	1
d45 1
@


1.7
log
@Add x11/qt5/qtsvg to LDEP, build fails with 'Missing library for
Qt5Svg>=0.0' otherwise, Qt5Svg is in WANTLIB but nothing brings it into
context.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2016/12/25 14:34:40 zhuk Exp $
d11 1
a11 1
REVISION-main=	0
@


1.6
log
@Adapt to new x11/qt5 layout, mostly REVISION bumps due to changed deps.

The devel/kf5 to be handled separately, please wait.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2016/08/30 16:02:17 landry Exp $
d57 1
@


1.5
log
@Update to py-qt5 5.7.

Tested by jasper@@ with qutebrowser.
ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2016/08/16 06:44:39 jasper Exp $
d11 1
d49 14
a62 2
LIB_DEPENDS=	${MODQT5_LIB_DEPENDS}>=5.5 \
		${MODPY_LIB_DEPENDS}
@


1.4
log
@- add python3 flavor
- unbreak pre-configure for python 3

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2016/03/20 16:12:27 naddy Exp $
d6 2
a7 2
V=		5.5.1
DISTNAME=	PyQt-gpl-${V}
a10 1
REVISION-main=	1
d46 1
a46 1
RUN_DEPENDS=	devel/py-sip${MODPY_FLAVOR}>=4.16.5 \
@


1.3
log
@drop SHARED_ONLY from python and ruby ports
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2016/03/06 11:57:17 zhuk Exp $
d11 1
a11 1
REVISION-main=	0
d36 10
d47 2
a48 2
RUN_DEPENDS=	devel/py-sip>=4.16.5 \
		x11/dbus-python
d64 1
d67 1
a67 1
		--sipdir="${PREFIX}/share/sip/PyQt5" \
d81 2
a82 1
MODPY_MAJOR=${MODPY_VERSION:C/\..*//}
d87 1
a87 1
.if ${MODPY_MAJOR:M3}
d95 8
a102 3
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/py-qt5
	cp -R ${WRKSRC}/doc/* ${PREFIX}/share/doc/py-qt5
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share/doc/py-qt5/*
@


1.2
log
@Unbreak after Qt update to 5.5.
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.1.1.1 2015/11/26 00:32:31 sthen Exp $

SHARED_ONLY=	Yes
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2013/11/08 22:37:43 sthen Exp $
d13 1
d29 1
d41 1
a41 1
LIB_DEPENDS=	${MODQT5_LIB_DEPENDS} \
@


1.1.1.1
log
@import ports/x11/py-qt5, Python bindings to Qt5. ok zhuk@@
@
text
@@
