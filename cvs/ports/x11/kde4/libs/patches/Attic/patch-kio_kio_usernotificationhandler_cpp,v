head	1.3;
access;
symbols
	OPENBSD_5_5:1.1.0.2;
locks; strict;
comment	@# @;


1.3
date	2014.07.18.08.17.12;	author zhuk;	state dead;
branches;
next	1.2;
commitid	J5DCiA9lBlWutwst;

1.2
date	2014.07.11.11.13.10;	author zhuk;	state Exp;
branches;
next	1.1;
commitid	e1BO2Z8Rynr5Dlrm;

1.1
date	2014.06.20.13.12.36;	author jasper;	state Exp;
branches
	1.1.2.1;
next	;
commitid	17xxBDXlGW2dYts4;

1.1.2.1
date	2014.06.20.13.16.07;	author jasper;	state Exp;
branches;
next	;
commitid	nzwCTOXHNY54O4Vp;


desc
@@


1.3
log
@Small bugfix KDE 4.13.3. Release announcement:
http://www.kde.org/announcements/announce-4.13.3.php
@
text
@$OpenBSD: patch-kio_kio_usernotificationhandler_cpp,v 1.2 2014/07/11 11:13:10 zhuk Exp $

Security fix for CVE-2014-3494, KMail/KIO POP3 SSL MITM Flaw
http://www.kde.org/info/security/advisory-20140618-1.txt

--- kio/kio/usernotificationhandler.cpp.orig	Sun Jun  8 15:41:32 2014
+++ kio/kio/usernotificationhandler.cpp	Fri Jul 11 09:12:20 2014
@@@@ -19,7 +19,7 @@@@
 #include "usernotificationhandler_p.h"
 
 #include "slave.h"
-#include "job_p.h"
+#include "jobuidelegate.h"
 
 #include <kdebug.h>
 
@@@@ -76,19 +76,18 @@@@ void UserNotificationHandler::processRequest()
 
         if (m_cachedResults.contains(key)) {
             result = *(m_cachedResults[key]);
-        } else if (r->slave->job()) {
-            SimpleJobPrivate* jobPrivate = SimpleJobPrivate::get(r->slave->job());
-            if (jobPrivate) {
-                result = jobPrivate->requestMessageBox(r->type,
-                                                      r->data.value(MSG_TEXT).toString(),
-                                                      r->data.value(MSG_CAPTION).toString(),
-                                                      r->data.value(MSG_YES_BUTTON_TEXT).toString(),
-                                                      r->data.value(MSG_NO_BUTTON_TEXT).toString(),
-                                                      r->data.value(MSG_YES_BUTTON_ICON).toString(),
-                                                      r->data.value(MSG_NO_BUTTON_ICON).toString(),
-                                                      r->data.value(MSG_DONT_ASK_AGAIN).toString(),
-                                                      r->data.value(MSG_META_DATA).toMap());
-            }
+        } else {
+            JobUiDelegate ui;
+            const JobUiDelegate::MessageBoxType type = static_cast<JobUiDelegate::MessageBoxType>(r->type);
+            result = ui.requestMessageBox(type,
+                                          r->data.value(MSG_TEXT).toString(),
+                                          r->data.value(MSG_CAPTION).toString(),
+                                          r->data.value(MSG_YES_BUTTON_TEXT).toString(),
+                                          r->data.value(MSG_NO_BUTTON_TEXT).toString(),
+                                          r->data.value(MSG_YES_BUTTON_ICON).toString(),
+                                          r->data.value(MSG_NO_BUTTON_ICON).toString(),
+                                          r->data.value(MSG_DONT_ASK_AGAIN).toString(),
+                                          r->data.value(MSG_META_DATA).toMap());
             m_cachedResults.insert(key, new int(result));
         }
     } else {
@


1.2
log
@Regen patches (non-critical, but lowers level of spam in my cvs diff output)
@
text
@d1 1
a1 1
$OpenBSD: patch-kio_kio_usernotificationhandler_cpp,v 1.1 2014/06/20 13:12:36 jasper Exp $
@


1.1
log
@Security fix for CVE-2014-3494, KMail/KIO POP3 SSL MITM Flaw
http://www.kde.org/info/security/advisory-20140618-1.txt

from Rafael Sadowski
ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
d6 2
a7 2
--- kio/kio/usernotificationhandler.cpp.orig	Thu Jan  2 20:26:52 2014
+++ kio/kio/usernotificationhandler.cpp	Thu Jun 19 17:00:27 2014
d10 1
a10 1

d14 1
a14 1

d16 1
a16 1

d18 1
a18 1

@


1.1.2.1
log
@Security fix for CVE-2014-3494, KMail/KIO POP3 SSL MITM Flaw
http://www.kde.org/info/security/advisory-20140618-1.txt

from Rafael Sadowski
ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-kio_kio_usernotificationhandler_cpp,v 1.1 2014/06/20 13:12:36 jasper Exp $
@

