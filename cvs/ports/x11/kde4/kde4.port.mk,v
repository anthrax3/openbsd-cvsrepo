head	1.37;
access;
symbols
	OPENBSD_6_1:1.34.0.4
	OPENBSD_6_1_BASE:1.34
	OPENBSD_6_0:1.34.0.2
	OPENBSD_6_0_BASE:1.34
	OPENBSD_5_9:1.33.0.2
	OPENBSD_5_9_BASE:1.33
	OPENBSD_5_8:1.33.0.4
	OPENBSD_5_8_BASE:1.33
	OPENBSD_5_7:1.31.0.2
	OPENBSD_5_7_BASE:1.31
	OPENBSD_5_6:1.23.0.2
	OPENBSD_5_6_BASE:1.23
	OPENBSD_5_5:1.18.0.2
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.7.0.2
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.1.0.2
	OPENBSD_5_3_BASE:1.1;
locks; strict;
comment	@# @;


1.37
date	2017.05.31.08.08.18;	author espie;	state Exp;
branches;
next	1.36;
commitid	ij92FtFXiSiT1ani;

1.36
date	2017.05.27.18.10.28;	author espie;	state Exp;
branches;
next	1.35;
commitid	6Yhx70HrTADsP0un;

1.35
date	2017.05.13.09.49.50;	author espie;	state Exp;
branches;
next	1.34;
commitid	Qq9CIQtBjFqtn5SM;

1.34
date	2016.03.19.23.44.54;	author naddy;	state Exp;
branches;
next	1.33;
commitid	qStWOgPYAL7HBOR8;

1.33
date	2015.07.20.07.17.40;	author zhuk;	state Exp;
branches;
next	1.32;
commitid	afInazALYedZrIQ5;

1.32
date	2015.05.01.15.39.28;	author espie;	state Exp;
branches;
next	1.31;
commitid	VGwK0klosixMSCXo;

1.31
date	2015.01.20.21.58.37;	author zhuk;	state Exp;
branches;
next	1.30;
commitid	BHrhHE27X2bTWDbq;

1.30
date	2014.11.13.19.18.01;	author zhuk;	state Exp;
branches;
next	1.29;
commitid	PafCQQyv7ew8ZtzZ;

1.29
date	2014.11.01.21.09.39;	author zhuk;	state Exp;
branches;
next	1.28;
commitid	yISoHfVgp7MFifJl;

1.28
date	2014.10.05.19.18.56;	author zhuk;	state Exp;
branches;
next	1.27;
commitid	jw6BgKzFDMztIXDW;

1.27
date	2014.10.04.12.59.26;	author zhuk;	state Exp;
branches;
next	1.26;
commitid	5SAJ7TfFdkVK6zCi;

1.26
date	2014.10.03.00.01.11;	author zhuk;	state Exp;
branches;
next	1.25;
commitid	F6GfkmhKrEjvRQ0X;

1.25
date	2014.10.02.23.57.46;	author zhuk;	state Exp;
branches;
next	1.24;
commitid	IsKhxQsb2RHhPXiy;

1.24
date	2014.08.10.10.13.18;	author espie;	state Exp;
branches;
next	1.23;
commitid	dZzZvPUfkPek6Ohw;

1.23
date	2014.07.18.08.17.07;	author zhuk;	state Exp;
branches;
next	1.22;
commitid	J5DCiA9lBlWutwst;

1.22
date	2014.07.18.08.11.47;	author zhuk;	state Exp;
branches;
next	1.21;
commitid	1wrWissxHomP7JXQ;

1.21
date	2014.07.15.18.06.00;	author zhuk;	state Exp;
branches;
next	1.20;
commitid	LFz8IGzIMcF6ITwT;

1.20
date	2014.07.09.20.03.22;	author zhuk;	state Exp;
branches;
next	1.19;
commitid	VIGhneE7m6586cHK;

1.19
date	2014.06.28.16.45.00;	author zhuk;	state Exp;
branches;
next	1.18;
commitid	eC7rHt7rdjkw1eiA;

1.18
date	2014.01.15.19.42.08;	author zhuk;	state Exp;
branches;
next	1.17;

1.17
date	2013.12.08.19.13.29;	author zhuk;	state Exp;
branches;
next	1.16;

1.16
date	2013.11.26.21.22.36;	author zhuk;	state Exp;
branches;
next	1.15;

1.15
date	2013.11.26.09.30.20;	author zhuk;	state Exp;
branches;
next	1.14;

1.14
date	2013.11.25.16.26.08;	author zhuk;	state Exp;
branches;
next	1.13;

1.13
date	2013.11.11.14.13.29;	author zhuk;	state Exp;
branches;
next	1.12;

1.12
date	2013.10.10.11.53.24;	author zhuk;	state Exp;
branches;
next	1.11;

1.11
date	2013.10.07.16.57.29;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2013.10.06.14.42.24;	author zhuk;	state Exp;
branches;
next	1.9;

1.9
date	2013.10.06.10.51.48;	author zhuk;	state Exp;
branches;
next	1.8;

1.8
date	2013.10.06.10.23.37;	author zhuk;	state Exp;
branches;
next	1.7;

1.7
date	2013.07.04.00.44.21;	author zhuk;	state Exp;
branches;
next	1.6;

1.6
date	2013.06.06.08.36.47;	author zhuk;	state Exp;
branches;
next	1.5;

1.5
date	2013.05.14.09.16.25;	author zhuk;	state Exp;
branches;
next	1.4;

1.4
date	2013.04.27.20.22.36;	author zhuk;	state Exp;
branches;
next	1.3;

1.3
date	2013.04.24.10.37.15;	author zhuk;	state Exp;
branches;
next	1.2;

1.2
date	2013.03.11.11.46.13;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2013.02.02.09.27.37;	author zhuk;	state Exp;
branches;
next	;


desc
@@


1.37
log
@switch everything to new COMPILER idiom, even stuff that won't build with clang
yet, but at least that part is done.
@
text
@# $OpenBSD: kde4.port.mk,v 1.36 2017/05/27 18:10:28 espie Exp $

# The version of KDE SC in x11/kde4
_MODKDE4_STABLE =	4.14.3

# List of currently supported KDE SC versions, except "stable"
_MODKDE4_OTHERS =

# Handle kde4* FLAVORs: detect what version is requested, and
# set MODKDE4_VERSION, MODKDE4_DEP_VERSION and MODKDE4_DEP_DIR
# accordingly. There is also a shortcut for the latter.
#
# MODKDE4_FLAVOR is read-only for ports, except KDE SC itself.

.for _v in ${_MODKDE4_OTHERS}
MODKDE4_FLAVORS +=	kde${_v:S/.//g}
.endfor
FLAVORS +=		${MODKDE4_FLAVORS}
MODKDE4_FLAVOR ?=	${FLAVOR:Mkde4*}

.if ${MODKDE4_FLAVOR}
.   for _f in ${MODKDE4_FLAVOR}
.      for _f2 in ${MODKDE4_FLAVOR}
.         if "${_f2}" != "${_f}"
ERRORS += "Fatal: cannot use more than one kde4* FLAVOR\n"
.         endif
.      endfor

.      for _v in ${_MODKDE4_OTHERS}
.         if "kde${_v:S/.//g}" == "${_f}"
MODKDE4_VERSION ?=	${_v}
MODKDE4_DEP_VERSION ?=	${_v:R}
.         endif
.      endfor

.   endfor
MODKDE4_DEP_DIR =	x11/${MODKDE4_FLAVOR}
.else
MODKDE4_DEP_DIR =	x11/kde4
.endif

MODKDE4_SPEC =		>=${MODKDE4_VERSION},<5

CATEGORIES +=		${MODKDE4_DEP_DIR}

.if ${MODKDE4_DEP_DIR} != "x11/kde4"
MODKDE4_MAIN_PKGPATH =	${FULLPKGPATH:S@@x11/${MODKDE4_FLAVOR}/@@x11/kde4/@@}
SUBST_VARS +=		MODKDE4_MAIN_PKGPATH
PKG_ARGS +=		-f ${PORTSDIR}/x11/kde4/kde4.pkgpath
.endif

# Can be set by port to force dependency on particular KDE SC version.
MODKDE4_VERSION ?=	${_MODKDE4_STABLE}
MODKDE4_DEP_VERSION ?=	${MODKDE4_VERSION:R}

# General options set by module
ONLY_FOR_ARCHS ?=	${CXX11_ARCHS}

GH_COMMIT ?=
.if empty(GH_COMMIT)
EXTRACT_SUFX ?=		.tar.xz
.endif

.if "${NO_BUILD:L}" != "yes"
# CONFIGURE_STYLE needs separate handling because it is set to empty
# string in bsd.port.mk initially.
.   if "${CONFIGURE_STYLE}" == ""
CONFIGURE_STYLE =	cmake
.   endif

.   if ${CONFIGURE_STYLE:Mcmake}
MODULES +=		devel/cmake
SEPARATE_BUILD ?=	flavored
.   endif
.endif

# MODKDE4_RESOURCES: Yes/No
#   If enabled, disable default Qt and KDE LIB_DEPENDS and RUN_DEPENDS,
#   and set PKG_ARCH=*. Also, FLAVORS will not be touched. "libs"
#   dependencies in MODKDE4_USE (see below) will become a BUILD_DEPENDS.

MODKDE4_RESOURCES ?=	No

# MODKDE4_USE: [libs | runtime | workspace] [PIM] [games]
#   - Set to empty for stuff that is a prerequisite for kde base blocks:
#     kdelibs, kde-runtime, kdepimlibs or kdepim-runtime.
#
#   - Set to "libs" for ports that need only libs, without runtime support.
#     All options below imply "libs". If no from "none", "libs" or
#     "runtime" were specified, "libs" is implied. This is the default
#     value when MODKDE4_RESOURCES is enabled.
#
#   - Set to "runtime" for ports which depend on base KDE libraries and
#     runtime components. This is the default setting until
#     MODKDE4_RESOURCES is enabled.
#
#   - Set to "workspace" for ports that require KDE workspace libraries.
#     This automatically implies "runtime".
#
#   - Add "pim" when port depends on KDE PIM framework, i.e. LIB_DEPENDS
#     on kdepimlibs and, if "libs" was not specified, RUN_DEPENDS on
#     kdepim-runtime.
#
#   - Add "games" when port is usual KDE game. It adds LIB_DEPENDS on
#     libkdegames and add kdegames to WANTLIB. Also, Makefile.inc may
#     use this value, e.g., to provide different default HOMEPAGE.
#
# NOTE: There are no options like "Kate" or "Okular", they should be handled
#       with simple LIB_DEPENDS on corresponding packages in addition to
#       options above.
#

.if ${MODKDE4_RESOURCES:L} == "no"
MODKDE4_USE ?=		runtime
COMPILER =		gcc
.else
MODKDE4_USE ?=		libs
.endif

_MODKDE4_USE_ALL =	libs runtime workspace pim games
.for _modkde4_u in ${MODKDE4_USE:L}
.   if !${_MODKDE4_USE_ALL:M${_modkde4_u}}
ERRORS += "Fatal: unknown KDE 4 use flag: ${_modkde4_u}"
ERRORS += "Fatal: (not one from ${_MODKDE4_USE_ALL})."
.   endif
.endfor

.if ${MODKDE4_USE:L:Mworkspace}
MODKDE4_USE +=		runtime
.endif
.if !empty(MODKDE4_USE) && ${MODKDE4_USE:L:Mlibs} == "" && ${MODKDE4_USE:L:Mruntime} == ""
MODKDE4_USE +=		runtime
.endif

# Almost all KDE ports use docbook.
MODKDE4_BUILD_DEPENDS =	textproc/docbook \
			textproc/docbook-xsl
MODKDE4_LIB_DEPENDS =
MODKDE4_RUN_DEPENDS =
MODKDE4_WANTLIB =
MODKDE4_CONF_ARGS =

FLAVOR ?=

.if ${MODKDE4_USE:L:Mruntime} || ${MODKDE4_USE:L:Mpim}
MODKDE4_USE +=		libs
.endif

KDE4_ONLY ?= Yes

.if ${KDE4_ONLY:L} == "yes"
DPB_PROPERTIES +=	tag:kde4
.endif

# Small hack, until automoc4 will be gone
PKGNAME ?= ${DISTNAME}
.if !${PKGNAME:Mautomoc4-*}
MODKDE4_BUILD_DEPENDS +=	devel/automoc
.endif

.if ${MODKDE4_RESOURCES:L} != "no"
PKG_ARCH ?=		*
MODKDE4_NO_QT ?=	Yes	# resources usually don't need Qt
.   if ${MODKDE4_USE:L:Mworkspace}
MODKDE4_BUILD_DEPENDS +=	${MODKDE4_DEP_DIR}/workspace>=4.11,<5
.   endif
.   if ${MODKDE4_USE:L:Mlibs}
MODKDE4_BUILD_DEPENDS +=	${MODKDE4_DEP_DIR}/libs,-main>=${MODKDE4_DEP_VERSION},<5
.   endif
.else
MODKDE4_NO_QT ?=	No
.   if ${MODKDE4_USE:L:Mlibs}
.       if ${MODKDE4_NO_QT:L} == "yes"
ERRORS +=	"Fatal: KDE libraries require Qt."
.       endif

MODKDE4_LIB_DEPENDS +=		${MODKDE4_DEP_DIR}/libs,-main>=${MODKDE4_DEP_VERSION},<5
MODKDE4_WANTLIB +=		${MODKDE4_LIB_DIR}/kdecore>=8
.       if ${MODKDE4_USE:L:Mpim}
MODKDE4_LIB_DEPENDS +=		${MODKDE4_DEP_DIR}/pimlibs>=${MODKDE4_DEP_VERSION},<5
MODKDE4_BUILD_DEPENDS +=	devel/boost
.       endif

.       if ${MODKDE4_USE:L:Mgames}
MODKDE4_LIB_DEPENDS +=		${MODKDE4_DEP_DIR}/libkdegames>=${MODKDE4_DEP_VERSION},<5
MODKDE4_WANTLIB +=		${MODKDE4_LIB_DIR}/kdegames
.       endif

.       if ${MODKDE4_USE:L:Mruntime}
MODKDE4_RUN_DEPENDS +=		${MODKDE4_DEP_DIR}/runtime,-main>=${MODKDE4_DEP_VERSION},<5
.           if ${MODKDE4_USE:L:Mpim}
MODKDE4_RUN_DEPENDS +=		${MODKDE4_DEP_DIR}/pim-runtime>=${MODKDE4_DEP_VERSION},<5
.           endif

.           if ${MODKDE4_USE:L:Mworkspace}
MODKDE4_LIB_DEPENDS +=		${MODKDE4_DEP_DIR}/workspace>=4.11,<5
.           endif
.       endif
.   endif    # ${MODKDE4_USE:L:Mlibs}

# See FindKDE4Internal.cmake from kdelibs package for details.
.if ${CONFIGURE_STYLE:Mcmake}
.   if ${FLAVOR:Mdebug}
# -g -O0, qDebug/kDebug enabled
MODKDE4_CONF_ARGS +=	-DCMAKE_BUILD_TYPE:String=DebugFull
MODKDE4_CMAKE_PREFIX =	-debugfull
.   else
# -O2, qDebug/kDebug disabled
MODKDE4_CONF_ARGS +=	-DCMAKE_BUILD_TYPE:String=Release
MODKDE4_CMAKE_PREFIX =	-release
.   endif

# NOTE: due to bugs in make-plist, plist may contain
# ${FLAVORS} instead of ${MODKDE4_CMAKE_PREFIX}.
# You've been warned.
SUBST_VARS +=		MODKDE4_CMAKE_PREFIX

FLAVORS +=	debug
.endif

# ${MODKDE4_RESOURCES:L} != "no"
.endif

# Set up directories, avoiding conflicts with KDE3.
# Libraries are handled in kde4-post-install target, see below.
MODKDE4_INCLUDE_DIR =	include/kde4
MODKDE4_LIB_DIR =	lib/kde4/libs

# shortcut to make WANTLIBs and PLISTs more readable
KDE4LIB =		${MODKDE4_LIB_DIR}
SUBST_VARS +=		KDE4LIB

.if ${CONFIGURE_STYLE:Mcmake}
. if "${NO_TEST:L}" != "yes"
# Enable regression tests if any
MODKDE4_CONF_ARGS +=	-DKDE4_BUILD_TESTS:Bool=Yes
. else
MODKDE4_CONF_ARGS +=	-DKDE4_BUILD_TESTS:Bool=No
. endif

MODKDE4_CONF_ARGS +=	-DINCLUDE_INSTALL_DIR:Path=${MODKDE4_INCLUDE_DIR} \
			-DKDE4_INCLUDE_INSTALL_DIR:Path=${PREFIX}/${MODKDE4_INCLUDE_DIR} \
			-DKDE4_INSTALL_DIR:Path=${PREFIX} \
			-DKDE4_LIB_DIR:Path=${PREFIX}/${MODKDE4_LIB_DIR} \
			-DKDE4_LIB_INSTALL_DIR:Path=${PREFIX}/lib \
			-DKDE4_LIBEXEC_INSTALL_DIR:Path=${PREFIX}/libexec \
			-DKDE4_INFO_INSTALL_DIR:Path=${PREFIX}/info \
			-DKDE4_MAN_INSTALL_DIR:Path=${PREFIX}/man \
			-DKDE4_SYSCONF_INSTALL_DIR:Path=${SYSCONFDIR}

# Make sure that KDE4-specific places are searched first
MODKDE4_CONF_ARGS +=	
    -DCMAKE_INCLUDE_PATH=${LOCALBASE}/${MODKDE4_INCLUDE_DIR}:${LOCALBASE}/include \
    -DCMAKE_LIBRARY_PATH=${LOCALBASE}/${MODKDE4_LIB_DIR}:${LOCALBASE}/lib

# KDE 4.11+ doesn't play well with NEW CMP0022
MODKDE4_CONF_ARGS +=	-DCMAKE_POLICY_DEFAULT_CMP0022=OLD

# Some KDE4 internals still try to read LOCATION directly
MODKDE4_CONF_ARGS +=	-DCMAKE_POLICY_DEFAULT_CMP0026=OLD
.endif

# FIXME
MODKDE4_CONFIGURE_ENV =	HOME=${WRKDIR}
PORTHOME ?=		${WRKDIR}

MODKDE4_NO_QT ?=	No
.if ${MODKDE4_NO_QT:L} == "no"
MODULES +=			x11/qt4
MODQT4_OVERRIDE_UIC ?=		No
MODKDE4_CONFIGURE_ENV +=	QTDIR=${MODQT_LIBDIR}
.endif


.if "${NO_BUILD:L}" != "yes"
BUILD_DEPENDS +=	${MODKDE4_BUILD_DEPENDS}
LIB_DEPENDS +=		${MODKDE4_LIB_DEPENDS}
.endif

RUN_DEPENDS +=		${MODKDE4_RUN_DEPENDS}
WANTLIB +=		${MODKDE4_WANTLIB}
CONFIGURE_ENV +=	${MODKDE4_CONFIGURE_ENV}
CONFIGURE_ARGS +=	${MODKDE4_CONF_ARGS}
# MAKE_FLAGS +=		${MODKDE4_CONF_ARGS}

MODKDE4_FIX_GETTEXT ?=	Yes
MODKDE4_GETTEXT_MARKER ?=	\$$\{_po_files\}
.if ${MODKDE4_FIX_GETTEXT:L} == "yes"
# System (CMake) FindGettext.cmake requires having PO_FILES marker
MODKDE4_post-patch =	@@echo '====> Fixing GETTEXT_PROCESS_PO_FILES() calls'; \
	cd ${WRKSRC} && find . -name CMakeLists.txt | sort | \
		while read F; do \
			perl -pi.pofilesfix -e '\
			if (/GETTEXT_PROCESS_PO_FILES/ and !/\sPO_FILES/) { \
				s@@${MODKDE4_GETTEXT_MARKER}@@PO_FILES $$&@@; \
			}' "$$F"; \
			if cmp -s "$$F" "$$F".pofilesfix; then \
				rm "$$F".pofilesfix; \
			else \
				echo "$$F" >&2; \
			fi; \
		done
.endif

# Some KDE ports install files under ${SYSCONFDIR}.
# We want to have them under ${PREFIX}/share/examples or such,
# and just be @@sample'd under ${SYSCONFDIR}.
# So add "file/dir destination" pairs to this variable, and
# apporiate @@sample lines to packing list, e.g.:
#   dbus-1	share/examples
MODKDE4_SYSCONF_FILES ?=

# Create soft links for shared libraries in ${PREFIX}/lib to
# ${MODKDE4_LIB_DIR}. Used to avoid clashing with KDE 3.
MODKDE4_LIB_LINKS ?=	No

# We cannot use at least "MODKDE4_pre-install", as it means a totally different
# thing for MODULES rather than for ports. So play another game...

# Always create directory for headers, remove later if left empty
MODKDE4_pre-fake =	${_FAKESUDO} ${INSTALL_DATA_DIR} ${WRKINST}/${PREFIX}/include/kde4;

# 1. Remove includes directory created above, if empty.
# 2. Create links for shared libraries in ${PREFIX}/${KDE4LIB},
#    to allow using -DDKDE4_LIB_DIR=${PREFIX}/${KDE4LIB}.
# 3. Fixup files in ${SYSCONFDIR}, see notes for MODKDE4_SYSCONF_FILES above.
MODKDE4_post-install =	rmdir ${PREFIX}/${MODKDE4_INCLUDE_DIR} 2>/dev/null || :;

.if ${MODKDE4_LIB_LINKS:L} == "yes" && defined(SHARED_LIBS) && !empty(SHARED_LIBS)
MODKDE4_post-install +=	\
	${INSTALL_DATA_DIR} ${PREFIX}/${MODKDE4_LIB_DIR}; \
	cd ${PREFIX}/${MODKDE4_LIB_DIR};

# Note that number of upper-level directories depends on
# actual ${MODKDE4_LIB_DIR} value relative to ${PREFIX}/lib.
. for _l _v in ${SHARED_LIBS}
MODKDE4_post-install +=	\
	! test -e ../../lib${_l}.so.${_v} || ln -sf ../../lib${_l}.so.${_v};
. endfor
.endif

.for _f _d in ${MODKDE4_SYSCONF_FILES}
MODKDE4_post-install +=	\
	rm -Rf ${PREFIX}/${_d}/${_f}; \
	${INSTALL_DATA_DIR} ${PREFIX}/${_d}; \
	mv ${WRKINST}${SYSCONFDIR}/${_f} ${PREFIX}/${_d}/${_f};
.endfor
@


1.36
log
@forgotten commit... not sure it's actually useful, but better safe than
sorry
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.35 2017/05/13 09:49:50 espie Exp $
d115 1
a115 1
WANT_CXX =	base gcc
@


1.35
log
@first batch of WANT_CXX
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.34 2016/03/19 23:44:54 naddy Exp $
d252 3
a254 2
MODKDE4_CONF_ARGS +=	-DCMAKE_INCLUDE_PATH=${LOCALBASE}/${MODKDE4_INCLUDE_DIR} \
			-DCMAKE_LIBRARY_PATH=${LOCALBASE}/${MODKDE4_LIB_DIR}
@


1.34
log
@drop SHARED_ONLY from KDE4 ports
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.33 2015/07/20 07:17:40 zhuk Exp $
d57 1
a57 1
ONLY_FOR_ARCHS ?=	${GCC4_ARCHS}
d115 1
a115 3
MODULES +=		gcc4
MODGCC4_ARCHS =		*
MODGCC4_LANGS =		c++
@


1.33
log
@Allow to change marker that MODKDE4_FIX_GETTEXT uses; kdenlive people do
continue to deviate from others.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.32 2015/05/01 15:39:28 espie Exp $
a56 1
SHARED_ONLY ?=		Yes
@


1.32
log
@dpb junk logic is fine.
kde4 build separation does not work as good as vadim said it should
THIS is the reason for the sporadic build failures in kde3 recently.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.31 2015/01/20 21:58:37 zhuk Exp $
d289 1
d297 1
a297 1
				s@@\$$\{_po_files\}@@PO_FILES $$&@@; \
@


1.31
log
@Bringing in KDE 4.14.3. This is the last KDE4 release, ever.
This release contains only minor fixes.

See you in KDE Frameworks land in the next season!
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.30 2014/11/13 19:18:01 zhuk Exp $
a151 3
.if empty(MODKDE4_USE)
KDE4_ONLY ?= No
.else
a152 1
.endif
@


1.30
log
@Introduce MODKDE4_SPEC, a helper variable for precise specification of
inter-KDE4 dependencies. To be used in a few KDE4 ports soon.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.29 2014/11/01 21:09:39 zhuk Exp $
d4 1
a4 1
_MODKDE4_STABLE =	4.14.2
@


1.29
log
@Welcome, KDE 4.14.2!

Many patches went upstream, but even more patches are still there...
To be continued!
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.28 2014/10/05 19:18:56 zhuk Exp $
d41 2
@


1.28
log
@Don't override EXTRACT_SUFX in case of GH_COMMIT set.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.27 2014/10/04 12:59:26 zhuk Exp $
d4 1
a4 1
_MODKDE4_STABLE =	4.13.3
@


1.27
log
@Make life of people trying to test upcoming KDE releases a bit easier
by adding @@pkgpath x11/kde4/foo,-bar for every x11/kde4xyz/foo,-bar.

No effect on x11/kde4/* builds.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.26 2014/10/03 00:01:11 zhuk Exp $
d57 3
d61 1
@


1.26
log
@Avoid annoying warnings in KDE4 land due to CMP0026. Patches to fix
the actual problem will go to KDE 4.14, if it will ever get needed.
For now, we can just feel safe that next CMake update won't break KDE4
builds.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.25 2014/10/02 23:57:46 zhuk Exp $
d43 6
@


1.25
log
@No need to set COPTS/CXXOPTS, which are user variables anyway. -O0 and -g
will be added automatically for "debug" FLAVOR.

No effect on non-debug builds, so no bump needed.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.24 2014/08/10 10:13:18 espie Exp $
d250 1
a250 1
# KDE 4.11 doesn't play well with NEW CMP0022
d252 3
@


1.24
log
@_FAKESUDO where needed, from naddy
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.23 2014/07/18 08:17:07 zhuk Exp $
d199 1
a199 1
# No optimization, debug symbols included, qDebug/kDebug enabled
a201 2
COPTS +=		-O0 -ggdb
CXXOPTS +=		-O0 -ggdb
d203 1
a203 1
# Optimization for speed, debug symbols stripped, qDebug/kDebug disabled
@


1.23
log
@Small bugfix KDE 4.13.3. Release announcement:
http://www.kde.org/announcements/announce-4.13.3.php
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.22 2014/07/18 08:11:47 zhuk Exp $
d313 1
a313 1
MODKDE4_pre-fake =	${SUDO} ${INSTALL_DATA_DIR} ${WRKINST}/${PREFIX}/include/kde4;
@


1.22
log
@When dealing with "non-stable" KDE FLAVORs, strip last part from KDE
version in MODKDE4_DEP_VERSION as well. Doesn't affect normal builds.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.21 2014/07/15 18:06:00 zhuk Exp $
d4 1
a4 1
_MODKDE4_STABLE =	4.13.2
@


1.21
log
@Do not add devel/cmake to MODULES when CONFIGURE_STYLE doesn't contain the
"cmake" word. Forgot to commit that bit at the hackathon, and this broke
multimedia/mlt.

Noticed by espie@@
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.20 2014/07/09 20:03:22 zhuk Exp $
d32 1
a32 1
MODKDE4_DEP_VERSION ?=	${_v}
@


1.20
log
@"small update" (c) tedu@@

Here KDE 4.13.2 comes. Big release changelogs could be read here:

  http://www.kde.org/announcements/4.12/
  http://www.kde.org/announcements/4.13/

Critical things you should be aware of:

  1. Nepomuk is gone, it's superseeded by Baloo. Nepomuk libraries
     are still here, though, but they do rely on Baloo internally.

  2. kdnssd was renamed to zeroconf-ioslave;

  3. kwallet was renamed to kwalletmanager;

  4. Akonadi cache will be rebuilt; this could result in change
     of PIM folder indexes, which in turn could mess up your
     mail filters - beware.

  5. ... a lot of other little problems that always happen during
     update.

Things could be broken for a day or two in subtle ways - don't
hesistate on reporting them!
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.19 2014/06/28 16:45:00 zhuk Exp $
a53 3
MODULES +=		devel/cmake
SEPARATE_BUILD ?=	flavored

d58 5
@


1.19
log
@Replace ${MODKDE4_DEP_VERSION} with 4.11 for "workspace" option.

Plasma developers choosed to have 4.11.x releases. Yes, you'll have, say,
kde-workspace-4.10.10 among KDE 4.13 packages.

No-op for now, will matter in the near future.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.18 2014/01/15 19:42:08 zhuk Exp $
d4 1
a4 1
_MODKDE4_STABLE =	4.11.5
d102 3
@


1.18
log
@KDE 4.11.5. Some highlights:

Three Kate plugins written in Python migrated to Python 3 and thus
are not available for the moment.

kdelibs-4.x deconflicted with kdebindings-3.x, and kde-runtime-4.x
deconflicted with kdebase-3.x. Most notable change is the renaming
of kreadconfig and kwriteconfig by appending a "4" suffix to them.
All ports in CVS and in WIP repo are checked for usage of all renamed
binaries, but anything else could be broken. Sorry.

KWin renamed in kde-workspace again, to avoid conflict with
KFourInLine.

Default dependencies that came from kde4.port.mk now have additional
restriction ",<5". KDE Frameworks won't hit CVS during current cycle
but it's better to be proactive.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.17 2013/12/08 19:13:29 zhuk Exp $
d155 1
a155 1
MODKDE4_BUILD_DEPENDS +=	${MODKDE4_DEP_DIR}/workspace>=${MODKDE4_DEP_VERSION},<5
d186 1
a186 1
MODKDE4_LIB_DEPENDS +=		${MODKDE4_DEP_DIR}/workspace>=${MODKDE4_DEP_VERSION},<5
@


1.17
log
@Move on to KDE 4.11.4.

In this release, four "fat" packages were split:

  * kdeadmin
  * kdenetwork
  * kdesdk
  * kdetoys

To make updates reliable, we provide corresponding meta-packages now.

Many new patches in x11/kde4 correspond to the linking problems detected.
Those are planned to integrate upstream but probably we'll have to keep
some of them until KDE 5.

For information about major KDE 4.11 features, look at the official site:
http://www.kde.org/announcements/4.11/

Kopete Jingle support is disabled for now, until googletalk-call gets
cured from permanent coredumping.

This update involved a lot of help and patience for my mistakes from
many people, including ajacoutot@@, espie@@, naddy@@... but most of the
times this was landry@@ who definitely deserves personal "thank you"!
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.16 2013/11/26 21:22:36 zhuk Exp $
d4 1
a4 1
_MODKDE4_STABLE =	4.11.4
d155 1
a155 1
MODKDE4_BUILD_DEPENDS +=	${MODKDE4_DEP_DIR}/workspace>=${MODKDE4_DEP_VERSION}
d158 1
a158 1
MODKDE4_BUILD_DEPENDS +=	${MODKDE4_DEP_DIR}/libs,-main>=${MODKDE4_DEP_VERSION}
d167 1
a167 1
MODKDE4_LIB_DEPENDS +=		${MODKDE4_DEP_DIR}/libs,-main>=${MODKDE4_DEP_VERSION}
d170 1
a170 1
MODKDE4_LIB_DEPENDS +=		${MODKDE4_DEP_DIR}/pimlibs>=${MODKDE4_DEP_VERSION}
d175 1
a175 1
MODKDE4_LIB_DEPENDS +=		${MODKDE4_DEP_DIR}/libkdegames>=${MODKDE4_DEP_VERSION}
d180 1
a180 1
MODKDE4_RUN_DEPENDS +=		${MODKDE4_DEP_DIR}/runtime,-main>=${MODKDE4_DEP_VERSION}
d182 1
a182 1
MODKDE4_RUN_DEPENDS +=		${MODKDE4_DEP_DIR}/pim-runtime>=${MODKDE4_DEP_VERSION}
d186 1
a186 1
MODKDE4_LIB_DEPENDS +=		${MODKDE4_DEP_DIR}/workspace>=${MODKDE4_DEP_VERSION}
@


1.16
log
@Zap the comment forgotten in previous commit, spotted by Amit Kulkarni.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.15 2013/11/26 09:30:20 zhuk Exp $
d4 1
a4 1
_MODKDE4_STABLE =	4.10.5
d158 1
a158 1
MODKDE4_BUILD_DEPENDS +=	${MODKDE4_DEP_DIR}/libs>=${MODKDE4_DEP_VERSION}
d167 1
a167 1
MODKDE4_LIB_DEPENDS +=		${MODKDE4_DEP_DIR}/libs>=${MODKDE4_DEP_VERSION}
d180 1
a180 1
MODKDE4_RUN_DEPENDS +=		${MODKDE4_DEP_DIR}/runtime>=${MODKDE4_DEP_VERSION}
d246 3
@


1.15
log
@cmake.port.mk already requires CMake 2.8.11, no point for explicit depend
on >=2.8.9 in kde4.port.mk.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.14 2013/11/25 16:26:08 zhuk Exp $
a120 1
# Force CMake which has merged KDE modules.
@


1.14
log
@Do not force MODKDE4_VERSION even if MODKDE4_FLAVOR detected.

Does not affect x11/kde4 but unbreaks custom kde4* dirs with MODKDE4_VERSION
forced (hello from kde-wallpapers).
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.13 2013/11/11 14:13:29 zhuk Exp $
d123 1
a123 2
MODKDE4_BUILD_DEPENDS =	STEM->=2.8.9:devel/cmake \
			textproc/docbook \
@


1.13
log
@Avoid pulling extra dependencies if NO_BUILD=Yes. No-op for current builds,
but will be needed for meta/kde4.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.12 2013/10/10 11:53:24 zhuk Exp $
d31 1
a31 1
MODKDE4_VERSION =	${_v}
@


1.12
log
@Force disabling of tests if NO_TEST==Yes. Will be needed soon.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.11 2013/10/07 16:57:29 espie Exp $
d262 1
a263 1

d265 1
@


1.11
log
@fucked-up heuristics. Still need to be able to finetune, as
graphics-strigi-analyzer and kimono ARE kde4 only
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.10 2013/10/06 14:42:24 zhuk Exp $
d231 2
@


1.10
log
@Make darn sure KDE4 ports look at the KDE4-specific places first. Won't
change a thing as of now but will be meaningful in the near future, when
KDE3 and KDE4 packages will start co-existing.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.9 2013/10/06 10:51:48 zhuk Exp $
d137 7
a143 1
.if !empty(MODKDE4_USE)
@


1.9
log
@Mark kdelibs-4.x and all dependers with DPB_PROPERTIES+=tag:kde4.

okay espie@@
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.8 2013/10/06 10:23:37 zhuk Exp $
d236 4
@


1.8
log
@automoc4 is needed for KDE4 "resources" ports, too.

spotted by espie@@
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.7 2013/07/04 00:44:21 zhuk Exp $
d135 4
@


1.7
log
@Update to KDE 4.10.5. Some highlights:
  * @@conflict markers relative to KDE3 packages added, to be used soon.
  * Migration to Ruby 1.9 for corresponding ports. Also added @@pkgpath to
    x11/ruby-qt4 in x11/kde4/ruby-qt, because they are really the same
    (except that x11/ruby-qt4 contains also smokegen and smokeqt stuff).
  * kde-base-artwork and kde-wallpapers leaved at 4.10.4 because they:
    1) did not change; 2) are heavy enough.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.6 2013/06/06 08:36:47 zhuk Exp $
a103 1
MODKDE4_NO_QT ?=	Yes
d137 6
a152 6
# Small hack, until automoc4 will be gone
PKGNAME ?= ${DISTNAME}
.   if !${PKGNAME:Mautomoc4-*}
MODKDE4_BUILD_DEPENDS +=	devel/automoc
.   endif

@


1.6
log
@Bugfix update to KDE 4.10.4. Tested with upcoming CMake 2.8.11.
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.5 2013/05/14 09:16:25 zhuk Exp $
d4 1
a4 1
_MODKDE4_STABLE =	4.10.4
@


1.5
log
@Bugfix update KDE4 to 4.10.3 version, including some tweaks:

  * Bump all SHARED_LIBS to 50.0, to avoid future clashes with KDE3
    libraries (based on input from espie@@);
  * Enable support for Telepathy in kdenetwork (see recently committed
    net/telepathy/telepathy-qt);
  * Fix build of analitza when GNU readline is installed (thanks kirby@@
    for pointing to GNU readline issue in general).
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.4 2013/04/27 20:22:36 zhuk Exp $
d4 1
a4 1
_MODKDE4_STABLE =	4.10.3
@


1.4
log
@Stupid me, pre-fake target has PREFIX == TRUEPREFIX. Should fix some
failures that testers didn't hit yet.

From warning noticed by RD Thrush on ports@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.3 2013/04/24 10:37:15 zhuk Exp $
d4 1
a4 1
_MODKDE4_STABLE =	4.10.2
@


1.3
log
@Update KDE 4 infrastructure.

okay landry@@
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.2 2013/03/11 11:46:13 espie Exp $
d291 1
a291 1
MODKDE4_pre-fake =	${SUDO} ${INSTALL_DATA_DIR} ${PREFIX}/include/kde4;
@


1.2
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: kde4.port.mk,v 1.1 2013/02/02 09:27:37 zhuk Exp $
d4 1
a4 1
_MODKDE4_STABLE =	4.4.5
d6 39
a44 1
# Should be changed only by Makefile.inc in test directories
d46 1
a46 4
MODKDE_VERSION =	${MODKDE4_VERSION}

# Version to be used for SC dependencies by default
MODKDE4_DEP_VERSION =	${MODKDE4_VERSION:R}
a52 2
CATEGORIES +=		x11/kde4

d59 1
a59 1
.  if "${CONFIGURE_STYLE}" == ""
d61 1
a61 1
.  endif
d104 1
a104 1
MODKDE_NO_QT ?=		Yes
d122 3
a124 5
# 1. Force CMake which has merged KDE modules
# 2. Various distfiles contain long paths, necessitating an archiver
# compliant with POSIX.1-2001 extended headers.
MODKDE4_BUILD_DEPENDS =	archivers/gtar \
			STEM->=2.8.9:devel/cmake \
a131 2
TAR =			${LOCALBASE}/bin/gtar

a133 4
.ifdef MODKDE_NO_QT
MODKDE4_NO_QT ?=	${MODKDE_NO_QT}
.endif

d142 1
a142 1
MODKDE4_BUILD_DEPENDS +=	STEM->=${MODKDE4_DEP_VERSION}:x11/kde4/workspace
d145 1
a145 1
MODKDE4_BUILD_DEPENDS +=	STEM->=${MODKDE4_DEP_VERSION}:x11/kde4/libs
d160 2
a161 2
MODKDE4_LIB_DEPENDS +=		STEM->=${MODKDE4_DEP_VERSION}:x11/kde4/libs
MODKDE4_WANTLIB +=		kdecore>=8
d163 1
a163 1
MODKDE4_LIB_DEPENDS +=		STEM->=${MODKDE4_DEP_VERSION}:x11/kde4/pimlibs
d168 2
a169 2
MODKDE4_LIB_DEPENDS +=		STEM->=${MODKDE4_DEP_VERSION}:x11/kde4/libkdegames
MODKDE4_WANTLIB +=		kdegames
d173 1
a173 1
MODKDE4_RUN_DEPENDS +=		STEM->=${MODKDE4_DEP_VERSION}:x11/kde4/runtime
d175 1
a175 1
MODKDE4_RUN_DEPENDS +=		STEM->=${MODKDE4_DEP_VERSION}:x11/kde4/pim-runtime
d179 1
a179 1
MODKDE4_LIB_DEPENDS +=		STEM->=${MODKDE4_DEP_VERSION}:x11/kde4/workspace
a197 23
MODKDE4_INCLUDE_DIR =	include/kde4
MODKDE4_LIB_DIR =	lib/kde4/private
MODKDE_INCLUDE_DIR =	${MODKDE4_INCLUDE_DIR}
MODKDE_LIB_DIR =	${MODKDE4_LIB_DIR}

# Use right directories
MODKDE4_CONF_ARGS +=	-DMAN_INSTALL_DIR:Path=${PREFIX}/man \
			-DINFO_INSTALL_DIR:Path=${PREFIX}/info \
			-DLIBEXEC_INSTALL_DIR:Path=${PREFIX}/libexec \
			-DSYSCONF_INSTALL_DIR:Path=${SYSCONFDIR}

# Avoid conflicts with KDE3.
# Libraries are handled in kde4-post-install target, see below.
MODKDE4_CONF_ARGS +=	-DINCLUDE_INSTALL_DIR:Path=${MODKDE4_INCLUDE_DIR} \
			-DKDE4_LIB_INSTALL_DIR:Path=${PREFIX}/${MODKDE4_LIB_DIR}

# Enable PIE if supported by platform
. if !empty(PIE_ARCH:M${ARCH})
MODKDE4_CONF_ARGS +=	-DKDE4_ENABLE_FPIE:Bool=Yes
. else
MODKDE4_CONF_ARGS +=	-DKDE4_ENABLE_FPIE:Bool=No
. endif

d209 9
d224 9
a232 8
# Set up directories
MODKDE4_CONF_ARGS +=	-DKDE4_INCLUDE_INSTALL_DIR:String=${PREFIX}/${MODKDE4_INCLUDE_DIR} \
			-DKDE4_INSTALL_DIR:String=${PREFIX} \
			-DKDE4_LIB_INSTALL_DIR:String=${PREFIX}/lib \
			-DKDE4_LIBEXEC_INSTALL_DIR:String=${PREFIX}/libexec \
			-DKDE4_INFO_INSTALL_DIR:String=${PREFIX}/info \
			-DKDE4_MAN_INSTALL_DIR:String=${PREFIX}/man \
			-DKDE4_SYSCONF_INSTALL_DIR:String=${SYSCONFDIR}
a239 1
MODKDE_NO_QT ?=		${MODKDE4_NO_QT}
d246 8
a253 13
MODKDE_BUILD_DEPENDS =	${MODKDE4_BUILD_DEPENDS}
MODKDE_LIB_DEPENDS =	${MODKDE4_LIB_DEPENDS}
MODKDE_RUN_DEPENDS =	${MODKDE4_RUN_DEPENDS}
MODKDE_WANTLIB =	${MODKDE4_WANTLIB}
MODKDE_CONFIGURE_ENV =	${MODKDE4_CONFIGURE_ENV}

BUILD_DEPENDS +=	${MODKDE_BUILD_DEPENDS}

LIB_DEPENDS +=		${MODKDE_LIB_DEPENDS}

RUN_DEPENDS +=		${MODKDE_RUN_DEPENDS}
WANTLIB +=		${MODKDE_WANTLIB}
CONFIGURE_ENV +=	${MODKDE_CONFIGURE_ENV}
a256 19
# Tweak dependency path for testing directories
.if "${MODKDE4_VERSION}" != "${_MODKDE4_STABLE}"
_MODKDE4_REAL_DIR =	x11/kde${MODKDE4_VERSION:S/.//g}
CATEGORIES +=		${_MODKDE4_REAL_DIR}
BUILD_DEPENDS :=	${BUILD_DEPENDS:C@@x11/kde4/@@${_MODKDE4_REAL_DIR}/@@}
RUN_DEPENDS :=		${RUN_DEPENDS:C@@x11/kde4/@@${_MODKDE4_REAL_DIR}/@@}
LIB_DEPENDS :=		${LIB_DEPENDS:C@@x11/kde4/@@${_MODKDE4_REAL_DIR}/@@}
. if "${MULTI_PACKAGES}" != ""
.  for _s in ${MULTI_PACKAGES}
.   if defined(RUN_DEPENDS${_s})
RUN_DEPENDS${_s} :=	${RUN_DEPENDS${_s}:C@@x11/kde4/@@${_MODKDE4_REAL_DIR}/@@}
.   endif
.   if defined(LIB_DEPENDS${_s})
LIB_DEPENDS${_s} :=	${LIB_DEPENDS${_s}:C@@x11/kde4/@@${_MODKDE4_REAL_DIR}/@@}
.   endif
.  endfor
. endif
.endif

d294 2
a295 2
# 2. Create links for shared libraries in ${PREFIX}/lib/kde4/private/ ,
#    to allow using -DKDE4_LIB_INSTALL_DIR=${PREFIX}/lib/kde4/private.
d308 1
a308 1
	test -e ../../lib${_l}.so.${_v} && ln -sf ../../lib${_l}.so.${_v};
@


1.1
log
@Add x11/kde4 port module. Needed for upcoming devel/automoc.

"put it in cvs, we'll polish the turd in-tree" landry@@
@
text
@d1 1
a1 1
# $OpenBSD$
d208 1
a208 1
. if "${NO_REGRESS:L}" != "yes"
@

