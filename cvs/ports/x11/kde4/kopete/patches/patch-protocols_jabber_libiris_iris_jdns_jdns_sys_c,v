head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.12
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.10
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.8
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.4
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.6
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.2
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.2.0.2
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.1.1.1.0.2
	OPENBSD_5_5_BASE:1.1.1.1
	zhuk_20131208:1.1.1.1
	zhuk:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2014.11.01.21.09.43;	author zhuk;	state Exp;
branches;
next	1.2;
commitid	yISoHfVgp7MFifJl;

1.2
date	2014.07.09.20.03.27;	author zhuk;	state Exp;
branches;
next	1.1;
commitid	VIGhneE7m6586cHK;

1.1
date	2013.12.08.18.39.44;	author zhuk;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2013.12.08.18.39.44;	author zhuk;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Welcome, KDE 4.14.2!

Many patches went upstream, but even more patches are still there...
To be continued!
@
text
@$OpenBSD: patch-protocols_jabber_libiris_iris_jdns_jdns_sys_c,v 1.2 2014/07/09 20:03:27 zhuk Exp $
Make this stuff compile and work on OpenBSD.
Partly from net/psi port.
--- protocols/jabber/libiris/src/jdns/src/jdns/jdns_sys.c.orig	Thu Jun  5 09:25:17 2014
+++ protocols/jabber/libiris/src/jdns/src/jdns/jdns_sys.c	Wed Jul  9 15:45:21 2014
@@@@ -727,7 +727,7 @@@@ static int my_res_init()
 //   specify the platforms that have __res_state_ext
 //#ifdef __res_state_ext
 #if defined(JDNS_OS_MAC) || defined(JDNS_OS_FREEBSD) || \
-    defined(JDNS_OS_NETBSD) || defined (JDNS_OS_SOLARIS)
+    defined(JDNS_OS_NETBSD) || defined(JDNS_OS_OPENBSD) || defined (JDNS_OS_SOLARIS)
 # define USE_EXTEXT
 #endif
 
@@@@ -736,14 +736,20 @@@@ static jdns_dnsparams_t *dnsparams_get_unixsys()
 	int n;
 	jdns_dnsparams_t *params;
 
-#ifdef JDNS_MODERN_RES_API
+#if defined(__OpenBSD__)
+	n = my_res_init();
+#define RESVAR _res
+#define RESEXTVAR _res_ext
+#elif defined(JDNS_MODERN_RES_API)
 	struct __res_state res;
 	memset(&res, 0, sizeof(struct __res_state));
 	n = res_ninit(&res);
 #define RESVAR res
+#define RESEXTVAR res._u._ext
 #else
 	n = my_res_init();
 #define RESVAR _res
+#define RESEXTVAR _res._u._ext
 #endif
 
 	params = jdns_dnsparams_new();
@@@@ -753,23 +759,27 @@@@ static jdns_dnsparams_t *dnsparams_get_unixsys()
 		return params;
 
 	// nameservers - ipv6
-#ifdef __GLIBC__
-	for(n = 0; n < MAXNS && n < RESVAR._u._ext.nscount6; ++n)
+#if defined(__GLIBC__)
+	for(n = 0; n < MAXNS && n < RESEXTVAR.nscount6; ++n)
+#elif defined(__OpenBSD__)
+	for(n = 0; n < MAXNS; ++n)
 #else
-	for(n = 0; n < MAXNS && n < RESVAR._u._ext.nscount; ++n)
+	for(n = 0; n < MAXNS && n < RESEXTVAR.nscount; ++n)
 #endif
 	{
 		jdns_address_t *addr;
 		struct sockaddr_in6 *sa6;
 
-#ifdef USE_EXTEXT
+#if defined(__OpenBSD__)
+		sa6 = (struct sockaddr_in6 *)&RESEXTVAR.nsaddr_list[n];
+#elif defined(USE_EXTEXT)
 		// seems _ext.ext can be null in some cases...
-		if(RESVAR._u._ext.ext == NULL)
+		if(RESEXTVAR.ext == NULL)
 			break;
 
-		sa6 = ((struct sockaddr_in6 *)RESVAR._u._ext.ext) + n;
+		sa6 = ((struct sockaddr_in6 *)RESEXTVAR.ext) + n;
 #else
-		sa6 = RESVAR._u._ext.nsaddrs[n];
+		sa6 = RESEXTVAR.nsaddrs[n];
 #endif
 
 		if(sa6 == NULL)
@@@@ -833,13 +843,17 @@@@ static jdns_dnsparams_t *dnsparams_get_unix()
 {
 	jdns_dnsparams_t *params;
 
-	// prefer system calls over files
+	// prefer system calls over files where possible
+#ifdef JDNS_OS_OPENBSD
+	params = dnsparams_get_unixfiles();
+#else
 	params = dnsparams_get_unixsys();
 	if(params->nameservers->count == 0)
 	{
 		jdns_dnsparams_delete(params);
 		params = dnsparams_get_unixfiles();
 	}
+#endif
 
 	apply_hosts_file(params, "/etc/hosts");
 
@


1.2
log
@"small update" (c) tedu@@

Here KDE 4.13.2 comes. Big release changelogs could be read here:

  http://www.kde.org/announcements/4.12/
  http://www.kde.org/announcements/4.13/

Critical things you should be aware of:

  1. Nepomuk is gone, it's superseeded by Baloo. Nepomuk libraries
     are still here, though, but they do rely on Baloo internally.

  2. kdnssd was renamed to zeroconf-ioslave;

  3. kwallet was renamed to kwalletmanager;

  4. Akonadi cache will be rebuilt; this could result in change
     of PIM folder indexes, which in turn could mess up your
     mail filters - beware.

  5. ... a lot of other little problems that always happen during
     update.

Things could be broken for a day or two in subtle ways - don't
hesistate on reporting them!
@
text
@d1 1
a1 1
$OpenBSD: patch-protocols_jabber_libiris_iris_jdns_jdns_sys_c,v 1.1.1.1 2013/12/08 18:39:44 zhuk Exp $
d4 2
a5 2
--- protocols/jabber/libiris/src/jdns/jdns_sys.c.orig	Thu Jun  5 09:25:17 2014
+++ protocols/jabber/libiris/src/jdns/jdns_sys.c	Wed Jul  9 15:45:21 2014
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD: patch-kopete_protocols_jabber_libiris_iris_jdns_jdns_sys_c,v 1.2 2013/04/24 19:48:51 zhuk Exp $
d4 2
a5 2
--- protocols/jabber/libiris/src/jdns/jdns_sys.c.orig	Wed Aug 28 21:16:17 2013
+++ protocols/jabber/libiris/src/jdns/jdns_sys.c	Sun Dec  8 15:01:22 2013
d7 2
a8 2
 /*    specify the platforms that have __res_state_ext */
 /* #ifdef __res_state_ext */
d15 23
a37 1
@@@@ -753,12 +753,18 @@@@ static jdns_dnsparams_t *dnsparams_get_unixsys()
d40 11
a50 6
 	/*  nameservers - ipv6 */
+#if defined(JDNS_OS_OPENBSD)
+	for(n = 0; n < MAXNS && n < RESVAR.nscount; ++n)
+#else
 	for(n = 0; n < MAXNS && n < RESVAR._u._ext.nscount; ++n)
+#endif
d56 2
a57 2
+#if defined(JDNS_OS_OPENBSD)
+               sa6 = (struct sockaddr_in6 *)(_res_ext.nsaddr_list + n);
d59 3
a61 2
 		/*  seems _ext.ext can be null in some cases... */
 		if(RESVAR._u._ext.ext == NULL)
d63 10
a72 1
@@@@ -829,6 +835,9 @@@@ static jdns_dnsparams_t *dnsparams_get_unix()
d76 2
a80 1
 	/*  prefer system calls over files */
d83 1
a83 1
@@@@ -836,6 +845,7 @@@@ static jdns_dnsparams_t *dnsparams_get_unix()
@


1.1.1.1
log
@Kopete is an instant messenger supporting AIM, Bonjour, Gadu-Gadu,
GroupWise, ICQ, Jabber (XMPP, Google Talk, Facebook, ...), Meanwhile,
QQ, Skype, Windows Live Messenger, WinPopup, Yahoo and more. It is
designed to be a flexible and extensible multi-protocol system
suitable for personal and enterprise use.

The goal of Kopete is to provide users with a single easy-to-use
way to access all of their instant messaging systems. The interface
puts people first, and is integrated with the system address book
to let you access your contacts from other KDE applications. Instant
messaging can be intrusive, but Kopete's notification system can
be tuned so that only important contacts interrupt you.

Kopete also features tools to enhance your instant messaging
experience, such as message encryption, archiving, and many other
fun and useful effects.

This is ex-kdenetwork member. Importing as a part of KDE 4.11.4 update.
This port won't work until update is finished, thus not hooking it up.
@
text
@@
