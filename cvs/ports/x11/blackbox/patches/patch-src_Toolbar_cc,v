head	1.2;
access;
symbols
	OPENBSD_6_0:1.2.0.12
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.8
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.10
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.6
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.4
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.2
	OPENBSD_5_5_BASE:1.2;
locks; strict;
comment	@# @;


1.2
date	2013.09.01.12.49.12;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2013.08.16.19.37.45;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@blackbox patches from patrick keshishian,

- improvement in handling of UTF-8 window titles, see
http://marc.info/?l=openbsd-ports&m=137339931231574&w=2

- 64-bit time_t fix

- avoid "deprecated conversion from string constant to 'char*'" warnings

also sync wantlib and drop USE_GROFF while there.
@
text
@$OpenBSD: patch-src_Toolbar_cc,v 1.1 2013/08/16 19:37:45 naddy Exp $

64bit time_t fix.

--- src/Toolbar.cc.orig	Tue Apr 12 00:38:00 2005
+++ src/Toolbar.cc	Sat Aug 17 22:47:24 2013
@@@@ -40,12 +40,14 @@@@
 #include <assert.h>
 
 
-long nextTimeout(int resolution)
+time_t nextTimeout(int resolution)
 {
   timeval now;
   gettimeofday(&now, 0);
-  return (std::max(1000l, ((((resolution - (now.tv_sec % resolution)) * 1000l))
-                           - (now.tv_usec / 1000l))));
+  time_t	t;
+  t = (resolution - (now.tv_sec % resolution)) * 1000l;
+  t -= now.tv_usec / 1000l;
+  return std::max(t, (time_t)1000);
 }
 
 
@


1.1
log
@fix build failure when time_t is long long; from NetBSD
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
Fix build failure when time_t is long long.
d5 8
a12 4
--- src/Toolbar.cc.orig	Tue Apr 12 09:38:00 2005
+++ src/Toolbar.cc	Fri Aug 16 21:33:33 2013
@@@@ -43,8 +43,10 @@@@
 long nextTimeout(int resolution)
a14 1
+  int secs;
d17 5
a21 3
+  secs = now.tv_sec % resolution;
+  return (std::max(1000l, ((((resolution - secs) * 1000l))
                            - (now.tv_usec / 1000l))));
d23 1
@

