head	1.4;
access;
symbols
	OPENBSD_4_6:1.1.0.2
	OPENBSD_4_6_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2009.08.20.20.21.12;	author landry;	state dead;
branches;
next	1.3;

1.3
date	2009.08.06.09.32.50;	author landry;	state Exp;
branches;
next	1.2;

1.2
date	2009.07.18.08.21.35;	author landry;	state Exp;
branches;
next	1.1;

1.1
date	2009.05.11.20.49.44;	author landry;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to exo-0.3.102, bugfix and translations release.
Add some autohell magic to make it correctly detect sys/mount.h and sys/ucred.h
@
text
@$OpenBSD: patch-exo-open_main_c,v 1.3 2009/08/06 09:32:50 landry Exp $
--- exo-open/main.c.orig	Sat Apr 11 12:09:56 2009
+++ exo-open/main.c	Thu Aug  6 11:22:09 2009
@@@@ -36,7 +36,19 @@@@
 #include <exo/exo.h>
 
 
+/**
+ * For testing this code the following commands should work:
+ * 
+ * exo-open --launch WebBrowser http://xfce.org (bug #5461).
+ * exo-open http://xfce.org
+ * exo-open --launch TerminalEmulator ./script.sh 'something with a space' 'nospace' (bug #5132).
+ * exo-open --launch TerminalEmulator ssh -l username some.host.com
+ * xfterm4 -e ssh -l ssh -l username some.host.com (bug #5301, this generates line below)
+ *   exo-open --launch TerminalEmulator 'ssh -l username some.host.com'
+ **/
 
+
+
 static gboolean opt_help = FALSE;
 static gboolean opt_version = FALSE;
 static gchar   *opt_launch = NULL;
@@@@ -110,6 +122,7 @@@@ main (int argc, char **argv)
   g_option_context_set_help_enabled (context, FALSE);
   g_option_context_add_main_entries (context, entries, GETTEXT_PACKAGE);
   g_option_context_add_group (context, gtk_get_option_group (TRUE));
+  g_option_context_set_ignore_unknown_options (context, TRUE);
   if (!g_option_context_parse (context, &argc, &argv, &err))
     {
       g_fprintf (stderr, "exo-open: %s.\n", err->message);
@@@@ -142,6 +155,8 @@@@ main (int argc, char **argv)
     {
       if (argc > 1)
         {
+          /* NOTE: see the comment at the top of this document! */
+
           /* combine all specified parameters to one parameter string */
           join = g_string_new (NULL);
           for (i = 1; argv[i] != NULL; i++)
@@@@ -149,11 +164,20 @@@@ main (int argc, char **argv)
               /* separate the arguments */
               if (i > 1)
                 join = g_string_append_c (join, ' ');
-
-              /* append the quoted argument */
-              quoted = g_shell_quote (argv[i]);
-              join = g_string_append (join, quoted);
-              g_free (quoted);
+              
+              /* only quote arguments with spaces if there are multiple
+               * arguments to be merged, this is a bit of magic to make
+               * common cares work property, see sample above with xfrun4 */
+              if (argc > 2 && strchr (argv[i], ' ') != NULL)
+                {
+                  quoted = g_shell_quote (argv[i]);
+                  join = g_string_append (join, quoted);
+                  g_free (quoted);
+                }
+              else
+                {
+                  join = g_string_append (join, argv[i]);
+                }
             }
           parameter = g_string_free (join, FALSE);
         }
@@@@ -161,6 +185,10 @@@@ main (int argc, char **argv)
         {
           parameter = NULL;
         }
+
+#ifndef NDEBUG
+      g_message ("launch=%s, wd=%s, parameters (%d)=%s", opt_launch, opt_working_directory, argc, parameter);
+#endif
 
       /* run the preferred application */
       if (!exo_execute_preferred_application (opt_launch, parameter, opt_working_directory, NULL, &err))
@


1.3
log
@Whoops, re-backport some fixes for xfterm4 from trunk, and re-add a line
that accidentally went away in last commit - breaking the intended
functionality. bump PKGNAME.
@
text
@d1 1
a1 1
$OpenBSD: patch-exo-open_main_c,v 1.2 2009/07/18 08:21:35 landry Exp $
@


1.2
log
@Backport upstream svn r30251, fixing bug #5461.
This fixes opening help files in various xfce apps.
@
text
@d1 4
a4 4
$OpenBSD: patch-exo-open_main_c,v 1.1 2009/05/11 20:49:44 landry Exp $
--- exo-open/main.c.orig	Sat Jul 18 09:58:25 2009
+++ exo-open/main.c	Sat Jul 18 10:06:48 2009
@@@@ -36,7 +36,17 @@@@
d15 2
d24 9
a32 1
@@@@ -143,6 +153,8 @@@@ main (int argc, char **argv)
d41 1
a41 1
@@@@ -150,11 +162,18 @@@@ main (int argc, char **argv)
d51 4
a54 2
+              /* only quote arguments with spaces */
+              if (strchr (argv[i], ' ') != NULL)
d67 1
a67 1
@@@@ -162,6 +181,10 @@@@ main (int argc, char **argv)
@


1.1
log
@Bring in some patches from upstream svn to fix
http://bugzilla.xfce.org/show_bug.cgi?id=5301 and
http://bugzilla.xfce.org/show_bug.cgi?id=5222.
Bump PKGNAMEs.
@
text
@d1 22
a22 9
$OpenBSD$
--- exo-open/main.c.orig	Mon May 11 21:55:30 2009
+++ exo-open/main.c	Mon May 11 21:55:48 2009
@@@@ -110,6 +110,7 @@@@ main (int argc, char **argv)
   g_option_context_set_help_enabled (context, FALSE);
   g_option_context_add_main_entries (context, entries, GETTEXT_PACKAGE);
   g_option_context_add_group (context, gtk_get_option_group (TRUE));
+  g_option_context_set_ignore_unknown_options (context, TRUE);
   if (!g_option_context_parse (context, &argc, &argv, &err))
d24 42
a65 1
       g_fprintf (stderr, "exo-open: %s.\n", err->message);
@

