head	1.3;
access;
symbols
	OPENBSD_3_7:1.2.0.6
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.4
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2
	jolan_2004-jan-13:1.1.1.1
	jolan:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2005.05.12.05.01.10;	author jolan;	state dead;
branches;
next	1.2;

1.2
date	2004.02.19.02.59.01;	author jolan;	state Exp;
branches;
next	1.1;

1.1
date	2004.01.14.05.50.05;	author jolan;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.01.14.05.50.05;	author jolan;	state Exp;
branches;
next	;


desc
@@


1.3
log
@remove 4.0.6
@
text
@$OpenBSD: patch-panel-plugin_battmon_c,v 1.2 2004/02/19 02:59:01 jolan Exp $
--- panel-plugin/battmon.c.orig	2003-09-09 08:49:35.000000000 -0500
+++ panel-plugin/battmon.c	2004-02-17 23:44:32.000000000 -0600
@@@@ -34,8 +34,9 @@@@
 #ifdef __FreeBSD__
 #include <machine/apm_bios.h>
 #elif __OpenBSD__
-#include <sys/param.h>
+#include <sys/ioctl.h>
 #include <machine/apmvar.h>
+#define APMDEVICE "/dev/apm"
 #elif __linux__
 #include <apm.h>
 #endif
@@@@ -266,11 +267,14 @@@@ update_apm_status(t_battmon *battmon)
   	battmon->method = BM_BROKEN;
   	fd = open(APMDEVICE, O_RDONLY);
   	if (fd == -1) return TRUE;
-  	if (ioctl(fd, APM_IOC_GETPOWER, &apminfo) == -1)
+  	if (ioctl(fd, APM_IOC_GETPOWER, &apm) == -1)
     		return TRUE;
   	close(fd);
   	charge = apm.battery_life;
   	time_remaining = apm.minutes_left;
+	if ((time_remaining / 60) > 99)
+	    time_remaining = 0;
+
   	acline = apm.ac_state ? TRUE : FALSE;
 	
 #else
@@@@ -402,8 +406,7 @@@@ battmon.c:241: for each function it appe
 		     g_snprintf(buffer, sizeof(buffer), _("AC off-line"));
 	}
 	add_tooltip(battmon->ebox, buffer);
-
-	if(battmon->options.display_power){
+	if(0) {
 	  gtk_widget_show((GtkWidget *)battmon->acfan);
 	  gtk_widget_show((GtkWidget *)battmon->temp);
 	  fan=get_fan_status();
@@@@ -1177,10 +1180,6 @@@@ battmon_create_options(Control *ctrl, Gt
 	gtk_widget_show(dialog->cb_disp_tooltip_time);
 	gtk_box_pack_start(GTK_BOX(vbox2), dialog->cb_disp_tooltip_time, FALSE, FALSE, 0);
 	
-	dialog->cb_disp_power = gtk_check_button_new_with_mnemonic(_("Display power"));
-	gtk_widget_show(dialog->cb_disp_power);
-	gtk_box_pack_start(GTK_BOX(vbox2), dialog->cb_disp_power, FALSE, FALSE, 0);
-
 	/* Signal connections should be set after setting tate of toggle buttons...*/
 	refresh_dialog(dialog);
 
@


1.2
log
@on macppc, when the battery is fully charged and the machine is on a/c
power, the time remaining to charge alternates between 0 minutes and 2+
months.  this makes the panel grow and shrink often (to display 2 or 4
digits) and is quite distracting.  so if we get a large charge time,
just zero the buffer.
@
text
@d1 1
a1 1
$OpenBSD: patch-panel-plugin_battmon_c,v 1.1.1.1 2004/01/14 05:50:05 jolan Exp $
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
+++ panel-plugin/battmon.c	2004-01-13 23:28:02.000000000 -0600
d15 1
a15 1
@@@@ -266,7 +267,7 @@@@ update_apm_status(t_battmon *battmon)
d24 8
a31 1
@@@@ -402,8 +403,7 @@@@ battmon.c:241: for each function it appe
d41 1
a41 1
@@@@ -1177,10 +1177,6 @@@@ battmon_create_options(Control *ctrl, Gt
@


1.1.1.1
log
@import of xfce4-battery-plugin-0.2.0.
@
text
@@
