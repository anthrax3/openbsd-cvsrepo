head	1.3;
access;
symbols
	OPENBSD_4_1:1.2.0.6
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.4
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.2
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.1.1.1.0.2
	OPENBSD_3_8_BASE:1.1.1.1
	jolan_2005-may-11:1.1.1.1
	jolan:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2007.05.12.10.30.51;	author bernd;	state dead;
branches;
next	1.2;

1.2
date	2005.11.10.22.57.39;	author jolan;	state Exp;
branches;
next	1.1;

1.1
date	2005.05.12.04.38.49;	author jolan;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.05.12.04.38.49;	author jolan;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to xfce4-battery-0.5.0.

help & okay steven@@
@
text
@$OpenBSD: patch-panel-plugin_battmon_c,v 1.2 2005/11/10 22:57:39 jolan Exp $
--- panel-plugin/battmon.c.orig	Sat Aug  6 04:30:51 2005
+++ panel-plugin/battmon.c	Thu Nov 10 15:39:52 2005
@@@@ -35,8 +35,9 @@@@
 #ifdef __FreeBSD__
 #include <machine/apm_bios.h>
 #elif __OpenBSD__
-#include <sys/param.h>
+#include <sys/ioctl.h>
 #include <machine/apmvar.h>
+#define APMDEVICE "/dev/apm"
 #elif __linux__
 #include <apm.h>
 #endif
@@@@ -272,11 +273,14 @@@@ update_apm_status(t_battmon *battmon)
   	battmon->method = BM_BROKEN;
   	fd = open(APMDEVICE, O_RDONLY);
   	if (fd == -1) return TRUE;
-  	if (ioctl(fd, APM_IOC_GETPOWER, &apminfo) == -1)
+  	if (ioctl(fd, APM_IOC_GETPOWER, &apm) == -1)
     		return TRUE;
   	close(fd);
   	charge = apm.battery_life;
   	time_remaining = apm.minutes_left;
+	if ((time_remaining / 60) > 99)
+	    time_remaining = 0;
+
   	acline = apm.ac_state ? TRUE : FALSE;
 	
 #else
@@@@ -415,8 +419,7 @@@@ battmon.c:241: for each function it appe
 		     g_snprintf(buffer, sizeof(buffer), _("AC off-line"));
 	}
 	add_tooltip(battmon->ebox, buffer);
-
-	if(battmon->options.display_power){
+	if(0) {
 	  gtk_widget_show((GtkWidget *)battmon->acfan);
 	  gtk_widget_show((GtkWidget *)battmon->temp);
 	  fan=get_fan_status();
@@@@ -1214,10 +1217,6 @@@@ battmon_create_options(Control *ctrl, Gt
 	gtk_widget_show(dialog->cb_disp_tooltip_time);
 	gtk_box_pack_start(GTK_BOX(vbox2), dialog->cb_disp_tooltip_time, FALSE, FALSE, 0);
 	
-	dialog->cb_disp_power = gtk_check_button_new_with_mnemonic(_("Display power"));
-	gtk_widget_show(dialog->cb_disp_power);
-	gtk_box_pack_start(GTK_BOX(vbox2), dialog->cb_disp_power, FALSE, FALSE, 0);
-
 	dialog->cb_disp_icon = gtk_check_button_new_with_mnemonic(_("Display icon"));
 	gtk_widget_show(dialog->cb_disp_icon);
 	gtk_box_pack_start(GTK_BOX(vbox2), dialog->cb_disp_icon, FALSE, FALSE, 0);
@


1.2
log
@"update"
@
text
@d1 1
a1 1
$OpenBSD: patch-panel-plugin_battmon_c,v 1.1.1.1 2005/05/12 04:38:49 jolan Exp $
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD: patch-panel-plugin_battmon_c,v 1.2 2004/02/19 02:59:01 jolan Exp $
--- panel-plugin/battmon.c.orig	2003-09-09 08:49:35.000000000 -0500
+++ panel-plugin/battmon.c	2004-02-17 23:44:32.000000000 -0600
@@@@ -34,8 +34,9 @@@@
d15 1
a15 1
@@@@ -266,11 +267,14 @@@@ update_apm_status(t_battmon *battmon)
d31 1
a31 1
@@@@ -402,8 +406,7 @@@@ battmon.c:241: for each function it appe
d41 1
a41 1
@@@@ -1177,10 +1180,6 @@@@ battmon_create_options(Control *ctrl, Gt
d49 3
a51 3
 	/* Signal connections should be set after setting tate of toggle buttons...*/
 	refresh_dialog(dialog);
 
@


1.1.1.1
log
@xfce 4.2.1
@
text
@@
