head	1.3;
access;
symbols
	OPENBSD_4_3:1.2.0.4
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.2
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.1.1.1.0.8
	OPENBSD_4_1_BASE:1.1.1.1
	OPENBSD_4_0:1.1.1.1.0.6
	OPENBSD_4_0_BASE:1.1.1.1
	OPENBSD_3_9:1.1.1.1.0.4
	OPENBSD_3_9_BASE:1.1.1.1
	OPENBSD_3_8:1.1.1.1.0.2
	OPENBSD_3_8_BASE:1.1.1.1
	jolan_2005-may-11:1.1.1.1
	jolan:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2008.04.17.13.14.28;	author landry;	state dead;
branches;
next	1.2;

1.2
date	2007.05.11.14.02.02;	author steven;	state Exp;
branches;
next	1.1;

1.1
date	2005.05.12.04.38.50;	author jolan;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.05.12.04.38.50;	author jolan;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to diskperf-plugin 2.2.0, not BROKEN anymore.
I took over upstream maintenance and integrated our patches.

ok ajacoutot@@
@
text
@$OpenBSD: patch-panel-plugin_main_c,v 1.2 2007/05/11 14:02:02 steven Exp $
--- panel-plugin/main.c.orig	Thu Jan 18 18:12:07 2007
+++ panel-plugin/main.c	Fri May 11 15:52:04 2007
@@@@ -80,7 +80,7 @@@@ typedef enum monitor_bar_order_t {
 typedef struct param_t {
     /* Configurable parameters */
     char            acDevice[64];
-#if  !defined(__NetBSD__)
+#if  !defined(__NetBSD__) && !defined(__OpenBSD__)
     dev_t           st_rdev;
 #endif
     int             fTitleDisplayed;
@@@@ -151,7 +151,7 @@@@ static int DisplayPerf (struct diskperf_t *p_poPlugin)
     const double    K = 1.0 * 1000 * 1000 * 1000 / 1024 / 1024;
     /* bytes/ns --> MB/s */
     double          arPerf[NMONITORS], arBusy[NMONITORS], *prData, *pr;
-    char            acToolTips[128];
+    char            acToolTips[256];
     int             status, i;
 
     if (!s_poToolTips)
@@@@ -159,7 +159,7 @@@@ static int DisplayPerf (struct diskperf_t *p_poPlugin)
 
     memset (&oPerf, 0, sizeof (oPerf));
     oPerf.qlen = -1;
-#if defined (__NetBSD__)
+#if defined (__NetBSD__) || defined(__OpenBSD__)
     status = DevGetPerfData (poConf->acDevice, &oPerf);
 #else
     status = DevGetPerfData (&(poConf->st_rdev), &oPerf);
@@@@ -199,7 +199,7 @@@@ static int DisplayPerf (struct diskperf_t *p_poPlugin)
 	}
     }
 
-    sprintf (acToolTips, "%s\n"
+    snprintf (acToolTips, sizeof(acToolTips), "%s\n"
 	     "----------------\n"
 	     "I/O    (MB/s)\n"
 	     "  Read :%3u\n"
@@@@ -400,7 +400,7 @@@@ static diskperf_t *diskperf_create_control (XfcePanelP
     struct diskperf_t *poPlugin;
     struct param_t *poConf;
     struct monitor_t *poMonitor;
-#if !defined(__NetBSD__)
+#if !defined(__NetBSD__) && !defined(__OpenBSD__)
     struct stat     oStat;
     int             status;
 #endif
@@@@ -412,7 +412,7 @@@@ static diskperf_t *diskperf_create_control (XfcePanelP
 
     poPlugin->plugin = plugin;
     
-#if defined(__NetBSD__)
+#if defined(__NetBSD__) || defined(__OpenBSD__)
     strcpy (poConf->acDevice, "wd0");
     strcpy (poConf->acTitle, "wd0");
 #else
@@@@ -500,7 +500,7 @@@@ static void diskperf_read_config (XfcePanelPlugin *plu
     if ((value = xfce_rc_read_entry (rc, (CONF_DEVICE), NULL))) {
         memset (poConf->acDevice, 0, sizeof (poConf->acDevice));
         strncpy (poConf->acDevice, value, sizeof (poConf->acDevice) - 1);
-#if !defined(__NetBSD__)
+#if !defined(__NetBSD__) && !defined(__OpenBSD__)
         status = stat (poConf->acDevice, &oStat);
         poConf->st_rdev = (status == -1 ? 0 : oStat.st_rdev);
 #endif
@@@@ -623,7 +623,7 @@@@ static void SetDevice (Widget_t p_wTF, void *p_pvPlugi
     struct diskperf_t *poPlugin = (diskperf_t *) p_pvPlugin;
     struct param_t *poConf = &(poPlugin->oConf.oParam);
     const char     *pcDevice = gtk_entry_get_text (GTK_ENTRY (p_wTF));
-#if !defined(__NetBSD__)
+#if !defined(__NetBSD__) && !defined(__OpenBSD__)
     struct stat     oStat;
     int             status;
 
@


1.2
log
@update to 2.1.0
@
text
@d1 1
a1 1
$OpenBSD: patch-panel-plugin_main_c,v 1.1.1.1 2005/05/12 04:38:50 jolan Exp $
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD: patch-panel-plugin_main_c,v 1.1.1.1 2004/01/31 03:32:03 jolan Exp $
--- panel-plugin/main.c.orig	Wed Aug 25 05:08:40 2004
+++ panel-plugin/main.c	Sat Feb 19 21:44:08 2005
@@@@ -94,7 +94,7 @@@@ typedef enum monitor_bar_order_t {
d13 1
a13 1
@@@@ -162,7 +162,7 @@@@ static int DisplayPerf (struct plugin_t 
d22 1
a22 1
@@@@ -170,7 +170,7 @@@@ static int DisplayPerf (struct plugin_t 
d31 1
a31 1
@@@@ -210,7 +210,7 @@@@ static int DisplayPerf (struct plugin_t 
d40 2
a41 2
@@@@ -408,7 +408,7 @@@@ static plugin_t *NewPlugin ()
     struct plugin_t *poPlugin;
d49 1
a49 3
@@@@ -418,7 +418,7 @@@@ static plugin_t *NewPlugin ()
     poConf = &(poPlugin->oConf.oParam);
     poMonitor = &(poPlugin->oMonitor);
d51 2
d58 4
a61 4
@@@@ -510,7 +510,7 @@@@ static void plugin_read_config (Control 
     Widget_t       *pw2ndBar = poPlugin->oMonitor.awProgressBar + 1;
     xmlNodePtr      poNode;
     char           *pc;
d64 2
a65 11
     struct stat     oStat;
     int             status;
 #endif
@@@@ -526,7 +526,7 @@@@ static void plugin_read_config (Control 
 	    memset (poConf->acDevice, 0, sizeof (poConf->acDevice));
 	    strncpy (poConf->acDevice, pc, sizeof (poConf->acDevice) - 1);
 	    xmlFree (pc);
-#if !defined(__NetBSD__)
+#if !defined(__NetBSD__) && !defined(__OpenBSD__)
 	    status = stat (poConf->acDevice, &oStat);
 	    poConf->st_rdev = (status == -1 ? 0 : oStat.st_rdev);
d67 2
a68 2
@@@@ -662,7 +662,7 @@@@ static void SetDevice (Widget_t p_wTF, v
     struct plugin_t *poPlugin = (plugin_t *) p_pvPlugin;
@


1.1.1.1
log
@xfce 4.2.1
@
text
@@
