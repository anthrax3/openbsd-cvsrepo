head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2007.12.18.22.00.59;	author landry;	state dead;
branches;
next	1.2;

1.2
date	2007.12.18.20.55.13;	author landry;	state Exp;
branches;
next	1.1;

1.1
date	2007.09.06.18.44.52;	author steven;	state Exp;
branches;
next	;


desc
@@


1.3
log
@_really_ remove those patches, prodded by ajacoutot@@
@
text
@@


1.2
log
@- Update Terminal to 0.2.8
- still crashes *very* rarely when hitting ctrl-d, seems related to vte
(http://bugzilla.xfce.org/show_bug.cgi?id=3246)
- remove all unneeded patches
- install more documentation
- add update-desktop-database goo

ok ajacoutot@@ steven@@
@
text
@@


1.1
log
@SECURITY FIX for potential remote shell command execution

Details at http://bugzilla.xfce.org/show_bug.cgi?id=3383

from maintainer Landry Breuil
@
text
@a0 44
$OpenBSD$
--- terminal/terminal-helper.c.orig	Wed Sep  5 18:32:23 2007
+++ terminal/terminal-helper.c	Wed Sep  5 18:34:30 2007
@@@@ -349,6 +349,8 @@@@ terminal_helper_execute (TerminalHelper *helper,
   gchar       *argv[4];
   gchar       *command;
   gchar       *t;
+  gchar       *escaped;
+  gchar       **parts;
   guint        n;
 
   g_return_if_fail (TERMINAL_IS_HELPER (helper));
@@@@ -359,6 +361,10 @@@@ terminal_helper_execute (TerminalHelper *helper,
     if (s[0] == '%' && g_ascii_tolower (s[1]) == 'u')
       ++n;
 
+  parts = g_strsplit (uri, "$", 0);
+  escaped = g_shell_quote (g_strjoinv("\$", parts));
+  g_strfreev (parts);
+
   if (n > 0)
     {
       command = g_new (gchar, strlen (helper->command) + n * strlen (uri) + 1);
@@@@ -366,7 +372,7 @@@@ terminal_helper_execute (TerminalHelper *helper,
         {
           if (s[0] == '%' && g_ascii_tolower (s[1]) == 'u')
             {
-              for (u = uri; *u != '\0'; )
+              for (u = escaped; *u != '\0'; )
                 *t++ = *u++;
               s += 2;
             }
@@@@ -379,8 +385,10 @@@@ terminal_helper_execute (TerminalHelper *helper,
     }
   else
     {
-      command = g_strconcat (helper->command, " ", uri, NULL);
+      command = g_strconcat (helper->command, " ", escaped, NULL);
     }
+
+  g_free (escaped);
 
   argv[0] = "/bin/sh";
   argv[1] = "-c";
@

