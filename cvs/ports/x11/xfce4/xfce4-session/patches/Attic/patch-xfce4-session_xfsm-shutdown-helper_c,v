head	1.2;
access;
symbols
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2010.06.05.15.26.33;	author landry;	state dead;
branches;
next	1.1;

1.1
date	2009.09.26.11.16.05;	author landry;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to xfce4-session 4.6.2
@
text
@$OpenBSD: patch-xfce4-session_xfsm-shutdown-helper_c,v 1.1 2009/09/26 11:16:05 landry Exp $
ultimate fix for http://bugzilla.xfce.org/show_bug.cgi?id=4849
--- xfce4-session/xfsm-shutdown-helper.c.orig	Thu Sep 24 23:24:10 2009
+++ xfce4-session/xfsm-shutdown-helper.c	Thu Sep 24 23:25:34 2009
@@@@ -554,8 +554,14 @@@@ xfsm_shutdown_helper_send_command (XfsmShutdownHelper 
 
       if (ferror (helper->outfile))
         {
-          if (error && errno != EINTR)
+          if (errno == EINTR)
             {
+              /* probably succeeded but the helper got killed */
+              return TRUE;
+            }
+
+          if (error)
+            {
               g_set_error (error, G_FILE_ERROR, g_file_error_from_errno (errno),
                            _("Error sending command to shutdown helper: %s"),
                            strerror (errno));
@@@@ -565,7 +571,13 @@@@ xfsm_shutdown_helper_send_command (XfsmShutdownHelper 
 
       if (fgets (response, 256, helper->infile) == NULL)
         {
-          if (error && errno != EINTR)
+          if (errno == EINTR)
+            {
+              /* probably succeeded but the helper got killed */
+              return TRUE;
+            }
+
+          if (error)
             {
               g_set_error (error, G_FILE_ERROR, g_file_error_from_errno (errno),
                            _("Error receiving response from shutdown helper: %s"),
@


1.1
log
@Really fix http://bugzilla.xfce.org/show_bug.cgi?id=4849, when we got
EINTR it means we can safely return true.
Thanks stsp@@ for pointing out the (fixed-but-not-totally) issue & hints
about how to fixit, fix taken from upstream git.
@
text
@d1 1
a1 1
$OpenBSD$
@

