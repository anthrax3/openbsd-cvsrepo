head	1.3;
access;
symbols
	OPENBSD_5_5:1.2.0.2
	OPENBSD_5_5_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2014.03.18.08.12.23;	author dcoppa;	state dead;
branches;
next	1.2;

1.2
date	2014.01.11.21.15.26;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2013.09.30.09.46.11;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to mlterm-3.3.3
@
text
@$OpenBSD: patch-xwindow_fb_x_display_c,v 1.2 2014/01/11 21:15:26 dcoppa Exp $

Only if _display.pixels_per_byte is 8, multiple planes of scrolled
lines are copied: fix the bug of scrolling on framebuffer
https://bitbucket.org/arakiken/mlterm/commits/4d974f758c5491704cd4a41481940bda6f303ac1

--- xwindow/fb/x_display.c.orig	Sat Dec 21 18:11:35 2013
+++ xwindow/fb/x_display.c	Sat Jan 11 20:48:20 2014
@@@@ -1870,6 +1870,7 @@@@ x_display_copy_lines(
 	u_char *  dst ;
 	u_int  copy_len ;
 	u_int  count ;
+	int  num_of_planes ;
 	int  plane ;
 
 	/* XXX cheap implementation. */
@@@@ -1878,7 +1879,16 @@@@ x_display_copy_lines(
 	/* XXX could be different from FB_WIDTH_BYTES(display, dst_x, width) */
 	copy_len = FB_WIDTH_BYTES(&_display, src_x, width) ;
 
-	for( plane = 0 ; plane < _disp.depth ; plane++)
+	if( _display.pixels_per_byte == 8)
+	{
+		num_of_planes = _disp.depth ;
+	}
+	else
+	{
+		num_of_planes = 1 ;
+	}
+
+	for( plane = 0 ; plane < num_of_planes ; plane++)
 	{
 		if( src_y <= dst_y)
 		{
@


1.2
log
@Update to mlterm-3.3.2 + aoyama@@'s patch to add support for
OpenBSD/luna88k 8bpp framebuffer
(https://bitbucket.org/arakiken/mlterm/commits/2b4b80e883a654bc1b5ad7756843e28750ee6f37)
@
text
@d1 1
a1 1
$OpenBSD: patch-xwindow_fb_x_display_c,v 1.1 2013/09/30 09:46:11 dcoppa Exp $
@


1.1
log
@Update to mlterm-3.2.2

maintainer's M.I.A.
@
text
@d1 1
a1 1
$OpenBSD$
d3 3
a5 2
Make mlterm-fb work on OpenBSD/luna88k 1bpp framebuffer
https://bitbucket.org/arakiken/mlterm/commits/a33db31c77923d8285fd090fa03335073135ba34
d7 8
a14 3
--- xwindow/fb/x_display.c.orig	Mon Aug  5 14:48:52 2013
+++ xwindow/fb/x_display.c	Tue Sep 24 10:27:23 2013
@@@@ -1922,7 +1922,8 @@@@ open_display(void)
d16 18
a33 1
 		if( ioctl( _display.fb_fd , WSDISPLAYIO_SETGFXMODE , &gfx_mode) == -1)
a34 6
-			goto  error ;
+			/* Always failed on OpenBSD/luna88k. */
+			kik_msg_printf( "Failed to set screen resolution (gfx mode).\n") ;
 		}
 	}
 
@

