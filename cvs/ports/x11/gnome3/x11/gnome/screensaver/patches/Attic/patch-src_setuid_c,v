head	1.3;
access;
symbols
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	ajacoutot_20110531:1.1.1.1
	ajacoutot:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2011.09.12.07.31.40;	author jasper;	state dead;
branches;
next	1.2;

1.2
date	2011.05.31.14.27.49;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2011.05.31.13.00.33;	author ajacoutot;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.05.31.13.00.33;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Remove what I've merged.
@
text
@$OpenBSD: patch-src_setuid_c,v 1.2 2011/05/31 14:27:49 ajacoutot Exp $

https://bugzilla.gnome.org/show_bug.cgi?id=651554

--- src/setuid.c.orig	Wed Apr 30 04:30:08 2008
+++ src/setuid.c	Fri May 15 12:15:54 2009
@@@@ -194,6 +194,21 @@@@ hack_uid (char **nolock_reason,
                         *orig_uid = uid_gid_string (euid, egid);
                 }
 
+#ifdef HAVE_BSDAUTH /* we need to setgid auth to run the bsd_auth(3) login_* helpers */
+                struct group *authg = getgrnam("auth");
+                if (!authg || !authg->gr_name || !*authg->gr_name) {
+                                reason = ("no such group as \"auth\" for bsdauth.\n");
+
+                                ret = FALSE;
+                                goto out;
+                        }
+		if (! set_ids_by_number (uid, authg->gr_gid, uid_message)) {
+                                reason = ("cannot setgid \"auth\" for bsdauth.");
+
+                                ret = FALSE;
+                                goto out;
+                        }
+#else /* !HAVE_BSDAUTH */
                 if (uid != euid || gid != egid) {
                         if (! set_ids_by_number (uid, gid, uid_message)) {
                                 reason = g_strdup ("unable to discard privileges.");
@@@@ -202,6 +217,7 @@@@ hack_uid (char **nolock_reason,
                                 goto out;
                         }
                 }
+#endif
         }
 
 
@


1.2
log
@Fix some comments in the autoconf macros and patch headers, no pkg change.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_setuid_c,v 1.1.1.1 2011/05/31 13:00:33 ajacoutot Exp $
@


1.1
log
@Initial revision
@
text
@d1 4
a4 1
$OpenBSD: patch-src_setuid_c,v 1.1 2009/06/04 00:45:39 ajacoutot Exp $
@


1.1.1.1
log
@Import gnome-screensaver-3.0.0.

gnome-screensaver is a screen saver and locker that aims to have simple,
sane, secure defaults and be well integrated with the desktop.
It is designed to support:
    * the ability to lock down configuration settings
    * translation into many languages
    * user switching (not implemented under OpenBSD)

ok jasper@@
@
text
@@
