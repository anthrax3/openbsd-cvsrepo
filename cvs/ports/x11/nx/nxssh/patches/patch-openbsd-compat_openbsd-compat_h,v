head	1.1;
access;
symbols
	OPENBSD_6_1:1.1.0.14
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.12
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.8
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.10
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.6
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.4
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.2
	OPENBSD_5_5_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2013.10.24.10.52.27;	author jca;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Fix after arc4random removal.  Use arc4random_stir only if both it and
arc4random are present.  ok sthen@@.
Note: port broken at logout with MALLOC_OPTIONS=S.
@
text
@$OpenBSD$
OpenBSD does not need nor provide arc4random_stir.
--- openbsd-compat/openbsd-compat.h.orig	Wed Oct 23 17:23:42 2013
+++ openbsd-compat/openbsd-compat.h	Wed Oct 23 17:27:05 2013
@@@@ -146,10 +146,14 @@@@ int writev(int, struct iovec *, int);
 int getpeereid(int , uid_t *, gid_t *);
 #endif 
 
-#ifndef HAVE_ARC4RANDOM
+#ifdef HAVE_ARC4RANDOM
+# ifndef HAVE_ARC4RANDOM_STIR
+#  define arc4random_stir()
+# endif
+#else
 unsigned int arc4random(void);
 void arc4random_stir(void);
-#endif /* !HAVE_ARC4RANDOM */
+#endif /* HAVE_ARC4RANDOM */
 
 #ifndef HAVE_ASPRINTF
 int asprintf(char **, const char *, ...);
@
