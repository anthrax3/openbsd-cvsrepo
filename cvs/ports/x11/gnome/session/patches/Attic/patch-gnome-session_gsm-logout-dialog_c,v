head	1.5;
access;
symbols
	OPENBSD_4_9:1.4.0.2
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.3.0.2
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2011.05.23.21.31.56;	author ajacoutot;	state dead;
branches;
next	1.4;

1.4
date	2010.09.30.07.37.05;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.07.23.09.28.05;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.07.01.18.26.53;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2009.11.13.15.48.05;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Enable support for upower.
@
text
@$OpenBSD: patch-gnome-session_gsm-logout-dialog_c,v 1.4 2010/09/30 07:37:05 ajacoutot Exp $

OpenBSD does not support uPower.

--- gnome-session/gsm-logout-dialog.c.orig	Thu Jul 15 14:53:08 2010
+++ gnome-session/gsm-logout-dialog.c	Tue Sep 28 13:50:55 2010
@@@@ -27,7 +27,9 @@@@
 #include <glib/gi18n.h>
 #include <gtk/gtk.h>
 
+#ifndef __OpenBSD__
 #include <upower.h>
+#endif
 
 #include "gsm-logout-dialog.h"
 #include "gsm-consolekit.h"
@@@@ -50,7 +52,9 @@@@ struct _GsmLogoutDialogPrivate
 {
         GsmDialogLogoutType  type;
 
+#ifndef __OpenBSD__
         UpClient            *up_client;
+#endif
         GsmConsolekit       *consolekit;
 
         int                  timeout;
@@@@ -142,7 +146,9 @@@@ gsm_logout_dialog_init (GsmLogoutDialog *logout_dialog
         gtk_window_set_keep_above (GTK_WINDOW (logout_dialog), TRUE);
         gtk_window_stick (GTK_WINDOW (logout_dialog));
 
+#ifndef __OpenBSD__
         logout_dialog->priv->up_client = up_client_new ();
+#endif
 
         logout_dialog->priv->consolekit = gsm_get_consolekit ();
 
@@@@ -166,10 +172,12 @@@@ gsm_logout_dialog_destroy (GsmLogoutDialog *logout_dia
                 logout_dialog->priv->timeout_id = 0;
         }
 
+#ifndef __OpenBSD__
         if (logout_dialog->priv->up_client) {
                 g_object_unref (logout_dialog->priv->up_client);
                 logout_dialog->priv->up_client = NULL;
         }
+#endif
 
         if (logout_dialog->priv->consolekit) {
                 g_object_unref (logout_dialog->priv->consolekit);
@@@@ -182,13 +190,21 @@@@ gsm_logout_dialog_destroy (GsmLogoutDialog *logout_dia
 static gboolean
 gsm_logout_supports_system_suspend (GsmLogoutDialog *logout_dialog)
 {
+#ifndef __OpenBSD__
         return up_client_get_can_suspend (logout_dialog->priv->up_client);
+#else
+	return FALSE;
+#endif
 }
 
 static gboolean
 gsm_logout_supports_system_hibernate (GsmLogoutDialog *logout_dialog)
 {
+#ifndef __OpenBSD__
         return up_client_get_can_hibernate (logout_dialog->priv->up_client);
+#else
+	return FALSE;
+#endif
 }
 
 static gboolean
@


1.4
log
@Update to gnome-session-2.32.0.

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.3
log
@User switching requires running another new X server which will not work
by default on OpenBSD so don't display the option in the logout dialog.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-session_gsm-logout-dialog_c,v 1.2 2010/07/01 18:26:53 ajacoutot Exp $
d3 1
a3 1
OpenBSD does not have DeviceKit/uPower.
d5 2
a6 2
--- gnome-session/gsm-logout-dialog.c.orig	Tue Feb  9 14:22:01 2010
+++ gnome-session/gsm-logout-dialog.c	Fri Jul 23 11:13:20 2010
d12 1
a12 1
 #include <devkit-power-gobject/devicekit-power.h>
d22 1
a22 1
         DkpClient           *dkp_client;
d32 1
a32 1
         logout_dialog->priv->dkp_client = dkp_client_new ();
d42 3
a44 3
         if (logout_dialog->priv->dkp_client) {
                 g_object_unref (logout_dialog->priv->dkp_client);
                 logout_dialog->priv->dkp_client = NULL;
d50 2
a51 1
@@@@ -183,9 +191,13 @@@@ static gboolean
a53 1
         gboolean ret;
d55 1
a55 3
         g_object_get (logout_dialog->priv->dkp_client,
                       "can-suspend", &ret,
                       NULL);
d57 1
a57 1
+	ret = 0;
a58 1
         return ret;
d61 1
a61 1
@@@@ -193,9 +205,13 @@@@ static gboolean
a63 1
         gboolean ret;
d65 1
a65 3
         g_object_get (logout_dialog->priv->dkp_client,
                       "can-hibernate", &ret,
                       NULL);
d67 1
a67 1
+	ret = 0;
a68 1
         return ret;
d71 1
@


1.2
log
@Tweak/add comments.
@
text
@d1 1
a1 3
$OpenBSD: patch-gnome-session_gsm-logout-dialog_c,v 1.1 2009/11/13 15:48:05 ajacoutot Exp $
--- gnome-session/gsm-logout-dialog.c.orig	Fri Nov 13 15:57:02 2009
+++ gnome-session/gsm-logout-dialog.c	Fri Nov 13 16:02:48 2009
d5 2
@


1.1
log
@Start cleaning up the mess...
We can now restart/shutdown the machine. There are still a couple of tweaks
pending wrt to gnome-panel which I'll work on next.
Regen PLIST while here.
@
text
@d1 1
a1 1
$OpenBSD$
d4 3
@

