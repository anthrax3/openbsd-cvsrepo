head	1.18;
access;
symbols
	OPENBSD_6_0:1.15.0.2
	OPENBSD_6_0_BASE:1.15
	OPENBSD_5_9:1.14.0.2
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.13.0.4
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_3:1.11.0.2
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.9.0.2
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.8
	OPENBSD_5_1:1.8.0.2
	OPENBSD_5_0:1.5.0.2
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.4.0.2
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.3.0.2
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.2.0.2
	OPENBSD_4_7_BASE:1.2;
locks; strict;
comment	@# @;


1.18
date	2016.12.15.08.23.10;	author ajacoutot;	state Exp;
branches;
next	1.17;
commitid	cqBrzWVMHHXvvfUE;

1.17
date	2016.12.14.13.14.05;	author ajacoutot;	state dead;
branches;
next	1.16;
commitid	9OWoJz2LkTE605UR;

1.16
date	2016.10.31.10.52.01;	author ajacoutot;	state Exp;
branches;
next	1.15;
commitid	ONr2oMsCcgmTZ1G1;

1.15
date	2016.04.25.16.57.45;	author ajacoutot;	state Exp;
branches;
next	1.14;
commitid	6nu04wFw27QhScf6;

1.14
date	2015.10.18.13.25.31;	author ajacoutot;	state Exp;
branches;
next	1.13;
commitid	3ldgvLv0he8O0a7p;

1.13
date	2015.04.03.12.43.19;	author ajacoutot;	state Exp;
branches;
next	1.12;
commitid	OGgWLBFBs193jM7N;

1.12
date	2013.03.29.15.41.03;	author ajacoutot;	state dead;
branches;
next	1.11;

1.11
date	2012.11.13.07.40.11;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2012.09.28.07.34.24;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2012.02.16.22.23.25;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2012.01.02.16.06.50;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2011.09.26.10.19.21;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2011.09.12.07.28.54;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2011.04.06.18.33.03;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2010.12.03.13.15.27;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.04.22.22.38.51;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2009.11.15.08.53.04;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2009.11.14.16.39.05;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.18
log
@I am stupid; while hunting for some other issue, I misread my own patch.
Bring it back, it _is_ needed.
@
text
@$OpenBSD: patch-gnome-session_main_c,v 1.16 2016/10/31 10:52:01 ajacoutot Exp $

XXX no rpmatch(3) on OpenBSD

--- gnome-session/main.c.orig	Wed Oct 12 16:02:15 2016
+++ gnome-session/main.c	Mon Oct 31 11:41:53 2016
@@@@ -304,7 +304,7 @@@@ main (int argc, char **argv)
 
         debug_string = g_getenv ("GNOME_SESSION_DEBUG");
         if (debug_string != NULL) {
-                debug = rpmatch (debug_string) == TRUE || atoi (debug_string) == 1;
+                debug = atoi (debug_string) == 1;
         }
 
         error = NULL;
@


1.17
log
@Remove uneeded patch.
@
text
@@


1.16
log
@Update to gnome-session-3.22.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-session_main_c,v 1.15 2016/04/25 16:57:45 ajacoutot Exp $
@


1.15
log
@Update to gnome-session-3.20.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-session_main_c,v 1.14 2015/10/18 13:25:31 ajacoutot Exp $
d5 3
a7 3
--- gnome-session/main.c.orig	Mon Apr 11 17:41:13 2016
+++ gnome-session/main.c	Mon Apr 25 18:47:26 2016
@@@@ -311,7 +311,7 @@@@ main (int argc, char **argv)
@


1.14
log
@Update to gnome-session-3.18.1.2.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-session_main_c,v 1.13 2015/04/03 12:43:19 ajacoutot Exp $
d5 3
a7 3
--- gnome-session/main.c.orig	Wed Oct 14 20:33:24 2015
+++ gnome-session/main.c	Sun Oct 18 13:49:03 2015
@@@@ -300,7 +300,7 @@@@ main (int argc, char **argv)
@


1.13
log
@Update to gnome-session-3.16.0.
@
text
@d1 1
a1 1
$OpenBSD$
d5 3
a7 3
--- gnome-session/main.c.orig	Fri Apr  3 14:18:31 2015
+++ gnome-session/main.c	Fri Apr  3 14:19:42 2015
@@@@ -260,7 +260,7 @@@@ main (int argc, char **argv)
@


1.12
log
@Update to gnome-session-3.8.0.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-session_main_c,v 1.11 2012/11/13 07:40:11 ajacoutot Exp $
d3 1
a3 2
Set XDG_MENU_PREFIX so that menu is created from
SYSCONFDIR/xdg/menus/gnome-applications.menu
d5 3
a7 5
--- gnome-session/main.c.orig	Tue Nov 13 00:32:21 2012
+++ gnome-session/main.c	Tue Nov 13 08:33:40 2012
@@@@ -348,6 +348,13 @@@@ main (int argc, char **argv)
          */
         gsm_util_setenv ("GNOME_DESKTOP_SESSION_ID", "this-is-deprecated");
d9 5
a13 8
+        /* Set default menu to gnome-applications.menu if XDG_MENU_PREFIX
+         * is not set.
+         */
+        if (!g_getenv ("XDG_MENU_PREFIX")) {
+                gsm_util_setenv ("XDG_MENU_PREFIX", "gnome-");
+        }
+
         client_store = gsm_store_new ();
d15 1
a15 1
         /* Talk to logind before acquiring a name, since it does synchronous
@


1.11
log
@Update to gnome-session-3.6.2.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-session_main_c,v 1.10 2012/09/28 07:34:24 ajacoutot Exp $
@


1.10
log
@Update to gnome-session-3.6.0.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-session_main_c,v 1.9 2012/02/16 22:23:25 ajacoutot Exp $
d6 3
a8 3
--- gnome-session/main.c.orig	Mon Sep 24 20:07:50 2012
+++ gnome-session/main.c	Fri Sep 28 09:24:16 2012
@@@@ -347,6 +347,13 @@@@ main (int argc, char **argv)
d21 1
a21 1
         xsmp_server = gsm_xsmp_server_new (client_store);
@


1.9
log
@No need to increase openfiles anymore.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-session_main_c,v 1.8 2012/01/02 16:06:50 ajacoutot Exp $
d6 3
a8 3
--- gnome-session/main.c.orig	Thu Sep  8 00:55:51 2011
+++ gnome-session/main.c	Tue Feb  7 09:36:03 2012
@@@@ -334,6 +334,13 @@@@ main (int argc, char **argv)
@


1.8
log
@Increase RLIMIT_NOFILE cur value, otherwise we run into too many issues.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-session_main_c,v 1.7 2011/09/26 10:19:21 ajacoutot Exp $
d3 2
a4 4
Two OpenBSD specific changes:
* set default openfiles soft limit to 512 (if current value is lower)
* set XDG_MENU_PREFIX so that menu is created from
  SYSCONFDIR/xdg/menus/gnome-applications.menu
d7 2
a8 26
+++ gnome-session/main.c	Mon Jan  2 16:42:54 2012
@@@@ -28,6 +28,12 @@@@
 #include <unistd.h>
 #include <errno.h>
 
+#ifdef __OpenBSD__
+#include <sys/types.h>
+#include <sys/time.h>
+#include <sys/resource.h>
+#endif
+
 #include <glib/gi18n.h>
 #include <glib.h>
 #include <gtk/gtk.h>
@@@@ -264,6 +270,9 @@@@ require_dbus_session (int      argc,
 int
 main (int argc, char **argv)
 {
+#ifdef __OpenBSD__
+        struct rlimit rl;
+#endif
         struct sigaction  sa;
         GError           *error;
         char             *display_str;
@@@@ -333,6 +342,25 @@@@ main (int argc, char **argv)
          * detect if GNOME is running. We keep this for compatibility reasons.
d11 1
a11 1
+
a18 12
+#ifdef __OpenBSD__
+        if (getrlimit (RLIMIT_NOFILE, &rl) == 0) {
+                if (rl.rlim_cur < 512) {
+                        rl.rlim_cur = 512;
+                        if (setrlimit(RLIMIT_NOFILE, &rl) < 0)
+                                g_warning ("Can't increase max open files per process");
+                }
+        } else {
+                g_warning ("Can't get resource limit for open files");
+        }
+#endif
 
d21 1
@


1.7
log
@Update to gnome-session-3.2.0.
@
text
@d1 7
a7 1
$OpenBSD: patch-gnome-session_main_c,v 1.6 2011/09/12 07:28:54 jasper Exp $
d9 26
a34 2
+++ gnome-session/main.c	Mon Sep 26 11:33:41 2011
@@@@ -334,6 +334,13 @@@@ main (int argc, char **argv)
d37 1
a37 1
 
d45 12
a58 1
         xsmp_server = gsm_xsmp_server_new (client_store);
@


1.6
log
@Moar GNOME3 merge
@
text
@d1 4
a4 4
$OpenBSD: patch-gnome-session_main_c,v 1.1.1.1 2011/05/19 08:36:41 ajacoutot Exp $
--- gnome-session/main.c.orig	Tue Mar 22 21:31:43 2011
+++ gnome-session/main.c	Wed May 18 14:37:20 2011
@@@@ -325,6 +325,13 @@@@ main (int argc, char **argv)
d17 1
a17 1
 
@


1.5
log
@Remove the bug-buddy hack.
@
text
@d1 4
a4 4
$OpenBSD: patch-gnome-session_main_c,v 1.4 2010/12/03 13:15:27 ajacoutot Exp $
--- gnome-session/main.c.orig	Wed Sep  8 19:21:52 2010
+++ gnome-session/main.c	Wed Apr  6 20:28:51 2011
@@@@ -486,6 +486,13 @@@@ main (int argc, char **argv)
@


1.4
log
@Extend the gs-bug-buddy-debug patch so that g_debug messages are only
printed if we compile with --enable-debug even when the
libgnomesegvhandler module from bug-buddy is loaded.
@
text
@d1 4
a4 4
$OpenBSD: patch-gnome-session_main_c,v 1.3 2010/04/22 22:38:51 ajacoutot Exp $
--- gnome-session/main.c.orig	Fri Dec  3 13:41:07 2010
+++ gnome-session/main.c	Fri Dec  3 13:41:08 2010
@@@@ -508,6 +508,13 @@@@ main (int argc, char **argv)
@


1.3
log
@Update to gnome-session-2.30.0.
@
text
@d1 4
a4 4
$OpenBSD: patch-gnome-session_main_c,v 1.2 2009/11/15 08:53:04 ajacoutot Exp $
--- gnome-session/main.c.orig	Tue Mar  9 00:31:27 2010
+++ gnome-session/main.c	Fri Apr 23 00:33:12 2010
@@@@ -486,6 +486,13 @@@@ main (int argc, char **argv)
@


1.2
log
@Unbreak...

spotted by pyr@@
@
text
@d1 4
a4 4
$OpenBSD: patch-gnome-session_main_c,v 1.1 2009/11/14 16:39:05 ajacoutot Exp $
--- gnome-session/main.c.orig	Wed Jul  1 14:45:30 2009
+++ gnome-session/main.c	Sun Nov 15 09:52:18 2009
@@@@ -490,6 +490,13 @@@@ main (int argc, char **argv)
@


1.1
log
@Respect XDG_MENU_PREFIX instead of using the hardcoded applications.menu.

ok landry@@
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 2
+++ gnome-session/main.c	Sat Nov 14 13:40:08 2009
@@@@ -490,6 +490,12 @@@@ main (int argc, char **argv)
d13 1
@

