head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2017.06.24.07.36.39;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	vDzzzoDKal19xphX;

1.2
date	2014.04.15.13.30.46;	author ajacoutot;	state dead;
branches;
next	1.1;

1.1
date	2014.03.27.12.42.05;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Merge fixes from upstream to make sure gnome processes are properly killed
at logout.
@
text
@$OpenBSD$

From f708bbbf2df41ea9683f7667c745d0297e584968 Mon Sep 17 00:00:00 2001
From: Ray Strode <rstrode@@redhat.com>
Date: Tue, 20 Jun 2017 16:51:00 -0400
Subject: system: add api for detecting if this is the last session for a user

Index: gnome-session/gsm-system.c
--- gnome-session/gsm-system.c.orig
+++ gnome-session/gsm-system.c
@@@@ -97,6 +97,7 @@@@ gsm_system_null_init_iface (GsmSystemInterface *iface)
         iface->remove_inhibitor  = (void *) do_nothing;
         iface->prepare_shutdown  = (void *) do_nothing;
         iface->complete_shutdown = (void *) do_nothing;
+        iface->is_last_session_for_user = (void *) return_false;
 }
 
 static void
@@@@ -216,6 +217,12 @@@@ gboolean
 gsm_system_is_login_session (GsmSystem *system)
 {
         return GSM_SYSTEM_GET_IFACE (system)->is_login_session (system);
+}
+
+gboolean
+gsm_system_is_last_session_for_user (GsmSystem *system)
+{
+        return GSM_SYSTEM_GET_IFACE (system)->is_last_session_for_user (system);
 }
 
 /**
@


1.2
log
@Update to gnome-session-3.12.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-session_gsm-system_c,v 1.1 2014/03/27 12:42:05 ajacoutot Exp $
d3 4
a6 1
https://bugzilla.gnome.org/show_bug.cgi?id=727099
d8 9
a16 4
--- gnome-session/gsm-system.c.orig	Tue Mar 18 21:31:47 2014
+++ gnome-session/gsm-system.c	Thu Mar 27 12:42:43 2014
@@@@ -22,9 +22,7 @@@@
 #include <glib/gi18n.h>
d18 6
a23 12
 #include "gsm-system.h"
-#ifdef HAVE_OLD_UPOWER
 #include "gsm-consolekit.h"
-#endif
 #include "gsm-systemd.h"
 
 enum {
@@@@ -254,14 +252,13 @@@@ gsm_get_system (void)
                         g_debug ("Using systemd for session tracking");
                 }
         }
-#ifdef HAVE_OLD_UPOWER
d25 5
a29 7
         if (system == NULL) {
                 system = GSM_SYSTEM (gsm_consolekit_new ());
                 if (system != NULL) {
                         g_debug ("Using ConsoleKit for session tracking");
                 }
         }
-#endif
d31 1
a31 2
         if (system == NULL) {
                 system = g_object_new (gsm_system_null_get_type (), NULL);
@


1.1
log
@Update to gnome-session-3.12.0.
@
text
@d1 1
a1 1
$OpenBSD$
@

