head	1.7;
access;
symbols
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.2
	OPENBSD_5_0:1.4.0.4
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.2
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.3.0.2
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.2.0.2
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.1.0.2
	OPENBSD_4_6_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2012.02.16.22.22.22;	author ajacoutot;	state dead;
branches;
next	1.6;

1.6
date	2011.11.30.11.13.47;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2011.09.12.07.28.54;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2010.09.30.07.36.45;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.04.23.11.56.09;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2009.10.14.09.55.24;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2009.06.04.00.45.39;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Update to gnome-screensaver-3.2.1.
@
text
@$OpenBSD: patch-configure_ac,v 1.6 2011/11/30 11:13:47 ajacoutot Exp $

From d7ab99c00a01bea870cf51d855ecf320e0d23bac Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@@openbsd.org>
Date: Wed, 30 Nov 2011 12:02:48 +0100
Subject: [PATCH] Implement OpenBSD authentication using bsd_auth(3).

--- configure.ac.orig	Tue Sep  6 21:38:29 2011
+++ configure.ac	Thu Sep  8 09:05:00 2011
@@@@ -448,6 +448,45 @@@@ if test "$ac_macosx" = yes; then
 fi
 
 dnl ---------------------------------------------------------------------------
+dnl - Check for bsd_auth(3) (OpenBSD)
+dnl ---------------------------------------------------------------------------
+
+have_bsdauth=no
+with_bsdauth_req=unspecified
+NEED_SETUID=no
+
+case "$host" in                                                                                       
+  *-openbsd*)                                                                                         
+    with_bsdauth=yes
+    AUTH_SCHEME=bsdauth
+    NEED_SETUID=no
+    if test "x$enable_locking" = "xyes"; then
+      with_bsdauth_req=yes
+      NEED_SETUID=yes
+    fi
+esac  
+
+if test "$with_bsdauth" = yes ; then
+  AC_CACHE_CHECK([for BSD Authentication], ac_cv_bsdauth,
+    [AC_TRY_X_COMPILE([#include <stdlib.h>
+                       #include <unistd.h>
+                       #include <sys/types.h>
+                       #include <bsd_auth.h>],
+      [int ok = auth_userokay("x", 0, "x", "x");],
+      [ac_cv_bsdauth=yes],
+      [ac_cv_bsdauth=no])])
+  if test "$ac_cv_bsdauth" = yes; then
+    have_bsdauth=yes
+  fi
+fi
+
+if test "$have_bsdauth" = yes; then
+  AC_DEFINE(HAVE_BSDAUTH, 1, [Define to 1 if using bsd_auth(3) authentication])
+fi
+
+AC_SUBST(NEED_SETUID)
+
+dnl ---------------------------------------------------------------------------
 dnl - Check for PAM
 dnl ---------------------------------------------------------------------------
 
@@@@ -467,12 +506,13 @@@@ fi
 AC_SUBST(PAM_PREFIX)
 
 have_pam=no
-if test "x$enable_locking" = "xyes"; then
+if test "x$enable_locking" = "xyes" -a "x$have_bsdauth" = "xno"; then
 AC_CHECK_LIB(pam, pam_start, have_pam=yes)
 fi
 
 if test "x$have_pam" = "xyes"; then
         AUTH_LIBS="${AUTH_LIBS} -lpam"
+        AUTH_SCHEME=pam
         # On Linux, sigtimedwait() is in libc; on Solaris, it's in librt.
         have_timedwait=no
         AC_CHECK_LIB(c, sigtimedwait, [have_timedwait=yes])
@@@@ -506,14 +546,17 @@@@ if test "x$have_pam" = "xyes"; then
           AC_MSG_RESULT(unknown)
         fi
 
-else
+elif test "x$have_bsdauth" = "xno"; then
 	AC_MSG_ERROR("PAM libraries not found")
 fi
 AC_SUBST(HAVE_PAM)
 AC_SUBST(AUTH_LIBS)
+AC_SUBST(AUTH_SCHEME)
 
-AC_CHECK_HEADERS([security/pam_modutil.h security/pam_ext.h])
-AC_CHECK_LIB(pam, pam_syslog, [AC_DEFINE(HAVE_PAM_SYSLOG, [], [Define to 1 if you have the pam_syslog function])])
+if test "x$have_pam" = "xyes"; then
+  AC_CHECK_HEADERS([security/pam_modutil.h security/pam_ext.h])
+  AC_CHECK_LIB(pam, pam_syslog, [AC_DEFINE(HAVE_PAM_SYSLOG, [], [Define to 1 if you have the pam_syslog function])])
+fi
 
 dnl test whether struct pam_message is const (Linux) or not (Sun)
 if test "x$have_pam" = "xyes"; then
@@@@ -695,7 +738,12 @@@@ echo "
 
         Screen locking enabled:   ${enable_locking}
         Show keyboard indicator:  ${with_kbd_layout_indicator}
+"
+
+if test "x$have_pam" = "xyes" ; then
+echo "\
         PAM prefix:               ${PAM_PREFIX}
 
 "
+fi
 
@


1.6
log
@Sync with what I'm about to commit upstream.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.5 2011/09/12 07:28:54 jasper Exp $
@


1.5
log
@Moar GNOME3 merge
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.4 2011/09/08 07:27:10 ajacoutot Exp $
d3 4
a6 1
https://bugzilla.gnome.org/show_bug.cgi?id=651554
@


1.4
log
@Update to gnome-screensaver-2.30.2.

ok jasper@@
@
text
@d1 8
a8 8
$OpenBSD: patch-configure_ac,v 1.3 2010/04/23 11:56:09 ajacoutot Exp $
--- configure.ac.orig	Wed Sep 29 00:40:53 2010
+++ configure.ac	Thu Sep 30 07:58:28 2010
@@@@ -630,6 +630,7 @@@@ have_shadow_enhanced=no
 have_shadow_adjunct=no
 have_shadow_hpux=no
 have_passwd_helper=no
+have_bsdauth=no
d10 3
a12 9
 with_shadow_req=unspecified
 
@@@@ -846,6 +847,44 @@@@ esac
 AM_CONDITIONAL(HAVE_PASSWD_HELPER, test x$have_passwd_helper = xyes)
 AC_SUBST(HAVE_PASSWD_HELPER)
 
+#
+# 	check for BSD Authentication bsd_auth(3) (OpenBSD)
+#
d16 1
d20 7
a26 1
+    with_bsdauth=yes                                                                          
a28 11
+AC_ARG_WITH(bsdauth,
+[  --with-bsdauth    Include support for BSD Authentication (OpenBSD).],
+  [with_bsdauth="$withval"; with_bsdauth_req="$withval"],[with_bsdauth=no])
+
+if test "$enable_locking" = no ; then
+  with_bsdauth_req=no
+  with_bsdauth=no
+fi
+
+HANDLE_X_PATH_ARG(with_bsdauth, --with-bsdauth, BSD Authentication)
+
d36 4
a39 5
+      [have_bsdauth=yes],
+      [have_bsdauth=no])])
+  if test "$have_bsdauth" = yes; then
+    AC_DEFINE(HAVE_BSDAUTH, 1, [Define if you have bsd_auth(3) authentication])
+    need_setuid=yes
d43 8
a50 4
 if test "$need_setuid" = yes -a "$have_pam" != yes ; then
   NEED_SETUID=yes
 else
@@@@ -858,7 +897,7 @@@@ dnl  Authentication scheme
d53 22
a74 9
 AC_ARG_ENABLE(authentication-scheme,
-  [  --enable-authentication-scheme=[auto/pam/helper/pwent]  Choose a specific
+  [  --enable-authentication-scheme=[auto/pam/helper/bsdauth/pwent]  Choose a specific
                           authentication scheme [default=auto]],,
   enable_authentication_scheme=auto)
 
@@@@ -870,11 +909,16 @@@@ fi
 if test x$enable_authentication_scheme = xhelper -a x$have_passwd_helper = xno ; then
 	AC_MSG_ERROR(Password helper support requested but not available)
d76 24
a99 2
+if test x$enable_authentication_scheme = xbsdauth -a x$have_bsdauth = xno ; then
+	AC_MSG_ERROR(BSD Authentication support requested but not available)
a101 18
 if test x$enable_authentication_scheme = xpam ; then
         AUTH_SCHEME="pam"
 elif test x$enable_authentication_scheme = xhelper ; then
         AUTH_SCHEME="helper"
+elif test x$enable_authentication_scheme = xbsdauth ; then
+        AUTH_SCHEME="bsdauth"
 elif test x$enable_authentication_scheme = xpwent ; then
         AUTH_SCHEME="pwent"
 elif test x$enable_authentication_scheme = xauto ; then
@@@@ -882,6 +926,8 @@@@ elif test x$enable_authentication_scheme = xauto ; the
 		AUTH_SCHEME="pam"
 	elif test x$have_passwd_helper != xno ; then
 		AUTH_SCHEME="helper"
+	elif test x$have_bsdauth != xno ; then
+		AUTH_SCHEME="bsdauth"
 	else
 		AUTH_SCHEME="pwent"
         fi
@


1.3
log
@Update to gnome-screensaver-2.30.0.
@
text
@d1 4
a4 4
$OpenBSD: patch-configure_ac,v 1.2 2009/10/14 09:55:24 ajacoutot Exp $
--- configure.ac.orig	Tue Mar 30 17:16:51 2010
+++ configure.ac	Fri Apr 23 13:41:53 2010
@@@@ -625,6 +625,7 @@@@ have_shadow_enhanced=no
d12 1
a12 1
@@@@ -841,6 +842,44 @@@@ esac
d57 1
a57 1
@@@@ -853,7 +892,7 @@@@ dnl  Authentication scheme
d66 1
a66 1
@@@@ -865,11 +904,16 @@@@ fi
d83 1
a83 1
@@@@ -877,6 +921,8 @@@@ elif test x$enable_authentication_scheme = xauto ; the
@


1.2
log
@Major update to gnome-screensaver-2.28.0.
@
text
@d1 4
a4 4
$OpenBSD: patch-configure_ac,v 1.1 2009/06/04 00:45:39 ajacoutot Exp $
--- configure.ac.orig	Wed Sep 23 10:36:43 2009
+++ configure.ac	Wed Oct 14 11:35:09 2009
@@@@ -621,6 +621,7 @@@@ have_shadow_enhanced=no
d12 1
a12 1
@@@@ -837,6 +838,44 @@@@ esac
d57 1
a57 1
@@@@ -849,7 +888,7 @@@@ dnl  Authentication scheme
d66 1
a66 1
@@@@ -861,11 +900,16 @@@@ fi
d83 1
a83 1
@@@@ -873,6 +917,8 @@@@ elif test x$enable_authentication_scheme = xauto ; the
@


1.1
log
@- implement bsd_auth(3) support for gnome-screensaver
successfully tested with kerberos and passwd

looked over by and ok robert@@
@
text
@d1 4
a4 4
$OpenBSD$
--- configure.ac.orig	Wed Sep 24 02:11:57 2008
+++ configure.ac	Fri May 15 12:17:41 2009
@@@@ -624,6 +624,7 @@@@ have_shadow_enhanced=no
d12 1
a12 1
@@@@ -840,6 +841,44 @@@@ esac
d57 1
a57 1
@@@@ -852,7 +891,7 @@@@ dnl  Authentication scheme
d66 1
a66 1
@@@@ -864,11 +903,16 @@@@ fi
d83 1
a83 1
@@@@ -876,6 +920,8 @@@@ elif test x$enable_authentication_scheme = xauto ; the
@

