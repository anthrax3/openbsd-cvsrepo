head	1.5;
access;
symbols;
locks; strict;
comment	@# @;


1.5
date	2012.09.28.07.09.23;	author ajacoutot;	state dead;
branches;
next	1.4;

1.4
date	2012.08.04.14.50.19;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2011.10.17.14.52.00;	author ajacoutot;	state dead;
branches;
next	1.2;

1.2
date	2011.10.03.10.39.22;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2011.09.27.09.35.06;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update to gnome-settings-daemon-3.6.0.
@
text
@$OpenBSD: patch-plugins_print-notifications_gsd-printer_c,v 1.4 2012/08/04 14:50:19 ajacoutot Exp $

https://bugzilla.gnome.org/show_bug.cgi?id=679761

--- plugins/print-notifications/gsd-printer.c.orig	Mon Apr 16 14:34:43 2012
+++ plugins/print-notifications/gsd-printer.c	Sat Jul 28 17:49:19 2012
@@@@ -63,6 +63,14 @@@@ static GDBusNodeInfo *pdi_introspection_data = NULL;
 #define GNOME_SESSION_PRESENCE_DBUS_PATH  "/org/gnome/SessionManager/Presence"
 #define GNOME_SESSION_PRESENCE_DBUS_IFACE "org.gnome.SessionManager.Presence"
 
+#if (CUPS_VERSION_MAJOR > 1) || (CUPS_VERSION_MINOR > 5)
+#define HAVE_CUPS_1_6 1
+#endif
+
+#ifndef HAVE_CUPS_1_6
+#define ippGetState(ipp) ipp->state
+#endif
+
 enum {
   PRESENCE_STATUS_AVAILABLE = 0,
   PRESENCE_STATUS_INVISIBLE,
@@@@ -725,7 +733,7 @@@@ printer_autoconfigure (gchar *printer_name)
                                                         "AutoConfigure",
                                                         ("Automatic configuration"));
                 if (response) {
-                        if (response->state == IPP_ERROR)
+                        if (ippGetState (response) == IPP_ERROR)
                                 g_warning ("An error has occured during automatic configuration of new printer.");
                         ippDelete (response);
                 }
@


1.4
log
@Fix build with cups >= 1.6.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.3
log
@Update to gnome-settings-daemon-3.2.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_print-notifications_gsd-printer_c,v 1.2 2011/10/03 10:39:22 ajacoutot Exp $
d3 1
a3 4
From 010c40d989f5a1b3b884692c687342575b6103f0 Mon Sep 17 00:00:00 2001
From: Bastien Nocera <hadess@@hadess.net>
Date: Mon, 03 Oct 2011 10:28:28 +0000
Subject: printers: Fix build on systems without LC_PAPER
d5 26
a30 61
--- plugins/print-notifications/gsd-printer.c.orig	Tue Sep 13 10:52:26 2011
+++ plugins/print-notifications/gsd-printer.c	Mon Oct  3 12:33:02 2011
@@@@ -24,6 +24,7 @@@@
 #include <libnotify/notify.h>
 #include <glib/gi18n.h>
 #include <glib/gstdio.h>
+#include <gtk/gtk.h>
 #include <cups/cups.h>
 #include <cups/ppd.h>
 
@@@@ -751,9 +752,8 @@@@ set_default_paper_size (const gchar *printer_name,
         GVariant    *output;
         GError      *error = NULL;
         gchar      **value = NULL;
-        gchar       *paper_size;
-        char        *locale;
         gint         i, j, k;
+        const gchar *paper_size;
 
         proxy = g_dbus_proxy_new_for_bus_sync (G_BUS_TYPE_SYSTEM,
                                                G_DBUS_PROXY_FLAGS_NONE,
@@@@ -770,24 +770,14 @@@@ set_default_paper_size (const gchar *printer_name,
                 return;
         }
 
-        /* Set default PaperSize according to the locale */
-        locale = setlocale (LC_PAPER, NULL);
-        if (!locale)
-                locale = setlocale (LC_MESSAGES, NULL);
-
-        if (!locale) {
-                g_object_unref (proxy);
-                return;
-        }
-
-        /* CLDR 2.0 alpha
-         * http://unicode.org/repos/cldr-tmp/trunk/diff/supplemental/territory_language_information.html
-         */
-        if (g_regex_match_simple ("[^_.@@]{2,3}_(BZ|CA|CL|CO|CR|GT|MX|NI|PA|PH|PR|SV|US|VE)",
-                                  locale, G_REGEX_ANCHORED, G_REGEX_MATCH_ANCHORED))
-                paper_size = g_strdup ("Letter");
+        /* Set default PaperSize according to the locale
+         * FIXME: Handle more than A4 and Letter:
+         * https://bugzilla.gnome.org/show_bug.cgi?id=660769 */
+        paper_size = gtk_paper_size_get_default ();
+        if (g_str_equal (paper_size, GTK_PAPER_NAME_LETTER))
+                paper_size = "Letter";
         else
-                paper_size = g_strdup ("A4");
+                paper_size = "A4";
 
         if (ppd_file_name) {
                 ppd_file = ppdOpenFile (ppd_file_name);
@@@@ -842,7 +832,6 @@@@ set_default_paper_size (const gchar *printer_name,
                 g_strfreev (value);
         }
 
-        g_free (paper_size);
         g_object_unref (proxy);
 }
 
@


1.2
log
@Use gtk_paper_size_get_default, from upstream.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@Update to gnome-settings-daemon-3.2.0.
@
text
@d3 4
a6 1
Fix build if some locale defines are missing.
d9 54
a62 2
+++ plugins/print-notifications/gsd-printer.c	Tue Sep 27 11:28:16 2011
@@@@ -771,7 +771,9 @@@@ set_default_paper_size (const gchar *printer_name,
d65 3
a67 6
         /* Set default PaperSize according to the locale */
+#ifdef LC_PAPER
         locale = setlocale (LC_PAPER, NULL);
+#endif
         if (!locale)
                 locale = setlocale (LC_MESSAGES, NULL);
@

