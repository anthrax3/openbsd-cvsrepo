head	1.11;
access;
symbols
	OPENBSD_4_7:1.4.0.2
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.1.1.1.0.4
	OPENBSD_4_6_BASE:1.1.1.1
	OPENBSD_4_5:1.1.1.1.0.2
	OPENBSD_4_5_BASE:1.1.1.1
	jasper_20081111:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.11
date	2013.06.08.11.16.27;	author ajacoutot;	state dead;
branches;
next	1.10;

1.10
date	2013.05.17.15.08.04;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2013.04.16.11.40.58;	author ajacoutot;	state dead;
branches;
next	1.8;

1.8
date	2013.04.10.14.29.53;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2013.04.02.08.30.32;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2013.04.02.07.22.31;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2010.03.21.10.37.47;	author ajacoutot;	state dead;
branches;
next	1.4;

1.4
date	2009.11.12.00.14.53;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2009.10.11.22.53.22;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2009.07.21.12.35.54;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2008.11.11.22.22.41;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.11.11.22.22.41;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.11
log
@Update to gnome-settings-daemon-3.8.3.
@
text
@$OpenBSD: patch-plugins_media-keys_gsd-media-keys-manager_c,v 1.10 2013/05/17 15:08:04 ajacoutot Exp $

From 95f242c15222b0821c03676d52c82c4dba6ec07a Mon Sep 17 00:00:00 2001
From: Giovanni Campagna <gcampagna@@src.gnome.org>
Date: Fri, 10 May 2013 15:53:29 +0000
Subject: media-keys: don't crash when calling GrabAccelerators with an empty list

--- plugins/media-keys/gsd-media-keys-manager.c.orig	Tue May 14 12:04:02 2013
+++ plugins/media-keys/gsd-media-keys-manager.c	Fri May 17 16:56:57 2013
@@@@ -491,7 +491,7 @@@@ grab_media_keys (GsdMediaKeysManager *manager)
         GVariantBuilder builder;
         int i;
 
-        g_variant_builder_init (&builder, G_VARIANT_TYPE_ARRAY);
+        g_variant_builder_init (&builder, G_VARIANT_TYPE ("a(su)"));
 
         for (i = 0; i < manager->priv->keys->len; i++) {
                 MediaKey *key;
@


1.10
log
@Fix a crash in the media-keys plugin (upstream).
@
text
@d1 1
a1 1
$OpenBSD$
@


1.9
log
@Update to gnome-settings-daemon-3.8.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_media-keys_gsd-media-keys-manager_c,v 1.8 2013/04/10 14:29:53 ajacoutot Exp $
d3 4
a6 4
From 6bb589a5d87c2407c4d5a00dfc543b93906f0fa3 Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@@gnome.org>
Date: Tue, 02 Apr 2013 06:37:40 +0000
Subject: media-keys: handle GSD_POWER_ACTION_LOGOUT
d8 5
a12 51
From 307f421196c39502e7a4c7d20931a1d310c877bf Mon Sep 17 00:00:00 2001
From: Lionel Landwerlin <llandwerlin@@gmail.com>
Date: Wed, 10 Apr 2013 11:31:40 +0000
Subject: media-keys: fix race condition

--- plugins/media-keys/gsd-media-keys-manager.c.orig	Wed Apr 10 16:24:57 2013
+++ plugins/media-keys/gsd-media-keys-manager.c	Wed Apr 10 16:24:47 2013
@@@@ -596,6 +596,10 @@@@ gsettings_changed_cb (GSettings           *settings,
 {
         int      i;
 
+        /* Give up if we don't have proxy to the shell */
+        if (!manager->priv->key_grabber)
+                return;
+
 	/* handled in gsettings_custom_changed_cb() */
         if (g_str_equal (settings_key, "custom-keybindings"))
 		return;
@@@@ -765,8 +769,6 @@@@ init_kbd (GsdMediaKeysManager *manager)
 
         gnome_settings_profile_start (NULL);
 
-        manager->priv->keys = g_ptr_array_new_with_free_func ((GDestroyNotify) media_key_free);
-
         /* Media keys
          * Add hard-coded shortcuts first so that they can't be preempted */
         for (i = 0; i < G_N_ELEMENTS (media_keys); i++) {
@@@@ -1808,6 +1810,7 @@@@ do_config_power_action (GsdMediaKeysManager *manager,
                 power_action_hibernate (manager);
                 break;
         case GSD_POWER_ACTION_BLANK:
+        case GSD_POWER_ACTION_LOGOUT:
         case GSD_POWER_ACTION_NOTHING:
                 /* these actions cannot be handled by media-keys and
                  * are not used in this context */
@@@@ -2250,6 +2253,9 @@@@ on_shell_vanished (GDBusConnection  *connection,
                    gpointer          user_data)
 {
         GsdMediaKeysManager *manager = user_data;
+
+        g_ptr_array_set_size (manager->priv->keys, 0);
+
         g_clear_object (&manager->priv->key_grabber);
         g_clear_object (&manager->priv->osd_proxy);
 }
@@@@ -2261,6 +2267,8 @@@@ start_media_keys_idle_cb (GsdMediaKeysManager *manager
 
         g_debug ("Starting media_keys manager");
         gnome_settings_profile_start (NULL);
+
+        manager->priv->keys = g_ptr_array_new_with_free_func ((GDestroyNotify) media_key_free);
d14 2
a15 1
         initialize_volume_handler (manager);
d17 2
@


1.8
log
@Fix a race condition that could lead to a crash (upstream).
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_media-keys_gsd-media-keys-manager_c,v 1.7 2013/04/02 08:30:32 ajacoutot Exp $
@


1.7
log
@Committed upstream.
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_media-keys_gsd-media-keys-manager_c,v 1.6 2013/04/02 07:22:31 ajacoutot Exp $
d8 28
a35 3
--- plugins/media-keys/gsd-media-keys-manager.c.orig	Tue Apr  2 08:23:46 2013
+++ plugins/media-keys/gsd-media-keys-manager.c	Tue Apr  2 08:23:23 2013
@@@@ -1808,6 +1808,7 @@@@ do_config_power_action (GsdMediaKeysManager *manager,
d43 19
@


1.6
log
@Fix a warning.
@
text
@d1 1
a1 1
$OpenBSD$
d3 4
a6 1
https://bugzilla.gnome.org/show_bug.cgi?id=697083
@


1.5
log
@Update to gnome-settings-daemon-2.28.2.

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_media-keys_gsd-media-keys-manager_c,v 1.4 2009/11/12 00:14:53 jasper Exp $
d3 1
a3 1
- Give eject(1) a slightly bigger chance of actually doing something.
d5 10
a14 11
--- plugins/media-keys/gsd-media-keys-manager.c.orig	Mon Sep 21 12:24:02 2009
+++ plugins/media-keys/gsd-media-keys-manager.c	Thu Nov 12 01:04:54 2009
@@@@ -64,7 +64,7 @@@@
 #define MAX_VOLUME 65536.0
 
 #if defined(__OpenBSD__)
-# define EJECT_COMMAND "eject -t /dev/cd0"
+# define EJECT_COMMAND "eject -t /dev/rcd0c"
 #else
 # define EJECT_COMMAND "eject -T"
 #endif
@


1.4
log
@- minor cleanups:
* regen PLIST
* use FAKE_FLAGS
* add a comment to patch-gnome-settings-daemon_gnome-settings-module_c
* remove bogus chunk from patch-plugins_media-keys_gsd-media-keys-manager_c
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_media-keys_gsd-media-keys-manager_c,v 1.3 2009/10/11 22:53:22 ajacoutot Exp $
@


1.3
log
@Major update to gnome-settings-daemon-2.28.0.
Make this run_depends on gnome-icon-theme so that we have a minimal
working configuration.
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_media-keys_gsd-media-keys-manager_c,v 1.2 2009/07/21 12:35:54 ajacoutot Exp $
a3 1
- Set the correct "sleep" command for apm(8).
d5 2
a6 2
--- plugins/media-keys/gsd-media-keys-manager.c.orig	Sun Oct 11 23:53:00 2009
+++ plugins/media-keys/gsd-media-keys-manager.c	Sun Oct 11 23:54:43 2009
a15 12
@@@@ -896,6 +896,11 @@@@ do_action (GsdMediaKeysManager *manager,
                 break;
         case SLEEP_KEY:
                 do_sleep_action (SLEEP_COMMAND, "xset dpms force off");
+#if defined(__OpenBSD__) || defined(__FreeBSD__)
+                do_sleep_action ("zzz", "xset dpms force off");
+#else
+                do_sleep_action ("apm", "xset dpms force off");
+#endif
                 break;
         case SCREENSAVER_KEY:
                 if ((cmd = g_find_program_in_path ("gnome-screensaver-command"))) {
@


1.2
log
@Fix device insertion command.
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_media-keys_gsd-media-keys-manager_c,v 1.1.1.1 2008/11/11 22:22:41 jasper Exp $
d6 4
a9 12
--- plugins/media-keys/gsd-media-keys-manager.c.orig	Mon Aug  4 16:25:52 2008
+++ plugins/media-keys/gsd-media-keys-manager.c	Tue Nov 11 21:33:36 2008
@@@@ -575,7 +575,11 @@@@ do_eject_action (GsdMediaKeysManager *manager)
         if ((command != NULL) && (strcmp (command, "") != 0)) {
                 execute (manager, command, FALSE, FALSE);
         } else {
+#if defined(__OpenBSD__)
+                 execute (manager, "eject -t /dev/rcd0c", FALSE, FALSE);
+#else
                 execute (manager, "eject -T", FALSE, FALSE);
+#endif
         }
d11 7
a17 3
         g_free (command);
@@@@ -785,7 +789,11 @@@@ do_action (GsdMediaKeysManager *manager,
                 do_mail_action (manager);
d20 1
a20 1
-                do_sleep_action ("apm", "xset dpms force off");
d24 1
a24 1
+                 do_sleep_action ("apm", "xset dpms force off");
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d13 1
a13 1
+                 execute (manager, "eject -t /dev/cd0", FALSE, FALSE);
@


1.1.1.1
log
@import gnome-settings-daemon 2.24.0 (not linked to the builds yet)

GNOME settings deamon to control settings and preferences throughout the
desktop.

this used to be part of gnome-control-center, but it was split of.
it depends on some stuff not committed yet (e.g. gnome-desktop update),
but having it in tree allows the gtk-frogs to test it more easily. 

@
text
@@
