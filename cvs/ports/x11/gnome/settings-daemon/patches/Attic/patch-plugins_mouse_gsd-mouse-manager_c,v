head	1.2;
access;
symbols
	OPENBSD_4_6:1.1.0.4
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.2
	OPENBSD_4_5_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2009.10.11.22.53.22;	author ajacoutot;	state dead;
branches;
next	1.1;

1.1
date	2009.02.02.15.13.08;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Major update to gnome-settings-daemon-2.28.0.
Make this run_depends on gnome-icon-theme so that we have a minimal
working configuration.
@
text
@$OpenBSD: patch-plugins_mouse_gsd-mouse-manager_c,v 1.1 2009/02/02 15:13:08 ajacoutot Exp $

GNOME bug #562977:
fix crash with X servers that don't provide XInput (e.g. VNC...)

--- plugins/mouse/gsd-mouse-manager.c.orig	Tue Nov 25 00:02:41 2008
+++ plugins/mouse/gsd-mouse-manager.c	Fri Jan 30 22:55:58 2009
@@@@ -327,9 +327,14 @@@@ devicepresence_filter (GdkXEvent *xevent,
 static void
 set_devicepresence_handler (GsdMouseManager *manager)
 {
-        Display *display = gdk_x11_get_default_xdisplay ();
+        Display *display;
         XEventClass class_presence;
         int xi_presence;
+
+        if (!supports_xinput_devices ())
+                return;
+
+        display = gdk_x11_get_default_xdisplay ();
 
         gdk_error_trap_push ();
         DevicePresence (display, xi_presence, class_presence);
@


1.1
log
@- fix 2 crashes under VNC displays:
* patch-plugins_mouse_gsd-mouse-manager_c is from upstream SVN: fix crash
with X servers that don't provide XInput
* patch-gnome-settings-daemon_gnome-settings-module_c: disable loading of
the keyboard plugin under VNC-like displays

"commit it" jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@

