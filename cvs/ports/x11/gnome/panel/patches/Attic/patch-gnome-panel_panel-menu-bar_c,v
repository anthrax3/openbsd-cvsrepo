head	1.5;
access;
symbols
	OPENBSD_5_1_BASE:1.4
	OPENBSD_5_1:1.4.0.2
	OPENBSD_5_0:1.1.0.8
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.6
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.4
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2012.03.29.06.53.15;	author ajacoutot;	state dead;
branches;
next	1.4;

1.4
date	2012.01.25.18.18.14;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2011.12.28.08.56.57;	author ajacoutot;	state dead;
branches;
next	1.2;

1.2
date	2011.09.12.07.28.54;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2009.11.15.17.36.38;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update to gnome-panel-3.4.0.
@
text
@$OpenBSD: patch-gnome-panel_panel-menu-bar_c,v 1.4 2012/01/25 18:18:14 ajacoutot Exp $

From Ubuntu: disable help buttons since gnome-panel help is no longer in
the GNOME user guide.
(https://bugs.launchpad.net/ubuntu/+source/gnome-panel/+bug/885959)

--- gnome-panel/panel-menu-bar.c.orig	Tue Apr  5 12:39:04 2011
+++ gnome-panel/panel-menu-bar.c	Wed Jan 25 18:55:43 2012
@@@@ -244,12 +244,12 @@@@ panel_menu_bar_load (PanelWidget *panel,
 					   panel_lockdown_get_not_panels_locked_down_s);
 	}
 
-	panel_applet_add_callback (menubar->priv->info,
+	/*panel_applet_add_callback (menubar->priv->info,
 				   "help",
 				   GTK_STOCK_HELP,
 				   _("_Help"),
 				   NULL);
-
+	*/
 	panel_menu_bar_object_object_load_finish (PANEL_MENU_BAR_OBJECT (menubar),
 						  panel);
 }
@


1.4
log
@From Ubuntu: disable help buttons since gnome-panel help is no longer in
the GNOME user guide.
(https://bugs.launchpad.net/ubuntu/+source/gnome-panel/+bug/885959)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.3
log
@Our gnome-session already exports XDG_MENU_PREFIX in the environment, so
no need to play with get/setenv.
gnome-panel is not supposed to be started by anything than gnome-session
anyway and it will ease future updates.
@
text
@d1 11
a11 5
$OpenBSD: patch-gnome-panel_panel-menu-bar_c,v 1.2 2011/09/12 07:28:54 jasper Exp $
--- gnome-panel/panel-menu-bar.c.orig	Wed May 18 11:12:53 2011
+++ gnome-panel/panel-menu-bar.c	Wed May 18 11:14:30 2011
@@@@ -29,6 +29,7 @@@@
 #include "panel-menu-bar.h"
d13 11
a23 27
 #include <string.h>
+#include <stdlib.h>
 #include <glib/gi18n.h>
 
 #include <libpanel-util/panel-error.h>
@@@@ -125,11 +126,20 @@@@ panel_menu_bar_setup_tooltip (PanelMenuBar *menubar)
 static void
 panel_menu_bar_init (PanelMenuBar *menubar)
 {
+	gchar     *xdgMenuPrefix, *applicationsMenu;
+
 	menubar->priv = PANEL_MENU_BAR_GET_PRIVATE (menubar);
 
 	menubar->priv->info = NULL;
 
-	menubar->priv->applications_menu = create_applications_menu ("applications.menu", NULL, TRUE);
+	/* Respect XDG_MENU_PREFIX */
+	setenv ("XDG_MENU_PREFIX", "gnome-", 0);
+
+	xdgMenuPrefix = getenv ("XDG_MENU_PREFIX");
+	applicationsMenu = g_strconcat (xdgMenuPrefix, "applications.menu", NULL);
+
+	menubar->priv->applications_menu = create_applications_menu (applicationsMenu, NULL, TRUE);
+	g_free (applicationsMenu);
 
 	menubar->priv->applications_item = panel_image_menu_item_new ();
 	gtk_menu_item_set_label (GTK_MENU_ITEM (menubar->priv->applications_item),
@


1.2
log
@Moar GNOME3 merge
@
text
@d1 1
a1 1
$OpenBSD: patch-gnome-panel_panel-menu-bar_c,v 1.1.1.1 2011/05/18 15:32:45 jasper Exp $
@


1.1
log
@Respect XDG_MENU_PREFIX.
Set default menu file to gnome-applications.menu.
@
text
@d1 3
a3 3
$OpenBSD$
--- gnome-panel/panel-menu-bar.c.orig	Tue Sep  8 02:08:42 2009
+++ gnome-panel/panel-menu-bar.c	Sun Nov 15 16:26:56 2009
d12 2
a13 1
@@@@ -135,12 +136,20 @@@@ static void
a15 1
 	GtkWidget *image;
d17 1
a17 1
 
@

