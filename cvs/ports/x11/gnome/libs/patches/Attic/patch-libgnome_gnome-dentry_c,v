head	1.5;
access;
symbols
	OPENBSD_4_4:1.4.0.6
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.4
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.2.0.18
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.16
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.14
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.12
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.10
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.8
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.6
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.4
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.2
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.1.1.1.0.6
	OPENBSD_3_2_BASE:1.1.1.1
	OPENBSD_3_1:1.1.1.1.0.4
	OPENBSD_3_1_BASE:1.1.1.1
	OPENBSD_3_0:1.1.1.1.0.2
	OPENBSD_3_0_BASE:1.1.1.1
	gnome:1.1.1.1
	todd:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2008.08.27.07.41.59;	author jasper;	state dead;
branches;
next	1.4;

1.4
date	2007.06.01.16.44.41;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2007.06.01.15.28.06;	author jasper;	state dead;
branches;
next	1.2;

1.2
date	2003.01.02.03.32.25;	author marcm;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.13.20.27.19;	author todd;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.09.13.20.27.19;	author todd;	state Exp;
branches;
next	;


desc
@@


1.5
log
@- remove old, unused and unneeded gtk+1 cruft

ok ajacoutot@@
agreed by mbalmer@@
@
text
@$OpenBSD: patch-libgnome_gnome-dentry_c,v 1.4 2007/06/01 16:44:41 jasper Exp $
--- libgnome/gnome-dentry.c.orig	Wed Aug  7 00:57:14 2002
+++ libgnome/gnome-dentry.c	Fri Jun  1 18:38:20 2007
@@@@ -88,7 +88,7 @@@@ add_comment_or_name(GList *list, char *lang, char *nam
 
 /*read the names and comments from the desktop file*/
 static GList *
-read_names_and_comments(const char *file, int is_kde)
+read_names_and_comments(const char *file, int is_old_kde)
 {
 	GList *i18n_list = NULL;
 	
@@@@ -97,11 +97,11 @@@@ read_names_and_comments(const char *file, int is_kde)
 	char *prefix;
 	
 	gnome_config_push_prefix ("");
-	if(!is_kde) {
-		prefix = g_strconcat ("=", file, "=/Desktop Entry", NULL);
-	} else {
-		prefix = g_strconcat ("=", file, "=/KDE Desktop Entry", NULL);
-	}
+        if(!is_old_kde) {
+                prefix = g_strconcat ("=", file, "=/Desktop Entry", NULL);
+        } else {
+                prefix = g_strconcat ("=", file, "=/KDE Desktop Entry", NULL);
+        }
 	iterator = gnome_config_init_iterator(prefix);
 	g_free(prefix);
 	gnome_config_pop_prefix ();
@@@@ -155,7 +155,7 @@@@ gnome_desktop_entry_load_flags_conditional (const char
 	int exec_length;
 	char *icon_base;
 	char *p = NULL;
-	gboolean is_kde = FALSE;
+	gboolean is_old_kde = FALSE;
  	gboolean is_dot_directory = FALSE;
 #ifdef __GLIBC__
 	gboolean is_utf8;
@@@@ -178,8 +178,8 @@@@ gnome_desktop_entry_load_flags_conditional (const char
 		gnome_config_push_prefix (prefix);
 		g_free (prefix);
 
-		is_kde = TRUE;
-
+		is_old_kde = TRUE;
+		
 		name = gnome_config_get_translated_string ("Name");
 		if (!name) {
 			gnome_config_pop_prefix ();
@@@@ -197,7 +197,8 @@@@ gnome_desktop_entry_load_flags_conditional (const char
 	    strcmp (file + strlen (file) - strlen (".directory"), ".directory") == 0)
 		is_dot_directory = TRUE;
 	
-	type      = gnome_config_get_string (is_dot_directory ? "Type=Directory" : "Type");
+	if( !(type = gnome_config_get_string ("Type") ) )
+ 	    type = gnome_config_get_string ("Type=Directory");
 	gnome_config_get_vector ("Exec", &exec_length, &exec_vector);
 	try_file  = gnome_config_get_string ("TryExec");
 
@@@@ -249,15 +250,21 @@@@ gnome_desktop_entry_load_flags_conditional (const char
 	newitem->geometry      = gnome_config_get_string ("Geometry");
 	newitem->multiple_args = gnome_config_get_bool   ("MultipleArgs=0");
 	newitem->location      = g_strdup (file);
-	newitem->is_kde       =  is_kde;
 
 	icon_base              = gnome_config_get_string ("Icon");
 
 	if (icon_base && *icon_base) {
 		/* Sigh, now we need to make them local to the gnome install */
 		if (*icon_base != '/') {
-			if (newitem->is_kde) {
-				gchar *iconname = g_concat_dir_and_file (KDE_ICONDIR, icon_base);
+		        /*
+			   HACK: determine if file is an KDE desktop entry.
+			   KDE desktop files don't have the file-extension embedded in icon_base.
+			*/
+		        if( !strstr( icon_base, "." ) ) {
+			        gchar *icon_base_full = g_strconcat (icon_base, ".png", NULL);
+				gchar *iconname = g_concat_dir_and_file (KDE_ICONDIR, icon_base_full);
+			        newitem->is_kde = TRUE;
+				g_free (icon_base_full);
 				if (g_file_exists (iconname))
 					newitem->icon = iconname;
 				else {
@@@@ -293,7 +300,7 @@@@ gnome_desktop_entry_load_flags_conditional (const char
 	gnome_config_pop_prefix ();
 
 	/*get us the Names and comments of different languages*/
-	i18n_list = read_names_and_comments (file, is_kde);
+	i18n_list = read_names_and_comments (file, is_old_kde);
 	gnome_desktop_entry_set_i18n_list (newitem, i18n_list);
 	
 	if (clean_from_memory_after_load) {
@


1.4
log
@gnome-libs should've stayed...sorry
spotted by steven@@
@
text
@d1 1
a1 1
$OpenBSD: patch-libgnome_gnome-dentry_c,v 1.2 2003/01/02 03:32:25 marcm Exp $
@


1.3
log
@remove obsolete gnome1 stuff.

gnome1 removal ok'd by naddy@@ todd@@ and others
@
text
@d2 3
a4 3
--- libgnome/gnome-dentry.c.orig	Tue Aug  6 15:57:14 2002
+++ libgnome/gnome-dentry.c	Sat Nov 30 12:43:44 2002
@@@@ -88,7 +88,7 @@@@ add_comment_or_name(GList *list, char *l
d13 1
a13 1
@@@@ -97,11 +97,11 @@@@ read_names_and_comments(const char *file
d30 1
a30 1
@@@@ -155,7 +155,7 @@@@ gnome_desktop_entry_load_flags_condition
d39 1
a39 1
@@@@ -178,8 +178,8 @@@@ gnome_desktop_entry_load_flags_condition
d50 1
a50 1
@@@@ -197,7 +197,8 @@@@ gnome_desktop_entry_load_flags_condition
d60 1
a60 1
@@@@ -249,15 +250,21 @@@@ gnome_desktop_entry_load_flags_condition
d85 1
a85 1
@@@@ -293,7 +300,7 @@@@ gnome_desktop_entry_load_flags_condition
@


1.2
log
@Update to latest (and probably last) stable version.  Take MAINTAINER.
@
text
@d1 1
a1 1
$OpenBSD: patch-libgnome_gnome-dentry_c,v 1.1.1.1 2001/09/13 20:27:19 todd Exp $
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD$
--- libgnome/gnome-dentry.c.orig	Wed Jan 24 02:09:46 2001
+++ libgnome/gnome-dentry.c	Tue Aug 28 13:49:32 2001
@@@@ -75,7 +75,7 @@@@ add_comment_or_name(GList *list, char *l
d13 1
a13 1
@@@@ -84,11 +84,11 @@@@ read_names_and_comments(const char *file
d30 1
a30 1
@@@@ -139,7 +139,7 @@@@ gnome_desktop_entry_load_flags_condition
d36 4
a39 4
 	
 	GList *i18n_list = NULL;
 	
@@@@ -157,8 +157,8 @@@@ gnome_desktop_entry_load_flags_condition
d50 5
a54 5
@@@@ -172,7 +172,8 @@@@ gnome_desktop_entry_load_flags_condition
 	 * entries, we will later need to make this code smarter.
 	 */
 
-	type      = gnome_config_get_string (is_kde ? "Type=Directory" : "Type");
d56 1
a56 1
+	    type = gnome_config_get_string ("Type=Directory");
d60 1
a60 1
@@@@ -204,15 +205,21 @@@@ gnome_desktop_entry_load_flags_condition
d85 1
a85 1
@@@@ -233,7 +240,7 @@@@ gnome_desktop_entry_load_flags_condition
@


1.1.1.1
log
@libraries for the GNOME project
@
text
@@
