head	1.6;
access;
symbols
	OPENBSD_5_2:1.5.0.4
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.2
	OPENBSD_5_0:1.4.0.2
	OPENBSD_5_0_BASE:1.4
	jasper_20111305:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2012.09.28.14.51.11;	author jasper;	state dead;
branches;
next	1.5;

1.5
date	2011.09.21.20.27.31;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2011.05.27.13.12.34;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2011.05.22.13.55.27;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2011.05.16.09.40.44;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2011.05.13.09.59.35;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.05.13.09.59.35;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.6
log
@remove seed, it's been superseded by gjs and wasn't really picked up by any projects.
@
text
@$OpenBSD: patch-modules_os_seed-os_c,v 1.5 2011/09/21 20:27:31 jasper Exp $

fix #650234 Add FreeBSD/OpenBSD support to os/seed-os.c
from upstream git: 03c808137331be912e9adde997dd2830cf2e5593

--- modules/os/seed-os.c.orig	Tue May 17 18:46:37 2011
+++ modules/os/seed-os.c	Wed Sep 21 13:17:45 2011
@@@@ -38,6 +38,8 @@@@
 #include <termios.h>
 #if defined(__FreeBSD__)
 #include <libutil.h>
+#elif defined(__OpenBSD__)
+#include <util.h>
 #endif
 #include <unistd.h>
 
@


1.5
log
@- update seed to 3.1.1.1 (git master as of today)
* unbreaks after recent gobject-introspection update
@
text
@d1 1
a1 1
$OpenBSD: patch-modules_os_seed-os_c,v 1.4 2011/05/27 13:12:34 jasper Exp $
@


1.4
log
@fix implicit declaration
@
text
@d1 1
a1 1
$OpenBSD: patch-modules_os_seed-os_c,v 1.3 2011/05/22 13:55:27 jasper Exp $
d6 6
a11 15
--- modules/os/seed-os.c.orig	Tue Feb 22 23:44:01 2011
+++ modules/os/seed-os.c	Fri May 27 15:10:56 2011
@@@@ -29,8 +29,19 @@@@
 
 #include <sys/stat.h>
 #include <sys/utsname.h>
+#if defined(__FreeBSD__) || defined(__OpenBSD__)
+#include <sys/param.h>
+#endif
 
 #include <sys/types.h>
+#include <sys/ioctl.h>
+#include <termios.h>
+#if defined(__FreeBSD__)
+#include <libutil.h>
d14 2
a15 38
+#endif
+#include <unistd.h>
 
 #include <fcntl.h>
 
@@@@ -54,18 +65,32 @@@@ seed_os_realpath (SeedContext ctx,
 	          const SeedValue arguments[],
 	          SeedException * exception)
 {
+  SeedValue sv;
   gchar *arg;
+  gchar *resolved_path;
   gchar *ret;
+  gsize path_max;
 
   if (argument_count != 1)
     {
       EXPECTED_EXCEPTION("os.realpath", "1 argument");
     }
   arg = seed_value_to_string (ctx, arguments[0], exception);
-  ret = realpath(arg, NULL);
+#ifdef PATH_MAX
+  path_max = PATH_MAX;
+#else
+  path_max = pathconf (arg, _PC_PATH_MAX);
+  if (path_max <= 0)
+    path_max = 4096;
+#endif
+  resolved_path = (gchar *) g_malloc (path_max);
+  ret = realpath(arg, resolved_path);
   g_free (arg);
 
-  return seed_value_from_string (ctx, ret, exception);
+  sv = seed_value_from_string (ctx, ret, exception);
+  g_free (resolved_path);
+
+  return sv;
 }
a16 43
 SeedValue
@@@@ -559,7 +584,12 @@@@ seed_os_unsetenv (SeedContext ctx,
     }
 
   arg = seed_value_to_string (ctx, arguments[0], exception);
+#if __FreeBSD_version < 700000
+  ret = 0;
+  unsetenv (arg);
+#else
   ret = unsetenv (arg);
+#endif
   g_free (arg);
 
   return seed_value_from_int (ctx, ret, exception);
@@@@ -702,6 +732,7 @@@@ seed_os_fdatasync (SeedContext ctx,
 		   const SeedValue arguments[],
 		   SeedException * exception)
 {
+#if !defined(__FreeBSD__) && !defined(__OpenBSD__)
   gint fd;
 
   if (argument_count != 1)
@@@@ -711,6 +742,10 @@@@ seed_os_fdatasync (SeedContext ctx,
   fd = seed_value_to_int (ctx, arguments[0], exception);
 
   return seed_value_from_int (ctx, fdatasync (fd), exception);
+#else
+  errno = ENOSYS;
+  return seed_value_from_int (ctx, -1, exception);
+#endif
 }
 
 SeedValue
@@@@ -1113,7 +1148,9 @@@@ seed_module_init(SeedEngine * eng)
 #if defined (O_DIRECT)
   OS_DEFINE_QUICK_ENUM (O_DIRECT);
 #endif
+#if defined (O_DIRECTORY)
   OS_DEFINE_QUICK_ENUM (O_DIRECTORY);
+#endif
   OS_DEFINE_QUICK_ENUM (O_NOFOLLOW);
 #if defined (O_NOATIME)
   OS_DEFINE_QUICK_ENUM (O_NOATIME);
@


1.3
log
@no need to include util.h for us.
@
text
@d1 1
a1 1
$OpenBSD: patch-modules_os_seed-os_c,v 1.2 2011/05/16 09:40:44 jasper Exp $
d7 2
a8 2
+++ modules/os/seed-os.c	Tue May 17 08:44:33 2011
@@@@ -29,8 +29,17 @@@@
d21 2
d28 1
a28 1
@@@@ -54,18 +63,32 @@@@ seed_os_realpath (SeedContext ctx,
d63 1
a63 1
@@@@ -559,7 +582,12 @@@@ seed_os_unsetenv (SeedContext ctx,
d76 1
a76 1
@@@@ -702,6 +730,7 @@@@ seed_os_fdatasync (SeedContext ctx,
d84 1
a84 1
@@@@ -711,6 +740,10 @@@@ seed_os_fdatasync (SeedContext ctx,
d95 1
a95 1
@@@@ -1113,7 +1146,9 @@@@ seed_module_init(SeedEngine * eng)
@


1.2
log
@tweak comments
@
text
@d1 1
a1 1
$OpenBSD: patch-modules_os_seed-os_c,v 1.1.1.1 2011/05/13 09:59:35 jasper Exp $
d7 2
a8 2
+++ modules/os/seed-os.c	Fri May 13 10:36:23 2011
@@@@ -29,8 +29,19 @@@@
d19 1
a19 3
+#if defined(__OpenBSD__)
+#include <util.h>
+#else
d26 1
a26 1
@@@@ -54,18 +65,32 @@@@ seed_os_realpath (SeedContext ctx,
d61 1
a61 1
@@@@ -559,7 +584,12 @@@@ seed_os_unsetenv (SeedContext ctx,
d74 1
a74 1
@@@@ -702,6 +732,7 @@@@ seed_os_fdatasync (SeedContext ctx,
d82 1
a82 1
@@@@ -711,6 +742,10 @@@@ seed_os_fdatasync (SeedContext ctx,
d93 1
a93 1
@@@@ -1113,7 +1148,9 @@@@ seed_module_init(SeedEngine * eng)
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 2
Port to FreeBSD and OpenBSD.
Based on FreeBSD's patch-modules_os_seed-os.c
@


1.1.1.1
log
@import seed 3.0.0

Seed is a library and interpreter, dynamically bridging (through
gobject-introspection) the WebKit JavaScriptCore engine with the GObject
type system. In a more concrete sense, Seed enables you to immediately
write applications around a significant portion of the GNOME platform,
and easily embed JavaScript as a scripting language in your GObject
library.

ok aja@@
@
text
@@
