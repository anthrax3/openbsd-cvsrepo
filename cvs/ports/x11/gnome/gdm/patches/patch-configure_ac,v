head	1.12;
access;
symbols
	OPENBSD_6_2:1.12.0.2
	OPENBSD_6_2_BASE:1.12
	OPENBSD_6_1:1.11.0.2
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.9.0.2
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.7.0.2
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.6.0.8
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.4
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.2
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.3.0.2
	OPENBSD_5_5_BASE:1.3;
locks; strict;
comment	@# @;


1.12
date	2017.04.17.13.17.07;	author ajacoutot;	state Exp;
branches;
next	1.11;
commitid	jKsCTviiCSXwN30M;

1.11
date	2017.03.03.13.01.26;	author ajacoutot;	state Exp;
branches;
next	1.10;
commitid	yUSOqvnIs3zvjqyw;

1.10
date	2016.10.31.16.15.46;	author ajacoutot;	state Exp;
branches;
next	1.9;
commitid	NJnOZaVXR2tBRWDk;

1.9
date	2016.04.26.08.25.04;	author ajacoutot;	state Exp;
branches;
next	1.8;
commitid	U2wyfq8sPYBn4Lxu;

1.8
date	2016.04.15.14.11.09;	author ajacoutot;	state Exp;
branches;
next	1.7;
commitid	Mbx3T92O3F2i3yTU;

1.7
date	2015.10.18.13.25.54;	author ajacoutot;	state Exp;
branches;
next	1.6;
commitid	hskL6TnJZ8GALNPe;

1.6
date	2014.05.16.16.48.58;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2014.04.15.13.15.19;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2014.03.27.19.19.17;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2014.01.21.17.39.30;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2013.06.17.13.22.51;	author ajacoutot;	state dead;
branches;
next	1.1;

1.1
date	2013.06.15.11.53.41;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.12
log
@Update to gdm-3.24.1.
@
text
@$OpenBSD: patch-configure_ac,v 1.11 2017/03/03 13:01:26 ajacoutot Exp $

REVERT - Linux-PAM
From 714b6af29b916ac7da0cdab6f83460574ed49cf2 Mon Sep 17 00:00:00 2001
From: Ray Strode <rstrode@@redhat.com>
Date: Mon, 15 Aug 2016 13:48:00 -0400
Subject: pam_gdm: add stub pam module

REVERT - OpenBSD does not have a systemd implementation (we need ConsoleKit)
From 1ac67f522f5690c27023d98096ca817f12f7eb88 Mon Sep 17 00:00:00 2001
From: Ray Strode <rstrode@@redhat.com>
Date: Fri, 12 Jun 2015 13:28:01 -0400
Subject: drop consolekit support

https://bugzilla.gnome.org/show_bug.cgi?id=722482

--- configure.ac.orig	Wed Apr 12 16:14:35 2017
+++ configure.ac	Mon Apr 17 14:17:27 2017
@@@@ -232,12 +232,6 @@@@ AM_CONDITIONAL(ENABLE_EXHERBO_PAM_CONFIG, test x$with_
 AM_CONDITIONAL(ENABLE_LFS_PAM_CONFIG, test x$with_default_pam_config = xlfs)
 AM_CONDITIONAL(ENABLE_ARCH_PAM_CONFIG, test x$with_default_pam_config = xarch)
 
-AC_CHECK_HEADERS([security/pam_modules.h security/pam_modutil.h security/pam_ext.h],
-                 [have_pam=yes],
-                 [if test "x$have_pam" = xyes ; then
-                        AC_MSG_ERROR([PAM development files not found.])
-                 fi])
-
 AC_ARG_ENABLE(console-helper,
 	      AS_HELP_STRING([--enable-console-helper],
                              [Enable PAM console helper @@<:@@default=auto@@:>@@]),,
@@@@ -263,7 +257,15 @@@@ AC_ARG_WITH(tcp-wrappers,
                            [Use TCP Wrappers @@<:@@default=auto@@:>@@]),,
             with_tcp_wrappers=auto)
 
+AC_ARG_WITH(console-kit,
+            AS_HELP_STRING([--with-console-kit],
+                           [Add ConsoleKit support @@<:@@default=auto@@:>@@]),,
+            with_console_kit=no)
 
+AC_ARG_WITH(systemd,
+            AS_HELP_STRING([--with-systemd],
+                           [Add systemd support @@<:@@default=auto@@:>@@]),
+            [with_systemd=$withval], [with_systemd=auto])
 AC_ARG_WITH([systemdsystemunitdir],
             AS_HELP_STRING([--with-systemdsystemunitdir=DIR],
                            [Directory for systemd service files]),
@@@@ -646,14 +648,8 @@@@ dnl --------------------------------------------------
 dnl - Check for utmp stuff
 dnl ---------------------------------------------------------------------------
 
-AC_CHECK_HEADERS(utmp.h utmpx.h libutil.h sys/param.h)
-AC_CHECK_FUNCS([getutxent updwtmpx updwtmp])
-AC_CHECK_LIB(util, login, [
-		   AC_DEFINE(HAVE_LOGIN, 1, [Define if have login])
-		       EXTRA_DAEMON_LIBS="$EXTRA_DAEMON_LIBS -lutil" ])
-AC_CHECK_LIB(util, logout, [
-		   AC_DEFINE(HAVE_LOGOUT, 1, [Define if have logout])
-		       EXTRA_DAEMON_LIBS="$EXTRA_DAEMON_LIBS -lutil" ])
+AC_CHECK_HEADERS(utmp.h utmpx.h util.h sys/param.h)
+AC_CHECK_FUNCS([getutxent getttyent updwtmpx updwtmp])
 AC_CHECK_LIB(util, logwtmp, [
 	  	   AC_DEFINE(HAVE_LOGWTMP, 1, [Define if have logwtmp])
 		       EXTRA_DAEMON_LIBS="$EXTRA_DAEMON_LIBS -lutil" ])
@@@@ -902,12 +898,42 @@@@ AC_SUBST(XINERAMA_LIBS)
 CPPFLAGS="$xinerama_save_cppflags"
 
 dnl ---------------------------------------------------------------------------
+dnl - Check for ConsoleKit support
+dnl ---------------------------------------------------------------------------
+
+use_console_kit=no
+if test "x$with_console_kit" != "xno" ; then
+	use_console_kit=yes
+	AC_DEFINE(WITH_CONSOLE_KIT, 1, [Define to enable ConsoleKit support])
+fi
+AM_CONDITIONAL(WITH_CONSOLE_KIT, test x$use_console_kit = xyes)
+AC_SUBST(WITH_CONSOLE_KIT)
+
+dnl ---------------------------------------------------------------------------
 dnl - Check for systemd support
 dnl ---------------------------------------------------------------------------
 
 PKG_CHECK_MODULES(SYSTEMD,
-                  [libsystemd])
+                  [libsystemd-login >= 186 libsystemd-daemon],
+                  [have_systemd=yes], [have_systemd=no])
 
+if test "x$with_systemd" = "xauto" ; then
+        if test x$have_systemd = xno ; then
+                use_systemd=no
+        else
+                use_systemd=yes
+        fi
+else
+        use_systemd="$with_systemd"
+fi
+
+if test "x$use_systemd" != "xno" ; then
+        if test "x$have_systemd" = "xno"; then
+                AC_MSG_ERROR([Systemd support explicitly required, but systemd not found])
+        fi
+
+        AC_DEFINE(WITH_SYSTEMD, 1, [Define to enable systemd support])
+fi
 AC_SUBST(SYSTEMD_CFLAGS)
 AC_SUBST(SYSTEMD_LIBS)
 
@@@@ -1100,6 +1126,14 @@@@ fi
 AC_SUBST(GDM_CUSTOM_CONF)
 AC_SUBST(GDM_OLD_CONF, '${gdmconfdir}/gdm.conf')
 
+AC_ARG_WITH(consolekit-directory,
+              [AC_HELP_STRING([--with-consolekit-directory],
+                              [Specify the directory of ck-get-x11-display-device @@<:@@default=libexecdir@@:>@@])],,
+                              [with_consolekit_directory="\${libexecdir}"])
+
+CONSOLEKIT_DIR=$with_consolekit_directory
+AC_SUBST(CONSOLEKIT_DIR)
+
 AC_ARG_WITH(gnome-settings-daemon-directory,
               [AC_HELP_STRING([--with-gnome-settings-daemon-directory],
                               [Specify the directory of gnome-settings-daemon used by the chooser @@<:@@default=libexecdir@@:>@@])],,
@@@@ -1588,6 +1622,7 @@@@ echo "
         dmconfdir:                ${dmconfdir}
         localstatedir:            ${localstatedir}
         datadir:                  ${datadir}
+	consolekit location:      ${with_consolekit_directory}
 	gnome-settings-daemon location: ${with_gnome_settings_daemon_directory}
 	gnome-session-check-accel location: ${with_check_accelerated_directory}
 	source code location:	  ${srcdir}
@@@@ -1618,6 +1653,8 @@@@ echo \
 "        Xinerama support:         ${XINERAMA_SUPPORT}
         XDMCP support:            ${XDMCP_SUPPORT}
         SELinux support:          ${use_selinux}
+        ConsoleKit support:       ${use_console_kit}
+        systemd support:          ${use_systemd}
         systemd unit dir:         ${with_systemdsystemunitdir}
         plymouth support:         ${use_plymouth}
         wayland support:          ${enable_wayland_support}
@@@@ -1626,3 +1663,4 @@@@ echo \
         Enable documentation:     ${enable_documentation}
         Install GDM's Xsession:   ${enable_gdm_xsession}
 "
+
@


1.11
log
@Update to gdm-3.22.2.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.10 2016/10/31 16:15:46 ajacoutot Exp $
d17 2
a18 2
--- configure.ac.orig	Wed Mar  1 22:00:15 2017
+++ configure.ac	Fri Mar  3 11:46:46 2017
d48 1
a48 1
@@@@ -638,14 +640,8 @@@@ dnl --------------------------------------------------
d65 1
a65 1
@@@@ -894,12 +890,42 @@@@ AC_SUBST(XINERAMA_LIBS)
d109 1
a109 1
@@@@ -1092,6 +1118,14 @@@@ fi
d124 1
a124 1
@@@@ -1580,6 +1614,7 @@@@ echo "
d132 1
a132 1
@@@@ -1609,6 +1644,8 @@@@ echo \
d141 1
a141 1
@@@@ -1617,3 +1654,4 @@@@ echo \
@


1.10
log
@Update to gdm-3.22.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.9 2016/04/26 08:25:04 ajacoutot Exp $
d17 3
a19 3
--- configure.ac.orig	Wed Oct 12 19:58:41 2016
+++ configure.ac	Mon Oct 31 16:57:55 2016
@@@@ -221,12 +221,6 @@@@ AM_CONDITIONAL(ENABLE_EXHERBO_PAM_CONFIG, test x$with_
d32 1
a32 1
@@@@ -252,7 +246,15 @@@@ AC_ARG_WITH(tcp-wrappers,
d48 1
a48 1
@@@@ -627,14 +629,8 @@@@ dnl --------------------------------------------------
d65 1
a65 1
@@@@ -883,12 +879,42 @@@@ AC_SUBST(XINERAMA_LIBS)
d109 1
a109 1
@@@@ -1081,6 +1107,14 @@@@ fi
d124 1
a124 1
@@@@ -1569,6 +1603,7 @@@@ echo "
d132 1
a132 1
@@@@ -1598,6 +1633,8 @@@@ echo \
d141 1
a141 1
@@@@ -1606,3 +1643,4 @@@@ echo \
@


1.9
log
@Update to gdm-3.20.1.
@
text
@d1 7
a7 1
$OpenBSD: patch-configure_ac,v 1.8 2016/04/15 14:11:09 ajacoutot Exp $
d17 16
a32 3
--- configure.ac.orig	Tue Apr 19 07:04:17 2016
+++ configure.ac	Tue Apr 26 10:02:47 2016
@@@@ -246,7 +246,15 @@@@ AC_ARG_WITH(tcp-wrappers,
d48 1
a48 1
@@@@ -613,14 +621,8 @@@@ dnl --------------------------------------------------
d65 1
a65 1
@@@@ -869,12 +871,42 @@@@ AC_SUBST(XINERAMA_LIBS)
d109 1
a109 1
@@@@ -1067,6 +1099,14 @@@@ fi
d124 1
a124 1
@@@@ -1555,6 +1595,7 @@@@ echo "
d132 1
a132 1
@@@@ -1584,6 +1625,8 @@@@ echo \
d141 1
a141 1
@@@@ -1592,3 +1635,4 @@@@ echo \
@


1.8
log
@Update to gdm-3.18.3.
Drop the gettext module while here.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.7 2015/10/18 13:25:54 ajacoutot Exp $
d11 3
a13 3
--- configure.ac.orig	Thu Apr 14 07:56:26 2016
+++ configure.ac	Fri Apr 15 15:05:26 2016
@@@@ -244,7 +244,15 @@@@ AC_ARG_WITH(tcp-wrappers,
d29 1
a29 1
@@@@ -614,14 +622,8 @@@@ dnl --------------------------------------------------
d46 1
a46 1
@@@@ -870,12 +872,42 @@@@ AC_SUBST(XINERAMA_LIBS)
d90 1
a90 1
@@@@ -1068,6 +1100,14 @@@@ fi
d105 1
a105 1
@@@@ -1557,6 +1597,7 @@@@ echo "
d113 1
a113 1
@@@@ -1586,6 +1627,8 @@@@ echo \
d121 2
a122 2
         wayland support:          ${use_wayland}
@@@@ -1594,3 +1637,4 @@@@ echo \
@


1.7
log
@Update to gdm-3.18.0.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.6 2014/05/16 16:48:58 ajacoutot Exp $
d11 2
a12 2
--- configure.ac.orig	Sun Oct 18 14:26:52 2015
+++ configure.ac	Sun Oct 18 14:34:00 2015
d105 1
a105 1
@@@@ -1549,6 +1589,7 @@@@ echo "
d113 1
a113 1
@@@@ -1578,6 +1619,8 @@@@ echo \
d122 1
a122 1
@@@@ -1586,3 +1629,4 @@@@ echo \
@


1.6
log
@Update to gdm-3.12.2.
@
text
@d1 7
a7 1
$OpenBSD: patch-configure_ac,v 1.5 2014/04/15 13:15:19 ajacoutot Exp $
d11 19
a29 3
--- configure.ac.orig	Fri May 16 16:52:58 2014
+++ configure.ac	Fri May 16 18:26:57 2014
@@@@ -616,14 +616,8 @@@@ dnl --------------------------------------------------
d46 81
@


1.5
log
@Update to gdm-3.12.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.4 2014/03/27 19:19:17 ajacoutot Exp $
d5 3
a7 3
--- configure.ac.orig	Tue Apr 15 14:40:45 2014
+++ configure.ac	Tue Apr 15 15:02:48 2014
@@@@ -599,14 +599,8 @@@@ dnl --------------------------------------------------
@


1.4
log
@Update to gdm-3.12.0.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.3 2014/01/21 17:39:30 ajacoutot Exp $
d5 3
a7 3
--- configure.ac.orig	Tue Mar 25 14:58:43 2014
+++ configure.ac	Thu Mar 27 18:24:18 2014
@@@@ -616,14 +616,8 @@@@ dnl --------------------------------------------------
@


1.3
log
@Fix utmp usage, login(3) cannot work without a tty.
@
text
@d1 1
a1 1
$OpenBSD$
d5 3
a7 3
--- configure.ac.orig	Wed Oct 16 16:45:57 2013
+++ configure.ac	Fri Jan 17 18:12:09 2014
@@@@ -611,14 +611,8 @@@@ dnl --------------------------------------------------
@


1.2
log
@Update to gdm-3.8.3.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.1 2013/06/15 11:53:41 ajacoutot Exp $
d3 1
a3 1
https://bugzilla.gnome.org/show_bug.cgi?id=702329
d5 19
a23 44
--- configure.ac.orig	Sat Jun 15 09:59:58 2013
+++ configure.ac	Sat Jun 15 10:00:41 2013
@@@@ -72,9 +72,7 @@@@ GNOME_PANEL_REQUIRED_VERSION=2.0.0
 LIBCANBERRA_GTK_REQUIRED_VERSION=0.4
 #FONTCONFIG_REQUIRED_VERSION=2.6.0
 FONTCONFIG_REQUIRED_VERSION=2.5.0
-UPOWER_REQUIRED_VERSION=0.9.0
 ACCOUNTS_SERVICE_REQUIRED_VERSION=0.6.12
-NSS_REQUIRED_VERSION=3.11.1
 
 EXTRA_COMPILE_WARNINGS(yes)
 
@@@@ -101,12 +99,6 @@@@ AC_SUBST(DAEMON_LIBS)
 
 GLIB_GSETTINGS
 
-PKG_CHECK_MODULES(NSS,
-        nss >= $NSS_REQUIRED_VERSION
-)
-AC_SUBST(NSS_CFLAGS)
-AC_SUBST(NSS_LIBS)
-
 PKG_CHECK_MODULES(XLIB, x11 xau xrandr, ,
   [AC_PATH_XTRA
     if test "x$no_x" = xyes; then
@@@@ -129,18 +121,6 @@@@ PKG_CHECK_MODULES(CANBERRA_GTK,
 )
 AC_SUBST(CANBERRA_GTK_CFLAGS)
 AC_SUBST(CANBERRA_GTK_LIBS)
-
-PKG_CHECK_MODULES(UPOWER,
-        upower-glib >= $UPOWER_REQUIRED_VERSION,
-        have_upower=yes,
-        have_upower=no
-)
-if test "x$have_upower" = "xyes" ; then
-  AC_DEFINE(HAVE_UPOWER, [], [Define if we have UPower])
-fi
-AC_SUBST(UPOWER)
-AC_SUBST(UPOWER_CFLAGS)
-AC_SUBST(UPOWER_LIBS)
 
 PKG_CHECK_MODULES(LIBSELINUX, libselinux, have_selinux=yes, have_selinux=no)
 
@


1.1
log
@NSS and UPower are not needed anymore.
@
text
@d1 1
a1 1
$OpenBSD$
@

