head	1.4;
access;
symbols
	OPENBSD_5_7:1.3.0.4
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.2
	OPENBSD_5_6_BASE:1.3;
locks; strict;
comment	@# @;


1.4
date	2015.04.03.18.39.06;	author ajacoutot;	state dead;
branches;
next	1.3;
commitid	yAn0NWAFkDqbBMqK;

1.3
date	2014.04.07.10.19.25;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2012.10.10.12.34.35;	author ajacoutot;	state dead;
branches;
next	1.1;

1.1
date	2012.10.03.06.40.50;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to gdm-3.16.0.1.
@
text
@$OpenBSD: patch-daemon_gdm-slave_c,v 1.3 2014/04/07 10:19:25 ajacoutot Exp $

XXX fix+push upstream

--- daemon/gdm-slave.c.orig	Mon Apr  7 12:15:14 2014
+++ daemon/gdm-slave.c	Mon Apr  7 12:15:22 2014
@@@@ -236,7 +236,7 @@@@ gdm_slave_setup_xhost_auth (XHostAddress *host_entries
         si_entries[0].valuelength = strlen ("root");
         si_entries[1].value       = GDM_USERNAME;
         si_entries[1].valuelength = strlen (GDM_USERNAME);
-        si_entries[2].value       = "gnome-initial-setup";
+        si_entries[2].value       = "_gnome-initial-setup";
         si_entries[2].valuelength = strlen ("gnome-initial-setup");
 
         host_entries[0].family    = FamilyServerInterpreted;
@


1.3
log
@gnome-initial-setup -> _gnome-initial-setup
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@Remove some uneeded | old patches.
Add a schemas override.
@
text
@d1 1
a1 1
$OpenBSD: patch-daemon_gdm-slave_c,v 1.1 2012/10/03 06:40:50 ajacoutot Exp $
d3 1
a3 4
From 189cd818bf1592b5b8607793575bcf4e71ba8008 Mon Sep 17 00:00:00 2001
From: Ray Strode <rstrode@@redhat.com>
Date: Mon, 01 Oct 2012 21:52:33 +0000
Subject: slave: let initial-setup have access to its display
d5 3
a7 10
--- daemon/gdm-slave.c.orig	Mon Sep 24 16:08:48 2012
+++ daemon/gdm-slave.c	Tue Oct  2 10:42:23 2012
@@@@ -545,11 +545,15 @@@@ gdm_slave_setup_xhost_auth (XHostAddress *host_entries
         si_entries[0].typelength  = strlen ("localuser");
         si_entries[1].type        = "localuser";
         si_entries[1].typelength  = strlen ("localuser");
+        si_entries[2].type        = "localuser";
+        si_entries[2].typelength  = strlen ("localuser");
 
         si_entries[0].value       = "root";
d11 3
a13 2
+        si_entries[2].value       = "gnome-initial-setup";
+        si_entries[2].valuelength = strlen ("gnome-initial-setup");
a15 33
         host_entries[0].address   = (char *) &si_entries[0];
@@@@ -557,6 +561,9 @@@@ gdm_slave_setup_xhost_auth (XHostAddress *host_entries
         host_entries[1].family    = FamilyServerInterpreted;
         host_entries[1].address   = (char *) &si_entries[1];
         host_entries[1].length    = sizeof (XServerInterpretedAddress);
+        host_entries[2].family    = FamilyServerInterpreted;
+        host_entries[2].address   = (char *) &si_entries[2];
+        host_entries[2].length    = sizeof (XServerInterpretedAddress);
 }
 
 static void
@@@@ -672,8 +679,8 @@@@ gdm_slave_connect_to_x11_display (GdmSlave *slave)
                 g_warning ("Unable to connect to display %s", slave->priv->display_name);
                 ret = FALSE;
         } else if (slave->priv->display_is_local) {
-                XServerInterpretedAddress si_entries[2];
-                XHostAddress              host_entries[2];
+                XServerInterpretedAddress si_entries[3];
+                XHostAddress              host_entries[3];
 
                 g_debug ("GdmSlave: Connected to display %s", slave->priv->display_name);
                 ret = TRUE;
@@@@ -909,8 +916,8 @@@@ gdm_slave_add_user_authorization (GdmSlave   *slave,
                                   const char *username,
                                   char      **filenamep)
 {
-        XServerInterpretedAddress si_entries[2];
-        XHostAddress              host_entries[2];
+        XServerInterpretedAddress si_entries[3];
+        XHostAddress              host_entries[3];
         gboolean                  res;
         GError                   *error;
         char                     *filename;
@


1.1
log
@Bring some patches from upstream to fix a couple of bugs.
Properly remove some subdirectory under _gdm homedir.
@
text
@d1 1
a1 1
$OpenBSD$
@

