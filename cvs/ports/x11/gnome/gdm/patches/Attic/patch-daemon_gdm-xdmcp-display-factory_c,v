head	1.6;
access;
symbols
	OPENBSD_5_5:1.4.0.6
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.4.0.4
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.4.0.2
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.2.0.2
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.2;
locks; strict;
comment	@# @;


1.6
date	2014.03.27.19.19.17;	author ajacoutot;	state dead;
branches;
next	1.5;

1.5
date	2014.03.09.21.56.20;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2012.10.10.12.34.35;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2012.09.10.13.19.04;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2012.06.26.14.54.29;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2011.09.12.07.39.21;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to gdm-3.12.0.
@
text
@$OpenBSD: patch-daemon_gdm-xdmcp-display-factory_c,v 1.5 2014/03/09 21:56:20 ajacoutot Exp $

From 2d025255ab783208af98d848cca7b5e1bb4e44ef Mon Sep 17 00:00:00 2001
From: Ting-Wei Lan <lantw44@@gmail.com>
Date: Mon, 20 Jan 2014 10:15:35 +0000
Subject: Fix build problem on FreeBSD

From 262e075827c4b9a7fad866bde43953b5760360b1 Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@@gnome.org>
Date: Mon, 03 Mar 2014 08:16:52 +0000
Subject: xdmcp: unbreak build on OpenBSD

--- daemon/gdm-xdmcp-display-factory.c.orig	Tue Sep 17 23:33:48 2013
+++ daemon/gdm-xdmcp-display-factory.c	Mon Mar  3 09:12:17 2014
@@@@ -35,6 +35,7 @@@@
 #include <netdb.h>
 #include <arpa/inet.h>
 #include <net/if.h>
+#include <netinet/in.h>
 #ifdef HAVE_SYS_SOCKIO_H
 #include <sys/sockio.h>
 #endif
@@@@ -376,12 +377,16 @@@@ ai_flags_str (struct addrinfo *ai)
                 if (ai->ai_flags & AI_NUMERICSERV) {
                         g_string_append (str, "numserv ");
                 }
+#ifdef AI_V4MAPPEP
                 if (ai->ai_flags & AI_V4MAPPED) {
                         g_string_append (str, "v4mapped ");
                 }
+#endif
+#ifdef AI_ALL
                 if (ai->ai_flags & AI_ALL) {
                         g_string_append (str, "all ");
                 }
+#endif
         }
         return g_string_free (str, FALSE);
 }
@@@@ -1527,7 +1532,9 @@@@ create_address_from_request (ARRAY8      *req_addr,
         memset (&hints, 0, sizeof (hints));
         hints.ai_family = family;
         /* this should convert IPv4 address to IPv6 if needed */
+#ifdef AI_V4MAPPED
         hints.ai_flags = AI_V4MAPPED;
+#endif
         hints.ai_socktype = SOCK_DGRAM;
 
         if ((gaierr = getaddrinfo (host, serv, &hints, &ai_list)) != 0) {
@@@@ -2010,7 +2017,9 @@@@ on_hostname_selected (GdmXdmcpChooserDisplay *display,
         memset (&hints, 0, sizeof (hints));
         hints.ai_family = gdm_address_get_family_type (address);
         /* this should convert IPv4 address to IPv6 if needed */
+#ifdef AI_V4MAPPED
         hints.ai_flags = AI_V4MAPPED;
+#endif
 
         xdmcp_port = g_strdup_printf ("%d", XDM_UDP_PORT);
         if ((gaierr = getaddrinfo (hostname, xdmcp_port, &hints, &ai_list)) != 0) {
@


1.5
log
@Patches committed upstream.
Make gdm_login() / gdm_logout() static.
@
text
@d1 1
a1 1
$OpenBSD: patch-daemon_gdm-xdmcp-display-factory_c,v 1.4 2012/10/10 12:34:35 ajacoutot Exp $
@


1.4
log
@Remove some uneeded | old patches.
Add a schemas override.
@
text
@d1 14
a14 3
$OpenBSD: patch-daemon_gdm-xdmcp-display-factory_c,v 1.3 2012/09/10 13:19:04 ajacoutot Exp $
--- daemon/gdm-xdmcp-display-factory.c.orig	Thu Sep  6 20:33:20 2012
+++ daemon/gdm-xdmcp-display-factory.c	Wed Oct 10 15:55:48 2012
d23 1
a23 1
@@@@ -376,12 +377,14 @@@@ ai_flags_str (struct addrinfo *ai)
d27 1
a27 1
+#ifndef __OpenBSD__
d31 2
d40 1
a40 2
@@@@ -1526,8 +1529,10 @@@@ create_address_from_request (ARRAY8      *req_addr,
 
a42 1
+#ifndef __OpenBSD__
d44 1
d50 1
a50 2
@@@@ -2009,8 +2014,10 @@@@ on_hostname_selected (GdmXdmcpChooserDisplay *display,
 
a52 1
+#ifndef __OpenBSD__
d54 1
@


1.3
log
@Ugly update to gdm-3.4.1; still totally broken but needed by robert@@ for
his openpam port.
@
text
@d1 3
a3 3
$OpenBSD: patch-daemon_gdm-xdmcp-display-factory_c,v 1.2 2012/06/26 14:54:29 jasper Exp $
--- daemon/gdm-xdmcp-display-factory.c.orig	Sat Apr 14 20:52:00 2012
+++ daemon/gdm-xdmcp-display-factory.c	Mon Sep 10 15:03:45 2012
d12 11
a22 16
@@@@ -64,7 +65,7 @@@@
  * On Sun, we need to define allow_severity and deny_severity to link
  * against libwrap.
  */
-#ifdef __sun
+#if defined(__sun) || defined(__OpenBSD__)
 #include <syslog.h>
 int allow_severity = LOG_INFO;
 int deny_severity = LOG_WARNING;
@@@@ -86,6 +87,13 @@@@ int deny_severity = LOG_WARNING;
 #define GDM_MAX_FORWARD_QUERIES 10
 #define GDM_FORWARD_QUERY_TIMEOUT 30
 #define MANAGED_FORWARD_INTERVAL 1500 /* 1.5 seconds */
+
+#ifndef AI_ALL
+#define AI_ALL 0
d24 21
a44 2
+#ifndef AI_V4MAPPED
+#define AI_V4MAPPED 0
d47 2
a48 2
 /* some extra XDMCP opcodes that xdm will happily ignore since they'll be
  * the wrong XDMCP version anyway */
@


1.2
log
@- these patches (or chunks) are not needed anymore since arpa/inet.h -r1.12
@
text
@d1 11
a11 3
$OpenBSD: patch-daemon_gdm-xdmcp-display-factory_c,v 1.1 2011/09/12 07:39:21 ajacoutot Exp $
--- daemon/gdm-xdmcp-display-factory.c.orig	Fri Feb 18 04:27:53 2011
+++ daemon/gdm-xdmcp-display-factory.c	Fri Jun 17 15:13:52 2011
@


1.1
log
@Update to gdm-3.0.4 but mark BROKEN for now.
@
text
@d1 1
a1 1
$OpenBSD$
a3 11
@@@@ -33,8 +33,9 @@@@
 
 #include <sys/socket.h>
 #include <netdb.h>
-#include <arpa/inet.h>
 #include <net/if.h>
+#include <netinet/in.h>
+#include <arpa/inet.h>
 #ifdef HAVE_SYS_SOCKIO_H
 #include <sys/sockio.h>
 #endif
@

