head	1.6;
access;
symbols
	OPENBSD_5_0:1.5.0.6
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.4
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.5.0.2
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.4.0.2
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.3.0.4
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.2
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.1.0.4
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.2
	OPENBSD_4_3_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2011.09.12.07.34.47;	author ajacoutot;	state dead;
branches;
next	1.5;

1.5
date	2010.04.22.22.32.19;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2009.10.13.19.09.05;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2009.01.31.12.23.29;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2008.11.21.17.02.49;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2008.01.23.21.47.46;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Remove, superseded by controlcenter.
@
text
@$OpenBSD: patch-capplets_about-me_gnome-about-me_c,v 1.5 2010/04/22 22:32:19 ajacoutot Exp $

Spawn a gnome-terminal to allow users to change their passwords, as we cannot
fork passwd(1) to the background.
From Open Solaris' control-center-01-passwd-in-terminal.diff

--- capplets/about-me/gnome-about-me.c.orig	Mon Mar 29 16:22:56 2010
+++ capplets/about-me/gnome-about-me.c	Fri Apr 23 00:12:22 2010
@@@@ -824,7 +824,25 @@@@ about_me_passwd_clicked_cb (GtkWidget *button, GnomeAb
 	GtkBuilder *dialog;
 
 	dialog = me->dialog;
+#if defined __OpenBSD__
+    /* Use gnome-terminal embedded passwd due to inability to fork passwd in
+     * the background.
+     */
+    {
+        GError  *error = NULL;
+        gchar   *command = NULL;
+
+        command = g_strdup_printf("gnome-terminal --window --title '%s' --hide-menubar -e /usr/bin/passwd",
+                                _("Change password") );
+
+        if ( command != NULL ) {
+            g_spawn_command_line_async( command, &error);
+            g_free(command);
+        }
+    }
+#else
 	gnome_about_me_password (GTK_WINDOW (WID ("about-me-dialog")));
+#endif
 }
 
 static void
@


1.5
log
@Update to gnome-control-center-2.30.0.
@
text
@d1 1
a1 1
$OpenBSD: patch-capplets_about-me_gnome-about-me_c,v 1.4 2009/10/13 19:09:05 ajacoutot Exp $
@


1.4
log
@Major update to gnome-control-center-2.28.0.
@
text
@d1 1
a1 1
$OpenBSD: patch-capplets_about-me_gnome-about-me_c,v 1.3 2009/01/31 12:23:29 jasper Exp $
d7 3
a9 3
--- capplets/about-me/gnome-about-me.c.orig	Mon Aug 17 10:40:16 2009
+++ capplets/about-me/gnome-about-me.c	Tue Oct 13 19:25:22 2009
@@@@ -820,7 +820,25 @@@@ about_me_passwd_clicked_cb (GtkWidget *button, GnomeAb
@


1.3
log
@- bring back the "Change password" button for gnome-about-me
* based on open solaris' fix

ok ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD: patch-capplets_about-me_gnome-about-me_c,v 1.2 2008/11/21 17:02:49 jasper Exp $
d7 4
a10 31
--- capplets/about-me/gnome-about-me.c.orig	Wed Sep 24 18:36:23 2008
+++ capplets/about-me/gnome-about-me.c	Sat Jan 31 13:10:58 2009
@@@@ -23,6 +23,7 @@@@
 #  include <config.h>
 #endif
 
+#include <sys/types.h>
 #include <glib/gstdio.h>
 #include <gnome.h>
 #include <pwd.h>
@@@@ -330,12 +331,17 @@@@ static char *
 get_user_login (void)
 {
 	char buf[LINE_MAX * 4];
-	struct passwd pwd, *err;
+	struct passwd *pwd;
 
 	int i;
 #if defined(__sun) && !defined(_POSIX_PTHREAD_SEMANTICS)
 	i = getpwuid_r (getuid (), &pwd, buf, sizeof (buf));
 	return (i != 0) ? g_strdup (pwd.pw_name) : NULL;
+#elif __OpenBSD__
+	pwd = getpwuid(getuid());
+	if (pwd == NULL)
+		return NULL;
+	return g_strdup (pwd->pw_name);
 #else
 	i = getpwuid_r (getuid (), &pwd, buf, sizeof (buf), &err);
 	return ((i == 0) && (err == &pwd)) ? g_strdup (pwd.pw_name) : NULL;
@@@@ -853,7 +859,25 @@@@ about_me_passwd_clicked_cb (GtkWidget *button, GnomeAb
 	GladeXML *dialog;
d13 7
a19 7
+#if defined(__OpenBSD__)
+	/* Use gnome-terminal embedded passwd due to inability to fork passwd in
+	 * the background.
+	 */
+	{
+	    GError  *error = NULL;
+	    gchar   *command = NULL;
d21 2
a22 2
+	    command = g_strdup_printf("gnome-terminal --window --title '%s' --hide-menubar -e /usr/bin/passwd",
+				    _("Change password") );
d24 5
a28 5
+	    if ( command != NULL ) {
+		g_spawn_command_line_async( command, &error);
+		g_free(command);
+	    }
+	}
d34 1
a34 1
 static gint
@


1.2
log
@- update control-center2 to 2.24.0.1

feedback and ok ajacoutot@@
@
text
@d1 15
a15 5
$OpenBSD: patch-capplets_about-me_gnome-about-me_c,v 1.1 2008/01/23 21:47:46 jasper Exp $
--- capplets/about-me/gnome-about-me.c.orig	Tue Nov 11 20:57:09 2008
+++ capplets/about-me/gnome-about-me.c	Tue Nov 11 20:58:39 2008
@@@@ -32,6 +32,7 @@@@
 #include <glade/glade.h>
a16 5
 #include <unistd.h>
+#include <sys/types.h>
 #include <libebook/e-book.h>
 
 #include "e-image-chooser.h"
d36 26
@


1.1
log
@- update control-center2 to 2.20.3
- fix license marker
- explicitly enabled gstreamer
- zap NO_REGRESS

testing and ok ajacoutot@@
@
text
@d1 4
a4 4
$OpenBSD$
--- capplets/about-me/gnome-about-me.c.orig	Wed Jan 23 12:41:18 2008
+++ capplets/about-me/gnome-about-me.c	Wed Jan 23 12:55:18 2008
@@@@ -34,6 +34,7 @@@@
d12 1
a12 1
@@@@ -291,12 +292,17 @@@@ static char *
d20 1
a20 1
 #if __sun
@

