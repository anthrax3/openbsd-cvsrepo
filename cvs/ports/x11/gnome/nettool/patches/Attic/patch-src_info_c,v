head	1.5;
access;
symbols
	OPENBSD_5_3:1.4.0.4
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.4.0.2
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.1.1.1.0.6
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.4
	OPENBSD_4_9_BASE:1.1.1.1
	OPENBSD_4_8:1.1.1.1.0.2
	OPENBSD_4_8_BASE:1.1.1.1
	ajacoutot_20100410:1.1.1.1
	ajacoutot:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2013.03.28.14.53.31;	author ajacoutot;	state dead;
branches;
next	1.4;

1.4
date	2012.04.03.15.10.40;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2012.01.03.12.11.53;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2011.09.12.07.28.53;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2010.04.10.16.51.07;	author ajacoutot;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.04.10.16.51.07;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Remove gnome-nettool. It's pretty much dead upstream and it provides
nothing more than gnome-terminal does...

"ENOTCARE" jasper@@
@
text
@$OpenBSD: patch-src_info_c,v 1.4 2012/04/03 15:10:40 jasper Exp $

https://bugzilla.gnome.org/show_bug.cgi?id=652713

--- src/info.c.orig	Tue Jan  3 10:10:16 2012
+++ src/info.c	Tue Jan  3 10:50:22 2012
@@@@ -20,6 +20,12 @@@@
 #include <gtk/gtk.h>
 #include <glib/gi18n.h>
 #include <glib/gprintf.h>
+#if defined (__FreeBSD__) || defined (__OpenBSD__)
+#include <sys/types.h>
+#include <string.h>
+#include <errno.h>
+#include <unistd.h>
+#endif
 
 #ifdef HAVE_CONFIG_H
 #  include <config.h>
@@@@ -37,6 +43,9 @@@@
 #include <sys/ioctl.h>
 #include <stdlib.h>
 #include <net/if.h>
+#if defined (__FreeBSD__) || defined (__OpenBSD__)
+#include <net/if_media.h>
+#endif
 
 #include <glibtop.h>
 #include <glibtop/netlist.h>
@@@@ -131,9 +140,39 @@@@ info_get_interface_from_dev_name (const gchar *dev_nam
 {
 	gint i;
 	gchar *path;
+	gchar *dev_type = NULL;
 	
+#if defined (__FreeBSD__) || defined (__OpenBSD__)
+	int s;
+	struct ifmediareq ifmr;
+
+	if ((s = socket (AF_INET, SOCK_DGRAM, 0)) > -1) {
+
+		(void) memset (&ifmr, 0, sizeof (ifmr));
+		(void) strncpy (ifmr.ifm_name, dev_name, sizeof (ifmr.ifm_name));
+
+		if (ioctl (s, SIOCGIFMEDIA, (caddr_t) &ifmr) > -1) {
+			switch (IFM_TYPE (ifmr.ifm_active)) {
+				case IFM_ETHER:
+					dev_type = "eth";
+					break;
+				case IFM_IEEE80211:
+					dev_type = "wlan";
+					break;
+				default:
+					dev_type = "other_type";
+					break;
+			}
+		}
+		close (s);
+	}
+#endif /* defined (__FreeBSD__) || defined (__OpenBSD__) */
+
+	if (!dev_type)
+		dev_type = (gchar *) dev_name;
+
 	for (i = 0; info_iface_desc[i].name; i++)
-		if (strstr (dev_name, info_iface_desc[i].prefix) == dev_name) {
+		if (strstr (dev_type, info_iface_desc[i].prefix) == dev_type) {
 			(*iface) = g_strdup_printf ("%s (%s)", _(info_iface_desc[i].name), dev_name);
 			if (info_iface_desc[i].pixbuf == NULL) {
 				path = g_build_filename (PIXMAPS_DIR, info_iface_desc[i].icon, NULL);
@


1.4
log
@- fix comment after recent update, the patch has been merged.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_info_c,v 1.3 2012/01/03 12:11:53 ajacoutot Exp $
@


1.3
log
@Bugfix update to gnome-nettool-3.0.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_info_c,v 1.2 2011/09/12 07:28:53 jasper Exp $
a3 1
https://bugzilla.gnome.org/show_bug.cgi?id=647896
@


1.2
log
@Moar GNOME3 merge
@
text
@d1 1
a1 1
$OpenBSD: patch-src_info_c,v 1.4 2011/06/16 11:01:36 ajacoutot Exp $
d6 2
a7 2
--- src/info.c.orig	Thu Dec  2 10:26:14 2010
+++ src/info.c	Thu Jun 16 12:43:17 2011
a71 16
@@@@ -200,13 +239,13 @@@@ info_load_iface (Netinfo *info)
 	gtk_cell_layout_pack_start (GTK_CELL_LAYOUT (info->combo), renderer, TRUE);
 	gtk_cell_layout_set_attributes (GTK_CELL_LAYOUT (info->combo), renderer,
 					"pixbuf", 0, NULL);
-	g_object_unref (renderer);
+	/* g_object_unref (renderer); */
 
 	renderer = gtk_cell_renderer_text_new ();
 	gtk_cell_layout_pack_start (GTK_CELL_LAYOUT (info->combo), renderer, TRUE);
 	gtk_cell_layout_set_attributes (GTK_CELL_LAYOUT (info->combo), renderer,
 					"markup", 1, NULL);
-	g_object_unref (renderer);
+	/* g_object_unref (renderer); */
 
 	gtk_combo_box_set_active (GTK_COMBO_BOX (info->combo), 0);
 }
@


1.1
log
@Initial revision
@
text
@d1 8
a8 4
$OpenBSD$
--- src/info.c.orig	Tue Sep 22 15:30:34 2009
+++ src/info.c	Tue Mar 30 15:42:12 2010
@@@@ -20,6 +20,10 @@@@
d12 1
d17 1
d21 1
a21 1
@@@@ -37,6 +41,9 @@@@
d31 1
a31 9
@@@@ -61,6 +68,7 @@@@ static InfoInterfaceDescription info_iface_desc [] = {
 	{ N_("Ethernet Interface"),      INFO_INTERFACE_ETH,     "16_ethernet.xpm", "eth",        NULL },
 	{ N_("Wireless Interface"),      INFO_INTERFACE_WLAN,    "wavelan-16.png",  "wlan",       NULL },
 	{ N_("Modem Interface"),         INFO_INTERFACE_PPP,     "16_ppp.xpm",      "ppp",        NULL },
+	{ N_("Modem Interface"),         INFO_INTERFACE_PPP,     "16_ppp.xpm",      "tun",        NULL },
 	{ N_("Parallel Line Interface"), INFO_INTERFACE_PLIP,    "16_plip.xpm",     "plip",       NULL },
 	{ N_("Infrared Interface"),      INFO_INTERFACE_IRLAN,   "irda-16.png",     "irlan",      NULL },
 	{ N_("Loopback Interface"),      INFO_INTERFACE_LO,      "16_loopback.xpm", "lo",         NULL },
@@@@ -131,9 +139,44 @@@@ info_get_interface_from_dev_name (const gchar *dev_nam
a34 1
-	
d36 1
a50 9
+				case IFM_FDDI:
+#ifdef IFM_TOKEN
+				case IFM_TOKEN:
+#endif
+#ifdef IFM_ATM
+				case IFM_ATM:
+#endif
+					dev_type = "other_type";
+					break;
d54 3
d72 16
@


1.1.1.1
log
@Import gnome-nettool-2.28.0 (with a couple of patches from FreeBSD).

GNOME Nettool is a set of front-ends to various networking command-line
tools, like ping, netstat, ifconfig, whois, traceroute, finger.
@
text
@@
