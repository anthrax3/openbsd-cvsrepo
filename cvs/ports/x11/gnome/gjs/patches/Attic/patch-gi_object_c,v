head	1.4;
access;
symbols
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2;
locks; strict;
comment	@# @;


1.4
date	2012.04.07.13.48.31;	author ajacoutot;	state dead;
branches;
next	1.3;

1.3
date	2012.01.16.11.17.14;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2011.10.05.06.42.01;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2011.09.27.17.39.28;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to gjs-1.32.0.

ok jasper@@
@
text
@$OpenBSD: patch-gi_object_c,v 1.3 2012/01/16 11:17:14 ajacoutot Exp $

Revert 72bc4307860a315f9d2173d700582add938d79a0
as our spidermonkey port does not have JS_updateMallocCounter().

https://bugzilla.gnome.org/show_bug.cgi?id=660431 

--- gi/object.c.orig	Fri Jan 13 22:31:51 2012
+++ gi/object.c	Mon Jan 16 12:08:48 2012
@@@@ -674,7 +674,9 @@@@ GJS_NATIVE_CONSTRUCTOR_DECLARE(object_instance)
         if (unthreadsafe_template_for_constructor.gobj == NULL) {
             GParameter *params;
             int n_params;
+#ifdef JS_updateMallocCounter
             GTypeQuery query;
+#endif
             JSObject *old_jsobj;
 
             gtype = g_registered_type_info_get_g_type( (GIRegisteredTypeInfo*) priv->info);
@@@@ -711,8 +713,10 @@@@ GJS_NATIVE_CONSTRUCTOR_DECLARE(object_instance)
                 goto out;
             }
 
+#ifdef JS_updateMallocCounter
             g_type_query(gtype, &query);
             JS_updateMallocCounter(context, query.instance_size);
+#endif
 
             if (G_IS_INITIALLY_UNOWNED(priv->gobj) &&
                 !g_object_is_floating(priv->gobj)) {
@


1.3
log
@Update to gjs-1.30.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-gi_object_c,v 1.2 2011/10/05 06:42:01 jasper Exp $
@


1.2
log
@- add bugzilla url
@
text
@d1 1
a1 1
$OpenBSD: patch-gi_object_c,v 1.1 2011/09/27 17:39:28 jasper Exp $
d8 2
a9 2
--- gi/object.c.orig	Sat Sep 17 16:03:19 2011
+++ gi/object.c	Tue Sep 27 19:32:00 2011
d17 1
d20 3
a22 4
             if (gtype == G_TYPE_NONE) {
@@@@ -693,8 +695,10 @@@@ GJS_NATIVE_CONSTRUCTOR_DECLARE(object_instance)
             priv->gobj = g_object_newv(gtype, n_params, params);
             free_g_params(params, n_params);
@


1.1
log
@- update to 1.30.0
@
text
@d1 1
a1 1
$OpenBSD$
d5 2
@

