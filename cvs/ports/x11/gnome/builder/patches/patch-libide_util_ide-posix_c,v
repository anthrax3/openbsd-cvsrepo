head	1.2;
access;
symbols
	OPENBSD_6_2:1.2.0.2
	OPENBSD_6_2_BASE:1.2
	OPENBSD_6_1:1.1.0.2
	OPENBSD_6_1_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2017.04.17.14.45.58;	author ajacoutot;	state Exp;
branches;
next	1.1;
commitid	53e7ZrI1QZeuIRTe;

1.1
date	2016.10.31.15.02.09;	author ajacoutot;	state Exp;
branches;
next	;
commitid	ENJnbICg1uCpQaeS;


desc
@@


1.2
log
@Update to gnome-builder-3.24.1 to unbreak.
@
text
@$OpenBSD: patch-libide_util_ide-posix_c,v 1.1 2016/10/31 15:02:09 ajacoutot Exp $
--- libide/util/ide-posix.c.orig	Fri Mar 24 00:38:30 2017
+++ libide/util/ide-posix.c	Mon Apr 17 15:08:31 2017
@@@@ -21,7 +21,11 @@@@
 #include <sys/user.h>
 #include <sys/utsname.h>
 #include <unistd.h>
+#if !defined(__OpenBSD__)
 #include <wordexp.h>
+#else
+#include <glob.h>
+#endif
 
 #include "ide-posix.h"
 
@@@@ -92,6 +96,7 @@@@ ide_get_system_page_size (void)
  * Returns: (transfer full): A newly allocated string containing the
  *   expansion. A copy of the input string upon failure to expand.
  */
+#if !defined(__OpenBSD__)
 gchar *
 ide_path_expand (const gchar *path)
 {
@@@@ -116,6 +121,33 @@@@ ide_path_expand (const gchar *path)
 
   return ret;
 }
+#else
+gchar *
+ide_path_expand (const gchar *path)
+{
+  glob_t state;
+  gchar *ret = NULL;
+  int r;
+
+  if (path == NULL)
+    return NULL;
+
+  r = glob (path, GLOB_ERR, NULL, &state);
+  if(r == 0 && state.gl_pathc == 1 && state.gl_pathv) {
+    ret = g_strdup (state.gl_pathv[0]);
+  }
+  globfree(&state);
+
+  if (!g_path_is_absolute (ret))
+    {
+      g_autofree gchar *freeme = ret;
+
+      ret = g_build_filename (g_get_home_dir (), freeme, NULL);
+    }
+
+  return ret;
+}
+#endif
 
 /**
  * ide_path_collapse:
@


1.1
log
@Update to gnome-builder-3.22.1.
@
text
@d1 3
a3 3
$OpenBSD$
--- libide/util/ide-posix.c.orig	Mon Oct 31 15:30:27 2016
+++ libide/util/ide-posix.c	Mon Oct 31 15:40:41 2016
d16 1
a16 1
@@@@ -56,6 +60,7 @@@@ ide_get_system_page_size (void)
d24 1
a24 1
@@@@ -80,6 +85,33 @@@@ ide_path_expand (const gchar *path)
@

