head	1.3;
access;
symbols
	OPENBSD_4_7:1.2.0.2
	OPENBSD_4_7_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2010.04.21.09.18.00;	author ajacoutot;	state dead;
branches;
next	1.2;

1.2
date	2009.12.14.11.49.51;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2009.12.13.13.46.53;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to totem-pl-parser-2.30.0.
Direct dependency on gtk has been removed.
@
text
@$OpenBSD: patch-plparse_totem-pl-parser_c,v 1.2 2009/12/14 11:49:51 ajacoutot Exp $

Use g_strstr_len() instead of GNU extension memmem.
git fc603d2f98802ae20f4902f2b1dd589b891595b6

--- plparse/totem-pl-parser.c.orig	Fri Dec  4 16:10:52 2009
+++ plparse/totem-pl-parser.c	Mon Dec 14 12:39:00 2009
@@@@ -1667,8 +1667,7 @@@@ totem_pl_parser_cleanup_xml (char *contents)
 		/* Broken file? */
 		if (end == NULL)
 			return;
-		if (memmem (needle, end - needle,
-			    "]]>", strlen ("]]>")) != NULL) {
+		if (g_strstr_len (needle, end - needle, "]]>") != NULL) {
 			/* Advance 3 and skip */
 			needle += 3;
 			continue;
@


1.2
log
@Use g_strstr_len() instead of GNU extension memmem.
from upstream git.
@
text
@d1 1
a1 1
$OpenBSD: patch-plparse_totem-pl-parser_c,v 1.1 2009/12/13 13:46:53 ajacoutot Exp $
@


1.1
log
@Add a temporary workaround to make this build.
No bump.

breakage reported by naddy@@
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 4
XXX
For now as we don't have memmem, revert 5e76577f299436cac38260012db37fb1fe475484:
Fixed parsing of http://www.davidco.com/podcast.php
https://bugzilla.gnome.org/show_bug.cgi?id=585407
d7 5
a11 12
+++ plparse/totem-pl-parser.c	Sun Dec 13 14:42:05 2009
@@@@ -1660,21 +1660,17 @@@@ totem_pl_parser_cleanup_xml (char *contents)
 
 	needle = contents;
 	while ((needle = strstr (needle, "<!--")) != NULL) {
-		char *end;
-
-		/* Find end of comments */
-		end = strstr (needle, "-->");
-		/* Broken file? */
-		if (end == NULL)
-			return;
d14 4
a17 19
-			/* Advance 3 and skip */
-			needle += 3;
-			continue;
+		while (strncmp (needle, "-->", 3) != 0) {
+			*needle = ' ';
+			needle++;
+			if (*needle == '\0')
+				break;
 		}
-		/* Empty the comment */
-		memset (needle, ' ', end + 3 - needle);
+		if (strncmp (needle, "-->", 3) == 0) {
+			guint i;
+			for (i = 0; i < 3; i++)
+				*(needle + i) = ' ';
+		}
 	}
 }
 
@

