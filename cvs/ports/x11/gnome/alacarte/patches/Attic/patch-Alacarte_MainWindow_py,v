head	1.5;
access;
symbols
	OPENBSD_5_0:1.1.0.4
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2013.04.04.07.05.06;	author ajacoutot;	state dead;
branches;
next	1.4;

1.4
date	2013.03.11.09.37.03;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2011.09.27.10.28.22;	author jasper;	state dead;
branches;
next	1.2;

1.2
date	2011.09.13.07.20.37;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2011.01.18.19.11.06;	author landry;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update to alacarte-3.7.90 to unbreak runtime.

ok jasper@@
@
text
@$OpenBSD: patch-Alacarte_MainWindow_py,v 1.4 2013/03/11 09:37:03 ajacoutot Exp $

From f7835d7dcd37b10f25e208581ec52919cf68e732 Mon Sep 17 00:00:00 2001
From: Jasper St. Pierre <jstpierre@@mecheye.net>
Date: Sat, 17 Nov 2012 04:22:14 +0000
Subject: Fix crashes when writing out files

From 10f611c074ae7b2ab0ec48ff3b8946c5f8e19970 Mon Sep 17 00:00:00 2001
From: Jasper St. Pierre <jstpierre@@mecheye.net>
Date: Sat, 17 Nov 2012 04:26:14 +0000
Subject: Use with statements for management

--- Alacarte/MainWindow.py.orig	Mon Mar 11 09:45:41 2013
+++ Alacarte/MainWindow.py	Mon Mar 11 09:45:33 2013
@@@@ -19,6 +19,7 @@@@
 
 from gi.repository import Gtk, GObject, Gio, GdkPixbuf, Gdk, GMenu, GLib
 import cgi
+import codecs
 import os
 import gettext
 import subprocess
@@@@ -319,7 +320,8 @@@@ class MainWindow(object):
 
         if not os.path.isfile(file_path):
             data = open(item.get_desktop_file_path()).read()
-            open(file_path, 'w').write(data)
+            with codecs.open(file_path, 'w', 'utf8') as f:
+                f.write(data)
 
         if file_path not in self.edit_pool:
             self.edit_pool.append(file_path)
@


1.4
log
@Resurrect alacarte now that's it's being maintained again and update to
alacarte-3.6.1.
(manually addings the dirs and not importing since the hierarchy exists
in CVS)

Alacarte is a menu editor for GNOME using the freedesktop.org menu
specification.

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.3
log
@remove, this app is broken and deprecated in several ways:
- still hasn't been ported to the new libgnome-menus api
- hasn't had a real release in two years
- uses old pygobject2 with pygi support, which has been moved to
  py-gobject3 to facilitate other development in the tree.

  (at least gmenu-simple-editor works again..)

  as discussed with aja@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Alacarte_MainWindow_py,v 1.2 2011/09/13 07:20:37 ajacoutot Exp $
d3 4
a6 4
From 8c33986006604f4fa308c439466f7de9b5c9227a Mon Sep 17 00:00:00 2001
From: Josselin Mouette <joss@@debian.org>
Date: Mon, 22 Aug 2011 18:47:47 +0000
Subject: Fix Python error on startup with gnome-menus 2.91.6+
d8 4
a11 1
Try gnome-desktop-item-edit, and if not found fallback to exo-desktop-item-edit.
d13 3
a15 9
--- Alacarte/MainWindow.py.orig	Tue Sep  8 16:24:13 2009
+++ Alacarte/MainWindow.py	Tue Sep 13 08:54:29 2011
@@@@ -71,7 +71,6 @@@@ class MainWindow:
 	def run(self):
 		self.loadMenus()
 		self.editor.applications.tree.add_monitor(self.menuChanged, None)
-		self.editor.settings.tree.add_monitor(self.menuChanged, None)
 		self.tree.get_object('mainwindow').show_all()
 		gtk.main()
d17 7
a23 10
@@@@ -295,7 +294,10 @@@@ class MainWindow:
 		else:
 			parent = menus[iter][2]
 		file_path = os.path.join(util.getUserDirectoryPath(), util.getUniqueFileId('alacarte-made', '.directory'))
-		process = subprocess.Popen(['gnome-desktop-item-edit', file_path], env=os.environ)
+		try:
+			process = subprocess.Popen(['gnome-desktop-item-edit', file_path], env=os.environ)
+		except:
+			process = subprocess.Popen(['exo-desktop-item-edit', file_path], env=os.environ)
 		gobject.timeout_add(100, self.waitForNewMenuProcess, process, parent.menu_id, file_path)
d25 5
a29 11
 	def on_new_item_button_clicked(self, button):
@@@@ -308,7 +310,10 @@@@ class MainWindow:
 		else:
 			parent = menus[iter][2]
 		file_path = os.path.join(util.getUserItemPath(), util.getUniqueFileId('alacarte-made', '.desktop'))
-		process = subprocess.Popen(['gnome-desktop-item-edit', file_path], env=os.environ)
+		try:
+			process = subprocess.Popen(['gnome-desktop-item-edit', file_path], env=os.environ)
+		except:
+			process = subprocess.Popen(['exo-desktop-item-edit', file_path], env=os.environ)
 		gobject.timeout_add(100, self.waitForNewItemProcess, process, parent.menu_id, file_path)
d31 2
a32 13
 	def on_new_separator_button_clicked(self, button):
@@@@ -379,7 +384,10 @@@@ class MainWindow:
 			self.editor._MenuEditor__addUndo([item,])
 		if file_path not in self.edit_pool:
 			self.edit_pool.append(file_path)
-			process = subprocess.Popen(['gnome-desktop-item-edit', file_path], env=os.environ)
+			try:
+				process = subprocess.Popen(['gnome-desktop-item-edit', file_path], env=os.environ)
+			except:
+				process = subprocess.Popen(['exo-desktop-item-edit', file_path], env=os.environ)
 			gobject.timeout_add(100, self.waitForEditProcess, process, file_path)
 
 	def on_menu_tree_cursor_changed(self, treeview):
@


1.2
log
@Fix Alacarte on GNOME 3 and add missing category to the desktop file.
@
text
@d1 1
a1 1
$OpenBSD: patch-Alacarte_MainWindow_py,v 1.1 2011/01/18 19:11:06 landry Exp $
@


1.1
log
@If gnome-desktop-item-edit is not present, try exo-desktop-item-edit.
Add conditional depend on gnome-panel|exo->0.6. Now Xfce users can use
alacarte to edit their fd.o compliant desktop menu!
Remove now useless CONFIGURE_ARGS.
ok ajacoutot@@
@
text
@d1 9
a9 2
$OpenBSD$
try gnome-desktop-item-edit, and if not found fallback to exo-desktop-item-edit
d11 9
a19 1
+++ Alacarte/MainWindow.py	Tue Jan 18 17:55:29 2011
@

