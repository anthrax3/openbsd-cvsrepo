head	1.3;
access;
symbols
	OPENBSD_5_0:1.2.0.8
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.6
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.4
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.2
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.1.0.2
	OPENBSD_4_6_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2011.09.12.07.28.55;	author jasper;	state dead;
branches;
next	1.2;

1.2
date	2009.10.11.17.31.07;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2009.04.20.15.15.40;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Moar GNOME3 merge
@
text
@$OpenBSD: patch-src_yelp-transform_c,v 1.2 2009/10/11 17:31:07 ajacoutot Exp $

XXX add a workaround for:
Program received signal SIGSEGV, Segmentation fault.
[Switching to process 201, thread 0x7de7a000]
0x0d363e73 in xmlXPathFreeNodeSet (obj=0x8644ce60) at xpath.c:4081
4081               if ((obj->nodeTab[i] != NULL) &&

--- src/yelp-transform.c.orig	Sun Oct 11 19:20:18 2009
+++ src/yelp-transform.c	Sun Oct 11 19:20:40 2009
@@@@ -186,7 +186,7 @@@@ yelp_transform_release (YelpTransform *transform)
 	/* We might still have pending pops from the queue, so just
 	 * schedule transform_free.
 	 */
-	g_idle_add ((GSourceFunc) transform_free, transform);
+	// g_idle_add ((GSourceFunc) transform_free, transform);
     }
     g_mutex_unlock (transform->mutex);
 }
@


1.2
log
@Major update to yelp-2.28.0
@
text
@d1 1
a1 1
$OpenBSD: patch-src_yelp-transform_c,v 1.1 2009/04/20 15:15:40 ajacoutot Exp $
@


1.1
log
@- add a workaround to prevent hard crashes in YelpTransform; the issue is
still very obscure but being investigated...
- fix a memory leak ; from upstream SVN r3246

ok jasper@@ (a while ago)
@
text
@d1 1
a1 3
$OpenBSD$

Fix memory leak. From upstream SVN r3246.
d9 3
a11 33
--- src/yelp-transform.c.orig	Mon Sep 22 19:26:17 2008
+++ src/yelp-transform.c	Sat Apr 18 22:35:44 2009
@@@@ -73,6 +73,8 @@@@ YelpTransform
     YelpTransform *transform;
     
     transform = g_new0 (YelpTransform, 1);
+    transform->func = func;
+    transform->user_data = user_data;
 
     transform->stylesheet = xsltParseStylesheetFile (BAD_CAST stylesheet);
     if (!transform->stylesheet) {
@@@@ -82,19 +84,16 @@@@ YelpTransform
 			      "not valid."),
 			    stylesheet);
 	transform_error (transform);
+	g_free (transform);
 	return NULL;
     }
 
-    transform->func = func;
-
     transform->queue = g_async_queue_new ();
     transform->chunks = g_hash_table_new_full (g_str_hash,
 					       g_str_equal,
 					       g_free,
 					       NULL);
 
-    transform->user_data = user_data;
-
     return transform;
 }
 
@@@@ -172,7 +171,7 @@@@ yelp_transform_release (YelpTransform *transform)
d16 1
a16 1
+	/* g_idle_add ((GSourceFunc) transform_free, transform); */
@

