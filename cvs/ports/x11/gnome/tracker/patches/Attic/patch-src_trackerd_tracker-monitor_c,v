head	1.3;
access;
symbols
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2010.04.09.09.00.31;	author ajacoutot;	state dead;
branches;
next	1.2;

1.2
date	2010.03.21.10.41.37;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2009.10.28.20.28.18;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Major update to tracker-search-0.8.1.
@
text
@$OpenBSD: patch-src_trackerd_tracker-monitor_c,v 1.2 2010/03/21 10:41:37 ajacoutot Exp $

Fix a segfault where there is no monitor running.

--- src/trackerd/tracker-monitor.c.orig	Thu Feb  4 11:25:44 2010
+++ src/trackerd/tracker-monitor.c	Thu Feb  4 14:09:19 2010
@@@@ -216,6 +216,7 @@@@ tracker_monitor_init (TrackerMonitor *object)
 	GFileMonitor	      *monitor;
 	GList		      *all_modules, *l;
 	const gchar	      *name;
+	GError	    	      *error = NULL;
 
 	object->private = TRACKER_MONITOR_GET_PRIVATE (object);
 
@@@@ -284,7 +285,17 @@@@ tracker_monitor_init (TrackerMonitor *object)
 	monitor = g_file_monitor_directory (file,
 					    G_FILE_MONITOR_WATCH_MOUNTS,
 					    NULL,
-					    NULL);
+					    &error);
+
+	/* Directory monitoring is missing, error out, don't crash. */
+	if (error) {
+		g_critical ("Could not obtain monitor: %s", error->message);
+		g_error_free (error);
+
+		exit (EXIT_FAILURE);
+		return FALSE;
+	}
+		
 
 	priv->monitor_backend = G_OBJECT_TYPE (monitor);
 
@


1.2
log
@Update tracker to version 0.6.96.

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_trackerd_tracker-monitor_c,v 1.1 2009/10/28 20:28:18 jasper Exp $
@


1.1
log
@- when there is no monitor running, don't crash. just exit. it's nicer.
issue found in budapest, but the spa made me forget about it.

ok ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD$
d5 3
a7 3
--- src/trackerd/tracker-monitor.c.orig	Sun Apr 26 12:22:58 2009
+++ src/trackerd/tracker-monitor.c	Wed Oct 28 21:06:25 2009
@@@@ -208,6 +208,7 @@@@ tracker_monitor_init (TrackerMonitor *object)
d15 1
a15 1
@@@@ -276,7 +277,17 @@@@ tracker_monitor_init (TrackerMonitor *object)
@

