head	1.8;
access;
symbols
	OPENBSD_5_3:1.4.0.2
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	jasper_20090421:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.8
date	2013.05.01.12.40.18;	author ajacoutot;	state dead;
branches;
next	1.7;

1.7
date	2013.04.30.08.35.44;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2013.04.10.14.30.43;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2013.04.10.14.13.53;	author ajacoutot;	state dead;
branches;
next	1.4;

1.4
date	2012.10.24.17.39.29;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2012.01.02.14.11.21;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2009.04.24.14.25.07;	author jasper;	state dead;
branches;
next	1.1;

1.1
date	2009.04.21.21.34.46;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.04.21.21.34.46;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Update to (meta-)tracker-0.16.1.
@
text
@$OpenBSD: patch-src_libtracker-common_tracker-os-dependant-unix_c,v 1.7 2013/04/30 08:35:44 ajacoutot Exp $

From a5dcf74772ad7800100905d93a11debf67644a38 Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@@gnome.org>
Date: Mon, 29 Apr 2013 15:03:36 +0000
Subject: Implement get_memory_total() on OpenBSD.

--- src/libtracker-common/tracker-os-dependant-unix.c.orig	Thu Mar 14 18:25:30 2013
+++ src/libtracker-common/tracker-os-dependant-unix.c	Wed Apr 10 15:16:43 2013
@@@@ -26,6 +26,11 @@@@
 #include <unistd.h>
 #include <sys/resource.h>
 
+#if defined (__OpenBSD__)
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#endif
+
 #include <glib.h>
 
 #include "tracker-log.h"
@@@@ -225,6 +230,7 @@@@ tracker_create_permission_string (struct stat finfo)
 static glong
 get_memory_total (void)
 {
+#if !defined (__OpenBSD__)
 	GError      *error = NULL;
 	const gchar *filename;
 	gchar       *contents = NULL;
@@@@ -258,6 +264,20 @@@@ get_memory_total (void)
 		}
 		g_free (contents);
 	}
+#else /* OpenBSD */
+	glong total = 0;
+	int64_t physmem;
+	size_t len;
+	static gint mib[] = { CTL_HW, HW_PHYSMEM64 };
+
+	len = sizeof (physmem);
+
+	if (sysctl (mib, G_N_ELEMENTS (mib), &physmem, &len, NULL, 0) == -1) {
+		g_critical ("Couldn't get memory information: %d", errno);
+	} else {
+		total = physmem;
+	}
+#endif /* !OpenBSD */
 
 	return total;
 }
@


1.7
log
@Committed upstream with a tweak.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_libtracker-common_tracker-os-dependant-unix_c,v 1.6 2013/04/10 14:30:43 ajacoutot Exp $
@


1.6
log
@cvs(1) missed those...???
@
text
@d1 1
a1 1
$OpenBSD: patch-src_libtracker-common_tracker-os-dependant-unix_c,v 1.4 2012/10/24 17:39:29 ajacoutot Exp $
d3 4
a6 1
https://bugzilla.gnome.org/show_bug.cgi?id=697719
d34 1
a34 1
+#else
d38 1
a38 1
+	static gint mib[2] = { CTL_HW, HW_PHYSMEM64 };
d42 1
a42 1
+	if (sysctl (mib, 2, &physmem, &len, NULL, 0) == -1) {
@


1.5
log
@Rework all kvm(3) patches to a state closer to being commitable upstream.
Fix a few implicit declarations.
Remove patch-src_libtracker-miner_tracker-password-provider_c which is not
needed anymore.
@
text
@d2 6
a7 3
--- src/libtracker-common/tracker-os-dependant-unix.c.orig	Wed Oct 24 17:43:55 2012
+++ src/libtracker-common/tracker-os-dependant-unix.c	Wed Oct 24 19:11:52 2012
@@@@ -26,6 +26,12 @@@@
a11 1
+#include <errno.h>
d19 1
a19 1
@@@@ -225,10 +231,11 @@@@ tracker_create_permission_string (struct stat finfo)
a22 1
+	glong        total = 0;
d27 1
a27 5
-	glong        total = 0;
 
 	filename = "/proc/meminfo";
 
@@@@ -258,6 +265,19 @@@@ get_memory_total (void)
d32 1
d35 1
a35 1
+	static int mib[2] = { CTL_HW, HW_PHYSMEM64 };
d37 1
a37 1
+	len = sizeof(physmem);
d39 1
a39 1
+	if (sysctl(mib, 2, &physmem, &len, NULL, 0) == -1) {
@


1.4
log
@Bugfix update to (meta-)tracker-0.14.3.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_libtracker-common_tracker-os-dependant-unix_c,v 1.3 2012/01/02 14:11:21 ajacoutot Exp $
@


1.3
log
@Implement get_memory_total().
@
text
@d1 3
a3 3
$OpenBSD$
--- src/libtracker-common/tracker-os-dependant-unix.c.orig	Mon Jan  2 14:50:59 2012
+++ src/libtracker-common/tracker-os-dependant-unix.c	Mon Jan  2 14:50:11 2012
d18 1
a18 1
 static guint
d48 2
a49 2
 	if (!total) {
 		/* Setting limit to an arbitary limit */
@


1.2
log
@- update tracker to 0.6.94
* bugfixes and minor improvements

jaja aja@@
@
text
@d1 6
a6 4
$OpenBSD: patch-src_libtracker-common_tracker-os-dependant-unix_c,v 1.1 2009/04/21 21:34:46 jasper Exp $
--- src/libtracker-common/tracker-os-dependant-unix.c.orig	Wed Apr  8 00:04:00 2009
+++ src/libtracker-common/tracker-os-dependant-unix.c	Thu Apr  9 21:32:09 2009
@@@@ -35,6 +35,10 @@@@
d8 21
a28 1
 #define DISABLE_MEM_LIMITS
d30 10
a39 3
+#if defined(__OpenBSD__) && !defined(RLIMIT_AS)
+#define RLIMIT_AS      RLIMIT_DATA
+#endif
d41 9
a49 3
 gboolean
 tracker_spawn (gchar **argv,
 	       gint    timeout,
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@import tracker 0.6.93

Tracker is a powerful desktop-neutral first class object database,
tag/metadata database, search tool and indexer.

Tracker is also extremely fast and super efficient with your systems
memory when compared with some other competing frameworks and is by far
the fastest and most memory efficient Nautilus search and Deskbar
backends currently availble.

It consists of a common object database that allows entities to have an
almost infinte number of properties, metadata (both embedded/harvested
as well as user definable), a comprehensive database of keywords/tags
and links to other entities.

NB: most patches have already been committed upstream by now.

based on initial work by bernd@@
feedback and ok ajacoutot@@

@
text
@@
