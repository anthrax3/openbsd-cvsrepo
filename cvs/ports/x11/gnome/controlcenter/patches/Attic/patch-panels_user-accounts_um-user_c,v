head	1.4;
access;
symbols
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.2.0.2
	OPENBSD_5_2_BASE:1.2;
locks; strict;
comment	@# @;


1.4
date	2013.03.29.18.18.43;	author ajacoutot;	state dead;
branches;
next	1.3;

1.3
date	2012.09.28.09.34.33;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2012.03.29.06.57.03;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2012.02.16.22.25.47;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to gnome-control-center-3.8.0.
@
text
@$OpenBSD: patch-panels_user-accounts_um-user_c,v 1.3 2012/09/28 09:34:33 ajacoutot Exp $
--- panels/user-accounts/um-user.c.orig	Mon Sep 24 17:39:34 2012
+++ panels/user-accounts/um-user.c	Fri Sep 28 10:32:20 2012
@@@@ -19,7 +19,11 @@@@
   * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
   */
 
+#if defined __OpenBSD__
+#define _BSD_SOURCE
+#else
 #define _XOPEN_SOURCE
+#endif
 
 #include "config.h"
 
@@@@ -27,6 +31,9 @@@@
 #include <string.h>
 #include <sys/types.h>
 #include <sys/stat.h>
+#if defined __OpenBSD__ /* for bcrypt_gensalt() */
+#include <pwd.h>
+#endif
 #include <unistd.h>
 
 #include <glib.h>
@@@@ -808,6 +815,7 @@@@ salt_char (GRand *rand)
 static gchar *
 make_crypted (const gchar *plain)
 {
+#if ! defined __OpenBSD__
         GString *salt;
         gchar *result;
         GRand *rand;
@@@@ -827,6 +835,18 @@@@ make_crypted (const gchar *plain)
 
         g_string_free (salt, TRUE);
         g_rand_free (rand);
+#else
+	gchar *result, *salt;
+	gchar buffer[_PASSWORD_LEN];
+
+	/*
+	 * XXX output a "blowfish,6" encrypted password whatever
+	 * localcipher value is defined in login.conf(5).
+	 */
+	strlcpy(buffer, bcrypt_gensalt(6), _PASSWORD_LEN);
+	salt = buffer;
+	result = g_strdup (crypt (plain, salt));
+#endif
 
         return result;
 }
@


1.3
log
@Update to gnome-control-center-3.6.0.
@
text
@d1 1
a1 1
$OpenBSD: patch-panels_user-accounts_um-user_c,v 1.2 2012/03/29 06:57:03 ajacoutot Exp $
@


1.2
log
@Update to gnome-control-center-3.4.0.
@
text
@d1 3
a3 3
$OpenBSD: patch-panels_user-accounts_um-user_c,v 1.1 2012/02/16 22:25:47 ajacoutot Exp $
--- panels/user-accounts/um-user.c.orig	Tue Feb 14 11:13:17 2012
+++ panels/user-accounts/um-user.c	Wed Mar 28 10:25:04 2012
d26 1
a26 1
@@@@ -924,6 +931,7 @@@@ salt_char (GRand *rand)
d34 1
a34 1
@@@@ -943,6 +951,18 @@@@ make_crypted (const gchar *plain)
@


1.1
log
@Implement user passwd change by admin users.
Prevent a couple of implicit declarations.
@
text
@d1 3
a3 3
$OpenBSD$
--- panels/user-accounts/um-user.c.orig	Thu Sep  1 12:01:01 2011
+++ panels/user-accounts/um-user.c	Wed Feb  1 08:27:41 2012
d26 1
a26 1
@@@@ -948,6 +955,7 @@@@ salt_char (GRand *rand)
d34 1
a34 1
@@@@ -967,6 +975,18 @@@@ make_crypted (const gchar *plain)
@

