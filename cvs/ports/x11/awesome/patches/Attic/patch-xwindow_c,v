head	1.9;
access;
symbols
	OPENBSD_6_0:1.8.0.4
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.2
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.6.0.8
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.4
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.2
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.4.0.2
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.3.0.2
	OPENBSD_5_4_BASE:1.3;
locks; strict;
comment	@# @;


1.9
date	2017.02.28.13.27.15;	author dcoppa;	state dead;
branches;
next	1.8;
commitid	LK24Dq2Oc5IWnvdk;

1.8
date	2016.01.18.09.50.09;	author dcoppa;	state Exp;
branches;
next	1.7;
commitid	lrRI65aKSWqF9Rnn;

1.7
date	2015.11.09.14.36.12;	author dcoppa;	state Exp;
branches;
next	1.6;
commitid	LYfZ9mVasxXSCMq6;

1.6
date	2014.04.15.14.56.45;	author dcoppa;	state Exp;
branches;
next	1.5;

1.5
date	2014.04.15.10.32.36;	author dcoppa;	state dead;
branches;
next	1.4;

1.4
date	2013.10.15.09.28.47;	author dcoppa;	state Exp;
branches;
next	1.3;

1.3
date	2013.05.28.11.15.44;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2013.05.24.16.15.24;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2013.05.22.15.05.50;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.9
log
@
Update to awesome v4.0 (Harder, Better, Faster, Stronger)

To migrate a custom rc.lua from version 3.5.x to version 4.0, see
https://awesomewm.org/apidoc/documentation/17-porting-tips.md.html#v4
@
text
@$OpenBSD: patch-xwindow_c,v 1.8 2016/01/18 09:50:09 dcoppa Exp $

commit c9ff826fbef2b9d4df84c1ef5ec5eba33661abee
Author: Uli Schlachter <psychon@@znc.in>
Date:   Mon Apr 14 10:04:14 2014 +0200

xwindow_shape_pixmap: Correctly handle invalid geometry

Signed-off-by: Uli Schlachter <psychon@@znc.in>

--- xwindow.c.orig	Tue Apr 15 16:30:41 2014
+++ xwindow.c	Tue Apr 15 16:32:02 2014
@@@@ -330,6 +330,9 @@@@ xwindow_shape_pixmap(int width, int height, cairo_surf
     cairo_surface_t *dest;
     cairo_t *cr;
 
+    if (width <= 0 || height <= 0)
+        return XCB_NONE;
+
     xcb_create_pixmap(globalconf.connection, 1, pixmap, globalconf.screen->root, width, height);
     dest = cairo_xcb_surface_create_for_bitmap(globalconf.connection, globalconf.screen, pixmap, width, height);
 
@


1.8
log
@
Update to awesome-3.5.7
@
text
@d1 1
a1 1
$OpenBSD: patch-xwindow_c,v 1.6 2014/04/15 14:56:45 dcoppa Exp $
@


1.7
log
@
Merge fixes from upstream (from the stable '3.5' branch)
@
text
@d11 2
a12 10
commit 4313d93c6c5b09565ed331c3e9a7653069d5337d
Author: Uli Schlachter <psychon@@znc.in>
Date:   Sat Oct 10 17:38:51 2015 +0200

Fix obvious typo in xwindow_translate_for_gravity()

Signed-off-by: Uli Schlachter <psychon@@znc.in>

--- xwindow.c.orig	Sat Jan 10 20:36:35 2015
+++ xwindow.c	Mon Nov  9 13:54:50 2015
a21 9
 
@@@@ -413,7 +416,7 @@@@ void xwindow_translate_for_gravity(xcb_gravity_t gravi
         break;
     case XCB_GRAVITY_STATIC:
         x = -change_width_before;
-        x = -change_height_before;
+        y = -change_height_before;
         break;
     }
@


1.6
log
@
Fix icon finding in awful.util
(upstream git commit b4b6e6c1fcc94814bed6587ba3e43be6baace3a5)

xwindow_shape_pixmap: Correctly handle invalid geometry
(upstream git commit c9ff826fbef2b9d4df84c1ef5ec5eba33661abee)
@
text
@d1 1
a1 1
$OpenBSD$
d11 10
a20 2
--- xwindow.c.orig	Tue Apr 15 16:30:41 2014
+++ xwindow.c	Tue Apr 15 16:32:02 2014
d30 9
@


1.5
log
@
Cleanup following libxcb/xcb-util updates
@
text
@d1 1
a1 1
$OpenBSD: patch-xwindow_c,v 1.4 2013/10/15 09:28:47 dcoppa Exp $
d3 3
a5 1
Revert to the old xcb-util-0.3.6 API
d7 15
a21 9
--- xwindow.c.orig	Mon Apr  1 13:44:46 2013
+++ xwindow.c	Fri May 24 16:58:00 2013
@@@@ -62,7 +62,7 @@@@ uint32_t
 xwindow_get_state_reply(xcb_get_property_cookie_t cookie)
 {
     /* If no property is set, we just assume a sane default. */
-    uint32_t result = XCB_ICCCM_WM_STATE_NORMAL;
+    uint32_t result = XCB_WM_STATE_NORMAL;
     xcb_get_property_reply_t *prop_r;
a22 1
     if((prop_r = xcb_get_property_reply(globalconf.connection, cookie, NULL)))
@


1.4
log
@Update to awesome-3.5.2, codename "The Fox".
@
text
@d1 1
a1 1
$OpenBSD: patch-xwindow_c,v 1.3 2013/05/28 11:15:44 dcoppa Exp $
@


1.3
log
@Zap another couple of hardcoded paths.
@
text
@d1 1
a1 1
$OpenBSD: patch-xwindow_c,v 1.2 2013/05/24 16:15:24 dcoppa Exp $
a4 15
commit 2d3103345e3a266eaf1d5261ef37e36ac5498ecc
Author: Uli Schlachter <psychon@@znc.in>
Date:   Sun Apr 7 11:57:40 2013 +0200

Implement window gravity in ConfigureRequests

Previously, awesome didn't move windows when they sent a ConfigureRequest
(and it also shrunk them by the size of titlebars, before it forgot
to add these). This commit adds proper gravity support to
ConfigureRequest handling.

This was tested with test-gravity from metacity (in src/wm-tester).

Signed-off-by: Uli Schlachter <psychon@@znc.in>

a15 67
@@@@ -294,6 +294,66 @@@@ xwindow_set_shape(xcb_window_t win, int width, int hei
 
     if (pixmap != XCB_NONE)
         xcb_free_pixmap(globalconf.connection, pixmap);
+}
+
+/** Calculate the position change that a window needs applied.
+ * \param gravity The window gravity that should be used.
+ * \param change_width_before The window width difference that will be applied.
+ * \param change_height_before The window height difference that will be applied.
+ * \param change_width_after The window width difference that will be applied.
+ * \param change_height_after The window height difference that will be applied.
+ * \param dx On return, this will be set to the amount the pixel has to be moved.
+ * \param dy On return, this will be set to the amount the pixel has to be moved.
+ */
+void xwindow_translate_for_gravity(xcb_gravity_t gravity, int16_t change_width_before, int16_t change_height_before,
+        int16_t change_width_after, int16_t change_height_after, int16_t *dx, int16_t *dy)
+{
+    int16_t x = 0, y = 0;
+    int16_t change_height = change_height_before + change_height_after;
+    int16_t change_width = change_width_before + change_width_after;
+
+    switch (gravity) {
+    case XCB_GRAVITY_WIN_UNMAP:
+    case XCB_GRAVITY_NORTH_WEST:
+        break;
+    case XCB_GRAVITY_NORTH:
+        x = -change_width / 2;
+        break;
+    case XCB_GRAVITY_NORTH_EAST:
+        x = -change_width;
+        break;
+    case XCB_GRAVITY_WEST:
+        y = -change_height / 2;
+        break;
+    case XCB_GRAVITY_CENTER:
+        x = -change_width / 2;
+        y = -change_height / 2;
+        break;
+    case XCB_GRAVITY_EAST:
+        x = -change_width;
+        y = -change_height / 2;
+        break;
+    case XCB_GRAVITY_SOUTH_WEST:
+        y = -change_height;
+        break;
+    case XCB_GRAVITY_SOUTH:
+        x = -change_width / 2;
+        y = -change_height;
+        break;
+    case XCB_GRAVITY_SOUTH_EAST:
+        x = -change_width;
+        y = -change_height;
+        break;
+    case XCB_GRAVITY_STATIC:
+        x = -change_width_before;
+        x = -change_height_before;
+        break;
+    }
+
+    if (dx)
+        *dx = x;
+    if (dy)
+        *dy = y;
 }
 
 // vim: filetype=c:expandtab:shiftwidth=4:tabstop=8:softtabstop=4:textwidth=80
@


1.2
log
@
commit 2d3103345e3a266eaf1d5261ef37e36ac5498ecc
Author: Uli Schlachter <psychon@@znc.in>
Date:   Sun Apr 7 11:57:40 2013 +0200

Implement window gravity in ConfigureRequests

Previously, awesome didn't move windows when they sent a ConfigureRequest
(and it also shrunk them by the size of titlebars, before it forgot
to add these). This commit adds proper gravity support to
ConfigureRequest handling.

See: https://awesome.naquadah.org/bugs/index.php?do=details&task_id=1137
@
text
@d1 3
a3 1
$OpenBSD: patch-xwindow_c,v 1.1 2013/05/22 15:05:50 dcoppa Exp $
a18 3


Revert to the old xcb-util-0.3.6 API
@


1.1
log
@Major update to awesome-3.5.1

OK jasper@@
@
text
@d1 17
a17 1
$OpenBSD$
d21 2
a22 2
--- xwindow.c.orig	Mon May 20 13:59:54 2013
+++ xwindow.c	Mon May 20 14:00:27 2013
d32 67
@

