head	1.2;
access;
symbols
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2011.05.17.11.30.54;	author dcoppa;	state dead;
branches;
next	1.1;

1.1
date	2011.01.19.12.41.08;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to awesome-3.4.10 (codename "Exploder")
@
text
@$OpenBSD: patch-tag_c,v 1.1 2011/01/19 12:41:08 dcoppa Exp $
--- tag.c.orig	Mon Jan 17 12:38:13 2011
+++ tag.c	Wed Jan 19 13:11:52 2011
@@@@ -363,7 +363,26 @@@@ luaA_tag_clients(lua_State *L)
     {
         luaA_checktable(L, 2);
         foreach(c, tag->clients)
-            untag_client(*c, tag);
+        {
+            /* Only untag if we aren't going to add this tag again */
+            bool found = false;
+            lua_pushnil(L);
+            while(lua_next(L, 2))
+            {
+                client_t *tc = luaA_checkudata(L, -1, &client_class);
+                /* Pop the value from lua_next */
+                lua_pop(L, 1);
+                if (tc != *c)
+                    continue;
+
+                /* Pop the key from lua_next */
+                lua_pop(L, 1);
+                found = true;
+                break;
+            }
+            if(!found)
+                untag_client(*c, tag);
+        }
         lua_pushnil(L);
         while(lua_next(L, 2))
         {
@


1.1
log
@re-add "--skip-validation" to xmlto command line, erroneously removed
in previous commit.

fix a bug where untagging causes the client to lose the input focus
(from upstream git).
@
text
@d1 1
a1 1
$OpenBSD$
@

