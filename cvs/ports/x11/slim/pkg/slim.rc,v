head	1.9;
access;
symbols
	OPENBSD_6_1:1.9.0.6
	OPENBSD_6_1_BASE:1.9
	OPENBSD_6_0:1.9.0.4
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.9.0.2
	OPENBSD_5_9_BASE:1.9
	OPENBSD_5_8:1.5.0.10
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.6
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.4
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.2
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.3.0.8
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.6
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@ * @;


1.9
date	2015.12.21.10.17.32;	author ajacoutot;	state Exp;
branches;
next	1.8;
commitid	mtNXgqH8qNXf2w4k;

1.8
date	2015.12.21.09.32.01;	author ajacoutot;	state Exp;
branches;
next	1.7;
commitid	89yBmxf8zl7f4edS;

1.7
date	2015.12.20.09.38.14;	author ajacoutot;	state Exp;
branches;
next	1.6;
commitid	SUL8g4c0gjEg4ZTf;

1.6
date	2015.12.19.14.13.45;	author ajacoutot;	state Exp;
branches;
next	1.5;
commitid	jNmUMRLbxGUrj246;

1.5
date	2014.01.30.16.58.58;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2014.01.30.14.25.35;	author zhuk;	state Exp;
branches;
next	1.3;

1.3
date	2011.12.17.22.01.14;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2011.03.09.18.51.49;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2011.01.17.14.57.38;	author landry;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Override _rc_wait(); these scripts are a bit hackish because they need
/usr/libexec/getty to be started but it is started later in the boot
process.
@
text
@#!/bin/sh
#
# $OpenBSD: slim.rc,v 1.8 2015/12/21 09:32:01 ajacoutot Exp $

daemon="${TRUEPREFIX}/bin/slim -d"

. /etc/rc.d/rc.subr

rc_reload=NO

if [ -n "${INRC}" ]; then
# on boot: make sure we don't hang in _rc_wait
_rc_wait() {
	return 0
}
# on boot: wait for ttys to be initialized
rc_start() {
	( local i=0
	while ! pgrep -qf "^/usr/libexec/getty "; do
		sleep 1
		[ $((i++)) -ge 10 ] && return 1
	done
	${rcexec} "${daemon} ${daemon_flags}" ) &
}
fi

rc_cmd $1
@


1.8
log
@Revert, this breaks rc_stop() for these daemons.
I'm working on a better fix.

spotted by dcoppa@@
@
text
@d3 1
a3 1
# $OpenBSD: slim.rc,v 1.7 2015/12/20 09:38:14 ajacoutot Exp $
a10 2
# on boot: wait for ttys to be initialized and make sure we don't hang in
# "_rc_wait start" by hacking pexp
d12 5
@


1.7
log
@Move pexp where it belongs.
@
text
@d3 1
a3 1
# $OpenBSD: slim.rc,v 1.6 2015/12/19 14:13:45 ajacoutot Exp $
a14 1
	pexp="/sbin/init"
@


1.6
log
@Cope with new rc.subr behavior so that we don't end hanging in _rc_wait
start.
@
text
@d3 1
a3 1
# $OpenBSD: slim.rc,v 1.5 2014/01/30 16:58:58 ajacoutot Exp $
d14 1
a15 1
rc_start() {
@


1.5
log
@Sync rc_start() between these 3 daemons since they do the same.
Keeping the sleep 2 in kdm.rc -- not sure why this is needed, zhuk@@ probably
knows.
@
text
@d3 1
a3 1
# $OpenBSD: slim.rc,v 1.4 2014/01/30 14:25:35 zhuk Exp $
d11 2
a12 1
# on boot: wait for ttys to be initialized
d14 1
@


1.4
log
@Do in the x11/slim the same dance as in GDM/KDM: on boot, wait in
background for getty process to appear.

Tested by me on i386, okay landry@@ (MAINTAINER).
@
text
@d3 1
a3 1
# $OpenBSD: slim.rc,v 1.3 2011/12/17 22:01:14 sthen Exp $
d11 1
@


1.3
log
@Where a program with an rc script _requires_ a certain command line
parameter to daemonize, move the parameter from daemon to daemon_flags,
so that the user cannot inadvertently prevent it from daemonizing by
adjusting the flags.

Discussed with ajacoutot and schwarze, this method was suggested
by schwarze@@ as a simpler alternative to my diff. ok aja@@
@
text
@d3 1
a3 1
# $OpenBSD: slim.rc,v 1.2 2011/03/09 18:51:49 ajacoutot Exp $
d11 1
d13 6
a18 1
	(sleep 5; ${rcexec} "${daemon} ${daemon_flags}")&
d20 1
@


1.2
log
@Remove now uneeded redirection.
@
text
@d3 1
a3 1
# $OpenBSD: slim.rc,v 1.1 2011/01/17 14:57:38 landry Exp $
d5 1
a5 2
daemon="${TRUEPREFIX}/bin/slim"
daemon_flags="-d"
@


1.1
log
@Add an rc script for slim.
ok ajacoutot@@ robert@@
@
text
@d3 1
a3 1
# $OpenBSD$
d13 1
a13 1
	(sleep 5; ${rcexec} "${daemon} ${daemon_flags}" >/dev/null)&
@

