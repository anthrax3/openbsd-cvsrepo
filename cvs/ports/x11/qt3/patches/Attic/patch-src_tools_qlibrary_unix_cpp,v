head	1.3;
access;
symbols
	OPENBSD_3_2:1.2.0.2
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.1.0.2
	OPENBSD_3_1_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2002.10.26.11.45.52;	author espie;	state dead;
branches;
next	1.2;

1.2
date	2002.07.17.21.43.36;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2002.04.09.17.51.17;	author espie;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to 3.0.6 (maintenance release).
Add basic framework for qt-mt flavor (untested for real yet).
@
text
@$OpenBSD: patch-src_tools_qlibrary_unix_cpp,v 1.2 2002/07/17 21:43:36 espie Exp $
--- src/tools/qlibrary_unix.cpp.orig	Mon Jul  8 12:26:47 2002
+++ src/tools/qlibrary_unix.cpp	Wed Jul 17 15:31:14 2002
@@@@ -35,7 +35,9 @@@@
 **
 **********************************************************************/
 
+#include <string.h>
 #include "private/qlibrary_p.h"
+#include "qplatformdefs.h"
 
 /*
   The platform dependent implementations of
@


1.2
log
@Update qt to 3.0.5.
Remove kde patches that have been integrated.
Independent rediscovery of a qt-copy patch (bogus lockfiles in RO directories)
and OpenBSD a.out fix.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_tools_qlibrary_unix_cpp,v 1.1 2002/04/09 17:51:17 espie Exp $
@


1.1
log
@fix plugins on a.out platforms. This should repair jpeg in kde3.
@
text
@d1 4
a4 4
$OpenBSD$
--- src/tools/qlibrary_unix.cpp.orig	Tue Apr  9 18:38:48 2002
+++ src/tools/qlibrary_unix.cpp	Tue Apr  9 19:42:49 2002
@@@@ -35,6 +35,8 @@@@
a7 1
+#include <stdlib.h>
d10 1
d13 1
a13 15
@@@@ -134,7 +136,14 @@@@ void* QLibraryPrivate::resolveSymbol( co
     if ( !pHnd )
 	return 0;
 
+#if defined(__OpenBSD__) && !defined(__ELF__)
+    char *symbol2 = (char *)malloc(strlen(symbol)+2);
+    *symbol2 = '_';
+    strcpy(symbol2+1, symbol);
+    void *address = dlsym( pHnd, symbol2 );
+#else
     void* address = dlsym( pHnd, symbol );
+#endif
 #if defined(QT_DEBUG) || defined(QT_DEBUG_COMPONENT)
     const char* error = dlerror();
     if ( error )
@

