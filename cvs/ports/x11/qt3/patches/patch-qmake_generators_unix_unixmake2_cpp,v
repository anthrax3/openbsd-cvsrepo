head	1.19;
access;
symbols
	OPENBSD_6_2:1.19.0.4
	OPENBSD_6_2_BASE:1.19
	OPENBSD_6_1:1.19.0.2
	OPENBSD_6_1_BASE:1.19
	OPENBSD_6_0:1.18.0.36
	OPENBSD_6_0_BASE:1.18
	OPENBSD_5_9:1.18.0.32
	OPENBSD_5_9_BASE:1.18
	OPENBSD_5_8:1.18.0.34
	OPENBSD_5_8_BASE:1.18
	OPENBSD_5_7:1.18.0.30
	OPENBSD_5_7_BASE:1.18
	OPENBSD_5_6:1.18.0.28
	OPENBSD_5_6_BASE:1.18
	OPENBSD_5_5:1.18.0.26
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.18.0.24
	OPENBSD_5_4_BASE:1.18
	OPENBSD_5_3:1.18.0.22
	OPENBSD_5_3_BASE:1.18
	OPENBSD_5_2:1.18.0.20
	OPENBSD_5_2_BASE:1.18
	OPENBSD_5_1_BASE:1.18
	OPENBSD_5_1:1.18.0.18
	OPENBSD_5_0:1.18.0.16
	OPENBSD_5_0_BASE:1.18
	OPENBSD_4_9:1.18.0.14
	OPENBSD_4_9_BASE:1.18
	OPENBSD_4_8:1.18.0.12
	OPENBSD_4_8_BASE:1.18
	OPENBSD_4_7:1.18.0.10
	OPENBSD_4_7_BASE:1.18
	OPENBSD_4_6:1.18.0.8
	OPENBSD_4_6_BASE:1.18
	OPENBSD_4_5:1.18.0.6
	OPENBSD_4_5_BASE:1.18
	OPENBSD_4_4:1.18.0.4
	OPENBSD_4_4_BASE:1.18
	OPENBSD_4_3:1.18.0.2
	OPENBSD_4_3_BASE:1.18
	OPENBSD_4_2:1.17.0.2
	OPENBSD_4_2_BASE:1.17
	OPENBSD_4_1:1.16.0.2
	OPENBSD_4_1_BASE:1.16
	OPENBSD_4_0:1.15.0.2
	OPENBSD_4_0_BASE:1.15
	OPENBSD_3_9:1.14.0.2
	OPENBSD_3_9_BASE:1.14
	OPENBSD_3_8:1.12.0.4
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.12.0.2
	OPENBSD_3_7_BASE:1.12
	OPENBSD_3_6:1.11.0.2
	OPENBSD_3_6_BASE:1.11
	OPENBSD_3_5:1.10.0.2
	OPENBSD_3_5_BASE:1.10
	OPENBSD_3_4:1.9.0.2
	OPENBSD_3_4_BASE:1.9
	OPENBSD_3_3:1.8.0.2
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.5.0.2
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.4.0.2
	OPENBSD_3_1_BASE:1.4
	espie:1.1.1.1
	qt3:1.1.1;
locks; strict;
comment	@# @;


1.19
date	2016.12.26.08.55.05;	author zhuk;	state Exp;
branches;
next	1.18;
commitid	lCp310GgnWuKTJxI;

1.18
date	2007.12.28.18.53.20;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2007.03.31.22.49.46;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2007.02.17.18.59.04;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2006.03.07.19.29.20;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2005.12.28.16.50.59;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2005.09.19.10.24.57;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2005.02.03.20.05.56;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2004.07.22.23.03.09;	author brad;	state Exp;
branches;
next	1.10;

1.10
date	2004.01.08.01.12.59;	author brad;	state Exp;
branches;
next	1.9;

1.9
date	2003.04.05.14.45.19;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2003.01.19.17.36.51;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2002.11.23.18.52.22;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2002.10.26.11.45.52;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2002.07.17.21.43.36;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2002.03.28.11.47.18;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2002.03.06.10.53.13;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2002.03.05.22.11.48;	author mark;	state Exp;
branches;
next	1.1;

1.1
date	2002.03.04.16.13.05;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2002.03.04.16.13.05;	author espie;	state Exp;
branches;
next	;


desc
@@


1.19
log
@Don't create shlib symlinks on OpenBSD.

Allows to switch security/qca to devel/qmake.
@
text
@$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.18 2007/12/28 18:53:20 espie Exp $
1. Add support for OpenBSD shared libraries policy.
2. Add support for LOCALBASE.
--- qmake/generators/unix/unixmake2.cpp.orig	Fri Feb  2 17:01:27 2007
+++ qmake/generators/unix/unixmake2.cpp	Mon Dec 26 11:13:01 2016
@@@@ -129,6 +129,8 @@@@ UnixMakefileGenerator::writeMakeParts(QTextStream &t)
 	 src_incremental=FALSE, moc_incremental=FALSE;
 
     t << "####### Compiler, tools and options" << endl << endl;
+    if (varGlue("INCLUDEPATH", " -I", " -I", "").find("$(LOCALBASE)") != -1)
+    	t << "LOCALBASE?= /usr/local" << endl;
     t << "CC       = ";
     if (project->isActiveConfig("thread") &&
 	! project->variables()["QMAKE_CC_THREAD"].isEmpty())
@@@@ -295,10 +297,15 @@@@ UnixMakefileGenerator::writeMakeParts(QTextStream &t)
     } else if (!project->isActiveConfig("staticlib") && project->variables()["QMAKE_APP_FLAG"].isEmpty()) {
 	t << "TARGETA	= " << var("TARGETA") << endl;
 	if (project->isEmpty("QMAKE_HPUX_SHLIB")) {
-	    t << "TARGETD	= " << var("TARGET_x.y.z") << endl;
-	    t << "TARGET0	= " << var("TARGET_") << endl;
-	    t << "TARGET1	= " << var("TARGET_x") << endl;
-	    t << "TARGET2	= " << var("TARGET_x.y") << endl;
+  	    if (!project->isEmpty("QMAKE_OPENBSD_SHLIBS")) {
+		t << "LIB"+var("OBSD_TARGET_NAME")+"_VERSION = " << var("OBSD_TARGET_VERSION") << endl;
+  		t << "TARGETD	= " << var("TARGET_x.y") << endl;
+ 	    } else {
+		t << "TARGETD	= " << var("TARGET_x.y.z") << endl;
+		t << "TARGET0	= " << var("TARGET_") << endl;
+		t << "TARGET1	= " << var("TARGET_x") << endl;
+		t << "TARGET2	= " << var("TARGET_x.y") << endl;
+	    }
 	} else {
 	    t << "TARGETD	= " << var("TARGET_x") << endl;
 	    t << "TARGET0	= " << var("TARGET_") << endl;
@@@@ -375,6 +382,7 @@@@ UnixMakefileGenerator::writeMakeParts(QTextStream &t)
     }
 
     t << "####### Build rules" << endl << endl;
+    t << "$(OBJECTS): $(UICDECLS)" << endl << endl;
     if(!project->variables()["SUBLIBS"].isEmpty()) {
 	QString libdir = "tmp/";
 	if(!project->isEmpty("SUBLIBS_DIR"))
@@@@ -561,6 +569,17 @@@@ UnixMakefileGenerator::writeMakeParts(QTextStream &t)
 	    if(!project->isEmpty("QMAKE_POST_LINK"))
 		t << "\n\t" << var("QMAKE_POST_LINK") << "\n\t";
 	    t << endl << endl;
+        } else if (!project->isEmpty("QMAKE_OPENBSD_SHLIBS")) {
+	    t << "\n\t"
+	      << "-$(DEL_FILE) $(TARGET)" << "\n\t"
+	      << var("QMAKE_LINK_SHLIB_CMD") << "\n\t";
+	    if(!destdir.isEmpty())
+		t << "\n\t"
+		  << "-$(DEL_FILE) " << var("DESTDIR") << "$(TARGET)\n\t"
+		  << "-$(MOVE) $(TARGET) $(TARGET0) $(TARGET1) $(TARGET2) " << var("DESTDIR");
+	    if(!project->isEmpty("QMAKE_POST_LINK"))
+		t << "\n\t" << var("QMAKE_POST_LINK");
+	    t << endl << endl;
 	} else if(project->isEmpty("QMAKE_HPUX_SHLIB")) {
 	    t << "\n\t"
 	      << "-$(DEL_FILE) $(TARGET) $(TARGET0) $(TARGET1) $(TARGET2)" << "\n\t"
@@@@ -1293,10 +1312,20 @@@@ void UnixMakefileGenerator::init2()
 		project->variables()["TARGET_x"].append("lib" + project->first("TARGET") + "." +
 							project->first("QMAKE_EXTENSION_SHLIB") +
 							"." + project->first("VER_MAJ"));
-		project->variables()["TARGET_x.y"].append("lib" + project->first("TARGET") + "." +
-						      project->first("QMAKE_EXTENSION_SHLIB")
-						      + "." + project->first("VER_MAJ") +
-						      "." + project->first("VER_MIN"));
+		if ( !project->variables()["QMAKE_OPENBSD_SHLIBS"].isEmpty() ) {
+		    QString s;
+		    s.setNum(project->first("VER_MIN").toInt()*10+ project->first("VER_PAT").toInt());
+		    project->variables()["OBSD_TARGET_VERSION"].append(project->first("VER_MAJ") + "." + s);
+		    project->variables()["OBSD_TARGET_NAME"].append(project->first("TARGET"));
+		    project->variables()["TARGET_x.y"].append("lib" + project->first("TARGET") + "." +
+							  project->first("QMAKE_EXTENSION_SHLIB")
+							  + ".$(LIB"+ project->first("TARGET") + "_VERSION)");
+		} else {
+		    project->variables()["TARGET_x.y"].append("lib" + project->first("TARGET") + "." +
+							  project->first("QMAKE_EXTENSION_SHLIB")
+							  + "." + project->first("VER_MAJ") +
+							  "." + project->first("VER_MIN"));
+		}
 		project->variables()["TARGET_x.y.z"].append("lib" + project->first("TARGET") +
 							    "." +
 							    project->variables()[
@@@@ -1305,7 +1334,10 @@@@ void UnixMakefileGenerator::init2()
 							    project->first("VER_MIN") +  "." +
 							    project->first("VER_PAT"));
 	    }
-	    project->variables()["TARGET"] = project->variables()["TARGET_x.y.z"];
+	    if ( !project->variables()["QMAKE_OPENBSD_SHLIBS"].isEmpty() )
+		project->variables()["TARGET"] = project->variables()["TARGET_x.y"];
+	    else
+		project->variables()["TARGET"] = project->variables()["TARGET_x.y.z"];
 	}
 	if(project->isEmpty("QMAKE_LN_SHLIB"))
 	    project->variables()["QMAKE_LN_SHLIB"].append("ln -s");
@@@@ -1586,5 +1618,6 @@@@ UnixMakefileGenerator::writePkgConfigFile()     // ###
       << varGlue("PRL_EXPORT_DEFINES","-D"," -D"," ")
       << project->variables()["PRL_EXPORT_CXXFLAGS"].join(" ")
 	//      << varGlue("DEFINES","-D"," -D"," ")
-      << " -I${includedir}";
+      << " -I${includedir}"
+      << endl;
 }
@


1.18
log
@qmake should emit one more dependency so that uic is run before compiling
anything else.

(fixes parallel build of sqlitebrowser, among others)
@
text
@d1 5
a5 3
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.17 2007/03/31 22:49:46 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Fri Feb  2 15:01:27 2007
+++ qmake/generators/unix/unixmake2.cpp	Fri Dec 28 19:12:54 2007
d43 19
a61 1
@@@@ -1293,10 +1301,20 @@@@ void UnixMakefileGenerator::init2()
d86 1
a86 1
@@@@ -1305,7 +1323,10 @@@@ void UnixMakefileGenerator::init2()
d98 1
a98 1
@@@@ -1586,5 +1607,6 @@@@ UnixMakefileGenerator::writePkgConfigFile()     // ###
@


1.17
log
@regen patches.
handle utf8 encoding better.
@
text
@d1 3
a3 3
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.16 2007/02/17 18:59:04 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Thu Oct 19 16:25:42 2006
+++ qmake/generators/unix/unixmake2.cpp	Sat Mar 31 14:51:24 2007
d33 9
a41 1
@@@@ -1293,10 +1300,20 @@@@ void UnixMakefileGenerator::init2()
d66 1
a66 1
@@@@ -1305,7 +1322,10 @@@@ void UnixMakefileGenerator::init2()
d78 1
a78 1
@@@@ -1586,5 +1606,6 @@@@ UnixMakefileGenerator::writePkgConfigFile()     // ###
@


1.16
log
@fix pkgnames, bump stuff.
add a qt-mt.pc that looks like something.
fix a buglet in qmake.
@
text
@d1 1
a1 1
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.15 2006/03/07 19:29:20 espie Exp $
d3 2
a4 2
+++ qmake/generators/unix/unixmake2.cpp	Sat Feb 17 17:15:33 2007
@@@@ -129,6 +129,8 @@@@ UnixMakefileGenerator::writeMakeParts(QT
d13 1
a13 1
@@@@ -295,10 +297,15 @@@@ UnixMakefileGenerator::writeMakeParts(QT
d70 1
a70 1
@@@@ -1586,5 +1606,6 @@@@ UnixMakefileGenerator::writePkgConfigFil
@


1.15
log
@fix a few minor nits:
- let qmake output LOCALBASE if it find it useful
- the OpenBSD default config uses threads anyways, for ports.
- make a link to help designer and friends to find their documentation
@
text
@d1 3
a3 3
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.14 2005/12/28 16:50:59 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Fri Sep  2 14:43:19 2005
+++ qmake/generators/unix/unixmake2.cpp	Tue Mar  7 10:42:35 2006
d70 8
@


1.14
log
@SHARED_LIBS:
- qmake changes to emit LIBxxx_VERSION annotations in generated Makefiles.
- qt changes to use plugins-<major> libraries. Note that uic always look in
the configured directory, and one cannot link against two qt libraries,
otherwise stuff will be destroyed twice... (ick).
@
text
@d1 1
a1 1
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.13 2005/09/19 10:24:57 espie Exp $
d3 11
a13 2
+++ qmake/generators/unix/unixmake2.cpp	Tue Dec 27 19:45:53 2005
@@@@ -295,10 +295,15 @@@@ UnixMakefileGenerator::writeMakeParts(QT
d33 1
a33 1
@@@@ -1293,10 +1298,20 @@@@ void UnixMakefileGenerator::init2()
d58 1
a58 1
@@@@ -1305,7 +1320,10 @@@@ void UnixMakefileGenerator::init2()
@


1.13
log
@update to qt 3.3.5
@
text
@d1 1
a1 1
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.12 2005/02/03 20:05:56 espie Exp $
d3 2
a4 2
+++ qmake/generators/unix/unixmake2.cpp	Sun Sep 18 15:49:44 2005
@@@@ -295,10 +295,14 @@@@ UnixMakefileGenerator::writeMakeParts(QT
d13 1
d24 1
a24 1
@@@@ -1293,10 +1297,19 @@@@ void UnixMakefileGenerator::init2()
d35 2
d39 1
a39 2
+							  + "." + project->first("VER_MAJ") +
+							  "." + s );
d49 1
a49 1
@@@@ -1305,7 +1318,10 @@@@ void UnixMakefileGenerator::init2()
@


1.12
log
@update to 3.3.4, lots of sec patches included.
activate qt support. build dependency only, qt is smart enough
to autoload that stuff...
@
text
@d1 3
a3 3
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.11 2004/07/22 23:03:09 brad Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Fri Jan 21 18:16:26 2005
+++ qmake/generators/unix/unixmake2.cpp	Fri Jan 28 10:59:46 2005
d23 1
a23 1
@@@@ -1291,10 +1295,19 @@@@ void UnixMakefileGenerator::init2()
d47 1
a47 1
@@@@ -1303,7 +1316,10 @@@@ void UnixMakefileGenerator::init2()
@


1.11
log
@upgrade to Qt 3.3.2

ok MAINTAINER
@
text
@d1 3
a3 3
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.10 2004/01/08 01:12:59 brad Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	2004-04-19 03:36:24.000000000 -0600
+++ qmake/generators/unix/unixmake2.cpp	2004-06-19 20:59:08.000000000 -0600
d23 1
a23 1
@@@@ -1290,10 +1294,19 @@@@ void UnixMakefileGenerator::init2()
d47 1
a47 1
@@@@ -1302,7 +1315,10 @@@@ void UnixMakefileGenerator::init2()
@


1.10
log
@upgrade to Qt 3.2.3

ok espie@@
@
text
@d1 4
a4 4
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.9 2003/04/05 14:45:19 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	2003-11-10 05:22:48.000000000 -0500
+++ qmake/generators/unix/unixmake2.cpp	2003-12-29 04:35:25.000000000 -0500
@@@@ -293,10 +293,14 @@@@ UnixMakefileGenerator::writeMakeParts(QT
d23 1
a23 9
@@@@ -1238,6 +1242,7 @@@@ void UnixMakefileGenerator::init2()
 							    project->first("VER_PAT"));
 	    }
 	    project->variables()["TARGET"] = project->variables()["TARGET_x.y.z"];
+
 	} else {
 	    project->variables()["TARGET_"].append("lib" + project->first("TARGET") + "." +
 						   project->first("QMAKE_EXTENSION_SHLIB"));
@@@@ -1258,10 +1263,19 @@@@ void UnixMakefileGenerator::init2()
d47 1
a47 1
@@@@ -1270,7 +1284,10 @@@@ void UnixMakefileGenerator::init2()
a58 56
@@@@ -1358,6 +1375,20 @@@@ void UnixMakefileGenerator::init2()
 }
 
 QString
+UnixMakefileGenerator::prefixedVariable( const QString &projectVariableName, const QString &defaultSuffix )
+{
+    QString prefix = qInstallPath();
+
+    QString value = var( projectVariableName );
+    if ( value.isEmpty() )
+	value = "${prefix}" + defaultSuffix;
+    else if ( value.startsWith( prefix ) )
+	value.replace( prefix, "${prefix}" );
+
+    return value;
+}
+
+QString
 UnixMakefileGenerator::libtoolFileName()
 {
     QString ret = var("TARGET");
@@@@ -1476,13 +1507,13 @@@@ UnixMakefileGenerator::writePkgConfigFil
     QTextStream t(&ft);
 
     QString prefix = qInstallPath();
-    QString libDir = prefix + "/lib";
-    QString includeDir = prefix + "/include";
+    QString libDir = prefixedVariable( "libs.path", "/lib" );
+    QString includeDir = prefixedVariable( "headers.path", "/include" );
 
-    t << "prefix=" << libDir << endl;
+    t << "prefix=" << prefix << endl;
     t << "exec_prefix=${prefix}\n"
-      << "libdir=${exec_prefix}/lib\n"
-      << "includedir=${prefix}/include" << endl;
+      << "libdir=" << libDir << endl
+      << "includedir=" << includeDir << endl;
     // non-standard entry. Provides useful info normally only
     // contained in the internal .qmake.cache file
     t << varGlue("CONFIG", "qt_config=", " ", "") << endl << endl;
@@@@ -1499,7 +1530,7 @@@@ UnixMakefileGenerator::writePkgConfigFil
 	libs << "QMAKE_LIBS"; //obvious one
     if(project->isActiveConfig("thread"))
 	libs << "QMAKE_LFLAGS_THREAD"; //not sure about this one, but what about things like -pthread?
-    t << "Libs: -L" << libDir << " -l" << lname << " ";
+    t << "Libs: -L${libdir} -l" << var( "QMAKE_ORIG_TARGET" ) << " ";
     for(QStringList::ConstIterator it = libs.begin(); it != libs.end(); ++it)
 	t << project->variables()[(*it)].join(" ") << " ";
     t << endl;
@@@@ -1511,5 +1542,5 @@@@ UnixMakefileGenerator::writePkgConfigFil
       << varGlue("PRL_EXPORT_DEFINES","-D"," -D"," ")
       << project->variables()["PRL_EXPORT_CXXFLAGS"].join(" ")
 	//      << varGlue("DEFINES","-D"," -D"," ")
-      << " -I" << includeDir;
+      << " -I${includedir}" << endl;
 }
@


1.9
log
@Update to qt-3.1.2, move samples from qt to qt-mt, enable tablet support.
@
text
@d1 4
a4 4
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.8 2003/01/19 17:36:51 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Mon Feb 24 09:30:51 2003
+++ qmake/generators/unix/unixmake2.cpp	Sat Mar 22 17:57:45 2003
@@@@ -228,10 +228,14 @@@@ UnixMakefileGenerator::writeMakeParts(QT
d23 1
a23 1
@@@@ -1024,6 +1028,7 @@@@ void UnixMakefileGenerator::init2()
d31 1
a31 1
@@@@ -1044,10 +1049,19 @@@@ void UnixMakefileGenerator::init2()
d55 1
a55 1
@@@@ -1056,7 +1070,10 @@@@ void UnixMakefileGenerator::init2()
d67 56
@


1.8
log
@Synch some patches (line numbers)
Add fixes/speed-up from kde's qt-copy:
- let moc handle optional identifiers
- speed-up qt startup by looking up some settings at qapplication startup
(use one single qsettings object)
- some cursor/refresh bug.
@
text
@d1 3
a3 3
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.7 2002/11/23 18:52:22 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Mon Dec  9 10:41:04 2002
+++ qmake/generators/unix/unixmake2.cpp	Sun Jan 19 15:55:16 2003
d23 1
a23 1
@@@@ -1019,6 +1023,7 @@@@ void UnixMakefileGenerator::init2()
d31 1
a31 1
@@@@ -1039,10 +1044,19 @@@@ void UnixMakefileGenerator::init2()
d55 1
a55 1
@@@@ -1051,7 +1065,10 @@@@ void UnixMakefileGenerator::init2()
@


1.7
log
@Update to qt 3.1.0
@
text
@d1 4
a4 4
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.6 2002/10/26 11:45:52 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Thu Nov  7 14:07:46 2002
+++ qmake/generators/unix/unixmake2.cpp	Thu Nov 14 10:48:08 2002
@@@@ -219,10 +219,14 @@@@ UnixMakefileGenerator::writeMakeParts(QT
d23 1
a23 1
@@@@ -971,6 +975,7 @@@@ void UnixMakefileGenerator::init2()
d31 1
a31 1
@@@@ -991,10 +996,19 @@@@ void UnixMakefileGenerator::init2()
d55 1
a55 1
@@@@ -1003,7 +1017,10 @@@@ void UnixMakefileGenerator::init2()
@


1.6
log
@Update to 3.0.6 (maintenance release).
Add basic framework for qt-mt flavor (untested for real yet).
@
text
@d1 3
a3 3
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.5 2002/07/17 21:43:36 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Thu Oct 17 17:09:32 2002
+++ qmake/generators/unix/unixmake2.cpp	Thu Oct 24 12:15:28 2002
d7 1
a7 1
 	if(project->isEmpty("QMAKE_HPUX_SHLIBS")) {
d12 3
a14 3
+ 	    if (!project->isEmpty("QMAKE_OPENBSD_SHLIBS")) {
+ 		t << "TARGETD	= " << var("TARGET_x.y") << endl;
+	    } else {
d20 1
a20 2
 	}
 	else {
d22 2
a23 1
@@@@ -920,6 +924,7 @@@@ void UnixMakefileGenerator::init2()
d31 1
a31 1
@@@@ -940,10 +945,19 @@@@ void UnixMakefileGenerator::init2()
d55 1
a55 1
@@@@ -952,7 +966,10 @@@@ void UnixMakefileGenerator::init2()
@


1.5
log
@Update qt to 3.0.5.
Remove kde patches that have been integrated.
Independent rediscovery of a qt-copy patch (bogus lockfiles in RO directories)
and OpenBSD a.out fix.
@
text
@d1 4
a4 4
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.4 2002/03/28 11:47:18 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Mon Jul  8 12:27:37 2002
+++ qmake/generators/unix/unixmake2.cpp	Wed Jul 17 12:58:24 2002
@@@@ -220,10 +220,14 @@@@ UnixMakefileGenerator::writeMakeParts(QT
d7 1
a7 1
 	if(project->variables()["QMAKE_HPUX_SHLIBS"].isEmpty()) {
d12 2
a13 2
+	    if (!project->variables()["QMAKE_OPENBSD_SHLIBS"].isEmpty()) {
+		t << "TARGETD	= " << var("TARGET_x.y") << endl;
d23 1
a23 1
@@@@ -916,6 +920,7 @@@@ void UnixMakefileGenerator::init2()
d31 1
a31 1
@@@@ -936,10 +941,19 @@@@ void UnixMakefileGenerator::init2()
d55 1
a55 1
@@@@ -948,7 +962,10 @@@@ void UnixMakefileGenerator::init2()
d65 2
a66 2
 	project->variables()["QMAKE_LN_SHLIB"].append("-ln -s");
 	project->variables()["DESTDIR_TARGET"].append("$(TARGET)");
@


1.4
log
@qt3 programs need to link with -lICE -lSM.
Doesn't get you everytime, because qt3 checks for a session manager
before calling those functions.

Noticed by Jean-Yves Burlett.
@
text
@d1 4
a4 4
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.3 2002/03/06 10:53:13 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Mon Mar 18 10:45:59 2002
+++ qmake/generators/unix/unixmake2.cpp	Thu Mar 28 03:27:23 2002
@@@@ -218,10 +218,14 @@@@ UnixMakefileGenerator::writeMakeParts(QT
d23 13
a35 5
@@@@ -827,10 +831,6 @@@@ void UnixMakefileGenerator::init2()
 	    project->variables()["TARGET_x"].append("lib" + project->first("TARGET") + "." +
 						    project->first("QMAKE_EXTENSION_SHLIB") +
 						    "." + project->first("VER_MAJ"));
-	    project->variables()["TARGET_x.y"].append("lib" + project->first("TARGET") + "." +
d39 20
a58 7
 	    project->variables()["TARGET_x.y.z"].append("lib" + project->first("TARGET") +
 							"." +
 							project->variables()[
@@@@ -838,7 +838,22 @@@@ void UnixMakefileGenerator::init2()
 							project->first("VER_MAJ") + "." +
 							project->first("VER_MIN") +  "." +
 							project->first("VER_PAT"));
d60 1
a60 8
+	    if ( !project->variables()["QMAKE_OPENBSD_SHLIBS"].isEmpty() ) {
+		 	QString s;
+			s.setNum(project->first("VER_MIN").toInt()*10+
+				project->first("VER_PAT").toInt());
+		project->variables()["TARGET_x.y"].append("lib" + project->first("TARGET") + "." +
+						      project->first("QMAKE_EXTENSION_SHLIB")
+						      + "." + project->first("VER_MAJ") +
+						      "." + s );
d62 1
a62 5
+	    } else {
+			   project->variables()["TARGET_x.y"].append("lib" + project->first("TARGET") + "." +
+						      project->first("QMAKE_EXTENSION_SHLIB")
+						      + "." + project->first("VER_MAJ") +
+						      "." + project->first("VER_MIN"));
a63 1
+	    }
@


1.3
log
@Fix mess. Typos happen. Not checking that a `fixed' patch still work
should definitely NOT.
@
text
@d1 4
a4 4
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.2 2002/03/05 22:11:48 mark Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Mon Feb 18 13:46:23 2002
+++ qmake/generators/unix/unixmake2.cpp	Wed Mar  6 11:44:23 2002
@@@@ -190,10 +190,14 @@@@ UnixMakefileGenerator::writeMakeParts(QT
d23 1
a23 1
@@@@ -795,10 +799,6 @@@@ void UnixMakefileGenerator::init2()
d34 1
a34 1
@@@@ -806,7 +806,22 @@@@ void UnixMakefileGenerator::init2()
@


1.2
log
@s/QMAKE_OPENBSD_SHBLIS/QMAKE_OPENBSD_SHLIBS
@
text
@d1 1
a1 1
$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.1.1.1 2002/03/04 16:13:05 espie Exp $
d3 1
a3 1
+++ qmake/generators/unix/unixmake2.cpp	Tue Feb 26 18:48:36 2002
d12 1
a12 1
+	    if (project->variables()["QMAKE_OPENBSD_SHLIBS"].isEmpty()) {
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d12 1
a12 1
+	    if (project->variables()["QMAKE_OPENBSD_SHBLIS"].isEmpty()) {
@


1.1.1.1
log
@Initial port of qt3.

Most notable improvement seems to be font-handling, especially unicode stuff.

Configured to relocate plugins at a reasonable place. Includes *sql
plugins, though they are thoroughly untested at the moment.

Works good enough to recompile xglobe for instance. Still work to do
though, some paths are probably incorrect yet.
@
text
@@
