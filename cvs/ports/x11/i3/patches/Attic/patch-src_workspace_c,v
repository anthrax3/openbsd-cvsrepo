head	1.16;
access;
symbols
	OPENBSD_5_9:1.15.0.2
	OPENBSD_5_9_BASE:1.15
	OPENBSD_5_4:1.11.0.2
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_2:1.6.0.2
	OPENBSD_5_2_BASE:1.6
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.16
date	2016.03.09.09.25.51;	author dcoppa;	state dead;
branches;
next	1.15;
commitid	5e0lb25PYzcoURwg;

1.15
date	2015.12.18.15.53.09;	author dcoppa;	state Exp;
branches;
next	1.14;
commitid	0OqseA58UoyREWdQ;

1.14
date	2014.01.22.13.48.38;	author dcoppa;	state dead;
branches;
next	1.13;

1.13
date	2014.01.19.10.25.30;	author dcoppa;	state Exp;
branches;
next	1.12;

1.12
date	2013.08.13.10.01.58;	author dcoppa;	state dead;
branches;
next	1.11;

1.11
date	2013.07.01.13.42.25;	author dcoppa;	state Exp;
branches;
next	1.10;

1.10
date	2012.12.13.12.10.14;	author dcoppa;	state dead;
branches;
next	1.9;

1.9
date	2012.11.13.08.44.02;	author dcoppa;	state Exp;
branches;
next	1.8;

1.8
date	2012.10.04.12.21.38;	author dcoppa;	state Exp;
branches;
next	1.7;

1.7
date	2012.09.21.17.16.14;	author dcoppa;	state dead;
branches;
next	1.6;

1.6
date	2012.05.28.13.37.50;	author dcoppa;	state Exp;
branches;
next	1.5;

1.5
date	2011.12.27.09.05.17;	author dcoppa;	state dead;
branches;
next	1.4;

1.4
date	2011.12.01.16.00.01;	author dcoppa;	state Exp;
branches;
next	1.3;

1.3
date	2011.11.06.20.23.25;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2011.03.14.12.55.18;	author dcoppa;	state dead;
branches;
next	1.1;

1.1
date	2011.01.05.12.45.04;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.16
log
@
Update to i3-4.12
Added halex@@'s window hints fix
Fixed trailing whitespace in pkg/DESCR (spotted by Josh Grosse)

Tested by tb@@ and Josh Grosse
OK tb@@
@
text
@$OpenBSD: patch-src_workspace_c,v 1.15 2015/12/18 15:53:09 dcoppa Exp $

Turn "char *" into "const char *" for all command parser functions.

--- src/workspace.c.orig	Wed Sep 30 08:55:10 2015
+++ src/workspace.c	Fri Dec 18 13:58:58 2015
@@@@ -918,7 +918,7 @@@@ Con *workspace_encapsulate(Con *ws) {
  * Move the given workspace to the specified output.
  * This returns true if and only if moving the workspace was successful.
  */
-bool workspace_move_to_output(Con *ws, char *name) {
+bool workspace_move_to_output(Con *ws, const char *name) {
     LOG("Trying to move workspace %p / %s to output \"%s\".\n", ws, ws->name, name);
 
     Con *current_output_con = con_get_output(ws);
@


1.15
log
@
Merge all the fixes from the git stable branch of i3
Regen WANTLIB while here
@
text
@d1 1
a1 1
$OpenBSD$
@


1.14
log
@Bugfix update to i3-4.7.1
@
text
@d1 1
a1 1
$OpenBSD: patch-src_workspace_c,v 1.13 2014/01/19 10:25:30 dcoppa Exp $
d3 1
a3 3
commit 76393377160ffd043757ca2dd8d947aa25f69716
Author: Tony Crisci <tony@@dubstepdish.com>
Date:   Mon Jan 13 15:36:11 2014 -0500
d5 5
a9 12
Bugfix: `move <direction>` sends workspace focus

Make sure the command `move <direction>` properly sends the workspace
focus ipc event required for i3bar to be properly updated and redrawn.

Make `ipc_send_workspace_focus_event publicly available from ipc.h for
more flexible event sending.

--- src/workspace.c.orig	Sun Dec 22 21:12:41 2013
+++ src/workspace.c	Sat Jan 18 23:05:20 2014
@@@@ -11,10 +11,7 @@@@
  *
d11 3
a13 46
 #include "all.h"
-#include "yajl_utils.h"
 
-#include <yajl/yajl_gen.h>
-
 /* Stores a copy of the name of the last used workspace for the workspace
  * back-and-forth switching. */
 static char *previous_workspace_name = NULL;
@@@@ -333,39 +330,6 @@@@ static void workspace_defer_update_urgent_hint_cb(EV_P
 
     ev_timer_stop(main_loop, con->urgency_timer);
     FREE(con->urgency_timer);
-}
-
-/*
- * For the "focus" event we send, along the usual "change" field, also the
- * current and previous workspace, in "current" and "old" respectively.
- */
-static void ipc_send_workspace_focus_event(Con *current, Con *old) {
-    setlocale(LC_NUMERIC, "C");
-    yajl_gen gen = ygenalloc();
-
-    y(map_open);
-
-    ystr("change");
-    ystr("focus");
-
-    ystr("current");
-    dump_node(gen, current, false);
-
-    ystr("old");
-    if (old == NULL)
-        y(null);
-    else
-        dump_node(gen, old, false);
-
-    y(map_close);
-
-    const unsigned char *payload;
-    ylength length;
-    y(get_buf, &payload, &length);
-
-    ipc_send_event("workspace", I3_IPC_EVENT_WORKSPACE, (const char *)payload);
-    y(free);
-    setlocale(LC_NUMERIC, "");
 }
d15 1
a15 1
 static void _workspace_show(Con *workspace) {
@


1.13
log
@
i3bar Bugfix: don't show "EOF" status line error
(upstream git commit 612d25c12cd1bd9ff4167e8530fe9a2c54a619e4)

Bugfix: `move <direction>` sends workspace focus
(upstream git commit 76393377160ffd043757ca2dd8d947aa25f69716)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.12
log
@Update to i3-4.6

ok tobiasu@@, abieber@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_workspace_c,v 1.11 2013/07/01 13:42:25 dcoppa Exp $
d3 3
a5 3
commit 625d5bdba6318377baa716ad5ea5a0b2f85b1c0e
Author: Eika Enge <eika-enge@@outlook.com>
Date:   Sun May 26 18:24:55 2013 +0700
d7 1
a7 1
Bugfix: Ignore spaces in front of default workspace name
d9 59
a67 11
--- src/workspace.c.orig	Mon Jul  1 15:27:18 2013
+++ src/workspace.c	Mon Jul  1 15:27:55 2013
@@@@ -128,6 +128,8 @@@@ Con *create_workspace_on_output(Output *output, Con *c
             continue;
         DLOG("relevant command = %s\n", bind->command);
         char *target = bind->command + strlen("workspace ");
+        while((*target == ' ' || *target == '\t') && target != '\0')
+            target++;
         /* We check if this is the workspace
          * next/prev/next_on_output/prev_on_output/back_and_forth/number command.
          * Beware: The workspace names "next", "prev", "next_on_output",
@


1.11
log
@Some bugfixes from upstream:

i3-nagbar: Bugfix: -m requires an argument (crashes if none specified)
(upstream git commit 4765427f219c306f0872f124d0b1e2398bf8e39f)

i3-nagbar: call i3-nagbar correctly for configfiles without the font directive
(upstream git commit e8759691b8fdac7f964626c357dd6512a698ea2f)

Bugfix: fix focus handling in 'floating disable' on non-visible windows
(upstream git commit b4f7142509e3af51504a1e72163d544d305f0fa8)

Bugfix: Ignore spaces in front of default workspace name
(upstream git commit 625d5bdba6318377baa716ad5ea5a0b2f85b1c0e)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.10
log
@Update to i3-4.4
@
text
@d1 1
a1 1
$OpenBSD: patch-src_workspace_c,v 1.9 2012/11/13 08:44:02 dcoppa Exp $
d3 3
a5 5
From 507898484f2d4ccf7e1077cf8881d4655745ac8c Mon Sep 17 00:00:00 2001
From: Sascha Kruse <knopwob@@googlemail.com>
Date: Wed, 03 Oct 2012 01:52:57 +0000
Subject: set workspace_layout in create_workspace_on_output
Otherwise i3 doesn't respect the workspace_layout setting.
d7 1
a7 4
From 81393c93c2810e098966fe4089f3c8ea09f9cbe6 Mon Sep 17 00:00:00 2001
From: Michael Stapelberg <michael@@stapelberg.de>
Date: Sat, 10 Nov 2012 08:01:04 +0000
Subject: bugfix: fix workspace back_and_forth after displaying a scratchpad window
d9 11
a19 32
--- src/workspace.c.orig	Wed Sep 19 18:08:09 2012
+++ src/workspace.c	Tue Nov 13 08:56:30 2012
@@@@ -212,6 +212,7 @@@@ Con *create_workspace_on_output(Output *output, Con *c
 
     ws->fullscreen_mode = CF_OUTPUT;
 
+    ws->workspace_layout = config.default_layout;
     _workspace_apply_default_orientation(ws);
 
     return ws;
@@@@ -339,11 +340,16 @@@@ static void _workspace_show(Con *workspace) {
     /* Remember currently focused workspace for switching back to it later with
      * the 'workspace back_and_forth' command.
      * NOTE: We have to duplicate the name as the original will be freed when
-     * the corresponding workspace is cleaned up. */
-
-    FREE(previous_workspace_name);
-    if (current)
-        previous_workspace_name = sstrdup(current->name);
+     * the corresponding workspace is cleaned up.
+     * NOTE: Internal cons such as __i3_scratch (when a scratchpad window is
+     * focused) are skipped, see bug #868. */
+    if (current && !(current->name[0] == '_' && current->name[1] == '_')) {
+        FREE(previous_workspace_name);
+        if (current) {
+            previous_workspace_name = sstrdup(current->name);
+            DLOG("Setting previous_workspace_name = %s\n", previous_workspace_name);
+        }
+    }
 
     workspace_reassign_sticky(workspace);
 
@


1.9
log
@Bugfix: fix workspace back_and_forth after displaying a scratchpad
window (upstream git commit 81393c93c2810e098966fe4089f3c8ea09f9cbe6)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_workspace_c,v 1.8 2012/10/04 12:21:38 dcoppa Exp $
@


1.8
log
@Set workspace_layout in create_workspace_on_output: otherwise i3
doesn't respect the workspace_layout setting.

From upstream git
@
text
@d1 1
a1 1
$OpenBSD$
d7 1
d9 4
a12 1
Otherwise i3 doesn't respect the workspace_layout setting.
d14 2
a15 2
--- src/workspace.c.orig	Thu Oct  4 11:52:49 2012
+++ src/workspace.c	Thu Oct  4 11:57:33 2012
d24 22
@


1.7
log
@Update to i3-4.3

OK jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_workspace_c,v 1.6 2012/05/28 13:37:50 dcoppa Exp $
d3 4
a6 4
From ec4e6d1cdf5b76c79da2879635e4094e25a01f3d Mon Sep 17 00:00:00 2001
From: Michael Stapelberg <michael@@stapelberg.de>
Date: Wed, 16 May 2012 04:24:16 +0000
Subject: Fix stray workspaces "number 1" being created when having workspace number 1 in your config
d8 12
a19 21
--- src/workspace.c.orig	Wed Apr 25 23:21:25 2012
+++ src/workspace.c	Mon May 28 13:59:35 2012
@@@@ -112,14 +112,15 @@@@ Con *create_workspace_on_output(Output *output, Con *c
         DLOG("relevant command = %s\n", bind->command);
         char *target = bind->command + strlen("workspace ");
         /* We check if this is the workspace
-         * next/prev/next_on_output/prev_on_output/back_and_forth command.
+         * next/prev/next_on_output/prev_on_output/back_and_forth/number command.
          * Beware: The workspace names "next", "prev", "next_on_output",
-         * "prev_on_output" and "back_and_forth" are OK, so we check before
-         * stripping the double quotes */
+         * "prev_on_output", "number" and "back_and_forth" are OK, so we check
+         * before stripping the double quotes */
         if (strncasecmp(target, "next", strlen("next")) == 0 ||
             strncasecmp(target, "prev", strlen("prev")) == 0 ||
             strncasecmp(target, "next_on_output", strlen("next_on_output")) == 0 ||
             strncasecmp(target, "prev_on_output", strlen("prev_on_output")) == 0 ||
+            strncasecmp(target, "number", strlen("number")) == 0 ||
             strncasecmp(target, "back_and_forth", strlen("back_and_forth")) == 0)
             continue;
         if (*target == '"')
@


1.6
log
@
Bugfix: less differentiation between named and numbered workspaces
(upstream git commit b88ab981fd0a5725ed886a9f9788a5b1e721534c)

Bugfix: fix stray workspaces "number 1" being created when having
workspace number 1 in your config (upstream git commit
ec4e6d1cdf5b76c79da2879635e4094e25a01f3d)

Fix for i3bar: don't wrap when changing workspaces by mouse wheel
scrolling (upstream git commit 4f93e0587a849de00a1f50bfcd48a549009178c0)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.5
log
@Bugfixing update to i3-4.1.1
@
text
@d1 1
a1 1
$OpenBSD: patch-src_workspace_c,v 1.4 2011/12/01 16:00:01 dcoppa Exp $
d3 4
a6 3
Do not set the _NET_WM_WORKAREA hint: fix incorrect transient
geometry with wxwidgets
(upstream git commit d25e77ce7597bf0736c610a04185c8c27694c890)
d8 21
a28 11
--- src/workspace.c.orig	Fri Nov 11 23:41:20 2011
+++ src/workspace.c	Thu Dec  1 14:07:37 2011
@@@@ -240,8 +240,6 @@@@ static void _workspace_show(Con *workspace, bool chang
     }
 
     /* Update the EWMH hints */
-    if (changed_num_workspaces)
-        ewmh_update_workarea();
     ewmh_update_current_desktop();
 
     ipc_send_event("workspace", I3_IPC_EVENT_WORKSPACE, "{\"change\":\"focus\"}");
@


1.4
log
@Major update to i3-4.1
@
text
@d1 1
a1 1
$OpenBSD: patch-src_workspace_c,v 1.3 2011/11/06 20:23:25 dcoppa Exp $
@


1.3
log
@Update to i3-4.0.2 (plus patches from upstream git).
i3bar is now part of i3 itself and i3-wsbar is gone.
@
text
@d1 1
a1 1
$OpenBSD$
d3 3
a5 2
bugfix: correctly revert focus to other floating windows when closing
a floating window (git commit 4dbda7311480c231332a9dab9ed23d00abecb7e9)
d7 11
a17 11
--- src/workspace.c.orig	Sun Aug 28 19:48:13 2011
+++ src/workspace.c	Mon Oct 31 12:44:02 2011
@@@@ -211,7 +211,7 @@@@ void workspace_show(const char *num) {
         /* check if this workspace is currently visible */
         if (!workspace_is_visible(old)) {
             LOG("Closing old workspace (%p / %s), it is empty\n", old, old->name);
-            tree_close(old, DONT_KILL_WINDOW, false);
+            tree_close(old, DONT_KILL_WINDOW, false, false);
             ipc_send_event("workspace", I3_IPC_EVENT_WORKSPACE, "{\"change\":\"empty\"}");
             changed_num_workspaces = true;
         }
@


1.2
log
@Update to i3-3.e-bf2 (aka i3-3.5.2)
@
text
@d1 16
a16 11
$OpenBSD: patch-src_workspace_c,v 1.1 2011/01/05 12:45:04 dcoppa Exp $
--- src/workspace.c.orig	Wed Jan  5 13:03:23 2011
+++ src/workspace.c	Wed Jan  5 13:04:42 2011
@@@@ -112,7 +112,6 @@@@ bool workspace_is_visible(Workspace *ws) {
  */
 void workspace_show(xcb_connection_t *conn, int workspace) {
         bool need_warp = false;
-        xcb_window_t root = xcb_setup_roots_iterator(xcb_get_setup(conn)).data->root;
         /* t_ws (to workspace) is just a convenience pointer to the workspace we’re switching to */
         Workspace *t_ws = workspace_get(workspace-1);
 
@


1.1
log
@Various bugfixes for fullscreen windows, xcb, xinerama, and configfile
parsing.
All from upstream git.
@
text
@d1 1
a1 1
$OpenBSD$
@

