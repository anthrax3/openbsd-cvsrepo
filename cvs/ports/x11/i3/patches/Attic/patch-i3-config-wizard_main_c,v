head	1.9;
access;
symbols
	OPENBSD_5_2:1.5.0.2
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.2;
locks; strict;
comment	@# @;


1.9
date	2014.01.22.13.48.38;	author dcoppa;	state dead;
branches;
next	1.8;

1.8
date	2014.01.11.16.04.43;	author dcoppa;	state Exp;
branches;
next	1.7;

1.7
date	2012.12.13.12.10.13;	author dcoppa;	state dead;
branches;
next	1.6;

1.6
date	2012.12.08.21.41.47;	author dcoppa;	state Exp;
branches;
next	1.5;

1.5
date	2012.05.09.11.56.49;	author dcoppa;	state Exp;
branches;
next	1.4;

1.4
date	2012.03.22.09.53.50;	author dcoppa;	state Exp;
branches;
next	1.3;

1.3
date	2012.02.21.14.05.39;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2011.12.01.16.00.01;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2011.11.06.20.23.25;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Bugfix update to i3-4.7.1
@
text
@$OpenBSD: patch-i3-config-wizard_main_c,v 1.8 2014/01/11 16:04:43 dcoppa Exp $

commit 0883dfbe14628430caaeefdb00e282a008d30d76
Author: Michael Stapelberg <michael@@stapelberg.de>
Date:   Tue Dec 24 10:35:56 2013 +0100

only LOG() the DPI when it changes, DLOG() it otherwise

This avoids flooding stdout every time some text (e.g. a window
decoration) is drawn, yet leaves the message in place when it's actually
relevant (upon DPI changes).

--- i3-config-wizard/main.c.orig	Sun Dec 22 21:12:41 2013
+++ i3-config-wizard/main.c	Fri Jan 10 21:41:56 2014
@@@@ -420,7 +420,7 @@@@ static char *rewrite_binding(const char *input) {
 
 
 /*
- * Having verboselog() and errorlog() is necessary when using libi3.
+ * Having verboselog(), errorlog() and debuglog() is necessary when using libi3.
  *
  */
 void verboselog(char *fmt, ...) {
@@@@ -437,6 +437,9 @@@@ void errorlog(char *fmt, ...) {
     va_start(args, fmt);
     vfprintf(stderr, fmt, args);
     va_end(args);
+}
+
+void debuglog(char *fmt, ...) {
 }
 
 /*
@


1.8
log
@Update to i3-4.7
@
text
@d1 1
a1 1
$OpenBSD$
@


1.7
log
@Update to i3-4.4
@
text
@d1 1
a1 1
$OpenBSD: patch-i3-config-wizard_main_c,v 1.6 2012/12/08 21:41:47 dcoppa Exp $
d3 3
a5 4
From 69e15bba5df807809a91baec08bc45b193ab8e85 Mon Sep 17 00:00:00 2001
From: David Coppa <dcoppa@@gmail.com>
Date: Thu, 06 Dec 2012 11:30:14 +0000
Subject: OpenBSD has getline() now
d7 25
a31 4
--- i3-config-wizard/main.c.orig	Tue May  8 16:42:21 2012
+++ i3-config-wizard/main.c	Tue May  8 16:42:37 2012
@@@@ -13,7 +13,7 @@@@
 #endif
d33 1
a33 6
 /* For systems without getline, fall back to fgetln */
-#if defined(__APPLE__) || (defined(__FreeBSD__) && __FreeBSD_version < 800000) || defined(__OpenBSD__)
+#if defined(__APPLE__) || (defined(__FreeBSD__) && __FreeBSD_version < 800000)
 #define USE_FGETLN
 #elif defined(__FreeBSD__)
 /* Defining this macro before including stdio.h is necessary in order to have
@


1.6
log
@Change comment (patch committed upstream)
@
text
@d1 1
a1 1
$OpenBSD: patch-i3-config-wizard_main_c,v 1.5 2012/05/09 11:56:49 dcoppa Exp $
@


1.5
log
@Update to i3-4.2

OK jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-i3-config-wizard_main_c,v 1.4 2012/03/22 09:53:50 dcoppa Exp $
d3 4
a6 1
We have getline(3) now
@


1.4
log
@We have getline(3) now.
@
text
@d1 1
a1 1
$OpenBSD: patch-i3-config-wizard_main_c,v 1.3 2012/02/21 14:05:39 dcoppa Exp $
d3 1
a3 2
Bugfix: fix a memory leak
(upstream git commit b3e3ecf722abc6540a5a975a4e643c7d207d356f)
d5 3
a7 21
Bugfix: keep the indentation of config.keycodes
(upstream git commit 4f148501736d9b58c6ba113af2df82e1c7e3decb)

--- i3-config-wizard/main.c.orig	Fri Jan 27 20:24:09 2012
+++ i3-config-wizard/main.c	Thu Mar 22 10:10:20 2012
@@@@ -280,6 +280,7 @@@@ static void finish() {
     FILE *ks_config = fopen(config_path, "w");
     if (ks_config == NULL)
         err(1, "Could not open output config file \"%s\"", config_path);
+    free(config_path);
 
     char *line = NULL;
     size_t len = 0;
@@@@ -299,7 +300,9 @@@@ static void finish() {
 #if defined(__APPLE__)
     while ((line = fgetln(kc_config, &len)) != NULL) {
 #else
-    while ((read = getline(&line, &len, kc_config)) != -1) {
+    size_t linecap = 0;
+    while ((read = getline(&line, &linecap, kc_config)) != -1) {
+        len = strlen(line);
a8 12
         /* skip the warning block at the beginning of the input file */
         if (head_of_file &&
@@@@ -310,8 +313,11 @@@@ static void finish() {
 
         /* Skip leading whitespace */
         char *walk = line;
-        while (isspace(*walk) && walk < (line + len))
+        while (isspace(*walk) && walk < (line + len)) {
+            /* Pre-output the skipped whitespaces to keep proper indentation */
+            fputc(*walk, ks_config);
             walk++;
+        }
d10 6
a15 11
         /* Set the modifier the user chose */
         if (strncmp(walk, "set $mod ", strlen("set $mod ")) == 0) {
@@@@ -324,7 +330,7 @@@@ static void finish() {
         /* Check for 'bindcode'. If itâ€™s not a bindcode line, we
          * just copy it to the output file */
         if (strncmp(walk, "bindcode", strlen("bindcode")) != 0) {
-            fputs(line, ks_config);
+            fputs(walk, ks_config);
             continue;
         }
         char *result = rewrite_binding(walk);
@


1.3
log
@Update to i3-4.1.2
@
text
@d1 1
a1 4
$OpenBSD: patch-i3-config-wizard_main_c,v 1.2 2011/12/01 16:00:01 dcoppa Exp $

Bugfix: for systems without getline, fall back to fgetln
(upstream git commit 891831be3a751ce7700099e3de5048ab50a2867b)
d9 3
a11 23
--- i3-config-wizard/main.c.orig	Tue Feb 21 14:26:26 2012
+++ i3-config-wizard/main.c	Tue Feb 21 14:32:20 2012
@@@@ -8,6 +8,19 @@@@
  *                   keysyms.
  *
  */
+#if defined(__FreeBSD__)
+#include <sys/param.h>
+#endif
+
+/* For systems without getline, fall back to fgetln */
+#if defined(__APPLE__) || (defined(__FreeBSD__) && __FreeBSD_version < 800000) || defined(__OpenBSD__)
+#define USE_FGETLN
+#elif defined(__FreeBSD__)
+/* Defining this macro before including stdio.h is necessary in order to have
+ * a prototype for getline in FreeBSD. */
+#define _WITH_GETLINE
+#endif
+
 #include <ev.h>
 #include <stdio.h>
 #include <sys/types.h>
@@@@ -280,10 +293,11 @@@@ static void finish() {
d19 3
a21 17
-#if !defined(__APPLE__)
+#ifndef USE_FGETLN
     ssize_t read;
 #endif
     bool head_of_file = true;
@@@@ -296,10 +310,16 @@@@ static void finish() {
     fputs("# this file and re-run i3-config-wizard(1).\n", ks_config);
     fputs("#\n", ks_config);
 
-#if defined(__APPLE__)
-    while ((line = fgetln(kc_config, &len)) != NULL) {
+#ifdef USE_FGETLN
+    char *buf = NULL;
+    while ((buf = fgetln(kc_config, &len)) != NULL) {
+        /* fgetln does not return null-terminated strings */
+        FREE(line);
+        sasprintf(&line, "%.*s", len, buf);
d30 1
a30 1
@@@@ -310,8 +330,10 @@@@ static void finish() {
d37 1
d43 1
a43 1
@@@@ -324,7 +346,7 @@@@ static void finish() {
a51 11
@@@@ -336,7 +358,10 @@@@ static void finish() {
     fflush(ks_config);
     fsync(fileno(ks_config));
 
+#ifndef USE_FGETLN
     free(line);
+#endif
+
     fclose(kc_config);
     fclose(ks_config);
 
@


1.2
log
@Major update to i3-4.1
@
text
@d1 1
a1 1
$OpenBSD: patch-i3-config-wizard_main_c,v 1.1 2011/11/06 20:23:25 dcoppa Exp $
d3 2
a4 1
getline() is a GNU extension
d6 42
a47 3
--- i3-config-wizard/main.c.orig	Fri Nov 11 23:41:20 2011
+++ i3-config-wizard/main.c	Wed Nov 30 15:44:09 2011
@@@@ -296,6 +296,47 @@@@ static void finish() {
d51 43
a93 39
+#if defined(__OpenBSD__)
+
+ssize_t
+getline(char ** __restrict buf, size_t * __restrict buflen,
+    FILE * __restrict fp)
+{
+	size_t bytes, newlen;
+	char *newbuf, *p;
+	
+	if (buf == NULL || buflen == NULL) {
+		errno = EINVAL;
+		return -1;
+	}
+	if (*buf == NULL)
+		*buflen = 0;
+	
+	bytes = 0;
+	do {
+		if (feof(fp))
+			break;
+		if (*buf == NULL || bytes != 0) {
+			newlen = *buflen + BUFSIZ;
+			newbuf = realloc(*buf, newlen);
+			if (newbuf == NULL)
+				return -1;
+			*buf = newbuf;
+			*buflen = newlen;
+		}
+		p = *buf + bytes;
+		memset(p, 0, BUFSIZ);
+		if (fgets(p, BUFSIZ, fp) == NULL)
+			break;
+		bytes += strlen(p);
+	} while (bytes == 0 || *(*buf + (bytes - 1)) != '\n');
+	if (bytes == 0)
+		return -1;
+	return bytes;
+}
+
d96 3
a98 3
 #if defined(__APPLE__)
     while ((line = fgetln(kc_config, &len)) != NULL) {
 #else
@


1.1
log
@Update to i3-4.0.2 (plus patches from upstream git).
i3bar is now part of i3 itself and i3-wsbar is gone.
@
text
@d1 1
a1 1
$OpenBSD$
d5 5
a9 5
--- i3-config-wizard/main.c.orig	Wed Sep 14 12:16:22 2011
+++ i3-config-wizard/main.c	Wed Sep 14 12:22:41 2011
@@@@ -74,6 +74,47 @@@@ Display *dpy;
 char *rewrite_binding(const char *bindingline);
 static void finish();
d53 2
a54 2
 
 /*
@

