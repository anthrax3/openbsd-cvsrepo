head	1.10;
access;
symbols
	OPENBSD_6_1:1.10.0.2
	OPENBSD_6_1_BASE:1.10
	OPENBSD_6_0:1.9.0.2
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.8.0.2
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.6.0.4
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.4.0.4
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.2
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.3.0.2
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.2.0.2
	OPENBSD_5_4_BASE:1.2;
locks; strict;
comment	@# @;


1.10
date	2016.11.13.20.46.23;	author dcoppa;	state Exp;
branches;
next	1.9;
commitid	YWcsP0rJp2QqdVhK;

1.9
date	2016.03.09.09.25.51;	author dcoppa;	state Exp;
branches;
next	1.8;
commitid	5e0lb25PYzcoURwg;

1.8
date	2015.12.18.15.53.09;	author dcoppa;	state Exp;
branches;
next	1.7;
commitid	0OqseA58UoyREWdQ;

1.7
date	2015.10.04.08.48.12;	author dcoppa;	state Exp;
branches;
next	1.6;
commitid	VRvZAaOZt8xtMVjt;

1.6
date	2015.03.30.12.33.46;	author dcoppa;	state Exp;
branches;
next	1.5;
commitid	iVyfQtDXLWKbSbnJ;

1.5
date	2015.03.17.15.39.48;	author dcoppa;	state Exp;
branches;
next	1.4;
commitid	WQl7M1uD6B2NjHh4;

1.4
date	2014.07.11.15.49.58;	author dcoppa;	state Exp;
branches;
next	1.3;
commitid	dpkYaZL7eWFGPiTd;

1.3
date	2013.08.13.10.01.56;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2013.07.01.13.42.25;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2013.05.16.18.42.30;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.10
log
@
Update to i3-4.13

OK tb@@, jasper@@
@
text
@$OpenBSD: patch-src_config_parser_c,v 1.9 2016/03/09 09:25:51 dcoppa Exp $
--- src/config_parser.c.orig	Tue Nov  8 19:54:01 2016
+++ src/config_parser.c	Thu Nov 10 18:04:35 2016
@@@@ -789,8 +789,8 @@@@ static char *migrate_config(char *input, off_t size) {
  */
 void start_config_error_nagbar(const char *configpath, bool has_errors) {
     char *editaction, *pageraction;
-    sasprintf(&editaction, "i3-sensible-editor \"%s\" && i3-msg reload\n", configpath);
-    sasprintf(&pageraction, "i3-sensible-pager \"%s\"\n", errorfilename);
+    sasprintf(&editaction, "/usr/bin/vi \"%s\" && i3-msg reload\n", configpath);
+    sasprintf(&pageraction, "/usr/bin/less \"%s\"\n", errorfilename);
     char *argv[] = {
         NULL, /* will be replaced by the executable path */
         "-f",
@


1.9
log
@
Update to i3-4.12
Added halex@@'s window hints fix
Fixed trailing whitespace in pkg/DESCR (spotted by Josh Grosse)

Tested by tb@@ and Josh Grosse
OK tb@@
@
text
@d1 4
a4 4
$OpenBSD: patch-src_config_parser_c,v 1.8 2015/12/18 15:53:09 dcoppa Exp $
--- src/config_parser.c.orig	Mon Mar  7 15:15:54 2016
+++ src/config_parser.c	Mon Mar  7 15:16:45 2016
@@@@ -788,8 +788,8 @@@@ static char *migrate_config(char *input, off_t size) {
@


1.8
log
@
Merge all the fixes from the git stable branch of i3
Regen WANTLIB while here
@
text
@d1 14
a14 90
$OpenBSD: patch-src_config_parser_c,v 1.7 2015/10/04 08:48:12 dcoppa Exp $

Allow the commands parser to use "number" arguments by making the stack typed.

--- src/config_parser.c.orig	Wed Sep 30 08:55:10 2015
+++ src/config_parser.c	Fri Dec 18 13:58:58 2015
@@@@ -122,7 +122,7 @@@@ static void push_string(const char *identifier, const 
     /* When we arrive here, the stack is full. This should not happen and
      * means there’s either a bug in this parser or the specification
      * contains a command with more than 10 identified tokens. */
-    fprintf(stderr, "BUG: commands_parser stack full. This means either a bug "
+    fprintf(stderr, "BUG: config_parser stack full. This means either a bug "
                     "in the code, or a new command which contains more than "
                     "10 identified tokens.\n");
     exit(1);
@@@@ -142,7 +142,7 @@@@ static void push_long(const char *identifier, long num
     /* When we arrive here, the stack is full. This should not happen and
      * means there’s either a bug in this parser or the specification
      * contains a command with more than 10 identified tokens. */
-    fprintf(stderr, "BUG: commands_parser stack full. This means either a bug "
+    fprintf(stderr, "BUG: config_parser stack full. This means either a bug "
                     "in the code, or a new command which contains more than "
                     "10 identified tokens.\n");
     exit(1);
@@@@ -178,54 +178,7 @@@@ static void clear_stack(void) {
     }
 }
 
-// TODO: remove this if it turns out we don’t need it for testing.
-#if 0
 /*******************************************************************************
- * A dynamically growing linked list which holds the criteria for the current
- * command.
- ******************************************************************************/
-
-typedef struct criterion {
-    char *type;
-    char *value;
-
-    TAILQ_ENTRY(criterion) criteria;
-} criterion;
-
-static TAILQ_HEAD(criteria_head, criterion) criteria =
-  TAILQ_HEAD_INITIALIZER(criteria);
-
-/*
- * Stores the given type/value in the list of criteria.
- * Accepts a pointer as first argument, since it is 'call'ed by the parser.
- *
- */
-static void push_criterion(void *unused_criteria, const char *type,
-                           const char *value) {
-    struct criterion *criterion = smalloc(sizeof(struct criterion));
-    criterion->type = sstrdup(type);
-    criterion->value = sstrdup(value);
-    TAILQ_INSERT_TAIL(&criteria, criterion, criteria);
-}
-
-/*
- * Clears the criteria linked list.
- * Accepts a pointer as first argument, since it is 'call'ed by the parser.
- *
- */
-static void clear_criteria(void *unused_criteria) {
-    struct criterion *criterion;
-    while (!TAILQ_EMPTY(&criteria)) {
-        criterion = TAILQ_FIRST(&criteria);
-        free(criterion->type);
-        free(criterion->value);
-        TAILQ_REMOVE(&criteria, criterion, criteria);
-        free(criterion);
-    }
-}
-#endif
-
-/*******************************************************************************
  * The parser itself.
  ******************************************************************************/
 
@@@@ -1007,8 +960,8 @@@@ bool parse_file(const char *f, bool use_nagbar) {
 
         char *editaction,
             *pageraction;
-        sasprintf(&editaction, "i3-sensible-editor \"%s\" && i3-msg reload\n", f);
-        sasprintf(&pageraction, "i3-sensible-pager \"%s\"\n", errorfilename);
+        sasprintf(&editaction, "/usr/bin/vi \"%s\" && i3-msg reload\n", f);
+        sasprintf(&pageraction, "/usr/bin/less \"%s\"\n", errorfilename);
         char *argv[] = {
             NULL, /* will be replaced by the executable path */
             "-f",
@


1.7
log
@
Update to i3-4.11
@
text
@d1 4
a4 1
$OpenBSD: patch-src_config_parser_c,v 1.6 2015/03/30 12:33:46 dcoppa Exp $
d6 75
a80 2
+++ src/config_parser.c	Fri Oct  2 16:58:54 2015
@@@@ -1007,8 +1007,8 @@@@ bool parse_file(const char *f, bool use_nagbar) {
@


1.6
log
@
Update to i3-4.10.1
@
text
@d1 4
a4 4
$OpenBSD: patch-src_config_parser_c,v 1.5 2015/03/17 15:39:48 dcoppa Exp $
--- src/config_parser.c.orig	Sun Mar 29 19:07:08 2015
+++ src/config_parser.c	Mon Mar 30 14:13:25 2015
@@@@ -1002,8 +1002,8 @@@@ bool parse_file(const char *f, bool use_nagbar) {
@


1.5
log
@
Update to i3-4.9.1

new dependency on x11/xkbcommon
@
text
@d1 4
a4 4
$OpenBSD: patch-src_config_parser_c,v 1.4 2014/07/11 15:49:58 dcoppa Exp $
--- src/config_parser.c.orig	Wed Feb 25 01:50:09 2015
+++ src/config_parser.c	Wed Feb 25 02:16:28 2015
@@@@ -1007,8 +1007,8 @@@@ bool parse_file(const char *f, bool use_nagbar) {
@


1.4
log
@
Update to i3-4.8 plus fixes.

Initial diff by Theo Buehler <theo AT math DOT ethz DOT ch>
@
text
@d1 4
a4 4
$OpenBSD: patch-src_config_parser_c,v 1.3 2013/08/13 10:01:56 dcoppa Exp $
--- src/config_parser.c.orig	Sun Jun 15 19:12:43 2014 
+++ src/config_parser.c		Wed Jul  2 19:05:29 2014 
@@@@ -1007,8 +1007,8 @@@@ void parse_file(const char *f) {
@


1.3
log
@Update to i3-4.6

ok tobiasu@@, abieber@@
@
text
@d1 4
a4 4
$OpenBSD: patch-src_config_parser_c,v 1.2 2013/07/01 13:42:25 dcoppa Exp $
--- src/config_parser.c.orig	Mon Aug 12 16:02:01 2013
+++ src/config_parser.c	Mon Aug 12 16:03:05 2013
@@@@ -1065,8 +1065,8 @@@@ void parse_file(const char *f) {
d7 1
a7 1
              *pageraction;
@


1.2
log
@Some bugfixes from upstream:

i3-nagbar: Bugfix: -m requires an argument (crashes if none specified)
(upstream git commit 4765427f219c306f0872f124d0b1e2398bf8e39f)

i3-nagbar: call i3-nagbar correctly for configfiles without the font directive
(upstream git commit e8759691b8fdac7f964626c357dd6512a698ea2f)

Bugfix: fix focus handling in 'floating disable' on non-visible windows
(upstream git commit b4f7142509e3af51504a1e72163d544d305f0fa8)

Bugfix: Ignore spaces in front of default workspace name
(upstream git commit 625d5bdba6318377baa716ad5ea5a0b2f85b1c0e)
@
text
@d1 4
a4 13
$OpenBSD: patch-src_config_parser_c,v 1.1 2013/05/16 18:42:30 dcoppa Exp $

commit e8759691b8fdac7f964626c357dd6512a698ea2f
Author: Michael Stapelberg <michael@@stapelberg.de>
Date:   Sat Jun 29 23:46:53 2013 +0200

Bugfix: call i3-nagbar correctly for configfiles without the font directive

fixes #1030

--- src/config_parser.c.orig	Mon Mar 18 22:43:36 2013
+++ src/config_parser.c	Mon Jul  1 15:28:43 2013
@@@@ -1055,12 +1055,12 @@@@ void parse_file(const char *f) {
a14 5
-            config.font.pattern,
+            (config.font.pattern ? config.font.pattern : "fixed"),
             "-t",
             (context->has_errors ? "error" : "warning"),
             "-m",
@


1.1
log
@Update to i3-4.5.1

ok jasper@@, abieber@@
@
text
@d1 10
a10 1
$OpenBSD$
d12 2
a13 2
+++ src/config_parser.c	Mon May 13 08:32:19 2013
@@@@ -1055,8 +1055,8 @@@@ void parse_file(const char *f) {
d24 5
@

