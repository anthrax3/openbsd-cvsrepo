head	1.5;
access;
symbols
	OPENBSD_3_7:1.4.0.10
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.4.0.8
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.4.0.6
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.4.0.4
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.4.0.2
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.3.0.2
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.2.0.6
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.2.0.4
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9_TRACKING_SWITCH:1.2
	OPENBSD_2_9:1.2.0.2
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.1.0.2
	OPENBSD_2_8_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2005.06.13.11.49.19;	author alek;	state dead;
branches;
next	1.4;

1.4
date	2003.03.03.06.54.11;	author ish;	state Exp;
branches;
next	1.3;

1.3
date	2002.09.30.14.47.24;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2001.01.19.03.42.58;	author kevlo;	state Exp;
branches;
next	1.1;

1.1
date	2000.09.19.01.54.48;	author jasoni;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Marked broken since 2004/04/21

ok ish@@, sturm@@
@
text
@$OpenBSD: patch-xfstt_cpp,v 1.4 2003/03/03 06:54:11 ish Exp $
--- xfstt.cpp.orig	Sat Dec 11 12:23:45 1999
+++ xfstt.cpp	Mon Nov 25 16:32:38 2002
@@@@ -11,8 +11,8 @@@@
 #define UNSTRAPLIMIT	10500U
 
 // Change these if you don't lie being FHS complient
-#define TTFONTDIR	"/usr/share/fonts/truetype"
-#define TTCACHEDIR      "/var/cache/xfstt"
+#define TTFONTDIR	"/usr/local/lib/X11/fonts/TrueType"
+#define TTCACHEDIR      "/usr/local/lib/X11/fonts/TrueType"
 
 #define TTINFO_LEAF     "ttinfo.dir"
 #define TTNAME_LEAF     "ttname.dir"
@@@@ -470,10 +470,12 @@@@ static XFSFont* openFont( TTFont* ttFont
 	raster->getFontExtent( &xfs->fe);
 
 	int used = (xfs->fe.bitmaps + xfs->fe.bmplen) - xfs->fe.buffer;
+	int bmpoff = xfs->fe.bitmaps - xfs->fe.buffer;
 	xfs->fe.buffer = (U8*)shrinkMem( xfs->fe.buffer, used);
-	if( xfs->fe.buffer)
+	if( xfs->fe.buffer) {
 		xfs->fe.buflen = used;
-	else {
+		xfs->fe.bitmaps = xfs->fe.buffer + bmpoff;
+	} else {
 		xfs->fid = 0;	//###
 		xfs = 0;
 	}
@@@@ -642,7 +644,7 @@@@ static int prepare2connect( int portno)
 		s_unix.sa_family = PF_UNIX;
 		sprintf( s_unix.sa_data, "fs%d", portno);
 		sockname =  s_unix.sa_data;
-		mkdir( "/tmp/.font-unix", 0766);
+		mkdir( "/tmp/.font-unix", 0755);
 		chdir( "/tmp/.font-unix");
 		unlink( s_unix.sa_data);
 		if( bind( sd_unix, (struct sockaddr*)&s_unix, sizeof(s_unix))) {
@@@@ -650,6 +652,8 @@@@ static int prepare2connect( int portno)
 			fputs( "Please check permissions.\n", stderr);
 		}
 		listen( sd_unix, 1);	// only one connection
+		if (chmod(s_unix.sa_data, 0777) == -1)
+			fprintf( stderr, "Couldn't set mode on /tmp/.font-unix/%s\n", s_unix.sa_data);
 	}
 
 	if( !sd_inet) {
@


1.4
log
@- fix permissions on socket
- suggest to run the daemon as non-root
- ok matthieu, pval
@
text
@d1 1
a1 1
$OpenBSD: patch-xfstt_cpp,v 1.3 2002/09/30 14:47:24 naddy Exp $
@


1.3
log
@- C++ fixes for gcc3
- really honor CXX
- regen patches
@
text
@d1 3
a3 3
$OpenBSD$
--- xfstt.cpp.orig	Sat Dec 11 19:23:45 1999
+++ xfstt.cpp	Mon Sep 30 16:44:57 2002
d30 18
@


1.2
log
@Fonts location should be in /usr/local, not in /usr/X11R6.
OK'd by maintainer <jasoni@@>
@
text
@d1 3
a3 2
--- xfstt.cpp.orig	Sat Dec 11 18:23:45 1999
+++ xfstt.cpp	Thu Jan 18 15:34:06 2001
d15 1
a15 1
@@@@ -470,10 +470,12 @@@@
@


1.1
log
@- Give patches a better name.
- Add patch from FreeBSD to prevent xfstt from crashing.
@
text
@d1 2
a2 2
--- xfstt.cpp.orig	Sat Dec 11 12:23:45 1999
+++ xfstt.cpp	Mon Sep 18 09:25:40 2000
d9 2
a10 2
+#define TTFONTDIR	"/usr/X11R6/lib/X11/fonts/TrueType"
+#define TTCACHEDIR      "/usr/X11R6/lib/X11/fonts/TrueType"
@

