head	1.3;
access;
symbols
	OPENBSD_6_0:1.3.0.6
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.4
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.1.0.6
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2015.04.06.12.49.52;	author stsp;	state Exp;
branches;
next	1.2;
commitid	1pin1hbzBcDwHRhj;

1.2
date	2015.01.18.17.20.27;	author sthen;	state Exp;
branches;
next	1.1;
commitid	y5A7CYqWA0MJqjN4;

1.1
date	2013.05.21.10.34.14;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to megaglest 3.11.1; ok ajacoutot
@
text
@$OpenBSD: patch-source_shared_lib_sources_platform_posix_socket_cpp,v 1.2 2015/01/18 17:20:27 sthen Exp $
--- source/shared_lib/sources/platform/posix/socket.cpp.orig	Mon Mar  9 00:09:09 2015
+++ source/shared_lib/sources/platform/posix/socket.cpp	Mon Apr  6 09:51:53 2015
@@@@ -317,7 +317,7 @@@@ string Ip::getString() const{
 //	class Socket
 // ===============================================
 
-#if defined(__FreeBSD__) || defined(__FreeBSD_kernel__) || defined(BSD) || defined(__APPLE__) || defined(__linux__)
+#if defined(__FreeBSD__) || defined(__FreeBSD_kernel__) || defined(BSD) || defined(__APPLE__) || defined(__linux__) || defined(__OpenBSD__)
 # define USE_GETIFADDRS 1
 # include <ifaddrs.h>
 #endif
@


1.2
log
@don't rely on BSD being defined
@
text
@d1 4
a4 8
$OpenBSD: patch-source_shared_lib_sources_platform_posix_socket_cpp,v 1.1 2013/05/21 10:34:14 dcoppa Exp $

Unbreak build with miniupnpc>1.7
(from upstream SVN revision 3958)

--- source/shared_lib/sources/platform/posix/socket.cpp.orig	Sat Nov 10 06:37:23 2012
+++ source/shared_lib/sources/platform/posix/socket.cpp	Sun Jan 18 17:20:02 2015
@@@@ -314,7 +314,7 @@@@ string Ip::getString() const{
a12 23
@@@@ -2478,13 +2478,22 @@@@ int UPNP_Tools::upnp_init(void *param) {
 				if(SystemFlags::VERBOSE_MODE_ENABLED) printf("UPnP device found: %s %s\n", dev->descURL, dev->st);
 
 				//printf("UPnP device found: [%s] [%s] lanaddr [%s]\n", dev->descURL, dev->st,lanaddr);
+#ifndef MINIUPNPC_VERSION_PRE1_7
+				descXML = (char *)miniwget_getaddr(dev->descURL, &descXMLsize, lanaddr, (sizeof(lanaddr) / sizeof(lanaddr[0])),0);
+#else
 				descXML = (char *)miniwget_getaddr(dev->descURL, &descXMLsize, lanaddr, (sizeof(lanaddr) / sizeof(lanaddr[0])));
+#endif
 				if(SystemFlags::getSystemSettingType(SystemFlags::debugNetwork).enabled) SystemFlags::OutputDebug(SystemFlags::debugNetwork,"LAN address: %s\n", lanaddr);
 
 				if (descXML) {
 					parserootdesc (descXML, descXMLsize, &data);
 					free (descXML); descXML = 0;
+
+#ifndef MINIUPNPC_VERSION_PRE1_7
+					GetUPNPUrls (&urls, &data, dev->descURL,0);
+#else
 					GetUPNPUrls (&urls, &data, dev->descURL);
+#endif
 				}
 				snprintf(buf, 255,"UPnP device found: %s %s LAN address %s", dev->descURL, dev->st, lanaddr);
 
@


1.1
log
@Fix build breakage with miniupnpc>1.7
(from upstream SVN revision 3958)

spotted by, and ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
d6 11
a16 2
--- source/shared_lib/sources/platform/posix/socket.cpp.orig	Sat Nov 10 07:37:23 2012
+++ source/shared_lib/sources/platform/posix/socket.cpp	Tue May 21 11:06:22 2013
@

