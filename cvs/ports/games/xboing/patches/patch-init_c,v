head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.32
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.30
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.28
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.24
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.26
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.22
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.20
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.18
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.16
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.14
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.12
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.10
	OPENBSD_5_0:1.3.0.8
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.6
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.4
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.2
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.2.0.8
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.6
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.4
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.2
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.1.0.16
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.14
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.12
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.10
	OPENBSD_3_9_BASE:1.1
	OPENBSD_3_8:1.1.0.8
	OPENBSD_3_8_BASE:1.1
	OPENBSD_3_7:1.1.0.6
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.4
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_5:1.1.0.2
	OPENBSD_3_5_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2010.01.04.11.21.21;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2007.12.07.10.25.46;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2004.03.06.02.41.00;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.3
log
@- convert to use sndio, from jakemsr@@

- use default colour maps by default, allowing this to work with
24-bit displays. use -no-usedefcmap to revert to previous behaviour.
@
text
@$OpenBSD: patch-init_c,v 1.2 2007/12/07 10:25:46 ajacoutot Exp $
--- init.c.orig	Fri Nov 22 01:28:46 1996
+++ init.c	Sun Jan  3 11:07:53 2010
@@@@ -438,7 +438,7 @@@@ static void HandleDisplayErrors(displayName)
 		WarningMessage("Your X Window system display variable is not set.");
 	else
 	{
-		sprintf(string, "Cannot connect to display called <%s>.", displayName);
+		snprintf(string, sizeof(string), "Cannot connect to display called <%s>.", displayName);
 		WarningMessage(string);
 	}
 }
@@@@ -474,7 +474,7 @@@@ static void PrintUsage()
 		"              [-speed <1-9>] [-scores] [-keys] [-sound] [-setup]",
 		" [-nosfx]",
 		"              [-grab] [-maxvol <1-100>] [-startlevel <1-MAX>]",
-		" [-usedefcmap]",
+		" [-no-usedefcmap]",
 		"              [-nickname <name>] [-noicon]");
 
 	/* Exit now */
@@@@ -551,7 +551,7 @@@@ static void PrintHelp()
         "    -setup                  - Print setup information.\n",
         "    -nosfx                  - Do not use some special effects.\n",
         "    -grab                   - Turn ON pointer grab.\n",
-        "    -usedefcmap             - Use the default colourmap.\n",
+        "    -no-usedefcmap          - Don't use the default colourmap.\n",
 		"    -nickname <name>        - Use nickname instead of real name.\n",
         "    -noicon                 - Do not create a custom icon.\n",
         "    -display <display>      - Set the display for the game.\n");
@@@@ -599,7 +599,7 @@@@ static void InitialiseSettings()
 	syncOn = False;
 	debug = False;
 	grabPointer = False;
-	useDefaultColourmap = False;
+	useDefaultColourmap = True;
 
 	/* This will force the use of the users real name */
 	SetNickName("");
@@@@ -744,12 +744,12 @@@@ static void ParseCommandLine(argv, argc)
 					SetNickName(argv[i]);
 			} else PrintUsage();
 
-		} else if (!compareArgument(argv[i], "-usedefcmap", 10))
+		} else if (!compareArgument(argv[i], "-no-usedefcmap", 10))
 		{
 			/* Try to use the default colourmap */
-			useDefaultColourmap = True;
+			useDefaultColourmap = False;
 
-			DEBUG("Using default colourmap please.")
+			DEBUG("Not using default colourmap.")
 
 		} else if (!compareArgument(argv[i], "-speed", 5))
 		{
@


1.2
log
@- add HOMEPAGE
- add small notice in DESCR stating display must be in 8-bit color mode
- regen patches while here
@
text
@d1 3
a3 3
$OpenBSD: patch-init_c,v 1.1 2004/03/06 02:41:00 naddy Exp $
--- init.c.orig	Fri Nov 22 02:28:46 1996
+++ init.c	Fri Dec  7 09:53:24 2007
d13 43
@


1.1
log
@* Prevent environment variables from overflowing buffers.
  Adapted from Debian via Robert Nagy <thuglife@@bsd.hu>.
* Fix high score file handling.
@
text
@d1 4
a4 4
$OpenBSD$
--- init.c.orig	2004-03-06 00:49:08.000000000 +0100
+++ init.c	2004-03-06 02:02:14.000000000 +0100
@@@@ -438,7 +438,7 @@@@ static void HandleDisplayErrors(displayN
@

