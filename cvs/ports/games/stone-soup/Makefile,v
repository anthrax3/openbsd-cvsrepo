head	1.29;
access;
symbols
	OPENBSD_6_1:1.26.0.2
	OPENBSD_6_1_BASE:1.26
	OPENBSD_6_0:1.23.0.4
	OPENBSD_6_0_BASE:1.23
	OPENBSD_5_9:1.23.0.2
	OPENBSD_5_9_BASE:1.23
	OPENBSD_5_8:1.22.0.4
	OPENBSD_5_8_BASE:1.22
	OPENBSD_5_7:1.20.0.8
	OPENBSD_5_7_BASE:1.20
	OPENBSD_5_6:1.20.0.6
	OPENBSD_5_6_BASE:1.20
	OPENBSD_5_5:1.20.0.4
	OPENBSD_5_5_BASE:1.20
	OPENBSD_5_4:1.20.0.2
	OPENBSD_5_4_BASE:1.20
	OPENBSD_5_3:1.18.0.2
	OPENBSD_5_3_BASE:1.18
	OPENBSD_5_2:1.16.0.2
	OPENBSD_5_2_BASE:1.16
	OPENBSD_5_1_BASE:1.9
	OPENBSD_5_1:1.9.0.2
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	stsp_20110424:1.1.1.1
	stsp:1.1.1;
locks; strict;
comment	@# @;


1.29
date	2017.07.16.19.18.55;	author espie;	state Exp;
branches;
next	1.28;
commitid	tt0GhWK5c4uf9ILG;

1.28
date	2017.05.31.08.08.16;	author espie;	state Exp;
branches;
next	1.27;
commitid	ij92FtFXiSiT1ani;

1.27
date	2017.05.27.16.41.41;	author espie;	state Exp;
branches;
next	1.26;
commitid	0kjAJV4gfBFowFoA;

1.26
date	2016.10.01.12.58.18;	author stsp;	state Exp;
branches;
next	1.25;
commitid	JGGS7wcZMmvIiXVM;

1.25
date	2016.10.01.12.56.54;	author stsp;	state Exp;
branches;
next	1.24;
commitid	oAIEJqGsI5ay9HjU;

1.24
date	2016.09.23.09.16.54;	author sthen;	state Exp;
branches;
next	1.23;
commitid	XLnI6AbHAmyVU5mO;

1.23
date	2015.12.04.20.47.53;	author landry;	state Exp;
branches;
next	1.22;
commitid	gYqs83JS5RzGVA58;

1.22
date	2015.05.28.10.17.23;	author pascal;	state Exp;
branches;
next	1.21;
commitid	020U4lCPk8wUkCOz;

1.21
date	2015.04.07.10.10.28;	author stsp;	state Exp;
branches;
next	1.20;
commitid	o6I5hsy5Jnyg4ZbP;

1.20
date	2013.06.04.18.41.44;	author naddy;	state Exp;
branches;
next	1.19;

1.19
date	2013.03.11.11.07.40;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2013.01.12.16.21.43;	author stsp;	state Exp;
branches;
next	1.17;

1.17
date	2012.09.19.08.15.09;	author jasper;	state Exp;
branches;
next	1.16;

1.16
date	2012.07.13.09.08.22;	author jasper;	state Exp;
branches;
next	1.15;

1.15
date	2012.07.12.19.12.18;	author jasper;	state Exp;
branches;
next	1.14;

1.14
date	2012.07.10.15.22.45;	author jasper;	state Exp;
branches;
next	1.13;

1.13
date	2012.07.09.12.59.33;	author jasper;	state Exp;
branches;
next	1.12;

1.12
date	2012.05.22.08.08.38;	author sthen;	state Exp;
branches;
next	1.11;

1.11
date	2012.04.25.14.39.17;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2012.04.23.17.15.18;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2012.01.02.11.26.18;	author stsp;	state Exp;
branches;
next	1.8;

1.8
date	2011.12.16.15.03.00;	author stsp;	state Exp;
branches;
next	1.7;

1.7
date	2011.12.16.11.40.08;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2011.12.06.14.12.53;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2011.12.02.14.36.14;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2011.09.16.09.48.10;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2011.09.06.18.55.14;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2011.07.07.19.54.18;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2011.04.24.20.14.06;	author stsp;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.04.24.20.14.06;	author stsp;	state Exp;
branches;
next	;


desc
@@


1.29
log
@use COMPILER_LIBCXX where applicable
@
text
@# $OpenBSD: Makefile,v 1.28 2017/05/31 08:08:16 espie Exp $

BROKEN-hppa =	ICE on dgn-shoals.cc:638
BROKEN-arm=	tilegen.elf loops burning cpu

COMMENT = 	dungeon crawl stone soup
CATEGORIES = 	games

HOMEPAGE = 	http://crawl.develz.org/
MASTER_SITES = 	https://crawl.develz.org/release/
VERSION = 	0.18.1
DISTNAME=	stone_soup-${VERSION}-nodeps
EXTRACT_SUFX=	.tar.xz
PKGNAME=	stone-soup-${VERSION}

WRKDIST = 	${WRKDIR}/stone_soup-${VERSION}
WRKSRC = 	${WRKDIST}/source
USE_GMAKE = 	Yes
CFLAGS += 	-I${LOCALBASE}/include -I${LOCALBASE}/include/SDL2
CXXFLAGS += 	-I${LOCALBASE}/include -I${LOCALBASE}/include/SDL2
MAKE_FLAGS = 	CC="${CC}" GCC="${GCC}" GXX="${CXX}" \
		CXX="${CXX}" HOSTCXX="${CXX}" \
		LUA_INCLUDE_DIR=${MODLUA_INCL_DIR} \
		LUA_LIB=${MODLUA_LIB} \
		SQLITE_INCLUDE_DIR=${LOCALBASE}/include \
		LDFLAGS=-L${LOCALBASE}/lib \
		INSTALL_UGRP=root:wheel \
		prefix=${PREFIX} \
		SAVEDIR="~/.crawl" \
		NO_YACC=1 V=1

MAKE_ENV +=	MODLUA_DEP_VERSION=${MODLUA_DEP_VERSION}
COMPILER =	gcc
MODULES = 	lang/lua
MODLUA_VERSION = 	5.1
WANTLIB = 	c m ${MODLUA_WANTLIB} sqlite3 ${COMPILER_LIBCXX}

BUILD_DEPENDS = graphics/pngcrush
LIB_DEPENDS = 	databases/sqlite3

# License GPLv2+
PERMIT_PACKAGE_CDROM =	 Yes

FLAVORS = 	no_x11
FLAVOR ?=

.if ${FLAVOR:Mno_x11}
WANTLIB += 	ncursesw pthread z
MAKE_FLAGS += 	USE_UNICODE=y UNICODE_LOCALE=y
.else
# This should be automatically set during "gmake -C rltiles..." but isn't...
CFLAGS +=	-DUSE_TILE
CXXFLAGS +=	-DUSE_TILE

MAKE_FLAGS += 	TILES=y \
		LDFLAGS="-L${LOCALBASE}/lib -lSDL2 -lSDL2_image -lpng -pthread"
WANTLIB += 	GL GLU SDL2 SDL2_image freetype png pthread z
RUN_DEPENDS =	devel/desktop-file-utils
LIB_DEPENDS += 	devel/sdl2 \
		devel/sdl2-image \
		databases/sqlite3 \
		graphics/png
.endif

post-install:
	mv ${PREFIX}/bin/crawl ${PREFIX}/bin/crawl-ss
	chmod 755 ${PREFIX}/bin/crawl-ss
	${INSTALL_MAN} ${WRKDIST}/docs/crawl.6 ${PREFIX}/man/man6/crawl-ss.6
.if ! ${FLAVOR:Mno_x11}
	${INSTALL_DATA_DIR} ${PREFIX}/share/pixmaps ${PREFIX}/share/applications
	${INSTALL_DATA} \
		${PREFIX}/share/crawl/dat/tiles/stone_soup_icon-32x32.png \
		${PREFIX}/share/pixmaps/stone-soup.png
	${INSTALL_DATA} ${WRKDIST}/source/debian/crawl-tiles.desktop \
		${PREFIX}/share/applications
.endif

NO_TEST=Yes

.include <bsd.port.mk>
@


1.28
log
@switch everything to new COMPILER idiom, even stuff that won't build with clang
yet, but at least that part is done.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2017/05/27 16:41:41 espie Exp $
d36 1
a36 1
WANTLIB = 	c m ${MODLUA_WANTLIB} sqlite3 ${LIBECXX}
@


1.27
log
@stupid build system. unhardcode gcc/g++, get sqlite path in the right location.
force everything in the build system
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2016/10/01 12:58:18 stsp Exp $
d33 1
a33 1
WANT_CXX =	base gcc
@


1.26
log
@fix some whitespace issues in stone-soup's Makefile
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2016/10/01 12:56:54 stsp Exp $
d19 4
a22 3
CFLAGS += 	"-I${LOCALBASE}/include -I${LOCALBASE}/include/SDL2"
CXXFLAGS += 	"-I${LOCALBASE}/include -I${LOCALBASE}/include/SDL2"
MAKE_FLAGS = 	CC="${CC}" CXX="${CXX}" HOSTCXX="${CXX}" \
d30 1
a30 1
		NO_YACC=1
d33 2
a34 3
MODGCC4_ARCHS = *
MODGCC4_LANGS = c++
MODULES = 	gcc4 lang/lua
d36 1
a36 1
WANTLIB = 	c m ${MODLUA_WANTLIB} sqlite3
@


1.25
log
@Update to stone-soup 0.18.1.
Patch by Henrique N. Lengler
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2016/09/23 09:16:54 sthen Exp $
d56 2
a57 2
	LDFLAGS="-L${LOCALBASE}/lib -lSDL2 -lSDL2_image -lpng -pthread"
WANTLIB +=     GL GLU SDL2 SDL2_image freetype png pthread z
d59 4
a62 4
LIB_DEPENDS +=     devel/sdl2 \
	devel/sdl2-image \
	databases/sqlite3 \
	graphics/png
@


1.24
log
@Cope with moving sqlite3 back to ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2015/12/04 20:47:53 landry Exp $
d10 2
a11 2
MASTER_SITES = 	${MASTER_SITE_SOURCEFORGE:=crawl-ref/}
VERSION = 	0.15.2
a14 1
REVISION=	1
d19 3
a21 3
CFLAGS +=	"-I${LOCALBASE}/include -I${LOCALBASE}/include/SDL"
CXXFLAGS += 	"-I${LOCALBASE}/include -I${LOCALBASE}/include/SDL"
MAKE_FLAGS = 	CC="${CC}" CXX="${CXX}" \
d29 1
a29 4
		PROPORTIONAL_FONT="${X11BASE}/lib/X11/fonts/TTF/DejaVuSans.ttf" \
		MONOSPACED_FONT="${X11BASE}/lib/X11/fonts/TTF/DejaVuSansMono.ttf" \
		NO_YACC=1 \
		V=1
d35 1
d38 1
a38 2
BUILD_DEPENDS = devel/bison \
		graphics/pngcrush
d41 2
a42 3
# Almost nethack...
PERMIT_PACKAGE_FTP = 	Yes
PERMIT_PACKAGE_CDROM = 	No gain
d48 1
a48 1
WANTLIB +=	ncursesw pthread z
d56 2
a57 3
		YACC=yacc \
		LDFLAGS="-L${LOCALBASE}/lib -lSDL -lSDL_image -lpng -pthread"
WANTLIB += 	GL GLU SDL SDL_image freetype png pthread z
d59 4
a62 3
LIB_DEPENDS += 	devel/sdl \
		devel/sdl-image \
		graphics/png
a68 1
	${INSTALL_DATA} ${WRKDIST}/README.txt ${PREFIX}/share/crawl/docs
d74 1
a74 1
	${INSTALL_DATA} ${FILESDIR}/stone-soup.desktop \
@


1.23
log
@Mark BROKEN-hppa for reliable BROKEN-ness (gcc ICEs, undefined refs to
atomics, various horrors)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2015/05/28 10:17:23 pascal Exp $
d15 1
a15 1
REVISION=	0
d25 1
a25 1
		SQLITE_INCLUDE_DIR=/usr/include \
d43 1
@


1.22
log
@gcc4 bumps, reminded by aja@@
@
text
@d1 4
a4 1
# $OpenBSD: Makefile,v 1.21 2015/04/07 10:10:28 stsp Exp $
a15 2

BROKEN-arm=	tilegen.elf loops burning cpu
@


1.21
log
@Update to stone-soup 0.15.2. This is not the latest version.
However, more recent versions require SDL2 which is currently
marked broken. Must fix up a few game data files (.des) which
fail to load with "unterminated string errors", unfortunately.
ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2013/06/04 18:41:44 naddy Exp $
d12 1
@


1.20
log
@the png headers are now directly under include/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2013/03/11 11:07:40 espie Exp $
d8 1
a8 1
VERSION = 	0.11.0
d28 3
d34 4
a37 2
MODULES = 	lang/lua
WANTLIB = 	c m stdc++ ${MODLUA_WANTLIB} sqlite3
@


1.19
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2013/01/12 16:21:43 stsp Exp $
d18 2
a19 2
CFLAGS +=	"-I${LOCALBASE}/include -I${LOCALBASE}/include/libpng -I${LOCALBASE}/include/SDL"
CXXFLAGS += 	"-I${LOCALBASE}/include -I${LOCALBASE}/include/libpng -I${LOCALBASE}/include/SDL"
@


1.18
log
@Update Dungeon Crawl Stone Soup to version 0.11.0.
with silent agreement from ports@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2012/09/19 08:15:09 jasper Exp $
a37 1
PERMIT_DISTFILES_FTP = 	Yes
a38 1
PERMIT_DISTFILES_CDROM = No gain
d76 1
a76 1
NO_REGRESS=Yes
@


1.17
log
@sync after recent lua.port.mk change
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2012/07/13 09:08:22 jasper Exp $
d8 1
a8 1
VERSION = 	0.9.1
d10 1
a10 1
EXTRACT_SUFX=	.tar.bz2
a11 1
REVISION =	3
a16 1
MAKE_FILE = 	${WRKSRC}/makefile
d18 2
a20 2
		CFLAGS="-I${LOCALBASE}/include -I${LOCALBASE}/include/libpng -I${LOCALBASE}/include/SDL" \
		CXXFLAGS="-I${LOCALBASE}/include -I${LOCALBASE}/include/libpng -I${LOCALBASE}/include/SDL" \
d30 1
a35 1
RUN_DEPENDS =	devel/desktop-file-utils
d47 1
a47 1
WANTLIB +=	ncursesw
d50 4
d58 1
a60 1
		print/freetype \
@


1.16
log
@fixup include paths once more
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2012/07/12 19:12:18 jasper Exp $
d12 1
a12 1
REVISION =	2
@


1.15
log
@fix include paths
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2012/07/10 15:22:45 jasper Exp $
d21 2
a22 2
		CFLAGS="-I${LOCALBASE}/include" \
		CXXFLAGS="-I${LOCALBASE}/include" \
@


1.14
log
@handle multiple lua versions, for now everything builds with the "old" 5.1 in the new location.
use FLAVOR=lua52 to use lua 5.2 with these ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2012/05/22 08:08:38 sthen Exp $
d21 2
d24 1
a24 1
		LUA_LIB=-llua \
@


1.13
log
@this should use MODLUA_WANTLIB
@
text
@d12 1
a12 1
REVISION =	1
d21 1
a21 1
		LUA_INCLUDE_DIR=${LOCALBASE}/include \
@


1.12
log
@add bison as a build dep, building no_x11 failed when it wasn't installed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2012/04/25 14:39:17 espie Exp $
d12 1
a12 1
REVISION =	0
d31 1
a31 1
WANTLIB = 	c m stdc++ lua sqlite3
@


1.11
log
@point at real sqlite location
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2012/04/23 17:15:18 espie Exp $
d33 2
a34 1
BUILD_DEPENDS = graphics/pngcrush
@


1.10
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2012/01/02 11:26:18 stsp Exp $
d23 1
a23 1
		SQLITE_INCLUDE_DIR=${LOCALBASE}/include \
@


1.9
log
@Update to 0.9.1; with silent agreement from ports@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2011/12/16 15:03:00 stsp Exp $
d12 1
a34 1
LIB_DEPENDS = 	databases/sqlite3
@


1.8
log
@Add a .desktop file and properly heed CFLAGS. help and ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2011/12/16 11:40:08 sthen Exp $
d8 1
a8 1
VERSION = 	0.7.2
a11 1
REVISION=	2
d32 1
@


1.7
log
@honour CC/CXX variables
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2011/12/06 14:12:53 espie Exp $
d12 1
a12 1
REVISION=	1
d33 1
d64 8
@


1.6
log
@avoid using bison if it's around
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2011/12/02 14:36:14 espie Exp $
d20 2
a21 1
MAKE_FLAGS = 	LUA_INCLUDE_DIR=${LOCALBASE}/include \
@


1.5
log
@bye bye FLAVOR:L
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2011/09/16 09:48:10 espie Exp $
d48 1
@


1.4
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2011/09/06 18:55:14 sthen Exp $
d43 1
a43 1
.if ${FLAVOR:L:Mno_x11}
@


1.3
log
@knock out arm; tilegen.elf loops consuming 100% cpu
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2011/07/07 19:54:18 jasper Exp $
d12 1
a12 1
REVISION=	0
@


1.2
log
@rename binary and manpage from crawl to crawl-ss, as net/crawl already installs
a crawl binary.

discussed with, coin flipped by and ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2011/04/24 20:14:06 stsp Exp $
d13 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d12 1
d55 3
a57 2
	chmod 755 ${PREFIX}/bin/crawl
	${INSTALL_MAN} ${WRKDIST}/docs/crawl.6 ${PREFIX}/man/man6/crawl.6
@


1.1.1.1
log
@Dungeon Crawl Stone Soup is a free roguelike game of exploration and
treasure-hunting in dungeons filled with dangerous and unfriendly
monsters in a quest for the mystifyingly fabulous Orb of Zot.

ok benoit@@
@
text
@@
