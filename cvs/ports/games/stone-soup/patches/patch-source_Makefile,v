head	1.4;
access;
symbols
	OPENBSD_6_1:1.3.0.2
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.2.0.6
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.4
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.1.0.10
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.8
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.6
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.4
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.2
	OPENBSD_5_3_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2017.05.27.16.41.41;	author espie;	state Exp;
branches;
next	1.3;
commitid	0kjAJV4gfBFowFoA;

1.3
date	2016.10.01.12.56.54;	author stsp;	state Exp;
branches;
next	1.2;
commitid	oAIEJqGsI5ay9HjU;

1.2
date	2015.04.07.10.10.28;	author stsp;	state Exp;
branches;
next	1.1;
commitid	o6I5hsy5Jnyg4ZbP;

1.1
date	2013.01.12.16.21.43;	author stsp;	state Exp;
branches;
next	;


desc
@@


1.4
log
@stupid build system. unhardcode gcc/g++, get sqlite path in the right location.
force everything in the build system
@
text
@$OpenBSD: patch-source_Makefile,v 1.3 2016/10/01 12:56:54 stsp Exp $
Index: source/Makefile
--- source/Makefile.orig
+++ source/Makefile
@@@@ -215,9 +215,6 @@@@ ifdef msys
 		BUILD_LIBPNG = YesPlease
 		COPY_FONTS = yes
 	endif
-	ifeq ($(shell gcc -v -static -static-libstdc++ 2>&1 | grep 'unrecognized option'),)
-		EXTRA_LIBS += -static -static-libgcc -static-libstdc++
-	endif
 endif
 ifeq ($(uname_S),Darwin)
 	STRIP := strip -x
@@@@ -325,11 +322,8 @@@@ endif
 #
 ifndef NO_APPLE_GCC
 ifeq ($(uname_S),Darwin)
-ifneq ($(shell gcc -v 2>&1 | grep Apple),)
-APPLE_GCC = YesPlease
 endif
 endif
-endif
 
 
 ifdef WIN32
@@@@ -511,15 +505,7 @@@@ ifneq ($(GCC_VER),)
 GCC_VER_SUFFIX:=-$(GCC_VER)
 endif
 
-# Attempt to use a full compiler name, to make
-# distcc builds work nicely.
-LMACH := $(shell gcc -dumpmachine)-
-ifeq ($(LMACH),-)
 LMACH :=
-endif
-ifeq ($(shell which $(LMACH)gcc$(GCC_VER_SUFFIX) > /dev/null 2> /dev/null && echo "Yes"),)
-LMACH :=
-endif
 
 ifneq ($(FORCE_CC),)
 GCC := $(FORCE_CC)
@@@@ -639,9 +625,9 @@@@ ifndef BUILD_LUA
       BUILD_LUA = yes
     endif
   else
-    ifneq ($(shell $(PKGCONFIG) lua5.1 --exists || echo no),)
-      ifneq ($(shell $(PKGCONFIG) lua-5.1 --exists || echo no),)
-        ifneq ($(shell $(PKGCONFIG) lua --exists || echo no),)
+    ifneq ($(shell $(PKGCONFIG) lua --exists || echo no),)
+      ifneq ($(shell $(PKGCONFIG) lua${MODLUA_DEP_VERSION} --exists || echo no),)
+        ifneq ($(shell $(PKGCONFIG) lua${MODLUA_DEP_VERSION} --exists || echo no),)
           BUILD_LUA = yes
         else
           ifeq ($(shell $(PKGCONFIG) lua --modversion | head -c 3),5.1)
@@@@ -651,16 +637,16 @@@@ ifndef BUILD_LUA
           endif
         endif
       else
-        LUA_PACKAGE = lua-5.1
+        LUA_PACKAGE = lua${MODLUA_DEP_VERSION}
       endif
     else
-      LUA_PACKAGE = lua5.1
+      LUA_PACKAGE = lua${MODLUA_DEP_VERSION}
     endif
   endif
 endif
 ifndef BUILD_LUA
   ifndef LUA_PACKAGE
-    LUA_PACKAGE = lua5.1
+    LUA_PACKAGE = lua${MODLUA_DEP_VERSION}
   endif
   INCLUDES_L += $(shell $(PKGCONFIG) $(LUA_PACKAGE) --cflags-only-I | sed -e 's/-I/-isystem /')
   CFLAGS_L  += $(shell $(PKGCONFIG) $(LUA_PACKAGE) --cflags-only-other)
@@@@ -673,7 +659,7 @@@@ endif
 
 ifndef BUILD_SQLITE
   ifeq ($(shell grep -q sqlite3_prepare $(SQLITE_INCLUDE_DIR)/sqlite3.h 2>/dev/null && echo yes),yes)
-    # INCLUDES_L += -isystem $(SQLITE_INCLUDE_DIR)
+    INCLUDES_L += -isystem $(SQLITE_INCLUDE_DIR)
     LIBS += $(SQLITE_LIB)
     ifneq ($(shell grep -q sqlite3_prepare_v2 $(SQLITE_INCLUDE_DIR)/sqlite3.h 2>/dev/null && echo yes),yes)
       DEFINES_L += -DANCIENT_SQLITE
@@@@ -1122,51 +1108,6 @@@@ ifndef NO_OPTIMIZE
     endif
   endif
 endif
-endif
-
-ifdef BUILD_PCRE
-CONTRIBS += pcre
-CONTRIB_LIBS += $(LIBPCRE)
-endif
-ifdef BUILD_FREETYPE
-CONTRIBS += freetype
-CONTRIB_LIBS += $(LIBFREETYPE)
-endif
-ifdef BUILD_LIBPNG
-CONTRIBS += libpng
-CONTRIB_LIBS := $(LIBPNG) $(CONTRIB_LIBS)
-endif
-ifdef BUILD_SDL2
-CONTRIBS += sdl2
-CONTRIB_LIBS := $(LIBSDL2) $(CONTRIB_LIBS)
-ifeq ($(uname_S),Linux)
-LIBS += -ldl -lrt
-endif
-endif
-ifdef BUILD_SDL2IMAGE
-CONTRIBS += sdl2-image
-CONTRIB_LIBS := $(LIBSDL2IMAGE) $(CONTRIB_LIBS)
-endif
-ifdef BUILD_SDL2MIXER
-CONTRIBS += sdl2-mixer
-CONTRIB_LIBS := $(LIBSDL2MIXER) $(CONTRIB_LIBS)
-endif
-ifdef BUILD_ZLIB
-CONTRIBS += zlib
-CONTRIB_LIBS += $(LIBZ)
-endif
-ifdef BUILD_LUA
-ifdef USE_LUAJIT
-CONTRIBS += luajit/src
-CFOTHER_L += -DUSE_LUAJIT
-else
-CONTRIBS += lua/src
-endif
-CONTRIB_LIBS += $(LIBLUA)
-endif
-ifdef BUILD_SQLITE
-CONTRIBS += sqlite
-CONTRIB_LIBS += $(LIBSQLITE)
 endif
 
 EXTRA_OBJECTS += version.o
@


1.3
log
@Update to stone-soup 0.18.1.
Patch by Henrique N. Lengler
@
text
@d1 43
a43 4
$OpenBSD$
--- source/Makefile.orig	Sat Apr 30 00:53:03 2016
+++ source/Makefile	Thu Sep 29 00:59:04 2016
@@@@ -639,9 +639,9 @@@@ ifndef BUILD_LUA
d56 1
a56 1
@@@@ -651,16 +651,16 @@@@ ifndef BUILD_LUA
d76 10
a85 1
@@@@ -1122,51 +1122,6 @@@@ ifndef NO_OPTIMIZE
@


1.2
log
@Update to stone-soup 0.15.2. This is not the latest version.
However, more recent versions require SDL2 which is currently
marked broken. Must fix up a few game data files (.des) which
fail to load with "unterminated string errors", unfortunately.
ok jasper@@
@
text
@d1 4
a4 4
$OpenBSD: patch-source_Makefile,v 1.1 2013/01/12 16:21:43 stsp Exp $
--- source/Makefile.orig	Thu Aug 28 04:28:56 2014
+++ source/Makefile	Mon Apr  6 15:44:58 2015
@@@@ -591,8 +591,8 @@@@ ifndef BUILD_LUA
d10 4
a13 3
+    ifneq ($(shell $(PKGCONFIG) lua${MODLUA_DEP_VERSION} --exists || echo no),)
+      ifneq ($(shell $(PKGCONFIG) lua-${MODLUA_DEP_VERSION} --exists || echo no),)
         ifneq ($(shell $(PKGCONFIG) lua --exists || echo no),)
d16 2
a17 1
@@@@ -603,16 +603,16 @@@@ ifndef BUILD_LUA
d22 1
a22 1
+        LUA_PACKAGE = lua-${MODLUA_DEP_VERSION}
d37 52
@


1.1
log
@Update Dungeon Crawl Stone Soup to version 0.11.0.
with silent agreement from ports@@
@
text
@d1 4
a4 10
$OpenBSD$
--- source/Makefile.orig	Sun Sep 30 23:25:31 2012
+++ source/Makefile	Thu Dec 27 15:18:32 2012
@@@@ -533,7 +533,7 @@@@ ifndef BUILD_LUA
   endif
 endif
 ifndef BUILD_LUA
-  ifneq ($(shell $(PKGCONFIG) lua5.1 --exists || echo no),)
+  ifneq ($(shell $(PKGCONFIG) lua${MODLUA_DEP_VERSION} --exists || echo no),)
     ifneq ($(shell $(PKGCONFIG) lua --exists || echo no),)
d6 16
d23 2
a24 2
@@@@ -544,7 +544,7 @@@@ ifndef BUILD_LUA
       endif
a25 3
   else
-    LUA_PACKAGE = lua5.1
+    LUA_PACKAGE = lua${MODLUA_DEP_VERSION}
d29 3
a31 17
@@@@ -831,7 +831,7 @@@@ ifdef PROPORTIONAL_FONT
     INSTALL_FONTS += $(PROPORTIONAL_FONT)
   endif
 else
-  SYS_PROPORTIONAL_FONT = $(shell find /usr/share/fonts -iname $(OUR_PROPORTIONAL_FONT)|head -n 1)
+  SYS_PROPORTIONAL_FONT = ${X11BASE}/lib/X11/fonts/TTF/$(OUR_PROPORTIONAL_FONT)
   ifeq (,$(SYS_PROPORTIONAL_FONT))
     SYS_PROPORTIONAL_FONT = $(shell find /usr/local/share/fonts -iname $(OUR_PROPORTIONAL_FONT)|head -n 1)
   endif
@@@@ -854,7 +854,7 @@@@ ifdef MONOSPACED_FONT
     INSTALL_FONTS += $(MONOSPACED_FONT)
   endif
 else
-  SYS_MONOSPACED_FONT = $(shell find /usr/share/fonts -iname $(OUR_MONOSPACED_FONT)|head -n 1)
+  SYS_MONOSPACED_FONT = ${X11BASE}/lib/X11/fonts/TTF/$(OUR_MONOSPACED_FONT)
   ifeq (,$(SYS_MONOSPACED_FONT))
     SYS_MONOSPACED_FONT = $(shell find /usr/local/share/fonts -iname $(OUR_MONOSPACED_FONT)|head -n 1)
d33 2
a34 9
@@@@ -1150,7 +1150,7 @@@@ endif
 # This information is included in crash reports, and is printed with
 # "crawl -version"
 compflag.h: $(OBJECTS:.o=.cc) util/gen-cflg.pl
-	$(QUIET_GEN)util/gen-cflg.pl compflag.h "$(ALL_CFLAGS)" "$(LDFLAGS)" "$(HOST)" "$(ARCH)"
+	$(QUIET_GEN)util/gen-cflg.pl compflag.h "$(CFLAGS)" "$(LDFLAGS)" "$(HOST)" "$(ARCH)"
 
 build.h: $(OBJECTS:.o=.cc) util/gen_ver.pl
 	$(QUIET_GEN)util/gen_ver.pl $@@ $(MERGE_BASE)
@

