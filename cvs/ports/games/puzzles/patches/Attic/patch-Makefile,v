head	1.4;
access;
symbols
	OPENBSD_5_6:1.3.0.10
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.8
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.6
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.4
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.2
	OPENBSD_5_2_BASE:1.3
	landry_20120328:1.1.1.1
	landry:1.1.1;
locks; strict;
comment	@# @;


1.4
date	2014.12.06.23.05.11;	author landry;	state dead;
branches;
next	1.3;
commitid	cqeUG4zdYxHwgpII;

1.3
date	2012.05.24.08.23.02;	author landry;	state Exp;
branches;
next	1.2;

1.2
date	2012.04.08.20.54.34;	author landry;	state Exp;
branches;
next	1.1;

1.1
date	2012.03.28.12.53.53;	author landry;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.03.28.12.53.53;	author landry;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to puzzles 20141206.

- Adds two new puzzles, unruly and undead
- Add a convenience dist target to fetch a tarball from gitweb and
  repackage it, with Makefile.gtk and icons properly generated from the
source. Selfhost the resulting distfiles.
@
text
@$OpenBSD: patch-Makefile,v 1.3 2012/05/24 08:23:02 landry Exp $
- only use gtk-2 through pkg-config
- dont use -Werror/-O2
- fix version detection
- install binaries under bin as puzzle-$i
- generate desktop files/install icons
--- Makefile.orig	Wed May 23 02:35:49 2012
+++ Makefile	Wed May 23 17:33:42 2012
@@@@ -11,10 +11,9 @@@@ CC := $(TOOLPATH)$(CC)
 # building with GTK 1.2, or you can set it to `pkg-config gtk+-2.0'
 # if you want to enforce 2.0. The default is to try 2.0 and fall back
 # to 1.2 if it isn't found.
-GTK_CONFIG = sh -c 'pkg-config gtk+-2.0 $$0 2>/dev/null || gtk-config $$0'
+GTK_CONFIG = pkg-config gtk+-2.0
 
-CFLAGS := -O2 -Wall -Werror -ansi -pedantic -g -I./ -Iicons/ `$(GTK_CONFIG) \
-		--cflags` $(CFLAGS)
+CFLAGS += -Wall -ansi -pedantic -g -I./ -Iicons/ `$(GTK_CONFIG) --cflags`
 XLIBS = `$(GTK_CONFIG) --libs` -lm
 ULIBS = -lm#
 INSTALL=install
@@@@ -670,9 +669,9 @@@@ GAMES += twiddle
 GAMES += unequal
 GAMES += untangle
 version.o: version.c version2.def
-	$(CC) $(COMPAT) $(XFLAGS) $(CFLAGS) `cat version2.def` -c version.c
+	$(CC) $(COMPAT) $(XFLAGS) $(CFLAGS) `cat version.def` -c version.c
 version2.def: FORCE
-	if test -z "$(VER)" && test -f manifest && md5sum -c manifest; then \
+	if test -z "$(VER)" && test -f manifest && md5 -c manifest; then \
 		cat version.def > version2.def.new; \
 	elif test -z "$(VER)" && test -d .svn && svnversion . >/dev/null 2>&1; then \
 		echo "-DREVISION=`svnversion .`" >version2.def.new; \
@@@@ -686,9 +685,19 @@@@ version2.def: FORCE
 	fi
 .PHONY: FORCE
 install:
+	for d in 16 32 48; do \
+		$(INSTALL_DATA) -d $(DESTDIR)/$(prefix)/share/icons/hicolor/$${d}x$${d}/apps/ ; \
+	done; \
+	$(INSTALL_DATA) -d $(DESTDIR)/$(prefix)/share/applications/; \
+	$(INSTALL_DATA) -d $(DESTDIR)/$(prefix)/share/doc/puzzles/; \
+	$(INSTALL_DATA) puzzles.txt $(DESTDIR)/$(prefix)/share/doc/puzzles/; \
 	for i in $(GAMES); do \
-		$(INSTALL_PROGRAM) -m 755 $$i $(DESTDIR)$(gamesdir)/$$i \
-		|| exit 1; \
+		$(INSTALL_PROGRAM) -m 755 $$i $(DESTDIR)$(bindir)/puzzle-$$i ;\
+		ui=`echo $$i | perl -n -e 'print ucfirst'` ;\
+		echo "[Desktop Entry]\nVersion=1.0\nName=$$ui\nComment=$$ui puzzle\nExec=puzzle-$$i\nIcon=puzzle-$$i\nType=Application\nCategories=Game;LogicGame;" > $(DESTDIR)/$(prefix)/share/applications/puzzle-$$i.desktop;\
+		for d in 16 32 48; do \
+			$(INSTALL_DATA) icons/$$i-$${d}d24.png $(DESTDIR)/$(prefix)/share/icons/hicolor/$${d}x$${d}/apps/puzzle-$$i.png ;\
+		done \
 	done
 
 clean:
@


1.3
log
@Update to puzzles r9534, fix WANTLIB and regen PLIST while here.
Thx sthen@@ for distfile mirroring..
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.2 2012/04/08 20:54:34 landry Exp $
@


1.2
log
@Minor tweak: use perl magic with ucfirst to capitalize first letter in
Desktop file name/comment.
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.1.1.1 2012/03/28 12:53:53 landry Exp $
d7 2
a8 2
--- Makefile.orig	Wed Mar 28 02:38:19 2012
+++ Makefile	Sun Apr  8 22:39:42 2012
d19 2
a20 2
 XLIBS = `$(GTK_CONFIG) --libs`
 ULIBS =#
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
a8 2
--- Makefile.orig	Tue Mar 27 02:38:02 2012
+++ Makefile	Wed Mar 28 13:04:36 2012
d34 1
a34 1
@@@@ -686,9 +685,18 @@@@ version2.def: FORCE
d48 2
a49 1
+		echo "[Desktop Entry]\nVersion=1.0\nName=$$i\nComment=$$i puzzle\nExec=puzzle-$$i\nIcon=puzzle-$$i\nType=Application\nCategories=Game;LogicGame;" > $(DESTDIR)/$(prefix)/share/applications/puzzle-$$i.desktop;\
@


1.1.1.1
log
@Import puzzles svn rev9411:

WWW: http://www.chiark.greenend.org.uk/~sgtatham/puzzles/

This is is a collection of 34 well-known puzzle games, all built around a
common portable framework by Simon Tatham. They're perfect to slack
during a compilation. Local improvements :
- add 'online help' menu item opening help in web browser through xdg-open
- install icons and generate .desktop files for nice desktop integration

ok sthen@@
@
text
@@
