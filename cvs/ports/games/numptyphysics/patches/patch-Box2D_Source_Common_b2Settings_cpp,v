head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.26
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.24
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.22
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.18
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.20
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.16
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.14
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.12
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.10
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.8
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.6
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.4
	OPENBSD_5_0:1.3.0.2
	OPENBSD_5_0_BASE:1.3;
locks; strict;
comment	@# @;


1.3
date	2011.06.29.07.42.02;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2011.04.08.21.13.59;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2011.04.07.10.09.30;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.3
log
@I like this more; no binary change
@
text
@$OpenBSD: patch-Box2D_Source_Common_b2Settings_cpp,v 1.2 2011/04/08 21:13:59 dcoppa Exp $

Fix LP64 architectures (i.e. sparc64)

--- Box2D/Source/Common/b2Settings.cpp.orig	Thu Apr  7 08:59:55 2011
+++ Box2D/Source/Common/b2Settings.cpp	Thu Apr  7 09:06:07 2011
@@@@ -19,6 +19,12 @@@@
 #include "b2Settings.h"
 #include <cstdlib>
 
+#if defined(__LP64__)
+#define ALIGNBYTES 8
+#else
+#define ALIGNBYTES 4
+#endif
+
 b2Version b2_version = {2, 0, 1};
 
 int32 b2_byteCount = 0;
@@@@ -28,11 +34,11 @@@@ int32 b2_byteCount = 0;
 // Memory allocators. Modify these to use your own allocator.
 void* b2Alloc(int32 size)
 {
-	size += 4;
+	size += ALIGNBYTES;
 	b2_byteCount += size;
 	char* bytes = (char*)malloc(size);
 	*(int32*)bytes = size;
-	return bytes + 4;
+	return bytes + ALIGNBYTES;
 }
 
 void b2Free(void* mem)
@@@@ -43,7 +49,7 @@@@ void b2Free(void* mem)
 	}
 
 	char* bytes = (char*)mem;
-	bytes -= 4;
+	bytes -= ALIGNBYTES;
 	int32 size = *(int32*)bytes;
 	b2Assert(b2_byteCount >= size);
 	b2_byteCount -= size;
@


1.2
log
@__LP64__ is better, as suggested by Brad.
@
text
@d1 1
a1 1
$OpenBSD: patch-Box2D_Source_Common_b2Settings_cpp,v 1.1 2011/04/07 10:09:30 dcoppa Exp $
d12 1
a12 1
+#define PADDING 8
d14 1
a14 1
+#define PADDING 4
d25 1
a25 1
+	size += PADDING;
d30 1
a30 1
+	return bytes + PADDING;
d39 1
a39 1
+	bytes -= PADDING;
@


1.1
log
@Fix LP64 architectures and remove BROKEN-sparc64

OK sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
d11 1
a11 1
+#if defined(_LP64)
@

