head	1.7;
access;
symbols
	OPENBSD_6_2:1.7.0.2
	OPENBSD_6_2_BASE:1.7
	OPENBSD_6_1:1.6.0.12
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.6.0.10
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.6
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.8
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.4
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.2
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.5.0.2
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.4.0.6
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.4.0.4
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.4.0.2
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.8
	OPENBSD_5_0:1.3.0.6
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.4
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.2
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.2.0.6
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.4
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.2
	OPENBSD_4_5_BASE:1.2
	weerd_20081027:1.1.1.1
	weerd:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2017.08.18.20.39.06;	author espie;	state Exp;
branches;
next	1.6;
commitid	9HiJAMvsbU2m0UHU;

1.6
date	2014.07.11.08.14.16;	author ajacoutot;	state Exp;
branches;
next	1.5;
commitid	684BP1wS7uA5FNS9;

1.5
date	2014.01.31.09.34.22;	author jca;	state Exp;
branches;
next	1.4;

1.4
date	2012.03.18.15.47.28;	author kirby;	state Exp;
branches;
next	1.3;

1.3
date	2010.05.27.03.47.28;	author jakemsr;	state Exp;
branches;
next	1.2;

1.2
date	2009.02.03.19.48.42;	author kili;	state Exp;
branches;
next	1.1;

1.1
date	2008.10.27.13.29.02;	author weerd;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.10.27.13.29.02;	author weerd;	state Exp;
branches;
next	;


desc
@@


1.7
log
@reorder includes so that we get the internal libspeex first.
fix 'hidden dependency' error after the recent update to libspeex
(headers have changed enough to be incompatible)
@
text
@$OpenBSD: patch-Makefile,v 1.6 2014/07/11 08:14:16 ajacoutot Exp $
Index: Makefile
--- Makefile.orig
+++ Makefile
@@@@ -164,13 +164,14 @@@@ endif
 
 #############################################################################
 
-BD=$(BUILD_DIR)/debug-$(PLATFORM)-$(ARCH)
-BR=$(BUILD_DIR)/release-$(PLATFORM)-$(ARCH)
+BD=$(BUILD_DIR)/debug-$(PLATFORM)
+BR=$(BUILD_DIR)/release-$(PLATFORM)
 CDIR=$(MOUNT_DIR)/client
 SDIR=$(MOUNT_DIR)/server
 RDIR=$(MOUNT_DIR)/renderer
 CMDIR=$(MOUNT_DIR)/qcommon
 SDLDIR=$(MOUNT_DIR)/sdl
+SNDIODIR=$(MOUNT_DIR)/sndio
 ASMDIR=$(MOUNT_DIR)/asm
 SYSDIR=$(MOUNT_DIR)/sys
 GDIR=$(MOUNT_DIR)/game
@@@@ -638,11 +639,11 @@@@ else # ifeq freebsd
 
 ifeq ($(PLATFORM),openbsd)
 
-  #default to i386, no tests done on anything else
-  ARCH=i386
+  # Get the machine type
+  ARCH=$(shell uname -m)
 
-  BASE_CFLAGS = -Wall -fno-strict-aliasing -Wimplicit -Wstrict-prototypes \
-    -DUSE_ICON
+  BASE_CFLAGS = $(PIE_CFLAGS) -Wall -fno-strict-aliasing -Wimplicit -Wstrict-prototypes \
+    -DUSE_ICON -DARCH_STRING=\\\"${ARCH}\\\"
   CLIENT_CFLAGS = $(SDL_CFLAGS)
   SERVER_CFLAGS = 
 
@@@@ -662,8 +663,7 @@@@ ifeq ($(PLATFORM),openbsd)
     USE_CURL_DLOPEN=0
   endif
 
-  BASE_CFLAGS += -DNO_VM_COMPILED
-  HAVE_VM_COMPILED=false
+  HAVE_VM_COMPILED=true
 
   SHLIBEXT=so
   SHLIBNAME=.$(SHLIBEXT)
@@@@ -671,15 +671,16 @@@@ ifeq ($(PLATFORM),openbsd)
   SHLIBLDFLAGS=-shared $(LDFLAGS)
 
   THREAD_LIBS=-pthread
-  LIBS=-lm
+  LIBS= $(PIE_LDFLAGS) -lm
 
   CLIENT_LIBS =
 
-  CLIENT_LIBS += $(SDL_LIBS) -lGL
+  CLIENT_LIBS += $(SDL_LIBS) -lGL -lsndio
 
   ifeq ($(USE_OPENAL),1)
+    CLIENT_LIBS += $(THREAD_LIBS)
     ifneq ($(USE_OPENAL_DLOPEN),1)
-      CLIENT_LIBS += $(THREAD_LIBS) -lossaudio -lopenal
+      CLIENT_LIBS += $(shell openal-config --libs)
     endif
   endif
 
@@@@ -851,11 +852,11 @@@@ ifndef SHLIBNAME
 endif
 
 ifneq ($(BUILD_SERVER),0)
-  TARGETS += $(B)/oa_ded$(FULLBINEXT)
+  TARGETS += $(B)/openarena-server$(FULLBINEXT)
 endif
 
 ifneq ($(BUILD_CLIENT),0)
-  TARGETS += $(B)/openarena$(FULLBINEXT)
+  TARGETS += $(B)/openarena-client$(FULLBINEXT)
   ifneq ($(BUILD_CLIENT_SMP),0)
     TARGETS += $(B)/openarena-smp$(FULLBINEXT)
   endif
@@@@ -897,7 +898,7 @@@@ ifeq ($(USE_VOIP),1)
   CLIENT_CFLAGS += -DUSE_VOIP
   SERVER_CFLAGS += -DUSE_VOIP
   ifeq ($(USE_INTERNAL_SPEEX),1)
-    CLIENT_CFLAGS += -DFLOATING_POINT -DUSE_ALLOCA -I$(SPEEXDIR)/include
+    CLIENT_CFLAGS := -DFLOATING_POINT -DUSE_ALLOCA -I$(SPEEXDIR)/include $(CLIENT_CFLAGS)
   else
     CLIENT_LIBS += -lspeex -lspeexdsp
   endif
@@@@ -1471,8 +1472,9 @@@@ Q3OBJ = \
   \
   $(B)/client/sdl_gamma.o \
   $(B)/client/sdl_input.o \
-  $(B)/client/sdl_snd.o \
   \
+  $(B)/client/snd_sndio.o \
+  \
   $(B)/client/con_passive.o \
   $(B)/client/con_log.o \
   $(B)/client/sys_main.o
@@@@ -1597,7 +1599,7 @@@@ Q3POBJ += \
 Q3POBJ_SMP += \
   $(B)/clientsmp/sdl_glimp.o
 
-$(B)/openarena$(FULLBINEXT): $(Q3OBJ) $(Q3POBJ) $(LIBSDLMAIN)
+$(B)/openarena-client$(FULLBINEXT): $(Q3OBJ) $(Q3POBJ) $(LIBSDLMAIN)
 	$(echo_cmd) "LD $@@"
 	$(Q)$(CC) $(CLIENT_CFLAGS) $(CFLAGS) $(CLIENT_LDFLAGS) $(LDFLAGS) \
 		-o $@@ $(Q3OBJ) $(Q3POBJ) \
@@@@ -1756,7 +1758,7 @@@@ ifeq ($(PLATFORM),darwin)
     $(B)/ded/sys_osx.o
 endif
 
-$(B)/oa_ded$(FULLBINEXT): $(Q3DOBJ)
+$(B)/openarena-server$(FULLBINEXT): $(Q3DOBJ)
 	$(echo_cmd) "LD $@@"
 	$(Q)$(CC) $(CFLAGS) $(LDFLAGS) -o $@@ $(Q3DOBJ) $(LIBS)
 
@@@@ -2076,6 +2078,9 @@@@ $(B)/client/%.o: $(ZDIR)/%.c
 $(B)/client/%.o: $(RDIR)/%.c
 	$(DO_CC)
 
+$(B)/client/%.o: $(SNDIODIR)/%.c
+	$(DO_CC)
+
 $(B)/client/%.o: $(SDLDIR)/%.c
 	$(DO_CC)
 
@@@@ -2223,7 +2228,7 @@@@ copyfiles: release
 	-$(MKDIR) -p -m 0755 $(COPYDIR)/missionpack
 
 ifneq ($(BUILD_CLIENT),0)
-	$(INSTALL) $(STRIP_FLAG) -m 0755 $(BR)/openarena$(FULLBINEXT) $(COPYBINDIR)/openarena$(FULLBINEXT)
+	$(INSTALL) $(STRIP_FLAG) -m 0755 $(BR)/openarena-client$(FULLBINEXT) $(COPYBINDIR)/openarena-client$(FULLBINEXT)
 endif
 
 # Don't copy the SMP until it's working together with SDL.
@@@@ -2233,7 +2238,7 @@@@ endif
 
 ifneq ($(BUILD_SERVER),0)
 	@@if [ -f $(BR)/oa_ded$(FULLBINEXT) ]; then \
-		$(INSTALL) $(STRIP_FLAG) -m 0755 $(BR)/oa_ded$(FULLBINEXT) $(COPYBINDIR)/oa_ded$(FULLBINEXT); \
+		$(INSTALL) $(STRIP_FLAG) -m 0755 $(BR)/openarena-server$(FULLBINEXT) $(COPYBINDIR)/openarena-server$(FULLBINEXT); \
 	fi
 endif
 
@


1.6
log
@Drop the MAP_ANONYMOUS chunk.
@
text
@d1 4
a4 3
$OpenBSD: patch-Makefile,v 1.5 2014/01/31 09:34:22 jca Exp $
--- Makefile.orig	Mon Dec 12 23:48:49 2011
+++ Makefile	Wed Jan 29 02:12:09 2014
d81 9
@


1.5
log
@Unbreak on i386 by disabling PIE.  ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.4 2012/03/18 15:47:28 kirby Exp $
d33 1
a33 1
+    -DUSE_ICON -DARCH_STRING=\\\"${ARCH}\\\" -DMAP_ANONYMOUS=MAP_ANON
@


1.4
log
@Update OpenArena to 0.8.8. Patch from Antti Harri, tested by me and Ryan Freeman.
Comments and OK from sthen@@.
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.3 2010/05/27 03:47:28 jakemsr Exp $
--- Makefile.orig	Tue Dec 13 00:48:49 2011
+++ Makefile	Wed Mar  7 11:21:26 2012
d30 1
a30 1
   BASE_CFLAGS = -Wall -fno-strict-aliasing -Wimplicit -Wstrict-prototypes \
d32 1
d47 6
a52 1
@@@@ -675,11 +675,12 @@@@ ifeq ($(PLATFORM),openbsd)
@


1.3
log
@* use the sndio backend from games/quake, since ao uses (essentially)
  the same audio engine as quake
* use -pthread instead of -lpthread for pthreads linkage
* oa defines an ALIGN macro, rename it to QALIGN to avoid clashing
  with the ALIGN macro from machine/param.h
* use /dev/arandom instead of /dev/urandom
ok jasper@@
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.2 2009/02/03 19:48:42 kili Exp $
--- Makefile.orig	Sat Aug  9 13:22:37 2008
+++ Makefile	Mon May  3 04:26:35 2010
@@@@ -143,13 +143,14 @@@@ endif
d21 1
a21 1
@@@@ -584,12 +585,11 @@@@ else # ifeq freebsd
a29 1
-
d31 4
a34 2
-    -DUSE_ICON $(shell sdl-config --cflags)
+    -DUSE_ICON -DARCH_STRING=\\\"${ARCH}\\\" $(shell sdl-config --cflags)
d36 2
a37 3
   ifeq ($(USE_OPENAL),1)
     BASE_CFLAGS += -DUSE_OPENAL
@@@@ -603,8 +603,8 @@@@ ifeq ($(PLATFORM),openbsd)
d40 9
a48 15
   BASE_CFLAGS += -DNO_VM_COMPILED -I/usr/X11R6/include -I/usr/local/include
-  RELEASE_CFLAGS=$(BASE_CFLAGS) -DNDEBUG -O3 \
-    -march=pentium -fomit-frame-pointer -pipe -ffast-math \
+  RELEASE_CFLAGS=$(BASE_CFLAGS) -DNDEBUG \
+    -fomit-frame-pointer -pipe -ffast-math \
     -falign-loops=2 -falign-jumps=2 -falign-functions=2 \
     -funroll-loops -fstrength-reduce
   HAVE_VM_COMPILED=false
@@@@ -615,16 +615,15 @@@@ ifeq ($(PLATFORM),openbsd)
   SHLIBCFLAGS=-fPIC
   SHLIBLDFLAGS=-shared $(LDFLAGS)
 
-  THREAD_LDFLAGS=-lpthread
+  THREAD_LDFLAGS=-pthread
   LDFLAGS=-lm
d50 2
a51 2
-  CLIENT_LDFLAGS =
+  CLIENT_LDFLAGS = $(shell sdl-config --libs) -lGL -lsndio
a52 2
-  CLIENT_LDFLAGS += $(shell sdl-config --libs) -lGL
-
d54 1
a54 1
+    CLIENT_LDFLAGS += $(THREAD_LDFLAGS)
d56 2
a57 2
-      CLIENT_LDFLAGS += $(THREAD_LDFLAGS) -lossaudio -lopenal
+      CLIENT_LDFLAGS += $(shell openal-config --libs)
d61 2
a62 2
@@@@ -781,13 +780,13 @@@@ endif #SunOS
 TARGETS =
d65 2
a66 2
-  TARGETS += $(B)/oa_ded.$(ARCH)$(BINEXT)
+  TARGETS += $(B)/openarena-server$(BINEXT)
d70 2
a71 2
-  TARGETS += $(B)/openarena.$(ARCH)$(BINEXT)
+  TARGETS += $(B)/openarena-client$(BINEXT)
d73 1
a73 2
-    TARGETS += $(B)/openarena-smp.$(ARCH)$(BINEXT)
+    TARGETS += $(B)/openarena-smp$(BINEXT)
d75 1
a75 3
 endif
 
@@@@ -1347,8 +1346,9 @@@@ Q3OBJ = \
d86 1
a86 1
@@@@ -1450,12 +1450,12 @@@@ Q3POBJ += \
d90 2
a91 8
-$(B)/openarena.$(ARCH)$(BINEXT): $(Q3OBJ) $(Q3POBJ) $(LIBSDLMAIN)
+$(B)/openarena-client$(BINEXT): $(Q3OBJ) $(Q3POBJ) $(LIBSDLMAIN)
 	$(echo_cmd) "LD $@@"
 	$(Q)$(CC) -o $@@ $(Q3OBJ) $(Q3POBJ) $(CLIENT_LDFLAGS) \
 		$(LDFLAGS) $(LIBSDLMAIN)
 
-$(B)/openarena-smp.$(ARCH)$(BINEXT): $(Q3OBJ) $(Q3POBJ_SMP) $(LIBSDLMAIN)
+$(B)/openarena-smp$(BINEXT): $(Q3OBJ) $(Q3POBJ_SMP) $(LIBSDLMAIN)
d93 4
a96 4
 	$(Q)$(CC) -o $@@ $(Q3OBJ) $(Q3POBJ_SMP) $(CLIENT_LDFLAGS) \
 		$(THREAD_LDFLAGS) $(LDFLAGS) $(LIBSDLMAIN)
@@@@ -1582,7 +1582,7 @@@@ else
     $(B)/ded/con_tty.o
d99 2
a100 2
-$(B)/oa_ded.$(ARCH)$(BINEXT): $(Q3DOBJ)
+$(B)/openarena-server$(BINEXT): $(Q3DOBJ)
d102 1
a102 1
 	$(Q)$(CC) -o $@@ $(Q3DOBJ) $(LDFLAGS)
d104 1
a104 1
@@@@ -1899,6 +1899,9 @@@@ $(B)/client/%.o: $(SPEEXDIR)/%.c
d114 1
a114 1
@@@@ -2037,17 +2040,17 @@@@ copyfiles: release
d118 2
a119 2
-	$(INSTALL) -s -m 0755 $(BR)/openarena.$(ARCH)$(BINEXT) $(COPYDIR)/openarena.$(ARCH)$(BINEXT)
+	$(INSTALL) -s -m 0755 $(BR)/openarena-client$(BINEXT) $(COPYDIR)/openarena-client$(BINEXT)
d123 1
a123 4
 #ifneq ($(BUILD_CLIENT_SMP),0)
-#	$(INSTALL) -s -m 0755 $(BR)/openarena-smp.$(ARCH)$(BINEXT) $(COPYDIR)/openarena-smp.$(ARCH)$(BINEXT)
+#	$(INSTALL) -s -m 0755 $(BR)/openarena-smp$(BINEXT) $(COPYDIR)/openarena-smp$(BINEXT)
 #endif
d126 3
a128 4
-	@@if [ -f $(BR)/oa_ded.$(ARCH)$(BINEXT) ]; then \
-		$(INSTALL) -s -m 0755 $(BR)/oa_ded.$(ARCH)$(BINEXT) $(COPYDIR)/oa_ded.$(ARCH)$(BINEXT); \
+	@@if [ -f $(BR)/openarena-server$(BINEXT) ]; then \
+		$(INSTALL) -s -m 0755 $(BR)/openarena-server$(BINEXT) $(COPYDIR)/openarena-server$(BINEXT); \
@


1.2
log
@
Unbreak for amd64.  Initial fix (for amd64 only) from Jordi Beltran
Creix (jbcreix.mail at gmail.com). Generalized for all LP64
architectures by me. At least in theory. Some tests on sparc64
didn't go very well, and nobody tested on other archs, so just keep
ONLY_FOR_ARCHS (with amd64 added) for now.

Antti Harri (MAINTAINER) agrees.
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.1.1.1 2008/10/27 13:29:02 weerd Exp $
--- Makefile.orig	Sat Aug  9 22:22:37 2008
+++ Makefile	Sun Jan 18 21:10:27 2009
@@@@ -143,8 +143,8 @@@@ endif
d15 7
a21 1
@@@@ -584,12 +584,11 @@@@ else # ifeq freebsd
d37 1
a37 1
@@@@ -603,8 +602,8 @@@@ ifeq ($(PLATFORM),openbsd)
d48 21
d86 12
a97 1
@@@@ -1450,12 +1449,12 @@@@ Q3POBJ += \
d112 1
a112 1
@@@@ -1582,7 +1581,7 @@@@ else
d121 11
a131 1
@@@@ -2037,17 +2036,17 @@@@ copyfiles: release
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
$OpenBSD$
--- Makefile.orig	Thu Aug  7 00:52:08 2008
+++ Makefile	Fri Aug 22 21:27:21 2008
d83 1
a83 1
@@@@ -2041,17 +2040,17 @@@@ copyfiles: release
@


1.1.1.1
log
@OpenArena is an open-source content package for Quake III Arena licensed
under the GPL, effectively creating a free stand-alone game. You do not
need Quake III Arena to play this game.

Not connected to builds yet. Discussed with jasper@@, robert@@ and
sthen@@.

@
text
@@
