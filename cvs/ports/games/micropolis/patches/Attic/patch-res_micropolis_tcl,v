head	1.3;
access;
symbols
	deanna_20080117:1.1.1.1 deanna:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2008.02.19.13.25.18;	author deanna;	state dead;
branches;
next	1.2;

1.2
date	2008.01.27.16.34.32;	author deanna;	state Exp;
branches;
next	1.1;

1.1
date	2008.01.18.03.36.32;	author deanna;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.01.18.03.36.32;	author deanna;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to a new snapshot.  Features SDL sound, pre-made cities and
lots of build system improvements.

ok espie
@
text
@$OpenBSD: patch-res_micropolis_tcl,v 1.2 2008/01/27 16:34:32 deanna Exp $
--- res/micropolis.tcl.orig	Sat Jan 26 18:55:37 2008
+++ res/micropolis.tcl	Sat Jan 26 18:58:20 2008
@@@@ -126,7 +126,8 @@@@ set ServerName "servername"
 set RealName "realname"
 set ChannelName "#Micropolis"
 set HomeDir ""
-set ResourceDir ""
+set ResourceDir "%%PREFIX%%/share/micropolis/res/"
+set Prefix "%%LOCALBASE%%/bin"
 set HostName ""
 set LocalHostName "[exec hostname]"
 set SaveCityWin ""
@@@@ -886,6 +887,12 @@@@ proc MakeWindow.frob {head {display ":0"}} {
 
 
 proc UIInitializeSound {} {
+  global Prefix
+  set i [system "pgrep -x esd > /dev/null"]
+  if {$i == 1} {
+    echo "starting esd"
+    system "$Prefix/esd &"
+  }
 }
 
 
@@@@ -940,10 +947,11 @@@@ proc UISetChannelVolume {win chan vol} {
 proc EchoPlaySound {soundspec} {
   # Temporary workaround to tell Python Sugar app to play sound.
   global Sound
+  global Prefix
   if {$Sound} {
     #echo PlaySound [lindex $soundspec 0]
     signal ignore SIGCHLD
-    exec res/sounds/player res/sounds/[string tolower [lindex $soundspec 0]].wav &
+    exec $Prefix/esdplay res/sounds/[string tolower [lindex $soundspec 0]].wav &
   }
 }
 
@


1.2
log
@- Build from a recent snapshot of the repository at git.zerfleddert.de
  instead of the tarball from laptop.org.  Lets us get rid of many
  patches.

- Enable shared memory (run without -w) since kurt@@'s patch has fixed
  it.

This gives us many bugfixes and goodies such as a fix for the numlock
freeze bug and re-enabling the air crash disaster.  Full changelog at

http://git.zerfleddert.de/cgi-bin/gitweb.cgi/micropolis
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@Initial revision
@
text
@d2 3
a4 3
--- res/micropolis.tcl.orig	Thu Dec  6 17:49:20 2007
+++ res/micropolis.tcl	Tue Jan 15 20:53:58 2008
@@@@ -125,7 +125,8 @@@@ set ServerName "servername"
d14 1
a14 12
@@@@ -412,8 +413,8 @@@@ sim ResetDynamic
 # the font in res (because it's already in the system fonts).  These lines
 # are for other systems that lack the font.
 set FontPath "[pwd]/res/dejavu-lgc"
-system "xset -fp $FontPath >&/dev/null"
-system "xset +fp $FontPath >&/dev/null"
+system "xset -fp $FontPath >/dev/null 2>&1"
+system "xset +fp $FontPath >/dev/null 2>&1"
 
 
 ########################################################################
@@@@ -885,6 +886,12 @@@@ proc MakeWindow.frob {head {display ":0"}} {
d27 1
a27 1
@@@@ -939,8 +946,11 @@@@ proc UISetChannelVolume {win chan vol} {
d33 3
a35 3
-    echo PlaySound [lindex $soundspec 0]
+    #echo PlaySound [lindex $soundspec 0]
+    signal ignore SIGCHLD
a38 26
 
@@@@ -3099,8 +3109,10 @@@@ proc ShowSplashOf {head} {
 
 
 proc WithdrawSplashOf {head} {
-  set win WindowLink $head.splash]
-  wm withdraw $win
+  set win [WindowLink $head.splash]
+  if {$win != {}} {
+    wm withdraw $win
+  }
 }
 
 
@@@@ -3150,8 +3162,10 @@@@ proc ShowScenarioOf {head} {
 
 
 proc WithdrawScenarioOf {head} {
-  set win WindowLink $head.scenario]
-  wm withdraw $win
+  set win [WindowLink $head.scenario]
+  if {$win != {}} {
+    wm withdraw $win
+  }
 }
 
@


1.1.1.1
log
@Import micropolis

Micropolis, Unix Version, (A.K.A. "S*mC*ty"). This game was released
for the Unix platform in or about 1990 and has been modified for
inclusion in the One Laptop Per Child program. Copyright (C) 1989 -
2007 Electronic Arts Inc.

This port is based on patches written by Michael Gernoth, located at
http://git.zerfleddert.de/cgi-bin/gitweb.cgi/micropolis

Help from kurt@@ and ian@@, tested by lots of people, thanks!

ok ian@@, espie@@

@
text
@@
