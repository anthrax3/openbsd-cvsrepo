head	1.7;
access;
symbols
	OPENBSD_6_1:1.5.0.2
	OPENBSD_6_1_BASE:1.5
	awolk_20161228:1.1.1.1
	awolk:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2017.05.31.08.08.16;	author espie;	state Exp;
branches;
next	1.6;
commitid	ij92FtFXiSiT1ani;

1.6
date	2017.05.27.05.16.18;	author espie;	state Exp;
branches;
next	1.5;
commitid	939sXf26B9ScRD7B;

1.5
date	2017.03.27.18.28.29;	author jca;	state Exp;
branches;
next	1.4;
commitid	L6NNFC8mX8ATXZBs;

1.4
date	2017.03.03.21.29.00;	author jca;	state Exp;
branches;
next	1.3;
commitid	DYcNZXFsPsjsZgVZ;

1.3
date	2017.03.03.21.03.32;	author jca;	state Exp;
branches;
next	1.2;
commitid	bqN5ynMaZpGUI9yW;

1.2
date	2016.12.29.14.07.11;	author awolk;	state Exp;
branches;
next	1.1;
commitid	0x2Awddz0S21HXZw;

1.1
date	2016.12.28.18.34.57;	author awolk;	state Exp;
branches
	1.1.1.1;
next	;
commitid	eqWJq46RbIxBPere;

1.1.1.1
date	2016.12.28.18.34.57;	author awolk;	state Exp;
branches;
next	;
commitid	eqWJq46RbIxBPere;


desc
@@


1.7
log
@switch everything to new COMPILER idiom, even stuff that won't build with clang
yet, but at least that part is done.
@
text
@# $OpenBSD: Makefile,v 1.6 2017/05/27 05:16:18 espie Exp $

COMMENT-main =	graphical sdl rogue-like game
COMMENT-data =	data for Tales of Maj'Eyal

# '

V =		1.5.1
PKGNAME-main =	tome4-${V}
PKGNAME-data =	tome4-data-${V}
CATEGORIES =	games x11

MASTER_SITES =	http://te4.org/dl/t-engine/ \
		http://distfiles-openbsd.perso.pw/
DISTNAME =	t-engine4-src-${V}
EXTRACT_SUFX =	.tar.bz2
HOMEPAGE =	http://te4.org

MULTI_PACKAGES =-main -data

MAINTAINER =	Solene Rapenne <solene@@perso.pw>

# GPLV3+ and bundled MIT, zlib, BSD in games/thirdparty/licenses/
PERMIT_PACKAGE_CDROM =	Yes

WANTLIB-main =	GL GLU SDL2 SDL2_image SDL2_ttf openal c m \
		png pthread vorbisfile

BUILD_DEPENDS =	devel/premake4

LIB_DEPENDS-main =	devel/sdl2 \
			devel/sdl2-image \
			devel/sdl2-ttf \
			audio/libvorbis \
			audio/openal

RUN_DEPENDS-main =	games/tome4,-data

LIB_DEPENDS-data =
WANTLIB-data =

COMPILER =	gcc
COMPILER_LANGS =	c


NO_TEST =	Yes

USE_GMAKE =	Yes
MAKE_FLAGS =	verbose=1 CC='${CC}'
MAKE_ENV =	config=release

GAMEDIR =	${PREFIX}/share/tome4
SUBST_VARS +=	GAMEDIR V

# The build system hardcodes the use of the "gcc" command
do-configure:
	sed -i 's/gcc /${CC} /g' ${WRKSRC}/build/te4core.lua
	${SUBST_CMD} ${WRKSRC}/src/getself.c
	${SUBST_CMD} ${WRKSRC}/premake4.lua
	@@cd ${WRKSRC} ; premake4 gmake

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/t-engine ${PREFIX}/bin/tome4
	${INSTALL_DATA_DIR} ${GAMEDIR}
	cd ${WRKSRC}; tar cf - bootstrap game | tar xf - -C ${GAMEDIR}
	rm -R ${GAMEDIR}/game/modules/example*
	rm ${GAMEDIR}/bootstrap/boot.lua.orig

.include <bsd.port.mk>
@


1.6
log
@WANT_CXX ignore build system
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2017/03/27 18:28:29 jca Exp $
d42 3
a44 3
# The build system hardcodes the use of the "gcc" command
WANT_CXX =	base gcc
MODGCC4_LANGS =	c
d46 1
a46 1
NO_TEST =	YES
d48 1
a48 1
USE_GMAKE =	YES
d55 1
@


1.5
log
@Update to tome4-1.5.1

While here, add a fallback mirror hosted by Solene, upstream used to
modifiy existing tarballs in the past.  Also, amend SUBST_VARS to avoid
PLIST churn when updating to newer versions.  Initial diff from, and
tweaks discussed with Solene Rapenne (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2017/03/03 21:29:00 jca Exp $
d6 2
d43 2
a44 2
MODULES =	gcc4
MODGCC4_ARCHS =	*
d49 1
a49 1
MAKE_FLAGS =	verbose=1
@


1.4
log
@Add a comment that tome4 hardcodes the use of "gcc"
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2017/03/03 21:03:32 jca Exp $
d6 1
a6 1
V =		1.4.9
d11 2
a12 4
REVISION-main =	0
REVISION-data =	0

MASTER_SITES =	http://te4.org/dl/t-engine/
a39 3
GAMEDIR =	${PREFIX}/share/tome4
SUBST_VARS =	GAMEDIR

d50 3
d63 2
a64 1

@


1.3
log
@Let this build on archs without /usr/bin/gcc

gcc is still used for the build, but symlinks are added to ${WRKDIR}/bin
by the gcc4 module.  devel/premake4 is probably the source of the
hardcoded "gcc" use.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2016/12/29 14:07:11 awolk Exp $
d45 1
@


1.2
log
@Fix games/tome4 problems

spoted by ajacoutot & fcambus

 - MODGCC_ARCHS changed to MODGCC4_ARCHS
 - MODGCC_LANGS removed as language 'c' is the default
   so setting this variable is not needed here
 - Updated patch-premake4_lua to use variable substitution
   instead of hard-coded paths
 - Added share/tome4/ and share/tome4/game/ to PLIST-data
   and remove it from PLIST-main. Without it removing tome4
   would error out informing about non empty directories
 - Simplified the RUN_DEPENDS-main line, the way it was
   done previously prevented REVISION bumps from working
 - bumped REVISION of both packages to 0

OK ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2016/12/28 18:34:57 awolk Exp $
d55 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d11 3
d37 1
a37 1
RUN_DEPENDS-main =	${FULLPKGNAME-data}:${BUILD_PKGPATH},-data
d46 1
a46 2
MODGCC_ARCHS =	*
MODGCC_LANGS =	c
d56 1
@


1.1.1.1
log
@Import games/tome4

OK fcambus@@

note: upstream is known to re-roll tarballs silently see
        http://forums.te4.org/viewtopic.php?f=42&t=47073
      for details.

$ cat pkg/DESCR-main
Tales of Maj'Eyal (ToME) is a free, open source roguelike RPG,
featuring tactical turn-based combat and advanced character building.
Play as one of many unique races and classes in the lore-filled world
of Eyal, exploring random dungeons, facing challenging battles, and
developing characters with your own tailored mix of abilities and
powers.  With a modern graphical and customisable interface, intuitive
mouse control, streamlined mechanics and deep, challenging combat,
Tales of Maj'Eyal offers engaging roguelike gameplay for the 21st
century.

This package contains the engine of the game.

@
text
@@
