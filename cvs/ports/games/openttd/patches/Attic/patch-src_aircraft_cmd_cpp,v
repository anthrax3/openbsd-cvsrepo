head	1.1;
access;
symbols
	OPENBSD_5_4:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2013.12.15.14.19.28;	author jasper;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2013.12.15.14.19.28;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-src_aircraft_cmd_cpp was initially added on branch OPENBSD_5_4.
@
text
@@


1.1.2.1
log
@Security fix for CVE-2013-6411 openttd: DoS using forcefully crashed aircrafts
@
text
@a0 16
$OpenBSD$

Security fix for CVE-2013-6411 openttd: DoS using forcefully crashed aircrafts
http://hg.openttd.org/openttd/trunk.hg/rev/63863984952a?utm_medium=twitter&utm_source=twitterfeed

--- src/aircraft_cmd.cpp.orig	Fri May 31 22:57:15 2013
+++ src/aircraft_cmd.cpp	Wed Dec 11 17:04:12 2013
@@@@ -1021,7 +1021,7 @@@@ static bool HandleCrashedAircraft(Aircraft *v)
 
 	/* make aircraft crash down to the ground */
 	if (v->crashed_counter < 500 && st == NULL && ((v->crashed_counter % 3) == 0) ) {
-		int z = GetSlopePixelZ(v->x_pos, v->y_pos);
+		int z = GetSlopePixelZ(Clamp(v->x_pos, 0, MapMaxX() * TILE_SIZE), Clamp(v->y_pos, 0, MapMaxY() * TILE_SIZE));
 		v->z_pos -= 1;
 		if (v->z_pos == z) {
 			v->crashed_counter = 500;
@

