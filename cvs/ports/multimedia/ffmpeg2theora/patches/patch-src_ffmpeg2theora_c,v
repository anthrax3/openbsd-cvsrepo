head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.14
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.12
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.10
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.6
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.8
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.4
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.2
	OPENBSD_5_6_BASE:1.3;
locks; strict;
comment	@# @;


1.3
date	2014.04.06.20.13.53;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2013.01.14.02.15.46;	author brad;	state dead;
branches;
next	1.1;

1.1
date	2012.09.12.07.07.21;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Remove the use of deprecated API for FFmpeg.

ok ajacoutot@@
@
text
@$OpenBSD$

Deal with deprecated FFmpeg API.

--- src/ffmpeg2theora.c.orig	Thu Apr  3 01:58:34 2014
+++ src/ffmpeg2theora.c	Thu Apr  3 01:59:08 2014
@@@@ -47,6 +47,8 @@@@
 #include "ffmpeg2theora.h"
 #include "avinfo.h"
 
+#define MAX_AUDIO_FRAME_SIZE 192000 // 1 second of 48khz 32bit audio
+
 #define LENGTH(x) (sizeof(x) / sizeof(*x))
 
 enum {
@@@@ -1068,8 +1070,8 @@@@ void ff2theora_output(ff2theora this) {
         int first = 1;
         int audio_eos = 0, video_eos = 0, audio_done = 0, video_done = 0;
         int ret;
-        int16_t *audio_buf=av_malloc(4*AVCODEC_MAX_AUDIO_FRAME_SIZE);
-        int16_t *resampled=av_malloc(4*AVCODEC_MAX_AUDIO_FRAME_SIZE);
+        int16_t *audio_buf=av_malloc(4*MAX_AUDIO_FRAME_SIZE);
+        int16_t *resampled=av_malloc(4*MAX_AUDIO_FRAME_SIZE);
         int16_t *audio_p=NULL;
         int no_frames;
         int no_samples;
@@@@ -1530,7 +1532,7 @@@@ void ff2theora_output(ff2theora this) {
                 while((audio_eos && !audio_done) || avpkt.size > 0 ) {
                     int samples=0;
                     int samples_out=0;
-                    int data_size = 4*AVCODEC_MAX_AUDIO_FRAME_SIZE;
+                    int data_size = 4*MAX_AUDIO_FRAME_SIZE;
                     int bytes_per_sample = av_get_bytes_per_sample(aenc->sample_fmt);
 
                     if (avpkt.size > 0) {
@


1.2
log
@Update after FFmpeg 20121026 update.

ok sthen@@
@
text
@d1 35
a35 12
$OpenBSD: patch-src_ffmpeg2theora_c,v 1.1 2012/09/12 07:07:21 ajacoutot Exp $
--- src/ffmpeg2theora.c.orig	Tue Sep 11 14:35:27 2012
+++ src/ffmpeg2theora.c	Tue Sep 11 14:46:54 2012
@@@@ -2970,7 +2970,7 @@@@ int main(int argc, char **argv) {
                 fprintf(stderr,"\nUnable to decode input.\n");
             return(1);
         }
-        avformat_close_input(&convert->context);
+        av_close_input_file(convert->context);
     }
     else{
         if (info.frontend)
@


1.1
log
@Update to ffmpeg2theora-0.29.

from Brad
@
text
@d1 1
a1 1
$OpenBSD$
@

