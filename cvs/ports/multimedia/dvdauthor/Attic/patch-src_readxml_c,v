head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2005.12.08.05.56.49;	author jakemsr;	state dead;
branches;
next	1.1;

1.1
date	2005.12.08.05.47.28;	author jakemsr;	state Exp;
branches;
next	;


desc
@@


1.2
log
@wtf?  maybe I had a couple Terminal Gravitys before I made this commit,
but I did _not_ do a 'cvs add' of this directory structure.

cvs saiz, "sorry 'bout the noise".
@
text
@$OpenBSD: patch-src_readxml_c,v 1.1 2005/12/08 05:47:28 jakemsr Exp $
--- src/readxml.c.orig	Mon Dec  5 20:52:14 2005
+++ src/readxml.c	Mon Dec  5 20:57:19 2005
@@@@ -34,6 +34,8 @@@@
 #include <locale.h>
 #endif
 
+#include <localcharset.h>
+
 static const char RCSID[]="$Id: patch-src_readxml_c,v 1.1 2005/12/08 05:47:28 jakemsr Exp $";
 
 int parser_err=0, parser_acceptbody=0;
@@@@ -207,7 +209,7 @@@@ static iconv_t get_conv()
             }
         } else
             fprintf(stderr,"WARN: Error reading locale (%m), assuming C\n");
-        enc=nl_langinfo(CODESET);
+        enc=locale_charset();
         fprintf(stderr,"INFO: Converting filenames to %s\n",enc);
         ic=iconv_open(enc,"UTF-8");
         if( ic==((iconv_t)-1) ) {
@


1.1
log
@- use locale_charset() from libiconv instead if nl_langinfo(CODESET)
  directly to get the codeset.  locale_charset() canonicalizes the
  codeset name "646", which libiconv does not understand, to "ASCII",
  which libiconv does understand.
- use my OpenBSD email address
- and of course, bump the PKGNAME

OK jolan@@
@
text
@d1 1
a1 1
$OpenBSD$
d10 1
a10 1
 static const char RCSID[]="$Id: //depot/dvdauthor/src/readxml.c#17 $";
@

