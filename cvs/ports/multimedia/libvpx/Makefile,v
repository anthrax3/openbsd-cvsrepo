head	1.29;
access;
symbols
	OPENBSD_6_1:1.27.0.2
	OPENBSD_6_1_BASE:1.27
	OPENBSD_6_0:1.24.0.2
	OPENBSD_6_0_BASE:1.24
	OPENBSD_5_9:1.22.0.2
	OPENBSD_5_9_BASE:1.22
	OPENBSD_5_8:1.21.0.4
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.19.0.2
	OPENBSD_5_7_BASE:1.19
	OPENBSD_5_6:1.15.0.2
	OPENBSD_5_6_BASE:1.15
	OPENBSD_5_5:1.12.0.2
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.11.0.2
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.10.0.2
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.9.0.2
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.4
	OPENBSD_5_0:1.7.0.2
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.6.0.2
	OPENBSD_4_9_BASE:1.6
	ckuethe_20101004:1.1.1.1
	ckuethe:1.1.1;
locks; strict;
comment	@# @;


1.29
date	2017.05.13.10.33.14;	author espie;	state Exp;
branches;
next	1.28;
commitid	xjqcKVpidK6S21C6;

1.28
date	2017.04.10.11.46.23;	author sthen;	state Exp;
branches;
next	1.27;
commitid	BLsh88fJB8thZTwY;

1.27
date	2017.03.08.02.22.14;	author jca;	state Exp;
branches;
next	1.26;
commitid	ogLwEwzm9vCeGWED;

1.26
date	2017.01.15.09.59.11;	author ajacoutot;	state Exp;
branches;
next	1.25;
commitid	GKi2f0UlSuvApYRZ;

1.25
date	2016.08.07.01.33.52;	author ajacoutot;	state Exp;
branches;
next	1.24;
commitid	Ff3yLMKH563GGm0b;

1.24
date	2016.03.10.22.51.45;	author naddy;	state Exp;
branches;
next	1.23;
commitid	D0hGQOTgJEa4SK1D;

1.23
date	2016.03.05.16.04.06;	author pascal;	state Exp;
branches;
next	1.22;
commitid	EJSWd5DpdfEFGBlM;

1.22
date	2015.11.13.07.14.26;	author ajacoutot;	state Exp;
branches;
next	1.21;
commitid	v8oVJJILth66Yude;

1.21
date	2015.04.26.07.58.22;	author ajacoutot;	state Exp;
branches;
next	1.20;
commitid	5ZWrxJX3TDw6pU0R;

1.20
date	2015.04.17.07.58.12;	author phessler;	state Exp;
branches;
next	1.19;
commitid	AmsShgXioKYXIB8f;

1.19
date	2015.02.11.00.07.47;	author brad;	state Exp;
branches;
next	1.18;
commitid	UEtgl7WfSjTHftzK;

1.18
date	2015.01.16.11.30.05;	author brad;	state Exp;
branches;
next	1.17;
commitid	dptV6rCkomaPO3MZ;

1.17
date	2014.09.23.21.38.49;	author landry;	state Exp;
branches;
next	1.16;
commitid	xvs498wGoGPFaEXL;

1.16
date	2014.08.19.05.51.58;	author landry;	state Exp;
branches;
next	1.15;
commitid	mvk50yDSvCl9MvB9;

1.15
date	2014.05.06.04.19.55;	author brad;	state Exp;
branches
	1.15.2.1;
next	1.14;

1.14
date	2014.04.29.23.58.06;	author brad;	state Exp;
branches;
next	1.13;

1.13
date	2014.03.17.14.01.08;	author brad;	state Exp;
branches;
next	1.12;

1.12
date	2013.08.07.21.32.15;	author naddy;	state Exp;
branches;
next	1.11;

1.11
date	2013.03.11.11.35.44;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2012.08.27.20.42.25;	author jasper;	state Exp;
branches;
next	1.9;

1.9
date	2012.05.22.18.22.50;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2012.02.28.12.28.29;	author dcoppa;	state Exp;
branches;
next	1.7;

1.7
date	2011.03.17.16.54.16;	author edd;	state Exp;
branches;
next	1.6;

1.6
date	2010.11.19.07.23.13;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2010.11.06.23.28.23;	author jakemsr;	state Exp;
branches;
next	1.4;

1.4
date	2010.10.31.21.05.38;	author ckuethe;	state Exp;
branches;
next	1.3;

1.3
date	2010.10.07.18.59.47;	author kili;	state Exp;
branches;
next	1.2;

1.2
date	2010.10.05.04.53.50;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.10.04.23.56.16;	author ckuethe;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.10.04.23.56.16;	author ckuethe;	state Exp;
branches;
next	;

1.15.2.1
date	2015.01.16.11.33.47;	author brad;	state Exp;
branches;
next	1.15.2.2;
commitid	fSHNhMW6aQwvltla;

1.15.2.2
date	2015.02.11.02.05.28;	author brad;	state Exp;
branches;
next	;
commitid	XKpBTrqV2TezLxYx;


desc
@@


1.29
log
@vpx builds just fine with base clang instead of ports clang, unhardcode
libestdc++ accordingly.
@
text
@# $OpenBSD: Makefile,v 1.28 2017/04/10 11:46:23 sthen Exp $

COMMENT=	Google VP8/VP9 video codec

DISTNAME=	libvpx-1.6.1
CATEGORIES=	multimedia
MASTER_SITES=	https://storage.googleapis.com/downloads.webmproject.org/releases/webm/
EXTRACT_SUFX=	.tar.bz2

SHARED_LIBS=	vpx	8.0

HOMEPAGE=	http://www.webmproject.org/

MAINTAINER=	Brad Smith <brad@@comstyle.com>

# BSD
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB=	c m pthread ${LIBCXX}

.include <bsd.port.arch.mk>
.if !${PROPERTIES:Mclang}
MODULES =	lang/clang

MODCLANG_ARCHS=amd64 i386
MODCLANG_LANGS=	c c++
.endif

.if ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "i386"
BUILD_DEPENDS+=	devel/yasm
.endif

MAKE_FLAGS=	LIBVPX_VERSION=${LIBvpx_VERSION} verbose=yes

USE_GMAKE=	Yes
CONFIGURE_STYLE= simple
CONFIGURE_ARGS+=--enable-shared \
		--prefix=${PREFIX} \
		--disable-optimizations \
		--disable-unit-tests

NO_TEST=	Yes

ALL_TARGET=

post-install:
	@@chown ${BINOWN}:${BINGRP} ${PREFIX}/bin/*
	@@chmod ${BINMODE} ${PREFIX}/bin/*
	@@chown ${SHAREOWN}:${SHAREGRP} ${PREFIX}/include/vpx/*.h
	@@chmod ${SHAREMODE} ${PREFIX}/include/vpx/*.h
	@@chown ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/lib*
	@@chmod ${SHAREMODE} ${PREFIX}/lib/lib*
	@@chown ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/pkgconfig/vpx.pc
	@@chmod ${SHAREMODE} ${PREFIX}/lib/pkgconfig/vpx.pc

.include <bsd.port.mk>
@


1.28
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2017/03/08 02:22:14 jca Exp $
d21 3
a23 1
MODULES=	lang/clang
d25 1
a25 1
MODCLANG_ARCHS=	amd64 i386
d27 1
@


1.27
log
@No need to force CC/CXX/LD any more

ok Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2017/01/15 09:59:11 ajacoutot Exp $
d19 1
a19 1
WANTLIB=	c m pthread stdc++
@


1.26
log
@Update to libvpx-1.6.1.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2016/08/07 01:33:52 ajacoutot Exp $
a37 5
CONFIGURE_ENV=	LD="${CC}"
.if ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "i386"
CONFIGURE_ENV+=	CC="clang" \
		CXX="clang++"
.endif
@


1.25
log
@Update to libvpx-1.6.0.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2016/03/10 22:51:45 naddy Exp $
d5 1
a5 1
DISTNAME=	libvpx-1.6.0
@


1.24
log
@remove simple instances of NO_SHARED_LIBS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2016/03/05 16:04:06 pascal Exp $
d5 1
a5 1
DISTNAME=	libvpx-1.5.0
a8 1
REVISION=	0
d10 1
a10 1
SHARED_LIBS=	vpx	7.0
@


1.23
log
@Bump REVISION for lang/clang MODULE changes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2015/11/13 07:14:26 ajacoutot Exp $
d35 2
a36 1
CONFIGURE_ARGS+=--prefix=${PREFIX} \
a59 4

.if ${NO_SHARED_LIBS:L} == "no"
CONFIGURE_ARGS+=--enable-shared
.endif
@


1.22
log
@Update to libvpx-1.5.0.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2015/04/26 07:58:22 ajacoutot Exp $
d9 1
@


1.21
log
@Update to libvpx-1.4.0.
Run-time tested on amd64, i386 and sparc64. Build tested on hppa.

from brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2015/04/17 07:58:12 phessler Exp $
d5 1
a5 1
DISTNAME=	libvpx-1.4.0
d10 1
a10 1
SHARED_LIBS=	vpx	6.0
@


1.20
log
@use lower optimization levels, so compiles work on sparc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2015/02/11 00:07:47 brad Exp $
d5 1
a5 4
V=		1.3.0
DISTNAME=	libvpx-v${V}
PKGNAME=	libvpx-${V}
REVISION=	1
d7 1
a7 1
MASTER_SITES=	https://webm.googlecode.com/files/
d10 1
a10 1
SHARED_LIBS=	vpx	5.0
d19 1
a19 3
WANTLIB=	c m pthread

BUILD_DEPENDS+=	shells/bash
d24 1
a29 3
BASH=		${LOCALBASE}/bin/bash
SUBST_VARS=	BASH

a31 6
# compiler spins at 100% CPU on vp9/vp9_cx_iface.c. using -O1
# works around the issue.
.if ${MACHINE_ARCH} == "hppa" || ${MACHINE_ARCH} == "sparc64" ||${MACHINE_ARCH} == "sparc"
CFLAGS+=	-O1
.endif

d39 2
a40 1
CONFIGURE_ENV+=	CC="clang"
a45 6

SUBST_FILES=	examples/gen_example_code.sh \
		examples/gen_example_text.sh

pre-configure:
	@@cd ${WRKDIST} && ${SUBST_CMD} ${SUBST_FILES}
@


1.19
log
@Bring in fixes for the stack overflows with the SSE2 code on i386 and
fixes for the AVX detection (yes, just because a CPU has AVX support
does not mean the kernel does too -- silly Google developers).

Thanks to Mikolaj Kucharski <mikolaj at kucharski dot name> for reporting
the stack overflows, testing proposed patches and this back ported patch
against the current release.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2015/01/16 11:30:05 brad Exp $
d41 1
a41 1
.if ${MACHINE_ARCH} == "hppa" || ${MACHINE_ARCH} == "sparc64"
@


1.18
log
@Use a workaround on i386 for the stack overflows in the VP9 assembly code.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2014/09/23 21:38:49 landry Exp $
d8 1
a8 1
REVISION=	0
a49 5
# very heavy handed workaround for the stack overflows in the
# VP9 assembly code.
.if ${MACHINE_ARCH} == "i386"
CONFIGURE_ARGS+=--disable-use-x86inc
.endif
@


1.17
log
@Fix build on hppa by using -O1, from brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2014/08/19 05:51:58 landry Exp $
d8 1
d50 5
@


1.16
log
@BROKEN-hppa, constantly hits the 12h timeout building the same file...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2014/05/06 04:19:55 brad Exp $
a3 1
BROKEN-hppa =	build stuck on vp9/vp9_cx_iface.c
d40 1
a40 1
.if ${MACHINE_ARCH} == "sparc64"
@


1.15
log
@Mention the particular file in the comment.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2014/04/29 23:58:06 brad Exp $
d4 1
@


1.15.2.1
log
@Use a workaround on i386 for the stack overflows in the VP9 assembly code.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2014/05/06 04:19:55 brad Exp $
a7 1
REVISION=	0
a48 5
# very heavy handed workaround for the stack overflows in the
# VP9 assembly code.
.if ${MACHINE_ARCH} == "i386"
CONFIGURE_ARGS+=--disable-use-x86inc
.endif
@


1.15.2.2
log
@Bring in fixes for the stack overflows with the SSE2 code on i386 and
fixes for the AVX detection (yes, just because a CPU has AVX support
does not mean the kernel does too -- silly Google developers).

Thanks to Mikolaj Kucharski <mikolaj at kucharski dot name> for reporting
the stack overflows, testing proposed patches and this back ported patch
against the current release.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15.2.1 2015/01/16 11:33:47 brad Exp $
d8 1
a8 1
REVISION=	1
d50 5
@


1.14
log
@Update to libvpx 1.3.0.

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2014/03/17 14:01:08 brad Exp $
d38 1
a38 1
# compiler spins at 100% CPU on one particular file. using -O1
@


1.13
log
@Update to libvpx 1.2.0.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2013/08/07 21:32:15 naddy Exp $
d3 1
a3 1
COMMENT=	Google VP8 video codec
d5 1
a5 1
V=		1.2.0
d12 1
a12 1
SHARED_LIBS=	vpx	4.1
d25 4
d38 6
d50 3
d58 1
a58 5
SUBST_FILES=	build/make/configure.sh \
		build/make/gen_asm_deps.sh \
		build/make/version.sh \
		configure \
		examples/gen_example_code.sh \
@


1.12
log
@move http://code.google.com, *.googlecode.com, and sites.google.com to https
suggested by bentley@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2013/03/11 11:35:44 espie Exp $
d5 1
a5 1
V=		1.1.0
a7 1
REVISION=	0
d12 1
a12 1
SHARED_LIBS=	vpx	4.0
d37 2
a38 1
		--disable-optimizations
@


1.11
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2012/08/27 20:42:25 jasper Exp $
d10 1
a10 1
MASTER_SITES=	http://webm.googlecode.com/files/
@


1.10
log
@- remove -pthread patching and pass --no-undefined now that that's accepted

from brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2012/05/22 18:22:50 ajacoutot Exp $
a20 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d41 1
a41 1
NO_REGRESS=	Yes
@


1.9
log
@Update to libvpx 1.1.0.
Also patched to fix operation on strict alignment archs: this fixes
libvpx on alpha/arm/hppa/mips64/sparc/sparc64.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2012/02/28 12:28:29 dcoppa Exp $
d8 1
d42 1
@


1.8
log
@Update to libvpx 1.0.0.

From brad, with tweaks by me.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2011/03/17 16:54:16 edd Exp $
d5 1
a5 1
V=		1.0.0
d12 1
a12 1
SHARED_LIBS=	vpx	3.0
@


1.7
log
@update to libvpx 0.9.6 from brad.

OK by MAINTAINER (brad)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/11/19 07:23:13 espie Exp $
d5 1
a5 1
V=		0.9.6
d12 1
a12 1
SHARED_LIBS=	vpx	2.0
d23 1
d63 2
@


1.6
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/11/06 23:28:23 jakemsr Exp $
d5 1
a5 1
V=		0.9.5
a7 1
REVISION=	0
d12 1
a12 1
SHARED_LIBS=	vpx	1.0
d57 1
d59 1
d61 1
@


1.5
log
@let it build on sparc64
from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/10/31 21:05:38 ckuethe Exp $
d26 1
a26 1
BUILD_DEPENDS+=	::shells/bash
d29 1
a29 1
BUILD_DEPENDS+=	::devel/yasm
@


1.4
log
@update to libvpx 0.9.5, from brad. tested with an upcoming update of mplayer
ok edd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/10/07 18:59:47 kili Exp $
d8 1
@


1.3
log
@Don't pick up and use doxygen (wasting time) when it's installed.
From brad, who sent me this version a couple of days when i did
some testing ov libvpx and whined about my valuable cpu cycles.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/10/05 04:53:50 ajacoutot Exp $
d5 1
a5 1
V=		0.9.2
a7 1
REVISION=	1
d12 1
a12 1
SHARED_LIBS=	vpx	0.0
a42 2
WRKDIST=	${WRKDIR}/libvpx-${V}

d45 1
a45 2
SUBST_FILES=	build/make/armlink_adapter.sh \
		build/make/configure.sh \
a46 3
		build/make/gen_msvs_def.sh \
		build/make/gen_msvs_proj.sh \
		build/make/gen_msvs_sln.sh \
d50 1
a50 2
		examples/gen_example_text.sh \
		release.sh
d63 1
a63 3
CONFIGURE_ENV+=	CFLAGS+=-fPIC
CONFIGURE_ARGS+=--enable-shared \
		--enable-pic
@


1.2
log
@Typo.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/10/04 23:56:16 ckuethe Exp $
d8 1
a11 2

REVISION=	0
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2010/06/15 10:07:41 sebastia Exp $
d11 2
@


1.1.1.1
log
@import of the Google/ON2 VP8 codec, from brad
@
text
@@
