head	1.2;
access;
symbols
	OPENBSD_6_2:1.2.0.20
	OPENBSD_6_2_BASE:1.2
	OPENBSD_6_1:1.2.0.18
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.16
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.12
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.14
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.10
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.8
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.6
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.4
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2;
locks; strict;
comment	@# @;


1.2
date	2012.08.20.11.51.00;	author pascal;	state Exp;
branches;
next	1.1;

1.1
date	2012.08.11.22.58.18;	author pascal;	state Exp;
branches;
next	;


desc
@@


1.2
log
@After feedback from kettenis@@, we won't be defining -DPIC on PIE archs per
default.  Garbage collect the patches that dealt with these issues, and use
the builtin define __PIC__ to detect if we're PIE/PIC.

ok naddy@@
@
text
@$OpenBSD: patch-avidemux_ADM_libraries_ADM_utilities_ADM_imageUtils_cpp,v 1.1 2012/08/11 22:58:18 pascal Exp $
--- avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp.orig	Fri Aug 10 18:45:14 2012
+++ avidemux/ADM_libraries/ADM_utilities/ADM_imageUtils.cpp	Fri Aug 10 18:46:38 2012
@@@@ -60,7 +60,7 @@@@ int a1,a2;
         
         return 1;
 }
-#if defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#if (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(__PIC__)
 static uint8_t tinyAverageMMX(uint8_t *dst, uint8_t *src1, uint8_t *src2,uint32_t l)
 {
 int delta;
@@@@ -118,7 +118,7 @@@@ int a1,a2;
 
 uint8_t ADMImage::merge(ADMImage *src1,ADMImage *src2)
 {
-#if 1 && defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#if 1 && (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(__PIC__)
         if(CpuCaps::hasMMX())
         {
                 tinyAverageMMX(YPLANE(this),YPLANE(src1),YPLANE(src2),(_width*_height*3)>>1);
@@@@ -149,7 +149,7 @@@@ uint32_t ww,hh;
         }
         return df;
 }
-#if defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#if (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(__PIC__)
 static uint64_t noise64 asm(MANGLE(noise64));
 static uint32_t computeDiffMMX(uint8_t  *s1,uint8_t *s2,uint32_t noise,uint32_t l)
 {
@@@@ -239,7 +239,7 @@@@ uint32_t result=0;
 uint32_t ADMImage::lumaDiff(ADMImage *src1,ADMImage *src2,uint32_t noise)
 {
 
-#if 1 && defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#if 1 && (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(__PIC__)
 uint32_t r1,r2;
         if(CpuCaps::hasMMX())
         {
@@@@ -279,7 +279,7 @@@@ int a1,a2;
                 }
         return 1;
 }
-#if defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#if (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(__PIC__)
 static uint8_t tinySubstractMMX(uint8_t *dst, uint8_t *src1, uint8_t *src2,uint32_t l)
 {
 int delta;
@@@@ -338,7 +338,7 @@@@ int ll,rr;
 uint8_t ADMImage::substract(ADMImage *src1,ADMImage *src2)
 {
 
-#if 1 && defined( ARCH_X86 ) || defined (ARCH_X86_64)
+#if 1 && (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(__PIC__)
 uint32_t r1,r2;
         if(CpuCaps::hasMMX())
         {
@


1.1
log
@Further PIE preparations: aircrack-ng and avidemux both use non-PIC optimised
assembler.  Wrap an #ifndef PIC around it.

ok naddy@@
@
text
@d1 1
a1 1
$OpenBSD$
d9 1
a9 1
+#if (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(PIC)
d18 1
a18 1
+#if 1 && (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(PIC)
d27 1
a27 1
+#if (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(PIC)
d36 1
a36 1
+#if 1 && (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(PIC)
d45 1
a45 1
+#if (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(PIC)
d54 1
a54 1
+#if 1 && (defined( ARCH_X86 ) || defined (ARCH_X86_64)) && !defined(PIC)
@

