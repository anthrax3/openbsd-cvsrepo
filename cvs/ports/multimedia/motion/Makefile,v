head	1.13;
access;
symbols
	OPENBSD_6_0:1.11.0.2
	OPENBSD_6_0_BASE:1.11
	OPENBSD_5_9:1.9.0.2
	OPENBSD_5_9_BASE:1.9
	OPENBSD_5_8:1.7.0.6
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.2
	OPENBSD_5_7_BASE:1.7
	sthen_20141010:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.13
date	2016.09.23.09.16.56;	author sthen;	state Exp;
branches;
next	1.12;
commitid	XLnI6AbHAmyVU5mO;

1.12
date	2016.08.08.18.36.19;	author sthen;	state Exp;
branches;
next	1.11;
commitid	f4koMlTNl2cHjnvG;

1.11
date	2016.07.09.09.09.09;	author sthen;	state Exp;
branches;
next	1.10;
commitid	6UTy3AiMgjyDIiRL;

1.10
date	2016.04.09.19.18.07;	author sthen;	state Exp;
branches;
next	1.9;
commitid	08gAA5I4TZO3ylNb;

1.9
date	2015.11.21.13.10.55;	author sthen;	state Exp;
branches;
next	1.8;
commitid	HRSDrPD47TKFiVIi;

1.8
date	2015.11.20.11.57.19;	author sthen;	state Exp;
branches;
next	1.7;
commitid	dShjXtapE1E7GuHN;

1.7
date	2015.01.30.20.58.18;	author sthen;	state Exp;
branches;
next	1.6;
commitid	m63wZHxEPDZLiudj;

1.6
date	2014.10.23.12.14.43;	author sthen;	state Exp;
branches;
next	1.5;
commitid	jvHGYUfEMPG2Vv30;

1.5
date	2014.10.11.11.04.20;	author sthen;	state Exp;
branches;
next	1.4;
commitid	OIqRYyaexut4aC1U;

1.4
date	2014.10.10.15.12.20;	author sthen;	state Exp;
branches;
next	1.3;
commitid	JgCGO3E99IkJvG32;

1.3
date	2014.10.10.13.59.25;	author sthen;	state Exp;
branches;
next	1.2;
commitid	MQFNldzFl1Q5aLrb;

1.2
date	2014.10.10.13.40.01;	author sthen;	state Exp;
branches;
next	1.1;
commitid	PQIwAibens0B76IB;

1.1
date	2014.10.10.13.32.05;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;
commitid	MGj66DDvNXJgYAYG;

1.1.1.1
date	2014.10.10.13.32.05;	author sthen;	state Exp;
branches;
next	;
commitid	MGj66DDvNXJgYAYG;


desc
@@


1.13
log
@Cope with moving sqlite3 back to ports.
@
text
@# $OpenBSD: Makefile,v 1.12 2016/08/08 18:36:19 sthen Exp $

COMMENT=	motion detection software for video

GH_ACCOUNT=	Mr-Dave
GH_PROJECT=	motion
GH_COMMIT=	9b4c16cae0ea77950cc156a9c82947ac51825f68
V=		3.4.1
REVISION=	3
DISTNAME=	motion-$V

CATEGORIES=	multimedia

# there are several different forks at the moment which will hopefully
# be re-merged at some point; we are tracking the version from
# https://github.com/Mr-Dave/motion
HOMEPAGE=	http://www.lavrsen.dk/foswiki/bin/view/Motion/

MAINTAINER=	Stuart Henderson <sthen@@openbsd.org>

# GPL (according to source files, v2 only. website says v2+).
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += SDL avcodec avformat avutil c jpeg m pthread sqlite3 swscale

FLAVOR?=
FLAVORS=		bktr mysql pgsql

LIB_DEPENDS=		databases/sqlite3 \
			graphics/jpeg \
			graphics/ffmpeg

FAKE_FLAGS=		docdir=${PREFIX}/share/doc/motion \
			examplesdir=${PREFIX}/share/examples/motion

USE_GMAKE=		Yes
CONFIGURE_STYLE=	autoconf
BUILD_DEPENDS+=		${MODGNU_AUTOCONF_DEPENDS} \
			${MODGNU_AUTOMAKE_DEPENDS}
AUTOCONF_VERSION=	2.69
AUTOMAKE_VERSION=	1.15
CONFIGURE_ARGS=		--without-optimizecpu \
			LDFLAGS="-L${LOCALBASE}/lib" \
			CPPFLAGS="-I${LOCALBASE}/include"

.if ${FLAVOR:L:Mbktr}
CONFIGURE_ARGS+=	--without-v4l
.endif

.if ${FLAVOR:L:Mmysql}
LIB_DEPENDS+=		databases/mariadb
WANTLIB+=		lib/mysql/mysqlclient z
.else
CONFIGURE_ARGS+=	--without-mysql
.endif

.if ${FLAVOR:L:Mpgsql}
LIB_DEPENDS+=		databases/postgresql
WANTLIB+=		pq
CONFIGURE_ARGS+=	--with-pgsql-lib=${LOCALBASE}/lib
.else
CONFIGURE_ARGS+=	--without-pgsql
.endif

NO_TEST=		Yes

post-extract:
	printf '#!/bin/sh\necho -n "$V-Git-${GH_COMMIT:C/[0-9a-f]{33}$//}"\n' > ${WRKSRC}/version.sh

post-patch:
	cd ${WRKSRC} && AUTOCONF_VERSION=${AUTOCONF_VERSION} \
	AUTOMAKE_VERSION=${AUTOMAKE_VERSION} autoreconf -fiv

pre-configure:
	perl -pi -e s,/usr/local/etc,${SYSCONFDIR},g \
		${WRKSRC}/motion-dist.conf.in

.include <bsd.port.arch.mk>

.if ${ARCH:Mamd64}
CFLAGS+=	-mfpmath=sse -msse3
.endif

.include <bsd.port.mk>
@


1.12
log
@tweak DESCR (if->whether), prompted by a different diff from Michael McConville
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2016/07/09 09:09:09 sthen Exp $
d9 1
a9 1
REVISION=	2
d29 2
a30 1
LIB_DEPENDS=		graphics/jpeg \
@


1.11
log
@sync WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2016/04/09 19:18:07 sthen Exp $
d9 1
a9 1
REVISION=	1
@


1.10
log
@add a flavour to multimedia/motion building with support for bktr(4)
devices instead of video(4) (the two cannot coexist with the present
code).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2015/11/21 13:10:55 sthen Exp $
d9 1
a9 1
REVISION=	0
d51 1
a51 1
WANTLIB+=		lib/mysql/mysqlclient
@


1.9
log
@missing AUTO* deps, found by naddy
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2015/11/20 11:57:19 sthen Exp $
d9 1
d27 1
a27 1
FLAVORS=		mysql pgsql
d44 4
@


1.8
log
@update to motion-3.4.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2015/01/30 20:58:18 sthen Exp $
d36 2
@


1.7
log
@- Update motion to a newer snapshot, rolling in my v4l2 work and fixing a
few other issues.

- Fix packaging to install the sample motion.conf in the right location,
spotted by Tom Doherty, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2014/10/23 12:14:43 sthen Exp $
d7 3
a9 3
GH_COMMIT=	5c6f4be9e60a5115989b1cf34e14ea7c826bfa8e
V=		3.2.12
DISTNAME=	motion-$V.20150126
d13 3
d23 1
a23 1
WANTLIB += SDL avcodec avformat avutil c jpeg m pthread sqlite3 swscale z
d35 3
a37 1
CONFIGURE_STYLE=	gnu
d61 4
@


1.6
log
@update to a newer snapshot of motion
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2014/10/11 11:04:20 sthen Exp $
d7 1
a7 1
GH_COMMIT=	9479d910f2149b5558788bb86f97f26522794212
d9 1
a9 1
DISTNAME=	motion-$V.20141018
d32 1
a32 2
CONFIGURE_STYLE=	autoconf
AUTOCONF_VERSION=	2.69
@


1.5
log
@Patch motion to support -b (background / daemon mode) overriding the
"daemon" config value. Use it in motion.rc to ensure safe startup even
if config has "daemon off".
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2014/10/10 15:12:20 sthen Exp $
d7 1
a7 1
GH_COMMIT=	7cfdf13cd63378e45589650f7d20195cb7bf9936
d9 1
a9 2
DISTNAME=	motion-$V.20140910
REVISION=	1
d33 1
a33 1
AUTOCONF_VERSION=	2.68
@


1.4
log
@tweak build options, discussed with aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2014/10/10 13:59:25 sthen Exp $
d10 1
a10 1
REVISION=	0
@


1.3
log
@better PKGNAME, properly fix git version, sse on amd64
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2014/10/10 13:40:01 sthen Exp $
d10 1
d66 1
a66 1
CFLAGS+=		-mfpmath=sse -msse2
@


1.2
log
@let the git commitid printing work
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2014/10/10 13:32:05 sthen Exp $
d8 2
a9 2
DISTNAME=	motion-0.20140910
REVISION=	0
d55 3
d61 6
a66 2
	perl -pi -e s,%GH_COMMIT%,${GH_COMMIT:C/[0-9a-f]{33}$//}, \
		${WRKSRC}/version.sh
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.template,v 1.54 2008/01/13 16:43:57 espie Exp $
d9 1
d58 2
@


1.1.1.1
log
@import ports/multimedia/motion, ok/tweak ajacoutot@@

Motion is a C program that monitors the video signal from one or
more V4L2/video(4) cameras or network-based webcams, and is able to
detect if a significant part of the picture has changed. Or in
other words, it can detect motion.
@
text
@@
