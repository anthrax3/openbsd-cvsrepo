head	1.22;
access;
symbols
	OPENBSD_6_1:1.22.0.2
	OPENBSD_6_1_BASE:1.22
	OPENBSD_6_0:1.20.0.2
	OPENBSD_6_0_BASE:1.20
	OPENBSD_5_9:1.19.0.2
	OPENBSD_5_9_BASE:1.19
	OPENBSD_5_8:1.18.0.4
	OPENBSD_5_8_BASE:1.18
	OPENBSD_5_7:1.17.0.2
	OPENBSD_5_7_BASE:1.17
	OPENBSD_5_6:1.16.0.2
	OPENBSD_5_6_BASE:1.16
	OPENBSD_5_5:1.15.0.2
	OPENBSD_5_5_BASE:1.15
	OPENBSD_5_4:1.14.0.2
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.13.0.2
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.11.0.2
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.2
	OPENBSD_5_0:1.8.0.2
	OPENBSD_5_0_BASE:1.8
	OPENBSD_4_9:1.7.0.2
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.6.0.2
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.5.0.4
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.2
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.4.0.4
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.2
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.3.0.4
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.2
	OPENBSD_4_2_BASE:1.3
	ajacoutot_20070408:1.1.1.1
	ajacoutot:1.1.1;
locks; strict;
comment	@# @;


1.22
date	2017.01.26.03.16.57;	author ajacoutot;	state Exp;
branches;
next	1.21;
commitid	8CZx9Eo4X0JPAW90;

1.21
date	2016.10.03.08.04.37;	author ajacoutot;	state Exp;
branches;
next	1.20;
commitid	H70xgNLnEV1Yuiky;

1.20
date	2016.05.09.06.09.09;	author ajacoutot;	state Exp;
branches;
next	1.19;
commitid	OWktFjaK2UvrOJdD;

1.19
date	2015.08.13.07.35.21;	author ajacoutot;	state Exp;
branches;
next	1.18;
commitid	LNaY8oXb06bvpzg1;

1.18
date	2015.05.11.19.30.20;	author kettenis;	state Exp;
branches;
next	1.17;
commitid	6zuYHuedHbE4or8F;

1.17
date	2015.01.07.08.53.07;	author brad;	state Exp;
branches;
next	1.16;
commitid	c60Vyn40Z7Fnnzmm;

1.16
date	2014.06.02.22.01.02;	author brad;	state Exp;
branches;
next	1.15;
commitid	PxbSA5wQF4NDNHgd;

1.15
date	2013.10.06.20.38.52;	author brad;	state Exp;
branches;
next	1.14;

1.14
date	2013.03.09.09.31.12;	author brad;	state Exp;
branches;
next	1.13;

1.13
date	2012.11.23.03.53.37;	author brad;	state Exp;
branches;
next	1.12;

1.12
date	2012.08.27.09.34.43;	author jasper;	state Exp;
branches;
next	1.11;

1.11
date	2012.05.25.07.45.33;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2011.11.07.15.53.08;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2011.09.14.09.23.49;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2011.03.12.21.07.09;	author jakemsr;	state Exp;
branches;
next	1.7;

1.7
date	2010.11.06.23.05.48;	author jakemsr;	state Exp;
branches;
next	1.6;

1.6
date	2010.05.26.21.18.17;	author jakemsr;	state Exp;
branches;
next	1.5;

1.5
date	2009.04.14.19.50.47;	author kili;	state Exp;
branches;
next	1.4;

1.4
date	2008.07.22.20.24.04;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2007.07.20.20.11.48;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2007.04.23.10.20.48;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2007.04.08.17.31.01;	author ajacoutot;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.04.08.17.31.01;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.22
log
@Update to x264-20170125.

from Brad (maintainer)
@
text
@$OpenBSD: patch-configure,v 1.21 2016/10/03 08:04:37 ajacoutot Exp $
--- configure.orig	Wed Jan 25 16:45:03 2017
+++ configure	Wed Jan 25 20:05:15 2017
@@@@ -1,4 +1,4 @@@@
-#!/bin/bash
+#!/bin/sh
 
 if test x"$1" = x"-h" -o x"$1" = x"--help" ; then
 cat <<EOF
@@@@ -1194,10 +1194,6 @@@@ if [ "$pic" = "yes" ] ; then
     [ $SYS = SunOS -a "$ARCH" = "X86" ] && SOFLAGS="$SOFLAGS -mimpure-text"
 fi
 
-if [ "$debug" != "yes" -a "$gprof" != "yes" ]; then
-    CFLAGS="$CFLAGS -fomit-frame-pointer"
-fi
-
 if [ "$strip" = "yes" ]; then
     LDFLAGS="$LDFLAGS -s"
 fi
@@@@ -1205,12 +1201,16 @@@@ fi
 if [ "$debug" = "yes" ]; then
     CFLAGS="-O1 -g $CFLAGS"
     RCFLAGS="$RCFLAGS -DDEBUG"
+elif [ $ARCH = ARM ]; then
+    # arm-gcc-4.2 produces incorrect output with -ffast-math
+    # and it doesn't save any speed anyway on 4.4, so disable it
+    CFLAGS="-fno-fast-math $CFLAGS"
 else
-    CFLAGS="-O3 -ffast-math $CFLAGS"
+    CFLAGS="-ffast-math $CFLAGS"
     if [ "$lto" = "auto" ] && [ $compiler = GNU ] && cc_check "" "-flto" ; then
         lto="yes"
         CFLAGS="$CFLAGS -flto"
-        LDFLAGS="$LDFLAGS -O3 -flto"
+        LDFLAGS="$LDFLAGS -flto"
     fi
 fi
 [ "$lto" = "auto" ] && lto="no"
@@@@ -1239,10 +1239,6 @@@@ if cc_check '' -Wshadow ; then
     CFLAGS="-Wshadow $CFLAGS"
 fi
 
-if cc_check '' -Wmaybe-uninitialized ; then
-    CFLAGS="-Wno-maybe-uninitialized $CFLAGS"
-fi
-
 if [ $compiler = ICC -o $compiler = ICL ] ; then
     if cc_check 'extras/intel_dispatcher.h' '' 'x264_intel_dispatcher_override();' ; then
         define HAVE_INTEL_DISPATCHER
@@@@ -1419,7 +1415,6 @@@@ if [ "$cli" = "yes" ]; then
 fi
 
 if [ "$shared" = "yes" ]; then
-    API=$(grep '#define X264_BUILD' < ${SRCPATH}/x264.h | cut -f 3 -d ' ')
     if [ "$SYS" = "WINDOWS" -o "$SYS" = "CYGWIN" ]; then
         echo "SONAME=libx264-$API.dll" >> config.mak
         if [ $compiler_style = MS ]; then
@@@@ -1447,7 +1442,7 @@@@ if [ "$shared" = "yes" ]; then
     else
         echo "SOSUFFIX=so" >> config.mak
         echo "SONAME=libx264.so.$API" >> config.mak
-        echo "SOFLAGS=-shared -Wl,-soname,\$(SONAME) $SOFLAGS" >> config.mak
+        echo "SOFLAGS=-shared $SOFLAGS" >> config.mak
     fi
     echo 'default: lib-shared' >> config.mak
     echo 'install: install-lib-shared' >> config.mak
@


1.21
log
@Update to x264-20160930.
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.20 2016/05/09 06:09:09 ajacoutot Exp $
--- configure.orig	Fri Sep 30 16:45:03 2016
+++ configure	Sat Oct  1 16:23:52 2016
d10 1
a10 1
@@@@ -1180,10 +1180,6 @@@@ if [ "$pic" = "yes" ] ; then
d21 1
a21 1
@@@@ -1191,12 +1187,16 @@@@ fi
d40 1
a40 1
@@@@ -1225,10 +1225,6 @@@@ if cc_check '' -Wshadow ; then
d51 1
a51 1
@@@@ -1405,7 +1401,6 @@@@ if [ "$cli" = "yes" ]; then
d59 1
a59 1
@@@@ -1433,7 +1428,7 @@@@ if [ "$shared" = "yes" ]; then
@


1.20
log
@Update to x264-20160508.

from Brad (maintainer)
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.19 2015/08/13 07:35:21 ajacoutot Exp $
--- configure.orig	Sun May  8 16:45:04 2016
+++ configure	Sun May  8 21:29:24 2016
d10 1
a10 1
@@@@ -1164,10 +1164,6 @@@@ if [ "$pic" = "yes" ] ; then
d21 1
a21 1
@@@@ -1175,8 +1171,12 @@@@ fi
d32 6
d39 2
a40 3
 
 if cc_check '' -fno-tree-vectorize ; then
@@@@ -1203,10 +1203,6 @@@@ if cc_check '' -Wshadow ; then
d51 1
a51 1
@@@@ -1383,7 +1379,6 @@@@ if [ "$cli" = "yes" ]; then
d59 1
a59 1
@@@@ -1411,7 +1406,7 @@@@ if [ "$shared" = "yes" ]; then
@


1.19
log
@Update to x264-20150728.

from brad (maintainer)
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.18 2015/05/11 19:30:20 kettenis Exp $
--- configure.orig	Tue Jul 28 16:45:03 2015
+++ configure	Tue Jul 28 21:52:10 2015
d10 1
a10 1
@@@@ -1127,18 +1127,18 @@@@ if [ "$pic" = "yes" ] ; then
d21 1
a21 1
 
d24 1
d35 1
a35 1
@@@@ -1165,10 +1165,6 @@@@ if cc_check '' -Wshadow ; then
d46 1
a46 1
@@@@ -1339,7 +1335,6 @@@@ if [ "$cli" = "yes" ]; then
d54 1
a54 1
@@@@ -1367,7 +1362,7 @@@@ if [ "$shared" = "yes" ]; then
@


1.18
log
@Drop local changes that build the static library without -fPIC.  These days
most of our architectures default to PIE, which for all practical purpose
is equivalent to PIC.  This also brings back -Bsymbolic, which is needed
on amd64 to work around the fact that some of the assembler code generates
R_X86_64_PC32 relocations that binutils 2.17 complains about (rightly so).

Set REVISION to reflect that this actually changes the generated binaries.

ok ajacoutot@@
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.17 2015/01/07 08:53:07 brad Exp $
--- configure.orig	Thu Dec 18 22:45:04 2014
+++ configure	Sat May  9 21:57:03 2015
d10 1
a10 1
@@@@ -1051,18 +1051,18 @@@@ if [ "$pic" = "yes" ] ; then
d34 1
a34 1
@@@@ -1089,10 +1089,6 @@@@ if cc_check '' -Wshadow ; then
d42 4
a45 4
 if [ "$bit_depth" -gt "8" ]; then
     define HIGH_BIT_DEPTH
     ASFLAGS="$ASFLAGS -DHIGH_BIT_DEPTH=1"
@@@@ -1245,7 +1241,6 @@@@ if [ "$cli" = "yes" ]; then
d53 1
a53 1
@@@@ -1273,7 +1268,7 @@@@ if [ "$shared" = "yes" ]; then
@


1.17
log
@Update to x264-20141218.
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.16 2014/06/02 22:01:02 brad Exp $
--- configure.orig	Thu Dec 18 16:45:04 2014
+++ configure	Wed Jan  7 02:11:58 2015
d10 3
a12 3
@@@@ -1043,26 +1043,18 @@@@ fi
 
 cc_check "stdint.h" "" "uint32_t test_vec __attribute__ ((vector_size (16))) = {0,1,2,3};" && define HAVE_VECTOREXT
a13 8
-if [ "$pic" = "yes" ] ; then
-    CFLAGS="$CFLAGS -fPIC"
-    ASFLAGS="$ASFLAGS -DPIC"
-    # resolve textrels in the x86 asm
-    cc_check stdio.h "-shared -Wl,-Bsymbolic" && SOFLAGS="$SOFLAGS -Wl,-Bsymbolic"
-    [ $SYS = SunOS -a "$ARCH" = "X86" ] && SOFLAGS="$SOFLAGS -mimpure-text"
-fi
-
d34 1
a34 1
@@@@ -1089,10 +1081,6 @@@@ if cc_check '' -Wshadow ; then
d45 1
a45 1
@@@@ -1245,7 +1233,6 @@@@ if [ "$cli" = "yes" ]; then
d53 1
a53 1
@@@@ -1273,7 +1260,7 @@@@ if [ "$shared" = "yes" ]; then
d58 1
a58 1
+        echo "SOFLAGS=-shared -fPIC $SOFLAGS" >> config.mak
@


1.16
log
@Update to x264-20140525.

ok juan@@
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.15 2013/10/06 20:38:52 brad Exp $
--- configure.orig	Sun May 25 16:45:05 2014
+++ configure	Mon May 26 15:16:07 2014
d10 1
a10 1
@@@@ -991,18 +991,6 @@@@ fi
d29 6
a34 5
@@@@ -1012,9 +1000,9 @@@@ if [ "$debug" = "yes" ]; then
 elif [ $ARCH = ARM ]; then
     # arm-gcc-4.2 produces incorrect output with -ffast-math
     # and it doesn't save any speed anyway on 4.4, so disable it
-    CFLAGS="-O3 -fno-fast-math $CFLAGS"
d42 12
a53 1
@@@@ -1189,7 +1177,6 @@@@ if [ "$cli" = "yes" ]; then
d60 2
a61 2
         if [ $compiler = ICL ]; then
@@@@ -1217,7 +1204,7 @@@@ if [ "$shared" = "yes" ]; then
@


1.15
log
@Update to x264-20131002.

ok ajacoutot@@
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.14 2013/03/09 09:31:12 brad Exp $
--- configure.orig	Wed Oct  2 16:45:04 2013
+++ configure	Wed Oct  2 21:54:21 2013
d10 1
a10 1
@@@@ -963,18 +963,6 @@@@ fi
a26 1
     CFLAGS="$CFLAGS -s"
d28 2
a29 1
@@@@ -985,9 +973,9 @@@@ if [ "$debug" = "yes" ]; then
d41 1
a41 1
@@@@ -1161,7 +1149,6 @@@@ if [ "$cli" = "yes" ]; then
d49 1
a49 1
@@@@ -1189,7 +1176,7 @@@@ if [ "$shared" = "yes" ]; then
@


1.14
log
@Update to x 264 20130302.

ok ajacoutot@@
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.13 2012/11/23 03:53:37 brad Exp $
--- configure.orig	Sat Mar  2 16:45:04 2013
+++ configure	Sat Mar  2 20:50:20 2013
d10 1
a10 1
@@@@ -946,18 +946,6 @@@@ fi
d29 1
a29 1
@@@@ -968,9 +956,9 @@@@ if [ "$debug" = "yes" ]; then
d41 1
a41 1
@@@@ -1118,7 +1106,6 @@@@ if [ "$cli" = "yes" ]; then
d49 1
a49 1
@@@@ -1146,7 +1133,7 @@@@ if [ "$shared" = "yes" ]; then
@


1.13
log
@Update to x264-20121114.

ok ajacoutot@@
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.12 2012/08/27 09:34:43 jasper Exp $
--- configure.orig	Wed Nov 14 16:45:03 2012
+++ configure	Thu Nov 15 01:25:21 2012
d10 1
a10 1
@@@@ -921,18 +921,6 @@@@ fi
d29 1
a29 1
@@@@ -943,9 +931,9 @@@@ if [ "$debug" = "yes" ]; then
d41 1
a41 1
@@@@ -1093,7 +1081,6 @@@@ if [ "$cli" = "yes" ]; then
d49 1
a49 1
@@@@ -1121,7 +1108,7 @@@@ if [ "$shared" = "yes" ]; then
@


1.12
log
@Remove -pthread patching.

from brad
@
text
@d1 3
a3 7
$OpenBSD: patch-configure,v 1.11 2012/05/25 07:45:33 ajacoutot Exp $

- Last chunk: fix the pkgconfig file for dynamic vs. static linking now that it can be
fixed properly post -pthread.

--- configure.orig	Sun May 20 16:45:03 2012
+++ configure	Fri Aug 17 01:01:03 2012
a57 17
@@@@ -1149,7 +1136,7 @@@@ echo "CLI_LIBX264 = $CLI_LIBX264" >> config.mak
 
 ${SRCPATH}/version.sh "${SRCPATH}" >> x264_config.h
 
-pclibs="-L$libdir -lx264 $libpthread"
+pclibs="-L$libdir -lx264"
 
 cat > x264.pc << EOF
 prefix=$prefix
@@@@ -1161,6 +1148,7 @@@@ Name: x264
 Description: H.264 (MPEG4 AVC) encoder library
 Version: $(grep POINTVER < x264_config.h | sed -e 's/.* "//; s/".*//')
 Libs: $pclibs
+Libs.private: $libpthread -lm
 Cflags: -I$includedir
 EOF
 
@


1.11
log
@Update to x264-20120520.

from Brad (maintainer)
@
text
@d1 5
a5 1
$OpenBSD: patch-configure,v 1.10 2011/11/07 15:53:08 ajacoutot Exp $
d7 1
a7 1
+++ configure	Sun May 20 20:09:21 2012
d67 1
a67 1
+pclibs="-L$libdir -lx264 -lm $libpthread"
d71 8
@


1.10
log
@Update to x264-20111027.

from Brad, maintainer
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.9 2011/09/14 09:23:49 ajacoutot Exp $
--- configure.orig	Thu Oct 27 16:45:03 2011
+++ configure	Fri Oct 28 01:34:02 2011
d10 1
a10 1
@@@@ -871,18 +871,6 @@@@ fi
d29 1
a29 1
@@@@ -893,9 +881,9 @@@@ if [ "$debug" = "yes" ]; then
d41 1
a41 1
@@@@ -1036,7 +1024,6 @@@@ if [ "$cli" = "yes" ]; then
d45 1
a45 1
-    API=$(grep '#define X264_BUILD' < x264.h | cut -f 3 -d ' ')
d49 1
a49 1
@@@@ -1061,7 +1048,7 @@@@ if [ "$shared" = "yes" ]; then
d58 1
a58 1
@@@@ -1089,7 +1076,7 @@@@ echo "CLI_LIBX264 = $CLI_LIBX264" >> config.mak
d60 1
a60 1
 ./version.sh >> x264_config.h
@


1.9
log
@Update to x264-20110830.

from Brad (maintainer)
bulk testing by jasper@@
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.8 2011/03/12 21:07:09 jakemsr Exp $
--- configure.orig	Tue Aug 30 16:45:04 2011
+++ configure	Tue Aug 30 22:05:06 2011
d10 1
a10 1
@@@@ -854,17 +854,6 @@@@ fi
d18 2
a19 1
-    cc_check stdio.h -Wl,-Bsymbolic && LDFLAGS="$LDFLAGS -Wl,-Bsymbolic"
d29 1
a29 1
@@@@ -875,9 +864,9 @@@@ if [ "$debug" = "yes" ]; then
d41 1
a41 1
@@@@ -1011,7 +1000,6 @@@@ if [ "$cli" = "yes" ]; then
d49 1
a49 1
@@@@ -1036,7 +1024,7 @@@@ if [ "$shared" = "yes" ]; then
d53 2
a54 2
-        echo 'SOFLAGS=-shared -Wl,-soname,$(SONAME)' >> config.mak
+        echo 'SOFLAGS=-shared -fPIC' >> config.mak
d58 1
a58 1
@@@@ -1064,7 +1052,7 @@@@ echo "CLI_LIBX264 = $CLI_LIBX264" >> config.mak
@


1.8
log
@update to x264-20110225

from Brad (MAINTAINER)
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.7 2010/11/06 23:05:48 jakemsr Exp $
--- configure.orig	Fri Feb 25 16:45:04 2011
+++ configure	Fri Feb 25 22:17:05 2011
d10 3
a12 3
@@@@ -712,26 +712,14 @@@@ if [ "$avs" = "auto" ] ; then
     fi
 fi
d22 1
a22 2
-    CFLAGS="$CFLAGS -s -fomit-frame-pointer"
-    LDFLAGS="$LDFLAGS -s"
d25 4
a28 2
 if [ "$debug" = "yes" ]; then
     CFLAGS="-O1 -g $CFLAGS"
d40 2
a41 2
@@@@ -803,7 +791,6 @@@@ DEVNULL=$DEVNULL
 EOF
d45 1
a45 1
     if [ "$SYS" = "MINGW" ]; then
d47 2
a48 2
         echo 'IMPLIBNAME=libx264.dll.a' >> config.mak
@@@@ -819,14 +806,13 @@@@ if [ "$shared" = "yes" ]; then
d52 2
a53 1
-        echo 'SOFLAGS=-Wl,-soname,$(SONAME)' >> config.mak
d55 3
a57 2
     echo 'default: $(SONAME)' >> config.mak
 fi
d59 1
a59 1
 ./version.sh >> config.h
@


1.7
log
@update to x264-snapshot-20101023-2245
works with upcoming mplayer update as well as current ports
from Brad (MAINTAINER)
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.6 2010/05/26 21:18:17 jakemsr Exp $
--- configure.orig	Sun Oct 31 17:45:08 2010
+++ configure	Sun Oct 31 17:51:47 2010
d9 2
a10 2
 
@@@@ -670,26 +670,14 @@@@ if [ "$avs" = "auto" ] ; then
d39 1
a39 1
@@@@ -749,7 +737,6 @@@@ GPL=$gpl
d47 1
a47 1
@@@@ -765,14 +752,13 @@@@ if [ "$shared" = "yes" ]; then
@


1.6
log
@update to x264-snapshot-20100511-2245

this is an ABI/API change.  there will be fallout, but patches
exist and will be committed rsn ...

mostly from MAINTAINER
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.5 2009/04/14 19:50:47 kili Exp $
--- configure.orig	Tue May 11 13:45:10 2010
+++ configure	Thu May 20 10:24:27 2010
d10 2
a11 1
@@@@ -606,25 +606,17 @@@@ if [ "$avs_input" = "auto" ] ; then
d14 1
a14 1
 if [ "$pic" = "yes" ] ; then
d16 1
a16 1
     ASFLAGS="$ASFLAGS -DPIC"
d19 2
a20 2
 fi
 
d38 2
a39 2
 if cc_check "stdio.h" "" "fseeko(stdin,0,0);" ; then
@@@@ -663,7 +655,6 @@@@ DEVNULL=$DEVNULL
d47 1
a47 1
@@@@ -679,14 +670,13 @@@@ if [ "$shared" = "yes" ]; then
d56 1
a56 1
 ./version.sh
@


1.5
log
@
Update to a newer snapshot.

From Brad (new maintainer).

"theoretically ok" ajacoutot@@
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.4 2008/07/22 20:24:04 brad Exp $
--- configure.orig	Wed Feb  4 16:45:09 2009
+++ configure	Thu Mar  5 10:44:49 2009
d10 1
a10 20
@@@@ -70,6 +70,18 @@@@ ASFLAGS=""
 
 EXE=""
 
+# check whether 'echo -n' works as expected, otherwise try printf
+if [ "x`echo -n houba`" = xhouba ]
+then
+  ECHON="echo -n"
+elif [ "x`printf houba`" = xhouba ]
+then
+  ECHON="printf"
+else
+  echo "Neither 'echo -n' nor 'printf' are working with your shell!"
+  exit 1
+fi
+
 # parse options
 
 for opt do
@@@@ -371,21 +383,15 @@@@ if [ "$avis_input" = "yes" ] ; then
d16 2
a17 2
     # resolve textrels in the x86 asm
     cc_check stdio.h -Wl,-Bsymbolic && LDFLAGS="$LDFLAGS -Wl,-Bsymbolic"
d27 5
d33 1
a33 1
-    CFLAGS="-O4 -ffast-math $CFLAGS"
d38 1
a38 5
@@@@ -418,10 +424,16 @@@@ EXE=$EXE
 VIS=$vis
 HAVE_GETOPT_LONG=$HAVE_GETOPT_LONG
 DEVNULL=$DEVNULL
+ECHON=$ECHON
a40 6
+$ECHON 'CONFIGURE_ARGS=' >> config.mak
+for A in "$@@" ; do
+    $ECHON " '$A'" >> config.mak
+done
+echo '' >> config.mak
+
d46 1
a46 1
@@@@ -437,14 +449,13 @@@@ if [ "$shared" = "yes" ]; then
@


1.4
log
@Upgrade to x264 snapshot 20080713.

Also remove ajacoutot@@ as maintainer per his request.

ok jakemsr@@
@
text
@d1 29
a29 23
$OpenBSD: patch-configure,v 1.3 2007/07/20 20:11:48 ajacoutot Exp $
--- configure.orig	Fri Jul  4 16:45:05 2008
+++ configure	Sat Jul 12 02:16:14 2008
@@@@ -254,7 +254,7 @@@@ case $host_cpu in
     fi
     as_check || AS="nasm"
     ;;
-  x86_64)
+  x86_64 | amd64)
     ARCH="X86_64"
     AS="yasm"
     if [ "$SYS" = MACOSX ];then
@@@@ -353,6 +353,9 @@@@ if test "$pthread" = "auto" ; then
                 CFLAGS="$CFLAGS -DPTW32_STATIC_LIB"
             fi
             ;;
+        OPENBSD)
+            cc_check pthread.h -pthread && pthread="yes" && libpthread="-pthread"
+            ;;
         *)
             cc_check pthread.h -lpthread && pthread="yes" && libpthread="-lpthread"
             ;;
@@@@ -389,21 +392,21 @@@@ if [ "$avis_input" = "yes" ] ; then
d34 1
a34 2
+    CFLAGS="$CFLAGS"
     ASFLAGS="$ASFLAGS -D__PIC__"
d39 1
a39 1
 if [ "$debug" != "yes" -a "$gprof" != "yes" ]; then
d42 2
a43 4
+    CFLAGS="$CFLAGS"
+    LDFLAGS="$LDFLAGS"
 fi
 
d52 6
a57 2
@@@@ -449,7 +452,6 @@@@ echo '' >> config.mak
 cp config.mak gtk/config.mak
d59 6
d70 1
a70 2
@@@@ -459,7 +461,6 @@@@ if [ "$shared" = "yes" ]; then
         echo 'SOFLAGS=-dynamiclib -Wl,-single_module -Wl,-read_only_relocs,suppress' >> config.mak        
d72 1
d77 1
a77 2
     if [ "$gtk" = "yes" ]; then
@@@@ -474,7 +475,7 @@@@ fi
@


1.3
log
@- really use nasm to build x264 under i386 and use yasm under amd64
- dont't add -fPIC to $CFLAGS automatically (even though we set --enable-pic) ;
this is handled in the Makefile so that we can build the static lib from
non-pic objects

Tested by sthen and myself
@
text
@d1 4
a4 14
$OpenBSD: patch-configure,v 1.2 2007/04/23 10:20:48 ajacoutot Exp $
--- configure.orig	Sun Mar 25 22:45:02 2007
+++ configure	Fri Jul 20 13:02:53 2007
@@@@ -46,7 +46,7 @@@@ as_check() {
 
 rm -f config.h config.mak x264.pc
 
-prefix='/usr/local'
+prefix='!!PREFIX!!';
 exec_prefix='${prefix}'
 bindir='${exec_prefix}/bin'
 libdir='${exec_prefix}/lib'
@@@@ -160,7 +160,7 @@@@ case "${MACHINE%%-*}" in
       ASFLAGS="$ASFLAGS -f elf"
d6 1
a10 1
     CFLAGS="$CFLAGS -DHAVE_MMX"
d12 2
a13 1
@@@@ -334,6 +334,9 @@@@ if test "$pthread" = "auto" ; then
d23 1
a23 1
@@@@ -370,19 +373,19 @@@@ if [ "$avis_input" = "yes" ] ; then
d30 2
d49 1
a49 1
@@@@ -426,7 +429,6 @@@@ echo '' >> config.mak
d54 9
a62 1
     echo "SONAME=libx264.so.$API" >> config.mak
d65 1
a65 1
@@@@ -441,7 +443,7 @@@@ fi
@


1.2
log
@- use -pthread instead of -lpthread when linking
- kill a hardcoded /usr/X11R6 in configure
- generate x264.pc with proper libraries (add -m, use -pthread instead
of -lpthread)

from jakemsr (Jacob Meuser)
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.1.1.1 2007/04/08 17:31:01 ajacoutot Exp $
--- configure.orig	Sun Mar 25 13:45:02 2007
+++ configure	Fri Apr 20 13:54:14 2007
d13 9
d32 7
a38 1
@@@@ -375,14 +378,14 @@@@ if [ "$pic" = "yes" ] ; then
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
$OpenBSD$
--- configure.orig	Sun Mar 25 22:45:02 2007
+++ configure	Sat Apr  7 07:26:53 2007
d13 11
a23 1
@@@@ -375,14 +375,14 @@@@ if [ "$pic" = "yes" ] ; then
d41 1
a41 1
@@@@ -426,7 +426,6 @@@@ echo '' >> config.mak
d49 9
@


1.1.1.1
log
@Import x264-20070325

x264 is a free library for encoding H264/AVC video streams.

This program requires a processor with recent instructions (MMX/SSE for
i386, AltiVec for powerpc).

Encoder features:
 * CAVLC/CABAC
 * Multi-references
 * Intra: all macroblock types (16x16, 8x8, and 4x4 with all predictions)
 * Inter P: all partitions (from 16x16 down to 4x4)
 * Inter B: partitions from 16x16 down to 8x8 (including skip/direct)
 * Ratecontrol: constant quantizer, single or multipass ABR, optional VBV
 * Scene cut detection
 * Adaptive B-frame placement
 * B-frames as references / arbitrary frame order
 * 8x8 and 4x4 adaptive spatial transform
 * Lossless mode
 * Custom quantization matrices
 * Parallel encoding of multiple slices
 * Interlacing


based on an original submission by Nikns Siankin <nikns at secure dot lv>
help and ok naddy@@ steven@@
@
text
@@
