head	1.4;
access;
symbols
	OPENBSD_6_1:1.4.0.28
	OPENBSD_6_1_BASE:1.4
	OPENBSD_6_0:1.4.0.26
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.4.0.22
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.24
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.20
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.18
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.4.0.16
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.4.0.14
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.4.0.12
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.4.0.10
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.4
	OPENBSD_5_1:1.4.0.8
	OPENBSD_5_0:1.4.0.6
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.4
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.2
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.3.0.8
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.6
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.4
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.2
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.1.0.2
	OPENBSD_4_3_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2010.04.28.08.03.23;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2008.06.14.17.17.26;	author deanna;	state Exp;
branches;
next	1.2;

1.2
date	2008.05.13.15.11.51;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2008.02.14.18.52.00;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to gstreamer-plugins-good-0.10.22.
@
text
@$OpenBSD: patch-sys_oss_gstosshelper_c,v 1.3 2008/06/14 17:17:26 deanna Exp $
--- sys/oss/gstosshelper.c.orig	Fri Apr 16 19:10:22 2010
+++ sys/oss/gstosshelper.c	Wed Apr 28 09:06:23 2010
@@@@ -228,6 +228,7 @@@@ gst_oss_helper_rate_probe_check (GstOssProbe * probe)
   int exact_rates = 0;
   gboolean checking_exact_rates = TRUE;
   int n_checks = 0;
+  int max_exact_matches = 20;
   gboolean result = TRUE;
 
   ranges = g_queue_new ();
@@@@ -255,6 +256,12 @@@@ gst_oss_helper_rate_probe_check (GstOssProbe * probe)
      * driver is seriously buggy, and probably doesn't work with other
      * media libraries/apps.  */
     probe->min = gst_oss_helper_rate_check_rate (probe, 8000);
+    if (probe->min == -1)
+        probe->min = gst_oss_helper_rate_check_rate (probe, 32000);
+    if (probe->min == -1)
+        probe->min = gst_oss_helper_rate_check_rate (probe, 44100);
+    if (probe->min == -1)
+        probe->min = gst_oss_helper_rate_check_rate (probe, 48000);
     probe->max = gst_oss_helper_rate_check_rate (probe, 48000);
   }
   if (probe->min == -1 || probe->max == -1) {
@@@@ -279,19 +286,15 @@@@ gst_oss_helper_rate_probe_check (GstOssProbe * probe)
     }
     n_checks++;
 
-    if (mid == mid_ret && checking_exact_rates) {
-      int max_exact_matches = 20;
-
+    if (mid == mid_ret && checking_exact_rates)
       exact_rates++;
-      if (exact_rates > max_exact_matches) {
-        GST_DEBUG ("got %d exact rates, assuming all are exact",
-            max_exact_matches);
-        result = FALSE;
-        g_free (range);
-        break;
-      }
-    } else {
-      checking_exact_rates = FALSE;
+
+    if (exact_rates > max_exact_matches) {
+      GST_DEBUG ("got %d exact rates, assuming all are exact",
+		 max_exact_matches);
+      result = FALSE;
+      g_free (range);
+      break;
     }
 
     /* Assume that the rate is arithmetically rounded to the nearest
@


1.3
log
@Fix a counting error that was causing the oss audio sink to perform
half a million audio ioctls on variable rate devices before it got
around to playing any sound.  Unbreaks gstreamer on auich.  Upstream
as gnome bug 538068.

ok espie, ajacoutot
@
text
@d1 4
a4 4
$OpenBSD: patch-sys_oss_gstosshelper_c,v 1.2 2008/05/13 15:11:51 espie Exp $
--- sys/oss/gstosshelper.c.orig	Tue Apr  8 15:49:34 2008
+++ sys/oss/gstosshelper.c	Fri Jun 13 11:06:46 2008
@@@@ -227,6 +227,7 @@@@ gst_oss_helper_rate_probe_check (GstOssProbe * probe)
d12 1
a12 1
@@@@ -254,6 +255,12 @@@@ gst_oss_helper_rate_probe_check (GstOssProbe * probe)
d25 1
a25 1
@@@@ -278,19 +285,15 @@@@ gst_oss_helper_rate_probe_check (GstOssProbe * probe)
@


1.2
log
@update to recent gstreamer + plugins. Some breakage might occur, it will
be dealt with afterwards.
@
text
@d1 12
a12 4
$OpenBSD: patch-sys_oss_gstosshelper_c,v 1.1 2008/02/14 18:52:00 ajacoutot Exp $
--- sys/oss/gstosshelper.c.orig	Tue Apr  8 21:49:34 2008
+++ sys/oss/gstosshelper.c	Mon May 12 14:28:03 2008
@@@@ -254,6 +254,12 @@@@ gst_oss_helper_rate_probe_check (GstOssProbe * probe)
d25 28
@


1.1
log
@- fix OSS audio output with azalia(4); patch from jakemsr@@, thanks ;-)
- we're using autotools, so patch gst-default.m4 instead of configure to
add sensible output defaults; problem noticed by jakemsr@@
- fix WANTLIB while here

ok jakemsr@@
@
text
@d1 4
a4 4
$OpenBSD$
--- sys/oss/gstosshelper.c.orig	Thu Feb 14 09:28:31 2008
+++ sys/oss/gstosshelper.c	Thu Feb 14 09:29:52 2008
@@@@ -253,6 +253,12 @@@@ gst_oss_helper_rate_probe_check (GstOssProbe * probe)
@

