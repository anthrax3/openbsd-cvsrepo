head	1.30;
access;
symbols
	OPENBSD_6_1:1.24.0.2
	OPENBSD_6_1_BASE:1.24
	OPENBSD_6_0:1.18.0.2
	OPENBSD_6_0_BASE:1.18
	OPENBSD_5_9:1.16.0.2
	OPENBSD_5_9_BASE:1.16
	OPENBSD_5_8:1.13.0.4
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.10.0.2
	OPENBSD_5_7_BASE:1.10
	brad_20140904:1.1.1.1
	brad:1.1.1;
locks; strict;
comment	@# @;


1.30
date	2017.07.26.22.45.27;	author sthen;	state Exp;
branches;
next	1.29;
commitid	tD4MFrpYYDDL2UFT;

1.29
date	2017.07.17.08.05.29;	author ajacoutot;	state Exp;
branches;
next	1.28;
commitid	FEcVgwBOfGQgZCjd;

1.28
date	2017.05.31.08.08.16;	author espie;	state Exp;
branches;
next	1.27;
commitid	ij92FtFXiSiT1ani;

1.27
date	2017.05.13.17.53.28;	author espie;	state Exp;
branches;
next	1.26;
commitid	utFl8wwskmz0jdJc;

1.26
date	2017.04.23.21.47.37;	author ajacoutot;	state Exp;
branches;
next	1.25;
commitid	d8xqEnFKw1xgyYwM;

1.25
date	2017.04.10.11.46.23;	author sthen;	state Exp;
branches;
next	1.24;
commitid	BLsh88fJB8thZTwY;

1.24
date	2017.03.01.08.53.46;	author ajacoutot;	state Exp;
branches;
next	1.23;
commitid	4qiHFRkQc9hfscJm;

1.23
date	2017.02.18.22.56.12;	author ajacoutot;	state Exp;
branches;
next	1.22;
commitid	UOfX3HMGNtLnIkNC;

1.22
date	2017.01.23.02.51.02;	author ajacoutot;	state Exp;
branches;
next	1.21;
commitid	gQ2yoTD1xI7Kt1mo;

1.21
date	2016.12.30.14.29.25;	author ajacoutot;	state Exp;
branches;
next	1.20;
commitid	zXMh9Qh8Evw2DsBy;

1.20
date	2016.10.03.08.05.37;	author ajacoutot;	state Exp;
branches;
next	1.19;
commitid	EJgP2HU3EoiIcrXn;

1.19
date	2016.08.20.12.00.35;	author ajacoutot;	state Exp;
branches;
next	1.18;
commitid	1LYr5WtEZbrs4I29;

1.18
date	2016.03.05.16.04.06;	author pascal;	state Exp;
branches;
next	1.17;
commitid	EJSWd5DpdfEFGBlM;

1.17
date	2016.02.26.16.27.55;	author ajacoutot;	state Exp;
branches;
next	1.16;
commitid	N2dDEgfVPzjF50mr;

1.16
date	2015.12.25.07.51.37;	author ajacoutot;	state Exp;
branches;
next	1.15;
commitid	hem4SaO6NCXv44eA;

1.15
date	2015.11.09.06.44.09;	author ajacoutot;	state Exp;
branches;
next	1.14;
commitid	wizMmVYftri7cVV0;

1.14
date	2015.10.01.15.13.36;	author ajacoutot;	state Exp;
branches;
next	1.13;
commitid	jRLTdddb6avm75zA;

1.13
date	2015.05.24.07.17.50;	author ajacoutot;	state Exp;
branches;
next	1.12;
commitid	iIXWR06v9YfoRbGy;

1.12
date	2015.05.02.07.36.16;	author ajacoutot;	state Exp;
branches;
next	1.11;
commitid	M9pta9sapwOLS5hK;

1.11
date	2015.04.09.20.47.19;	author sthen;	state Exp;
branches;
next	1.10;
commitid	lcnBD8XYzEtLuFyY;

1.10
date	2015.02.18.03.59.26;	author brad;	state Exp;
branches;
next	1.9;
commitid	DwHVa4lDgtMGwWGp;

1.9
date	2015.02.17.01.28.01;	author brad;	state Exp;
branches;
next	1.8;
commitid	RhoS12E7YKZiK2SX;

1.8
date	2015.01.15.18.09.06;	author landry;	state Exp;
branches;
next	1.7;
commitid	2jMdZ6N70PMLg1EH;

1.7
date	2014.12.15.20.04.48;	author brad;	state Exp;
branches;
next	1.6;
commitid	aDTjKDXGe0K0BOvJ;

1.6
date	2014.12.08.08.25.05;	author brad;	state Exp;
branches;
next	1.5;
commitid	mIrLklJyXjYVK6J1;

1.5
date	2014.11.02.11.36.48;	author brad;	state Exp;
branches;
next	1.4;
commitid	ELp7Pc16upI0oUQA;

1.4
date	2014.10.09.02.23.10;	author brad;	state Exp;
branches;
next	1.3;
commitid	JGzgyLjC16TYbr9f;

1.3
date	2014.09.16.19.21.21;	author landry;	state Exp;
branches;
next	1.2;
commitid	7BhRs7Fver0YBhXX;

1.2
date	2014.09.16.18.13.58;	author landry;	state Exp;
branches;
next	1.1;
commitid	MnNVFraRUKDMx2rB;

1.1
date	2014.09.04.05.37.41;	author brad;	state Exp;
branches
	1.1.1.1;
next	;
commitid	PknvhOeWaMsrwaYu;

1.1.1.1
date	2014.09.04.05.37.41;	author brad;	state Exp;
branches;
next	;
commitid	PknvhOeWaMsrwaYu;


desc
@@


1.30
log
@bump LIBCXX/LIBECXX/COMPILER_LIBCXX ports.
@
text
@# $OpenBSD: Makefile,v 1.29 2017/07/17 08:05:29 ajacoutot Exp $

COMMENT=	free H.265/HEVC encoder

VER=		2.5
DISTNAME=	x265_${VER}
PKGNAME=	x265-${VER}
CATEGORIES=	multimedia
MASTER_SITES=	https://ftp.videolan.org/pub/videolan/x265/
REVISION=	0

SHARED_LIBS=	x265	12.0

HOMEPAGE=	http://x265.org/

MAINTAINER=	Brad Smith <brad@@comstyle.com>

# GPLv2+
PERMIT_PACKAGE_CDROM=	patents
PERMIT_PACKAGE_FTP=	Yes

WANTLIB=	c m pthread ${LIBCXX}

WRKSRC=		${WRKDIST}/source

MODULES=	devel/cmake

COMPILER =	clang
MODCLANG_ARCHS=	amd64 i386

.if ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "i386"
BUILD_DEPENDS+=	devel/yasm
.endif

SEPARATE_BUILD=	Yes
# Workaround for Clang 4.0
#CONFIGURE_ARGS=	-DENABLE_TESTS=On
NO_TEST=	Yes

CONFIGURE_ARGS+= -DCMAKE_ASM_YASM_FLAGS_DEBUG="-g dwarf2"

.if ${MACHINE_ARCH} == "aarch64" || ${MACHINE_ARCH} == "alpha" || \
    ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "i386" || \
    ${MACHINE_ARCH} == "mips64" || ${MACHINE_ARCH} == "mips64el" || \
    ${MACHINE_ARCH} == "powerpc" || ${MACHINE_ARCH} == "sparc64"
CONFIGURE_ARGS+= -DNO_ATOMICS=Off
.else
CONFIGURE_ARGS+= -DNO_ATOMICS=On
.endif

#do-test:
#	${WRKBUILD}/test/TestBench

.include <bsd.port.mk>
@


1.29
log
@Update to x265-2.5.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2017/05/31 08:08:16 espie Exp $
d10 1
@


1.28
log
@switch everything to new COMPILER idiom, even stuff that won't build with clang
yet, but at least that part is done.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2017/05/13 17:53:28 espie Exp $
d5 1
a5 1
VER=		2.4
d11 1
a11 1
SHARED_LIBS=	x265	11.0
@


1.27
log
@builds fine with base clang
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2017/04/23 21:47:37 ajacoutot Exp $
d27 1
a27 3
.include <bsd.port.arch.mk>
.if !${PROPERTIES:Mclang}
MODULES +=	lang/clang
a28 2
MODCLANG_LANGS=	c++
.endif
@


1.26
log
@Update to x265-2.4.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2017/04/10 11:46:23 sthen Exp $
d25 1
a25 2
MODULES=	devel/cmake \
		lang/clang
d27 3
d32 1
@


1.25
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2017/03/01 08:53:46 ajacoutot Exp $
d5 1
a5 1
VER=		2.3
a9 1
REVISION=	0
d11 1
a11 1
SHARED_LIBS=	x265	10.0
@


1.24
log
@Use atomic ops on aarch64.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2017/02/18 22:56:12 ajacoutot Exp $
d22 1
a22 1
WANTLIB=	c m pthread stdc++
@


1.23
log
@Update to x265-2.3.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2017/01/23 02:51:02 ajacoutot Exp $
d10 1
d43 4
a46 4
.if ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "amd64" || \
    ${MACHINE_ARCH} == "i386" || ${MACHINE_ARCH} == "mips64" || \
    ${MACHINE_ARCH} == "mips64el" || ${MACHINE_ARCH} == "powerpc" || \
    ${MACHINE_ARCH} == "sparc64"
@


1.22
log
@Disable the benchmarks (not built by default) for now to workaround an
issue with Clang 4.0.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2016/12/30 14:29:25 ajacoutot Exp $
d5 1
a5 1
VER=		2.2
d11 1
a11 1
SHARED_LIBS=	x265	9.0
@


1.21
log
@Update to x265-2.2.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2016/10/03 08:05:37 ajacoutot Exp $
d36 3
a38 1
CONFIGURE_ARGS=	-DENABLE_TESTS=On
d51 2
a52 2
do-test:
	${WRKBUILD}/test/TestBench
@


1.20
log
@Update to x265-2.1.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2016/08/20 12:00:35 ajacoutot Exp $
d5 1
a5 1
VER=		2.1
d11 1
a11 1
SHARED_LIBS=	x265	8.0
@


1.19
log
@Update to x265-2.0.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2016/03/05 16:04:06 pascal Exp $
d5 1
a5 1
VER=		2.0
d11 1
a11 1
SHARED_LIBS=	x265	7.0
@


1.18
log
@Bump REVISION for lang/clang MODULE changes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2016/02/26 16:27:55 ajacoutot Exp $
d5 1
a5 1
VER=		1.9
a9 1
REVISION=	0
d11 1
a11 1
SHARED_LIBS=	x265	6.0
@


1.17
log
@Update to x265-1.9.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2015/12/25 07:51:37 ajacoutot Exp $
d10 1
@


1.16
log
@Enable the use of built-in atomic ops on mips64.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2015/11/09 06:44:09 ajacoutot Exp $
d5 3
a7 3
DISTNAME=	x265_1.8+93
PKGNAME=	x265-1.8.93
REVISION=	0
d9 1
a9 1
MASTER_SITES=	http://comstyle.com/source/
d11 1
a11 1
SHARED_LIBS=	x265	5.0
a23 1
WRKDIST=	${WRKDIR}/x265_1.8
@


1.15
log
@Update to x265-1.8.93.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2015/10/01 15:13:36 ajacoutot Exp $
d7 1
d42 2
a43 1
    ${MACHINE_ARCH} == "i386" || ${MACHINE_ARCH} == "powerpc" || \
@


1.14
log
@Unbreak on all archs.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2015/05/24 07:17:50 ajacoutot Exp $
d5 2
a6 4
VER=		1.7
DISTNAME=	x265_${VER}
PKGNAME=	x265-${VER}
REVISION=	0
d8 1
a8 1
MASTER_SITES=	https://ftp.videolan.org/pub/videolan/x265/
d10 1
a10 1
SHARED_LIBS=	x265	4.0
d23 1
d37 2
@


1.13
log
@Update to x265-1.7.

from brad (maintainer)
@
text
@d1 1
a1 6
# $OpenBSD: Makefile,v 1.12 2015/05/02 07:36:16 ajacoutot Exp $

NOT_FOR_ARCHS=		${GCC3_ARCHS}
BROKEN-hppa =		undefined reference to `__sync_fetch_and_or_4'
BROKEN-mips64 =		undefined reference to `__sync_fetch_and_or_4'
BROKEN-mips64el =	undefined reference to `__sync_fetch_and_or_4'
d8 1
d38 8
@


1.12
log
@Switch the dist site to the VLC mirror.

from brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2015/04/09 20:47:19 sthen Exp $
d10 1
a10 1
VER=		1.6
d16 1
a16 1
SHARED_LIBS=	x265	3.0
d34 1
a34 1
MODCLANG_LANGS=	c c++
@


1.11
log
@update to x265-1.6, from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2015/02/18 03:59:26 brad Exp $
d14 1
a14 1
MASTER_SITES=	https://bitbucket.org/multicoreware/x265/downloads/
@


1.10
log
@Hook up the tests.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2015/02/17 01:28:01 brad Exp $
d10 1
a10 1
VER=		1.5
d16 1
a16 1
SHARED_LIBS=	x265	2.0
@


1.9
log
@Update to x265 1.5.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2015/01/15 18:09:06 landry Exp $
d41 1
d43 2
a44 1
NO_TEST=	Yes
@


1.8
log
@hppa joins the BROKEN club
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2014/12/15 20:04:48 brad Exp $
d10 3
a12 4
VER=		1.4
DISTNAME=	x265-${VER}
REVISION=	0
DISTFILES=	${DISTNAME}{${VER}}${EXTRACT_SUFX}
d14 1
a14 2
MASTER_SITES=	https://bitbucket.org/multicoreware/x265/get/
EXTRACT_SUFX=	.tar.bz2
d16 1
a16 1
SHARED_LIBS=	x265	1.0
a27 1
WRKDIST=	${WRKDIR}/multicoreware-x265-5e604833c5aa
@


1.7
log
@The 32-bit atomic ops functions are missing for mips64 and miod@@ says
this definitely won't build on gcc3 archs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2014/12/08 08:25:05 brad Exp $
d4 1
@


1.6
log
@Two commits from upstream..

constants: remove init/destroyROM functions
threading: use 32bit atomic integer operations exclusively

Tested on amd64/i386/sparc64 now builds on powerpc.
@
text
@d1 5
a5 1
# $OpenBSD: Makefile,v 1.5 2014/11/02 11:36:48 brad Exp $
@


1.5
log
@Update to x265 1.4.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2014/10/09 02:23:10 brad Exp $
a3 4
BROKEN-hppa =		undefined reference to `__sync_val_compare_and_swap_8'
BROKEN-mips64 =		undefined reference to `__sync_val_compare_and_swap_8'
BROKEN-mips64el =	undefined reference to `__sync_val_compare_and_swap_8'
BROKEN-powerpc =	undefined reference to `__sync_val_compare_and_swap_8'
d7 1
@


1.4
log
@also broken on mips64.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2014/09/16 19:21:21 landry Exp $
d9 3
a11 2
DISTNAME=	1.3
PKGNAME=	x265-${DISTNAME}
d16 1
a16 1
SHARED_LIBS=	x265	0.0
d28 1
a28 2
DIST_SUBDIR=	x265
WRKDIST=	${WRKDIR}/multicoreware-x265-c1e4fc0162c1
@


1.3
log
@BROKEN-hppa - undefined refs to gcc builtin atomic ops.
That's what happens when you only care about i386/amd64, and dont even try
gcc4 module for other archs...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2014/09/16 18:13:58 landry Exp $
d4 3
a7 2
BROKEN-hppa =		undefined reference to `__sync_val_compare_and_swap_8'

@


1.2
log
@BROKEN-powerpc: when linking libx265.so.0.0
undefined reference to `__sync_val_compare_and_swap_8'
undefined reference to `__sync_or_and_fetch_8'
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2014/09/04 05:37:41 brad Exp $
d5 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d4 1
@


1.1.1.1
log
@Import of x265.

x265 is an open-source project and free application library for
encoding video streams into the H.265/High Efficiency Video Coding
(HEVC) format.

ok ajacoutot@@
@
text
@@
