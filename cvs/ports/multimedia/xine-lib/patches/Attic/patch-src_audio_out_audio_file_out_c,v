head	1.4;
access;
symbols;
locks; strict;
comment	@# @;


1.4
date	2012.06.10.07.35.30;	author ajacoutot;	state dead;
branches;
next	1.3;

1.3
date	2012.04.07.05.48.49;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2012.01.05.08.52.26;	author ajacoutot;	state dead;
branches;
next	1.1;

1.1
date	2011.11.16.00.43.17;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to stable, xine-lib-1.1.21.

from Brad (maintainer)
@
text
@$OpenBSD: patch-src_audio_out_audio_file_out_c,v 1.3 2012/04/07 05:48:49 ajacoutot Exp $

Check for failed write.

--- src/audio_out/audio_file_out.c.orig	Fri Feb 17 22:37:27 2012
+++ src/audio_out/audio_file_out.c	Fri Feb 17 22:37:51 2012
@@@@ -274,10 +274,20 @@@@ static void ao_file_close(ao_driver_t *this_gen)
 		 this->fname, this->bytes_written / 1024);
 
 	if (lseek(this->fd, 40, SEEK_SET) != -1) {
-		write(this->fd, &len, 4);
+		if (write(this->fd, &len, 4) != 4) {
+			xprintf (this->xine, XINE_VERBOSITY_LOG, "audio_file_out: Failed to write header to file '%s': %s\n",
+                                 this->fname, strerror(errno));
+		}
+
 		len = le2me_32(this->bytes_written + 0x24);
-		if (lseek(this->fd, 4, SEEK_SET) != -1)
-			write(this->fd, &len, 4);
+		if (lseek(this->fd, 4, SEEK_SET) != -1) {
+			if (write(this->fd, &len, 4) != 4) {
+				xprintf (this->xine, XINE_VERBOSITY_LOG,
+                                         "audio_file_out: Failed to write header to file '%s': %s\n",
+                                         this->fname, strerror(errno));
+                        }
+		}
+
 	}
 
 	close(this->fd);
@


1.3
log
@Bring a bunch of bugfixes from upstream.

from Brad
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@Bugfix update to xine-lib-1.1.20.1.

from Brad (maintainer)
@
text
@d1 8
a8 8
$OpenBSD: patch-src_audio_out_audio_file_out_c,v 1.1 2011/11/16 00:43:17 sthen Exp $
--- src/audio_out/audio_file_out.c.orig	Sat Nov 12 22:09:55 2011
+++ src/audio_out/audio_file_out.c	Sat Nov 12 22:17:03 2011
@@@@ -30,6 +30,7 @@@@
 #include <math.h>
 #include <unistd.h>
 #include <inttypes.h>
+#include <sys/stat.h>
d10 21
a30 2
 #include "xine_internal.h"
 #include "xineutils.h"
@


1.1
log
@update to xine-lib 1.1.20, from Brad
@
text
@d1 1
a1 1
$OpenBSD$
@

