head	1.4;
access;
symbols
	OPENBSD_4_4:1.2.0.4
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.2
	OPENBSD_4_3_BASE:1.2;
locks; strict;
comment	@# @;


1.4
date	2008.09.15.22.11.42;	author jakemsr;	state dead;
branches;
next	1.3;

1.3
date	2008.08.20.01.54.01;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2008.01.15.00.36.46;	author jakemsr;	state Exp;
branches;
next	1.1;

1.1
date	2007.09.04.00.44.26;	author jakemsr;	state Exp;
branches;
next	;


desc
@@


1.4
log
@
- simpler faad related patching
- bump PKGNAME

ok brad@@
@
text
@$OpenBSD: patch-src_libfaad_xine_faad_decoder_c,v 1.3 2008/08/20 01:54:01 brad Exp $
--- src/libfaad/xine_faad_decoder.c.orig	Wed Aug 13 12:26:38 2008
+++ src/libfaad/xine_faad_decoder.c	Thu Aug 14 18:48:40 2008
@@@@ -56,26 +56,26 @@@@ typedef struct faad_decoder_s {
   xine_stream_t    *stream;
   
   /* faad2 stuff */
-  NeAACDecHandle           faac_dec;
-  NeAACDecConfigurationPtr faac_cfg;
-  NeAACDecFrameInfo        faac_finfo;
+  faacDecHandle           faac_dec;
+  faacDecConfigurationPtr faac_cfg;
+  faacDecFrameInfo        faac_finfo;
   int                     faac_failed;
  
   int              raw_mode;
   
-  unsigned char   *buf;
-  int              size;
+  uint8_t         *buf;
+  uint32_t         size;
   int              rec_audio_src_size;
   int              max_audio_src_size;
   int              pts;
   
-  unsigned char   *dec_config;
-  int              dec_config_size;
+  uint8_t         *dec_config;
+  uint32_t         dec_config_size;
   
   uint32_t         rate;
   int              bits_per_sample; 
-  unsigned char    num_channels; 
-  int              sbr;
+  uint8_t          num_channels; 
+  uint8_t          sbr;
   uint32_t         ao_cap_mode; 
    
   int              output_open;
@@@@ -126,33 +126,33 @@@@ static void faad_meta_info_set ( faad_decoder_t *this 
 static int faad_open_dec( faad_decoder_t *this ) {
   int used;
 
-  this->faac_dec = NeAACDecOpen();
+  this->faac_dec = faacDecOpen();
   if( !this->faac_dec ) {
     xprintf( this->stream->xine, XINE_VERBOSITY_LOG,
-             _("libfaad: libfaad NeAACDecOpen() failed.\n"));
+             _("libfaad: libfaad faacDecOpen() failed.\n"));
     this->faac_failed++;
   } else {
     if( this->dec_config ) {
-      used = NeAACDecInit2(this->faac_dec, this->dec_config, this->dec_config_size,
+      used = faacDecInit2(this->faac_dec, this->dec_config, this->dec_config_size,
                           &this->rate, &this->num_channels);
       
       if( used < 0 ) {
         xprintf( this->stream->xine, XINE_VERBOSITY_LOG,
-                _("libfaad: libfaad NeAACDecInit2 failed.\n"));
+                _("libfaad: libfaad faacDecInit2 failed.\n"));
         this->faac_failed++;
       } else
-        lprintf( "NeAACDecInit2 returned rate=%"PRId32" channels=%d\n",
+        lprintf( "faacDecInit2 returned rate=%"PRId32" channels=%d\n",
                  this->rate, this->num_channels );
     } else {
-      used = NeAACDecInit(this->faac_dec, this->buf, this->size,
+      used = faacDecInit(this->faac_dec, this->buf, this->size,
                         &this->rate, &this->num_channels);
         
       if( used < 0 ) {
         xprintf ( this->stream->xine, XINE_VERBOSITY_LOG,
-                  _("libfaad: libfaad NeAACDecInit failed.\n"));
+                  _("libfaad: libfaad faacDecInit failed.\n"));
         this->faac_failed++;
       } else {
-        lprintf( "NeAACDecInit() returned rate=%"PRId32" channels=%d (used=%d)\n",
+        lprintf( "faacDecInit() returned rate=%"PRId32" channels=%d (used=%d)\n",
                  this->rate, this->num_channels, used);
                       
         this->size -= used;
@@@@ -166,7 +166,7 @@@@ static int faad_open_dec( faad_decoder_t *this ) {
   
   if( this->faac_failed ) {
     if( this->faac_dec ) {
-      NeAACDecClose( this->faac_dec );
+      faacDecClose( this->faac_dec );
       this->faac_dec = NULL;
     }
     _x_stream_info_set(this->stream, XINE_STREAM_INFO_AUDIO_HANDLED, 0);
@@@@ -190,9 +190,9 @@@@ static int faad_open_output( faad_decoder_t *this ) {
         this->ao_cap_mode = AO_CAP_MODE_5_1CHANNEL;
         break;
       } else {
-        this->faac_cfg = NeAACDecGetCurrentConfiguration(this->faac_dec);
+        this->faac_cfg = faacDecGetCurrentConfiguration(this->faac_dec);
         this->faac_cfg->downMatrix = 1;
-        NeAACDecSetConfiguration(this->faac_dec, this->faac_cfg);
+        faacDecSetConfiguration(this->faac_dec, this->faac_cfg);
         this->num_channels = 2;
       }
     case 2:
@@@@ -215,7 +215,7 @@@@ static void faad_decode_audio ( faad_decoder_t *this, 
   uint8_t *sample_buffer;
   uint8_t *inbuf;
   audio_buffer_t *audio_buffer;
-  int sample_size = this->size;
+  uint32_t sample_size = this->size;
     
   if( !this->faac_dec )
     return;
@@@@ -224,12 +224,12 @@@@ static void faad_decode_audio ( faad_decoder_t *this, 
   while( (!this->raw_mode && end_frame && this->size >= 10) ||
          (this->raw_mode && this->size >= this->rec_audio_src_size) ) {
       
-    sample_buffer = NeAACDecDecode(this->faac_dec, 
+    sample_buffer = faacDecDecode(this->faac_dec, 
                                   &this->faac_finfo, inbuf, sample_size);
  
     if( !sample_buffer ) {
       xprintf(this->stream->xine, XINE_VERBOSITY_DEBUG,
-              "libfaad: %s\n", NeAACDecGetErrorMessage(this->faac_finfo.error));
+              "libfaad: %s\n", faacDecGetErrorMessage(this->faac_finfo.error));
       used = 1;    
     } else {
       used = this->faac_finfo.bytesconsumed;
@@@@ -409,7 +409,7 @@@@ static void faad_dispose (audio_decoder_t *this_gen) {
   this->dec_config_size = 0;
   
   if( this->faac_dec )
-    NeAACDecClose(this->faac_dec);
+    faacDecClose(this->faac_dec);
   this->faac_dec = NULL;
   this->faac_failed = 0;
 
@


1.3
log
@update to Xine-lib 1.1.15

This release contains some security fixes, notably a DoS via
corrupted Ogg files (CVS-2008-3231), some related fixes, and
fixes for a few possible buffer overflows.

ok jakemsr@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_libfaad_xine_faad_decoder_c,v 1.2 2008/01/15 00:36:46 jakemsr Exp $
@


1.2
log
@update to 1.1.9.1

security fix: CVE-2008-0225 - heap-based buffer overflow in libreal (RTSP)

also incorporates post release bug fix in WMV decoding

from brad, thanks
@
text
@d1 4
a4 26
$OpenBSD: patch-src_libfaad_xine_faad_decoder_c,v 1.1 2007/09/04 00:44:26 jakemsr Exp $
--- src/libfaad/xine_faad_decoder.c.orig	Tue Jan  1 08:30:08 2008
+++ src/libfaad/xine_faad_decoder.c	Wed Jan  9 01:50:22 2008
@@@@ -31,16 +31,21 @@@@
 #define LOG
 */
 
+#include <faad.h>
+
 #include "xine_internal.h"
 #include "audio_out.h"
 #include "buffer.h"
 #include "xineutils.h"
+
+#if 0
 #include "common.h"
 #include "structs.h"
 #include "decoder.h"
 #include "syntax.h"
 
 #define FAAD_MIN_STREAMSIZE 768 /* 6144 bits/channel */
+#endif
 
 typedef struct {
   audio_decoder_class_t   decoder_class;
@@@@ -52,26 +57,26 @@@@ typedef struct faad_decoder_s {
d40 1
a40 1
@@@@ -122,33 +127,33 @@@@ static void faad_meta_info_set ( faad_decoder_t *this 
d82 1
a82 1
@@@@ -162,7 +167,7 @@@@ static int faad_open_dec( faad_decoder_t *this ) {
d91 1
a91 1
@@@@ -186,9 +191,9 @@@@ static int faad_open_output( faad_decoder_t *this ) {
d103 1
a103 1
@@@@ -211,7 +216,7 @@@@ static void faad_decode_audio ( faad_decoder_t *this, 
d112 1
a112 1
@@@@ -220,12 +225,12 @@@@ static void faad_decode_audio ( faad_decoder_t *this, 
d127 1
a127 1
@@@@ -405,7 +410,7 @@@@ static void faad_dispose (audio_decoder_t *this_gen) {
@


1.1
log
@- make xine-lib's AAC decoder use libfaad from the audio/faad port
- bump PKGNAME

ok naddy@@
@
text
@d1 4
a4 4
$OpenBSD$
--- src/libfaad/xine_faad_decoder.c.orig	Fri Aug 31 21:54:08 2007
+++ src/libfaad/xine_faad_decoder.c	Fri Aug 31 22:26:08 2007
@@@@ -34,16 +34,21 @@@@
d26 1
a26 1
@@@@ -55,26 +60,26 @@@@ typedef struct faad_decoder_s {
d62 1
a62 1
@@@@ -125,33 +130,33 @@@@ static void faad_meta_info_set ( faad_decoder_t *this 
d104 1
a104 1
@@@@ -165,7 +170,7 @@@@ static int faad_open_dec( faad_decoder_t *this ) {
d113 1
a113 1
@@@@ -189,9 +194,9 @@@@ static int faad_open_output( faad_decoder_t *this ) {
d125 1
a125 1
@@@@ -212,7 +217,7 @@@@ static void faad_decode_audio ( faad_decoder_t *this, 
d134 1
a134 1
@@@@ -221,12 +226,12 @@@@ static void faad_decode_audio ( faad_decoder_t *this, 
d149 1
a149 1
@@@@ -406,7 +411,7 @@@@ static void faad_dispose (audio_decoder_t *this_gen) {
@

