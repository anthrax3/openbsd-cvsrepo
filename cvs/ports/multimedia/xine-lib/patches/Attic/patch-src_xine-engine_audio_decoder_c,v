head	1.14;
access;
symbols
	OPENBSD_4_8:1.8.0.4
	OPENBSD_4_8_BASE:1.8
	OPENBSD_4_7:1.8.0.2
	OPENBSD_4_7_BASE:1.8
	OPENBSD_4_6:1.7.0.4
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.7.0.2
	OPENBSD_4_5_BASE:1.7
	OPENBSD_4_4:1.6.0.4
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.2
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.2.0.2
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.1.1.1.0.2
	OPENBSD_4_0_BASE:1.1.1.1
	jakemsr:1.1.1.1
	jakemsr-20060324:1.1.1;
locks; strict;
comment	@# @;


1.14
date	2012.06.10.07.35.30;	author ajacoutot;	state dead;
branches;
next	1.13;

1.13
date	2012.05.09.06.29.43;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2011.11.16.00.43.17;	author sthen;	state dead;
branches;
next	1.11;

1.11
date	2011.10.09.20.45.07;	author sthen;	state Exp;
branches;
next	1.10;

1.10
date	2010.11.07.18.45.38;	author jasper;	state dead;
branches;
next	1.9;

1.9
date	2010.09.13.20.12.16;	author sthen;	state Exp;
branches;
next	1.8;

1.8
date	2010.01.05.11.48.51;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2009.02.16.01.24.24;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2008.01.15.00.36.46;	author jakemsr;	state Exp;
branches;
next	1.5;

1.5
date	2007.10.31.10.55.37;	author jakemsr;	state Exp;
branches;
next	1.4;

1.4
date	2007.06.13.10.58.29;	author jakemsr;	state Exp;
branches;
next	1.3;

1.3
date	2007.05.01.20.05.10;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2006.10.12.04.48.14;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2006.03.24.22.43.41;	author jakemsr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.03.24.22.43.41;	author jakemsr;	state Exp;
branches
	1.1.1.1.2.1;
next	;

1.1.1.1.2.1
date	2006.11.01.13.13.03;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.14
log
@Update to stable, xine-lib-1.1.21.

from Brad (maintainer)
@
text
@$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.13 2012/05/09 06:29:43 ajacoutot Exp $
--- src/xine-engine/audio_decoder.c.orig	Tue May  8 23:20:07 2012
+++ src/xine-engine/audio_decoder.c	Tue May  8 23:20:47 2012
@@@@ -466,7 +466,7 @@@@ static void *audio_decoder_loop (void *stream_gen) {
 int _x_audio_decoder_init (xine_stream_t *stream) {
 
   pthread_attr_t       pth_attrs;
-#ifdef _POSIX_THREAD_PRIORITY_SCHEDULING
+#if defined(_POSIX_THREAD_PRIORITY_SCHEDULING) && (_POSIX_THREAD_PRIORITY_SCHEDULING > 0)
   struct sched_param   pth_params;
 #endif
   int                  err;
@@@@ -506,7 +506,7 @@@@ int _x_audio_decoder_init (xine_stream_t *stream) {
      */
 
     pthread_attr_init(&pth_attrs);
-#ifdef _POSIX_THREAD_PRIORITY_SCHEDULING
+#if defined(_POSIX_THREAD_PRIORITY_SCHEDULING) && (_POSIX_THREAD_PRIORITY_SCHEDULING > 0)
     pthread_attr_getschedparam(&pth_attrs, &pth_params);
     pth_params.sched_priority = sched_get_priority_min(SCHED_OTHER);
     pthread_attr_setschedparam(&pth_attrs, &pth_params);
@


1.13
log
@Correct the utilization of the _POSIX_THREAD_PRIORITY_SCHEDULING feature
test macro.

from Brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.12
log
@update to xine-lib 1.1.20, from Brad
@
text
@d1 5
a5 13
$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.11 2011/10/09 20:45:07 sthen Exp $

Fix audio crash.

--- src/xine-engine/audio_decoder.c.orig	Wed Sep 28 01:38:57 2011
+++ src/xine-engine/audio_decoder.c	Wed Sep 28 01:39:29 2011
@@@@ -283,6 +283,9 @@@@ static void *audio_decoder_loop (void *stream_gen) {
           }
           stream->audio_track_map[i] = buf->type;
           stream->audio_track_map_entries++;
+          /* implicit channel change - reopen decoder below */
+          if ((i == 0) && (audio_channel_user == -1) && (stream->audio_channel_auto < 0))
+            stream->audio_decoder_streamtype = -1;
d7 15
a21 2
 	  ui_event.type        = XINE_EVENT_UI_CHANNELS_CHANGED;
 	  ui_event.data_length = 0;
@


1.11
log
@Backport support to xine-lib for VP8 (WebM) and RealVideo 3/4, improved
24-bit LPCM support and various bug fixes. From Brad.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.10
log
@- remove unneeded patches that we have sched_get_priority_* now.

from brad (MAINTAINER)
@
text
@d1 16
a16 13
$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.9 2010/09/13 20:12:16 sthen Exp $
--- src/xine-engine/audio_decoder.c.orig	Wed Jul 21 13:43:52 2010
+++ src/xine-engine/audio_decoder.c	Tue Jul 27 16:54:36 2010
@@@@ -505,7 +505,9 @@@@ int _x_audio_decoder_init (xine_stream_t *stream) {
     pthread_attr_init(&pth_attrs);
 #ifdef _POSIX_THREAD_PRIORITY_SCHEDULING
     pthread_attr_getschedparam(&pth_attrs, &pth_params);
+#ifndef __OpenBSD__
     pth_params.sched_priority = sched_get_priority_min(SCHED_OTHER);
+#endif
     pthread_attr_setschedparam(&pth_attrs, &pth_params);
     pthread_attr_setscope(&pth_attrs, PTHREAD_SCOPE_SYSTEM);
 #endif
@


1.9
log
@update xine-lib to 1.1.19 and switch to new-style LIB_DEPENDS/WANTLIB
from Brad, thanks landry@@ for testing in bulk build
@
text
@d1 1
a1 1
$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.8 2010/01/05 11:48:51 sthen Exp $
@


1.8
log
@Update to xine-lib 1.1.17 and disable win32 codecs. From Brad.
@
text
@d1 4
a4 16
$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.7 2009/02/16 01:24:24 sthen Exp $
--- src/xine-engine/audio_decoder.c.orig	Mon Nov 30 15:55:52 2009
+++ src/xine-engine/audio_decoder.c	Wed Dec  2 20:38:44 2009
@@@@ -463,7 +463,9 @@@@ static void *audio_decoder_loop (void *stream_gen) {
 int _x_audio_decoder_init (xine_stream_t *stream) {
 
   pthread_attr_t       pth_attrs;
+#if !defined(__OpenBSD__)
   struct sched_param   pth_params;
+#endif
   int                  err;
 
   if (stream->audio_out == NULL) {
@@@@ -501,10 +503,12 @@@@ int _x_audio_decoder_init (xine_stream_t *stream) {
      */
 
d6 1
a6 1
+#if !defined(__OpenBSD__)
d8 1
d10 1
d13 1
a13 4
+#endif
 
     stream->audio_thread_created = 1;
     if ((err = pthread_create (&stream->audio_thread,
@


1.7
log
@SECURITY update to 1.1.16.2; CVE-2008-5239, CVE-2008-5240, TKADV2009-004
from Brad (maintainer).
@
text
@d1 3
a3 3
$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.6 2008/01/15 00:36:46 jakemsr Exp $
--- src/xine-engine/audio_decoder.c.orig	Tue Feb 10 12:32:23 2009
+++ src/xine-engine/audio_decoder.c	Wed Feb 11 00:55:26 2009
d24 2
a25 2
  
     stream->audio_thread_created = 1; 
@


1.6
log
@update to 1.1.9.1

security fix: CVE-2008-0225 - heap-based buffer overflow in libreal (RTSP)

also incorporates post release bug fix in WMV decoding

from brad, thanks
@
text
@d1 4
a4 4
$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.5 2007/10/31 10:55:37 jakemsr Exp $
--- src/xine-engine/audio_decoder.c.orig	Tue Jan  1 08:30:09 2008
+++ src/xine-engine/audio_decoder.c	Wed Jan  9 01:50:22 2008
@@@@ -461,7 +461,9 @@@@ static void *audio_decoder_loop (void *stream_gen) {
d14 1
a14 1
@@@@ -499,10 +501,12 @@@@ int _x_audio_decoder_init (xine_stream_t *stream) {
@


1.5
log
@maintainence update to xine-lib-1.1.8

from brad@@
@
text
@d1 4
a4 4
$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.4 2007/06/13 10:58:29 jakemsr Exp $
--- src/xine-engine/audio_decoder.c.orig	Sat Aug 18 19:36:59 2007
+++ src/xine-engine/audio_decoder.c	Wed Oct 17 20:29:25 2007
@@@@ -463,7 +463,9 @@@@ static void *audio_decoder_loop (void *stream_gen) {
d14 1
a14 1
@@@@ -501,10 +503,12 @@@@ int _x_audio_decoder_init (xine_stream_t *stream) {
@


1.4
log
@update to xine-lib-1.1.7

- use some CONFIGURE_ENV instead of patching
- rearrange/update CONFIGURE_ARGS
- many patches no longer relevant
- add CD audio support

input, tetsing and prodding from brad@@
@
text
@d1 4
a4 4
$OpenBSD$
--- src/xine-engine/audio_decoder.c.orig	Sun Apr 15 10:42:17 2007
+++ src/xine-engine/audio_decoder.c	Sun May 20 22:40:14 2007
@@@@ -462,7 +462,9 @@@@ static void *audio_decoder_loop (void *stream_gen) {
d14 1
a14 1
@@@@ -500,10 +502,12 @@@@ int _x_audio_decoder_init (xine_stream_t *stream) {
@


1.3
log
@regen patches
@
text
@d1 3
a3 3
$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.2 2006/10/12 04:48:14 brad Exp $
--- src/xine-engine/audio_decoder.c.orig	Sun Jul  9 16:40:08 2006
+++ src/xine-engine/audio_decoder.c	Tue May  1 22:03:06 2007
d5 1
a5 1
 void _x_audio_decoder_init (xine_stream_t *stream) {
d14 1
a14 1
@@@@ -500,10 +502,12 @@@@ void _x_audio_decoder_init (xine_stream_t *stream) {
@


1.2
log
@upgrade to xine-lib 1.1.2

* Security fixes:
  - CVE-2006-2802: possible buffer overflow in the HTTP plugin.
  - possible buffer overflow via bad indexes in specially-crafted AVI files
* Fix a potential crash with fixed-size lacing in the Matroska demuxer
* Enable AMD64 mmx/sse support in some plugins (tvtime, libmpeg2, goom...)
* Fix xxmc subpictures (broken since 1.1.1)
* Add support for RealPlayer 10 codecs

WANTLIB tweak from bernd@@

testing by steven@@ and bernd@@
@
text
@d1 4
a4 4
$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.1.1.1 2006/03/24 22:43:41 jakemsr Exp $
--- src/xine-engine/audio_decoder.c.orig	Sun Jul  9 10:40:08 2006
+++ src/xine-engine/audio_decoder.c	Fri Sep 15 17:53:21 2006
@@@@ -462,7 +462,9 @@@@ static void *audio_decoder_loop (void *s
d14 1
a14 1
@@@@ -500,10 +502,12 @@@@ void _x_audio_decoder_init (xine_stream_
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD$
--- src/xine-engine/audio_decoder.c.orig	Sat Oct 29 21:18:35 2005
+++ src/xine-engine/audio_decoder.c	Fri Dec 30 02:33:47 2005
@@@@ -449,7 +449,9 @@@@ static void *audio_decoder_loop (void *s
d14 1
a14 1
@@@@ -487,10 +489,12 @@@@ void _x_audio_decoder_init (xine_stream_
@


1.1.1.1
log
@initial import of xine-lib

xine is a free multimedia player. It plays back CDs, DVDs, and VCDs. It
also decodes multimedia files like AVI, MOV, WMV, and MP3 from local
disk drives, and displays multimedia streamed over the Internet. It
interprets many of the most common multimedia formats available - and
some of the most uncommon formats, too.

prodded by jolan@@ and bernd@@

@
text
@@


1.1.1.1.2.1
log
@MFC:
upgrade to xine-lib 1.1.2

* Security fixes:
- CVE-2006-2802: possible buffer overflow in the HTTP plugin.
- possible buffer overflow via bad indexes in specially-crafted AVI files
* Fix a potential crash with fixed-size lacing in the Matroska demuxer
* Enable AMD64 mmx/sse support in some plugins (tvtime, libmpeg2, goom...)
* Fix xxmc subpictures (broken since 1.1.1)
* Add support for RealPlayer 10 codecs

WANTLIB tweak from bernd@@
@
text
@d1 4
a4 4
$OpenBSD: patch-src_xine-engine_audio_decoder_c,v 1.2 2006/10/12 04:48:14 brad Exp $
--- src/xine-engine/audio_decoder.c.orig	Sun Jul  9 10:40:08 2006
+++ src/xine-engine/audio_decoder.c	Fri Sep 15 17:53:21 2006
@@@@ -462,7 +462,9 @@@@ static void *audio_decoder_loop (void *s
d14 1
a14 1
@@@@ -500,10 +502,12 @@@@ void _x_audio_decoder_init (xine_stream_
@

