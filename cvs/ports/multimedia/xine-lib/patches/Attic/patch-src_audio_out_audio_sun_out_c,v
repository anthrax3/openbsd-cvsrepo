head	1.7;
access;
symbols
	OPENBSD_4_4:1.6.0.4
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.2
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.5.0.2
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.2.0.2
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.1.1.1.0.2
	OPENBSD_4_0_BASE:1.1.1.1
	jakemsr:1.1.1.1
	jakemsr-20060324:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2009.02.02.22.00.42;	author sthen;	state dead;
branches;
next	1.6;

1.6
date	2008.01.15.00.36.46;	author jakemsr;	state Exp;
branches;
next	1.5;

1.5
date	2007.07.14.09.21.15;	author jakemsr;	state Exp;
branches;
next	1.4;

1.4
date	2007.06.13.10.58.29;	author jakemsr;	state dead;
branches;
next	1.3;

1.3
date	2007.05.01.20.05.10;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2006.10.12.04.48.14;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2006.03.24.22.43.41;	author jakemsr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.03.24.22.43.41;	author jakemsr;	state Exp;
branches
	1.1.1.1.2.1;
next	;

1.1.1.1.2.1
date	2006.11.01.13.13.03;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.7
log
@- SECURITY update to Xine-lib 1.1.16.1
  - Heap overflow in Quicktime atom parsing.  (CVE-2008-5234 vector 1)
  - Multiple buffer overflows.                (CVE-2008-5236)
  - Multiple integer overflows.               (CVE-2008-5237)
  - Unchecked read function results.          (CVE-2008-5239)
  - Unchecked malloc using untrusted values.  (CVE-2008-5240 vectors 3 & 4)
  - Buffer indexing using an untrusted value. (CVE-2008-5243)
- Clean up the Makefile
- Enable the Xv motion compensation support
- Remove the JACK sound support
- Remove the now unnecessary multi-packaging
- Remove an unnecessary patch for the Sun sound code
- Comment out some files in the PLIST that do not pertain to OpenBSD
- Add WavPack support

from Brad (taking MAINTAINER).
@
text
@$OpenBSD: patch-src_audio_out_audio_sun_out_c,v 1.6 2008/01/15 00:36:46 jakemsr Exp $
--- src/audio_out/audio_sun_out.c.orig	Tue Jan  1 08:30:08 2008
+++ src/audio_out/audio_sun_out.c	Wed Jan  9 01:50:21 2008
@@@@ -582,9 +582,9 @@@@ static int ao_sun_bytes_per_frame(ao_driver_t *this_ge
 static int ao_sun_delay(ao_driver_t *this_gen)
 {
   sun_driver_t *this = (sun_driver_t *) this_gen;
+#ifdef __svr4__
   audio_info_t info;
 
-#ifdef __svr4__
   if (ioctl(this->audio_fd, AUDIO_GETINFO, &info) == 0 &&
       (this->frames_in_buffer == 0 || info.play.samples > 0)) {
 
@@@@ -632,8 +632,9 @@@@ static int ao_sun_delay(ao_driver_t *this_gen)
 #endif
   }
 #else
-  if (ioctl(this->audio_fd, AUDIO_GETINFO, &info) == 0)
-    return info.play.seek / this->bytes_per_frame;
+  u_long bytes;
+  if (ioctl(this->audio_fd, AUDIO_WSEEK, &bytes) == 0)
+    return bytes / this->bytes_per_frame;
 #endif
   return NOT_REAL_TIME;
 }
@@@@ -888,8 +889,7 @@@@ static int ao_sun_ctrl(ao_driver_t *this_gen, int cmd,
 
     this->frames_in_buffer = 0;
     this->last_samplecnt = 0;
-#endif
-#ifdef __NetBSD__
+#else
     ioctl(this->audio_fd, AUDIO_FLUSH);
 #endif
     break;
@@@@ -964,11 +964,20 @@@@ static ao_driver_t *ao_sun_open_plugin (audio_driver_c
   status = ioctl(this->audio_fd, AUDIO_SETINFO, &info);
   
   if (status < 0) {
-    xprintf(this->xine, XINE_VERBOSITY_LOG,
+    /* some devices are 48kHz only */
+    AUDIO_INITINFO(&info);
+    info.play.encoding = AUDIO_ENCODING_LINEAR;
+    info.play.precision = AUDIO_PRECISION_16;
+    info.play.sample_rate = 48000;
+    status = ioctl(this->audio_fd, AUDIO_SETINFO, &info);
+
+    if (status < 0) {
+      xprintf(this->xine, XINE_VERBOSITY_LOG,
 	    _("audio_sun_out: audio ioctl on device %s failed: %s\n"), devname, strerror(errno));
 
-    free (this);
-    return NULL;
+      free (this);
+      return NULL;
+    }
   }
 
   /*
@


1.6
log
@update to 1.1.9.1

security fix: CVE-2008-0225 - heap-based buffer overflow in libreal (RTSP)

also incorporates post release bug fix in WMV decoding

from brad, thanks
@
text
@d1 1
a1 1
$OpenBSD: patch-src_audio_out_audio_sun_out_c,v 1.5 2007/07/14 09:21:15 jakemsr Exp $
@


1.5
log
@- use AUDIO_WSEEK instead of AUDIO_GETINFO to get the number of bytes
  in the audio write buffer.  noticibly more efficient.

- allow the audio write buffer to be flushed.

- if initializing the audio device with a sample rate of 44.1kHz
  fails, try initializing with a sample rate of 48kHz.  some audio
  drivers only support 48kHz.  from Alexey Suslikov
  <alexey.suslikov@@gmail.com>

- bump PKGNAME

(goes with Makefile commit ... frickin cvs ...)
@
text
@d1 4
a4 4
$OpenBSD$
--- src/audio_out/audio_sun_out.c.orig	Fri Jul 13 23:42:54 2007
+++ src/audio_out/audio_sun_out.c	Fri Jul 13 23:42:54 2007
@@@@ -584,9 +584,9 @@@@ static int ao_sun_bytes_per_frame(ao_driver_t *this_ge
d15 1
a15 1
@@@@ -634,8 +634,9 @@@@ static int ao_sun_delay(ao_driver_t *this_gen)
d27 1
a27 1
@@@@ -890,8 +891,7 @@@@ static int ao_sun_ctrl(ao_driver_t *this_gen, int cmd,
d37 1
a37 1
@@@@ -966,11 +966,20 @@@@ static ao_driver_t *ao_sun_open_plugin (audio_driver_c
@


1.4
log
@update to xine-lib-1.1.7

- use some CONFIGURE_ENV instead of patching
- rearrange/update CONFIGURE_ARGS
- many patches no longer relevant
- add CD audio support

input, tetsing and prodding from brad@@
@
text
@d1 5
a5 44
$OpenBSD: patch-src_audio_out_audio_sun_out_c,v 1.3 2007/05/01 20:05:10 naddy Exp $
--- src/audio_out/audio_sun_out.c.orig	Sun Jul  9 16:37:12 2006
+++ src/audio_out/audio_sun_out.c	Tue May  1 22:03:06 2007
@@@@ -41,7 +41,12 @@@@
 #ifdef	__svr4__
 #include <stropts.h>
 #endif
+#include <sys/param.h>
 
+#if (defined(BSD) && BSD >= 199306)
+typedef unsigned uint_t;
+#endif
+
 #include "xine_internal.h"
 #include "xineutils.h"
 #include "audio_out.h"
@@@@ -89,7 +94,9 @@@@ typedef struct sun_driver_s {
   uint32_t       num_channels;
   int		 bytes_per_frame;
 
+#ifndef __OpenBSD__
   uint32_t       frames_in_buffer;     /* number of frames writen to audio hardware   */
+#endif
 
   enum {
       RTSC_UNKNOWN = 0,
@@@@ -114,12 +121,14 @@@@ typedef struct sun_driver_s {
   unsigned	 buf_len;
 #endif
 
+#ifndef __OpenBSD__
 #if	SW_SAMPLE_COUNT
   struct timeval tv0;
   uint_t	 sample0;
 #endif
 
   uint_t	 last_samplecnt;
+#endif
 } sun_driver_t;
 
 
@@@@ -129,6 +138,7 @@@@ typedef struct sun_driver_s {
  */
 static int realtime_samplecounter_available(xine_t *xine, char *dev)
a6 45
+#ifndef __OpenBSD__
   int fd = -1;
   audio_info_t info;
   int rtsc_ok = RTSC_DISABLED;
@@@@ -247,6 +257,9 @@@@ error:
   }
 
   return rtsc_ok;
+#else
+  return RTSC_ENABLED;
+#endif
 }
 
 
@@@@ -430,7 +443,9 @@@@ static int ao_sun_open(ao_driver_t *this_gen,
   
   this->mode			= mode;
   this->input_sample_rate	= rate;
+#ifndef __OpenBSD__
   this->frames_in_buffer	= 0;
+#endif
 
   /*
    * open audio device
@@@@ -462,6 +477,9 @@@@ static int ao_sun_open(ao_driver_t *this_gen,
       info.play.sample_rate = this->input_sample_rate;
       info.play.eof = 0;
       info.play.samples = 0;
+#ifdef __OpenBSD__
+      info.blocksize = 1024;
+#endif
 
       this->convert_u8_s8 = 0;
 
@@@@ -523,7 +541,9 @@@@ static int ao_sun_open(ao_driver_t *this_gen,
       return 0;
   }
 
+#ifndef __OpenBSD__
   this->last_samplecnt = 0;
+#endif
 
   this->output_sample_rate = info.play.sample_rate;
   this->num_channels = info.play.channels;
@@@@ -564,6 +584,7 @@@@ static int ao_sun_delay(ao_driver_t *this_gen)
d8 1
d11 1
a11 1
+#ifndef __OpenBSD__
d15 1
a15 2
@@@@ -610,6 +631,10 @@@@ static int ao_sun_delay(ao_driver_t *this_gen)
     }
d18 7
a24 4
+#else
+  if (ioctl(this->audio_fd, AUDIO_GETINFO, &info) == 0)
+    return info.play.seek / this->bytes_per_frame;
+#endif
d27 1
d29 30
a58 3
@@@@ -718,7 +743,9 @@@@ static int ao_sun_write(ao_driver_t *this_gen,
   if (num_written > 0) {
     int buffered_samples;
d60 1
a60 24
+#ifndef __OpenBSD__
     this->frames_in_buffer += num_written / this->bytes_per_frame;
+#endif
 
     /* 
      * Avoid storing too much data in the sound driver's buffers.
@@@@ -778,7 +805,7 @@@@ static int ao_sun_get_property (ao_driver_t *this_gen,
       this->mixer_volume = info.play.gain * 100 / AUDIO_MAX_GAIN;
     }
     return this->mixer_volume;
-#if !defined(__NetBSD__)    /* audio_info.output_muted is missing on NetBSD */
+#if !defined(__OpenBSD__)    /* audio_info.output_muted is missing on NetBSD */
   case AO_PROP_MUTE_VOL:
     if (ioctl(this->audio_fd, AUDIO_GETINFO, &info) < 0)
       return 0;
@@@@ -807,7 +834,7 @@@@ static int ao_sun_set_property (ao_driver_t *this_gen,
     if (ioctl(this->audio_fd, AUDIO_SETINFO, &info) < 0)
       return ~value;
     return value;
-#if !defined(__NetBSD__)    /* audio_info.output_muted is missing on NetBSD */
+#if !defined(__OpenBSD__)    /* audio_info.output_muted is missing on NetBSD */
   case AO_PROP_MUTE_VOL:
     info.output_muted = value != 0;
     if (ioctl(this->audio_fd, AUDIO_SETINFO, &info) < 0)
@


1.3
log
@regen patches
@
text
@d1 1
a1 1
$OpenBSD: patch-src_audio_out_audio_sun_out_c,v 1.2 2006/10/12 04:48:14 brad Exp $
@


1.2
log
@upgrade to xine-lib 1.1.2

* Security fixes:
  - CVE-2006-2802: possible buffer overflow in the HTTP plugin.
  - possible buffer overflow via bad indexes in specially-crafted AVI files
* Fix a potential crash with fixed-size lacing in the Matroska demuxer
* Enable AMD64 mmx/sse support in some plugins (tvtime, libmpeg2, goom...)
* Fix xxmc subpictures (broken since 1.1.1)
* Add support for RealPlayer 10 codecs

WANTLIB tweak from bernd@@

testing by steven@@ and bernd@@
@
text
@d1 3
a3 3
$OpenBSD: patch-src_audio_out_audio_sun_out_c,v 1.1.1.1 2006/03/24 22:43:41 jakemsr Exp $
--- src/audio_out/audio_sun_out.c.orig	Sun Jul  9 10:37:12 2006
+++ src/audio_out/audio_sun_out.c	Fri Sep 15 18:26:24 2006
d60 1
a60 1
@@@@ -430,7 +443,9 @@@@ static int ao_sun_open(ao_driver_t *this
d70 1
a70 1
@@@@ -462,6 +477,9 @@@@ static int ao_sun_open(ao_driver_t *this
d80 1
a80 1
@@@@ -523,7 +541,9 @@@@ static int ao_sun_open(ao_driver_t *this
d90 1
a90 1
@@@@ -564,6 +584,7 @@@@ static int ao_sun_delay(ao_driver_t *thi
d98 1
a98 1
@@@@ -610,6 +631,10 @@@@ static int ao_sun_delay(ao_driver_t *thi
d109 1
a109 1
@@@@ -718,7 +743,9 @@@@ static int ao_sun_write(ao_driver_t *thi
d119 1
a119 1
@@@@ -778,7 +805,7 @@@@ static int ao_sun_get_property (ao_drive
d128 1
a128 1
@@@@ -807,7 +834,7 @@@@ static int ao_sun_set_property (ao_drive
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
$OpenBSD$
--- src/audio_out/audio_sun_out.c.orig	Sun Dec 12 16:01:02 2004
+++ src/audio_out/audio_sun_out.c	Fri Dec 30 02:22:36 2005
d27 1
a27 1
@@@@ -113,12 +120,14 @@@@ typedef struct sun_driver_s {
d42 1
a42 1
@@@@ -128,6 +137,7 @@@@ typedef struct sun_driver_s {
d50 1
a50 1
@@@@ -246,6 +256,9 @@@@ error:
d60 1
a60 1
@@@@ -429,7 +442,9 @@@@ static int ao_sun_open(ao_driver_t *this
d70 1
a70 1
@@@@ -461,6 +476,9 @@@@ static int ao_sun_open(ao_driver_t *this
d80 1
a80 1
@@@@ -522,7 +540,9 @@@@ static int ao_sun_open(ao_driver_t *this
d90 1
a90 1
@@@@ -563,6 +583,7 @@@@ static int ao_sun_delay(ao_driver_t *thi
d98 1
a98 1
@@@@ -609,6 +630,10 @@@@ static int ao_sun_delay(ao_driver_t *thi
d109 1
a109 1
@@@@ -717,7 +742,9 @@@@ static int ao_sun_write(ao_driver_t *thi
d119 4
a122 4
@@@@ -776,7 +803,7 @@@@ static int ao_sun_get_property (ao_drive
     if (ioctl(this->audio_fd, AUDIO_GETINFO, &info) < 0)
       return 0;
     return info.play.gain * 100 / AUDIO_MAX_GAIN;
d128 1
a128 1
@@@@ -804,7 +831,7 @@@@ static int ao_sun_set_property (ao_drive
@


1.1.1.1
log
@initial import of xine-lib

xine is a free multimedia player. It plays back CDs, DVDs, and VCDs. It
also decodes multimedia files like AVI, MOV, WMV, and MP3 from local
disk drives, and displays multimedia streamed over the Internet. It
interprets many of the most common multimedia formats available - and
some of the most uncommon formats, too.

prodded by jolan@@ and bernd@@

@
text
@@


1.1.1.1.2.1
log
@MFC:
upgrade to xine-lib 1.1.2

* Security fixes:
- CVE-2006-2802: possible buffer overflow in the HTTP plugin.
- possible buffer overflow via bad indexes in specially-crafted AVI files
* Fix a potential crash with fixed-size lacing in the Matroska demuxer
* Enable AMD64 mmx/sse support in some plugins (tvtime, libmpeg2, goom...)
* Fix xxmc subpictures (broken since 1.1.1)
* Add support for RealPlayer 10 codecs

WANTLIB tweak from bernd@@
@
text
@d1 3
a3 3
$OpenBSD: patch-src_audio_out_audio_sun_out_c,v 1.2 2006/10/12 04:48:14 brad Exp $
--- src/audio_out/audio_sun_out.c.orig	Sun Jul  9 10:37:12 2006
+++ src/audio_out/audio_sun_out.c	Fri Sep 15 18:26:24 2006
d27 1
a27 1
@@@@ -114,12 +121,14 @@@@ typedef struct sun_driver_s {
d42 1
a42 1
@@@@ -129,6 +138,7 @@@@ typedef struct sun_driver_s {
d50 1
a50 1
@@@@ -247,6 +257,9 @@@@ error:
d60 1
a60 1
@@@@ -430,7 +443,9 @@@@ static int ao_sun_open(ao_driver_t *this
d70 1
a70 1
@@@@ -462,6 +477,9 @@@@ static int ao_sun_open(ao_driver_t *this
d80 1
a80 1
@@@@ -523,7 +541,9 @@@@ static int ao_sun_open(ao_driver_t *this
d90 1
a90 1
@@@@ -564,6 +584,7 @@@@ static int ao_sun_delay(ao_driver_t *thi
d98 1
a98 1
@@@@ -610,6 +631,10 @@@@ static int ao_sun_delay(ao_driver_t *thi
d109 1
a109 1
@@@@ -718,7 +743,9 @@@@ static int ao_sun_write(ao_driver_t *thi
d119 4
a122 4
@@@@ -778,7 +805,7 @@@@ static int ao_sun_get_property (ao_drive
       this->mixer_volume = info.play.gain * 100 / AUDIO_MAX_GAIN;
     }
     return this->mixer_volume;
d128 1
a128 1
@@@@ -807,7 +834,7 @@@@ static int ao_sun_set_property (ao_drive
@

