head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.16
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.14
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.10
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.12
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.8
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.6
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.4
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.2
	OPENBSD_5_4_BASE:1.3;
locks; strict;
comment	@# @;


1.3
date	2013.04.04.16.48.22;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2009.02.16.02.04.42;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2009.02.09.20.35.50;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Make use of clock_gettime() on OpenBSD.

ok sthen@@
@
text
@$OpenBSD$

Make use of clock_gettime() on OpenBSD. Until we have per-process
timers and can enable _POSIX_TIMERS in unistd.h.

--- src/xine-engine/demux.c.orig	Wed Apr  3 18:45:50 2013
+++ src/xine-engine/demux.c	Wed Apr  3 19:01:24 2013
@@@@ -132,7 +132,7 @@@@ static struct timespec _x_compute_interval(unsigned in
   ui.QuadPart  += millisecs * 10000;
   ts.tv_sec = ui.QuadPart / 10000000;
   ts.tv_sec = (ui.QuadPart % 10000000)*100;
-#elif _POSIX_TIMERS > 0
+#elif _POSIX_TIMERS > 0 || defined(__OpenBSD__)
   clock_gettime(CLOCK_REALTIME, &ts);
   uint64_t ttimer = (uint64_t)ts.tv_sec*1000 + ts.tv_nsec/1000000 + millisecs;
   ts.tv_sec = ttimer/1000;
@


1.2
log
@oops, missed this file.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_xine-engine_demux_c,v 1.1 2009/02/09 20:35:50 sthen Exp $
d3 2
a4 2
changeset e3fa66d1aff4 from upstream; remove a break which causes
some front ends to hang.
d6 11
a16 11
--- src/xine-engine/demux.c.orig	Mon Feb  9 12:50:56 2009
+++ src/xine-engine/demux.c	Mon Feb  9 12:51:32 2009
@@@@ -374,7 +374,7 @@@@ static void *demux_loop (void *stream_gen) {
     pthread_cond_wait (&stream->counter_changed, &stream->counter_lock);
 
     if (demux_unstick_ao_loop (stream))
-      break;
+      /* break amarok */;
   }
   pthread_mutex_unlock (&stream->counter_lock);
   
@


1.1
log
@add an update from upstream repo via Brad (maintainer).
avoid hangs in some front-ends e.g. Amarok.
@
text
@d1 1
a1 1
$OpenBSD$
@

