head	1.6;
access;
symbols
	OPENBSD_5_5:1.5.0.4
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.2
	OPENBSD_5_4_BASE:1.5
	OPENBSD_4_8:1.1.1.1.0.18
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.16
	OPENBSD_4_7_BASE:1.1.1.1
	OPENBSD_4_6:1.1.1.1.0.14
	OPENBSD_4_6_BASE:1.1.1.1
	OPENBSD_4_5:1.1.1.1.0.12
	OPENBSD_4_5_BASE:1.1.1.1
	OPENBSD_4_4:1.1.1.1.0.10
	OPENBSD_4_4_BASE:1.1.1.1
	OPENBSD_4_3:1.1.1.1.0.8
	OPENBSD_4_3_BASE:1.1.1.1
	OPENBSD_4_2:1.1.1.1.0.6
	OPENBSD_4_2_BASE:1.1.1.1
	OPENBSD_4_1:1.1.1.1.0.4
	OPENBSD_4_1_BASE:1.1.1.1
	OPENBSD_4_0:1.1.1.1.0.2
	OPENBSD_4_0_BASE:1.1.1.1
	jakemsr:1.1.1.1
	jakemsr-20060324:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2014.03.30.18.38.31;	author brad;	state dead;
branches;
next	1.5;

1.5
date	2013.04.29.02.36.23;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	2012.06.15.09.04.07;	author ajacoutot;	state dead;
branches;
next	1.3;

1.3
date	2012.05.09.06.30.38;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.11.07.18.46.57;	author jasper;	state dead;
branches;
next	1.1;

1.1
date	2006.03.24.22.46.37;	author jakemsr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.03.24.22.46.37;	author jakemsr;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to Xine-ui 0.99.8.

ok sthen@@
@
text
@$OpenBSD: patch-src_xitk_panel_c,v 1.5 2013/04/29 02:36:23 brad Exp $

Clean shutdown on panel close.

--- src/xitk/panel.c.orig	Sat Apr 27 19:37:50 2013
+++ src/xitk/panel.c	Sat Apr 27 19:40:13 2013
@@@@ -882,6 +882,11 @@@@ static void panel_slider_cb(xitk_widget_t *w, void *da
 static void panel_handle_event(XEvent *event, void *data) {
 
   switch(event->type) {
+  case DestroyNotify:
+    if(gGui->panel_window == event->xany.window)
+      gui_exit(NULL, NULL);
+    break;
+
   case ButtonPress:
     {
       XButtonEvent *bevent = (XButtonEvent *) event;
@@@@ -1160,6 +1165,14 @@@@ void panel_init (void) {
 				      gGui->imlib_data->x.visual,
 				      CWBackPixel | CWBorderPixel | CWColormap | CWOverrideRedirect,
 				      &attr);
+
+  {
+    /* prevent window manager from killing us through exit() when user closes panel.
+       That wont work with OpenGL* video out because libGL does install an exit handler
+       that calls X functions - while video out loop still tries the same -> deadlock */
+    Atom wm_delete_window = XInternAtom(gGui->display, "WM_DELETE_WINDOW", False);
+    XSetWMProtocols(gGui->display, gGui->panel_window, &wm_delete_window, 1);
+  }
 
   XmbSetWMProperties(gGui->display, gGui->panel_window, title, title, NULL, 0,
                      &hint, NULL, NULL);
@


1.5
log
@Some bug fixes from upstream..

- Fix 2 shutdown races.
- Open user file immediately when only logo is playing.
- Clean shutdown on panel close.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.4
log
@Update to Xine-ui 0.99.7.

from Brad
@
text
@d1 8
a8 13
$OpenBSD: patch-src_xitk_panel_c,v 1.3 2012/05/09 06:30:38 ajacoutot Exp $
--- src/xitk/panel.c.orig	Tue May  8 23:36:00 2012
+++ src/xitk/panel.c	Tue May  8 23:36:47 2012
@@@@ -1555,14 +1555,14 @@@@ void panel_init (void) {
   
   {
     pthread_attr_t       pth_attrs;
-#ifdef _POSIX_THREAD_PRIORITY_SCHEDULING
+#if defined(_POSIX_THREAD_PRIORITY_SCHEDULING) && (_POSIX_THREAD_PRIORITY_SCHEDULING > 0)
     struct sched_param   pth_params;
 #endif
     
     pthread_attr_init(&pth_attrs);
d10 24
a33 6
     /* this won't work on linux, freebsd 5.0 */
-#ifdef _POSIX_THREAD_PRIORITY_SCHEDULING
+#if defined(_POSIX_THREAD_PRIORITY_SCHEDULING) && (_POSIX_THREAD_PRIORITY_SCHEDULING > 0)
     pthread_attr_getschedparam(&pth_attrs, &pth_params);
     pth_params.sched_priority = sched_get_priority_min(SCHED_OTHER);
     pthread_attr_setschedparam(&pth_attrs, &pth_params);
@


1.3
log
@Correct the utilization of the _POSIX_THREAD_PRIORITY_SCHEDULING feature
test macro.

from Brad
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@- remove unneeded patches that we have sched_get_priority_* now.

from brad (MAINTAINER)
@
text
@d1 14
a14 4
$OpenBSD: patch-src_xitk_panel_c,v 1.1 2006/03/24 22:46:37 jakemsr Exp $
--- src/xitk/panel.c.orig	Sat Jul 23 19:40:37 2005
+++ src/xitk/panel.c	Sat Dec 24 21:41:58 2005
@@@@ -1564,7 +1564,9 @@@@ void panel_init (void) {
d16 2
a17 1
 #ifdef _POSIX_THREAD_PRIORITY_SCHEDULING
a18 1
+#ifndef __OpenBSD__
a19 1
+#endif
a20 2
 #endif
     
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@initial import of xine-ui

xine-ui is a graphical user interface for xine-lib.

prodded by jolan@@

@
text
@@
