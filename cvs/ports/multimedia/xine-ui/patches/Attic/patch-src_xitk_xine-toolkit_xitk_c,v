head	1.5;
access;
symbols
	OPENBSD_5_5:1.4.0.4
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.4.0.2
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_4_1:1.1.0.4
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.2
	OPENBSD_4_0_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2014.03.30.18.38.31;	author brad;	state dead;
branches;
next	1.4;

1.4
date	2013.04.29.02.36.23;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2013.02.05.12.31.03;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2007.05.22.08.11.08;	author steven;	state dead;
branches;
next	1.1;

1.1
date	2006.04.22.18.37.28;	author bernd;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update to Xine-ui 0.99.8.

ok sthen@@
@
text
@$OpenBSD: patch-src_xitk_xine-toolkit_xitk_c,v 1.4 2013/04/29 02:36:23 brad Exp $

- Fix segfaults in signal handler.
- Fix shutdown race.

--- src/xitk/xine-toolkit/xitk.c.orig	Thu Jan 19 06:04:00 2012
+++ src/xitk/xine-toolkit/xitk.c	Sat Apr 27 19:37:39 2013
@@@@ -337,14 +337,16 @@@@ int xitk_uninstall_x_error_handler(void) {
 static void xitk_signal_handler(int sig) {
   pid_t cur_pid = getppid();
 
-  /* First, call registered handler */
-  if(cur_pid == xitk_pid) {
-    if(gXitk->sig_callback)
-      gXitk->sig_callback(sig, gXitk->sig_data);
-  }
+  if (gXitk) {
+    /* First, call registered handler */
+    if(cur_pid == xitk_pid) {
+      if(gXitk->sig_callback)
+        gXitk->sig_callback(sig, gXitk->sig_data);
+    }
   
-  gXitk->running = 0;
-  
+    gXitk->running = 0;
+  }
+
   switch (sig) {
     
   case SIGINT:
@@@@ -352,11 +354,13 @@@@ static void xitk_signal_handler(int sig) {
   case SIGQUIT:
     if(cur_pid == xitk_pid) {
       
-      xitk_list_free(gXitk->list);
-      xitk_list_free(gXitk->gfx);
-      xitk_config_deinit(gXitk->config);
+      if (gXitk) {
+        xitk_list_free(gXitk->list);
+        xitk_list_free(gXitk->gfx);
+        xitk_config_deinit(gXitk->config);
       
-      XITK_FREE(gXitk);
+        XITK_FREE(gXitk);
+      }
       exit(1);
     }
     break;
@@@@ -2112,6 +2116,9 @@@@ void xitk_run(xitk_startup_callback_t cb, void *data) 
     tv.tv_usec = 33000;
 
     select(xconnection + 1, &r, 0, 0, &tv);
+
+    if(!gXitk->running)
+      break;
     
     XLOCK(gXitk->display);
     got_event = (XPending(gXitk->display) != 0);
@@@@ -2122,6 +2129,9 @@@@ void xitk_run(xitk_startup_callback_t cb, void *data) 
     while(got_event == True) {
 
       xitk_xevent_notify(&myevent);
+
+      if(!gXitk->running)
+        break;
 
       XLOCK(gXitk->display);
       got_event = (XPending(gXitk->display) != 0);
@


1.4
log
@Some bug fixes from upstream..

- Fix 2 shutdown races.
- Open user file immediately when only logo is playing.
- Clean shutdown on panel close.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_xitk_xine-toolkit_xitk_c,v 1.3 2013/02/05 12:31:03 brad Exp $
@


1.3
log
@Some bug fixes from upstream..

- Fix X access deadlocks and stack corruption.
- Fix segfaults in signal handler.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 1
Fix segfaults in signal handler.
d6 2
a7 2
--- src/xitk/xine-toolkit/xitk.c.orig	Tue Feb  5 07:11:29 2013
+++ src/xitk/xine-toolkit/xitk.c	Tue Feb  5 07:13:45 2013
d50 20
@


1.2
log
@update to 0.99.5

ok brad
@
text
@d1 9
a9 5
$OpenBSD: patch-src_xitk_xine-toolkit_xitk_c,v 1.1 2006/04/22 18:37:28 bernd Exp $
--- src/xitk/xine-toolkit/xitk.c.orig	Sat May 21 00:02:05 2005
+++ src/xitk/xine-toolkit/xitk.c	Sat Apr 22 11:49:42 2006
@@@@ -1877,7 +1877,7 @@@@ void xitk_init(Display *display, XColor 
   sprintf(buffer, "%s%s", buffer, " ]-");
d11 11
a21 5
   if(verbosity)
-    printf(buffer);
+    printf("%s", buffer);
 
   gXitk->wm_type = xitk_check_wm(display);
d23 26
@


1.1
log
@Fix some format string vulnerabilities and bump PKGNAME.
http://www.open-security.org/advisories/16

from NetBSD

ok jakemsr@@
@
text
@d1 1
a1 1
$OpenBSD$
@

