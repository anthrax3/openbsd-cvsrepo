head	1.5;
access;
symbols
	OPENBSD_6_0:1.5.0.4
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.4.0.8
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.4
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.2
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.2.0.4
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.2
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.1.1.1.0.2
	OPENBSD_5_3_BASE:1.1.1.1
	sthen_20121010:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2015.09.11.09.16.23;	author sthen;	state Exp;
branches;
next	1.4;
commitid	QQm7O2NbCQpzYgSl;

1.4
date	2014.06.11.00.26.59;	author sthen;	state Exp;
branches;
next	1.3;
commitid	PrXBEjCHbpnebbI2;

1.3
date	2014.03.09.21.04.05;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2013.05.07.20.37.23;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2012.10.10.10.45.05;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.10.10.10.45.05;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.5
log
@update to minidlna-1.1.5
@
text
@$OpenBSD: patch-utils_c,v 1.4 2014/06/11 00:26:59 sthen Exp $

avoid mkdir /, from freebsd ports

--- utils.c.orig	Thu Sep 10 21:24:09 2015
+++ utils.c	Fri Sep 11 10:41:01 2015
@@@@ -271,7 +271,9 @@@@ make_dir(char * path, mode_t mode)
 			++s;
 		}
 
-		if (mkdir(path, mode) < 0) {
+		if (!(path[0] == '/' && s == path + 1) /* skip "/" */
+		    && mkdir(path, mode) < 0) {
+			int e = errno;
 			/* If we failed for any other reason than the directory
 			 * already exists, output a diagnostic and return -1.*/
 			if ((errno != EEXIST && errno != EISDIR)
@


1.4
log
@update to minidlna 1.1.3
@
text
@d1 1
a1 1
$OpenBSD: patch-utils_c,v 1.3 2014/03/09 21:04:05 sthen Exp $
d5 3
a7 3
--- utils.c.orig	Thu Jun  5 23:14:30 2014
+++ utils.c	Wed Jun 11 01:20:08 2014
@@@@ -269,7 +269,9 @@@@ make_dir(char * path, mode_t mode)
@


1.3
log
@update to minidlna 1.1.2
@
text
@d1 1
a1 1
$OpenBSD: patch-utils_c,v 1.2 2013/05/07 20:37:23 sthen Exp $
d5 3
a7 3
--- utils.c.orig	Fri Mar  7 00:30:25 2014
+++ utils.c	Fri Mar  7 08:46:00 2014
@@@@ -284,7 +284,9 @@@@ make_dir(char * path, mode_t mode)
@


1.2
log
@update to MiniDLNA 1.1.0, rolling in a bunch of patches which have been committed upstream
@
text
@d1 1
a1 1
$OpenBSD: patch-utils_c,v 1.1.1.1 2012/10/10 10:45:05 sthen Exp $
d5 3
a7 3
--- utils.c.orig	Wed Apr  3 00:29:21 2013
+++ utils.c	Tue May  7 20:56:29 2013
@@@@ -264,7 +264,9 @@@@ make_dir(char * path, mode_t mode)
d17 1
a17 1
 			if (errno != EEXIST || (stat(path, &st) < 0 || !S_ISDIR(st.st_mode))) {
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d5 3
a7 12
--- utils.c.orig	Tue Feb 14 18:26:53 2012
+++ utils.c	Sat Sep 22 02:48:43 2012
@@@@ -19,7 +19,7 @@@@
 #include <ctype.h>
 #include <string.h>
 #include <stdlib.h>
-#include <linux/limits.h>
+#include <sys/syslimits.h>
 #include <sys/stat.h>
 #include <unistd.h>
 #include <sys/types.h>
@@@@ -253,13 +253,17 @@@@ make_dir(char * path, mode_t mode)
a17 9
-				DPRINTF(E_WARN, L_GENERAL, "make_dir: cannot create directory '%s'\n", path);
 				if (c)
 					*s = c;
+				DPRINTF(E_WARN, L_GENERAL, "make_dir: cannot "
+				    "create directory '%.*s' (to create %s): "
+				    "%s\n", s - path, path, path, strerror(e));
 				return -1;
 			}
 		}
@


1.1.1.1
log
@import ports/multimedia/minidlna, ok/testing landry@@

MiniDLNA is lightweight server software written in C, capable of
serving media files to DLNA/UPnP-AV clients (televisions, tablets,
etc).
@
text
@@
