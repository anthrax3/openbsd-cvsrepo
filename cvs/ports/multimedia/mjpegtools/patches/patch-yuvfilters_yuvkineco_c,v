head	1.1;
access;
symbols
	OPENBSD_6_2:1.1.0.2
	OPENBSD_6_2_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2017.05.24.09.26.35;	author espie;	state Exp;
branches;
next	;
commitid	PS3USgraZEwVCXng;


desc
@@


1.1
log
@build with clang, remove nopic non sense, two phase dependent lookup, and
a shitload of actual abs errors...
@
text
@$OpenBSD$

Index: yuvfilters/yuvkineco.c
--- yuvfilters/yuvkineco.c.orig
+++ yuvfilters/yuvkineco.c
@@@@ -537,7 +537,7 @@@@ do_frame(YfTaskCore_t *handle, const YfTaskCore_t *h0,
 	    noise = yget;
 	  else if (256 - yget < noise)
 	    noise = 256 - yget;
-	  d = abs(ypre - yget);
+	  d = ypre > yget ? ypre-yget : yget-ypre;
 	  h->framestat[b].diffdist[(d < NOISEMAX)? d: NOISEMAX]++;
 	  if (noise < d) {
 	    d -= noise;
@@@@ -547,29 +547,29 @@@@ do_frame(YfTaskCore_t *handle, const YfTaskCore_t *h0,
 	    unsigned int ygte;
 	    ypre = fpre->data[((i - 1) * h->_.width) + j];
 	    ygte = fget->data[((i - 1) * h->_.width) + j];
-	    d = abs(yget - ygte);
+	    d = yget > ygte ? yget-ygte : ygte-yget;
 	    if (noise < d) {
 	      d -= noise;
 	      h->framestat[b].eoediff -= (((d * d) + 16) >> 5);
 	    }
-	    d = abs(yget - ypre);
+	    d = yget > ypre ? yget-ypre: ypre-yget;
 	    if (noise < d) {
 	      d -= noise;
 	      h->framestat[b].eoediff += (((d * d) + 16) >> 5);
 	    }
 	    ypre = fpre->data[((i + 1) * h->_.width) + j];
 	    ygte = fget->data[((i + 1) * h->_.width) + j];
-	    d = abs(yget - ygte);
+	    d = yget > ygte ? yget-ygte : ygte-yget;
 	    if (noise < d) {
 	      d -= noise;
 	      h->framestat[b].eoediff -= (((d * d) + 16) >> 5);
 	    }
-	    d = abs(yget - ypre);
+	    d = yget > ypre ? yget-ypre: ypre-yget;
 	    if (noise < d) {
 	      d -= noise;
 	      h->framestat[b].eoediff += (((d * d) + 16) >> 5);
 	    }
-	    d = abs(ypre - ygte);
+	    d = ypre > ygte ? ypre-ygte : ygte-ypre;
 	    if (noise < d) {
 	      d -= noise;
 	      h->framestat[b].ediff += (((d * d) + 8) >> 4);
@
