head	1.2;
access;
symbols
	OPENBSD_3_8:1.1.1.1.0.4
	OPENBSD_3_8_BASE:1.1.1.1
	OPENBSD_3_7:1.1.1.1.0.2
	OPENBSD_3_7_BASE:1.1.1.1
	naddy_20050125:1.1.1.1
	naddy:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2005.11.13.21.11.13;	author jakemsr;	state dead;
branches;
next	1.1;

1.1
date	2005.01.25.21.58.59;	author naddy;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.01.25.21.58.59;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to version 1.0.2

transcode changes (annoted):
- lots of bug fixes and code cleanup
- i386 nasm code replaced
- several speed improvements
- new filters: facemask, ascii
- can read raw DVD ISO images
- new export profile: xvcd
- auto-probe support for bktr and sunau
- safer string functions
- much improved amd64 support
- removed local copies of bbmpeg, libdvenc, libmpeg2 and libpostproc
- uses external libmpeg2 and libpostproc
- fixed out-of-bounds memory access in VOB demuxer
- fixed double free() in AVI handling

port changes:
- most patches integrated
- USE_LIBTOOL
- update my email address


OK wilfried@@
@
text
@$OpenBSD: patch-import_dvd_reader_c,v 1.1 2005/01/25 21:58:59 naddy Exp $
--- import/dvd_reader.c.orig	Tue Nov  2 19:45:41 2004
+++ import/dvd_reader.c	Fri Dec 31 01:13:17 2004
@@@@ -1090,6 +1090,10 @@@@ int dvd_stream(int arg_title,int arg_cha
     unsigned long cur_pack=0, max_sectors=0, blocks_left=0, blocks_written=0, first_block=0;
     int ttn, pgn;
 
+    int end_cell;
+    int e_pgc_id, e_pgn;
+    pgc_t *e_cur_pgc;
+
     dvd_file_t *title;
     ifo_handle_t *vmg_file;
     tt_srpt_t *tt_srpt;
@@@@ -1171,6 +1175,15 @@@@ int dvd_stream(int arg_title,int arg_cha
     start_cell = cur_pgc->program_map[ pgn - 1 ] - 1;
 
 
+    if ( chapid+1 >= tt_srpt->title[ titleid ].nr_of_ptts ) {
+      end_cell = cur_pgc->nr_of_cells - 1;
+    } else {
+      e_pgc_id = vts_ptt_srpt->title[ ttn - 1 ].ptt[ chapid+1 ].pgcn;
+      e_pgn = vts_ptt_srpt->title[ ttn - 1 ].ptt[ chapid+1 ].pgn;
+      e_cur_pgc = vts_file->vts_pgcit->pgci_srp[ e_pgc_id - 1 ].pgc;
+      end_cell = ( e_cur_pgc->program_map[ e_pgn - 1 ] - 1 ) -1;
+    }
+
     /**
      * We've got enough info, time to open the title set data.
      */
@@@@ -1189,13 +1202,16 @@@@ int dvd_stream(int arg_title,int arg_cha
     /**
      * Playback the cells for our title
      */
+    if (start_cell==end_cell)
+      fprintf(stderr,"(%s) Title %d in VTS %02d is defined by PGC %d with %d cells, exporting cell %d\n",
+	      __FILE__,titleid+1,tt_srpt->title[ titleid ].title_set_nr,pgc_id,cur_pgc->nr_of_cells,start_cell+1);
+    else
+      fprintf(stderr,"(%s) Title %d in VTS %02d is defined by PGC %d with %d cells, exporting from cell %d to cell %d\n",
+	      __FILE__,titleid+1,tt_srpt->title[ titleid ].title_set_nr,pgc_id,cur_pgc->nr_of_cells,start_cell+1,end_cell+1);
 
-    fprintf(stderr,"(%s) Title %d in VTS %02d is defined by PGC %d with %d cells, exporting cell %d\n",
-      __FILE__,titleid+1,tt_srpt->title[ titleid ].title_set_nr,pgc_id,cur_pgc->nr_of_cells,chapid+1);
+    cur_pack = cur_pgc->cell_playback[start_cell].first_sector;
 
-    cur_pack = cur_pgc->cell_playback[chapid].first_sector;
-
-    max_sectors = (long) cur_pgc->cell_playback[chapid].last_sector;
+    max_sectors = (long) cur_pgc->cell_playback[end_cell].last_sector;
     fprintf(stderr,"(%s) From block %ld to block %ld\n",__FILE__,(long)cur_pack,(long)max_sectors);
 
     first_block = cur_pack;
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@Reimport into new category (ok jolan@@, xsa@@, robert@@).

Update to 0.6.14; from new maintainer Jacob Meuser <jakemsr@@jakemsr.com>.

Notable changes:
- new import module for bktr(4) devices, import_bktr
- new import module for audio(4) devices, import_sunau
- export profiles
- better error checking
- uses YV12/I420 colorspace by default instead of RGB
- uses external ffmpeg/libavcodec
- optimized memcpy on i386
- many small bugs fixed
@
text
@@
