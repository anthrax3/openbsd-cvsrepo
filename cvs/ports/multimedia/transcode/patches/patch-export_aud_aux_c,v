head	1.7;
access;
symbols
	OPENBSD_6_2:1.7.0.14
	OPENBSD_6_2_BASE:1.7
	OPENBSD_6_1:1.7.0.12
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.7.0.10
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.6
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.8
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.4
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.2
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.6.0.6
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.4
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.2
	OPENBSD_5_3_BASE:1.6
	OPENBSD_4_6:1.3.0.6
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.4
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.2
	OPENBSD_4_4_BASE:1.3;
locks; strict;
comment	@# @;


1.7
date	2014.05.05.11.51.37;	author brad;	state Exp;
branches;
next	1.6;

1.6
date	2013.01.26.12.47.44;	author brad;	state Exp;
branches;
next	1.5;

1.5
date	2013.01.19.08.42.35;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	2009.08.19.06.12.15;	author sthen;	state dead;
branches;
next	1.3;

1.3
date	2008.07.09.02.13.01;	author jakemsr;	state Exp;
branches;
next	1.2;

1.2
date	2008.01.26.02.17.50;	author jakemsr;	state dead;
branches;
next	1.1;

1.1
date	2007.09.24.07.57.01;	author jakemsr;	state Exp;
branches;
next	;


desc
@@


1.7
log
@- Pull in some bits to deal with newer FFmpeg API. While testing I found
transcode was already broken as is due to it relying on certain functionality
with presets which is no longer relevant for more modern FFmpeg. Searching
via Google showed the same bug being reported with Debian, Gentoo and Arch.
They have eliminted the use of presets but that just exposed another bug.
So this builds with newer FFmpeg but it is essentially just as broken as
before. If anyone wants to take a look at this and figure out why it is
crashing go ahead.
- Merge the quicktime FLAVOR into the main port / package. IMO it doesn't
make sense to have an app like this that cannot work with the MP4 container

FFmpeg bits taken from FreeBSD and Debian packages.

ok ajacoutot@@
@
text
@$OpenBSD: patch-export_aud_aux_c,v 1.6 2013/01/26 12:47:44 brad Exp $

Update for newer FFmpeg API.

--- export/aud_aux.c.orig	Sat Nov 19 11:50:27 2011
+++ export/aud_aux.c	Sat Apr 26 00:57:34 2014
@@@@ -346,7 +346,7 @@@@ static int tc_audio_init_ffmpeg(vob_t *vob, int o_code
 
     //-- set parameters (bitrate, channels and sample-rate) --
     //--------------------------------------------------------
-    avcodec_get_context_defaults(&mpa_ctx);
+    avcodec_get_context_defaults3(&mpa_ctx, mpa_codec);
 #if LIBAVCODEC_VERSION_MAJOR < 53
     mpa_ctx.codec_type  = CODEC_TYPE_AUDIO;
 #else
@@@@ -359,7 +359,7 @@@@ static int tc_audio_init_ffmpeg(vob_t *vob, int o_code
     //-- open codec --
     //----------------
     TC_LOCK_LIBAVCODEC;
-    ret = avcodec_open(&mpa_ctx, mpa_codec);
+    ret = avcodec_open2(&mpa_ctx, mpa_codec, NULL);
     TC_UNLOCK_LIBAVCODEC;
     if (ret < 0) {
         tc_warn("tc_audio_init_ffmpeg: could not open %s codec !",
@


1.6
log
@Add a comment to the patches.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-export_aud_aux_c,v 1.5 2013/01/19 08:42:35 brad Exp $
d6 10
a15 1
+++ export/aud_aux.c	Fri Jan 18 22:28:02 2013
@


1.5
log
@Update for newer FFmpeg API.

ok ajacoutot@@
@
text
@d1 4
a4 1
$OpenBSD$
@


1.4
log
@Oops, forgot to cvs rm these files. Problem reported by Markus Lude.
@
text
@d1 12
a12 12
$OpenBSD: patch-export_aud_aux_c,v 1.3 2008/07/09 02:13:01 jakemsr Exp $
--- export/aud_aux.c.orig	Sat Jun 21 21:14:44 2008
+++ export/aud_aux.c	Sat Jun 21 21:14:59 2008
@@@@ -31,7 +31,7 @@@@
 #include <inttypes.h>
 #include <assert.h>
 
-#include <ffmpeg/avcodec.h>
+#include <libavcodec/avcodec.h>
 
 #include "aud_aux.h"
 #include "ac3.h"
@


1.3
log
@
* FFmpeg headers moved
* FFmpeg LIB_DEPENDS/WANTLIB changes
* add @@bin markers in PLISTs
* bump PKGNAMEs

feedback/ok brad@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@maintenence update to 1.0.5
@
text
@d1 6
a6 4
$OpenBSD: patch-export_aud_aux_c,v 1.1 2007/09/24 07:57:01 jakemsr Exp $
--- export/aud_aux.c.orig	Sat Sep 15 21:56:28 2007
+++ export/aud_aux.c	Sat Sep 15 21:56:52 2007
@@@@ -361,8 +361,7 @@@@ static int audio_init_ffmpeg(vob_t *vob, int o_codec)
d8 2
a9 6
     pthread_mutex_lock(&init_avcodec_lock);
     avcodec_init();
-    register_avcodec(&ac3_encoder);
-    register_avcodec(&mp2_encoder);
+    avcodec_register_all();
     pthread_mutex_unlock(&init_avcodec_lock);
d11 2
a12 1
     switch (o_codec) {
@


1.1
log
@- libavcodec no longer allows registering individual codecs, so register
  all codecs (from transcode CVS)
- our libavcodec does not have an encoder named 'h264', but it does have
  'libx264'.  H.264 encoding is now possible.
- bump PKGNAME
@
text
@d1 1
a1 1
$OpenBSD$
@

