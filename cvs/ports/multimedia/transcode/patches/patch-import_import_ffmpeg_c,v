head	1.4;
access;
symbols
	OPENBSD_6_0:1.4.0.10
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.4.0.6
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.8
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.4
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.2
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.3.0.6
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_4_6:1.1.0.6
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.4
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.2
	OPENBSD_4_4_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2014.05.05.11.51.37;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2013.01.19.08.42.35;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2009.08.19.06.12.15;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2008.07.09.02.13.01;	author jakemsr;	state Exp;
branches;
next	;


desc
@@


1.4
log
@- Pull in some bits to deal with newer FFmpeg API. While testing I found
transcode was already broken as is due to it relying on certain functionality
with presets which is no longer relevant for more modern FFmpeg. Searching
via Google showed the same bug being reported with Debian, Gentoo and Arch.
They have eliminted the use of presets but that just exposed another bug.
So this builds with newer FFmpeg but it is essentially just as broken as
before. If anyone wants to take a look at this and figure out why it is
crashing go ahead.
- Merge the quicktime FLAVOR into the main port / package. IMO it doesn't
make sense to have an app like this that cannot work with the MP4 container

FFmpeg bits taken from FreeBSD and Debian packages.

ok ajacoutot@@
@
text
@$OpenBSD: patch-import_import_ffmpeg_c,v 1.3 2013/01/19 08:42:35 brad Exp $

Update for newer FFmpeg API.

--- import/import_ffmpeg.c.orig	Sat Nov 19 11:50:27 2011
+++ import/import_ffmpeg.c	Fri Apr 25 22:30:34 2014
@@@@ -225,6 +225,7 @@@@ MOD_open {
   int extra_data_size = 0;
   long sret;
   int ret;
+  AVDictionary *opts = NULL;
 
   if (param->flag == TC_VIDEO) {
 
@@@@ -302,7 +303,7 @@@@ do_avi:
 
     // Set these to the expected values so that ffmpeg's decoder can
     // properly detect interlaced input.
-    lavc_dec_context = avcodec_alloc_context();
+    lavc_dec_context = avcodec_alloc_context3(lavc_dec_codec);
     if (lavc_dec_context == NULL) {
       tc_log_error(MOD_NAME, "Could not allocate enough memory.");
       return TC_IMPORT_ERROR;
@@@@ -311,11 +312,7 @@@@ do_avi:
     lavc_dec_context->height = y_dim;
 
     if (vob->decolor) lavc_dec_context->flags |= CODEC_FLAG_GRAY;
-#if LIBAVCODEC_VERSION_INT < ((52<<16)+(0<<8)+0)
-    lavc_dec_context->error_resilience  = 2;
-#else
-    lavc_dec_context->error_recognition = 2;
-#endif
+    av_dict_set(&opts, "err_detect", "compliant", 0);
     lavc_dec_context->error_concealment = 3;
     lavc_dec_context->workaround_bugs = FF_BUG_AUTODETECT;
     lavc_dec_context->codec_tag= (fourCC[0]<<24) | (fourCC[1]<<16) |
@@@@ -344,7 +341,7 @@@@ do_avi:
     }
 
     TC_LOCK_LIBAVCODEC;
-    ret = avcodec_open(lavc_dec_context, lavc_dec_codec);
+    ret = avcodec_open2(lavc_dec_context, lavc_dec_codec, &opts);
     TC_UNLOCK_LIBAVCODEC;
     if (ret < 0) {
       tc_log_warn(MOD_NAME, "Could not initialize the '%s' codec.",
@


1.3
log
@Update for newer FFmpeg API.

ok ajacoutot@@
@
text
@d1 4
a4 1
$OpenBSD$
d6 1
a6 1
+++ import/import_ffmpeg.c	Fri Jan 18 22:02:05 2013
d15 9
@


1.2
log
@Oops, forgot to cvs rm these files. Problem reported by Markus Lude.
@
text
@d1 8
a8 4
$OpenBSD: patch-import_import_ffmpeg_c,v 1.1 2008/07/09 02:13:01 jakemsr Exp $
--- import/import_ffmpeg.c.orig	Sat Jun 21 21:16:13 2008
+++ import/import_ffmpeg.c	Sat Jun 21 21:16:29 2008
@@@@ -38,7 +38,7 @@@@ static int capability_flag = TC_CAP_YUV | TC_CAP_RGB |
d10 1
a10 4
 // FIXME
 #undef EMULATE_FAST_INT
-#include <ffmpeg/avcodec.h>
+#include <libavcodec/avcodec.h>
d12 22
a33 2
 #include "libvo/yuv2rgb.h"
 #include "avilib/avilib.h"
@


1.1
log
@
* FFmpeg headers moved
* FFmpeg LIB_DEPENDS/WANTLIB changes
* add @@bin markers in PLISTs
* bump PKGNAMEs

feedback/ok brad@@
@
text
@d1 1
a1 1
$OpenBSD$
@

