head	1.2;
access;
symbols
	OPENBSD_5_7:1.1.0.2
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2015.04.15.11.35.06;	author jca;	state dead;
branches;
next	1.1;
commitid	kGQD14vPxkEq2K2g;

1.1
date	2014.12.12.12.43.34;	author jca;	state Exp;
branches;
next	;
commitid	f8bbYiJrFr0EcW8P;


desc
@@


1.2
log
@Update to emacs-24.5

Lots of test reports on amd64, sparc64, loongson, and hppa by
Alf Schlichting, bcallah@@ and juanfra@@.  Many thanks!

ok juanfra@@, "looks good to me" jasper@@
@
text
@$OpenBSD: patch-lisp_net_tramp-sh_el,v 1.1 2014/12/12 12:43:34 jca Exp $

- fix a hang in tramp-mode.

commit b14b7f431fe9cfcdcb23eecf105992d1c276dc69
Author: Wolfgang Jenkner <wjenkner@@inode.at>
Date:   Sat Nov 1 15:08:00 2014 +0100

    * net/tramp-sh.el (tramp-send-command): Fix the case where the
    remote-echo connection property is non-nil.

    Fixes: debbugs:18858

--- lisp/net/tramp-sh.el.orig	Mon Jun 23 02:47:02 2014
+++ lisp/net/tramp-sh.el	Tue Dec  2 19:39:16 2014
@@@@ -4657,6 +4657,17 @@@@ function waits for output unless NOOUTPUT is set."
     (when (tramp-get-connection-property p "remote-echo" nil)
       ;; We mark the command string that it can be erased in the output buffer.
       (tramp-set-connection-property p "check-remote-echo" t)
+      ;; If we put `tramp-echo-mark' after a trailing newline (which
+      ;; is assumed to be unquoted) `tramp-send-string' doesn't see
+      ;; that newline and adds `tramp-rsh-end-of-line' right after
+      ;; `tramp-echo-mark', so the remote shell sees two consecutive
+      ;; trailing line endings and sends two prompts after executing
+      ;; the command, which confuses `tramp-wait-for-output'.
+      (when (and (not (string= command ""))
+		 (string-equal (substring command -1) "\n"))
+	(setq command (substring command 0 -1)))
+      ;; No need to restore a trailing newline here since `tramp-send-string'
+      ;; makes sure that the string ends in `tramp-rsh-end-of-line', anyway.
       (setq command (format "%s%s%s" tramp-echo-mark command tramp-echo-mark)))
     ;; Send the command.
     (tramp-message vec 6 "%s" command)
@


1.1
log
@Update to emacs-24.4

- remove now unneeded patches for giflib detection
- add patch to skip compression of man and info pages
- add patch to fix tramp-mode hangs with various remote shells

Input from Manuel Giraud (who also proposed an initial diff) and Timo
Myyra.  Tested (at least) on i386, amd64 and sparc64.
ok abieber@@ jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@

