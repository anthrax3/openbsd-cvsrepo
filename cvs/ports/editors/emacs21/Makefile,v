head	1.92;
access;
symbols
	OPENBSD_6_2:1.92.0.2
	OPENBSD_6_2_BASE:1.92
	OPENBSD_6_1:1.91.0.2
	OPENBSD_6_1_BASE:1.91
	OPENBSD_6_0:1.88.0.2
	OPENBSD_6_0_BASE:1.88
	OPENBSD_5_9:1.82.0.2
	OPENBSD_5_9_BASE:1.82
	OPENBSD_5_8:1.77.0.4
	OPENBSD_5_8_BASE:1.77
	OPENBSD_5_7:1.76.0.2
	OPENBSD_5_7_BASE:1.76
	OPENBSD_5_6:1.74.0.2
	OPENBSD_5_6_BASE:1.74
	OPENBSD_5_5:1.73.0.2
	OPENBSD_5_5_BASE:1.73
	OPENBSD_5_4:1.68.0.2
	OPENBSD_5_4_BASE:1.68
	OPENBSD_5_3:1.63.0.2
	OPENBSD_5_3_BASE:1.63
	OPENBSD_5_2:1.59.0.2
	OPENBSD_5_2_BASE:1.59
	OPENBSD_5_1_BASE:1.58
	OPENBSD_5_1:1.58.0.2
	OPENBSD_5_0:1.55.0.2
	OPENBSD_5_0_BASE:1.55
	OPENBSD_4_9:1.54.0.2
	OPENBSD_4_9_BASE:1.54
	OPENBSD_4_8:1.50.0.2
	OPENBSD_4_8_BASE:1.50
	OPENBSD_4_7:1.46.0.2
	OPENBSD_4_7_BASE:1.46
	OPENBSD_4_6:1.42.0.2
	OPENBSD_4_6_BASE:1.42
	OPENBSD_4_5:1.41.0.2
	OPENBSD_4_5_BASE:1.41
	OPENBSD_4_4:1.40.0.2
	OPENBSD_4_4_BASE:1.40
	OPENBSD_4_3:1.39.0.2
	OPENBSD_4_3_BASE:1.39
	OPENBSD_4_2:1.37.0.2
	OPENBSD_4_2_BASE:1.37
	OPENBSD_4_1:1.35.0.2
	OPENBSD_4_1_BASE:1.35
	OPENBSD_4_0:1.32.0.2
	OPENBSD_4_0_BASE:1.32
	OPENBSD_3_9:1.30.0.2
	OPENBSD_3_9_BASE:1.30
	OPENBSD_3_8:1.27.0.2
	OPENBSD_3_8_BASE:1.27
	OPENBSD_3_7:1.26.0.2
	OPENBSD_3_7_BASE:1.26
	OPENBSD_3_6:1.22.0.2
	OPENBSD_3_6_BASE:1.22
	OPENBSD_3_5:1.21.0.2
	OPENBSD_3_5_BASE:1.21
	OPENBSD_3_4:1.16.0.2
	OPENBSD_3_4_BASE:1.16
	OPENBSD_3_3:1.10.0.2
	OPENBSD_3_3_BASE:1.10
	OPENBSD_3_2:1.7.0.2
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.5.0.2
	OPENBSD_3_1_BASE:1.5
	mark_2002-Feb-10:1.1.1.1
	mark:1.1.1;
locks; strict;
comment	@# @;


1.92
date	2017.05.12.21.26.32;	author espie;	state Exp;
branches;
next	1.91;
commitid	pPWadrjSkjcEjsse;

1.91
date	2016.11.20.15.14.19;	author jca;	state Exp;
branches;
next	1.90;
commitid	RaX0gtPIk1DuwTyM;

1.90
date	2016.11.20.13.52.57;	author jca;	state Exp;
branches;
next	1.89;
commitid	oyPGiWweB700PF1j;

1.89
date	2016.09.01.10.53.27;	author jasper;	state Exp;
branches;
next	1.88;
commitid	LdsIxWmxagN2Kq33;

1.88
date	2016.06.29.16.14.41;	author espie;	state Exp;
branches;
next	1.87;
commitid	c1yQMbJbfo0CFBcL;

1.87
date	2016.06.28.21.00.25;	author kettenis;	state Exp;
branches;
next	1.86;
commitid	Hdvn1hZS2UDPtNzZ;

1.86
date	2016.06.28.14.06.59;	author kettenis;	state Exp;
branches;
next	1.85;
commitid	dfzmNVHtfKhA2DVt;

1.85
date	2016.06.06.22.15.05;	author jca;	state Exp;
branches;
next	1.84;
commitid	gIGsha3JnlnJkxdc;

1.84
date	2016.06.05.16.56.19;	author kettenis;	state Exp;
branches;
next	1.83;
commitid	xkk0wZ2EFRDUXYnS;

1.83
date	2016.05.12.01.17.13;	author naddy;	state Exp;
branches;
next	1.82;
commitid	yWplpZyyaU1NC3LP;

1.82
date	2015.12.20.00.16.27;	author naddy;	state Exp;
branches;
next	1.81;
commitid	7FwUBfDRx93p0qtP;

1.81
date	2015.12.06.19.54.34;	author jca;	state Exp;
branches;
next	1.80;
commitid	0VbeUVBGZDkJQk50;

1.80
date	2015.09.21.20.23.26;	author sthen;	state Exp;
branches;
next	1.79;
commitid	4MY1fe2BUT84UoGv;

1.79
date	2015.09.11.11.33.35;	author jca;	state Exp;
branches;
next	1.78;
commitid	RBtremwGbN3pTtLC;

1.78
date	2015.09.08.18.32.00;	author jca;	state Exp;
branches;
next	1.77;
commitid	Yo0sTQmO42HMoIoL;

1.77
date	2015.06.17.20.03.11;	author sthen;	state Exp;
branches;
next	1.76;
commitid	ASHe8W1wzY7eB3KC;

1.76
date	2015.01.02.14.26.31;	author sthen;	state Exp;
branches;
next	1.75;
commitid	uHpAv9eVIpmsb1ZL;

1.75
date	2014.10.28.08.42.47;	author jca;	state Exp;
branches;
next	1.74;
commitid	2oEo0BbK6YhGbvF2;

1.74
date	2014.07.16.09.11.43;	author espie;	state Exp;
branches;
next	1.73;
commitid	kI47fXE5HK4uEJKT;

1.73
date	2014.01.24.12.08.55;	author espie;	state Exp;
branches;
next	1.72;

1.72
date	2014.01.12.14.58.30;	author naddy;	state Exp;
branches;
next	1.71;

1.71
date	2013.11.09.23.19.03;	author naddy;	state Exp;
branches;
next	1.70;

1.70
date	2013.09.25.07.56.57;	author sthen;	state Exp;
branches;
next	1.69;

1.69
date	2013.08.07.15.37.10;	author naddy;	state Exp;
branches;
next	1.68;

1.68
date	2013.07.07.21.25.28;	author naddy;	state Exp;
branches;
next	1.67;

1.67
date	2013.07.06.03.22.11;	author brad;	state Exp;
branches;
next	1.66;

1.66
date	2013.06.04.18.41.41;	author naddy;	state Exp;
branches;
next	1.65;

1.65
date	2013.03.15.14.09.22;	author sthen;	state Exp;
branches;
next	1.64;

1.64
date	2013.03.11.11.02.49;	author espie;	state Exp;
branches;
next	1.63;

1.63
date	2013.02.05.18.13.35;	author sthen;	state Exp;
branches;
next	1.62;

1.62
date	2013.02.01.16.34.36;	author naddy;	state Exp;
branches;
next	1.61;

1.61
date	2012.08.30.20.54.59;	author pascal;	state Exp;
branches;
next	1.60;

1.60
date	2012.08.11.22.55.39;	author pascal;	state Exp;
branches;
next	1.59;

1.59
date	2012.06.21.13.56.57;	author sthen;	state Exp;
branches;
next	1.58;

1.58
date	2012.01.13.00.55.14;	author naddy;	state Exp;
branches;
next	1.57;

1.57
date	2011.11.07.15.39.50;	author espie;	state Exp;
branches;
next	1.56;

1.56
date	2011.09.16.09.48.08;	author espie;	state Exp;
branches;
next	1.55;

1.55
date	2011.07.18.19.06.36;	author naddy;	state Exp;
branches;
next	1.54;

1.54
date	2011.01.15.01.09.43;	author naddy;	state Exp;
branches;
next	1.53;

1.53
date	2010.11.15.23.22.07;	author espie;	state Exp;
branches;
next	1.52;

1.52
date	2010.10.24.21.16.25;	author ajacoutot;	state Exp;
branches;
next	1.51;

1.51
date	2010.10.18.18.00.16;	author espie;	state Exp;
branches;
next	1.50;

1.50
date	2010.08.04.17.17.57;	author naddy;	state Exp;
branches;
next	1.49;

1.49
date	2010.07.26.18.08.00;	author ajacoutot;	state Exp;
branches;
next	1.48;

1.48
date	2010.07.24.23.05.08;	author naddy;	state Exp;
branches;
next	1.47;

1.47
date	2010.07.18.18.49.01;	author naddy;	state Exp;
branches;
next	1.46;

1.46
date	2010.02.26.18.17.38;	author espie;	state Exp;
branches;
next	1.45;

1.45
date	2010.01.27.21.43.28;	author naddy;	state Exp;
branches;
next	1.44;

1.44
date	2009.08.10.06.31.08;	author kili;	state Exp;
branches;
next	1.43;

1.43
date	2009.07.17.16.38.48;	author naddy;	state Exp;
branches;
next	1.42;

1.42
date	2009.06.22.17.00.23;	author naddy;	state Exp;
branches;
next	1.41;

1.41
date	2009.02.09.20.48.23;	author naddy;	state Exp;
branches;
next	1.40;

1.40
date	2008.07.04.15.39.17;	author naddy;	state Exp;
branches;
next	1.39;

1.39
date	2008.02.22.17.06.25;	author naddy;	state Exp;
branches;
next	1.38;

1.38
date	2007.09.16.00.44.00;	author merdely;	state Exp;
branches;
next	1.37;

1.37
date	2007.07.27.20.24.09;	author naddy;	state Exp;
branches;
next	1.36;

1.36
date	2007.07.06.16.59.32;	author kettenis;	state Exp;
branches;
next	1.35;

1.35
date	2007.02.14.16.55.28;	author steven;	state Exp;
branches;
next	1.34;

1.34
date	2006.12.14.09.07.56;	author steven;	state Exp;
branches;
next	1.33;

1.33
date	2006.11.24.22.14.42;	author espie;	state Exp;
branches;
next	1.32;

1.32
date	2006.08.01.23.39.08;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2006.07.28.06.29.33;	author steven;	state Exp;
branches;
next	1.30;

1.30
date	2006.01.22.23.21.46;	author sturm;	state Exp;
branches;
next	1.29;

1.29
date	2005.12.10.11.57.40;	author aanriot;	state Exp;
branches;
next	1.28;

1.28
date	2005.10.04.16.43.29;	author pvalchev;	state Exp;
branches;
next	1.27;

1.27
date	2005.08.13.18.19.32;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2005.02.09.03.48.43;	author brad;	state Exp;
branches;
next	1.25;

1.25
date	2005.01.02.04.43.06;	author pvalchev;	state Exp;
branches;
next	1.24;

1.24
date	2004.12.14.21.15.55;	author espie;	state Exp;
branches;
next	1.23;

1.23
date	2004.11.24.11.08.03;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	2004.08.16.23.34.02;	author pvalchev;	state Exp;
branches
	1.22.2.1;
next	1.21;

1.21
date	2004.02.04.07.39.18;	author sturm;	state Exp;
branches
	1.21.2.1;
next	1.20;

1.20
date	2004.02.01.07.09.47;	author pvalchev;	state Exp;
branches;
next	1.19;

1.19
date	2004.01.30.17.04.48;	author lebel;	state Exp;
branches;
next	1.18;

1.18
date	2003.12.31.08.38.24;	author pvalchev;	state Exp;
branches;
next	1.17;

1.17
date	2003.10.13.17.02.39;	author naddy;	state Exp;
branches;
next	1.16;

1.16
date	2003.08.26.17.40.08;	author naddy;	state Exp;
branches;
next	1.15;

1.15
date	2003.07.18.13.58.09;	author brad;	state Exp;
branches;
next	1.14;

1.14
date	2003.07.06.15.35.40;	author naddy;	state Exp;
branches;
next	1.13;

1.13
date	2003.07.06.12.46.45;	author naddy;	state Exp;
branches;
next	1.12;

1.12
date	2003.07.05.00.27.08;	author naddy;	state Exp;
branches;
next	1.11;

1.11
date	2003.03.27.17.38.22;	author pvalchev;	state Exp;
branches;
next	1.10;

1.10
date	2003.01.17.21.04.41;	author drahn;	state Exp;
branches;
next	1.9;

1.9
date	2002.12.09.15.37.23;	author brad;	state Exp;
branches;
next	1.8;

1.8
date	2002.11.24.00.49.50;	author mark;	state Exp;
branches;
next	1.7;

1.7
date	2002.05.13.12.37.37;	author naddy;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	2002.04.24.00.21.43;	author mark;	state Exp;
branches;
next	1.5;

1.5
date	2002.03.29.19.13.25;	author pvalchev;	state Exp;
branches;
next	1.4;

1.4
date	2002.03.20.02.27.24;	author mark;	state Exp;
branches;
next	1.3;

1.3
date	2002.03.18.01.58.03;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2002.03.12.09.03.42;	author mark;	state Exp;
branches;
next	1.1;

1.1
date	2002.02.10.22.05.40;	author mark;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2002.02.10.22.05.40;	author mark;	state Exp;
branches;
next	;

1.7.2.1
date	2002.11.24.01.19.24;	author mark;	state Exp;
branches;
next	;

1.21.2.1
date	2005.02.09.21.23.52;	author sturm;	state Exp;
branches;
next	;

1.22.2.1
date	2005.02.09.21.23.00;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.92
log
@clang can't link with gcc, so add the missing define in the clang case.
and it can't optimize malloc too much, or the undump magic fails.
(thanks to kettenis@@ for the second part)
@
text
@# $OpenBSD: Makefile,v 1.91 2016/11/20 15:14:19 jca Exp $

BROKEN-powerpc=		dumped executable fails with SIGABRT

COMMENT-main=		GNU editor: extensible, customizable, self documenting
COMMENT-el=		elisp sources for those who want to read/modify them
COMMENT-leim=		Library of Emacs Input Methods

VERSION=		21.4
DISTNAME=		emacs-${VERSION}
PKGNAME-main=		${DISTNAME}
FULLPKGNAME-el=		emacs-el-${VERSION}
FULLPKGPATH-el=		editors/emacs21,-el
FULLPKGNAME-leim=	emacs-leim-${VERSION}
FULLPKGPATH-leim=	editors/emacs21,-leim
REVISION-main=		37
REVISION-el=		7
REVISION-leim=		7

CATEGORIES=		editors

HOMEPAGE=		https://www.gnu.org/software/emacs/

# GPL
PERMIT_PACKAGE_CDROM=	Yes

MASTER_SITES=		${MASTER_SITE_GNU:=emacs/}
DISTFILES=		emacs-${VERSION}a.tar.gz leim-${VERSION}.tar.gz

MULTI_PACKAGES=		-main -el -leim

FLAVORS=		no_x11
FLAVOR?=

GCCARCH=		${MACHINE_ARCH}-unknown-openbsd

MODGNU_EMACS_YOURE_WEIRD = Oh yes

CONFIGURE_STYLE=	gnu dest
CONFIGURE_ARGS=		${GCCARCH} --with-pop --with-system-malloc
# ld -Z doesn't work with secure-PLT
.if ${MACHINE_ARCH} == "powerpc"
ARCH_LDFLAGS =		-Wl,-G0
CFLAGS +=		-mno-sdata
.elif ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "hppa" || \
    ${MACHINE_ARCH} == "sparc64"
ARCH_LDFLAGS =
.else
ARCH_LDFLAGS =		-Z
.endif
LDFLAGS=		${ARCH_LDFLAGS} -L${LOCALBASE}/lib -nopie
CFLAGS +=		-fno-pie

CONFIGURE_ENV=		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="${LDFLAGS}" \
			ac_cv_lib_ossaudio__oss_ioctl=no

MAKE_ENV=		INSTALL_EMACS="${INSTALL_SCRIPT}"

SUBST_VARS=		GCCARCH VERSION

WANTLIB-main=		c m ncurses

.if ${FLAVOR:Mno_x11}
CONFIGURE_ARGS+=	--with-x=no
.else
LIB_DEPENDS-main=	graphics/giflib \
			graphics/png \
			graphics/tiff
WANTLIB-main+=		ICE SM X11 Xaw Xext Xmu Xpm Xt z
WANTLIB-main+=		gif jpeg png tiff
.endif

RUN_DEPENDS=		emacs-${VERSION}:${PKGPATH}
RUN_DEPENDS-main=

PKG_ARCH-el=		*

NO_TEST=		Yes

post-build:
	cd ${WRKSRC}; src/emacs -batch -f batch-byte-compile \
	    lisp/mail/mh-{funcs,utils}.el

post-install:
	chmod -t ${PREFIX}/bin/emacs

.include <bsd.port.mk>

.if ${PROPERTIES:Mclang}
CFLAGS +=	-fno-builtin-malloc
.endif

@


1.91
log
@Stop embedding ${OSREV} in PLIST, should remove the need for PLIST bumps
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.90 2016/11/20 13:52:57 jca Exp $
d89 5
@


1.90
log
@BROKEN on powerpc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.89 2016/09/01 10:53:27 jasper Exp $
d16 1
a16 1
REVISION-main=		36
d35 1
a35 1
GCCARCH=		${MACHINE_ARCH}-unknown-openbsd${OSREV}
@


1.89
log
@retire sparc
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.88 2016/06/29 16:14:41 espie Exp $
@


1.88
log
@add is-branch to all trivial ports that exist as multiple branches.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.87 2016/06/28 21:00:25 kettenis Exp $
d44 1
a44 1
    ${MACHINE_ARCH} == "sparc" || ${MACHINE_ARCH} == "sparc64"
@


1.87
log
@Drop -Z for hppa to fix the build for real.  Also drop -Z for sparc, which
will need it as well.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.86 2016/06/28 14:06:59 kettenis Exp $
d14 1
a14 1
REVISION-main=		35
@


1.86
log
@Make this build (and work) again on hppa and powerpc.

ok jca@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.85 2016/06/06 22:15:05 jca Exp $
d43 2
a44 1
.elif ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "sparc64"
@


1.85
log
@Missing bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.84 2016/06/05 16:56:19 kettenis Exp $
d14 1
a14 1
REVISION-main=		34
d41 2
a42 1
ARCH_LDFLAGS =		-Z -Wl,--bss-plt
@


1.84
log
@Stop using ld -Z on architectures where it is not necessary.  For now this
means amd64 and sparc64.  Hopefully more architectures will follow.

ok jca@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.83 2016/05/12 01:17:13 naddy Exp $
d14 1
a14 1
REVISION-main=		33
@


1.83
log
@bump for plist changes 5.9 -> 6.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.82 2015/12/20 00:16:27 naddy Exp $
d41 3
a43 1
ARCH_LDFLAGS =		-Wl,--bss-plt
d45 1
a45 1
ARCH_LDFLAGS =
d47 1
a47 1
LDFLAGS=		-Z ${ARCH_LDFLAGS} -L${LOCALBASE}/lib -nopie
@


1.82
log
@bump for plist changes 5.8 -> 5.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2015/12/06 19:54:34 jca Exp $
d14 1
a14 1
REVISION-main=		32
@


1.81
log
@Try to unbreak on powerprc: use --bss-plt like editors/emacs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.80 2015/09/21 20:23:26 sthen Exp $
d14 1
a14 1
REVISION-main=		31
@


1.80
log
@it seems that something autofixed emacs21 on i386, so remove the BROKEN marker.
(can't have i386 being more dead than alpha ;-)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2015/09/11 11:33:35 jca Exp $
d39 7
a45 1
LDFLAGS=		-Z -L${LOCALBASE}/lib -nopie
@


1.79
log
@ld -Z might be fixed on powerpc, remove the BROKEN marker
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.78 2015/09/08 18:32:00 jca Exp $

BROKEN-i386= segfault during build (./temacs -batch -l loadup dump)
@


1.78
log
@Mark as BROKEN on powerpc, emacs needs a working ld(1) -Z.

Proposals have been made to support this ugly flag again, but there's no
point in attempting to build those ports until the issue is fixed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.77 2015/06/17 20:03:11 sthen Exp $
a3 1
BROKEN-powerpc= needs a working ld(1) -Z
@


1.77
log
@port REVISION bumps as base has moved to 5.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.76 2015/01/02 14:26:31 sthen Exp $
d4 1
@


1.76
log
@bump REVISION for 5.7
mark broken on i386
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.75 2014/10/28 08:42:47 jca Exp $
d16 1
a16 1
REVISION-main=		30
@


1.75
log
@Stop linking against libossaudio, sound support isn't even activated.
ok sthen@@ ratchov@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.74 2014/07/16 09:11:43 espie Exp $
d16 1
a16 1
REVISION-main=		29
@


1.74
log
@bump for 5.6beta
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2014/01/24 12:08:55 espie Exp $
d14 1
a14 1
REVISION-main=		28
d43 2
a44 1
			LDFLAGS="${LDFLAGS}"
d50 1
a50 1
WANTLIB-main=		c m ncurses ossaudio
@


1.73
log
@zap the sticky bit on executables. That stuff is long past its peremption
date.

okay deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2014/01/12 14:58:30 naddy Exp $
d14 1
a14 1
REVISION-main=		27
@


1.72
log
@bump for plist changes 5.4 -> 5.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2013/11/09 23:19:03 naddy Exp $
d14 1
a14 1
REVISION-main=		26
d71 3
@


1.71
log
@move http://www.gnu.org to https
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2013/09/25 07:56:57 sthen Exp $
d14 1
a14 1
REVISION-main=		25
@


1.70
log
@libungif->giflib and patch where necessary, ok jasper@@ aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2013/08/07 15:37:10 naddy Exp $
d14 3
a16 3
REVISION-main=		24
REVISION-el=		6
REVISION-leim=		6
d20 1
a20 1
HOMEPAGE=		http://www.gnu.org/software/emacs/
@


1.69
log
@kill direct and indirect references to GCC2_ARCHS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2013/07/07 21:25:28 naddy Exp $
d14 1
a14 1
REVISION-main=		23
d54 1
a54 1
LIB_DEPENDS-main=	graphics/libungif \
d58 1
a58 1
WANTLIB-main+=		ungif jpeg png tiff
@


1.68
log
@bump for plist changes 5.3 -> 5.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2013/07/06 03:22:11 brad Exp $
d39 1
a39 5
LDFLAGS=		-Z -L${LOCALBASE}/lib

.include <bsd.port.arch.mk>
.if ! ${PROPERTIES:Mgcc2}
LDFLAGS +=		-nopie
a40 1
.endif
@


1.67
log
@Remove use of ELF_TOOLCHAIN.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2013/06/04 18:41:41 naddy Exp $
d14 1
a14 1
REVISION-main=		22
@


1.66
log
@the png headers are now directly under include/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2013/03/15 14:09:22 sthen Exp $
d39 1
a39 2
LDFLAGS=		${ELF_TOOLCHAIN:L:S/yes/-Z/:S/no//} \
			-L${LOCALBASE}/lib
@


1.65
log
@- cope with current directory locations for mail/nmh.
- don't use groff.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2013/03/11 11:02:49 espie Exp $
d48 1
a48 2
CONFIGURE_ENV=		CPPFLAGS="-I${LOCALBASE}/include \
				  -I${LOCALBASE}/include/libpng" \
@


1.64
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2013/02/05 18:13:35 sthen Exp $
d14 1
a14 1
REVISION-main=		21
a28 1
USE_GROFF =		Yes
d74 4
@


1.63
log
@don't pass -nopie / -fno-pie on gcc2 arch; should let emacs21,no_x11 build on vax.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2013/02/01 16:34:36 naddy Exp $
a23 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d74 1
a74 1
NO_REGRESS=		Yes
@


1.62
log
@bump for plist changes 5.2 -> 5.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2012/08/30 20:54:59 pascal Exp $
d14 1
a14 1
REVISION-main=		20
d43 9
d54 1
a54 3
			LDFLAGS="${ELF_TOOLCHAIN:L:S/yes/-Z/:S/no//} \
				 -L${LOCALBASE}/lib -nopie"
CFLAGS +=		-fno-pie
@


1.61
log
@Adapt PIE fixes to new gcc/ld behaviour: Use -nopie as LDFLAGS and -fno-pie as
CFLAGS.

found in a bulk by and ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2012/08/11 22:55:39 pascal Exp $
d14 1
a14 1
REVISION-main=		19
@


1.60
log
@Prepare emacs for PIE.  emacs2* currently use gmalloc, which is incompatible
with PIE.  We should be using the system malloc anyway for security reasons.
Unfortunately, there are yet more problems with PIE in emacs proper, so disable
it for now until a solution is found.

ok naddy@@ sthen@@ (on a previous version)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2012/06/21 13:56:57 sthen Exp $
d46 1
a46 1
				 -L${LOCALBASE}/lib -fno-pie"
@


1.59
log
@bump for plist changes 5.1 -> 5.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2012/01/13 00:55:14 naddy Exp $
d14 3
a16 3
REVISION-main=		18
REVISION-el=		5
REVISION-leim=		5
a21 2
MAINTAINER=		Rich Cannings <cannings@@openbsd.org>

d42 1
a42 1
CONFIGURE_ARGS=		${GCCARCH} --with-pop
d46 2
a47 1
				 -L${LOCALBASE}/lib"
d69 2
@


1.58
log
@bump revision for plist changes 5.0 -> 5.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2011/11/07 15:39:50 espie Exp $
d14 3
a16 3
REVISION-main=		17
REVISION-el=		4
REVISION-leim=		4
@


1.57
log
@work around brain damage
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2011/09/16 09:48:08 espie Exp $
d14 1
a14 1
REVISION-main=		16
@


1.56
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2011/07/18 19:06:36 naddy Exp $
d41 2
d56 1
a56 1
.if ${FLAVOR:L:Mno_x11}
@


1.55
log
@bump revision for plist changes 4.9 -> 5.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2011/01/15 01:09:43 naddy Exp $
d15 2
a16 2
REVISION-el=		3
REVISION-leim=		3
@


1.54
log
@bump revision for plist changes 4.8 -> 4.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2010/11/15 23:22:07 espie Exp $
d14 1
a14 1
REVISION-main=		15
@


1.53
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2010/10/24 21:16:25 ajacoutot Exp $
d14 1
a14 1
REVISION-main=		14
@


1.52
log
@Remove USE_X11.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2010/10/18 18:00:16 espie Exp $
d34 1
a34 1
USE_GROFF =	Yes
d57 3
a59 3
LIB_DEPENDS-main=	::graphics/libungif \
			::graphics/png \
			::graphics/tiff
d64 1
a64 1
RUN_DEPENDS=		:emacs-${VERSION}:${PKGPATH}
@


1.51
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2010/08/04 17:17:57 naddy Exp $
a56 1
USE_X11=Yes
@


1.50
log
@fix i386; from stsp@@, reported by deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2010/07/26 18:08:00 ajacoutot Exp $
d34 1
@


1.49
log
@Remove powerpc workaround, it builds fine now, from Brad.
While here, move to new DEPENDS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2010/07/24 23:05:08 naddy Exp $
d14 1
a14 1
REVISION-main=		13
@


1.48
log
@bump PKGNAME for PLIST changes 4.7 -> 4.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2010/07/18 18:49:01 naddy Exp $
d14 3
a16 3
REVISION-main=		12
REVISION-el=		2
REVISION-leim=		2
a46 5
# Disable propolice on powerpc due to gcc3+propolice bug.
.if ${MACHINE_ARCH} == "powerpc"
CONFIGURE_ENV+=		CFLAGS="${CFLAGS} -fno-stack-protector"
.endif

d52 1
d57 5
a61 5
LIB_DEPENDS-main=	ungif.>=5::graphics/libungif \
			jpeg.>=62::graphics/jpeg \
			png.>=2::graphics/png \
			tiff.>=35::graphics/tiff
WANTLIB-main+=		ICE SM X11 Xaw Xext Xmu Xpm Xt pthread-stubs xcb z
@


1.47
log
@Remove redundant variables OPSYS and OPSYS_VER.
OPSYS was always "OpenBSD", the ports tree doesn't cover other
operating systems.
OPSYS_VER was the same as OSREV.

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2010/02/26 18:17:38 espie Exp $
d9 2
a10 2
PKGNAME-main=		${DISTNAME}p11
FULLPKGNAME-el=		emacs-el-${VERSION}p2
d12 1
a12 1
FULLPKGNAME-leim=	emacs-leim-${VERSION}p2
d14 3
@


1.46
log
@fix PKGPATHs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2010/01/27 21:43:28 naddy Exp $
d35 1
a35 1
GCCARCH=		${MACHINE_ARCH}-unknown-openbsd${OPSYS_VER}
@


1.45
log
@bump PKGNAME for PLIST changes 4.6 -> 4.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2009/08/10 06:31:08 kili Exp $
d10 4
a13 2
FULLPKGNAME-el=		emacs-el-${VERSION}p1
FULLPKGNAME-leim=	emacs-leim-${VERSION}p1
@


1.44
log
@WANTLIB changes after xcb addition and bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2009/07/17 16:38:48 naddy Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}p10
@


1.43
log
@fix package specs in depends; ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2009/06/22 17:00:23 naddy Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}p9
d60 1
a60 1
WANTLIB-main+=		ICE SM X11 Xaw Xext Xmu Xpm Xt z
@


1.42
log
@bump PKGNAME for PLIST changes 4.5 -> 4.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2009/02/09 20:48:23 naddy Exp $
d10 2
a11 2
FULLPKGNAME-el=		emacs-el-${VERSION}p0
FULLPKGNAME-leim=	emacs-leim-${VERSION}p0
d56 1
a56 1
LIB_DEPENDS-main=		ungif.>=5::graphics/libungif \
d63 1
a63 1
RUN_DEPENDS=		:emacs-${VERSION}*:${PKGPATH}
@


1.41
log
@bump PKGNAME for PLIST changes 4.4 -> 4.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2008/07/04 15:39:17 naddy Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}p8
@


1.40
log
@* bump PKGNAME for PLIST changes 4.3 -> 4.4
* fix RUN_DEPENDS for the subpackages: do not depend on a flavor
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2008/02/22 17:06:25 naddy Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}p7
@


1.39
log
@bump PKGNAME for PLIST changes 4.2 -> 4.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2007/09/16 00:44:00 merdely Exp $
d9 3
a11 3
PKGNAME-main=		${DISTNAME}p6
FULLPKGNAME-el=		emacs-el-${VERSION}
FULLPKGNAME-leim=	emacs-leim-${VERSION}
d63 1
a63 1
RUN_DEPENDS=		:emacs-${VERSION}*:${BUILD_PKGPATH}
@


1.38
log
@Removed surrounding quotes in COMMENT*/PERMIT_*

From Darrin Chandler
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2007/07/27 20:24:09 naddy Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}p5
@


1.37
log
@bump package name due to OSREV increment
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2007/07/06 16:59:32 kettenis Exp $
d3 3
a5 3
COMMENT-main=		"GNU editor: extensible, customizable, self documenting"
COMMENT-el=		"elisp sources for those who want to read/modify them"
COMMENT-leim=		"Library of Emacs Input Methods"
@


1.36
log
@Fix hppa
ok pval@@, naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2007/02/14 16:55:28 steven Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}p4
@


1.35
log
@bump PKGNAME due to PLIST changes after 4.0 -> 4.1
@
text
@d1 1
a1 5
# $OpenBSD: Makefile,v 1.34 2006/12/14 09:07:56 steven Exp $

.if ${MACHINE_ARCH} == "hppa"
BROKEN=			"hangs indefinitely until machine panics/hangs"
.endif
d9 1
a9 1
PKGNAME-main=		${DISTNAME}p3
@


1.34
log
@use BASE_PKGPATH instead of homegrown variable, no bumps needed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2006/11/24 22:14:42 espie Exp $
d13 1
a13 1
PKGNAME-main=		${DISTNAME}p2
@


1.33
log
@new MULTI_PACKAGES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2006/08/01 23:39:08 espie Exp $
d53 1
a53 1
SUBST_VARS=		GCCARCH VERSION MAINPATH
a57 1
MAINPATH=		editors/emacs21,no_x11
a63 1
MAINPATH=		editors/emacs21
d67 1
a67 1
RUN_DEPENDS=		:emacs-${VERSION}*:${MAINPATH}
@


1.32
log
@new libspecs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2006/07/28 06:29:33 steven Exp $
d7 1
a7 1
COMMENT=		"GNU editor: extensible, customizable, self documenting"
d13 1
a13 1
PKGNAME=		${DISTNAME}p1
d32 1
a32 2
MULTI_PACKAGES=		-el -leim
SUBPACKAGE?=
d53 1
a53 1
SUBST_VARS=		GCCARCH VERSION
d55 1
a55 1
myWANTLIB=		c m ncurses ossaudio
d58 1
d61 1
a61 1
myLIB_DEPENDS=		ungif.>=5::graphics/libungif \
d65 2
a66 1
myWANTLIB+=		ICE SM X11 Xaw Xext Xmu Xpm Xt z
d69 4
a72 14
.if defined(PACKAGING)
.  if !empty(SUBPACKAGE)
RUN_DEPENDS=		:emacs-${VERSION}*:editors/emacs21
.  else
LIB_DEPENDS=		$(myLIB_DEPENDS)
WANTLIB=		$(myWANTLIB)
.endif
.  if ${SUBPACKAGE} == "-el"
PKG_ARCH=		*
.  endif
.else
LIB_DEPENDS=		$(myLIB_DEPENDS)
WANTLIB=		$(myWANTLIB)
.endif
@


1.31
log
@bump PKGNAME due to PLIST changes after 3.9 -> 4.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2006/01/22 23:21:46 sturm Exp $
d61 4
a64 4
myLIB_DEPENDS=		ungif.5::graphics/libungif \
			jpeg.62::graphics/jpeg \
			png.2::graphics/png \
			tiff.35::graphics/tiff
@


1.30
log
@bump PKGNAME due to PLIST changes after 3.8 -> 3.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2005/12/10 11:57:40 aanriot Exp $
d13 1
a13 1
PKGNAME=		${DISTNAME}p0
@


1.29
log
@- update to 21.4 (format-string vulnerability patch merged).
- fix a buffer size.

maintainer timeout; ok mbalmer@@ alek@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2005/10/04 16:43:29 pvalchev Exp $
d13 1
@


1.28
log
@fix keyboard problem with various European keyboards and Xorg
from FreeBSD PR 78209 via Alexander Hall and maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2005/08/13 18:19:32 espie Exp $
d11 1
a11 1
VERSION=		21.3
a12 1
PKGNAME=		${DISTNAME}p3
d29 1
a29 1
DISTFILES=		emacs-${VERSION}.tar.gz leim-${VERSION}.tar.gz
@


1.27
log
@missing dirs in PLIST
okay pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2005/02/09 03:48:43 brad Exp $
d13 1
a13 1
PKGNAME=		${DISTNAME}p2
@


1.26
log
@Max Vozeler discovered a format string vulnerability in the "movemail"
utility of Emacs. By sending specially crafted packets, a malicious
POP3 server could cause a buffer overflow, which could have been
exploited to execute arbitrary code with the privileges of the user.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2005/01/02 04:43:06 pvalchev Exp $
d13 1
a13 1
PKGNAME=		${DISTNAME}p1
@


1.25
log
@disable propolice on powerpc due to a bug (hopefully temporarily)
now works again
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2004/12/14 21:15:55 espie Exp $
d13 1
@


1.24
log
@WANTLIB for MULTI_PACKAGES, somewhat more rational organization.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2004/11/24 11:08:03 espie Exp $
d45 5
@


1.23
log
@WANTLIB markers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2004/08/16 23:34:02 pvalchev Exp $
a26 1
WANTLIB=		c m ncurses ossaudio
d50 1
d55 1
a55 1
LIB_DEPENDS=		ungif.5::graphics/libungif \
d59 1
a59 1
WANTLIB+=		ICE SM X11 Xaw Xext Xmu Xpm Xt z
d65 4
a68 2
LIB_DEPENDS=
.  endif
d72 3
@


1.22
log
@INSTALL_PROGRAM was being overridden by bsd.port.mk, use custom INSTALL_EMACS
which is defined as INSTALL_SCRIPT from the makefile, as a hack to disable
stripping on the emacs binary.  discussed with marc, espie and others
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2004/02/04 07:39:18 sturm Exp $
d27 1
d59 1
@


1.22.2.1
log
@MFC:

Max Vozeler discovered a format string vulnerability in the "movemail"
utility of Emacs. By sending specially crafted packets, a malicious
POP3 server could cause a buffer overflow, which could have been
exploited to execute arbitrary code with the privileges of the user.

ok brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2004/08/16 23:34:02 pvalchev Exp $
a12 1
PKGNAME=		${DISTNAME}p1
@


1.21
log
@mark some subpackages arch independent

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2004/02/01 07:09:47 pvalchev Exp $
d45 2
@


1.21.2.1
log
@MFC:

Max Vozeler discovered a format string vulnerability in the "movemail"
utility of Emacs. By sending specially crafted packets, a malicious
POP3 server could cause a buffer overflow, which could have been
exploited to execute arbitrary code with the privileges of the user.

ok brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2004/02/04 07:39:18 sturm Exp $
a12 1
PKGNAME=		${DISTNAME}p1
@


1.20
log
@new maintainers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2004/01/30 17:04:48 lebel Exp $
d62 3
@


1.19
log
@remove Han Boetes as MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2003/12/31 08:38:24 pvalchev Exp $
d20 1
@


1.18
log
@hppa support
mark BROKEN, as there's still some sort of a bug; the process spins hogging
CPU until the machine hangs hard
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2003/10/13 17:02:39 naddy Exp $
a19 1
MAINTAINER=		Han Boetes <han@@linux-mandrake.com>
@


1.17
log
@don't depend on gmake; from Han Boetes <han@@mijncomputer.nl>
@
text
@d1 5
a5 1
# $OpenBSD: Makefile,v 1.16 2003/08/26 17:40:08 naddy Exp $
@


1.16
log
@Require GNU make.  Without, DOC-21.3.1 is mysteriously incremented
to DOC-21.3.2.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2003/07/18 13:58:09 brad Exp $
a34 1
USE_GMAKE=		Yes
@


1.15
log
@use :L with ELF_TOOLCHAIN variable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2003/07/06 15:35:40 naddy Exp $
d35 1
@


1.14
log
@it's good practice to always define SUBPACKAGE in multi-package ports
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2003/07/06 12:46:45 naddy Exp $
d39 1
a39 1
			LDFLAGS="${ELF_TOOLCHAIN:S/yes/-Z/:S/no//} \
@


1.13
log
@- Fold LEIM back into the parent Emacs port.
- Split LEIM and Elisp sources out into subpackages.

From: Han Boetes <han@@linux-mandrake.com>
@
text
@d1 1
a1 1
# $OpenBSD$
d28 1
@


1.12
log
@* Update to 21.3.
* Major cleaning and pruning of excessive FLAVORs.

From: Han Boetes <han@@linux-mandrake.com>, contributions by cannings@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2003/03/27 17:38:22 pvalchev Exp $
d4 2
d9 3
a12 1
MASTER_SITES=		${MASTER_SITE_GNU:=emacs/}
d18 1
d24 2
a25 1
SUBST_VARS=		GCCARCH VERSION
d27 1
a27 7
CONFIGURE_STYLE=	gnu dest
CONFIGURE_ARGS+=	${GCCARCH}

CONFIGURE_ENV=		CPPFLAGS="-I${LOCALBASE}/include \
				  -I${LOCALBASE}/include/libpng" \
			LDFLAGS="   ${ELF_TOOLCHAIN:S/yes/-Z/:S/no//} \
				  -L${LOCALBASE}/lib"
d34 8
a41 1
CONFIGURE_ARGS+=	--with-pop
d51 7
@


1.11
log
@remove Mark Grimes from maintainer position per his request
@
text
@d1 1
a1 2
# $OpenBSD: Makefile,v 1.10 2003/01/17 21:04:41 drahn Exp $
# Original from A B <obsdfaq30@@yahoo.com>
d3 1
a3 1
COMMENT=	"GNU editor: extensible, customizable, self documenting"
d5 8
a12 4
VERSION=	21.2
DISTNAME=	emacs-${VERSION}
CATEGORIES=	editors
MASTER_SITES=	${MASTER_SITE_GNU:=emacs/}
d19 1
a19 1
SUBST_VARS=	GCCARCH VERSION
d21 2
a22 1
.include <bsd.own.mk>
d24 4
a27 12
USE_GMAKE=	Yes
CONFIGURE_STYLE= gnu dest
CONFIGURE_ARGS+= ${GCCARCH}
.if (${ELF_TOOLCHAIN} == "yes")
CONFIGURE_ENV= CPPFLAGS="-I${LOCALBASE}/include \
			 -I${LOCALBASE}/include/libpng" \
	       LDFLAGS="-Z -L${LOCALBASE}/lib"
.else
CONFIGURE_ENV= CPPFLAGS="-I${LOCALBASE}/include \
			 -I${LOCALBASE}/include/libpng" \
	       LDFLAGS="-L${LOCALBASE}/lib"
.endif
d29 1
a29 7
# X11 flavors
FLAVORS=	no_x11 no_tiff no_png no_jpeg
# X toolkit styles
FLAVORS+=	athena lucid motif lesstif
# Misc options
FLAVORS+=	pop kerberos kerberos5 hesiod
# Default
d32 1
a32 1
M_ARCH=		${MACHINE_ARCH}
d34 1
a34 1
GCCARCH=	${M_ARCH}-unknown-openbsd${OPSYS_VER}
a35 1
# Bad flavor combinations
d37 1
a37 19
.   if ${FLAVOR:L:Mno_jpeg} || ${FLAVOR:L:Mno_png} || ${FLAVOR:L:Mno_tiff} || ${FLAVOR:L:Mathena} || ${FLAVOR:L:Mlucid} || ${FLAVOR:L:Mmotif} || ${FLAVOR:L:Mlesstif}
ERRORS+="Fatal: bad flavor combination ${FLAVOR}"
.   endif
.endif
.if ${FLAVOR:L:Mathena}
.  if ${FLAVOR:L:Mlucid} || ${FLAVOR:L:Mmotif} || ${FLAVOR:L:Mlesstif}
ERRORS+="Fatal: bad flavor combination ${FLAVOR}"
.  endif
.endif
.if ${FLAVOR:L:Mlucid}
.  if ${FLAVOR:L:Mmotif} || ${FLAVOR:L:Mlesstif}
ERRORS+="Fatal: bad flavor combination ${FLAVOR}"
.  endif
.endif


.if ${FLAVOR:L:Mno_x11}
CONFIGURE_ARGS+= --without-x --without-jpeg --without-png \
	--without-tiff --without-xim
a38 1

d40 4
a43 51
CONFIGURE_ARGS+= --with-x
LIB_DEPENDS+= ungif.5::graphics/libungif

.  if ${FLAVOR:L:Mno_jpeg}
CONFIGURE_ARGS+= --without-jpeg
.  else
LIB_DEPENDS+= jpeg.62::graphics/jpeg
CONFIGURE_ARGS+= --with-jpeg
.  endif

.  if ${FLAVOR:L:Mno_png}
CONFIGURE_ARGS+= --without-png
.  else
LIB_DEPENDS+= png.2::graphics/png
CONFIGURE_ARGS+= --with-png
.  endif 

.  if ${FLAVOR:L:Mno_tiff}
CONFIGURE_ARGS+= --without-tiff
.  else
LIB_DEPENDS+= tiff.35::graphics/tiff
CONFIGURE_ARGS+= --with-tiff
.  endif

.  if ${FLAVOR:L:Mpop}
CONFIGURE_ARGS+= --with-pop
.  endif 

.  if ${FLAVOR:L:Mkerberos}
CONFIGURE_ARGS+= --with-kerberos
.  endif 

.  if ${FLAVOR:L:Mkerberos5}
CONFIGURE_ARGS+= --with-kerberos5
.  endif

.  if ${FLAVOR:L:Mhesiod}
CONFIGURE_ARGS+= --with-hesiod
.  endif

.  if ${FLAVOR:L:Mathena}
LIB_DEPENDS+=	Xaw3d::x11/Xaw3d
CONFIGURE_ARGS+= --with-x-toolkit=athena --with-toolkit-scroll-bars
.  elif ${FLAVOR:L:Mlucid}
CONFIGURE_ARGS+= --with-x-toolkit=lucid --with-toolkit-scroll-bars
.  elif ${FLAVOR:L:Mmotif} || ${FLAVOR:L:Mlesstif}
USE_MOTIF=any
CONFIGURE_ARGS+= --with-x-toolkit=motif --with-toolkit-scroll-bars
.  else
CONFIGURE_ARGS+= --with-x-toolkit=no
.  endif
a44 20

# Do NOT strip on install.  We will strip those things that can be
# stripped after install. (emacs crashes if stripped on an alpha)
# To do the job correctly temacs should be stripped, not emacs
# (which is created from temacs).
INSTALL_STRIP=
STRIP_PROGS=	emacsclient etags ctags b2m ebrowse
.if (${MACHINE_ARCH} != "alpha")
STRIP_PROGS+=	${DISTNAME}
.endif
STRIP_EXECS=	cvtmail digest-doc emacsserver fakemail hexl movemail \
		profile sorted-doc yow

post-install:
.for file in ${STRIP_PROGS}
	@@strip ${PREFIX}/bin/${file}
.endfor
.for file in ${STRIP_EXECS}
	@@strip ${PREFIX}/libexec/emacs/${VERSION}/${GCCARCH}/${file}
.endfor
@


1.10
log
@Work around the fact that emacs undump knows too much about the layout
of elf files (or thinks it does). These assumptions were just broken
by binutils/ld changes to put GOT and PLT into their own PT_LOAD sections.
Thus BSS is no longer part of the DATA PT_LOAD section. This is a workaround
using the '-Z' compatibility flag which disables the GOT/PLT padding.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2002/12/09 15:37:23 brad Exp $
a9 2

MAINTAINER=	Mark Grimes <mark@@stateful.net>
@


1.9
log
@change e-mail address.
--
From: MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2002/11/24 00:49:50 mark Exp $
d20 2
d25 5
d33 1
@


1.8
log
@+ respect libpng header location
  (from Can Erkin Acar <canacar@@eee.metu.edu.tr>)
+ chop NEED_VERSION
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2002/05/13 12:37:37 naddy Exp $
d11 1
a11 1
MAINTAINER=	Mark Grimes <mark@@openbsd.org>
@


1.7
log
@bye MASTER_SITE_SUBDIR
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2002/04/24 00:21:43 mark Exp $
a8 1
NEED_VERSION=	1.528
d23 2
a24 1
CONFIGURE_ENV= CPPFLAGS="-I${LOCALBASE}/include" \
@


1.7.2.1
log
@+ respect libpng header location
(noticed by Can Erkin Acar <canacar@@eee.metu.edu.tr>)
+ chop NEED_VERSION  ok brad@@
+ bump package to p1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2002/05/13 12:37:37 naddy Exp $
a7 1
PKGNAME=	${DISTNAME}p1
d9 1
d24 1
a24 2
CONFIGURE_ENV= CPPFLAGS="-I${LOCALBASE}/include \
			 -I${LOCALBASE}/include/libpng" \
@


1.6
log
@emacs 21.2 update with corrected PLIST ordering
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2002/03/29 19:13:25 pvalchev Exp $
d9 2
a10 3
NEED_VERSION=	1.514
MASTER_SITES=	${MASTER_SITE_GNU}
MASTER_SITE_SUBDIR= emacs
@


1.5
log
@register ungif dependency... thanks jason.
is lib-depends-check that hard to use?
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2002/03/20 02:27:24 mark Exp $
d6 1
a6 1
VERSION=	21.1
@


1.4
log
@Revert back to GMAKE, BSD make links twice during faking, thus
incrementing the fns elisp file needed for Eshell and bumping
Emacs version to 21.1.2 rather then the expected 21.1.1.

Needs more investigation.  ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2002/03/18 01:58:03 espie Exp $
d66 1
@


1.3
log
@Simpler flavors.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2002/03/12 09:03:42 mark Exp $
d22 1
@


1.2
log
@+ reduce no_x11 depends to essentials
+ no more gmake
+ bump NEED_VERSION

fix from shiva.brahma@@inwind.it
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2002/02/10 22:05:40 mark Exp $
d9 1
a9 1
NEED_VERSION=	1.509
d28 1
a28 1
FLAVORS=	no_x11 no_tiff no_png no_jpeg x11
d30 1
a30 1
FLAVORS+=	athena lucid motif
d34 1
a34 1
FLAVOR?=	x11
d40 18
d66 1
a66 1
.if ${FLAVOR:L:Mno_jpeg}
d68 4
a71 1
.endif
d73 1
a73 1
.if ${FLAVOR:L:Mno_png}
d75 4
a78 1
.endif 
d80 1
a80 1
.if ${FLAVOR:L:Mno_tiff}
d82 4
a85 1
.endif
d87 1
a87 1
.if ${FLAVOR:L:Mpop}
d89 1
a89 1
.endif 
d91 1
a91 1
.if ${FLAVOR:L:Mkerberos}
d93 1
a93 1
.endif 
d95 1
a95 1
.if ${FLAVOR:L:Mkerberos5}
d97 1
a97 1
.endif
d99 1
a99 1
.if ${FLAVOR:L:Mhesiod}
d101 1
a101 1
.endif
d103 1
a103 1
.if ${FLAVOR:L:Mathena}
d106 1
a106 1
.elif ${FLAVOR:L:Mlucid}
d108 1
a108 1
.elif ${FLAVOR:L:Mmotif}
d111 1
a111 1
.else
d113 1
a113 19
.endif

.if ${FLAVOR:L:Mx11}

.if !${FLAVOR:L:Mno_jpeg}
LIB_DEPENDS+= jpeg.62::graphics/jpeg
CONFIGURE_ARGS+= --with-jpeg
.endif

.if !${FLAVOR:L:Mno_png}
LIB_DEPENDS+= png.2::graphics/png
CONFIGURE_ARGS+= --with-png
.endif

.if !${FLAVOR:L:Mno_tiff}
LIB_DEPENDS+= tiff.35::graphics/tiff
CONFIGURE_ARGS+= --with-tiff
.endif
.endif
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d9 1
a9 1
NEED_VERSION=	1.504
a21 1
USE_GMAKE=	Yes
d41 2
a42 1
CONFIGURE_ARGS+= --without-x
d48 1
a48 1
.   if ${FLAVOR:L:Mno_jpeg}
d50 1
a50 1
.   endif
d52 1
a52 1
.   if ${FLAVOR:L:Mno_png}
d54 1
a54 1
.   endif 
d56 1
a56 1
.   if ${FLAVOR:L:Mno_tiff}
d58 1
a58 1
.   endif
d60 1
a60 1
.   if ${FLAVOR:L:Mpop}
d62 1
a62 1
.   endif 
d64 1
a64 1
.   if ${FLAVOR:L:Mkerberos}
d66 1
a66 1
.   endif 
d68 1
a68 1
.   if ${FLAVOR:L:Mkerberos5}
d70 1
a70 1
.   endif
d72 1
a72 1
.   if ${FLAVOR:L:Mhesiod}
d74 1
a74 1
.   endif
d76 1
a76 1
.   if ${FLAVOR:L:Mathena}
d79 1
a79 1
.       elif ${FLAVOR:L:Mlucid}
d81 1
a81 1
.       elif ${FLAVOR:L:Mmotif}
d84 1
a84 1
.       else
d86 1
a86 1
.   endif
d88 1
a88 1
.   if ${FLAVOR:L:Mx11}
d90 1
a90 1
.       if !${FLAVOR:L:Mno_jpeg}
d93 1
a93 1
.       endif
d95 1
a95 1
.       if !${FLAVOR:L:Mno_png}
d98 1
a98 1
.       endif
d100 1
a100 1
.       if !${FLAVOR:L:Mno_tiff}
d103 2
a104 2
.       endif
.   endif
@


1.1.1.1
log
@Emacs 21.1 import

Some of you may opt to stick with 20.x, as this is a typical beginning of
a major rev.  Maintainership is directed my way, so feed patches to me.

Thanks to A B <obsdfaq30@@yahoo.com> for the submission.

@
text
@@
