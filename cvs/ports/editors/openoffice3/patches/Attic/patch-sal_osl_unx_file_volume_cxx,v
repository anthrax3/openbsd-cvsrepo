head	1.3;
access;
symbols
	OPENBSD_5_0:1.2.0.4
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.2
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2011.11.16.13.38.22;	author robert;	state dead;
branches;
next	1.2;

1.2
date	2010.11.09.18.40.04;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2010.03.30.11.03.07;	author robert;	state Exp;
branches;
next	;


desc
@@


1.3
log
@remove the dead openoffice ports
@
text
@$OpenBSD: patch-sal_osl_unx_file_volume_cxx,v 1.2 2010/11/09 18:40:04 robert Exp $
--- sal/osl/unx/file_volume.cxx.orig.port	Fri Oct 29 12:35:35 2010
+++ sal/osl/unx/file_volume.cxx	Tue Nov  9 00:52:32 2010
@@@@ -69,7 +69,7 @@@@ static const sal_Char* MOUNTTAB="/etc/mnttab";
 //#include <ctype.h>
 static const sal_Char* MOUNTTAB="/etc/mtab";
 
-#elif defined(NETBSD) || defined(FREEBSD)
+#elif defined(NETBSD) || defined(FREEBSD) || defined(OPENBSD)
 
 #include <sys/param.h>
 #include <sys/ucred.h>
@@@@ -181,12 +181,16 @@@@ oslFileError osl_getVolumeInformation( rtl_uString* us
 
 #ifdef HAVE_STATFS_H
 
-#if defined(FREEBSD) || defined(NETBSD) || defined(MACOSX)
+#if defined(FREEBSD) || defined(NETBSD) || defined(MACOSX) || defined(OPENBSD)
 #   define __OSL_STATFS_STRUCT      			struct statfs
 #   define __OSL_STATFS(dir, sfs)   			statfs((dir), (sfs))
 #   define __OSL_STATFS_BLKSIZ(a)   			((sal_uInt64)((a).f_bsize))
 #   define __OSL_STATFS_TYPENAME(a) 			((a).f_fstypename)
+#if defined(OPENBSD)
+#   define __OSL_STATFS_ISREMOTE(a)			(rtl_str_compare((a).f_fstypename, "nfs") == 0)
+#else
 #   define __OSL_STATFS_ISREMOTE(a) 			(((a).f_type & MNT_LOCAL) == 0)
+#endif
 
 /* always return true if queried for the properties of
    the file system. If you think this is wrong under any
@@@@ -1093,35 +1097,35 @@@@ osl_isFloppyMounted (oslVolumeDeviceHandleImpl* pDevic
  *
  *****************************************************************************/
 
-#if (defined(MACOSX) || defined(NETBSD) || defined(FREEBSD))
+#if (defined(MACOSX) || defined(NETBSD) || defined(FREEBSD) || defined(OPENBSD))
 static oslVolumeDeviceHandle osl_isFloppyDrive(const sal_Char* pszPath)
 {
     return NULL;
 }
 #endif /* MACOSX */
 
-#if ( defined(MACOSX) || defined(NETBSD) || defined(FREEBSD))
+#if ( defined(MACOSX) || defined(NETBSD) || defined(FREEBSD) || defined(OPENBSD))
 static oslFileError osl_mountFloppy(oslVolumeDeviceHandle hFloppy)
 {
     return osl_File_E_BUSY;
 }
 #endif /* MACOSX */
 
-#if ( defined(MACOSX) || defined(NETBSD) || defined(FREEBSD))
+#if ( defined(MACOSX) || defined(NETBSD) || defined(FREEBSD) || defined(OPENBSD))
 static oslFileError osl_unmountFloppy(oslVolumeDeviceHandle hFloppy)
 {
     return osl_File_E_BUSY;
 }
 #endif /* MACOSX */
 
-#if ( defined(NETBSD) || defined(FREEBSD) )
+#if ( defined(NETBSD) || defined(FREEBSD) | defined(OPENBSD) )
 static sal_Bool osl_getFloppyMountEntry(const sal_Char* pszPath, oslVolumeDeviceHandleImpl* pItem)
 {
     return sal_False;
 }
 #endif /* NETBSD || FREEBSD */
 
-#if ( defined(NETBSD) || defined(FREEBSD) )
+#if ( defined(NETBSD) || defined(FREEBSD) || defined(OPENBSD) )
 static sal_Bool osl_isFloppyMounted(oslVolumeDeviceHandleImpl* pDevice)
 {
     return sal_False;
@


1.2
log
@- update to openoffice.org 3.3rc3
- rework a port a little bit to be sync in the openoffice linux
  code and remove some hacks that we don't need anymore
- also use --as-needed while linking (which results in at least a 50% speed
  improovement)
- depend on more libraries from the system instead of using the internal
  ones
@
text
@d1 1
a1 1
$OpenBSD: patch-sal_osl_unx_file_volume_cxx,v 1.1 2010/03/30 11:03:07 robert Exp $
@


1.1
log
@Update to openoffice 3.2;
this is a major update that introduced many cool stuff and it's
speed is awesome compared to the previous versions
@
text
@d1 4
a4 4
$OpenBSD$
--- sal/osl/unx/file_volume.cxx.orig.port	Sun Jan 24 20:32:30 2010
+++ sal/osl/unx/file_volume.cxx	Sun Jan 24 20:35:30 2010
@@@@ -63,7 +63,7 @@@@ static const sal_Char* MOUNTTAB="/etc/mnttab";
d13 1
a13 1
@@@@ -191,19 +191,18 @@@@ oslFileError osl_getVolumeInformation( rtl_uString* us
d23 5
a27 1
-#   define __OSL_STATFS_ISREMOTE(a) 			(((a).f_type & MNT_LOCAL) == 0)
d31 1
a31 36
    of the target platforms fix it!!!! */
 #	define __OSL_STATFS_IS_CASE_SENSITIVE_FS(a)	 (1)
 #	define __OSL_STATFS_IS_CASE_PRESERVING_FS(a) (1)
-#endif /* FREEBSD || NETBSD || MACOSX */
+#endif /* FREEBSD || NETBSD || MACOSX || OPENBSD */
 
 #if defined(LINUX)
 #	define __OSL_NFS_SUPER_MAGIC				 0x6969
@@@@ -215,7 +214,6 @@@@ oslFileError osl_getVolumeInformation( rtl_uString* us
 #   define __OSL_STATFS_BLKSIZ(a)    			 ((sal_uInt64)((a).f_bsize))
 #   define __OSL_STATFS_IS_NFS(a)     			 (__OSL_NFS_SUPER_MAGIC == (a).f_type) 
 #   define __OSL_STATFS_IS_SMB(a)     			 (__OSL_SMB_SUPER_MAGIC == (a).f_type) 
-#   define __OSL_STATFS_ISREMOTE(a)  			 (__OSL_STATFS_IS_NFS((a)) || __OSL_STATFS_IS_SMB((a)))
 #	define __OSL_STATFS_IS_CASE_SENSITIVE_FS(a)  ((__OSL_MSDOS_SUPER_MAGIC != (a).f_type) && (__OSL_NTFS_SUPER_MAGIC != (a).f_type))
 #	define __OSL_STATFS_IS_CASE_PRESERVING_FS(a) ((__OSL_MSDOS_SUPER_MAGIC != (a).f_type))
 #endif /* LINUX */
@@@@ -241,7 +239,6 @@@@ oslFileError osl_getVolumeInformation( rtl_uString* us
 #   define __OSL_STATFS_STRUCT        			 struct dummy {int i;}
 #   define __OSL_STATFS_INIT(a)       			 ((void)0)
 #   define __OSL_STATFS(dir, sfs)     		     (1)
-#   define __OSL_STATFS_ISREMOTE(sfs) 			 (0)
 #	define __OSL_STATFS_IS_CASE_SENSITIVE_FS(a)	 (1)
 #	define __OSL_STATFS_IS_CASE_PRESERVING_FS(a) (1)
 #endif /* HAVE_STATFS_H */
@@@@ -269,10 +266,6 @@@@ static oslFileError osl_psz_getVolumeInformation (
     /* FIXME: how to detect the kind of storage (fixed, cdrom, ...) */
 	if (uFieldMask & osl_VolumeInfo_Mask_Attributes)
 	{	
-	    if (__OSL_STATFS_ISREMOTE(sfs))
-			pInfo->uAttributes  |= osl_Volume_Attribute_Remote;
-						
-		pInfo->uValidFields |= osl_VolumeInfo_Mask_Attributes;	
 	}
 
 	if (uFieldMask & osl_VolumeInfo_Mask_FileSystemCaseHandling)
@@@@ -1508,35 +1501,35 @@@@ static sal_Bool osl_isFloppyMounted(oslVolumeDeviceHan
d60 1
a60 1
+#if ( defined(NETBSD) || defined(FREEBSD) || defined(OPENBSD) )
@

