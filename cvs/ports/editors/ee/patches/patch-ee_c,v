head	1.5;
access;
symbols
	OPENBSD_6_2:1.5.0.22
	OPENBSD_6_2_BASE:1.5
	OPENBSD_6_1:1.5.0.20
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.18
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.14
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.16
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.12
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.10
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.8
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.6
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_3:1.5.0.4
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.5.0.2
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.26
	OPENBSD_5_0:1.3.0.24
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.22
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.20
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.18
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.16
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.14
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.12
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.10
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.8
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.6
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.4
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.2
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.2.0.12
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.10
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.8
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.6
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.4
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.2
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.1.1.1.0.4
	OPENBSD_3_2_BASE:1.1.1.1
	OPENBSD_3_1:1.1.1.1.0.2
	OPENBSD_3_1_BASE:1.1.1.1
	naddy_20011113:1.1.1.1
	naddy:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2012.05.10.19.30.31;	author gonzalo;	state Exp;
branches;
next	1.4;

1.4
date	2012.05.10.12.56.27;	author gonzalo;	state dead;
branches;
next	1.3;

1.3
date	2006.01.27.22.45.52;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2002.12.13.07.52.10;	author pvalchev;	state Exp;
branches
	1.2.10.1
	1.2.12.1;
next	1.1;

1.1
date	2001.11.13.15.23.15;	author naddy;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.11.13.15.23.15;	author naddy;	state Exp;
branches;
next	;

1.2.10.1
date	2006.01.28.15.37.31;	author sturm;	state Exp;
branches;
next	;

1.2.12.1
date	2006.01.28.15.38.18;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Wrong rm patches/patch-ee_c pointed by nigel@@.

OK, sthen@@
@
text
@$OpenBSD$
--- ee.c.orig	Thu May 10 19:35:13 2012
+++ ee.c	Thu May 10 19:35:19 2012
@@@@ -111,6 +111,8 @@@@ nl_catd catalog;
 #define SIGCHLD SIGCLD
 #endif
 
+#define SIGUNUSED 31
+
 #define TAB 9
 #define max(a, b)	(a > b ? a : b)
 #define min(a, b)	(a < b ? a : b)
@@@@ -4124,7 +4126,7 @@@@ Format()	/* format the paragraph according to set marg
 }
 
 unsigned char *init_name[3] = {
-	"/usr/local/lib/init.ee", 
+	SYSCONFDIR "/init.ee", 
 	NULL, 
 	".init.ee"
 	};
@


1.4
log
@Update for ee to 1.5.2 whit some fixes:

* added display of line number, column, and lines from top to separator
line for info window
* minor changes to reduce number of warnings when using -pedantic option
* changed how strings are terminated from the old usage of NULL to the
current use of character zero, '\0'

While here, GROFF is not needed, new license, patch-ee_c is not needed
anymore and honor CC variable, tested on i386, amd64 and powerpc.

OK brett@@, sthen@@
@
text
@d1 13
a13 88
$OpenBSD: patch-ee_c,v 1.3 2006/01/27 22:45:52 brad Exp $
--- ee.c.orig	Fri Sep 20 20:46:16 2002
+++ ee.c	Sat Jan 14 19:59:25 2006
@@@@ -300,7 +300,7 @@@@ void finish P_((void));
 int quit P_((int noverify));
 void edit_abort P_((int arg));
 void delete_text P_((void));
-int write_file P_((char *file_name));
+int write_file P_((char *file_name, int warn_if_exists));
 int search P_((int display_message));
 void search_prompt P_((void));
 void del_char P_((void));
@@@@ -931,7 +931,7 @@@@ int temp_int;
 int 
 out_char(window, character, column)	/* output non-printing character */
 WINDOW *window;
-char character;
+int character;
 int column;
 {
 	int i1, i2;
@@@@ -979,7 +979,7 @@@@ int column;
 
 int 
 len_char(character, column)	/* return the length of the character	*/
-char character;
+int character;
 int column;	/* the column must be known to provide spacing for tabs	*/
 {
 	int length;
@@@@ -1694,7 +1694,7 @@@@ char *cmd_str1;
 			cmd_str = cmd_str2 = get_string(file_write_prompt_str, TRUE);
 		}
 		tmp_file = resolve_name(cmd_str);
-		write_file(tmp_file);
+		write_file(tmp_file, 1);
 		if (tmp_file != cmd_str)
 			free(tmp_file);
 	}
@@@@ -2401,7 +2401,7 @@@@ finish()	/* prepare to exit edit session
 		file_name = tmp_file;
 	}
 
-	if (write_file(file_name))
+	if (write_file(file_name, 1))
 	{
 		text_changes = FALSE;
 		quit(0);
@@@@ -2477,8 +2477,9 @@@@ delete_text()
 }
 
 int 
-write_file(file_name)
+write_file(file_name, warn_if_exists)
 char *file_name;
+int warn_if_exists;
 {
 	char cr;
 	char *tmp_point;
@@@@ -2488,7 +2489,8 @@@@ char *file_name;
 	int write_flag = TRUE;
 
 	charac = lines = 0;
-	if ((in_file_name == NULL) || strcmp(in_file_name, file_name))
+	if (warn_if_exists &&
+	    ((in_file_name == NULL) || strcmp(in_file_name, file_name)))
 	{
 		if ((temp_fp = fopen(file_name, "r")))
 		{
@@@@ -3734,7 +3736,7 @@@@ int arg;
 	{
 		string = get_string(file_write_prompt_str, TRUE);
 		tmp_file = resolve_name(string);
-		write_file(tmp_file);
+		write_file(tmp_file, 1);
 		if (tmp_file != string)
 			free(tmp_file);
 		free(string);
@@@@ -3771,7 +3773,7 @@@@ int arg;
 				string = tmp_file;
 			}
 		}
-		if (write_file(string))
+		if (write_file(string, 1))
 		{
 			in_file_name = string;
 			text_changes = FALSE;
@@@@ -4080,7 +4082,7 @@@@ Format()	/* format the paragraph accordi
a21 31
@@@@ -4382,17 +4384,25 @@@@ spell_op()	/* check spelling of words in
 void 
 ispell_op()
 {
-	char name[128];
+	char template[128], *name;
 	char string[256];
-	int pid;
+	int fd;
 
 	if (restrict_mode())
 	{
 		return;
 	}
-	pid = getpid();
-	sprintf(name, "/tmp/ee.%d", pid);
-	if (write_file(name))
+	(void)sprintf(template, "/tmp/ee.XXXXXXXX");
+	name = mktemp(&template[0]);
+	fd = open(name, O_CREAT | O_EXCL | O_RDWR, 0600);
+	if (fd < 0) {
+		wmove(com_win, 0, 0);
+		wprintw(com_win, create_file_fail_msg, name);
+		wrefresh(com_win);
+		return;
+	}
+	close(fd);
+	if (write_file(name, 0))
 	{
 		sprintf(string, "ispell %s", name);
 		sh_command(string);
@


1.3
log
@fix temp file issue.

From FreeBSD
@
text
@d1 1
a1 1
$OpenBSD: patch-ee_c,v 1.2 2002/12/13 07:52:10 pvalchev Exp $
@


1.2
log
@solve more signed vs unsigned char issues by using correct types, some of
it was just a matter of making functions match their prototypes.....
ok maintainer Jose Nazario
@
text
@d1 13
a13 4
$OpenBSD: patch-ee_c,v 1.1.1.1 2001/11/13 15:23:15 naddy Exp $
--- ee.c.orig	Fri Aug 17 17:14:49 2001
+++ ee.c	Thu Dec 12 00:22:09 2002
@@@@ -929,7 +929,7 @@@@ int temp_int;
d22 1
a22 1
@@@@ -977,7 +977,7 @@@@ int column;
d31 58
a88 1
@@@@ -4069,7 +4069,7 @@@@ Format()	/* format the paragraph accordi
d97 31
@


1.2.12.1
log
@MFC:
fix temp file issue.
From FreeBSD
@
text
@d1 4
a4 13
$OpenBSD: patch-ee_c,v 1.3 2006/01/27 22:45:52 brad Exp $
--- ee.c.orig	Fri Sep 20 20:46:16 2002
+++ ee.c	Sat Jan 14 19:59:25 2006
@@@@ -300,7 +300,7 @@@@ void finish P_((void));
 int quit P_((int noverify));
 void edit_abort P_((int arg));
 void delete_text P_((void));
-int write_file P_((char *file_name));
+int write_file P_((char *file_name, int warn_if_exists));
 int search P_((int display_message));
 void search_prompt P_((void));
 void del_char P_((void));
@@@@ -931,7 +931,7 @@@@ int temp_int;
d13 1
a13 1
@@@@ -979,7 +979,7 @@@@ int column;
d22 1
a22 58
@@@@ -1694,7 +1694,7 @@@@ char *cmd_str1;
 			cmd_str = cmd_str2 = get_string(file_write_prompt_str, TRUE);
 		}
 		tmp_file = resolve_name(cmd_str);
-		write_file(tmp_file);
+		write_file(tmp_file, 1);
 		if (tmp_file != cmd_str)
 			free(tmp_file);
 	}
@@@@ -2401,7 +2401,7 @@@@ finish()	/* prepare to exit edit session
 		file_name = tmp_file;
 	}
 
-	if (write_file(file_name))
+	if (write_file(file_name, 1))
 	{
 		text_changes = FALSE;
 		quit(0);
@@@@ -2477,8 +2477,9 @@@@ delete_text()
 }
 
 int 
-write_file(file_name)
+write_file(file_name, warn_if_exists)
 char *file_name;
+int warn_if_exists;
 {
 	char cr;
 	char *tmp_point;
@@@@ -2488,7 +2489,8 @@@@ char *file_name;
 	int write_flag = TRUE;
 
 	charac = lines = 0;
-	if ((in_file_name == NULL) || strcmp(in_file_name, file_name))
+	if (warn_if_exists &&
+	    ((in_file_name == NULL) || strcmp(in_file_name, file_name)))
 	{
 		if ((temp_fp = fopen(file_name, "r")))
 		{
@@@@ -3734,7 +3736,7 @@@@ int arg;
 	{
 		string = get_string(file_write_prompt_str, TRUE);
 		tmp_file = resolve_name(string);
-		write_file(tmp_file);
+		write_file(tmp_file, 1);
 		if (tmp_file != string)
 			free(tmp_file);
 		free(string);
@@@@ -3771,7 +3773,7 @@@@ int arg;
 				string = tmp_file;
 			}
 		}
-		if (write_file(string))
+		if (write_file(string, 1))
 		{
 			in_file_name = string;
 			text_changes = FALSE;
@@@@ -4080,7 +4082,7 @@@@ Format()	/* format the paragraph accordi
a30 31
@@@@ -4382,17 +4384,25 @@@@ spell_op()	/* check spelling of words in
 void 
 ispell_op()
 {
-	char name[128];
+	char template[128], *name;
 	char string[256];
-	int pid;
+	int fd;
 
 	if (restrict_mode())
 	{
 		return;
 	}
-	pid = getpid();
-	sprintf(name, "/tmp/ee.%d", pid);
-	if (write_file(name))
+	(void)sprintf(template, "/tmp/ee.XXXXXXXX");
+	name = mktemp(&template[0]);
+	fd = open(name, O_CREAT | O_EXCL | O_RDWR, 0600);
+	if (fd < 0) {
+		wmove(com_win, 0, 0);
+		wprintw(com_win, create_file_fail_msg, name);
+		wrefresh(com_win);
+		return;
+	}
+	close(fd);
+	if (write_file(name, 0))
 	{
 		sprintf(string, "ispell %s", name);
 		sh_command(string);
@


1.2.10.1
log
@MFC:
fix temp file issue.
From FreeBSD
@
text
@d1 4
a4 13
$OpenBSD: patch-ee_c,v 1.3 2006/01/27 22:45:52 brad Exp $
--- ee.c.orig	Fri Sep 20 20:46:16 2002
+++ ee.c	Sat Jan 14 19:59:25 2006
@@@@ -300,7 +300,7 @@@@ void finish P_((void));
 int quit P_((int noverify));
 void edit_abort P_((int arg));
 void delete_text P_((void));
-int write_file P_((char *file_name));
+int write_file P_((char *file_name, int warn_if_exists));
 int search P_((int display_message));
 void search_prompt P_((void));
 void del_char P_((void));
@@@@ -931,7 +931,7 @@@@ int temp_int;
d13 1
a13 1
@@@@ -979,7 +979,7 @@@@ int column;
d22 1
a22 58
@@@@ -1694,7 +1694,7 @@@@ char *cmd_str1;
 			cmd_str = cmd_str2 = get_string(file_write_prompt_str, TRUE);
 		}
 		tmp_file = resolve_name(cmd_str);
-		write_file(tmp_file);
+		write_file(tmp_file, 1);
 		if (tmp_file != cmd_str)
 			free(tmp_file);
 	}
@@@@ -2401,7 +2401,7 @@@@ finish()	/* prepare to exit edit session
 		file_name = tmp_file;
 	}
 
-	if (write_file(file_name))
+	if (write_file(file_name, 1))
 	{
 		text_changes = FALSE;
 		quit(0);
@@@@ -2477,8 +2477,9 @@@@ delete_text()
 }
 
 int 
-write_file(file_name)
+write_file(file_name, warn_if_exists)
 char *file_name;
+int warn_if_exists;
 {
 	char cr;
 	char *tmp_point;
@@@@ -2488,7 +2489,8 @@@@ char *file_name;
 	int write_flag = TRUE;
 
 	charac = lines = 0;
-	if ((in_file_name == NULL) || strcmp(in_file_name, file_name))
+	if (warn_if_exists &&
+	    ((in_file_name == NULL) || strcmp(in_file_name, file_name)))
 	{
 		if ((temp_fp = fopen(file_name, "r")))
 		{
@@@@ -3734,7 +3736,7 @@@@ int arg;
 	{
 		string = get_string(file_write_prompt_str, TRUE);
 		tmp_file = resolve_name(string);
-		write_file(tmp_file);
+		write_file(tmp_file, 1);
 		if (tmp_file != string)
 			free(tmp_file);
 		free(string);
@@@@ -3771,7 +3773,7 @@@@ int arg;
 				string = tmp_file;
 			}
 		}
-		if (write_file(string))
+		if (write_file(string, 1))
 		{
 			in_file_name = string;
 			text_changes = FALSE;
@@@@ -4080,7 +4082,7 @@@@ Format()	/* format the paragraph accordi
a30 31
@@@@ -4382,17 +4384,25 @@@@ spell_op()	/* check spelling of words in
 void 
 ispell_op()
 {
-	char name[128];
+	char template[128], *name;
 	char string[256];
-	int pid;
+	int fd;
 
 	if (restrict_mode())
 	{
 		return;
 	}
-	pid = getpid();
-	sprintf(name, "/tmp/ee.%d", pid);
-	if (write_file(name))
+	(void)sprintf(template, "/tmp/ee.XXXXXXXX");
+	name = mktemp(&template[0]);
+	fd = open(name, O_CREAT | O_EXCL | O_RDWR, 0600);
+	if (fd < 0) {
+		wmove(com_win, 0, 0);
+		wprintw(com_win, create_file_fail_msg, name);
+		wrefresh(com_win);
+		return;
+	}
+	close(fd);
+	if (write_file(name, 0))
 	{
 		sprintf(string, "ispell %s", name);
 		sh_command(string);
@


1.1
log
@Initial revision
@
text
@d1 21
a21 3
$OpenBSD$
--- ee.c.orig	Mon Nov 12 01:46:12 2001
+++ ee.c	Mon Nov 12 01:46:35 2001
@


1.1.1.1
log
@Import of ee-1.4.4.
Submitted by Jose Nazario <jose@@crimelabs.net>.

An easy to use text editor.  Intended to be usable with little or
no instruction.  Provides a terminal (curses-based) interface.
Features pop-up menus.
@
text
@@
