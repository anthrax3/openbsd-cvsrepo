head	1.2;
access;
symbols
	OPENBSD_2_8:1.1.0.4
	OPENBSD_2_8_BASE:1.1
	OPENBSD_2_7:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2001.02.18.23.58.39;	author dugsong;	state dead;
branches;
next	1.1;

1.1
date	2000.06.12.10.05.21;	author fgsch;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to version 0.7.12
@
text
@--- ../wv/oledecod/oledecod.c.orig	Thu Mar 30 06:01:43 2000
+++ ../wv/oledecod/oledecod.c	Mon Jun 12 05:09:33 2000
@@@@ -49,6 +49,7 @@@@
 #include <ctype.h>
 #include <sys/types.h>
 #include <assert.h>
+#include <unistd.h>
 
 #include "wv.h"
 
@@@@ -340,6 +341,7 @@@@ OLEdecode (FILE *input, pps_entry ** str
     U16 BlockSize, Offset;
     size_t bytes_to_read;
     U32 pps_size, pps_start;
+    int fd;
 #define THEMIN(a,b) ((a)<(b) ? (a) : (b))
 
     for (i = 0; i < num_of_pps; i++)
@@@@ -367,19 +369,27 @@@@ OLEdecode (FILE *input, pps_entry ** str
 	  {
 	    assert (i == *root);
 	    assert (i == 0);
-	    tmpnam (sbfilename);
-	    test (sbfilename[0], 7, ends ());
-	    sbfile = OLEfile = fopen (sbfilename, "wb+");
+	    strcpy(sbfilename, "/tmp/oledecodXXXXXXX");
+	    fd = mkstemp(sbfilename);
+	    test (fd != -1, 7, ends ());
+	    if ((sbfile = OLEfile = fdopen (fd, "wb+")) == NULL) {
+		unlink(sbfilename);
+		close(fd);
+	    }
 	    test (OLEfile != NULL, 7, ends ());
 	    verboseS (sbfilename);
 	  }
 	else
 	  /* other entry, save in a file */
 	  {
-	    tmpnam (pps_list[i].filename);
-	    test (pps_list[i].filename[0], 7, ends ());
+	    strcpy(pps_list[i].filename, "/tmp/oledecodXXXXXXX");
+	    fd = mkstemp(sbfilename);
+	    test (fd != -1, 7, ends ());
 	    verbose (pps_list[i].name);
-	    OLEfile = fopen (pps_list[i].filename, "wb");
+	    if ((OLEfile = fdopen (fd, "wb")) == NULL) {
+		unlink(pps_list[i].filename);
+		close(fd);
+	    }
 	    test (OLEfile != NULL, 7, ends ());
 	    verbose (pps_list[i].filename);
 	  }
@


1.1
log
@Update to 0.7.9; fake; add CONFIGURE_STYLE and NEED_VERSION as well
as comment to PLIST.
@
text
@@

