head	1.4;
access;
symbols
	OPENBSD_6_0:1.4.0.2
	OPENBSD_5_7:1.2.0.6
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.4
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.2
	OPENBSD_5_5_BASE:1.2;
locks; strict;
comment	@# @;


1.4
date	2015.07.08.16.36.41;	author sthen;	state dead;
branches
	1.4.2.1;
next	1.3;
commitid	dYP2AUE0olKvOCnF;

1.3
date	2015.04.10.12.25.46;	author sthen;	state Exp;
branches;
next	1.2;
commitid	OpFonxHWnqpohYnM;

1.2
date	2014.01.08.10.23.13;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2013.10.04.08.45.21;	author sthen;	state Exp;
branches;
next	;

1.4.2.1
date	2016.11.23.16.44.44;	author sthen;	state Exp;
branches;
next	;
commitid	onxF30BQT91StsiY;


desc
@@


1.4
log
@update to vim-7.4.769, and remove a local patch which was disabling the
newer RE engine, it was previously causing big slowdowns when malloc.conf
'J' was in use, but this seems better now.
@
text
@$OpenBSD: patch-src_option_c,v 1.3 2015/04/10 12:25:46 sthen Exp $

Disable new NFA regexp engine for now, syntax highlighting is unusably
slow if malloc flag 'J' is used.

--- src/option.c.orig	Thu Apr  9 21:08:22 2015
+++ src/option.c	Thu Apr  9 23:41:51 2015
@@@@ -2125,7 +2125,7 @@@@ static struct vimoption
 			    {(char_u *)2000L, (char_u *)0L} SCRIPTID_INIT},
     {"regexpengine", "re",  P_NUM|P_VI_DEF,
 			    (char_u *)&p_re, PV_NONE,
-			    {(char_u *)0L, (char_u *)0L} SCRIPTID_INIT},
+			    {(char_u *)1L, (char_u *)1L} SCRIPTID_INIT},
     {"relativenumber", "rnu", P_BOOL|P_VI_DEF|P_RWIN,
 			    (char_u *)VAR_WIN, PV_RNU,
 			    {(char_u *)FALSE, (char_u *)0L} SCRIPTID_INIT},
@


1.4.2.1
log
@patch 6.0-stable vim for CVE-2016-1248
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 6
From d0b5138ba4bccff8a744c99836041ef6322ed39a Mon Sep 17 00:00:00 2001
From: Bram Moolenaar <Bram@@vim.org>
Date: Fri, 4 Nov 2016 15:23:45 +0100
Subject: [PATCH] patch 8.0.0056 Problem:    When setting 'filetype' there is
 no check for a valid name. Solution:   Only allow valid characters in
 'filetype', 'syntax' and 'keymap'.
d6 11
a16 61
--- src/option.c.orig	Mon Feb 29 22:12:49 2016
+++ src/option.c	Wed Nov 23 16:41:06 2016
@@@@ -5774,6 +5774,21 @@@@ set_string_option(
 }
 
 /*
+ * Return TRUE if "val" is a valid 'filetype' name.
+ * Also used for 'syntax' and 'keymap'.
+ */
+    static int
+valid_filetype(char_u *val)
+{
+    char_u *s;
+
+    for (s = val; *s != NUL; ++s)
+	if (!ASCII_ISALNUM(*s) && vim_strchr((char_u *)".-_", *s) == NULL)
+	    return FALSE;
+    return TRUE;
+}
+
+/*
  * Handle string options that need some action to perform when changed.
  * Returns NULL for success, or an error message for an error.
  */
@@@@ -6186,8 +6201,11 @@@@ did_set_string_option(
 #ifdef FEAT_KEYMAP
     else if (varp == &curbuf->b_p_keymap)
     {
-	/* load or unload key mapping tables */
-	errmsg = keymap_init();
+	if (!valid_filetype(*varp))
+	    errmsg = e_invarg;
+	else
+	    /* load or unload key mapping tables */
+	    errmsg = keymap_init();
 
 	if (errmsg == NULL)
 	{
@@@@ -7158,6 +7176,22 @@@@ did_set_string_option(
     else if (varp == &p_rop && gui.in_use)
     {
 	if (!gui_mch_set_rendering_options(p_rop))
+	    errmsg = e_invarg;
+    }
+#endif
+
+#ifdef FEAT_AUTOCMD
+    else if (gvarp == &p_ft)
+    {
+	if (!valid_filetype(*varp))
+	    errmsg = e_invarg;
+    }
+#endif
+
+#ifdef FEAT_SYN_HL
+    else if (gvarp == &p_syn)
+    {
+	if (!valid_filetype(*varp))
 	    errmsg = e_invarg;
     }
 #endif
@


1.3
log
@update to vim 7.4 692

- remove locally bundled pf.vim, defer to upstream's newer version, patch
from Lauri Tirkkonen
@
text
@d1 1
a1 1
$OpenBSD: patch-src_option_c,v 1.2 2014/01/08 10:23:13 sthen Exp $
@


1.2
log
@update to vim 7.4.135, and remove a patch to configure which is no
longer needed. ok aja@@ rpe@@ also tested by brett@@.

gsoares had a problem with no_x11 but I can't see why and can't
reproduce it, let me know if anyone else sees this.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_option_c,v 1.1 2013/10/04 08:45:21 sthen Exp $
d6 3
a8 3
--- src/option.c.orig	Tue Jan  7 05:09:28 2014
+++ src/option.c	Tue Jan  7 22:14:53 2014
@@@@ -2098,7 +2098,7 @@@@ static struct vimoption
@


1.1
log
@Disable vim's new NFA regexp engine for now, it interacts badly with
malloc flag 'J' (approx 10x slower in syntax highlighting).
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
a8 3
--- src/option.c.orig	Tue Oct  1 08:50:58 2013
+++ src/option.c	Tue Oct  1 09:15:05 2013
@@@@ -2097,7 +2097,7 @@@@ static struct vimoption
@

