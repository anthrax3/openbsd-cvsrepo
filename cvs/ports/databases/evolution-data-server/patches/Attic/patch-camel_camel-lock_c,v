head	1.12;
access;
symbols
	OPENBSD_5_4:1.7.0.4
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.2
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.5.0.4
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.2
	OPENBSD_5_0:1.3.0.2
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.12
date	2013.09.26.14.11.08;	author ajacoutot;	state dead;
branches;
next	1.11;

1.11
date	2013.09.11.14.02.54;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2013.09.11.09.24.56;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2013.08.15.16.07.27;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2013.08.15.14.49.35;	author ajacoutot;	state dead;
branches;
next	1.7;

1.7
date	2012.10.18.13.54.56;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2012.09.28.06.35.36;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2011.12.29.09.23.19;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2011.09.12.07.26.19;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2011.07.03.17.14.24;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2011.04.19.17.01.54;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.09.30.07.32.09;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.12
log
@Update to evolution-data-server-3.10.0.
@
text
@$OpenBSD: patch-camel_camel-lock_c,v 1.11 2013/09/11 14:02:54 ajacoutot Exp $

From fa37efaf26d366a3d0d5256283455a28025ddbde Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <antoine@@mtier.org>
Date: Wed, 11 Sep 2013 13:57:57 +0000
Subject: do not assume time_t is long

--- camel/camel-lock.c.orig	Tue Jul 23 13:57:54 2013
+++ camel/camel-lock.c	Wed Sep 11 10:14:21 2013
@@@@ -128,7 +128,7 @@@@ camel_lock_dot (const gchar *path,
 		/* check for stale lock, kill it */
 		if (g_stat (lock, &st) == 0) {
 			time_t now = time (NULL);
-			(printf ("There is an existing lock %ld seconds old\n", now - st.st_ctime));
+			printf ("There is an existing lock %" G_GINT64_FORMAT "seconds old\n", (gint64) now - (gint64) st.st_ctime);
 			if (st.st_ctime < now - CAMEL_LOCK_DOT_STALE) {
 				d (printf ("Removing it now\n"));
 				unlink (lock);
@


1.11
log
@Committed upstream with some tweaks.
@
text
@d1 1
a1 1
$OpenBSD: patch-camel_camel-lock_c,v 1.10 2013/09/11 09:24:56 ajacoutot Exp $
@


1.10
log
@Fixes for 64-bit time_t. Still a moving target but better than what we
currently have.
@
text
@d1 1
a1 1
$OpenBSD: patch-camel_camel-lock_c,v 1.9 2013/08/15 16:07:27 ajacoutot Exp $
d3 4
a6 1
https://bugzilla.gnome.org/show_bug.cgi?id=707900
d15 1
a15 1
+			(printf ("There is an existing lock %" G_GINT64_FORMAT "seconds old\n", (gint64)now - (gint64)st.st_ctime));
@


1.9
log
@Revert previous on these 3 ports.
kettenis@@ says there is more work involved since we are different from the
others... I have no time to take care of it properly so put back whatever
was there before which seemed to work fine.
@
text
@d1 1
a1 1
$OpenBSD: patch-camel_camel-lock_c,v 1.7 2012/10/18 13:54:56 ajacoutot Exp $
d3 1
a3 1
XXX remove when we have a 64-bit time_t
d5 2
a6 2
--- camel/camel-lock.c.orig	Fri Sep 28 07:55:00 2012
+++ camel/camel-lock.c	Fri Sep 28 07:55:10 2012
d12 1
a12 1
+			(printf ("There is an existing lock %ld seconds old\n", (long)now - st.st_ctime));
@


1.8
log
@Remove these, we have 64-bit time_t now.
@
text
@@


1.7
log
@We are getting fucked by our 32-bits time_t :(
@
text
@d1 1
a1 1
$OpenBSD: patch-camel_camel-lock_c,v 1.6 2012/09/28 06:35:36 ajacoutot Exp $
@


1.6
log
@Update to evolution-data-server-3.6.0.
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
On OpenBSD, time_t is an int.
d12 1
a12 1
+			(printf ("There is an existing lock %d seconds old\n", now - st.st_ctime));
@


1.5
log
@Tweak patches to please our time_t.
@
text
@d1 1
a1 1
$OpenBSD: patch-camel_camel-lock_c,v 1.4 2011/09/12 07:26:19 ajacoutot Exp $
d5 2
a6 2
--- camel/camel-lock.c.orig	Mon Sep 19 07:03:01 2011
+++ camel/camel-lock.c	Thu Dec 29 09:12:01 2011
d11 2
a12 2
-			(printf("There is an existing lock %ld seconds old\n", now-st.st_ctime));
+			(printf("There is an existing lock %d seconds old\n", now-st.st_ctime));
d14 1
a14 1
 				d(printf("Removing it now\n"));
@


1.4
log
@Start the GNOME3 merge armageddon... breakage expected.
@
text
@d1 6
a6 3
$OpenBSD: patch-camel_camel-lock_c,v 1.2 2011/07/03 17:14:24 ajacoutot Exp $
--- camel/camel-lock.c.orig	Thu Sep 16 14:47:54 2010
+++ camel/camel-lock.c	Tue May 17 13:40:32 2011
d12 1
a12 1
+			(printf("There is an existing lock %ld seconds old\n", (long int)now-st.st_ctime));
@


1.3
log
@Fix some warnings.
@
text
@d1 3
a3 3
$OpenBSD: patch-camel_camel-lock_c,v 1.2 2011/04/19 17:01:54 ajacoutot Exp $
--- camel/camel-lock.c.orig	Tue Sep 28 07:46:38 2010
+++ camel/camel-lock.c	Tue Sep 28 07:46:50 2010
d6 1
a6 1
 		if (g_stat(lock, &st) == 0) {
d12 1
a12 1
 				unlink(lock);
@


1.2
log
@Tweaks.
@
text
@d1 1
a1 1
$OpenBSD: patch-camel_camel-lock_c,v 1.1 2010/09/30 07:32:09 ajacoutot Exp $
d9 1
a9 1
+			(printf("There is an existing lock %ld seconds old\n", (long)now-st.st_ctime));
@


1.1
log
@Update to evolution-data-server-2.32.0.

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
d9 1
a9 1
+			(printf("There is an existing lock %d seconds old\n", now-st.st_ctime));
@

