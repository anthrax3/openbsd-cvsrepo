head	1.14;
access;
symbols
	OPENBSD_5_0:1.7.0.2
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.3.0.2
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.14
date	2014.03.27.10.08.21;	author ajacoutot;	state dead;
branches;
next	1.13;

1.13
date	2014.03.09.21.51.21;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2012.10.16.11.55.01;	author ajacoutot;	state dead;
branches;
next	1.11;

1.11
date	2012.10.14.08.04.11;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2012.10.01.15.00.18;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2011.09.21.13.26.03;	author jasper;	state dead;
branches;
next	1.8;

1.8
date	2011.09.12.07.26.19;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2011.04.16.05.51.52;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2011.03.29.11.20.02;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2011.03.23.15.57.39;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2011.03.07.19.35.30;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.09.30.07.32.09;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.04.22.09.17.50;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2009.10.11.12.42.41;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.14
log
@Update to evolution-data-server-3.12.0.
@
text
@$OpenBSD: patch-configure_ac,v 1.13 2014/03/09 21:51:21 ajacoutot Exp $

From 3bb0c0e98965387dfaac8cdc14e7347217e6f68e Mon Sep 17 00:00:00 2001
From: Ryan Lortie <desrt@@desrt.ca>
Date: Tue, 07 Jan 2014 21:10:13 +0000
Subject: Bug 721733 - Tweak Berkeley DB detection logic

From 5d2bbbc215e3892f290d17fcb7eee4d8cacd7ce1 Mon Sep 17 00:00:00 2001
From: Ryan Lortie <desrt@@desrt.ca>
Date: Wed, 08 Jan 2014 17:01:57 +0000
Subject: configure.ac: trivial typo fix in last commit

--- configure.ac.orig	Mon Dec  9 03:41:02 2013
+++ configure.ac	Mon Mar  3 12:44:34 2014
@@@@ -544,10 +544,16 @@@@ dnl ******************************
 AC_ARG_WITH([libdb],
 	AS_HELP_STRING([--with-libdb=PREFIX],
 	[Prefix where libdb is installed]),
-	[libdb_prefix="$withval"], [libdb_prefix='${prefix}'])
-
-DB_CFLAGS="-I$libdb_prefix/include"
-DB_LIBS="-L$libdb_prefix/lib -ldb"
+	[
+		DB_CFLAGS="-I$withval/include"
+		DB_LIBS="-L$withval/lib -ldb"
+	],
+	[
+		if test -z "$DB_CFLAGS" -a -z "$DB_LIBS"; then
+			DB_CFLAGS=""
+			DB_LIBS="-ldb"
+		fi
+	])
 
 AC_MSG_CHECKING([Berkeley DB])
 save_cflags=$CFLAGS; CFLAGS=$DB_CFLAGS
@


1.13
log
@Better way to set DB_LIBS.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.12
log
@Move back to using libgnome-keyring. There is a very nasty crash with it
but at least it'll get us a chance to hunt for it instead of hiding it with
libsecret which fails in the same way but does not crash.

discussed with jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.11 2012/10/14 08:04:11 ajacoutot Exp $
d3 4
a6 4
From af70f1bec73b2c2ff72300cce93ffbd9c4b9d6ad Mon Sep 17 00:00:00 2001
From: Stef Walter <stefw@@gnome.org>
Date: Mon, 16 Jul 2012 13:01:24 +0000
Subject: Bug 679914 - Replace libgnomekeyring with libsecret
d8 25
a32 60
--- configure.ac.orig	Sat Oct 13 21:49:10 2012
+++ configure.ac	Sun Oct 14 09:31:56 2012
@@@@ -36,7 +36,7 @@@@ dnl Required Package Versions
 m4_define([glib_minimum_version], [2.32])
 m4_define([gtk_minimum_version], [3.2])
 m4_define([gcr_minimum_version], [3.4])
-m4_define([gnome_keyring_minimum_version], [2.20.1])
+m4_define([libsecret_minimum_version], [0.5])
 m4_define([libxml_minimum_version], [2.0.0])		dnl XXX Just a Guess
 m4_define([libsoup_minimum_version], [2.38.1])
 m4_define([libgdata_minimum_version], [0.10])
@@@@ -386,11 +386,11 @@@@ dnl ***********************************
 dnl Check for GNOME Keyring.
 dnl ***********************************
 if test x$os_win32 = xno; then
-	PKG_CHECK_MODULES(GNOME_KEYRING,
-		[gnome-keyring-1 >= gnome_keyring_minimum_version])
+	PKG_CHECK_MODULES(LIBSECRET,
+		[libsecret-unstable >= libsecret_minimum_version])
 fi
-AC_SUBST(GNOME_KEYRING_CFLAGS)
-AC_SUBST(GNOME_KEYRING_LIBS)
+AC_SUBST(LIBSECRET_CFLAGS)
+AC_SUBST(LIBSECRET_LIBS)
 
 dnl **********************************************************
 dnl gcr-base is needed for secure password exchange over D-Bus
@@@@ -1286,7 +1286,7 @@@@ PKG_CHECK_MODULES(SQLITE3, [sqlite3 >= sqlite_minimum_
 dnl ******************************
 dnl libedataserver flags
 dnl ******************************
-E_DATA_SERVER_DEPS="gio-2.0 gmodule-2.0 gnome-keyring-1 libxml-2.0 libsoup-2.4 $mozilla_nspr"
+E_DATA_SERVER_DEPS="gio-2.0 gmodule-2.0 libsecret-1 libxml-2.0 libsoup-2.4 $mozilla_nspr"
 
 EVO_SET_COMPILE_FLAGS(E_DATA_SERVER, $E_DATA_SERVER_DEPS, $MANUAL_NSPR_CFLAGS, $MANUAL_NSPR_LIBS)
 AC_SUBST(E_DATA_SERVER_CFLAGS)
@@@@ -1308,7 +1308,7 @@@@ if test "x$enable_maintainer_mode" = "xyes" ; then
 	AC_SUBST(FACTORY_GTK_LIBS)
 fi
 
-E_BACKEND_DEPS="gio-2.0 gmodule-2.0 gnome-keyring-1 libsoup-2.4 libxml-2.0"
+E_BACKEND_DEPS="gio-2.0 gmodule-2.0 libsecret-1 libsoup-2.4 libxml-2.0"
 
 dnl ******************************
 dnl libebackend flags
@@@@ -1320,7 +1320,7 @@@@ AC_SUBST(E_BACKEND_LIBS)
 dnl ******************************
 dnl evolution-addressbook flags
 dnl ******************************
-EVOLUTION_ADDRESSBOOK_DEPS="gio-2.0 libxml-2.0 libsoup-2.4 gnome-keyring-1"
+EVOLUTION_ADDRESSBOOK_DEPS="gio-2.0 libxml-2.0 libsoup-2.4 libsecret-1"
 
 EVO_SET_COMPILE_FLAGS(EVOLUTION_ADDRESSBOOK, $EVOLUTION_ADDRESSBOOK_DEPS)
 AC_SUBST(EVOLUTION_ADDRESSBOOK_CFLAGS)
@@@@ -1329,7 +1329,7 @@@@ AC_SUBST(EVOLUTION_ADDRESSBOOK_LIBS)
 dnl ******************************
 dnl evolution-calendar flags
 dnl ******************************
-EVOLUTION_CALENDAR_DEPS="gio-2.0 libical >= libical_minimum_version libsoup-2.4 libxml-2.0 gnome-keyring-1"
+EVOLUTION_CALENDAR_DEPS="gio-2.0 libical >= libical_minimum_version libsoup-2.4 libxml-2.0 libsecret-1"
d34 2
a35 2
 dnl *****
 dnl libical.pc from libical-0.43 has a bug in it's CFlags.
@


1.11
log
@Bugfix update to evolution-data-server-3.6.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.10 2012/10/01 15:00:18 ajacoutot Exp $
@


1.10
log
@Our binutils from paleolithic age exports private symbols which made
libgnome-keyring and gcr dump cores everywhere because of clashing
symbols. Merge libsecret support from upstream to have e-d-s use that
instead of libgnome-keyring.
@
text
@d1 1
a1 1
$OpenBSD$
d8 2
a9 2
--- configure.ac.orig	Mon Oct  1 14:51:14 2012
+++ configure.ac	Mon Oct  1 14:52:23 2012
d19 1
a19 1
@@@@ -385,11 +385,11 @@@@ dnl ***********************************
d35 1
a35 1
@@@@ -1285,7 +1285,7 @@@@ PKG_CHECK_MODULES(SQLITE3, [sqlite3 >= sqlite_minimum_
d44 1
a44 1
@@@@ -1307,7 +1307,7 @@@@ if test "x$enable_maintainer_mode" = "xyes" ; then
d53 1
a53 1
@@@@ -1319,7 +1319,7 @@@@ AC_SUBST(E_BACKEND_LIBS)
d62 1
a62 1
@@@@ -1328,7 +1328,7 @@@@ AC_SUBST(EVOLUTION_ADDRESSBOOK_LIBS)
@


1.9
log
@- update to 3.1.92
- hardcode (but with XXX) 3.2 for now
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.8 2011/09/12 07:26:19 ajacoutot Exp $
d3 4
a6 4
From 27e8a5713a345fc276deb74daa26e982bd87dec7 Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@@openbsd.org>
Date: Tue, 12 Jul 2011 11:26:39 +0000
Subject: Move the "$host" down when $host is actually set and don't set DL_LIB
d8 63
a70 49
--- configure.ac.orig	Mon May 23 17:06:26 2011
+++ configure.ac	Wed Jul 13 04:17:16 2011
@@@@ -185,15 +185,6 @@@@ AM_CPPFLAGS="$WARNING_FLAGS -fno-strict-aliasing"
 AC_SUBST(AM_CPPFLAGS)
 
 
-case "$host" in
-*openbsd*|*freebsd*)
-	dnl Do not set '-Wl,--no-undefined' on freebsd/openbsd
-	;;
-*)
-	LDFLAGS="$LDFLAGS -Wl,--no-undefined"
-	;;
-esac
-
 dnl ******************************
 dnl Initialize maintainer mode
 dnl ******************************
@@@@ -265,6 +256,16 @@@@ dnl Gtk Doc stuff
 dnl ******************************
 GTK_DOC_CHECK(1.9)
 
+dnl This must appear after AC_CANONICAL_HOST, which defines $host.
+case "$host" in
+*openbsd*|*freebsd*)
+	dnl Do not set '-Wl,--no-undefined' on freebsd/openbsd
+	;;
+*)
+	LDFLAGS="$LDFLAGS -Wl,--no-undefined"
+;;
+esac
+
 dnl ******************************
 dnl Check for Win32
 dnl ******************************
@@@@ -278,6 +279,13 @@@@ case "$host" in
 	LIBEXECDIR_IN_SERVER_FILE='../../../libexec'
 	AC_CACHE_VAL(ac_cv_have_addrinfo, [ac_cv_have_addrinfo=yes])
 	AC_DEFINE(_WIN32_WINNT, 0x501, [To get getaddrinfo etc declarations])
+	;;
+*openbsd*|*freebsd*)
+	os_win32='no'
+	NO_UNDEFINED=''
+	SOCKET_LIBS=''
+	DL_LIB=''
+	LIBEXECDIR_IN_SERVER_FILE="$libexecdir"
 	;;
 *)
 	os_win32='no'
@


1.8
log
@Start the GNOME3 merge armageddon... breakage expected.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.2 2011/07/13 02:17:57 ajacoutot Exp $
@


1.7
log
@Tweak CONFIGURE_ARGS.
Remove some unneeded pieces from patch-configure_ac.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.6 2011/03/29 11:20:02 ajacoutot Exp $
d3 4
a6 1
XXX remove -DGTK_DISABLE_DEPRECATED to fix build with gtk>=2.24
d8 3
a10 26
Bump libgdata dependency to 0.7.0
The minimum dependency in GNOME is now 0.8.0, so we can bump the e-d-s
dependency to 0.7.0 and remove the various #ifdefs. See: bgo#566441
From upstream git: 69b8607f2dd6d399306905e011a6565319190066

--- configure.ac.orig	Mon Dec 27 14:19:33 2010
+++ configure.ac	Fri Apr 15 16:06:57 2011
@@@@ -36,7 +36,7 @@@@ m4_define([glib_minimum_version], [2.25.12])
 m4_define([gconf_minimum_version], [2.0.0])		dnl XXX Just a Guess
 m4_define([libxml_minimum_version], [2.0.0])		dnl XXX Just a Guess
 m4_define([libsoup_minimum_version], [2.3.0])
-m4_define([libgdata_minimum_version], [0.6.3])
+m4_define([libgdata_minimum_version], [0.7.0])
 m4_define([gnome_keyring_minimum_version], [2.20.1])
 m4_define([sqlite_minimum_version], [3.5])
 m4_define([libical_minimum_version], [0.43])
@@@@ -167,7 +167,6 @@@@ AS_COMPILER_FLAGS(WARNING_FLAGS,
 	"-DG_DISABLE_DEPRECATED
 	-DPANGO_DISABLE_DEPRECATED
 	-DGDK_PIXBUF_DISABLE_DEPRECATED
-	-DGTK_DISABLE_DEPRECATED
 	-DG_DISABLE_SINGLE_INCLUDES
 	-DGTK_DISABLE_SINGLE_INCLUDES
 	-DGSEAL_ENABLE
@@@@ -199,8 +198,6 @@@@ dnl	-Wstrict-aliasing=2
 AM_CPPFLAGS="$WARNING_FLAGS -fno-strict-aliasing"
d13 9
a21 1
-LDFLAGS="$LDFLAGS -Wl,--no-undefined"
d26 19
a44 1
@@@@ -285,6 +282,13 @@@@ case "$host" in
d47 2
a48 2
 	;;
+*openbsd*)
d54 1
a54 1
+	;;
a56 14
 	NO_UNDEFINED=''
@@@@ -324,12 +328,6 @@@@ PKG_CHECK_MODULES(GNOME_PLATFORM,
 	libxml-2.0 >= libxml_minimum_version
 	libsoup-2.4 >= libsoup_minimum_version
 	libgdata >= libgdata_minimum_version])
-
-dnl libgdata 0.7 will break API.  We're not going to deal with
-dnl that on a stable branch, so cap the supported version.
-if $PKG_CONFIG --atleast-version=0.7 libgdata; then
-	AC_MSG_ERROR([libgdata 0.7 is not supported, use 0.6 instead])
-fi
 
 LIBICAL_REQUIRED=libical_minimum_version
 AC_SUBST(LIBICAL_REQUIRED)
@


1.6
log
@Tweak some patches and remove -DGTK_DISABLE_DEPRECATED to fix a crash in
evolution calendar.
@
text
@d1 1
a1 4
$OpenBSD: patch-configure_ac,v 1.5 2011/03/23 15:57:39 jasper Exp $

Stupid configure is stupid. Using a variable that's set
hundreds of lines later...
d11 1
a11 1
+++ configure.ac	Tue Mar 29 12:01:28 2011
d52 2
a53 1
@@@@ -325,12 +329,6 @@@@ PKG_CHECK_MODULES(GNOME_PLATFORM,
d56 1
a56 1
 
d62 1
a62 1
-
a64 31
 
@@@@ -518,6 +516,29 @@@@ AC_RUN_IFELSE([AC_LANG_SOURCE(
 	]]
 	)],[AC_DEFINE(HAVE_LKSTRFTIME, 1, [strftime supports use of l and k]) ac_cv_lkstrftime=yes],[ac_cv_lkstrftime=no],[ac_cv_lkstrftime=no])
 AC_MSG_RESULT([$ac_cv_lkstrftime])
+
+dnl ******************************
+dnl Posix thread support
+dnl ******************************
+
+dnl GLIB_CONFIG=${GLIB_CONFIG-glib-config}
+dnl GNOME_PTHREAD_CHECK
+
+dnl if test "x$PTHREAD_LIB" = "x" ; then
+dnl 	AC_MSG_ERROR([POSIX threads are currently required for Evolution])
+dnl fi
+
+dnl Notice that this is a hack, and we wont be able to use this forever, but
+dnl at least for some time
+
+EVO_PTHREAD_CHECK
+
+THREADS_LIBS="$PTHREAD_LIB"
+THREADS_CFLAGS="$PTHREAD_CFLAGS"
+
+AC_SUBST(THREADS_LIBS)
+AC_SUBST(THREADS_CFLAGS)
+AC_DEFINE(ENABLE_THREADS,1,[Required])
 
 dnl ********************************************************************************
 dnl security extension support (SSL and S/MIME)
@


1.5
log
@- backport various fixes from upstream git to allow this to build against
new libgdata.

ok aja@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.4 2011/03/07 19:35:30 ajacoutot Exp $
d6 2
d14 1
a14 1
+++ configure.ac	Wed Mar 23 14:58:36 2011
d24 9
a32 1
@@@@ -199,8 +199,6 @@@@ dnl	-Wstrict-aliasing=2
d41 1
a41 1
@@@@ -285,6 +283,13 @@@@ case "$host" in
d55 1
a55 1
@@@@ -325,12 +330,6 @@@@ PKG_CHECK_MODULES(GNOME_PLATFORM,
d68 1
a68 1
@@@@ -518,6 +517,29 @@@@ AC_RUN_IFELSE([AC_LANG_SOURCE(
@


1.4
log
@Maintenance update to evolution-data-server-2.32.2.
Unbreak with new gtk+2.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.3 2010/09/30 07:32:09 ajacoutot Exp $
d6 16
a21 2
--- configure.ac.orig	Fri Oct 29 12:22:59 2010
+++ configure.ac	Mon Jan 31 17:49:33 2011
d45 14
a58 1
@@@@ -518,6 +523,29 @@@@ AC_RUN_IFELSE([AC_LANG_SOURCE(
@


1.3
log
@Update to evolution-data-server-2.32.0.

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.2 2010/04/22 09:17:50 ajacoutot Exp $
d6 2
a7 2
--- configure.ac.orig	Mon Sep 27 12:25:46 2010
+++ configure.ac	Mon Sep 27 19:11:45 2010
d31 1
a31 1
@@@@ -512,6 +517,29 @@@@ AC_RUN_IFELSE([AC_LANG_SOURCE(
@


1.2
log
@Major update to evolution-data-server-2.30.0.
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
a8 3
--- configure.ac.orig	Wed Mar 17 12:17:31 2010
+++ configure.ac	Thu Apr 22 09:54:50 2010
@@@@ -181,8 +181,6 @@@@ dnl XXX This really belongs in AM_CFLAGS.
d17 1
a17 1
@@@@ -256,6 +254,13 @@@@ case "$host" in
d31 2
a32 1
@@@@ -483,6 +488,29 @@@@ AC_RUN_IFELSE([AC_LANG_SOURCE(
d35 1
a35 1
 
d58 1
a58 1
+
a60 31
 dnl
@@@@ -1144,29 +1172,6 @@@@ AM_PATH_GLIB_2_0
 dnl We use AC_SUBST_FILE because AC_SUBST won't deal with newlines
 EVO_MARSHAL_RULE=$srcdir/marshal.mk
 AC_SUBST_FILE(EVO_MARSHAL_RULE)
-
-dnl ******************************
-dnl Posix thread support
-dnl ******************************
-
-dnl GLIB_CONFIG=${GLIB_CONFIG-glib-config}
-dnl GNOME_PTHREAD_CHECK
-
-dnl if test "x$PTHREAD_LIB" = "x" ; then
-dnl 	AC_MSG_ERROR([POSIX threads are currently required for Evolution])
-dnl fi
-
-dnl Notice that this is a hack, and we wont be able to use this forever, but
-dnl at least for some time
-
-EVO_PTHREAD_CHECK
-
-THREADS_LIBS="$PTHREAD_LIB"
-THREADS_CFLAGS="$PTHREAD_CFLAGS"
-
-AC_SUBST(THREADS_LIBS)
-AC_SUBST(THREADS_CFLAGS)
-AC_DEFINE(ENABLE_THREADS,1,[Required])
 
 dnl ******************************
 dnl DBus stuff
@


1.1
log
@- update evolution-data-server to 2.28.0

commiting now to not stall other work, possible breakage will be dealt with thisweek

"commit!" aja@@
@
text
@d2 9
a10 4
--- configure.ac.orig	Sat Oct 10 18:40:55 2009
+++ configure.ac	Sat Oct 10 18:41:04 2009
@@@@ -1125,7 +1125,7 @@@@ if test "x${with_krb5}" != "xno"; then
 	LIBS_save="$LIBS"
d12 79
a90 6
 	mitlibs="-lkrb5 -lk5crypto -lcom_err -lgssapi_krb5"
-	heimlibs="-lkrb5 -lcrypto -lasn1 -lcom_err -lroken -lgssapi"
+	heimlibs="-lkrb5 -lcrypto -lasn1 -lcom_err -lgssapi"
 	sunlibs="-lkrb5 -lgss"
 	AC_CACHE_CHECK([for Kerberos 5], [ac_cv_lib_kerberos5],
 	[
@

