head	1.23;
access;
symbols
	OPENBSD_6_1:1.23.0.2
	OPENBSD_6_1_BASE:1.23
	OPENBSD_6_0:1.22.0.2
	OPENBSD_6_0_BASE:1.22
	OPENBSD_5_9:1.18.0.2
	OPENBSD_5_9_BASE:1.18
	OPENBSD_5_8:1.18.0.4
	OPENBSD_5_8_BASE:1.18
	OPENBSD_5_7:1.17.0.2
	OPENBSD_5_7_BASE:1.17
	OPENBSD_5_6:1.14.0.2
	OPENBSD_5_6_BASE:1.14
	OPENBSD_5_5:1.13.0.2
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.10.0.2
	OPENBSD_5_4_BASE:1.10
	OPENBSD_5_3:1.9.0.2
	OPENBSD_5_3_BASE:1.9
	OPENBSD_5_2:1.8.0.2
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.2
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	fgsch_20110602:1.1.1.1
	fgsch:1.1.1;
locks; strict;
comment	@# @;


1.23
date	2016.09.20.15.44.57;	author sthen;	state Exp;
branches;
next	1.22;
commitid	2N9EBS7wFGxRKSX6;

1.22
date	2016.06.20.09.07.43;	author sthen;	state Exp;
branches;
next	1.21;
commitid	azDWVbSn9Jsx8VUl;

1.21
date	2016.05.28.21.16.04;	author sthen;	state Exp;
branches;
next	1.20;
commitid	X2O2Ed5VZbbQfzmG;

1.20
date	2016.05.10.08.57.06;	author sthen;	state Exp;
branches;
next	1.19;
commitid	0OPTx4FLdvshosOT;

1.19
date	2016.05.06.15.33.37;	author sthen;	state Exp;
branches;
next	1.18;
commitid	5e1KALTAPXjZQxNY;

1.18
date	2015.05.18.11.29.37;	author jasper;	state Exp;
branches;
next	1.17;
commitid	g3eYBWefuCrWTDW1;

1.17
date	2014.12.10.19.59.29;	author dcoppa;	state Exp;
branches;
next	1.16;
commitid	aPcYIQCi12I5bhbB;

1.16
date	2014.10.22.20.11.27;	author kirby;	state Exp;
branches;
next	1.15;
commitid	fjimwFMAbaZ6n5rV;

1.15
date	2014.09.16.17.28.07;	author jasper;	state Exp;
branches;
next	1.14;
commitid	xftZua1X95nEUSek;

1.14
date	2014.06.22.13.20.31;	author sthen;	state Exp;
branches;
next	1.13;
commitid	Tkk2tFOpyVuxNFMD;

1.13
date	2014.02.01.16.41.25;	author sthen;	state Exp;
branches;
next	1.12;

1.12
date	2014.01.31.00.28.56;	author sthen;	state Exp;
branches;
next	1.11;

1.11
date	2013.12.10.17.30.40;	author joshe;	state Exp;
branches;
next	1.10;

1.10
date	2013.03.11.02.52.05;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2013.01.14.10.47.45;	author brad;	state Exp;
branches;
next	1.8;

1.8
date	2012.04.08.17.21.49;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2012.02.16.21.22.42;	author landry;	state Exp;
branches;
next	1.6;

1.6
date	2011.11.14.10.52.28;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2011.11.13.03.55.30;	author fgsch;	state Exp;
branches;
next	1.4;

1.4
date	2011.10.22.18.10.32;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2011.10.03.16.38.21;	author fgsch;	state Exp;
branches;
next	1.2;

1.2
date	2011.07.18.19.56.18;	author fgsch;	state Exp;
branches;
next	1.1;

1.1
date	2011.06.02.00.26.32;	author fgsch;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.06.02.00.26.32;	author fgsch;	state Exp;
branches;
next	;


desc
@@


1.23
log
@add USE_WXNEEDED to unbreak server
@
text
@# $OpenBSD: Makefile,v 1.22 2016/06/20 09:07:43 sthen Exp $

PORTROACH =	limitw:1,even
USE_WXNEEDED =	Yes

# The default storage engine (WiredTiger) only works on amd64.
ONLY_FOR_ARCHS = amd64
DPB_PROPERTIES = parallel

COMMENT =	scalable, high-performance document-oriented database

DISTNAME =	mongodb-src-r3.2.7
REVISION =	0
PKGNAME =	${DISTNAME:S/src-r//}
CATEGORIES =	databases

HOMEPAGE =	https://www.mongodb.com/

# mongodb itself: AGPLv3
# client/utils:   Apache 2.0
PERMIT_PACKAGE_CDROM =	Yes

WANTLIB += boost_chrono-mt boost_filesystem-mt boost_program_options-mt
WANTLIB += boost_regex-mt boost_system-mt boost_thread-mt c crypto
WANTLIB += execinfo kvm m pcap pcre pcrecpp pthread ssl yaml-cpp
WANTLIB += z

MASTER_SITES =	https://fastdl.mongodb.org/src/

MODULES =	gcc4 \
		devel/scons \
		lang/python

# XXX should come from scons module, but broken when gcc module also used:
NO_CCACHE =	Yes

MODGCC4_ARCHS =	*
MODGCC4_LANGS =	c c++
MODPY_VERSION =	${MODPY_DEFAULT_VERSION_2}
ALL_TARGET =	core tools
MODSCONS_ENV =	CC="${CC}" \
		CXX="${CXX}" \
		CCFLAGS="${CFLAGS} -DBOOST_NO_USER_CONFIG" \
		CXXFLAGS="${CXXFLAGS}" \
		LINKFLAGS="${LDFLAGS}" \
		CPPPATH="${LOCALBASE}/include" \
		LIBPATH="${LOCALBASE}/lib"
MODSCONS_FLAGS += --prefix="${PREFIX}" \
		  --opt=on \
		  --ssl=SSL \
		  --allocator=system \
		  --use-system-boost \
		  --use-system-pcre \
		  --use-system-yaml \
		  --use-system-zlib \
		  -j${MAKE_JOBS}

ALL_TARGET =	core tools
LIB_DEPENDS =	devel/libexecinfo \
		devel/boost \
		devel/pcre \
		devel/yaml-cpp
TEST_DEPENDS =	textproc/py-yaml \
		databases/py-mongo
# icu4c support is not actually compiled in, but scons picks up the
# headers and patching this away is intrusive
BUILD_DEPENDS =	textproc/icu4c

do-install:
	for bin in mongo mongod mongos mongosniff mongobridge mongoperf; do \
		${INSTALL_PROGRAM} ${WRKSRC}/$$bin ${PREFIX}/bin/; \
	done
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/mongodb
	${INSTALL_DATA} ${FILESDIR}/mongodb.conf \
	    ${PREFIX}/share/examples/mongodb

do-test:
	@@${SETENV} ${MAKE_ENV} ${MODSCONS_BIN} -C ${WRKSRC} \
	    ${MODSCONS_ENV} ${MODSCONS_FLAGS} unittests
	cd ${WRKSRC} && ${MODPY_BIN} buildscripts/resmoke.py --suites=unittests

.include <bsd.port.mk>
@


1.22
log
@update to mongodb-3.2.7, from Andrew Aldridge
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2016/05/28 21:16:04 sthen Exp $
d4 1
d13 1
@


1.21
log
@Use INSTALL_PROGRAM so that mongodb binaries are stripped as appropriate,
and enable SSL support. From Andrew Aldridge plus small tweak from me.
Packages are now ~50MB instead of ~650MB as they were recently.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2016/05/10 08:57:06 sthen Exp $
d11 1
a11 2
DISTNAME =	mongodb-src-r3.2.6
REVISION =	0
d15 1
a15 1
HOMEPAGE =	http://www.mongodb.org/
d26 1
a26 1
MASTER_SITES =	http://downloads.mongodb.org/src/
@


1.20
log
@Add a BDEP on icu4c; it's not actually compiled in but scons adds
dependencies on the headers and patching this away would be intrusive.
Problem found by naddy, diff from Andrew Aldridge, plus I added a comment.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2016/05/06 15:33:37 sthen Exp $
d12 1
d23 3
a25 2
WANTLIB += boost_regex-mt boost_system-mt boost_thread-mt c execinfo
WANTLIB += kvm m pcap pcre pcrecpp pthread yaml-cpp z
d49 1
d69 3
a71 4
	${SETENV} ${MAKE_ENV} ${MODSCONS_BIN} -C ${WRKSRC} \
		${MODSCONS_ENV} ${MODSCONS_FLAGS} ${INSTALL_TARGET}

post-install:
@


1.19
log
@update to MongoDB 3.2.6, from Andrew Aldridge, minor tweaks from me
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2015/05/18 11:29:37 jasper Exp $
d61 3
@


1.18
log
@remove another bunch of @@rm -f, some of which were hiding the arguments no
longer existed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2014/12/10 19:59:29 dcoppa Exp $
d5 3
a7 2
#atomic_int.h: error "unsupported compiler or platform" on other archs
ONLY_FOR_ARCHS =	i386 amd64
d11 1
a11 1
DISTNAME =	mongodb-src-r2.6.4
a12 1
REVISION =	0
d17 2
a18 1
# Apache 2.0 + AGPLv3
d21 3
a23 3
WANTLIB =	boost_filesystem-mt boost_program_options-mt boost_system-mt \
		boost_thread-mt c execinfo m pcap pcre pcrecpp pthread \
		stdc++ v8 yaml-cpp
d27 30
a56 18
MODULES =	devel/scons
MODSCONS_FLAGS = --prefix="${PREFIX}" \
		 --cpppath="${LOCALBASE}/include/nspr" \
		 --extralib="pcrecpp" \
		 --usev8 \
		 --sharedclient \
		 --full \
		 --use-system-pcre \
		 --use-system-boost \
		 --use-system-v8 \
		 --use-system-yaml

MAKE_ENV +=	HOME="${HOME}" \
		TERM="${TERM}" \
		CXXFLAGS="$(CXXFLAGS)" \
		LIBmongoclient_VERSION="${LIBmongoclient_VERSION}"
LIB_DEPENDS =	devel/boost \
		devel/libexecinfo \
d58 7
a64 2
		devel/yaml-cpp \
		lang/libv8
a70 1
# Regression tests require at least 256 file descriptors and ~700MB
d73 2
a74 2
	    ${MODSCONS_ENV} ${MODSCONS_FLAGS} test && \
	    ${WRKSRC}/test --dbpath ${WRKSRC}/unittest
@


1.17
log
@
Switch mongodb to use devel/yaml-cpp instead of the bundled one.

With a fix from upstream:
https://github.com/mongodb/mongo/commit/44b0e3591839525a0c951319540488814e5c25fd

This should unbreak bulk builds.

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2014/10/22 20:11:27 kirby Exp $
a46 3

pre-configure:
	rm -f ${WRKSRC}/third_party/{pcre,sm}.py
@


1.16
log
@add PORTROACH annotation to restrict to stable 2.6.X branch
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2014/09/16 17:28:07 jasper Exp $
d12 1
a12 1

d22 1
a22 1
		stdc++ v8
d35 2
a36 1
		 --use-system-v8
d45 1
@


1.15
log
@- update to mongodb-2.6.4

based on an earlier diff by sthen@@, and ok sthen@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.14 2014/06/22 13:20:31 sthen Exp $
@


1.14
log
@update to mongod 2.4.10
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2014/02/01 16:41:25 sthen Exp $
d8 1
a8 1
DISTNAME =	mongodb-src-r2.4.10
a9 2

SHARED_LIBS =	mongoclient	2.0
@


1.13
log
@update to mongodb 2.4.9, suggested by gsoares@@, has some crash fixes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2014/01/31 00:28:56 sthen Exp $
d8 1
a8 1
DISTNAME =	mongodb-src-r2.4.9
@


1.12
log
@Re-enable mongodb. Regress tests bomb out part-way with an assertion (noted
in DESCR with a suggestion that users check carefully for themselves) but it
works well enough for afresh1 and myself to run the UniFi controller software
and for bmercer. At the very least the BROKEN text isn't accurate any more
for this version. Roll PFRAG.shared into PLIST while there.

OK gsoares (who suggests updating to 2.4.9 which I haven't done here but
might try later).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2013/12/10 17:30:40 joshe Exp $
d8 1
a8 1
DISTNAME =	mongodb-src-r2.4.7
a9 1
REVISION =	0
@


1.11
log
@Update mongodb to 2.4.7. Still BROKEN, but a bit closer to working.

This also switches the javascript backend from spidermonkey to v8, as
support for the former has already been removed in the mongodb repo.

"since it's broken go ahead and commit that" fgsch@@
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.10 2013/03/11 02:52:05 espie Exp $

BROKEN =	broken after rthreads switch
d10 1
@


1.10
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2013/01/14 10:47:45 brad Exp $
d10 1
a10 1
DISTNAME =	mongodb-src-r2.0.1
a11 1
REVISION =	0
d13 1
a13 1
SHARED_LIBS =	mongoclient	1.0
d23 2
a24 2
		boost_thread-mt c execinfo mozjs m pcap pcre pcrecpp pthread \
		stdc++
d31 2
a32 2
		 --extralib="mozjs,pcrecpp" \
		 --usesm \
d34 4
a37 1
		 --full 
d41 1
a41 1
		CXXFLAGS="$(CXXFLAGS) -DXULRUNNER -I${LOCALBASE}/include/js" \
d46 1
a46 1
		lang/spidermonkey
@


1.9
log
@Mark BROKEN after the switch to rthreads.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2012/04/08 17:21:49 ajacoutot Exp $
a21 3
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM = Yes
PERMIT_DISTFILES_FTP =	Yes
d55 1
a55 1
do-regress:
@


1.8
log
@Bump after spidermonkey ports change.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.7 2012/02/16 21:22:42 landry Exp $
@


1.7
log
@It's pointless to add BROKEN-* on each and every arch when the code has
an explicit #if (defined(__i386__) || defined(__x86_64__)) #else #error.
Mark as ONLY_FOR_ARCHS accordingly.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2011/11/14 10:52:28 sthen Exp $
d10 1
@


1.6
log
@BROKEN on sparc64
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2011/11/13 03:55:30 fgsch Exp $
d3 2
a4 2
BROKEN-powerpc =atomic_int.h: error "unsupported compiler or platform"
BROKEN-sparc64 =atomic_int.h: error "unsupported compiler or platform"
@


1.5
log
@Update to 2.0.1
ajacoutot@@ benoit@@ dcoppa@@ ok
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2011/10/22 18:10:32 ajacoutot Exp $
d4 1
@


1.4
log
@BROKEN on powerpc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2011/10/03 16:38:21 fgsch Exp $
d7 1
a7 1
DISTNAME =	mongodb-src-r2.0.0
@


1.3
log
@Update to MongoDB 2.0.0.
benoit@@ rpointel@@ ok.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.2 2011/07/18 19:56:18 fgsch Exp $
@


1.2
log
@Update to mongodb 1.8.2.
martynas@@ ok.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2011/06/02 00:26:32 fgsch Exp $
d5 1
a5 1
DISTNAME =	mongodb-src-r1.8.2
d8 1
a8 1
SHARED_LIBS =	mongoclient	0.0
d22 1
a22 1
		readline stdc++ termcap
d29 1
d36 1
a36 1
		CXXFLAGS="$(CXXFLAGS) -DXULRUNNER" \
d42 3
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d5 1
a5 1
DISTNAME =	mongodb-src-r1.8.1
@


1.1.1.1
log
@Import mongodb, a scalable, high-performance, open source, document-oriented
database.
with input from dcoppa and martynas, martynas ok some time ago.
@
text
@@
