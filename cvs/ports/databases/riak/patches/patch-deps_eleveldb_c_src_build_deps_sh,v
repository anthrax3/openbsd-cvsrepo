head	1.3;
access;
symbols
	OPENBSD_6_0:1.3.0.2
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.2.0.4
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.6
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.1.0.4
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.2
	OPENBSD_5_5_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2016.05.13.04.29.58;	author jmatthew;	state Exp;
branches;
next	1.2;
commitid	P0v9TDe3jJVZCynU;

1.2
date	2015.01.16.04.42.13;	author jmatthew;	state Exp;
branches;
next	1.1;
commitid	Bl0w9tdPdocxO4wA;

1.1
date	2013.11.01.12.37.46;	author jmatthew;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to riak 2.1.4 and switch to erlang 17.
jasper@@ kindly checked the erlang version bits.
@
text
@$OpenBSD: patch-deps_eleveldb_c_src_build_deps_sh,v 1.2 2015/01/16 04:42:13 jmatthew Exp $

Don't try to install libsnappy.  Instead, find the headers in the source
tree and get the static library from where it's built.

--- deps/eleveldb/c_src/build_deps.sh.orig	Wed Apr 13 00:46:02 2016
+++ deps/eleveldb/c_src/build_deps.sh	Wed May 11 11:38:36 2016
@@@@ -71,13 +71,13 @@@@ case "$1" in
         fi
 
         if [ ! -f system/lib/libsnappy.a ]; then
-            (cd snappy-$SNAPPY_VSN && $MAKE && $MAKE install)
+            (cd snappy-$SNAPPY_VSN && $MAKE)
         fi
 
-        export CFLAGS="$CFLAGS -I $BASEDIR/system/include"
-        export CXXFLAGS="$CXXFLAGS -I $BASEDIR/system/include"
-        export LDFLAGS="$LDFLAGS -L$BASEDIR/system/lib"
-        export LD_LIBRARY_PATH="$BASEDIR/system/lib:$LD_LIBRARY_PATH"
+        export CFLAGS="$CFLAGS -I $BASEDIR/snappy-$SNAPPY_VSN"
+        export CXXFLAGS="$CXXFLAGS -I $BASEDIR/snappy-$SNAPPY_VSN"
+        export LDFLAGS="$LDFLAGS -L$BASEDIR/snappy-$SNAPPY_VSN/.libs"
+        export LD_LIBRARY_PATH="$BASEDIR/snappy-$SNAPPY_VSN/.libs:$LD_LIBRARY_PATH"
         export LEVELDB_VSN="$LEVELDB_VSN"
 
         if [ ! -d leveldb ]; then
@


1.2
log
@update to riak 2.0.4, no longer marked broken.
yokozuna (solr-based search) is disabled for now.
@
text
@d1 1
a1 1
$OpenBSD: patch-deps_eleveldb_c_src_build_deps_sh,v 1.1 2013/11/01 12:37:46 jmatthew Exp $
d6 3
a8 4
--- deps/eleveldb/c_src/build_deps.sh.orig	Sat May 31 02:22:55 2014
+++ deps/eleveldb/c_src/build_deps.sh	Tue Jun 10 19:58:57 2014
@@@@ -65,12 +65,12 @@@@ case "$1" in
             (cd snappy-$SNAPPY_VSN && ./configure --prefix=$BASEDIR/system --libdir=$BASEDIR/system/lib --with-pic)
d11 4
a14 2
-        (cd snappy-$SNAPPY_VSN && $MAKE && $MAKE install)
+        (cd snappy-$SNAPPY_VSN && $MAKE)
d24 1
a26 1
             git clone git://github.com/basho/leveldb
@


1.1
log
@Instead of running make install for snappy, get the headers and static
library from its source tree. Should make it possible for dpb to build this.
@
text
@d1 1
a1 1
$OpenBSD$
d6 4
a9 4
--- deps/eleveldb/c_src/build_deps.sh.orig	Fri Aug 30 07:03:04 2013
+++ deps/eleveldb/c_src/build_deps.sh	Tue Oct 29 07:18:53 2013
@@@@ -65,12 +65,12 @@@@
             (cd snappy-$SNAPPY_VSN && ./configure --prefix=$BASEDIR/system --with-pic)
@

