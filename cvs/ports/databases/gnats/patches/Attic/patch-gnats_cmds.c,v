head	1.5;
access;
symbols
	OPENBSD_4_9:1.4.0.14
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.12
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.10
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.8
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.6
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.4
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.2
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.3.0.18
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.16
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.14
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.12
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.10
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.8
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.6
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.4
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.3.0.2
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.2.0.4
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.2
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.1.1.1.0.6
	OPENBSD_3_1_BASE:1.1.1.1
	OPENBSD_3_0:1.1.1.1.0.4
	OPENBSD_3_0_BASE:1.1.1.1
	OPENBSD_2_9_TRACKING_SWITCH:1.1.1.1
	OPENBSD_2_9:1.1.1.1.0.2
	OPENBSD_2_9_BASE:1.1.1.1
	dugsong_2000-Jan-12:1.1.1.1
	dugsong:1.1.1;
locks; strict;
comment	@ * @;


1.5
date	2011.07.08.11.32.17;	author jasper;	state dead;
branches;
next	1.4;

1.4
date	2007.12.28.17.11.25;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2003.08.25.23.33.56;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2002.05.09.16.16.02;	author millert;	state Exp;
branches
	1.2.2.1
	1.2.4.1;
next	1.1;

1.1
date	2001.01.12.17.14.51;	author dugsong;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.01.12.17.14.51;	author dugsong;	state Exp;
branches;
next	;

1.2.2.1
date	2003.08.26.01.03.22;	author brad;	state Exp;
branches;
next	;

1.2.4.1
date	2003.08.26.00.33.35;	author brad;	state Exp;
branches;
next	;


desc
@@


1.5
log
@- fix patch names, no binary change
@
text
@$OpenBSD: patch-gnats_cmds.c,v 1.4 2007/12/28 17:11:25 espie Exp $
--- gnats/cmds.c.orig	Sun Feb  4 21:56:10 2001
+++ gnats/cmds.c	Fri Dec 28 18:00:24 2007
@@@@ -115,28 +115,26 @@@@ get_text ()
 {
   register FILE *tf;
   char *path = (char *) xmalloc (PATH_MAX);
-#ifndef HAVE_MKTEMP
-  char name[L_tmpnam];
-#endif
   char *buf, *tmpdir;
   MsgType r;
-  int i;
+  int i, fd;
 
   tmpdir = getenv ("TMPDIR");
   if (tmpdir == NULL)
     tmpdir = "/tmp"; /* XXX */
-#ifdef HAVE_MKTEMP
-  sprintf (path, "%s/gnatsXXXXXX", tmpdir);
-  mktemp (path);
-#else
-  tmpnam (name);
-  strcpy (path, name);
-#endif
-
-  if ((tf = fopen (path, "w")) == (FILE *) NULL)
+  
+  snprintf (path, PATH_MAX, "%s/gnatsXXXXXX", tmpdir);
+  if ((fd = mkstemp (path)) < 0)
     {
+      xfree(path); 
+      return (NULL);
+    }
+  
+  if ((tf = fdopen (fd, "w")) == (FILE *) NULL)
+    {
       /* give error that we can't create the temp and leave. */
-      xfree (path);
+      close(fd);
+      xfree(path);
       return NULL;
     }
 
@@@@ -228,8 +226,8 @@@@ do_query (ac, av)
           p = av[i];
           if ((n = (char *) strchr (p, '/')) != NULL) /* Remove the category */
                p = ++n;
-          strcpy (pat, p);
-          strcat (pat, "\\'");
+          strlcpy (pat, p, sizeof(pat));
+          strlcat (pat, "\\'", sizeof(pat));
           for (j = index_chain ; j ; j = j->next)
        	    if (regcmp (pat, j->number) == 0)
               {
@@@@ -352,12 +350,13 @@@@ GNATS_lock (ac, av)
       /* XXX FIXME -- we need a cleaner approach to this.  */
       for (i = 2, len = 0; i < ac; i++)
 	len += strlen (av[i]);
-      l = (char *) xmalloc (sizeof (char) * len + ac - 2);
-      sprintf (l, "%s", av[2]);
+      len += ac - 2;
+      l = (char *) xmalloc (len);
+      snprintf (l, len, "%s", av[2]);
       for (i = 3; i < ac; i++)
 	{
-	  strcat (l, " ");
-	  strcat (l, av[i]);
+	  strlcat (l, " ", len);
+	  strlcat (l, av[i], len);
 	}
     }
 
@@@@ -461,7 +460,7 @@@@ GNATS_user (ac, av)
     }
   
   path = (char *) xmalloc (PATH_MAX);
-  sprintf (path, "%s/gnats-adm/%s", gnats_root, DB_ACCESS_FILE);
+  snprintf (path, PATH_MAX, "%s/gnats-adm/%s", gnats_root, DB_ACCESS_FILE);
   access = get_user_access (gnats_root, path, av[0], av[1]);
   xfree (path);
 
@@@@ -1531,8 +1530,8 @@@@ GNATS_auth (ac, av)
 	  return;
 	}
 
-      strcpy (keyfile, gnats_root);
-      strcat (keyfile, "/gnats-adm/srvtab");
+      strlcpy (keyfile, gnats_root, sizeof(keyfile));
+      strlcat (keyfile, "/gnats-adm/srvtab", sizeof(keyfile));
       /* Sanity-check installation.  */
       {
 	struct stat statbuf;
@@@@ -1601,7 +1600,7 @@@@ GNATS_auth (ac, av)
       p += 8;
       k.ticket.length = strlen (p) / 2;
       fromhex (k.ticket.dat, p, k.ticket.length);
-      strcpy (instance, "*");
+      strlcpy (instance, "*", sizeof(instance));
       status = krb_rd_req (&k.ticket, GNATS_KRB4_PRINCIPAL_NAME, instance,
 			   peer.sin_addr.s_addr, &k.auth, keyfile);
       if (status != KSUCCESS)
@


1.4
log
@regen with a more recent diff.
Remove extra bogus target that breaks in parallel mode.
@
text
@d1 1
a1 1
$OpenBSD: patch-gnats_cmds.c,v 1.3 2003/08/25 23:33:56 brad Exp $
@


1.3
log
@Fix some security issues with gnats.

Some additional fixes from millert@@
sprintf -> snprintf
str{cat,cpy} -> strl{cat,cpy}

http://marc.theaimsgroup.com/?l=bugtraq&m=105638591907836&w=2

ok naddy@@
@
text
@d1 3
a3 3
$OpenBSD: patch-gnats_cmds.c,v 1.2 2002/05/09 16:16:02 millert Exp $
--- gnats/cmds.c.orig	Sun Feb  4 13:56:10 2001
+++ gnats/cmds.c	Wed Jul  2 13:23:13 2003
d31 1
a31 1
+    {
d37 1
a37 1
     {
@


1.2
log
@Update to gnats-3.113.1 and add OpenBSD tags on the patchs; dugsong@@ OK
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
+++ gnats/cmds.c	Wed May  8 22:08:48 2002
d45 58
@


1.2.2.1
log
@MFC:
Fix some security issues with gnats.

Some additional fixes from millert@@
sprintf -> snprintf
str{cat,cpy} -> strl{cat,cpy}

http://marc.theaimsgroup.com/?l=bugtraq&m=105638591907836&w=2
@
text
@d1 1
a1 1
$OpenBSD: patch-gnats_cmds.c,v 1.3 2003/08/25 23:33:56 brad Exp $
d3 1
a3 1
+++ gnats/cmds.c	Wed Jul  2 13:23:13 2003
a44 58
@@@@ -228,8 +226,8 @@@@ do_query (ac, av)
           p = av[i];
           if ((n = (char *) strchr (p, '/')) != NULL) /* Remove the category */
                p = ++n;
-          strcpy (pat, p);
-          strcat (pat, "\\'");
+          strlcpy (pat, p, sizeof(pat));
+          strlcat (pat, "\\'", sizeof(pat));
           for (j = index_chain ; j ; j = j->next)
        	    if (regcmp (pat, j->number) == 0)
               {
@@@@ -352,12 +350,13 @@@@ GNATS_lock (ac, av)
       /* XXX FIXME -- we need a cleaner approach to this.  */
       for (i = 2, len = 0; i < ac; i++)
 	len += strlen (av[i]);
-      l = (char *) xmalloc (sizeof (char) * len + ac - 2);
-      sprintf (l, "%s", av[2]);
+      len += ac - 2;
+      l = (char *) xmalloc (len);
+      snprintf (l, len, "%s", av[2]);
       for (i = 3; i < ac; i++)
 	{
-	  strcat (l, " ");
-	  strcat (l, av[i]);
+	  strlcat (l, " ", len);
+	  strlcat (l, av[i], len);
 	}
     }
 
@@@@ -461,7 +460,7 @@@@ GNATS_user (ac, av)
     }
   
   path = (char *) xmalloc (PATH_MAX);
-  sprintf (path, "%s/gnats-adm/%s", gnats_root, DB_ACCESS_FILE);
+  snprintf (path, PATH_MAX, "%s/gnats-adm/%s", gnats_root, DB_ACCESS_FILE);
   access = get_user_access (gnats_root, path, av[0], av[1]);
   xfree (path);
 
@@@@ -1531,8 +1530,8 @@@@ GNATS_auth (ac, av)
 	  return;
 	}
 
-      strcpy (keyfile, gnats_root);
-      strcat (keyfile, "/gnats-adm/srvtab");
+      strlcpy (keyfile, gnats_root, sizeof(keyfile));
+      strlcat (keyfile, "/gnats-adm/srvtab", sizeof(keyfile));
       /* Sanity-check installation.  */
       {
 	struct stat statbuf;
@@@@ -1601,7 +1600,7 @@@@ GNATS_auth (ac, av)
       p += 8;
       k.ticket.length = strlen (p) / 2;
       fromhex (k.ticket.dat, p, k.ticket.length);
-      strcpy (instance, "*");
+      strlcpy (instance, "*", sizeof(instance));
       status = krb_rd_req (&k.ticket, GNATS_KRB4_PRINCIPAL_NAME, instance,
 			   peer.sin_addr.s_addr, &k.auth, keyfile);
       if (status != KSUCCESS)
@


1.2.4.1
log
@MFC:
Fix some security issues with gnats.

Some additional fixes from millert@@
sprintf -> snprintf
str{cat,cpy} -> strl{cat,cpy}

http://marc.theaimsgroup.com/?l=bugtraq&m=105638591907836&w=2
@
text
@d1 1
a1 1
$OpenBSD: patch-gnats_cmds.c,v 1.3 2003/08/25 23:33:56 brad Exp $
d3 1
a3 1
+++ gnats/cmds.c	Wed Jul  2 13:23:13 2003
a44 58
@@@@ -228,8 +226,8 @@@@ do_query (ac, av)
           p = av[i];
           if ((n = (char *) strchr (p, '/')) != NULL) /* Remove the category */
                p = ++n;
-          strcpy (pat, p);
-          strcat (pat, "\\'");
+          strlcpy (pat, p, sizeof(pat));
+          strlcat (pat, "\\'", sizeof(pat));
           for (j = index_chain ; j ; j = j->next)
        	    if (regcmp (pat, j->number) == 0)
               {
@@@@ -352,12 +350,13 @@@@ GNATS_lock (ac, av)
       /* XXX FIXME -- we need a cleaner approach to this.  */
       for (i = 2, len = 0; i < ac; i++)
 	len += strlen (av[i]);
-      l = (char *) xmalloc (sizeof (char) * len + ac - 2);
-      sprintf (l, "%s", av[2]);
+      len += ac - 2;
+      l = (char *) xmalloc (len);
+      snprintf (l, len, "%s", av[2]);
       for (i = 3; i < ac; i++)
 	{
-	  strcat (l, " ");
-	  strcat (l, av[i]);
+	  strlcat (l, " ", len);
+	  strlcat (l, av[i], len);
 	}
     }
 
@@@@ -461,7 +460,7 @@@@ GNATS_user (ac, av)
     }
   
   path = (char *) xmalloc (PATH_MAX);
-  sprintf (path, "%s/gnats-adm/%s", gnats_root, DB_ACCESS_FILE);
+  snprintf (path, PATH_MAX, "%s/gnats-adm/%s", gnats_root, DB_ACCESS_FILE);
   access = get_user_access (gnats_root, path, av[0], av[1]);
   xfree (path);
 
@@@@ -1531,8 +1530,8 @@@@ GNATS_auth (ac, av)
 	  return;
 	}
 
-      strcpy (keyfile, gnats_root);
-      strcat (keyfile, "/gnats-adm/srvtab");
+      strlcpy (keyfile, gnats_root, sizeof(keyfile));
+      strlcat (keyfile, "/gnats-adm/srvtab", sizeof(keyfile));
       /* Sanity-check installation.  */
       {
 	struct stat statbuf;
@@@@ -1601,7 +1600,7 @@@@ GNATS_auth (ac, av)
       p += 8;
       k.ticket.length = strlen (p) / 2;
       fromhex (k.ticket.dat, p, k.ticket.length);
-      strcpy (instance, "*");
+      strlcpy (instance, "*", sizeof(instance));
       status = krb_rd_req (&k.ticket, GNATS_KRB4_PRINCIPAL_NAME, instance,
 			   peer.sin_addr.s_addr, &k.auth, keyfile);
       if (status != KSUCCESS)
@


1.1
log
@Initial revision
@
text
@d1 4
a4 3
--- gnats/cmds.c.orig	Wed Mar 17 18:45:36 1999
+++ gnats/cmds.c	Thu Jan 11 11:06:54 2001
@@@@ -115,28 +115,26 @@@@
@


1.1.1.1
log
@GNATS, the GNU Problem Report Management System. FLAVOR=www adds the gnatsweb CGI interface.
@
text
@@
