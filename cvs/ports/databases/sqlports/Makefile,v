head	1.65;
access;
symbols
	OPENBSD_6_1:1.64.0.2
	OPENBSD_6_1_BASE:1.64
	OPENBSD_6_0:1.61.0.2
	OPENBSD_6_0_BASE:1.61
	OPENBSD_5_9:1.59.0.2
	OPENBSD_5_9_BASE:1.59
	OPENBSD_5_8:1.59.0.4
	OPENBSD_5_8_BASE:1.59
	OPENBSD_5_7:1.58.0.2
	OPENBSD_5_7_BASE:1.58
	OPENBSD_5_6:1.56.0.2
	OPENBSD_5_6_BASE:1.56
	OPENBSD_5_5:1.55.0.2
	OPENBSD_5_5_BASE:1.55
	OPENBSD_5_4:1.51.0.2
	OPENBSD_5_4_BASE:1.51
	OPENBSD_5_3:1.46.0.2
	OPENBSD_5_3_BASE:1.46
	OPENBSD_5_2:1.44.0.2
	OPENBSD_5_2_BASE:1.44
	OPENBSD_5_1_BASE:1.38
	OPENBSD_5_1:1.38.0.2
	OPENBSD_5_0:1.34.0.2
	OPENBSD_5_0_BASE:1.34
	OPENBSD_4_9:1.32.0.2
	OPENBSD_4_9_BASE:1.32
	OPENBSD_4_8:1.23.0.2
	OPENBSD_4_8_BASE:1.23
	OPENBSD_4_7:1.20.0.2
	OPENBSD_4_7_BASE:1.20
	OPENBSD_4_6:1.12.0.4
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.12.0.2
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.10.0.4
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.10.0.2
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.9.0.4
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.9.0.2
	OPENBSD_4_1_BASE:1.9
	OPENBSD_4_0:1.4.0.2
	OPENBSD_4_0_BASE:1.4
	marc:1.1.1.1
	espie:1.1.1;
locks; strict;
comment	@# @;


1.65
date	2017.04.10.19.11.11;	author espie;	state Exp;
branches;
next	1.64;
commitid	uNVNk1Zqna1QP1Io;

1.64
date	2017.01.30.16.39.22;	author sthen;	state Exp;
branches;
next	1.63;
commitid	gn2JI0g7ZQbi2jVD;

1.63
date	2016.09.23.09.16.53;	author sthen;	state Exp;
branches;
next	1.62;
commitid	XLnI6AbHAmyVU5mO;

1.62
date	2016.08.18.12.28.53;	author sthen;	state Exp;
branches;
next	1.61;
commitid	B2FG0FaPmxcUfzwp;

1.61
date	2016.03.20.20.03.07;	author naddy;	state Exp;
branches;
next	1.60;
commitid	43tYUQxcFrr8eCa8;

1.60
date	2016.03.16.15.49.36;	author naddy;	state Exp;
branches;
next	1.59;
commitid	0fKhVnakQwk2jxbp;

1.59
date	2015.05.14.18.01.08;	author jasper;	state Exp;
branches;
next	1.58;
commitid	gbLQETikUH5bdInm;

1.58
date	2014.11.04.10.44.33;	author espie;	state Exp;
branches;
next	1.57;
commitid	aLXrBrnsEkjiD3Oy;

1.57
date	2014.09.02.14.26.39;	author jasper;	state Exp;
branches;
next	1.56;
commitid	Ptx1R6NkkFWYpLmY;

1.56
date	2014.07.12.17.35.32;	author espie;	state Exp;
branches;
next	1.55;
commitid	g9GVMnSaykPGUXLd;

1.55
date	2013.11.25.14.13.33;	author sthen;	state Exp;
branches;
next	1.54;

1.54
date	2013.11.01.17.19.18;	author espie;	state Exp;
branches;
next	1.53;

1.53
date	2013.11.01.14.52.47;	author espie;	state Exp;
branches;
next	1.52;

1.52
date	2013.08.27.07.51.03;	author zhuk;	state Exp;
branches;
next	1.51;

1.51
date	2013.06.21.10.48.38;	author espie;	state Exp;
branches;
next	1.50;

1.50
date	2013.03.31.09.43.13;	author espie;	state Exp;
branches;
next	1.49;

1.49
date	2013.03.11.11.53.51;	author espie;	state Exp;
branches;
next	1.48;

1.48
date	2013.03.11.02.52.09;	author espie;	state Exp;
branches;
next	1.47;

1.47
date	2013.03.08.10.05.31;	author espie;	state Exp;
branches;
next	1.46;

1.46
date	2013.01.14.13.09.54;	author espie;	state Exp;
branches;
next	1.45;

1.45
date	2012.10.11.08.19.02;	author espie;	state Exp;
branches;
next	1.44;

1.44
date	2012.07.06.10.22.17;	author espie;	state Exp;
branches;
next	1.43;

1.43
date	2012.06.18.12.18.45;	author espie;	state Exp;
branches;
next	1.42;

1.42
date	2012.05.22.12.04.02;	author espie;	state Exp;
branches;
next	1.41;

1.41
date	2012.05.20.11.06.07;	author espie;	state Exp;
branches;
next	1.40;

1.40
date	2012.05.18.12.11.28;	author espie;	state Exp;
branches;
next	1.39;

1.39
date	2012.04.29.16.34.53;	author espie;	state Exp;
branches;
next	1.38;

1.38
date	2012.01.28.11.40.34;	author espie;	state Exp;
branches;
next	1.37;

1.37
date	2011.11.26.22.30.30;	author kili;	state Exp;
branches;
next	1.36;

1.36
date	2011.09.24.07.37.34;	author espie;	state Exp;
branches;
next	1.35;

1.35
date	2011.09.10.08.48.15;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2011.04.10.18.01.13;	author jasper;	state Exp;
branches;
next	1.33;

1.33
date	2011.03.02.16.19.54;	author espie;	state Exp;
branches;
next	1.32;

1.32
date	2011.01.04.21.55.19;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2010.11.26.20.32.38;	author espie;	state Exp;
branches;
next	1.30;

1.30
date	2010.11.26.20.11.12;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2010.11.15.00.22.54;	author espie;	state Exp;
branches;
next	1.28;

1.28
date	2010.11.14.08.42.00;	author espie;	state Exp;
branches;
next	1.27;

1.27
date	2010.10.30.23.00.28;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2010.10.28.11.11.17;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2010.10.02.10.26.17;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	2010.09.21.15.18.03;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2010.04.19.09.21.31;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	2010.04.17.14.37.02;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2010.04.17.13.06.49;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2010.02.12.11.53.09;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2009.12.01.18.27.46;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2009.08.25.09.15.43;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2009.08.15.12.43.58;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2009.08.14.12.41.56;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2009.08.14.11.31.37;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2009.08.14.10.45.52;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2009.08.14.09.23.10;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2008.11.25.18.01.15;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2008.08.19.23.50.54;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2007.09.15.22.27.39;	author simon;	state Exp;
branches;
next	1.9;

1.9
date	2007.02.15.08.04.49;	author steven;	state Exp;
branches;
next	1.8;

1.8
date	2006.12.27.11.16.10;	author steven;	state Exp;
branches;
next	1.7;

1.7
date	2006.11.03.23.26.41;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2006.11.03.23.03.09;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2006.10.15.09.41.44;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2006.08.01.16.22.22;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2006.07.10.14.34.01;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2006.07.10.11.44.30;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2006.07.10.10.57.59;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.07.10.10.57.59;	author espie;	state Exp;
branches;
next	;


desc
@@


1.65
log
@hack things so that LIBCXX doesn't get expanded for sqlports.
This will probably be revisited and cleansed later.

okay sthen@@
@
text
@# $OpenBSD: Makefile,v 1.64 2017/01/30 16:39:22 sthen Exp $

CATEGORIES =		databases
V =			6.2
DISTNAME =		sqlports-$V
DISTFILES =
COMMENT =		sqlite database of ports
COMMENT-main =		${COMMENT}, user version
COMMENT-compact =	${COMMENT}, program version
COMMENT-list =		full list of pkgpaths in ports
MAINTAINER =		Marc Espie <espie@@openbsd.org>
PKGNAME-compact =	sqlports-compact-$V
PKGNAME-main =		sqlports-$V
PKGNAME-list =		portslist-$V

PERMIT_PACKAGE_CDROM =	Yes
MULTI_PACKAGES =	-main -compact -list

DBNAME =		${WRKBUILD}/sqlports
DBS =			${DBNAME}.list ${DBNAME} ${DBNAME}-compact
BUILD_DEPENDS =		databases/p5-DBD-SQLite \
			databases/sqlite3
RUN_DEPENDS =		databases/sqlite3

do-build:
	@@cd ${PORTSDIR} && PORTSDIR=${PORTSDIR} perl ${FILESDIR}/mksqlitedb -v ${DBNAME} -p ${WRKBUILD}/ouch
	@@if test -s ${WRKBUILD}/ouch; then \
		cat ${WRKBUILD}/ouch; \
		exit 1; \
	fi
	${LOCALBASE}/bin/sqlite3 ${DBNAME}-compact 'select min(paths.fullpkgpath) from paths join ports on paths.id=ports.fullpkgpath where ports.static_plist=1 group by fullpkgname order by paths.fullpkgpath' >${DBNAME}.list

do-install:
	@@for i in ${DBS}; do \
		${INSTALL_DATA} $$i ${PREFIX}/share; \
	done

NO_TEST =		Yes
NO_CHECKSUM =		Yes

.include <bsd.port.mk>
@


1.64
log
@add RDEP on sqlite3, ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2016/09/23 09:16:53 sthen Exp $
d4 1
a4 1
V =			6.1
@


1.63
log
@Cope with moving sqlite3 back to ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2016/08/18 12:28:53 sthen Exp $
d4 1
a4 1
V =			6.0
d23 1
@


1.62
log
@Add an USE_WXNEEDED flag for ports, to write an ld wrapper script in
${WRKDIR}/bin that adds -z wxneeded to linker command lines. It won't work
everywhere but provides an easy (and easily identifiable) way to add this
flag without fiddling with build systems.

Feedback/ok jca@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2016/03/20 20:03:07 naddy Exp $
d21 2
a22 1
BUILD_DEPENDS =		databases/p5-DBD-SQLite
d30 1
a30 1
	sqlite3 ${DBNAME}-compact 'select min(paths.fullpkgpath) from paths join ports on paths.id=ports.fullpkgpath where ports.static_plist=1 group by fullpkgname order by paths.fullpkgpath' >${DBNAME}.list
@


1.61
log
@drop SHARED_ONLY from the variables available in the database; ok jca@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2016/03/16 15:49:36 naddy Exp $
d4 1
a4 1
V =			5.0
@


1.60
log
@remove NO_SHARED_ARCHS and the resulting unreachable code
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2015/05/14 18:01:08 jasper Exp $
d4 1
a4 1
V =			4.4
@


1.59
log
@store PORTROACH_COMMENT

ok sthen@@ (previous bsd.port.mk commit was ok with stuart too)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2014/11/04 10:44:33 espie Exp $
a15 1

a18 5
NOT_FOR_ARCHS-main =	${NO_SHARED_ARCHS}
NOT_FOR_ARCHS-compact =	${NO_SHARED_ARCHS}

.include <bsd.port.arch.mk>

d20 1
a20 5
DBS =	${DBNAME}.list

.if ${BUILD_PACKAGES:M-main}
MKDB=${FILESDIR}/mksqlitedb
DBS += ${DBNAME} ${DBNAME}-compact
a22 6
post-build:
	sqlite3 ${DBNAME}-compact 'select min(paths.fullpkgpath) from paths join ports on paths.id=ports.fullpkgpath where ports.static_plist=1 group by fullpkgname order by paths.fullpkgpath' >${DBNAME}.list
.else
MKDB=${FILESDIR}/mkdblite
.endif

d24 1
a24 1
	@@cd ${PORTSDIR} && PORTSDIR=${PORTSDIR} perl ${MKDB} -v ${DBNAME} -p ${WRKBUILD}/ouch
d29 1
@


1.58
log
@add support for MAKEFILE_LIST
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2014/09/02 14:26:39 jasper Exp $
d4 1
a4 1
V =			4.3
@


1.57
log
@hookup PORTSCOUT

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2014/07/12 17:35:32 espie Exp $
d4 1
a4 1
V =			4.2
@


1.56
log
@support GH_* variables
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2013/11/25 14:13:33 sthen Exp $
d4 1
a4 1
V =			4.1
@


1.55
log
@Remove support for VMEM_WARNING, as it's manually "maintained" it isn't
very accurate, and isn't sensitive to differences between arches.
ok ajacoutot dcoppa zhuk espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2013/11/01 17:19:18 espie Exp $
d4 1
a4 1
V =			4.0
@


1.54
log
@oops, missed the conflict. Oh well, rename it correctly, and bump to 3.0,
that's an important enough change in my opinion.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2013/11/01 14:52:47 espie Exp $
d4 1
a4 1
V =			3.0
@


1.53
log
@add a 3rd package that's not really a database, but just the pkgpath list
used by pkglocatedb.

mkdblite is a very small version of mksqlitedb that does NOT use DBI at all,
and can create that list only.

allows pkglocatedb to build on arches without dbi, e.g., vax.

(real benefit: separate the code a bit more)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2013/08/27 07:51:03 zhuk Exp $
d4 1
a4 1
V =			2.9
d14 1
@


1.52
log
@Unbreak fetching of SHARED_LIBS and TARGETS in sqlports.

okay espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2013/06/21 10:48:38 espie Exp $
d10 1
d17 6
a22 1
MULTI_PACKAGES =	-main -compact
d25 12
d39 1
a39 1
	@@cd ${PORTSDIR} && PORTSDIR=${PORTSDIR} perl ${FILESDIR}/mksqlitedb -v ${DBNAME} -p ${WRKBUILD}/ouch
d46 3
a48 2
	${INSTALL_DATA} ${DBNAME} ${PREFIX}/share
	${INSTALL_DATA} ${DBNAME}-compact ${PREFIX}/share
a49 1
BUILD_DEPENDS =		databases/p5-DBD-SQLite
@


1.51
log
@also store PREFIX, which allows for useful statistics
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2013/03/31 09:43:13 espie Exp $
d4 1
a4 1
V =			2.8
@


1.50
log
@add README support
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2013/03/11 11:53:51 espie Exp $
d4 1
a4 1
V =			2.7
@


1.49
log
@REGRESS -> TEST, more fun here
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2013/03/11 02:52:09 espie Exp $
d4 1
a4 1
V =			2.6
@


1.48
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2013/03/08 10:05:31 espie Exp $
d4 1
a4 1
V =			2.5
@


1.47
log
@remove PERMIT_DISTFILES_CDROM from the table
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2013/01/14 13:09:54 espie Exp $
a15 3
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM =Yes
PERMIT_DISTFILES_FTP =	Yes
d32 1
a32 1
NO_REGRESS =		Yes
@


1.46
log
@integrate DPB_PROPERTIES
(noticed by nigel@@ if memory serves)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2012/10/11 08:19:02 espie Exp $
d4 1
a4 1
V =			2.4
@


1.45
log
@there's totally no need for FULLPKGNAMEs in there
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2012/07/06 10:22:17 espie Exp $
d4 1
a4 2
V =			2.3
REVISION =		0
@


1.44
log
@more stuff than the DESCR says, bump rev.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2012/06/18 12:18:45 espie Exp $
d12 2
a13 2
FULLPKGNAME-compact =	sqlports-compact-$V
FULLPKGNAME-main =	sqlports-$V
@


1.43
log
@clean-up ports-readmes special-case
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2012/05/22 12:04:02 espie Exp $
d5 1
@


1.42
log
@tweak: MULTI table now holds pointer to the corresponding subpackage path
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2012/05/20 11:06:07 espie Exp $
d4 1
a4 1
V =			2.2
@


1.41
log
@more surgery:
- don't ask the database about existing pathkeys, it's simpler to have
our hash.
- in dependencies, don't like for non normalized pathkeys
- add CANONICAL column, and fill it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2012/05/18 12:11:28 espie Exp $
d4 1
a4 1
V =			2.1
@


1.40
log
@bite the bullet, reuse dpb's algorithm to make sure we get correct
PkgPath.

This implies restructuring the database code, and the start of a
better separation between variables handling, and actual insertion
in the database.

bump version to 2.0: this changes the paths that actually get recorded,
and pkglocatedb will need to be aware of that.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2012/04/29 16:34:53 espie Exp $
d4 1
a4 1
V =			2.0
@


1.39
log
@+VMEM_WARNING
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2012/01/28 11:40:34 espie Exp $
d4 1
a4 1
V =			1.20
d24 1
a24 1
	@@cd ${PORTSDIR} && perl ${FILESDIR}/mksqlitedb -v ${DBNAME} -p ${WRKBUILD}/ouch
@


1.38
log
@fix description of DEPENDS table.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2011/11/26 22:30:30 kili Exp $
d4 1
a4 2
V =			1.19
REVISION =		0
@


1.37
log
@Fill in the master_sites* columns of the sqlports.ports table.

From espie@@, after a short discussion on icb.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2011/09/24 07:37:34 espie Exp $
d5 1
@


1.36
log
@better: use REPORT_PROBLEM_LOGFILE to have nicer error messages.
use new FULLPATH setting from bsd.port.subdir.mk to avoid having to fiddle
too much with options.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2011/09/10 08:48:15 espie Exp $
d4 1
a4 1
V =			1.18
@


1.35
log
@store PSEUDO_FLAVOR along. tweak descriptions a bit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2011/04/10 18:01:13 jasper Exp $
d25 4
a28 1
	@@if test -e ${WRKBUILD}/ouch; then exit 1; fi
@


1.34
log
@adjust after recent lesstif removal

ok aja@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2011/03/02 16:19:54 espie Exp $
d4 1
a4 1
V =			1.17
@


1.33
log
@tweak the way mksqlitedb work: keep looking at dependencies after we do
the main tree.

initial work by florent tribouilloy

a bit of clean-up from me.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2011/01/04 21:55:19 espie Exp $
d4 1
a4 1
V =			1.16
@


1.32
log
@handle PATCHFILES, ignore CHECKSUM_FILE
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2010/11/26 20:32:38 espie Exp $
d4 1
a4 1
V =			1.15
d24 1
a24 2
	@@cd ${PORTSDIR} && ${MAKE} dump-vars NO_IGNORE=Yes REPORT_PROBLEM='touch ${WRKBUILD}/ouch; exit 1'| \
	    perl ${FILESDIR}/mksqlitedb -v ${DBNAME}
@


1.31
log
@handle USE_MOTIF, add PKGSPEC
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2010/11/26 20:11:12 espie Exp $
d4 1
a4 1
V =			1.14
@


1.30
log
@report Yes/No variables with wrong values.
common work with Florent Tribouilloy

also rework Yes/No variables as valued variables.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2010/11/15 00:22:54 espie Exp $
d4 1
a4 1
V =			1.13
@


1.29
log
@convert to new style depends
zap default spec that are not needed
convert libspecs as well
convert p* to REVISION.

No package changes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2010/11/14 08:42:00 espie Exp $
d24 1
a24 1
	cd ${PORTSDIR} && ${MAKE} dump-vars NO_IGNORE=Yes REPORT_PROBLEM='touch ${WRKBUILD}/ouch; exit 1'| \
d26 1
a26 1
	if test -e ${WRKBUILD}/ouch; then exit 1; fi
@


1.28
log
@prepare for new specs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2010/10/30 23:00:28 espie Exp $
d32 1
a32 1
BUILD_DEPENDS =		::databases/p5-DBD-SQLite
@


1.27
log
@fix. stupid. me.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2010/10/28 11:11:17 espie Exp $
d4 1
a4 1
V =			1.12
@


1.26
log
@make sure sqlports will stop in case of an error.
problem noticed by steven@@, sneaky solution by me ;)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2010/10/02 10:26:17 espie Exp $
d26 1
a26 1
	test -e ${WRKBUILD}/ouch && exit 1
@


1.25
log
@USE_LIBTOOL is 3-valued.
register TARGETS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2010/09/21 15:18:03 sthen Exp $
d24 1
a24 1
	cd ${PORTSDIR} && ${MAKE} dump-vars NO_IGNORE=Yes| \
d26 1
@


1.24
log
@output EPOCH and REVISION in dump-vars, and use it in sqlports.
ok espie@@ (with a reminder to add EPOCH, my first diff just had REVISION).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2010/04/19 09:21:31 espie Exp $
d4 1
a4 1
V =			1.11
a23 1
	unset SUBDIR || true; \
d25 1
a25 1
	perl ${FILESDIR}/mksqlitedb -v ${DBNAME}
@


1.23
log
@fix, should build correctly even if SUBDIR is defined
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2010/04/17 14:37:02 espie Exp $
d4 1
a4 1
V =			1.10
@


1.22
log
@turn on foreign key constraints, as they seem to work ;-)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2010/04/17 13:06:49 espie Exp $
d24 1
@


1.21
log
@a few minor tidying.
commit to db only at end of port (referential integrity for later)
handle BROKEN-arch and create new table/view based on that.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2010/02/12 11:53:09 espie Exp $
d4 1
a4 1
V =			1.9
@


1.20
log
@get mksqlitedb to handle IGNORE and COMES_WITH if they show up.
Also don't spazz out if we meet variables we don't know. This makes us
safe from changes in dump-vars.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2009/12/01 18:27:46 espie Exp $
d4 1
a4 1
V =			1.8
@


1.19
log
@tag sqlports as "always-update".
If you don't have current pkgtools, *this will break*.
(@@option always-update was introduced over a month ago).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2009/08/25 09:15:43 espie Exp $
d4 1
a4 1
V =			1.7
@


1.18
log
@use left join on optional values, otherwise we lose a lot of _ports entries.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2009/08/15 12:43:58 espie Exp $
d4 1
a4 1
V =			1.6
@


1.17
log
@start building the _Ports view.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2009/08/14 12:41:56 espie Exp $
d4 1
a4 1
V =			1.5
@


1.16
log
@create views for most of the subsidiary tables
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2009/08/14 11:31:37 espie Exp $
d4 1
a4 1
V =			1.4
@


1.15
log
@create the ports table in the same way
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2009/08/14 10:45:52 espie Exp $
d4 1
a4 1
V =			1.3
@


1.14
log
@higher level table creation for individual tables except Ports:
create column objects, and ask the inserter to "render" them.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2009/08/14 09:23:10 espie Exp $
d4 1
a4 1
V =			1.2
@


1.13
log
@even though sqlite doesn't really care, this fixes the column types and adds
foreign key constraints to all the sql compact stuff.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2008/11/25 18:01:15 espie Exp $
d4 1
a4 1
V =			1.1
@


1.12
log
@kill oldish wantlib syntax that no longer exists, results in saner wantlib
tables.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2008/08/19 23:50:54 espie Exp $
d4 1
a4 1
V =			1.0p0
@


1.11
log
@new version, lots of code refactoring, and a new compact database.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2007/09/15 22:27:39 simon Exp $
d4 1
a4 1
V =			1.0
@


1.10
log
@remove surrounding quotes from COMMENT/BROKEN/PERMIT_*
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2007/02/15 08:04:49 steven Exp $
d3 17
a19 11
CATEGORIES=	databases
DISTNAME=	sqlports-0.5
PKGNAME=	${DISTNAME}p0
DISTFILES=
COMMENT=	sqlite database of ports
MAINTAINER=	Marc Espie <espie@@openbsd.org>

PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d21 1
a21 1
DBNAME=	${WRKBUILD}/sqlports
d24 2
a25 2
	cd ${PORTSDIR} && ${MAKE} dump-vars| \
	perl ${FILESDIR}/mksqlitedb ${DBNAME}
d29 1
d31 3
a33 3
BUILD_DEPENDS=	::databases/p5-DBD-SQLite
NO_REGRESS=	Yes
NO_CHECKSUM=	Yes
@


1.9
log
@NO_CHECKSUM and remove empty distinfo

from mikolaj.kucharski at gmail.com

go for it espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2006/12/27 11:16:10 steven Exp $
d7 1
a7 1
COMMENT=	'sqlite database of ports'
@


1.8
log
@put USE_X11 in the table.

sure espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2006/11/03 23:26:41 espie Exp $
d26 1
@


1.7
log
@optimize table structure, idea from Martynas Venckus
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2006/11/03 23:03:09 espie Exp $
d5 1
@


1.6
log
@use DROP IF EXISTS (from Martynas Venckus)

fix WANTLIB, regexp to strip version was totally wrong...

(more to come)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2006/10/15 09:41:44 espie Exp $
d4 1
a4 1
DISTNAME=	sqlports-0.4
@


1.5
log
@move mksqlitedb in the port that uses it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2006/08/01 16:22:22 espie Exp $
d4 1
a4 1
DISTNAME=	sqlports-0.3
@


1.4
log
@tweak for PKGPATH, name it correctly as FULLPKGPATH, and add a subsidiary
table to map FULLPKGPATH to PKGPATH, e.g.,

SELECT DISTINCT PKGPATH, VALUE FROM Wantlib,Paths WHERE Wantlib.FULLPKGPATH=Paths.FULLPKGPATH ORDER BY PKGPATH
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2006/07/10 14:34:01 espie Exp $
d18 1
a18 1
	perl ${PORTSDIR}/infrastructure/package/mksqlitedb ${DBNAME}
@


1.3
log
@Handle CONFIGURE_ARGS as a list, e.g.,
SELECT DISTINCT VALUE FROM ConfigureArgs
makes sense.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2006/07/10 11:44:30 espie Exp $
d4 1
a4 1
DISTNAME=	sqlports-0.2
@


1.2
log
@Really process SHARED_LIBS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2006/07/10 10:57:59 espie Exp $
d4 1
a4 1
DISTNAME=	sqlports-0.1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d4 1
a4 1
DISTNAME=	sqlports-0.0
@


1.1.1.1
log
@package the database built from ports for any user.
@
text
@@
