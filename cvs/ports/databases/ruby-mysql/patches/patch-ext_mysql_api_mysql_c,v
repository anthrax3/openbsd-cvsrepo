head	1.2;
access;
symbols
	OPENBSD_6_2:1.2.0.4
	OPENBSD_6_2_BASE:1.2
	OPENBSD_6_1:1.2.0.2
	OPENBSD_6_1_BASE:1.2;
locks; strict;
comment	@# @;


1.2
date	2017.01.07.18.09.28;	author jeremy;	state Exp;
branches;
next	1.1;
commitid	MQO75cfIlpvDuTQ8;

1.1
date	2017.01.06.15.55.38;	author jeremy;	state Exp;
branches;
next	;
commitid	340rC5ZtpSu2OmKx;


desc
@@


1.2
log
@Support building on ruby 1.8 again, last commit broke ruby 1.8 version.

Noticed by naddy@@
@
text
@$OpenBSD: patch-ext_mysql_api_mysql_c,v 1.1 2017/01/06 15:55:38 jeremy Exp $

Allow building with ruby 2.4+.

--- ext/mysql_api/mysql.c.orig	Wed Dec 31 16:00:00 1969
+++ ext/mysql_api/mysql.c	Sat Jan  7 10:06:36 2017
@@@@ -3,6 +3,11 @@@@
  */
 
 #include <ruby.h>
+#ifdef HAVE_RUBY_ENCODING_H
+#include <ruby/version.h>
+#else
+#define RUBY_API_VERSION_CODE 10807
+#endif
 #ifndef RSTRING_PTR
 #define RSTRING_PTR(str) RSTRING(str)->ptr
 #endif
@@@@ -1317,7 +1322,11 @@@@ static VALUE stmt_bind_result(int argc, VALUE *argv, V
 	}
 	else if (argv[i] == rb_cString)
 	    s->result.bind[i].buffer_type = MYSQL_TYPE_STRING;
-	else if (argv[i] == rb_cNumeric || argv[i] == rb_cInteger || argv[i] == rb_cFixnum)
+	else if (argv[i] == rb_cNumeric || argv[i] == rb_cInteger
+#if (RUBY_API_VERSION_CODE < 20400)
+                 || argv[i] == rb_cFixnum
+#endif
+                )
 	    s->result.bind[i].buffer_type = MYSQL_TYPE_LONGLONG;
 	else if (argv[i] == rb_cFloat)
 	    s->result.bind[i].buffer_type = MYSQL_TYPE_DOUBLE;
@


1.1
log
@Add patch to allow building with ruby 2.4.0

No change for earlier versions, so no bump.
@
text
@d1 1
a1 1
$OpenBSD$
d6 2
a7 2
+++ ext/mysql_api/mysql.c	Tue Oct 18 14:23:24 2016
@@@@ -3,6 +3,7 @@@@
d11 1
d13 3
d19 1
a19 1
@@@@ -1317,7 +1318,11 @@@@ static VALUE stmt_bind_result(int argc, VALUE *argv, V
@

