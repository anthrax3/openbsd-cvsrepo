head	1.2;
access;
symbols
	OPENBSD_6_1:1.2.0.6
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.4
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.1.0.6
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.2
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2016.02.13.21.54.28;	author sthen;	state Exp;
branches;
next	1.1;
commitid	PuOL68CXNBZydpca;

1.1
date	2015.02.18.17.49.56;	author jca;	state Exp;
branches
	1.1.6.1;
next	;
commitid	PMjoyq1h5DCAaFZ2;

1.1.6.1
date	2016.02.16.09.20.36;	author jasper;	state Exp;
branches;
next	;
commitid	Sz2fOZKrVdgk7cOl;


desc
@@


1.2
log
@SECURITY update to PostgreSQL 9.4.6: various fixes including one for
CVE-2016-0773, an issue with regular expression parsing. Various other fixes.

Note: ..."if you are upgrading an installation that contains any GIN
indexes that use the (non-default) jsonb_path_ops operator class, see
the first changelog entry"...
http://www.postgresql.org/docs/current/static/release-9-4-6.html

OK pea@@
@
text
@$OpenBSD: patch-src_backend_libpq_ip_c,v 1.1 2015/02/18 17:49:56 jca Exp $

Use the address family from the address, not from the netmask,
since the latter is unreliable. Fixes "samenet"/"samehost".

--- src/backend/libpq/ip.c.orig	Mon Feb  8 21:15:19 2016
+++ src/backend/libpq/ip.c	Fri Feb 12 17:18:09 2016
@@@@ -423,17 +423,16 @@@@ run_ifaddr_callback(PgIfAddrCallback callback, void *c
 	/* Check that the mask is valid */
 	if (mask)
 	{
-		if (mask->sa_family != addr->sa_family)
+
+		/* mask->sa_family can be different from addr->sa_family. */
+
+		if (addr->sa_family == AF_INET)
 		{
-			mask = NULL;
-		}
-		else if (mask->sa_family == AF_INET)
-		{
 			if (((struct sockaddr_in *) mask)->sin_addr.s_addr == INADDR_ANY)
 				mask = NULL;
 		}
 #ifdef HAVE_IPV6
-		else if (mask->sa_family == AF_INET6)
+		else if (addr->sa_family == AF_INET6)
 		{
 			if (IN6_IS_ADDR_UNSPECIFIED(&((struct sockaddr_in6 *) mask)->sin6_addr))
 				mask = NULL;
@


1.1
log
@Fix hba "samehost"/"samenet" support.

On OpenBSD, the sa_family field in netmask sockaddrs can be zero and
thus different from the sa_family of the address sockaddr.
Until this glitch gets corrected, fix postgresql.

ok sthen@@ pea@@ (MAINTAINER)
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
a8 3
--- src/backend/libpq/ip.c.orig	Mon Feb 16 23:36:42 2015
+++ src/backend/libpq/ip.c	Mon Feb 16 23:47:56 2015
@@@@ -496,17 +496,16 @@@@ run_ifaddr_callback(PgIfAddrCallback callback, void *c
@


1.1.6.1
log
@SECURITY update to PostgreSQL 9.4.6: various fixes including one for
CVE-2016-0773, an issue with regular expression parsing. Various other fixes.

Note: ..."if you are upgrading an installation that contains any GIN
indexes that use the (non-default) jsonb_path_ops operator class, see
the first changelog entry"...

http://www.postgresql.org/docs/current/static/release-9-4-6.html
@
text
@d1 1
a1 1
$OpenBSD: patch-src_backend_libpq_ip_c,v 1.1 2015/02/18 17:49:56 jca Exp $
d6 3
a8 3
--- src/backend/libpq/ip.c.orig	Mon Feb  8 22:15:19 2016
+++ src/backend/libpq/ip.c	Tue Feb 16 10:11:55 2016
@@@@ -423,17 +423,16 @@@@ run_ifaddr_callback(PgIfAddrCallback callback, void *c
@


