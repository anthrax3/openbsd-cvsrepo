head	1.2;
access;
symbols
	OPENBSD_3_4:1.1.0.4
	OPENBSD_3_3:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2003.12.23.19.40.32;	author brad;	state dead;
branches;
next	1.1;

1.1
date	2003.11.11.15.11.34;	author margarida;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2003.11.11.15.12.40;	author margarida;	state Exp;
branches;
next	;

1.1.4.1
date	2003.11.11.15.13.26;	author margarida;	state Exp;
branches;
next	;


desc
@@


1.2
log
@upgrade to PostgreSQL 7.3.5
--
ok MAINTAINER (Peter Galbavy)
@
text
@$OpenBSD: patch-src_backend_utils_adt_ascii_c,v 1.1 2003/11/11 15:11:34 margarida Exp $
--- src/backend/utils/adt/ascii.c.orig	2003-11-08 18:00:02.000000000 +0000
+++ src/backend/utils/adt/ascii.c	2003-11-08 18:04:40.000000000 +0000
@@@@ -27,9 +27,9 @@@@ static text *encode_to_ascii(text *data,
 char *
 pg_to_ascii(unsigned char *src, unsigned char *src_end, unsigned char *desc, int enc)
 {
-	unsigned char *x = NULL;
-	unsigned char *ascii = NULL;
-	int			range = 0;
+	unsigned char *x;
+	unsigned char *ascii;
+	int			range;
 
 	/*
 	 * relevant start for an encoding
@@@@ -66,12 +66,13 @@@@ pg_to_ascii(unsigned char *src, unsigned
 	{
 		elog(ERROR, "pg_to_ascii(): unsupported encoding from %s",
 			 pg_encoding_to_char(enc));
+		return NULL;			/* keep compiler quiet */
 	}
 
 	/*
 	 * Encode
 	 */
-	for (x = src; x <= src_end; x++)
+	for (x = src; x < src_end; x++)
 	{
 		if (*x < 128)
 			*desc++ = *x;
@@@@ -93,7 +94,7 @@@@ encode_to_ascii(text *data, int enc)
 {
 	pg_to_ascii(
 				(unsigned char *) VARDATA(data),		/* src */
-				VARDATA(data) + VARSIZE(data),	/* src end */
+				(unsigned char *) (data) + VARSIZE(data),       /* src end */
 				(unsigned char *) VARDATA(data),		/* desc */
 				enc);			/* encoding */
 
@


1.1
log
@Security fix:
Two bugs were discovered that lead to a buffer overflow in PostgreSQL
in the abstract data type (ADT) to ASCII conversion functions.
It is believed that, under the right circumstances, an attacker may use
this vulnerability to execute arbitrary instructions on the PostgreSQL
server.

ok Brandon Palmer (maintainer)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@Security fix:
Two bugs were discovered that lead to a buffer overflow in PostgreSQL
in the abstract data type (ADT) to ASCII conversion functions.
It is believed that, under the right circumstances, an attacker may use
this vulnerability to execute arbitrary instructions on the PostgreSQL
server.
@
text
@d2 2
a3 2
--- src/backend/utils/adt/ascii.c.orig	2002-08-29 03:22:26.000000000 -0400
+++ src/backend/utils/adt/ascii.c	2003-11-08 09:58:03.000000000 -0500
@


1.1.2.1
log
@Security fix:
Two bugs were discovered that lead to a buffer overflow in PostgreSQL
in the abstract data type (ADT) to ASCII conversion functions.
It is believed that, under the right circumstances, an attacker may use
this vulnerability to execute arbitrary instructions on the PostgreSQL
server.
@
text
@d2 2
a3 2
--- src/backend/utils/adt/ascii.c.orig	Thu Aug 29 08:22:26 2002
+++ src/backend/utils/adt/ascii.c	Sat Nov  8 20:09:42 2003
@

