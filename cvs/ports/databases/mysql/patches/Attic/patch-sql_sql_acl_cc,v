head	1.6;
access;
symbols
	OPENBSD_4_0:1.6.0.2
	OPENBSD_3_9:1.5.0.2
	OPENBSD_3_4:1.1.0.6
	OPENBSD_3_4_BASE:1.1
	OPENBSD_3_3:1.1.0.4
	OPENBSD_3_2:1.1.0.2;
locks; strict;
comment	@# @;


1.6
date	2006.10.14.05.04.54;	author brad;	state dead;
branches
	1.6.2.1;
next	1.5;

1.5
date	2006.10.03.04.52.03;	author brad;	state Exp;
branches
	1.5.2.1;
next	1.4;

1.4
date	2005.01.14.01.42.58;	author brad;	state dead;
branches;
next	1.3;

1.3
date	2004.10.20.07.36.04;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2003.12.30.05.57.30;	author brad;	state dead;
branches;
next	1.1;

1.1
date	2003.08.26.15.37.18;	author brad;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2003.09.01.22.54.03;	author brad;	state Exp;
branches;
next	;

1.1.4.1
date	2003.09.03.00.26.22;	author brad;	state Exp;
branches;
next	;

1.5.2.1
date	2006.10.04.16.29.15;	author sturm;	state Exp;
branches;
next	;

1.6.2.1
date	2006.11.01.13.03.06;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.6
log
@upgrade to MySQL 5.0.26
@
text
@$OpenBSD: patch-sql_sql_acl_cc,v 1.5 2006/10/03 04:52:03 brad Exp $
--- sql/sql_acl.cc.orig	Mon Oct  2 21:50:32 2006
+++ sql/sql_acl.cc	Mon Oct  2 23:04:25 2006
@@@@ -149,8 +149,8 @@@@ my_bool acl_init(bool dont_read_acl_tabl
   acl_cache= new hash_filo(ACL_CACHE_SIZE, 0, 0,
                            (hash_get_key) acl_entry_get_key,
                            (hash_free_key) free,
-                           /* Use the case sensitive "binary" charset */
-                           &my_charset_bin);
+                           lower_case_file_system ?
+                           system_charset_info : &my_charset_bin);
   if (dont_read_acl_tables)
   {
     DBUG_RETURN(0); /* purecov: tested */
@


1.6.2.1
log
@MFC:
upgrade to MySQL 5.0.24a + a few patches.

http://bugs.mysql.com/22227 ulong fix
http://bugs.mysql.com/21327 OpenSSL build fix
http://bugs.mysql.com/18630 security context issue fix
http://bugs.mysql.com/17647 case-sensitive fs issue fix

CVE-2006-4226, CVE-2006-4227
@
text
@@


1.5
log
@upgrade to MySQL 5.0.24a + a few patches.

http://bugs.mysql.com/22227 ulong fix
http://bugs.mysql.com/21327 OpenSSL build fix
http://bugs.mysql.com/18630 security context issue fix
http://bugs.mysql.com/17647 case-sensitive fs issue fix

CVE-2006-4226, CVE-2006-4227
@
text
@d1 1
a1 1
$OpenBSD$
@


1.5.2.1
log
@MFC:
upgrade to MySQL 5.0.24a + a few patches.

http://bugs.mysql.com/22227 ulong fix
http://bugs.mysql.com/21327 OpenSSL build fix
http://bugs.mysql.com/18630 security context issue fix
http://bugs.mysql.com/17647 case-sensitive fs issue fix

CVE-2006-4226, CVE-2006-4227
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_acl_cc,v 1.5 2006/10/03 04:52:03 brad Exp $
@


1.4
log
@upgrade to MySQL 4.0.23

fixes some crashing issues among many other bug fixes,
seems to have resolved a crashing issue henning@@ was
experiencing on sparc64.
@
text
@d1 14
a14 48
$OpenBSD: patch-sql_sql_acl_cc,v 1.3 2004/10/20 07:36:04 brad Exp $
--- sql/sql_acl.cc.orig	Thu May 13 20:53:35 2004
+++ sql/sql_acl.cc	Wed Oct 20 00:50:19 2004
@@@@ -834,7 +834,7 @@@@ static void acl_insert_db(const char *us
 */
 
 ulong acl_get(const char *host, const char *ip, const char *bin_ip,
-	     const char *user, const char *db)
+	     const char *user, const char *db, my_bool db_is_pattern)
 {
   ulong host_access,db_access;
   uint i,key_length;
@@@@ -868,7 +868,7 @@@@ ulong acl_get(const char *host, const ch
     {
       if (compare_hostname(&acl_db->host,host,ip))
       {
-	if (!acl_db->db || !wild_compare(db,acl_db->db))
+	if (!acl_db->db || !wild_compare(db,acl_db->db,db_is_pattern))
 	{
 	  db_access=acl_db->access;
 	  if (acl_db->host.hostname)
@@@@ -890,7 +890,7 @@@@ ulong acl_get(const char *host, const ch
     ACL_HOST *acl_host=dynamic_element(&acl_hosts,i,ACL_HOST*);
     if (compare_hostname(&acl_host->host,host,ip))
     {
-      if (!acl_host->db || !wild_compare(db,acl_host->db))
+      if (!acl_host->db || !wild_compare(db,acl_host->db,0))
       {
 	host_access=acl_host->access;		// Fully specified. Take it
 	break;
@@@@ -1222,7 +1222,7 @@@@ static bool compare_hostname(const acl_h
   }
   return (!host->hostname ||
 	  (hostname && !wild_case_compare(hostname,host->hostname)) ||
-	  (ip && !wild_compare(ip,host->hostname)));
+	  (ip && !wild_compare(ip,host->hostname,0)));
 }
 
 
@@@@ -1300,7 +1300,7 @@@@ static bool test_if_create_new_users(THD
     tl.db=	   (char*) "mysql";
     tl.real_name=  (char*) "user";
     db_access=acl_get(thd->host, thd->ip, (char*) &thd->remote.sin_addr,
-		      thd->priv_user, tl.db);
+		      thd->priv_user, tl.db, 0);
     if (!(db_access & INSERT_ACL))
     {
       if (check_grant(thd,INSERT_ACL,&tl,0,1))
@


1.3
log
@* Fixed bug in privilege checking where, under some conditions, one
  was able to grant privileges on the database, he has no privileges
  on. (Bug #3933)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@upgrade to MySQL 4.0.17

LOTS of people have asked for this so here is my work in progress.
test as much as possible.
@
text
@d1 13
a13 9
$OpenBSD: patch-sql_sql_acl_cc,v 1.1 2003/08/26 15:37:18 brad Exp $
--- sql/sql_acl.cc.orig	2003-08-24 17:10:08.000000000 -0400
+++ sql/sql_acl.cc	2003-08-24 17:11:24.000000000 -0400
@@@@ -206,10 +206,10 @@@@ int  acl_init(bool dont_read_acl_tables)
 		      "Found old style password for user '%s'. Ignoring user. (You may want to restart using --old-protocol)",
 		      user.user ? user.user : ""); /* purecov: tested */
     }
-    else if (length % 8)		// This holds true for passwords
+    else if (length % 8 || length > 16)
d15 34
a48 6
       sql_print_error(
-		      "Found invalid password for user: '%s@@%s'; Ignoring user",
+		      "Found invalid password for user: '%s'@@'%s'; Ignoring user",
 		      user.user ? user.user : "",
 		      user.host.hostname ? user.host.hostname : ""); /* purecov: tested */
       continue; /* purecov: tested */
@


1.1
log
@upgrade to MySQL 3.23.57 + patches

fixes some older security issues as well as a soon to be disclosed issue.

ok naddy@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@MFC:
upgrade to MySQL 3.23.57 + patches

fixes some older security issues as well as a soon to be disclosed issue.
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_acl_cc,v 1.1 2003/08/26 15:37:18 brad Exp $
@


1.1.2.1
log
@MFC:
upgrade to MySQL 3.23.57 + patches

fixes some older security issues as well as a soon to be disclosed issue.
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_acl_cc,v 1.1 2003/08/26 15:37:18 brad Exp $
@

