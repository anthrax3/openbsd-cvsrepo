head	1.14;
access;
symbols
	OPENBSD_5_6:1.13.0.4
	OPENBSD_5_6_BASE:1.13
	OPENBSD_5_5:1.13.0.2
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.11.0.6
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.4
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.2
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.2
	OPENBSD_5_0:1.9.0.2
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_0:1.5.0.2
	OPENBSD_3_9:1.4.0.2;
locks; strict;
comment	@# @;


1.14
date	2014.10.03.10.54.55;	author brad;	state dead;
branches;
next	1.13;
commitid	l38yfxK2clf7O9UX;

1.13
date	2013.10.04.07.09.18;	author giovanni;	state Exp;
branches;
next	1.12;

1.12
date	2013.08.07.23.38.56;	author brad;	state Exp;
branches;
next	1.11;

1.11
date	2012.03.26.08.05.01;	author giovanni;	state Exp;
branches;
next	1.10;

1.10
date	2011.09.05.07.11.23;	author giovanni;	state Exp;
branches
	1.10.2.1;
next	1.9;

1.9
date	2011.05.19.08.35.15;	author dcoppa;	state Exp;
branches;
next	1.8;

1.8
date	2011.01.11.11.03.03;	author ajacoutot;	state dead;
branches;
next	1.7;

1.7
date	2010.12.26.08.23.17;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2010.11.10.21.03.38;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2006.10.14.05.04.54;	author brad;	state dead;
branches
	1.5.2.1;
next	1.4;

1.4
date	2006.10.03.04.52.03;	author brad;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	2005.01.14.01.42.58;	author brad;	state dead;
branches;
next	1.2;

1.2
date	2004.10.20.07.36.04;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2004.10.20.04.47.29;	author brad;	state Exp;
branches;
next	;

1.4.2.1
date	2006.10.04.16.29.15;	author sturm;	state Exp;
branches;
next	;

1.5.2.1
date	2006.11.01.13.03.06;	author sturm;	state Exp;
branches;
next	;

1.10.2.1
date	2012.04.12.09.01.40;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.14
log
@So long and into the Attic you go.

ok sthen@@
@
text
@$OpenBSD: patch-sql_sql_parse_cc,v 1.13 2013/10/04 07:09:18 giovanni Exp $

Fix floating point string printing in MySQL status output
(MySQL Bug #61205)

--- sql/sql_parse.cc.orig	Mon Sep  9 21:23:26 2013
+++ sql/sql_parse.cc	Thu Oct  3 15:23:29 2013
@@@@ -1593,7 +1593,7 @@@@ bool dispatch_command(enum enum_server_command command
     length= my_snprintf(buff, buff_len - 1,
                         "Uptime: %lu  Threads: %d  Questions: %lu  "
                         "Slow queries: %lu  Opens: %lu  Flush tables: %lu  "
-                        "Open tables: %u  Queries per second avg: %u.%u",
+                        "Open tables: %u  Queries per second avg: %u.%03u",
                         uptime,
                         (int) thread_count, (ulong) thd->query_id,
                         current_global_status_var.long_query_count,
@


1.13
log
@
Update to 5.1.72,
some innodb related bugs has been fixed.
Full changelog available at:
http://dev.mysql.com/doc/relnotes/mysql/5.1/en/news-5-1-72.html

ok brad@@ (Mantainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_parse_cc,v 1.12 2013/08/07 23:38:56 brad Exp $
@


1.12
log
@Update to MySQL 5.1.71.

ok giovanni@@
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_parse_cc,v 1.11 2012/03/26 08:05:01 giovanni Exp $
d6 3
a8 3
--- sql/sql_parse.cc.orig	Thu Jul 11 09:39:36 2013
+++ sql/sql_parse.cc	Sat Aug  3 18:24:07 2013
@@@@ -1591,7 +1591,7 @@@@ bool dispatch_command(enum enum_server_command command
@


1.11
log
@
Update to 5.1.62, fixes 2 security bugs and other things
ok Brad (Maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_parse_cc,v 1.10 2011/09/05 07:11:23 giovanni Exp $
d6 3
a8 3
--- sql/sql_parse.cc.orig	Fri Dec 16 20:06:04 2011
+++ sql/sql_parse.cc	Wed Mar 21 09:20:37 2012
@@@@ -1584,7 +1584,7 @@@@ bool dispatch_command(enum enum_server_command command
@


1.10
log
@
Update to 5.1.58
help and ok Brad (Maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_parse_cc,v 1.9 2011/05/19 08:35:15 dcoppa Exp $
d6 3
a8 3
--- sql/sql_parse.cc.orig	Tue Apr 12 14:11:38 2011
+++ sql/sql_parse.cc	Thu Jun 30 10:57:33 2011
@@@@ -1572,7 +1572,7 @@@@ bool dispatch_command(enum enum_server_command command
@


1.10.2.1
log
@- update to 5.1.62
includes two security fixes

ok brad (MAINTAINER) giovanni@@
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_parse_cc,v 1.11 2012/03/26 08:05:01 giovanni Exp $
d6 3
a8 3
--- sql/sql_parse.cc.orig	Fri Dec 16 20:06:04 2011
+++ sql/sql_parse.cc	Wed Mar 21 09:20:37 2012
@@@@ -1584,7 +1584,7 @@@@ bool dispatch_command(enum enum_server_command command
@


1.9
log
@Fix floating point string printing in MySQL status output
(MySQL Bug #61205)

OK Brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
a8 3
--- sql/sql_parse.cc.orig	Wed May 18 12:36:24 2011
+++ sql/sql_parse.cc	Wed May 18 12:37:14 2011
@@@@ -1558,7 +1558,7 @@@@ bool dispatch_command(enum enum_server_command command
@


1.8
log
@Revert local patches that reverted a commit that broken MySQL on OpenBSD
64-bit archs and apply a patch from upstream to properly fix the
regression.

from Brad (maintainer)
@
text
@d1 16
a16 37
$OpenBSD: patch-sql_sql_parse_cc,v 1.7 2010/12/26 08:23:17 ajacoutot Exp $
--- sql/sql_parse.cc.orig	Mon Nov 29 05:37:59 2010
+++ sql/sql_parse.cc	Tue Dec 14 20:37:51 2010
@@@@ -1001,19 +1001,6 @@@@ bool dispatch_command(enum enum_server_command command
   thd->enable_slow_log= TRUE;
   thd->lex->sql_command= SQLCOM_END; /* to avoid confusing VIEW detectors */
   thd->set_time();
-  if (!thd->is_valid_time())
-  {
-    /*
-     If the time has got past 2038 we need to shut this server down
-     We do this by making sure every command is a shutdown and we 
-     have enough privileges to shut the server down
-
-     TODO: remove this when we have full 64 bit my_time_t support
-    */
-    thd->security_ctx->master_access|= SHUTDOWN_ACL;
-    command= COM_SHUTDOWN;
-  }
-
   VOID(pthread_mutex_lock(&LOCK_thread_count));
   thd->query_id= global_query_id;
 
@@@@ -1517,11 +1504,8 @@@@ bool dispatch_command(enum enum_server_command command
       SHUTDOWN_DEFAULT is 0. If client is >= 4.1.3, the shutdown level is in
       packet[0].
     */
-    enum mysql_enum_shutdown_level level;
-    if (!thd->is_valid_time())
-      level= SHUTDOWN_DEFAULT;
-    else
-      level= (enum mysql_enum_shutdown_level) (uchar) packet[0];
+    enum mysql_enum_shutdown_level level=
+      (enum mysql_enum_shutdown_level) (uchar) packet[0];
     if (level == SHUTDOWN_DEFAULT)
       level= SHUTDOWN_WAIT_ALL_BUFFERS; // soon default will be configurable
     else if (level != SHUTDOWN_WAIT_ALL_BUFFERS)
@


1.7
log
@Update to mysql-5.1.54.
More details at:
http://dev.mysql.com/doc/refman/5.1/en/news-5-1-54.html

from Brad
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_parse_cc,v 1.6 2010/11/10 21:03:38 sthen Exp $
@


1.6
log
@Update MySQL to 5.1.52, from Brad.
@
text
@d1 4
a4 4
$OpenBSD$
--- sql/sql_parse.cc.orig	Mon Oct 11 16:34:16 2010
+++ sql/sql_parse.cc	Tue Nov  9 20:07:50 2010
@@@@ -1000,19 +1000,6 @@@@ bool dispatch_command(enum enum_server_command command
d24 1
a24 1
@@@@ -1516,11 +1503,8 @@@@ bool dispatch_command(enum enum_server_command command
@


1.5
log
@upgrade to MySQL 5.0.26
@
text
@d1 19
a19 32
$OpenBSD: patch-sql_sql_parse_cc,v 1.4 2006/10/03 04:52:03 brad Exp $
--- sql/sql_parse.cc.orig	Fri Aug 25 17:12:28 2006
+++ sql/sql_parse.cc	Mon Oct  2 11:28:32 2006
@@@@ -4383,9 +4383,6 @@@@ end_with_restore_list:
       }
       else
       {
-#ifndef NO_EMBEDDED_ACCESS_CHECKS
-	Security_context *save_ctx;
-#endif
 	ha_rows select_limit;
         /* bits that should be cleared in thd->server_status */
 	uint bits_to_be_cleared= 0;
@@@@ -4427,21 +4424,11 @@@@ end_with_restore_list:
 
 #ifndef NO_EMBEDDED_ACCESS_CHECKS
 	if (check_routine_access(thd, EXECUTE_ACL,
-				 sp->m_db.str, sp->m_name.str, TRUE, 0) ||
-          sp_change_security_context(thd, sp, &save_ctx))
+				 sp->m_db.str, sp->m_name.str, TRUE, FALSE))
 	{
 	  thd->net.no_send_ok= nsok;
 	  goto error;
 	}
-	if (save_ctx &&
-            check_routine_access(thd, EXECUTE_ACL,
-                                 sp->m_db.str, sp->m_name.str, TRUE, 0))
-	{
-	  thd->net.no_send_ok= nsok;
-	  sp_restore_security_context(thd, save_ctx);
-	  goto error;
-	}
d21 2
a22 10
 #endif
 	select_limit= thd->variables.select_limit;
 	thd->variables.select_limit= HA_POS_ERROR;
@@@@ -4465,9 +4452,6 @@@@ end_with_restore_list:
 	  thd->total_warn_count= 0;
 
 	thd->variables.select_limit= select_limit;
-#ifndef NO_EMBEDDED_ACCESS_CHECKS
-	sp_restore_security_context(thd, save_ctx);
-#endif
d24 14
a37 2
 	thd->net.no_send_ok= nsok;
         thd->server_status&= ~bits_to_be_cleared;
@


1.5.2.1
log
@MFC:
upgrade to MySQL 5.0.24a + a few patches.

http://bugs.mysql.com/22227 ulong fix
http://bugs.mysql.com/21327 OpenSSL build fix
http://bugs.mysql.com/18630 security context issue fix
http://bugs.mysql.com/17647 case-sensitive fs issue fix

CVE-2006-4226, CVE-2006-4227
@
text
@@


1.4
log
@upgrade to MySQL 5.0.24a + a few patches.

http://bugs.mysql.com/22227 ulong fix
http://bugs.mysql.com/21327 OpenSSL build fix
http://bugs.mysql.com/18630 security context issue fix
http://bugs.mysql.com/17647 case-sensitive fs issue fix

CVE-2006-4226, CVE-2006-4227
@
text
@d1 1
a1 1
$OpenBSD$
@


1.4.2.1
log
@MFC:
upgrade to MySQL 5.0.24a + a few patches.

http://bugs.mysql.com/22227 ulong fix
http://bugs.mysql.com/21327 OpenSSL build fix
http://bugs.mysql.com/18630 security context issue fix
http://bugs.mysql.com/17647 case-sensitive fs issue fix

CVE-2006-4226, CVE-2006-4227
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_parse_cc,v 1.4 2006/10/03 04:52:03 brad Exp $
@


1.3
log
@upgrade to MySQL 4.0.23

fixes some crashing issues among many other bug fixes,
seems to have resolved a crashing issue henning@@ was
experiencing on sparc64.
@
text
@d1 14
a14 13
$OpenBSD: patch-sql_sql_parse_cc,v 1.2 2004/10/20 07:36:04 brad Exp $
--- sql/sql_parse.cc.orig	Thu May 13 20:53:18 2004
+++ sql/sql_parse.cc	Wed Oct 20 00:50:19 2004
@@@@ -2670,7 +2670,7 @@@@ check_access(THD *thd, ulong want_access
     if (!(thd->master_access & SELECT_ACL) &&
 	(db && (!thd->db || strcmp(db,thd->db))))
       db_access=acl_get(thd->host, thd->ip, (char*) &thd->remote.sin_addr,
-			thd->priv_user, db); /* purecov: inspected */
+			thd->priv_user, db, 0); /* purecov: inspected */
     *save_priv=thd->master_access | db_access;
     DBUG_RETURN(FALSE);
   }
@@@@ -2690,7 +2690,7 @@@@ check_access(THD *thd, ulong want_access
d16 31
a46 19
   if (db && (!thd->db || strcmp(db,thd->db)))
     db_access=acl_get(thd->host, thd->ip, (char*) &thd->remote.sin_addr,
-		      thd->priv_user, db); /* purecov: inspected */
+		      thd->priv_user, db, 0); /* purecov: inspected */
   else
     db_access=thd->db_access;
   // Remove SHOW attribute and access rights we already have
@@@@ -3155,7 +3155,10 @@@@ bool add_field_to_list(char *field_name,
     break;
   case FIELD_TYPE_DECIMAL:
     if (!length)
-      new_field->length= 10;			// Default length for DECIMAL
+      if (new_field->length= new_field->decimals)
+        new_field->length++;
+      else
+        new_field->length=10;                   // Default length for DECIMAL
     if (new_field->length < MAX_FIELD_WIDTH)	// Skip wrong argument
     {
       new_field->length+=sign_len;
@


1.2
log
@* Fixed bug in privilege checking where, under some conditions, one
  was able to grant privileges on the database, he has no privileges
  on. (Bug #3933)
@
text
@d1 1
a1 1
$OpenBSD: patch-sql_sql_parse_cc,v 1.1 2004/10/20 04:47:29 brad Exp $
@


1.1
log
@* Fixed potential memory overrun in `mysql_real_connect()' (which
  required a compromised DNS server and certain operating systems).
  (Bug #4017)

* Fixed crash in `MATCH ... AGAINST()' on a phrase search operator
  with a missing closing double quote. (Bug #3870)

* Fixed a crash on declaration of `DECIMAL(0,...)' column. (Bug
  #4046)
@
text
@d1 1
a1 1
$OpenBSD$
d3 19
a21 1
+++ sql/sql_parse.cc	Tue Oct 19 22:22:11 2004
@

