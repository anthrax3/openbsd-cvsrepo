head	1.6;
access;
symbols
	OPENBSD_2_8:1.5.0.2
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.3.0.2
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.1.1.1.0.4
	OPENBSD_2_6_BASE:1.1.1.1
	OPENBSD_2_5:1.1.1.1.0.2
	OPENBSD_2_5_BASE:1.1.1.1
	marc_1999-Mar-29:1.1.1.1
	marc:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2001.01.21.17.09.13;	author brad;	state dead;
branches;
next	1.5;

1.5
date	2000.08.15.13.24.01;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	2000.08.02.04.24.28;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2000.01.13.20.24.58;	author brad;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	2000.01.01.05.54.13;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	99.03.30.06.42.47;	author marc;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.03.30.06.42.47;	author marc;	state Exp;
branches;
next	;

1.3.2.1
date	2000.09.15.04.47.47;	author marc;	state Exp;
branches;
next	;


desc
@@


1.6
log
@upgrade to MySQL 3.23.31
@
text
@--- scripts/safe_mysqld.sh.orig	Mon Jan 10 16:49:29 2000
+++ scripts/safe_mysqld.sh	Mon Aug 14 05:01:01 2000
@@@@ -12,33 +12,9 @@@@
 
 trap '' 1 2 3 15			# we shouldn't let anyone kill us
 
-# Check if we are starting this relative (for the binary release)
-if test -d ./data/mysql -a -f ./share/mysql/english/errmsg.sys -a \
- -x ./bin/mysqld
-then
-  MY_BASEDIR_VERSION=`pwd`		# Where bin, share and data are
-  DATADIR=$MY_BASEDIR_VERSION/data	# Where the databases are
-  ledir=$MY_BASEDIR_VERSION/bin		# Where mysqld is
-# Check if this is a 'moved install directory'
-elif test -f ./var/mysql/db.frm -a -f ./share/mysql/english/errmsg.sys -a \
- -x ./libexec/mysqld
-then
-  MY_BASEDIR_VERSION=`pwd`		# Where libexec, share and var are
-  DATADIR=$MY_BASEDIR_VERSION/var	# Where the databases are
-  ledir=$MY_BASEDIR_VERSION/libexec	# Where mysqld is
-else
-  MY_BASEDIR_VERSION=@@prefix@@
-  DATADIR=@@localstatedir@@
-  ledir=@@libexecdir@@
-  if test ! -x $ledir/mysqld
-  then
-    echo "The file $ledir/mysqld doesn't exist or is not executable"
-    echo "Please do a cd to the mysql installation directory and restart"
-    echo "this script from there as follows:"
-    echo "./bin/safe_mysqld".
-    exit 1;
-  fi
-fi
+MY_BASEDIR_VERSION=@@prefix@@
+DATADIR=@@localstatedir@@
+ledir=@@libexecdir@@
 
 pid_file=$DATADIR/`@@HOSTNAME@@`.pid
 log=$DATADIR/`@@HOSTNAME@@`.log
@@@@ -104,10 +80,10 @@@@
 #export MYSQL_TCP_PORT
 
 # Does this work on all systems?
-#if type ulimit | grep "shell builtin" > /dev/null
-#then
-#  ulimit -n 256 > /dev/null 2>&1		# Fix for BSD and FreeBSD systems
-#fi
+if type ulimit | grep "shell builtin" > /dev/null
+then
+  ulimit -n 256 > /dev/null 2>&1		# Fix for BSD and FreeBSD systems
+fi
 
 echo "mysqld started on " `date` >> $err_log
 while true
@@@@ -116,41 +92,14 @@@@
   if test "$#" -eq 0
   then
     nohup $ledir/mysqld --basedir=$MY_BASEDIR_VERSION --datadir=$DATADIR \
-     @@MYSQLD_DEFAULT_SWITCHES@@ >> $err_log 2>&1
+     @@MYSQLD_DEFAULT_SWITCHES@@ --user=mysql >> $err_log 2>&1
   else
     nohup $ledir/mysqld --basedir=$MY_BASEDIR_VERSION --datadir=$DATADIR \
-     @@MYSQLD_DEFAULT_SWITCHES@@ "$@@" >> $err_log 2>&1
+     @@MYSQLD_DEFAULT_SWITCHES@@ --user=mysql "$@@" >> $err_log 2>&1
   fi
   if test ! -f $pid_file		# This is removed if normal shutdown
   then
     break;
-  fi
-  if @@IS_LINUX@@
-  then
-    # Test if one process was hanging.
-    # This is only a fix for Linux (running as base 3 mysqld processes)
-    # but should work for the rest of the servers.
-    # The only thing is ps x => redhat 5 gives warnings when using ps -x.
-    # kill -9 is used or the process won't react on the kill.
-    numofproces=`ps x | grep -v "grep" | grep -c $ledir/mysqld`
-    echo -e "\nNumber of processes running now: $numofproces" | tee -a $err_log
-    I=1
-    while test "$I" -le "$numofproces"
-    do 
-      PROC=`ps x | grep $ledir/mysqld | grep -v "grep" | tail -1` 
-	for T in $PROC
-	do
-	  break
-	done
-	#    echo "TEST $I - $T **"
-	if kill -9 $T
-	then
-	  echo "mysqld process hanging, pid $T - killed" | tee -a $err_log
-	else 
-	  break
-	fi
-	I=`expr $I + 1`
-    done
   fi
   echo "mysqld restarted on " `date` | tee -a $err_log
 done
@


1.5
log
@- re-introduce DB_DIR option
- make sure MySQL is started as user mysql from safe_mysqld.sh script
instead of the example startup.sh
- hard coded /usr/local -> ${PREFIX} in MESSAGE
- use user/group commands instead of cat/adduser in INSTALL script
- ${FOO} -> $FOO in INSTALL/DEINSTALL
@
text
@@


1.4
log
@uncomment section in safe_mysqld.sh to check for and use ulimit to raise
the maximum number of open file descriptors before loading MySQL.
--
requested by ericj@@
@
text
@d2 1
a2 1
+++ scripts/safe_mysqld.sh	Wed Aug  2 00:06:21 2000
d55 11
a65 1
@@@@ -124,33 +100,6 @@@@
@


1.3
log
@upgrade to MySQL 3.22.30
@
text
@d2 1
a2 1
+++ scripts/safe_mysqld.sh	Thu Jan 13 13:17:12 2000
d40 15
@


1.3.2.1
log
@bring databases as of cut-over date into 2.7 branch
@
text
@d2 1
a2 1
+++ scripts/safe_mysqld.sh	Wed Aug  2 00:06:21 2000
a39 15
@@@@ -104,10 +80,10 @@@@
 #export MYSQL_TCP_PORT
 
 # Does this work on all systems?
-#if type ulimit | grep "shell builtin" > /dev/null
-#then
-#  ulimit -n 256 > /dev/null 2>&1		# Fix for BSD and FreeBSD systems
-#fi
+if type ulimit | grep "shell builtin" > /dev/null
+then
+  ulimit -n 256 > /dev/null 2>&1		# Fix for BSD and FreeBSD systems
+fi
 
 echo "mysqld started on " `date` >> $err_log
 while true
@


1.2
log
@- upgrade to MySQL 3.22.27
- make the default database directory a bit easier to change with the
DB_DIR variable
- add warning about possible virtual memory limit exhaustion
- change default database directory to /var/mysql and chown it to the
user:group
- integrate check_old_version script into Makefile
- we should be able to make this into a full package now, though not
tested fully
- install user:group of mysql and make MySQL load as user mysql

Reviewed and tested by: ericj@@
@
text
@d1 2
a2 2
--- scripts/safe_mysqld.sh.orig	Sun Dec 19 01:26:59 1999
+++ scripts/safe_mysqld.sh	Sun Dec 19 01:29:21 1999
d40 1
a40 1
@@@@ -117,33 +93,6 @@@@
@


1.1
log
@Initial revision
@
text
@d1 2
a2 2
--- scripts/safe_mysqld.sh.orig	Fri Nov 27 00:37:54 1998
+++ scripts/safe_mysqld.sh	Wed Dec 23 23:45:24 1998
d11 1
a11 1
-  MY_BASEDIR_VERSION=`pwd`		# Where bin, share and data is
d13 1
a13 1
-  ledir=$MY_BASEDIR_VERSION/bin		# Where mysqld are
d18 1
a18 1
-  MY_BASEDIR_VERSION=`pwd`		# Where libexec, share and var is
d20 1
a20 1
-  ledir=$MY_BASEDIR_VERSION/libexec	# Where mysqld are
d27 1
a27 1
-    echo "The file $ledir/mysqld doesn't exists or is not executable"
d29 1
a29 1
-    echo "this scrift from there as follows:"
d40 1
a40 1
@@@@ -114,33 +90,6 @@@@
d47 1
a47 1
-    # Test if one proces was hanging.
d51 1
a51 1
-    # kill -9 is used or the proces won't react on the kill.
d65 1
a65 1
-	  echo "mysqld proces hanging, pid $T - killed" | tee -a $err_log
@


1.1.1.1
log
@mysql, from freebsd via d@@openbsd.org.  Uses egcc with -pthread
said to work on i386, not tested on any other architecture
@
text
@@
