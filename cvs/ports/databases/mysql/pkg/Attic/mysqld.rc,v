head	1.13;
access;
symbols
	OPENBSD_5_6:1.12.0.14
	OPENBSD_5_6_BASE:1.12
	OPENBSD_5_5:1.12.0.12
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.12.0.10
	OPENBSD_5_4_BASE:1.12
	OPENBSD_5_3:1.12.0.8
	OPENBSD_5_3_BASE:1.12
	OPENBSD_5_2:1.12.0.6
	OPENBSD_5_2_BASE:1.12
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.4
	OPENBSD_5_0:1.12.0.2
	OPENBSD_5_0_BASE:1.12
	OPENBSD_4_9:1.10.0.2
	OPENBSD_4_9_BASE:1.10;
locks; strict;
comment	@ * @;


1.13
date	2014.10.03.10.54.55;	author brad;	state dead;
branches;
next	1.12;
commitid	l38yfxK2clf7O9UX;

1.12
date	2011.03.08.10.46.31;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2011.03.06.16.54.38;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2011.01.05.16.05.54;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2010.12.27.14.50.22;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2010.12.24.10.40.05;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2010.12.13.16.13.04;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2010.12.12.20.18.40;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2010.12.11.12.57.37;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2010.12.11.09.59.25;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.12.11.08.48.24;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.11.09.08.58.06;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.11.09.08.55.32;	author robert;	state Exp;
branches;
next	;


desc
@@


1.13
log
@So long and into the Attic you go.

ok sthen@@
@
text
@#!/bin/sh
#
# $OpenBSD: mysqld.rc,v 1.12 2011/03/08 10:46:31 ajacoutot Exp $

daemon="${TRUEPREFIX}/bin/mysqld_safe"

. /etc/rc.d/rc.subr

pexp="${TRUEPREFIX}/libexec/mysqld"
rc_bg=YES
rc_reload=NO

rc_cmd $1
@


1.12
log
@Simplify: 'mysqladmin -s ping' is not good enough for rc_check because
while the daemon is shutting down, the access will be denied but the
process will still exists until it has shutdown completely.
This allows restart to work properly.

discussed with and ok robert@@
@
text
@d3 1
a3 1
# $OpenBSD: mysqld.rc,v 1.11 2011/03/06 16:54:38 ajacoutot Exp $
@


1.11
log
@No need to override rc_start() anymore, just use rc_bg.
@
text
@d3 1
a3 1
# $OpenBSD: mysqld.rc,v 1.10 2011/01/05 16:05:54 ajacoutot Exp $
d9 1
a11 12

rc_check() {
	${TRUEPREFIX}/bin/mysqladmin -s ping >/dev/null
}

rc_stop() {
	${TRUEPREFIX}/bin/mysqladmin -s shutdown
	if [ $? -gt 0 ]; then
		pkill -f "^/bin/sh ${daemon}"
		pkill -U _mysql -f "^${TRUEPREFIX}/libexec/mysqld"
	fi
}
@


1.10
log
@Make use of rcexec.
While here, force postgresql to quit in rc_stop, ok pea@@
@
text
@d3 1
a3 1
# $OpenBSD: mysqld.rc,v 1.9 2010/12/27 14:50:22 ajacoutot Exp $
d9 1
a13 4
}

rc_start() {
	${rcexec} -c "${daemon} ${daemon_flags}" >/dev/null 2>&1 &
@


1.9
log
@Simplify after recent rc.subr change.
The framework is now stable and we will start documenting it (at last).
@
text
@d3 1
a3 1
# $OpenBSD: mysqld.rc,v 1.8 2010/12/24 10:40:05 ajacoutot Exp $
d16 1
a16 2
	su -l -c ${daemon_class} -s ${daemon_shell} ${daemon_user} \
		-c "${daemon} ${daemon_flags}" >/dev/null 2>&1 &
@


1.8
log
@Cope with recent rc.subr changes.
@
text
@d3 1
a3 3
# $OpenBSD: mysqld.rc,v 1.7 2010/12/13 16:13:04 ajacoutot Exp $

. /etc/rc.d/rc.subr
d7 1
a7 1
rc_conf
@


1.7
log
@Cope with recent rc.subr changes.
@
text
@d3 1
a3 1
# $OpenBSD: mysqld.rc,v 1.6 2010/12/12 20:18:40 jasper Exp $
d8 3
d18 2
a19 2
	su -l -c ${daemon_class:-daemon} -s ${daemon_shell:-/bin/sh} \
		${daemon_user:-root} -c "${daemon} ${daemon_flags}" >/dev/null 2>&1 &
@


1.6
log
@- unbreak rc_stop()

from frantisek holop, ok brad (MAINTAINER)
@
text
@d3 1
a3 1
# $OpenBSD: mysqld.rc,v 1.5 2010/12/11 12:57:37 ajacoutot Exp $
d15 1
a15 1
	su -c ${daemon_class:-daemon} -s ${daemon_shell:-/bin/sh} \
@


1.5
log
@Move these to rc_reload=NO.
@
text
@d3 1
a3 1
# $OpenBSD: mysqld.rc,v 1.4 2010/12/11 09:59:25 ajacoutot Exp $
d23 1
a23 1
		pkill -U _mysql -f "^${TRUEPREFIX}libexec/mysqld"
@


1.4
log
@Cope again with rc.subr changes.
@
text
@d3 1
a3 1
# $OpenBSD: mysqld.rc,v 1.3 2010/12/11 08:48:24 ajacoutot Exp $
d8 1
a11 4
}

rc_reload() {
	rc_err "$0: reload is not supported."
@


1.3
log
@Adapt to new rc_start and fix RCS Id.

ok robert@@
@
text
@d3 1
a3 1
# $OpenBSD: mysqld.rc,v 1.2 2010/11/09 08:58:06 ajacoutot Exp $
d18 2
a19 2
	su -c ${_rcclass:-daemon} -s ${_rcshell:-/bin/sh} \
		${_rcuser:-root} -c "${daemon} ${daemon_flags}" >/dev/null 2>&1 &
@


1.2
log
@Add missing RCS id. Protect variable names.
@
text
@d3 1
a3 1
# $OpenBSD$
d7 1
a7 1
daemon=${TRUEPREFIX}/bin/mysqld_safe
d18 2
a19 1
	${daemon} ${daemon_flags} >/dev/null 2>&1 &
@


1.1
log
@Add an rc script for mysqld
@
text
@d2 2
d18 1
a18 1
	$daemon $daemon_flags >/dev/null 2>&1 &
@

