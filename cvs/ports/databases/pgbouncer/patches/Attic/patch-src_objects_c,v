head	1.1;
access;
symbols
	OPENBSD_5_2:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2012.11.05.08.03.53;	author jasper;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2012.11.05.08.03.53;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-src_objects_c was initially added on branch OPENBSD_5_2.
@
text
@@


1.1.2.1
log
@Security fix for CVE-2012-4575,
pgbouncer: DoS (pooler server shutdown) by adding database with large name

ok pea@@ (MAINTAINER)
@
text
@a0 20
$OpenBSD$

Security fix for CVE-2012-4575,
pgbouncer: DoS (pooler server shutdown) by adding database with large name

--- src/objects.c.orig	Sun Nov  4 19:19:31 2012
+++ src/objects.c	Sun Nov  4 19:20:08 2012
@@@@ -303,7 +303,11 @@@@ PgDatabase *add_database(const char *name)
 			return NULL;
 
 		list_init(&db->head);
-		safe_strcpy(db->name, name, sizeof(db->name));
+		if (strlcpy(db->name, name, sizeof(db->name)) >= sizeof(db->name)) {
+			log_warning("Too long db name: %s", name);
+			slab_free(db_cache, db);
+			return NULL;
+		}
 		put_in_order(&db->head, &database_list, cmp_database);
 	}
 
@

