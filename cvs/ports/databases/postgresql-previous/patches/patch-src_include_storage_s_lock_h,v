head	1.1;
branch	1.1.1;
access;
symbols
	OPENBSD_6_1:1.1.1.1.0.2
	OPENBSD_6_1_BASE:1.1.1.1
	jeremy_2016-Dec-18:1.1.1.1
	jeremy:1.1.1;
locks; strict;
comment	@# @;


1.1
date	2016.12.18.18.13.25;	author jeremy;	state Exp;
branches
	1.1.1.1;
next	;
commitid	tINvRpNtZF0xww69;

1.1.1.1
date	2016.12.18.18.13.25;	author jeremy;	state Exp;
branches;
next	;
commitid	tINvRpNtZF0xww69;


desc
@@



1.1
log
@Initial revision
@
text
@$OpenBSD: patch-src_include_storage_s_lock_h,v 1.3 2016/02/13 21:54:28 sthen Exp $
--- src/include/storage/s_lock.h.orig	Mon Feb  8 21:15:19 2016
+++ src/include/storage/s_lock.h	Fri Feb 12 17:18:09 2016
@@@@ -749,6 +749,29 @@@@ typedef unsigned char slock_t;
 #endif
 
 
+#if defined(__m88k__)		/* Motorola 88k */
+#define HAS_TEST_AND_SET
+
+typedef unsigned int slock_t;
+
+#define TAS(lock) tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	register slock_t _res = 1;
+
+	__asm__ __volatile__(
+		"	xmem	%0, %2, %%r0\n"
+:		"=r"(_res)
+:		"0" (_res), "r"(lock)
+:		"memory");
+	return (int) _res;
+}
+
+#endif	 /* __m88k__ */
+
+
 #endif	/* defined(__GNUC__) || defined(__INTEL_COMPILER) */
 
 
@


1.1.1.1
log
@Import postgresql-previous 9.5.5

This imports the previous version of PostgreSQL supported
by the ports tree into a versioned directory.  It's
designed for use by pg_upgrade, which allows upgrading of
PostgreSQL databases without a dump and restore.

OK pea@@ landry@@

@
text
@@
