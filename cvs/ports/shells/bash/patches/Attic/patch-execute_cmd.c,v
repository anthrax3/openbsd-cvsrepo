head	1.2;
access;
symbols
	OPENBSD_3_3:1.1.0.12
	OPENBSD_3_3_BASE:1.1
	OPENBSD_3_2:1.1.0.10
	OPENBSD_3_2_BASE:1.1
	OPENBSD_3_1:1.1.0.8
	OPENBSD_3_1_BASE:1.1
	OPENBSD_3_0:1.1.0.6
	OPENBSD_3_0_BASE:1.1
	OPENBSD_2_9_TRACKING_SWITCH:1.1
	OPENBSD_2_9:1.1.0.4
	OPENBSD_2_9_BASE:1.1
	OPENBSD_2_8:1.1.0.2;
locks; strict;
comment	@ * @;


1.2
date	2003.08.22.16.38.12;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2001.01.16.22.29.27;	author brad;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2001.01.16.22.42.46;	author brad;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Remove bash1 port.  This has been entirely superseded by bash2.
Chet doesn't maintain it any longer.  It smells funny.
@
text
@--- execute_cmd.c.orig	Thu Jun  8 11:29:00 1995
+++ execute_cmd.c	Tue Jan 16 16:30:39 2001
@@@@ -2714,10 +2714,11 @@@@
 {
   WORD_DESC *redirectee = redirect->redirectee.filename;
   int redir_fd = redirect->redirectee.dest;
-  int fd, redirector = redirect->redirector;
+  int fd = -1, redirector = redirect->redirector;
   char *redirectee_word;
   enum r_instruction ri = redirect->instruction;
   REDIRECT *new_redirect;
+  mode_t um;
 
   if (ri == r_duplicating_input_word || ri == r_duplicating_output_word)
     {
@@@@ -2938,11 +2939,14 @@@@
 	  pid_t pid = getpid ();
 
 	  /* Make the filename for the temp file. */
-	  sprintf (filename, "/tmp/t%d-sh", pid);
+	  sprintf (filename, "/tmp/t-sh-XXXXXX", pid);
 
-	  fd = open (filename, O_TRUNC | O_WRONLY | O_CREAT, 0666);
-	  if (fd < 0)
+	  fd = mkstemp (filename);
+	  if (fd != -1)
 	    return (errno);
+	  um = umask (022);
+	  umask (um);
+	  fchmod (fd, 0666 & ~um);
 
 	  errno = 0;		/* XXX */
 	  if (redirectee->word)
@


1.1
log
@fix symlink race. based mostly on patch from the FreeBSD ports tree.
--
Reviewed by: beck@@
@
text
@@


1.1.2.1
log
@MFC:
fix symlink races.
@
text
@@

