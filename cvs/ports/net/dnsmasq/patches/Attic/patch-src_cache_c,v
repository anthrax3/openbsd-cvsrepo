head	1.1;
access;
symbols
	OPENBSD_5_9:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2016.06.28.11.22.39;	author jasper;	state dead;
branches
	1.1.2.1;
next	;
commitid	uYbxoHTZaLXM2QMW;

1.1.2.1
date	2016.06.28.11.22.39;	author jasper;	state Exp;
branches;
next	;
commitid	uYbxoHTZaLXM2QMW;


desc
@@


1.1
log
@file patch-src_cache_c was initially added on branch OPENBSD_5_9.
@
text
@@


1.1.2.1
log
@Fix crash when empty address from DNS overlays A record from hosts
(already in -current with 2.76)
@
text
@a0 16
$OpenBSD$

CVE-2015-8899:
http://thekelleys.org.uk/gitweb/?p=dnsmasq.git;a=commit;h=41a8d9e99be9f2cc8b02051dd322cb45e0faac87

--- src/cache.c.orig	Thu Jul 30 21:59:07 2015
+++ src/cache.c	Tue Jun 28 13:21:10 2016
@@@@ -481,7 +481,7 @@@@ struct crec *cache_insert(char *name, struct all_addr 
 	 existing record is for an A or AAAA and
 	 the record we're trying to insert is the same, 
 	 just drop the insert, but don't error the whole process. */
-      if ((flags & (F_IPV4 | F_IPV6)) && (flags & F_FORWARD))
+      if ((flags & (F_IPV4 | F_IPV6)) && (flags & F_FORWARD) && addr)
 	{
 	  if ((flags & F_IPV4) && (new->flags & F_IPV4) &&
 	      new->addr.addr.addr.addr4.s_addr == addr->addr.addr4.s_addr)
@

