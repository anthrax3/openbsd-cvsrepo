head	1.2;
access;
symbols
	OPENBSD_6_1:1.2.0.16
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.14
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.10
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.12
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.8
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.6
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.4
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.2
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.1.0.2
	OPENBSD_5_3_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2013.03.04.04.30.35;	author lteo;	state Exp;
branches;
next	1.1;

1.1
date	2012.10.13.02.56.15;	author lteo;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update oinkmaster.conf to use HTTPS for the sample snort.org URLs to
protect the oinkcode from being exposed.  Also update the Snort version
in the URLs to 2.9.4.0 to match the current version of our Snort port.

Tweak the regexp that oinkmaster uses to validate HTTPS URLs so that it
won't treat a bad URL that starts with httpsssss:// as valid (this
regexp tweak was jointly worked on by me and maintainer).

regexp feedback zhuk@@
OK Markus Lude (maintainer), earlier version OK sthen@@
@
text
@$OpenBSD: patch-oinkmaster_pl,v 1.1 2012/10/13 02:56:15 lteo Exp $
--- oinkmaster.pl.orig	Sat Feb 18 13:35:21 2006
+++ oinkmaster.pl	Thu Feb  7 22:16:27 2013
@@@@ -770,7 +770,8 @@@@ sub sanity_check()
     $#{$config{url}} = -1;
     foreach my $url (@@urls) {
         clean_exit("incorrect URL: \"$url\"")
-          unless ($url =~ /^((?:https*|ftp|file|scp):\/\/.+\.(?:tar\.gz|tgz))$/
+          unless ($url =~ /^((?:https?|ftp|file|scp):\/\/.+\.(?:tar\.gz|tgz))$/
+            || $url =~ /^((?:https?):\/\/www\.snort\.org\/(sub|reg)-rules\/.+\.tar\.gz\/[0-9a-f]{40})$/
             || $url =~ /^(dir:\/\/.+)/);
         my $ok_url = $1;
 
@@@@ -791,7 +792,7 @@@@ sub sanity_check()
   # Wget must be found if url is http[s]:// or ftp://.
     if ($config{use_external_bins}) {
         clean_exit("wget not found in PATH ($ENV{PATH}).")
-          if ($config{'url'} =~ /^(https*|ftp):/ && !is_in_path("wget"));
+          if ($config{'url'} =~ /^(https?|ftp):/ && !is_in_path("wget"));
     }
 
   # scp must be found if scp://...
@@@@ -895,7 +896,7 @@@@ sub download_file($ $)
     @@user_agent_opt = ("-U", $config{user_agent}) if (exists($config{user_agent}));
 
   # Use wget if URL starts with "http[s]" or "ftp" and we use external binaries.
-    if ($config{use_external_bins} && $url =~ /^(?:https*|ftp)/) {
+    if ($config{use_external_bins} && $url =~ /^(?:https?|ftp)/) {
         print STDERR "Downloading file from $obfuscated_url... "
           unless ($config{quiet});
 
@@@@ -925,7 +926,7 @@@@ sub download_file($ $)
         }
 
   # Use LWP if URL starts with "http[s]" or "ftp" and use_external_bins=0.
-    } elsif (!$config{use_external_bins} && $url =~ /^(?:https*|ftp)/) {
+    } elsif (!$config{use_external_bins} && $url =~ /^(?:https?|ftp)/) {
         print STDERR "Downloading file from $obfuscated_url... "
           unless ($config{quiet});
 
@


1.1
log
@Update/add URLs in oinkmaster.conf to ones that actually work today,
including URLs for registered users and subscribers of Snort.org
(suggested by Markus Lude who is taking maintainership of this port).

Also extend the URL regex check in the oinkmaster Perl script to
recognize an official Snort.org download URL.

OK Markus Lude (new maintainer) dcoppa@@ sthen@@
@
text
@d1 5
a5 4
$OpenBSD$
--- oinkmaster.pl.orig	Sat Feb 18 07:35:21 2006
+++ oinkmaster.pl	Sun Oct  7 21:54:11 2012
@@@@ -771,6 +771,7 @@@@ sub sanity_check()
d8 3
a10 2
           unless ($url =~ /^((?:https*|ftp|file|scp):\/\/.+\.(?:tar\.gz|tgz))$/
+            || $url =~ /^((?:https*):\/\/www\.snort\.org\/(sub|reg)-rules\/.+\.tar\.gz\/[0-9a-f]{40})$/
d13 27
@

