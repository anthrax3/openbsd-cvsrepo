head	1.2;
access;
symbols
	OPENBSD_3_7:1.1.0.2
	OPENBSD_3_7_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2005.04.17.19.25.53;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2005.01.30.19.48.02;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to 1.1.
Input from Pavlin Radoslavov.
@
text
@$OpenBSD: patch-bgp_route_table_nhlookup_cc,v 1.1 2005/01/30 19:48:02 naddy Exp $
--- bgp/route_table_nhlookup.cc.orig	Thu Jun 10 16:40:35 2004
+++ bgp/route_table_nhlookup.cc	Sun Jan 30 09:20:00 2005
@@@@ -261,8 +261,9 @@@@ NhLookupTable<A>::delete_route(const Int
 	// there was an entry for this net in our queue awaiting
 	// resolution of it's nexthop
 
-	bool dont_send_delete;
-	if (mqe->type() == MessageQueueEntry<A>::REPLACE) {
+	bool dont_send_delete = true;
+	switch (mqe->type()) {
+	case MessageQueueEntry<A>::REPLACE: {
 	    // preserve the old delete message
 	    InternalMessage<A>* preserve_msg
 		= new InternalMessage<A>(mqe->delete_msg()->route(),
@@@@ -272,8 +273,12 @@@@ NhLookupTable<A>::delete_route(const Int
 		preserve_msg->set_changed();
 	    real_msg = preserve_msg;
 	    dont_send_delete = false;
-	} else if (mqe->type() == MessageQueueEntry<A>::ADD) {
+	    break;
+	    }
+
+	case MessageQueueEntry<A>::ADD:
 	    dont_send_delete = true;
+	    break;
 	}
 
 	// we can now remove the old queue entry, because it's no longer
@


1.1
log
@enable building with compiler optimization flags
@
text
@d1 1
a1 1
$OpenBSD$
@

