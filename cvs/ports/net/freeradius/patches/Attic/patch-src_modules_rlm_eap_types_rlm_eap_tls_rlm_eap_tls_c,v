head	1.3;
access;
symbols
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_2:1.1.0.2;
locks; strict;
comment	@# @;


1.3
date	2015.06.23.21.38.06;	author sthen;	state dead;
branches;
next	1.2;
commitid	aHZZNX1Gfi6tXBO6;

1.2
date	2015.01.03.13.20.25;	author sthen;	state Exp;
branches;
next	1.1;
commitid	p7tGnAW7aS5mVqVM;

1.1
date	2012.09.16.13.47.33;	author sthen;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2012.09.16.13.47.33;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to freeradius-2.2.7, rolling in some patches committed upstream and
removing some which are no longer needed. ok pea@@ (maintainer).

add a patch from upstream git (noticed after ok) fixing one of the default
config files.
@
text
@$OpenBSD: patch-src_modules_rlm_eap_types_rlm_eap_tls_rlm_eap_tls_c,v 1.2 2015/01/03 13:20:25 sthen Exp $

From 88d032d68bb314a9b5942135a5d587219ec1ce1a Mon Sep 17 00:00:00 2001
From: "Alan T. DeKok" <aland@@freeradius.org>
Date: Wed, 31 Dec 2014 08:25:13 -0500
Subject: [PATCH] Sometimes we don't need to generate ephemeral RSA keys

--- src/modules/rlm_eap/types/rlm_eap_tls/rlm_eap_tls.c.orig	Tue Nov 18 19:56:52 2014
+++ src/modules/rlm_eap/types/rlm_eap_tls/rlm_eap_tls.c	Fri Jan  2 22:39:22 2015
@@@@ -202,6 +202,8 @@@@ static int generate_eph_rsa_key(SSL_CTX *ctx)
 {
 	RSA *rsa;
 
+	if (!SSL_CTX_need_tmp_RSA(ctx)) return 0;
+
 	rsa = RSA_generate_key(512, RSA_F4, NULL, NULL);
 
 	if (!SSL_CTX_set_tmp_rsa(ctx, rsa)) {
@


1.2
log
@update to freeradius 2.2.6, plus a few patches from upstream, notably
one fixing use with libressl (simplified by upstream from a diff written by
Kapetanakis Giannis). ok aja@@ pea@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@file patch-src_modules_rlm_eap_types_rlm_eap_tls_rlm_eap_tls_c was initially added on branch OPENBSD_5_2.
@
text
@d1 18
@


1.1.2.1
log
@backport fix for CVE-2012-3547 in freeradius.  ok pea@@

From http://freeradius.org/security.html, "All sites using TLS-based
EAP methods and the above versions are vulnerable. The only configuration
change which can avoid the issue is to disable EAP-TLS, EAP-TTLS, and PEAP.

An external attacker can use this vulnerability to over-write the
stack frame of the RADIUS server, and cause it to crash. In addition,
more sophisticated attacks may gain additional privileges on the
system running the RADIUS server.

This attack does not require local network access to the RADIUS
server. It can be done by an attacker through a WiFi Access Point,
so long as the Access Point is configured to use 802.1X authentication
with the RADIUS server."
@
text
@a0 17
$OpenBSD$

Fix CVE-2012-3547

https://github.com/alandekok/freeradius-server/commit/78e5aed56c36a9231bc91ea5f55b3edf88a9d2a4

--- src/modules/rlm_eap/types/rlm_eap_tls/rlm_eap_tls.c.orig	Sun Sep 16 11:36:20 2012
+++ src/modules/rlm_eap/types/rlm_eap_tls/rlm_eap_tls.c	Sun Sep 16 11:37:34 2012
@@@@ -531,7 +531,7 @@@@ static int cbtls_verify(int ok, X509_STORE_CTX *ctx)
 	 */
 	buf[0] = '\0';
 	asn_time = X509_get_notAfter(client_cert);
-	if ((lookup <= 1) && asn_time && (asn_time->length < MAX_STRING_LEN)) {
+	if ((lookup <= 1) && asn_time && (asn_time->length < sizeof(buf))) {
 		memcpy(buf, (char*) asn_time->data, asn_time->length);
 		buf[asn_time->length] = '\0';
 		pairadd(&handler->certs,
@

