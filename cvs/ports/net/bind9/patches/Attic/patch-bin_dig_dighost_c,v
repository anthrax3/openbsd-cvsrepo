head	1.2;
access;
symbols
	OPENBSD_3_3:1.1.0.2
	OPENBSD_3_3_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2003.05.23.16.30.37;	author jakob;	state dead;
branches;
next	1.1;

1.1
date	2003.01.25.14.14.37;	author jakob;	state Exp;
branches;
next	;


desc
@@


1.2
log
@remove bind9 port. no longer maintained. also comes with 3.3.
@
text
@$OpenBSD: patch-bin_dig_dighost_c,v 1.1 2003/01/25 14:14:37 jakob Exp $
--- bin/dig/dighost.c.orig	Tue Aug  6 04:40:11 2002
+++ bin/dig/dighost.c	Tue Jan 21 08:55:12 2003
@@@@ -54,6 +54,7 @@@@
 #include <isc/netaddr.h>
 #include <isc/netdb.h>
 #include <isc/print.h>
+#include <isc/random.h>
 #include <isc/result.h>
 #include <isc/string.h>
 #include <isc/task.h>
@@@@ -689,7 +690,6 @@@@ setup_libs(void) {
 	 * just use random() now for getting id values, but doing so
 	 * does NOT ensure that id's can't be guessed.
 	 */
-	srandom(getpid());
 
 	result = isc_net_probeipv4();
 	if (result == ISC_R_SUCCESS)
@@@@ -1162,6 +1162,7 @@@@ insert_soa(dig_lookup_t *lookup) {
 void
 setup_lookup(dig_lookup_t *lookup) {
 	isc_result_t result;
+	isc_uint32_t id;
 	int len;
 	dig_server_t *serv;
 	dig_query_t *query;
@@@@ -1275,7 +1276,8 @@@@ setup_lookup(dig_lookup_t *lookup) {
 	trying(store, lookup);
 	INSIST(dns_name_isabsolute(lookup->name));
 
-	lookup->sendmsg->id = (unsigned short)(random() & 0xFFFF);
+	isc_random_get(&id);
+	lookup->sendmsg->id = (unsigned short)id & 0xFFFF;
 	lookup->sendmsg->opcode = dns_opcode_query;
 	lookup->msgcounter = 0;
 	/*
@


1.1
log
@split into -libs and -server packages
sync patches with OpenBSD-current
use autoconf to regenerate configure script
do not installed examples (soon part of base)
remove the bind9-{enable,disable} scripts
@
text
@d1 1
a1 1
$OpenBSD$
@

