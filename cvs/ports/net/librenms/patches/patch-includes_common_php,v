head	1.15;
access;
symbols
	OPENBSD_6_1:1.9.0.2
	OPENBSD_6_1_BASE:1.9
	OPENBSD_6_0:1.4.0.2
	OPENBSD_6_0_BASE:1.4;
locks; strict;
comment	@# @;


1.15
date	2017.08.29.11.43.55;	author sthen;	state Exp;
branches;
next	1.14;
commitid	qyxTNm1ysfrr2ZaS;

1.14
date	2017.08.28.11.47.03;	author sthen;	state Exp;
branches;
next	1.13;
commitid	j1HKcwDrHhlNhUYY;

1.13
date	2017.07.30.17.05.54;	author sthen;	state Exp;
branches;
next	1.12;
commitid	UjZBQycSePTTk9Ux;

1.12
date	2017.05.30.21.05.44;	author sthen;	state Exp;
branches;
next	1.11;
commitid	29PnV8sTd6W6IzmD;

1.11
date	2017.05.05.09.37.13;	author sthen;	state Exp;
branches;
next	1.10;
commitid	8keIwNOmv0Sm6nVM;

1.10
date	2017.05.01.13.22.18;	author sthen;	state Exp;
branches;
next	1.9;
commitid	M9VxMnRB6z7pVZbZ;

1.9
date	2017.02.28.00.21.32;	author sthen;	state Exp;
branches;
next	1.8;
commitid	fzDi7jQ6jgitZlhj;

1.8
date	2017.01.31.22.43.30;	author sthen;	state Exp;
branches;
next	1.7;
commitid	7YyKHgdYeeAFDCn1;

1.7
date	2016.12.14.21.37.03;	author sthen;	state Exp;
branches;
next	1.6;
commitid	pDUP1hXyeGsONhFm;

1.6
date	2016.10.14.12.48.55;	author sthen;	state Exp;
branches;
next	1.5;
commitid	pXrhZsM4ju8rWl8K;

1.5
date	2016.08.19.14.39.04;	author sthen;	state Exp;
branches;
next	1.4;
commitid	1DqdKaMKNrvWjk4y;

1.4
date	2016.07.08.16.07.22;	author sthen;	state Exp;
branches;
next	1.3;
commitid	T3l9rYrejU03VItu;

1.3
date	2016.06.20.15.12.42;	author sthen;	state Exp;
branches;
next	1.2;
commitid	dGEgzdMU83elTTEV;

1.2
date	2016.05.06.19.31.08;	author sthen;	state Exp;
branches;
next	1.1;
commitid	6W7Ad1YO4vJbqdrN;

1.1
date	2016.03.07.17.49.10;	author sthen;	state Exp;
branches;
next	;
commitid	nvYnpK2evrlEDVSV;


desc
@@


1.15
log
@bugfix update to librenms-1.31.01
@
text
@$OpenBSD: patch-includes_common_php,v 1.14 2017/08/28 11:47:03 sthen Exp $

Index: includes/common.php
--- includes/common.php.orig
+++ includes/common.php
@@@@ -1122,7 +1122,11 @@@@ function version_info($remote = true)
         $output['local_sha']    = $local_sha;
         $output['local_date']   = $local_date;
         $output['local_branch'] = rtrim(`git rev-parse --abbrev-ref HEAD`);
+    } else {
+        $output['local_ver']    = '%LNMS_VERSION%';
+        $output['local_date']   = filemtime($config['install_dir'].'/CHANGELOG');
     }
+
     $output['db_schema']   = get_db_schema() ?: '?';
     $output['php_ver']     = phpversion();
     $output['mysql_ver']   = dbIsConnected() ? dbFetchCell('SELECT version()') : '?';
@@@@ -1130,7 +1134,7 @@@@ function version_info($remote = true)
         ($config['rrdtool'] ?: 'rrdtool') . ' --version |head -n1'
     )), 1, 1)));
     $output['netsnmp_ver'] = str_replace('version: ', '', rtrim(shell_exec(
-        ($config['snmpget'] ?: 'snmpget').' --version 2>&1'
+        ($config['snmpget'] ?: 'snmpget').' -V 2>&1'
     )));
 
     return $output;
@@@@ -1713,12 +1717,7 @@@@ function set_numeric($value, $default = 0)
 
 function check_git_exists()
 {
-    exec('git > /dev/null 2>&1', $response, $exit_code);
-    if ($exit_code === 1) {
-        return true;
-    } else {
-        return false;
-    }
+    return false;
 }
 
 function get_vm_parent_id($device)
@


1.14
log
@update to librenms-1.31
@
text
@d1 1
a1 1
$OpenBSD: patch-includes_common_php,v 1.13 2017/07/30 17:05:54 sthen Exp $
d27 1
a27 1
@@@@ -1722,12 +1726,7 @@@@ function set_numeric($value, $default = 0)
@


1.13
log
@update to LibreNMS 1.30, including fdb table searches on many switches,
yaml-based sensor definitions, suport for many additional sensor types,
and more.  https://github.com/librenms/librenms/releases
@
text
@d1 1
a1 1
$OpenBSD: patch-includes_common_php,v 1.12 2017/05/30 21:05:44 sthen Exp $
d27 1
a27 1
@@@@ -1708,12 +1712,7 @@@@ function set_numeric($value, $default = 0)
@


1.12
log
@update to librenms-1.28, many nice improvements including:
- major overhaul of wireless sensors
- faster page/graph generation
- lots of additional device support as usual
@
text
@d1 1
a1 1
$OpenBSD$
d6 1
a6 1
@@@@ -1100,12 +1100,14 @@@@ function version_info($remote = true)
d11 2
a12 1
+	$output['local_date']   = filemtime($config['install_dir'].'/CHANGELOG');
d14 2
a15 1
     $output['db_schema']   = get_db_schema();
d17 8
a24 4
     $output['mysql_ver']   = dbFetchCell('SELECT version()');
     $output['rrdtool_ver'] = implode(' ', array_slice(explode(' ', shell_exec($config['rrdtool'].' --version |head -n1')), 1, 1));
-    $output['netsnmp_ver'] = str_replace('version: ', '', rtrim(shell_exec($config['snmpget'].' --version 2>&1')));
+    $output['netsnmp_ver'] = str_replace('version: ', '', rtrim(shell_exec($config['snmpget'].' -V 2>&1')));
d27 1
a27 2
 }//end version_info()
@@@@ -1682,12 +1684,7 @@@@ function set_numeric($value, $default = 0)
@


1.11
log
@fix version display on librenms' "about" page
@
text
@d1 2
a2 1
$OpenBSD: patch-includes_common_php,v 1.10 2017/05/01 13:22:18 sthen Exp $
d6 1
a6 1
@@@@ -1102,12 +1102,14 @@@@ function version_info($remote = true)
d22 1
a22 1
@@@@ -1643,12 +1645,7 @@@@ function set_numeric($value, $default = 0)
@


1.10
log
@update to librenms-1.27
@
text
@d1 2
a2 1
$OpenBSD: patch-includes_common_php,v 1.9 2017/02/28 00:21:32 sthen Exp $
d5 8
a12 1
@@@@ -1107,7 +1107,7 @@@@ function version_info($remote = true)
d21 14
@


1.9
log
@update to LibreNMS 1.25

- now includes SVG graph support, this can be enabled in the UI from
global settings -> webui settings -> graph settings
@
text
@d1 4
a4 16
$OpenBSD: patch-includes_common_php,v 1.8 2017/01/31 22:43:30 sthen Exp $
--- includes/common.php.orig	Sun Feb 26 23:11:52 2017
+++ includes/common.php	Sun Feb 26 23:12:00 2017
@@@@ -1098,16 +1098,15 @@@@ function version_info($remote = true)
             curl_setopt($api, CURLOPT_CONNECTTIMEOUT, 5);
             $output['github'] = json_decode(curl_exec($api), true);
         }
-        list($local_sha, $local_date) = explode('|', rtrim(`git show --pretty='%H|%ct' -s HEAD`));
-        $output['local_sha']    = $local_sha;
-        $output['local_date']   = $local_date;
-        $output['local_branch'] = rtrim(`git rev-parse --abbrev-ref HEAD`);
+        $output['local_sha']    = '';
+        $output['local_date']   = '';
+        $output['local_branch'] = '';
     }
     $output['db_schema']   = dbFetchCell('SELECT version FROM dbSchema');
@


1.8
log
@update to librenms-1.24

reluctantly add a run dep on bash, it's getting to be a bit of a maintenance
problem to keep patching daily.sh to work with ksh.
@
text
@d1 5
a5 5
$OpenBSD$
--- includes/common.php.orig	Tue Jan 31 16:57:12 2017
+++ includes/common.php	Tue Jan 31 22:12:11 2017
@@@@ -1095,16 +1095,15 @@@@ function version_info($remote = true)
             curl_setopt($api, CURLOPT_RETURNTRANSFER, 1);
@


1.7
log
@update to librenms-1.22.01
@
text
@d1 14
a14 6
$OpenBSD: patch-includes_common_php,v 1.6 2016/10/14 12:48:55 sthen Exp $
--- includes/common.php.orig	Wed Dec 14 17:47:31 2016
+++ includes/common.php	Wed Dec 14 17:55:30 2016
@@@@ -1109,16 +1109,15 @@@@ function version_info($remote = true)
         curl_setopt($api, CURLOPT_RETURNTRANSFER, 1);
         $output['github'] = json_decode(curl_exec($api), true);
a15 8
-    list($local_sha, $local_date) = explode('|', rtrim(`git show --pretty='%H|%ct' -s HEAD`));
-    $output['local_sha']    = $local_sha;
-    $output['local_date']   = $local_date;
-    $output['local_branch'] = rtrim(`git rev-parse --abbrev-ref HEAD`);
+    $output['local_sha']    = '';
+    $output['local_date']   = '';
+    $output['local_branch'] = '';
 
@


1.6
log
@update to librenms-201609
@
text
@d1 3
a3 3
$OpenBSD: patch-includes_common_php,v 1.5 2016/08/19 14:39:04 sthen Exp $
--- includes/common.php.orig	Fri Oct 14 13:25:21 2016
+++ includes/common.php	Fri Oct 14 13:28:06 2016
d20 2
a21 2
-    $output['netsnmp_ver'] = shell_exec($config['snmpget'].' --version 2>&1');
+    $output['netsnmp_ver'] = shell_exec($config['snmpget'].' -V 2>&1');
@


1.5
log
@update to LibreNMS 201608
@
text
@d1 4
a4 4
$OpenBSD: patch-includes_common_php,v 1.4 2016/07/08 16:07:22 sthen Exp $
--- includes/common.php.orig	Fri Aug 12 14:22:24 2016
+++ includes/common.php	Fri Aug 12 14:24:53 2016
@@@@ -1038,16 +1038,15 @@@@ function version_info($remote=true) {
d6 1
a6 1
         $output['github'] = json_decode(curl_exec($api),true);
d8 1
a8 1
-    list($local_sha, $local_date) = explode('|', rtrim(`git show --pretty='%H|%ci' -s HEAD`));
d24 1
a24 1
 
@


1.4
log
@update to LibreNMS 201607
@
text
@d1 4
a4 4
$OpenBSD: patch-includes_common_php,v 1.3 2016/06/20 15:12:42 sthen Exp $
--- includes/common.php.orig	Wed Jul  6 15:37:58 2016
+++ includes/common.php	Wed Jul  6 15:39:37 2016
@@@@ -1036,14 +1036,14 @@@@ function version_info($remote=true) {
d8 3
a10 1
-    $output['local_sha']    = rtrim(`git rev-parse HEAD`);
d13 1
@


1.3
log
@update to LibreNMS 201606
@
text
@d1 4
a4 4
$OpenBSD: patch-includes_common_php,v 1.2 2016/05/06 19:31:08 sthen Exp $
--- includes/common.php.orig	Mon Jun 20 14:49:32 2016
+++ includes/common.php	Mon Jun 20 14:49:35 2016
@@@@ -1036,18 +1036,17 @@@@ function version_info($remote=true) {
a11 6
 
-    exec('git diff --name-only --exit-code', $cmdoutput, $code);
-    $output['git_modified'] = ($code !== 0);
-    $output['git_modified_files'] = $cmdoutput;
+    $output['git_modified'] = 0;
+    $output['git_modified_files'] = '';
@


1.2
log
@update to librenms-201605
@
text
@d1 4
a4 4
$OpenBSD: patch-includes_common_php,v 1.1 2016/03/07 17:49:10 sthen Exp $
--- includes/common.php.orig	Tue May  3 12:24:33 2016
+++ includes/common.php	Tue May  3 12:27:00 2016
@@@@ -1041,18 +1041,17 @@@@ function version_info($remote=true) {
@


1.1
log
@don't use `git rev-parse HEAD`, it's not going to work on a
non-git-checkout as used in the package anyway (and users may
not have git installed, so there's an ugly error message).

use snmpget -V instead of --version, long getopt doesn't
seem to be working at least with 5.7.3 on OpenBSD.
@
text
@d1 4
a4 4
$OpenBSD$
--- includes/common.php.orig	Mon Mar  7 17:28:11 2016
+++ includes/common.php	Mon Mar  7 17:45:50 2016
@@@@ -1073,12 +1073,12 @@@@ function version_info($remote=true) {
d8 11
a18 2
-    $output['local_sha']   = chop(`git rev-parse HEAD`);
+    $output['local_sha']   = '';
@

