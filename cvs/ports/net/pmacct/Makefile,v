head	1.24;
access;
symbols
	OPENBSD_6_1:1.22.0.2
	OPENBSD_6_1_BASE:1.22
	OPENBSD_6_0:1.21.0.2
	OPENBSD_6_0_BASE:1.21
	OPENBSD_5_9:1.20.0.4
	OPENBSD_5_9_BASE:1.20
	OPENBSD_5_8:1.20.0.6
	OPENBSD_5_8_BASE:1.20
	OPENBSD_5_7:1.20.0.2
	OPENBSD_5_7_BASE:1.20
	OPENBSD_5_6:1.19.0.2
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.18.0.2
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.17.0.2
	OPENBSD_5_4_BASE:1.17
	OPENBSD_5_3:1.13.0.4
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.13.0.2
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.2
	OPENBSD_5_0:1.9.0.2
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_9:1.8.0.2
	OPENBSD_4_9_BASE:1.8
	OPENBSD_4_8:1.5.0.2
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.3.0.2
	OPENBSD_4_7_BASE:1.3
	sthen_20091003:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.24
date	2017.07.16.19.18.58;	author espie;	state Exp;
branches;
next	1.23;
commitid	tt0GhWK5c4uf9ILG;

1.23
date	2017.04.10.11.46.32;	author sthen;	state Exp;
branches;
next	1.22;
commitid	HY6VNZxjJWzKQFDV;

1.22
date	2016.09.23.09.16.57;	author sthen;	state Exp;
branches;
next	1.21;
commitid	XLnI6AbHAmyVU5mO;

1.21
date	2016.06.02.11.52.32;	author sthen;	state Exp;
branches;
next	1.20;
commitid	xWy08Q4Wf07QyLlo;

1.20
date	2014.09.13.18.09.21;	author brad;	state Exp;
branches;
next	1.19;
commitid	PpbRjVZdAmlrmi8q;

1.19
date	2014.03.22.23.05.43;	author sthen;	state Exp;
branches;
next	1.18;

1.18
date	2013.10.15.10.29.46;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2013.06.12.20.36.34;	author brad;	state Exp;
branches;
next	1.16;

1.16
date	2013.06.01.14.18.40;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2013.05.25.00.33.10;	author brad;	state Exp;
branches;
next	1.14;

1.14
date	2013.03.11.11.35.55;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2012.04.26.06.33.15;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2012.04.23.17.15.18;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2011.12.12.12.07.19;	author jasper;	state Exp;
branches;
next	1.10;

1.10
date	2011.09.16.11.13.39;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2011.04.12.11.32.50;	author sthen;	state Exp;
branches;
next	1.8;

1.8
date	2010.11.19.22.31.37;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2010.11.11.16.27.55;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2010.08.17.19.51.18;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2010.06.01.19.11.23;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2010.04.15.09.15.06;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2010.03.02.08.17.16;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2009.10.30.21.33.49;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2009.10.03.18.54.44;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.10.03.18.54.44;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.24
log
@use COMPILER_LIBCXX where applicable
@
text
@# $OpenBSD: Makefile,v 1.23 2017/04/10 11:46:32 sthen Exp $

COMMENT=	IP accounting software

DISTNAME=	pmacct-1.5.3
REVISION=	0
CATEGORIES=	net

HOMEPAGE=	http://www.pmacct.net/

# GPLv2
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB=	c m pcap pthread sqlite3>=8 z

MASTER_SITES=	${HOMEPAGE}

NO_TEST=	Yes
CONFIGURE_STYLE= autoconf no-autoheader
AUTOCONF_VERSION= 2.13
USE_GMAKE=	Yes
CONFIGURE_ARGS= --enable-ipv6 \
		--enable-sqlite3 \
		--with-sqlite3-includes="${LOCALBASE}/include"
.ifdef DEBUG
MAKE_ARGS+=	DEBUG=1
.endif

FLAVORS=	mysql postgresql
FLAVOR?=

LIB_DEPENDS+=	databases/sqlite3

.if ${FLAVOR:Mpostgresql}
LIB_DEPENDS+=	databases/postgresql
WANTLIB +=	pq>=2
CONFIGURE_ARGS+= --enable-pgsql \
		--with-pgsql-includes="${LOCALBASE}/include/postgresql/"
.else
CONFIGURE_ARGS+= --disable-pgsql
.endif

.if ${FLAVOR:Mmysql}
LIB_DEPENDS+=	databases/mariadb
WANTLIB +=	lib/mysql/mysqlclient ${COMPILER_LIBCXX}
CONFIGURE_ARGS+= --enable-mysql
.else
CONFIGURE_ARGS+= --disable-mysql
.endif

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/pmacct
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/pmacct/sql
	${INSTALL_DATA} ${WRKSRC}/{CONFIG-KEYS,FAQS,QUICKSTART,TOOLS,UPGRADE} \
	    ${PREFIX}/share/doc/pmacct/
	${INSTALL_DATA} ${WRKSRC}/docs/* ${PREFIX}/share/doc/pmacct/
	cp -r ${WRKSRC}/examples/* ${PREFIX}/share/examples/pmacct/
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share/examples/pmacct/
	chmod -R a+rX ${PREFIX}/share/examples/pmacct/
	${INSTALL_DATA} ${WRKSRC}/sql/README* ${PREFIX}/share/doc/pmacct/
	${INSTALL_DATA} `find ${WRKSRC}/sql -type f \! -name README*` \
	    ${PREFIX}/share/examples/pmacct/sql/

.include <bsd.port.mk>
@


1.23
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2016/09/23 09:16:57 sthen Exp $
d45 1
a45 1
WANTLIB +=	lib/mysql/mysqlclient ${LIBCXX}
@


1.22
log
@Cope with moving sqlite3 back to ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2016/06/02 11:52:32 sthen Exp $
d45 1
a45 1
WANTLIB +=	lib/mysql/mysqlclient stdc++
@


1.21
log
@update to pmacct-1.5.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2014/09/13 18:09:21 brad Exp $
d6 1
d24 1
a24 1
		--with-sqlite3-includes="/usr/include"
d31 2
@


1.20
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2014/03/22 23:05:43 sthen Exp $
d5 1
a5 2
DISTNAME=	pmacct-1.5.0rc2
REVISION=	0
d20 1
a27 1
CONFIGURE_ENV += ac_cv_prog_MAKE="/usr/bin/make"
d42 1
a42 1
WANTLIB +=	lib/mysql/mysqlclient
@


1.19
log
@Update to pmacct 1.5.0rc2 (old version in the ports tree could read
netflow v9 but not IPFIX). Follow upstream and use threads by default,
roll in the flavour with an @@pkgpath (though we didn't build packages
with threads enabled anyway).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2013/10/15 10:29:46 espie Exp $
d6 1
d42 2
a43 2
LIB_DEPENDS+=	databases/mysql
WANTLIB +=	lib/mysql/mysqlclient>=10
@


1.18
log
@fix sloppy check
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2013/06/12 20:36:34 brad Exp $
d5 1
a5 2
DISTNAME=	pmacct-0.12.5
REVISION=	4
d13 1
a13 1
WANTLIB=	c m pcap z sqlite3>=8
d18 3
a20 3
CONFIGURE_STYLE=gnu
CONFIGURE_ARGS= --enable-64bit \
		--enable-ipv6 \
d28 1
a28 1
FLAVORS=	mysql postgresql threads
a47 7
.if ${FLAVOR:Mthreads}
WANTLIB += pthread
CONFIGURE_ARGS+= --enable-threads
.else
CONFIGURE_ARGS+= --disable-threads
.endif

d51 2
a52 2
	${INSTALL_DATA} ${WRKSRC}/CONFIG-KEYS ${PREFIX}/share/doc/pmacct/
	${INSTALL_DATA} ${WRKSRC}/EXAMPLES ${PREFIX}/share/doc/pmacct/
d54 3
a56 1
	${INSTALL_DATA} ${WRKSRC}/examples/* ${PREFIX}/share/examples/pmacct/
@


1.17
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2013/06/01 14:18:40 ajacoutot Exp $
d23 1
a23 2
		--with-sqlite3-includes="/usr/include" \
		ac_cv_prog_MAKE="/usr/bin/make"
d28 1
@


1.16
log
@Remove pthread patches.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2013/05/25 00:33:10 brad Exp $
d6 1
a6 1
REVISION=	3
d42 1
a42 1
LIB_DEPENDS+=	databases/mariadb
@


1.15
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2013/03/11 11:35:55 espie Exp $
d6 1
a6 1
REVISION=	2
@


1.14
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2012/04/26 06:33:15 espie Exp $
d6 1
a6 1
REVISION=	1
d42 1
a42 1
LIB_DEPENDS+=	databases/mysql
@


1.13
log
@fix sqlite headers location
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2012/04/23 17:15:18 espie Exp $
a12 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d18 1
a18 1
NO_REGRESS=	Yes
@


1.12
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/12/12 12:07:19 jasper Exp $
d26 1
a26 1
		--with-sqlite3-includes="${LOCALBASE}/include" \
d35 1
a35 1
.if ${FLAVOR:L:Mpostgresql}
d44 1
a44 1
.if ${FLAVOR:L:Mmysql}
d52 1
a52 1
.if ${FLAVOR:L:Mthreads}
@


1.11
log
@- be sure not to pickup gmake
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/09/16 11:13:39 espie Exp $
d6 1
a6 1
REVISION=	0
a19 2

LIB_DEPENDS+=	databases/sqlite3
@


1.10
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/04/12 11:32:50 sthen Exp $
d6 1
a6 1
REVISION=		0
d28 2
a29 1
		--with-sqlite3-includes="${LOCALBASE}/include"
@


1.9
log
@update pmacct to 0.12.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/11/19 22:31:37 espie Exp $
d6 1
@


1.8
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/11/11 16:27:55 espie Exp $
d5 1
a5 1
DISTNAME=	pmacct-0.12.3
d22 1
@


1.7
log
@new WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/08/17 19:51:18 sthen Exp $
d16 1
a16 1
WANTLIB=	c m pcap z sqlite3.>=8
d20 1
a20 1
LIB_DEPENDS+=	::databases/sqlite3
d35 2
a36 2
LIB_DEPENDS+=	::databases/postgresql
WANTLIB +=	pq.>=2
d44 2
a45 2
LIB_DEPENDS+=	::databases/mysql
WANTLIB +=	lib/mysql/mysqlclient.>=10
@


1.6
log
@update pmacct to 0.12.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/06/01 19:11:23 sthen Exp $
d16 1
a16 1
WANTLIB=	c m pcap z
d20 1
a20 1
LIB_DEPENDS+=	sqlite3.>=8::databases/sqlite3
d35 2
a36 1
LIB_DEPENDS+=	pq.>=2::databases/postgresql
d44 2
a45 1
LIB_DEPENDS+=	lib/mysql/mysqlclient.>=10::databases/mysql
@


1.5
log
@update to 0.12.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/04/15 09:15:06 sthen Exp $
d5 1
a5 1
DISTNAME=	pmacct-0.12.2
@


1.4
log
@update to 0.12.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/03/02 08:17:16 sthen Exp $
d5 1
a5 1
DISTNAME=	pmacct-0.12.1
@


1.3
log
@Update pmacct to 0.12.0, with mainly fixes to the bgp listener, including
a security-related fix (malicious user could disrupt sessions).

Requested and tested by Daniel C. Sinclair, ok ajacoutot@@
(ports is still not fully open)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2009/10/30 21:33:49 sthen Exp $
d5 1
a5 1
DISTNAME=	pmacct-0.12.0
@


1.2
log
@update to 0.12.0rc3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2009/10/03 18:54:44 sthen Exp $
d5 1
a5 1
DISTNAME=	pmacct-0.12.0rc3
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d5 1
a5 1
DISTNAME=	pmacct-0.12.0rc2
@


1.1.1.1
log
@import net/pmacct, based on a submission from Manuel Pata.

pmacct is a set of passive network monitoring tools to measure, account,
classify, aggregate and export IPv4 and IPv6 traffic, suitable to ISP, IXP,
CDN, IP carrier, data-centre and hot-spot enviroments.

Being able to collect flow data through libpcap, NetFlow and sFlow and
optionally augment this by configuring peering with the included BGP
daemon, granularity is fine enough for essential network management
tasks such as billing, graphing network resource usage, analysing live
or historical traffic trends, steering BGP peerings, real-time alerting,
and certain SLA monitoring.

Aggregation, flexible filtering, sampling and renormalization capabilities
are provided to help cope with the large amounts of data produced by high-
speed networks. Using either memory or database tables (MySQL, PostgreSQL,
SQLite) as backend storage, pmacct can easily feed data into external
tools, including RRDtool, GNUPlot, Net-SNMP, MRTG and Cacti.

The default package provides SQLite support, available flavors are:

        threads       compile with threads, required for BGP integration
                      or running packet classification in parallel
        mysql         compile with support for MySQL
        postgresql    compile with support for PostgreSQL
@
text
@@
