head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2008.01.17.18.27.41;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2008.01.11.18.15.00;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@maintenance update to 1.01
@
text
@$OpenBSD: patch-libtransmission_fastresume_c,v 1.1 2008/01/11 18:15:00 naddy Exp $
--- libtransmission/fastresume.c.orig	Fri Jan  4 06:51:00 2008
+++ libtransmission/fastresume.c	Tue Jan  8 17:00:29 2008
@@@@ -430,15 +430,15 @@@@ parseProgress( tr_torrent     * tor,
         /* compare file mtimes */
         tr_time_t * curMTimes = getMTimes( tor, &n );
         const uint8_t * walk = buf;
-        const tr_time_t * oldMTimes = (const tr_time_t *) walk;
+        tr_time_t mtime;
         for( i=0; i<n; ++i ) {
-            if ( curMTimes[i] == oldMTimes[i] )
+            readBytes( &mtime, &walk, sizeof(tr_time_t) );
+            if ( curMTimes[i] == mtime )
                 tr_torrentSetFileChecked( tor, i, TRUE );
             else
                 tr_dbg( "File '%s' recheck needed", tor->info.files[i].name );
         }
         free( curMTimes );
-        walk += n * sizeof(tr_time_t);
 
         /* get the completion bitfield */
         memset( &bitfield, 0, sizeof bitfield );
@@@@ -548,11 +548,16 @@@@ parsePeers( tr_torrent * tor, const uint8_t * buf, uin
 
     if( !tor->info.isPrivate )
     {
+        int i;
         const int count = len / sizeof(tr_pex);
-        tr_peerMgrAddPex( tor->handle->peerMgr,
-                          tor->info.hash,
-                          TR_PEER_FROM_CACHE,
-                          (tr_pex*)buf, count );
+
+        for( i=0; i<count; ++i )
+        {
+            tr_pex pex;
+            readBytes( &pex, &buf, sizeof( tr_pex ) );
+            tr_peerMgrAddPex( tor->handle->peerMgr, tor->info.hash, TR_PEER_FROM_CACHE, &pex );
+        }
+
         tr_dbg( "found %i peers in resume file", count );
         ret = TR_FR_PEERS;
     }
@


1.1
log
@Update to 1.00.  Changes:
* The GUI has been extended.
* The CLI client has changed its name back to "transmissioncli" (no
hyphen) and has regained the scrape feature.
* Bug fixes.
@
text
@d1 1
a1 1
$OpenBSD$
@

