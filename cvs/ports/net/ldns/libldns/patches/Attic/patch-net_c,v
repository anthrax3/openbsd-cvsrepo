head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2011.10.18.05.12.57;	author rpointel;	state dead;
branches;
next	1.2;

1.2
date	2011.10.17.19.41.24;	author jakob;	state Exp;
branches;
next	1.1;

1.1
date	2011.09.17.19.00.22;	author jakob;	state Exp;
branches;
next	;


desc
@@


1.3
log
@remove the 0 byte patches, from Brad.
@
text
@@


1.2
log
@update to LDNS 1.6.11, from brad
@
text
@@


1.1
log
@add missing patch
@
text
@a0 30
$OpenBSD$

Fix socket leak on errors.

--- net.c.orig	Thu Jul 14 16:11:57 2011
+++ net.c	Thu Jul 14 16:15:24 2011
@@@@ -341,6 +341,11 @@@@ ldns_udp_bgsend(ldns_buffer *qbin, const struct sockad
 	}
 
 	if (ldns_udp_send_query(qbin, sockfd, to, tolen) == 0) {
+#ifndef USE_WINSOCK
+		close(sockfd);
+#else
+		closesocket(sockfd);
+#endif
 		return 0;
 	}
 	return sockfd;
@@@@ -678,6 +683,11 @@@@ ldns_tcp_bgsend(ldns_buffer *qbin, const struct sockad
 	}
 	
 	if (ldns_tcp_send_query(qbin, sockfd, to, tolen) == 0) {
+#ifndef USE_WINSOCK
+		close(sockfd);
+#else
+		closesocket(sockfd);
+#endif
 		return 0;
 	}
 	
@

