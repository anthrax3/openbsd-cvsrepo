head	1.1;
access;
symbols
	OPENBSD_6_1:1.1.0.6
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.4
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.2
	OPENBSD_5_9_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2015.12.22.12.56.27;	author sthen;	state Exp;
branches;
next	;
commitid	VihqfwJLlxokWRNq;


desc
@@


1.1
log
@Bring in two bug fixes for wide-dhcpv6 that have been in the
Debian/Ubuntu/Fedora/Red Hat packages. From Brad.

- Fix renewal of IA NA
- Update ifid on interface restart, it may have changed.
@
text
@$OpenBSD$

Fix renewal of IA NA

--- addrconf.c.orig	Sat Dec 19 01:37:32 2015
+++ addrconf.c	Sat Dec 19 01:40:53 2015
@@@@ -173,7 +173,7 @@@@ update_address(ia, addr, dhcpifp, ctlp, callback)
 	    sacreate ? "create" : "update",
 	    in6addr2str(&addr->addr, 0), addr->pltime, addr->vltime);
 
-	if (sa->addr.vltime != 0)
+	if ((sa->addr.vltime != 0) && sacreate)
 		if (na_ifaddrconf(IFADDRCONF_ADD, sa) < 0)
 			return (-1);
 
@
