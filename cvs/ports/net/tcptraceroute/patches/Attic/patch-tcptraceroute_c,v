head	1.5;
access;
symbols
	OPENBSD_4_1:1.4.0.14
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.12
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.4.0.10
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.4.0.8
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.4.0.6
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.4.0.4
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.4.0.2
	OPENBSD_3_5_BASE:1.4
	OPENBSD_2_9_TRACKING_SWITCH:1.1;
locks; strict;
comment	@# @;


1.5
date	2007.05.26.22.06.19;	author rui;	state dead;
branches;
next	1.4;

1.4
date	2004.03.23.19.22.02;	author pvalchev;	state Exp;
branches;
next	1.3;

1.3
date	2004.01.04.23.23.43;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2001.08.17.18.57.40;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2001.08.10.01.09.36;	author obecian;	state Exp;
branches;
next	;


desc
@@


1.5
log
@update tcptraceroute to 1.5beta, fixes PR ports/5462, from Stuart Henderson

ok aanriot@@, naddy@@
@
text
@$OpenBSD: patch-tcptraceroute_c,v 1.4 2004/03/23 19:22:02 pvalchev Exp $
--- tcptraceroute.c.orig	2002-07-30 14:51:05.000000000 -0700
+++ tcptraceroute.c	2004-03-13 09:41:15.000000000 -0800
@@@@ -391,10 +391,10 @@@@ void pfatal(char *err)
 void usage(void)
 {
 	printf("\n%s\n%s\n", VERSION, BANNER);
-    fatal("Usage: %s [-nNFSAE] [-i <interface>] [-f <first ttl>]
-       [-l <packet length>] [-q <number of queries>] [-t <tos>]
-       [-m <max ttl>] [-pP] <source port>] [-s <source address>]
-       [-w <wait time>] <host> [destination port] [packet length]\n\n", name);
+    fatal("Usage: %s [-nNFSAE] [-i <interface>] [-f <first ttl>]\n"
+"       [-l <packet length>] [-q <number of queries>] [-t <tos>]\n"
+"       [-m <max ttl>] [-pP] <source port>] [-s <source address>]\n"
+"       [-w <wait time>] <host> [destination port] [packet length]\n\n", name);
 }
 
 void about(void)
@@@@ -1182,9 +1182,9 @@@@ void initcapture(void)
 	if (! (pcap = pcap_open_live(device, offset + SNAPLEN, 0, 10, errbuf)))
 		fatal("pcap_open_live failed: %s", errbuf);
 
-	safe_snprintf(filter, TEXTSIZE, "
-		(tcp and src host %s and src port %d and dst host %s)
-		or ((icmp[0] == 11 or icmp[0] == 3) and dst host %s)",
+	safe_snprintf(filter, TEXTSIZE, "\n"
+"		(tcp and src host %s and src port %d and dst host %s)\n"
+"		or ((icmp[0] == 11 or icmp[0] == 3) and dst host %s)",
 			iptos(dst_ip), dst_prt, iptos(src_ip), iptos(src_ip));
 
 	if (o_nofilter)
@@@@ -1386,7 +1386,7 @@@@ int capture(proberecord *record)
 		FD_ZERO(&sfd);
 		FD_SET(pcap_fd, &sfd);
 
-		ret = o_noselect ? 1 : select(pcap_fd + 1, &sfd, NULL, NULL, &timeleft);
+		ret = 1;
 
 		if (ret < 0)
 		{
@


1.4
log
@do not use select() (use undocumented --no-select option) because it's busted
otherwise; from mjc
@
text
@d1 1
a1 1
$OpenBSD: patch-tcptraceroute_c,v 1.3 2004/01/04 23:23:43 espie Exp $
@


1.3
log
@zap multiline constants.
@
text
@d1 3
a3 3
$OpenBSD$
--- tcptraceroute.c.orig	2004-01-05 00:20:43.000000000 +0100
+++ tcptraceroute.c	2004-01-05 00:21:12.000000000 +0100
d32 9
@


1.2
log
@Remove workarounds for 2.9 <net/if.h> multiple inclusion bug.
@
text
@d1 31
a31 12
--- tcptraceroute.c.orig	Thu Aug  9 17:57:18 2001
+++ tcptraceroute.c	Thu Aug  9 17:59:03 2001
@@@@ -111,7 +111,9 @@@@
 #include <netinet/in.h>
 #include <netdb.h>
 #include <sys/ioctl.h>
+#if 0
 #include <net/if.h>
+#endif
 #include <arpa/inet.h>
 #include <libnet.h>
 #include <pcap.h>
@


1.1
log
@fix for 2.9-stable (naddy@@) - sorry Patroklos, didn't see your port
before import.
@
text
@@

