head	1.2;
access;
symbols
	OPENBSD_3_5:1.1.1.1.0.6
	OPENBSD_3_5_BASE:1.1.1.1
	OPENBSD_3_4:1.1.1.1.0.4
	OPENBSD_3_4_BASE:1.1.1.1
	OPENBSD_3_3:1.1.1.1.0.2
	OPENBSD_3_3_BASE:1.1.1.1
	danh_2003-Feb-23:1.1.1.1
	danh:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2004.06.05.04.54.54;	author danh;	state dead;
branches;
next	1.1;

1.1
date	2003.02.23.21.27.33;	author danh;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.02.23.21.27.33;	author danh;	state Exp;
branches;
next	;


desc
@@


1.2
log
@resolve conflicts from last import
@
text
@$OpenBSD: patch-ntpd_ntp_io_c,v 1.1 2003/02/23 21:27:33 danh Exp $
--- ntpd/ntp_io.c.orig	Wed Jan  2 23:03:15 2002
+++ ntpd/ntp_io.c	Sun Feb 23 06:20:35 2003
@@@@ -43,7 +43,7 @@@@
 
 extern int listen_to_virtual_ips;
 
-#if _BSDI_VERSION >= 199510
+#if HAVE_GETIFADDRS
 # include <ifaddrs.h>
 #endif
 
@@@@ -206,15 +206,15 @@@@ create_sockets(
 	u_int port
 	)
 {
-#if _BSDI_VERSION >= 199510
+#if HAVE_GETIFADDRS
 	int i, j;
 	struct ifaddrs *ifaddrs, *ifap;
 	struct sockaddr_in resmask;
-#if 	_BSDI_VERSION < 199701
+#if defined(_BSDI_VERSION) && _BSDI_VERSION < 199701
 	struct ifaddrs *lp;
 	int num_if;
 #endif
-#else	/* _BSDI_VERSION >= 199510 */
+#else	/* HAVE_GETIFADDRS */
 # ifdef STREAMS_TLI
 	struct strioctl ioc;
 # endif /* STREAMS_TLI */
@@@@ -223,7 +223,7 @@@@ create_sockets(
 	struct	ifreq	ifreq, *ifr;
 	int n, i, j, vs, size = 0;
 	struct sockaddr_in resmask;
-#endif	/* _BSDI_VERSION >= 199510 */
+#endif	/* HAVE_GETIFADDRS */
 
 #ifdef DEBUG
 	if (debug)
@@@@ -245,8 +245,18 @@@@ create_sockets(
 	inter_list[0].flags = INT_BROADCAST;
 	any_interface = &inter_list[0];
 
-#if _BSDI_VERSION >= 199510
-#if 	_BSDI_VERSION >= 199701
+#if HAVE_GETIFADDRS
+#if defined(_BSDI_VERSION) && _BSDI_VERSION < 199701
+	if (getifaddrs(&ifaddrs, &num_if) < 0)
+	{
+	    msyslog(LOG_ERR, "create_sockets: getifaddrs() failed: %m");
+	    exit(1);
+	}
+
+	i = 1;
+
+	for (ifap = ifaddrs, lp = ifap + num_if; ifap < lp; ifap++)
+#else
 	if (getifaddrs(&ifaddrs) < 0)
 	{
 		msyslog(LOG_ERR, "getifaddrs: %m");
@@@@ -254,17 +264,7 @@@@ create_sockets(
 	}
 	i = 1;
 	for (ifap = ifaddrs; ifap != NULL; ifap = ifap->ifa_next)
-#else
-	    if (getifaddrs(&ifaddrs, &num_if) < 0)
-	    {
-		    msyslog(LOG_ERR, "create_sockets: getifaddrs() failed: %m");
-		    exit(1);
-	    }
-
-	i = 1;
-
-	for (ifap = ifaddrs, lp = ifap + num_if; ifap < lp; ifap++)
-#endif
+#endif /* _BSDI_VERSION */
 	{
 		struct sockaddr_in *sin;
 
@@@@ -341,7 +341,7 @@@@ create_sockets(
 		    break;
 	}
 	free(ifaddrs);
-#else	/* _BSDI_VERSION >= 199510 */
+#else	/* HAVE_GETIFADDRS */
 # ifdef USE_STREAMS_DEVICE_FOR_IF_CONFIG
 	if ((vs = open("/dev/ip", O_RDONLY)) < 0)
 	{
@@@@ -601,7 +601,7 @@@@ create_sockets(
 		    break;
 	}
 	closesocket(vs);
-#endif	/* _BSDI_VERSION >= 199510 */
+#endif	/* HAVE_GETIFADDRS */
 
 	ninterfaces = i;
 	maxactivefd = 0;
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD: patch-ntpd_ntp_io_c,v 1.1 2002/05/11 20:58:14 danh Exp $
@


1.1.1.1
log
@Re-import of net/ntp.  This splits the port into a stable and
development version.  The stable version is 4.1.1c-rc1.  The previous
port used the development version and has been updated to 4.1.74.
Support for IPv6 has been included in the development version.

@
text
@@
