head	1.72;
access;
symbols
	OPENBSD_6_0:1.70.0.2
	OPENBSD_6_0_BASE:1.70
	OPENBSD_5_9:1.68.0.2
	OPENBSD_5_9_BASE:1.68
	OPENBSD_5_8:1.65.0.4
	OPENBSD_5_8_BASE:1.65
	OPENBSD_5_7:1.61.0.2
	OPENBSD_5_7_BASE:1.61
	OPENBSD_5_6:1.59.0.4
	OPENBSD_5_6_BASE:1.59
	OPENBSD_5_5:1.59.0.2
	OPENBSD_5_5_BASE:1.59
	OPENBSD_5_4:1.57.0.2
	OPENBSD_5_4_BASE:1.57
	OPENBSD_5_3:1.55.0.4
	OPENBSD_5_3_BASE:1.55
	OPENBSD_5_2:1.55.0.2
	OPENBSD_5_2_BASE:1.55
	OPENBSD_5_1_BASE:1.53
	OPENBSD_5_1:1.53.0.4
	OPENBSD_5_0:1.53.0.2
	OPENBSD_5_0_BASE:1.53
	OPENBSD_4_9:1.50.0.2
	OPENBSD_4_9_BASE:1.50
	OPENBSD_4_8:1.44.0.2
	OPENBSD_4_8_BASE:1.44
	OPENBSD_4_7:1.42.0.2
	OPENBSD_4_7_BASE:1.42
	OPENBSD_4_6:1.41.0.2
	OPENBSD_4_6_BASE:1.41
	OPENBSD_4_5:1.39.0.2
	OPENBSD_4_5_BASE:1.39
	OPENBSD_4_4:1.36.0.2
	OPENBSD_4_4_BASE:1.36
	OPENBSD_4_3:1.35.0.2
	OPENBSD_4_3_BASE:1.35
	OPENBSD_4_2:1.33.0.4
	OPENBSD_4_2_BASE:1.33
	OPENBSD_4_1:1.33.0.2
	OPENBSD_4_1_BASE:1.33
	OPENBSD_4_0:1.32.0.4
	OPENBSD_4_0_BASE:1.32
	OPENBSD_3_9:1.32.0.2
	OPENBSD_3_9_BASE:1.32
	OPENBSD_3_8:1.31.0.4
	OPENBSD_3_8_BASE:1.31
	OPENBSD_3_7:1.31.0.2
	OPENBSD_3_7_BASE:1.31
	OPENBSD_3_6:1.28.0.2
	OPENBSD_3_6_BASE:1.28
	danh_2004-Jun-05:1.1.1.3
	OPENBSD_3_5:1.25.0.6
	OPENBSD_3_5_BASE:1.25
	OPENBSD_3_4:1.25.0.4
	OPENBSD_3_4_BASE:1.25
	OPENBSD_3_3:1.25.0.2
	OPENBSD_3_3_BASE:1.25
	danh_2003-Feb-23:1.1.1.2
	OPENBSD_3_2:1.23.0.2
	OPENBSD_3_2_BASE:1.23
	OPENBSD_3_1:1.19.0.2
	OPENBSD_3_1_BASE:1.19
	OPENBSD_3_0:1.16.0.2
	OPENBSD_3_0_BASE:1.16
	OPENBSD_2_9_TRACKING_SWITCH:1.14
	OPENBSD_2_9:1.13.0.2
	OPENBSD_2_9_BASE:1.13
	OPENBSD_2_8:1.12.0.2
	danh_2001-Feb-07:1.1.1.1
	danh:1.1.1;
locks; strict;
comment	@# @;


1.72
date	2017.03.27.11.33.40;	author bluhm;	state Exp;
branches;
next	1.71;
commitid	VSHpvYMwiS3jt19i;

1.71
date	2016.12.14.20.05.37;	author naddy;	state Exp;
branches;
next	1.70;
commitid	yVYIoPWDvGGps23y;

1.70
date	2016.06.18.20.19.11;	author naddy;	state Exp;
branches
	1.70.2.1;
next	1.69;
commitid	olIksoa4w3plJxCc;

1.69
date	2016.04.27.09.16.55;	author naddy;	state Exp;
branches;
next	1.68;
commitid	BF4w88UNvag4BOmO;

1.68
date	2016.02.04.19.55.13;	author naddy;	state Exp;
branches
	1.68.2.1;
next	1.67;
commitid	yU2esztvFWOQ2mU9;

1.67
date	2015.11.10.18.33.02;	author jca;	state Exp;
branches;
next	1.66;
commitid	PVDL1rwDbnWU5McU;

1.66
date	2015.10.08.21.19.22;	author sthen;	state Exp;
branches;
next	1.65;
commitid	pVDZUjJm7yyuQSI1;

1.65
date	2015.07.01.11.59.24;	author sthen;	state Exp;
branches
	1.65.4.1;
next	1.64;
commitid	6ar5GOb1kWaGMjfX;

1.64
date	2015.07.01.10.35.29;	author sthen;	state Exp;
branches;
next	1.63;
commitid	6S61gV408UGMCS1D;

1.63
date	2015.06.26.20.21.07;	author sthen;	state Exp;
branches;
next	1.62;
commitid	m5U8iNHH1bIwRTe0;

1.62
date	2015.04.08.14.12.44;	author sthen;	state Exp;
branches;
next	1.61;
commitid	oLOxQhlMlDfeiSeK;

1.61
date	2014.12.24.16.35.12;	author jca;	state Exp;
branches
	1.61.2.1;
next	1.60;
commitid	N9yS0gqvhovNPDYG;

1.60
date	2014.12.24.13.10.20;	author jca;	state Exp;
branches;
next	1.59;
commitid	3d4rSpTyHPG5PvJo;

1.59
date	2014.02.09.21.36.46;	author sthen;	state Exp;
branches
	1.59.4.1;
next	1.58;

1.58
date	2013.10.31.21.12.13;	author sthen;	state Exp;
branches;
next	1.57;

1.57
date	2013.03.21.08.46.34;	author ajacoutot;	state Exp;
branches;
next	1.56;

1.56
date	2013.03.11.11.35.50;	author espie;	state Exp;
branches;
next	1.55;

1.55
date	2012.04.22.11.41.55;	author ajacoutot;	state Exp;
branches;
next	1.54;

1.54
date	2012.04.10.15.06.29;	author gonzalo;	state Exp;
branches;
next	1.53;

1.53
date	2011.07.11.17.43.14;	author landry;	state Exp;
branches;
next	1.52;

1.52
date	2011.07.08.02.14.59;	author ajacoutot;	state Exp;
branches;
next	1.51;

1.51
date	2011.06.02.13.41.40;	author ajacoutot;	state Exp;
branches;
next	1.50;

1.50
date	2010.12.27.14.50.23;	author ajacoutot;	state Exp;
branches;
next	1.49;

1.49
date	2010.12.24.10.40.05;	author ajacoutot;	state Exp;
branches;
next	1.48;

1.48
date	2010.12.11.12.57.37;	author ajacoutot;	state Exp;
branches;
next	1.47;

1.47
date	2010.11.10.23.37.32;	author ajacoutot;	state Exp;
branches;
next	1.46;

1.46
date	2010.11.10.21.21.26;	author jasper;	state Exp;
branches;
next	1.45;

1.45
date	2010.10.18.18.36.50;	author espie;	state Exp;
branches;
next	1.44;

1.44
date	2010.07.10.19.48.32;	author naddy;	state Exp;
branches;
next	1.43;

1.43
date	2010.07.03.02.49.43;	author naddy;	state Exp;
branches;
next	1.42;

1.42
date	2010.01.20.20.43.59;	author naddy;	state Exp;
branches;
next	1.41;

1.41
date	2009.05.23.16.32.29;	author naddy;	state Exp;
branches
	1.41.2.1;
next	1.40;

1.40
date	2009.04.20.15.32.38;	author naddy;	state Exp;
branches;
next	1.39;

1.39
date	2009.02.11.19.36.27;	author naddy;	state Exp;
branches
	1.39.2.1;
next	1.38;

1.38
date	2009.01.27.10.21.38;	author naddy;	state Exp;
branches;
next	1.37;

1.37
date	2009.01.26.23.26.02;	author naddy;	state Exp;
branches;
next	1.36;

1.36
date	2008.07.01.16.41.19;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2007.09.17.17.20.44;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2007.09.15.22.36.56;	author merdely;	state Exp;
branches;
next	1.33;

1.33
date	2006.11.24.21.23.19;	author steven;	state Exp;
branches;
next	1.32;

1.32
date	2006.01.24.19.58.58;	author sturm;	state Exp;
branches;
next	1.31;

1.31
date	2005.03.08.04.16.42;	author danh;	state Exp;
branches
	1.31.2.1
	1.31.4.1;
next	1.30;

1.30
date	2005.02.26.12.34.22;	author alek;	state Exp;
branches;
next	1.29;

1.29
date	2004.12.16.00.31.24;	author alek;	state Exp;
branches;
next	1.28;

1.28
date	2004.08.02.16.56.12;	author danh;	state Exp;
branches;
next	1.27;

1.27
date	2004.07.27.14.39.31;	author danh;	state Exp;
branches;
next	1.26;

1.26
date	2004.06.05.04.54.53;	author danh;	state Exp;
branches;
next	1.25;

1.25
date	2003.02.23.21.32.41;	author danh;	state Exp;
branches;
next	1.24;

1.24
date	2002.11.19.16.49.03;	author danh;	state Exp;
branches;
next	1.23;

1.23
date	2002.10.01.12.23.42;	author naddy;	state Exp;
branches;
next	1.22;

1.22
date	2002.09.12.16.41.26;	author danh;	state Exp;
branches;
next	1.21;

1.21
date	2002.07.08.14.48.14;	author danh;	state Exp;
branches;
next	1.20;

1.20
date	2002.05.11.20.58.14;	author danh;	state Exp;
branches;
next	1.19;

1.19
date	2001.12.20.21.07.21;	author danh;	state Exp;
branches;
next	1.18;

1.18
date	2001.12.20.15.12.11;	author danh;	state Exp;
branches;
next	1.17;

1.17
date	2001.12.20.06.14.15;	author danh;	state Exp;
branches;
next	1.16;

1.16
date	2001.10.04.20.44.45;	author jakob;	state Exp;
branches;
next	1.15;

1.15
date	2001.10.03.19.52.52;	author danh;	state Exp;
branches;
next	1.14;

1.14
date	2001.08.10.19.08.51;	author danh;	state Exp;
branches;
next	1.13;

1.13
date	2001.04.19.14.51.27;	author danh;	state Exp;
branches;
next	1.12;

1.12
date	2001.04.06.14.31.23;	author brad;	state Exp;
branches
	1.12.2.1;
next	1.11;

1.11
date	2001.04.06.13.40.17;	author danh;	state Exp;
branches;
next	1.10;

1.10
date	2001.04.05.14.16.16;	author danh;	state Exp;
branches;
next	1.9;

1.9
date	2001.04.05.13.56.54;	author danh;	state Exp;
branches;
next	1.8;

1.8
date	2001.04.05.11.58.05;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2001.03.16.16.35.19;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2001.02.13.20.50.30;	author brad;	state Exp;
branches;
next	1.5;

1.5
date	2001.02.11.06.16.33;	author danh;	state Exp;
branches;
next	1.4;

1.4
date	2001.02.08.14.01.17;	author danh;	state Exp;
branches;
next	1.3;

1.3
date	2001.02.07.18.21.05;	author danh;	state Exp;
branches;
next	1.2;

1.2
date	2001.02.07.18.13.43;	author danh;	state Exp;
branches;
next	1.1;

1.1
date	2001.02.07.17.43.21;	author danh;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.02.07.17.43.21;	author danh;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.02.23.21.27.28;	author danh;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2004.06.05.04.34.19;	author danh;	state Exp;
branches;
next	;

1.12.2.1
date	2001.04.10.11.59.58;	author naddy;	state Exp;
branches;
next	;

1.31.2.1
date	2006.01.24.20.18.07;	author sturm;	state Exp;
branches;
next	;

1.31.4.1
date	2006.01.24.20.40.16;	author sturm;	state Exp;
branches;
next	;

1.39.2.1
date	2009.06.28.02.42.41;	author william;	state Exp;
branches;
next	;

1.41.2.1
date	2010.02.13.04.03.19;	author william;	state Exp;
branches;
next	;

1.59.4.1
date	2014.12.27.19.06.45;	author jca;	state Exp;
branches;
next	1.59.4.2;
commitid	fBWHyxs5v061ixuH;

1.59.4.2
date	2015.04.08.14.15.03;	author sthen;	state Exp;
branches;
next	;
commitid	lStHS7xMtdTSy02i;

1.61.2.1
date	2015.04.08.14.14.24;	author sthen;	state Exp;
branches;
next	;
commitid	RcQNni51y89A83Q1;

1.65.4.1
date	2015.11.11.17.53.00;	author jca;	state Exp;
branches;
next	1.65.4.2;
commitid	1Rp9NBObQ0RH4W9d;

1.65.4.2
date	2016.02.04.20.40.17;	author naddy;	state Exp;
branches;
next	;
commitid	WloIvGxx28lUwPBH;

1.68.2.1
date	2016.04.27.09.45.39;	author naddy;	state Exp;
branches;
next	1.68.2.2;
commitid	xYHKijaTaz7je98f;

1.68.2.2
date	2016.06.18.20.19.32;	author naddy;	state Exp;
branches;
next	;
commitid	CqMmqvlfVC0RCjKv;

1.70.2.1
date	2016.12.14.20.34.56;	author naddy;	state Exp;
branches;
next	;
commitid	ehrhovPOoYvGfoER;


desc
@@


1.72
log
@Update ntp to 4.2.8p10.
CVE-2016-9042, CVE-2017-6451, CVE-2017-6452, CVE-2017-6455,
CVE-2017-6458, CVE-2017-6459, CVE-2017-6460, CVE-2017-6462,
CVE-2017-6463, CVE-2017-6464
Adapt OpenSSL #ifdef for LibreSSL.
Fix regression tests, prevent them from crashing.
OK deraadt@@
@
text
@# $OpenBSD: Makefile,v 1.71 2016/12/14 20:05:37 naddy Exp $

COMMENT=	Network Time Protocol reference implementation

# NTP sometimes has a 'pN' in its version number, which we don't want
# to confuse with the ports system's 'pN' convention, so convert it to
# 'pl' for local use.

VERSION=	4.2.8p10
DISTNAME=	ntp-${VERSION}
PKGNAME=	ntp-${VERSION:S/p/pl/}
CATEGORIES=	net

HOMEPAGE=	http://www.ntp.org/

MASTER_SITES=	http://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ntp-4.2/ \
		http://archive.ntp.org/ntp4/ntp-4.2/

# modified ISC
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += c crypto edit event_core event_pthreads
WANTLIB += m pthread ssl termcap

# enabling SEPARATE_BUILD causes the parser to be rebuilt .y -> .c,
# which requires bison

CONFIGURE_STYLE=  gnu

CONFIGURE_ARGS=	--docdir=${TRUEPREFIX}/share/doc/ntp \
		--enable-parse-clocks \
		--with-binsubdir=sbin \
		--without-ntpsnmpd
CONFIGURE_ENV=	CPPFLAGS='-DCONFIG_FILE="\"${SYSCONFDIR}/ntp.conf\"" \
			  -DKEYFILE="\"${SYSCONFDIR}/ntp.keys\""' \
		ac_cv_header_sys_audioio_h=no

LIB_DEPENDS=	devel/libevent2

# autogen >= 5.18.5 required to regenerate outdated files because
# the distribution tarball was updated incompletely
post-extract:
	@@touch ${WRKDIR}/timestamp
	@@find ${WRKSRC} -type f -print0 | xargs -0 touch -r ${WRKDIR}/timestamp

# patch-sntp_tests_packetProcessing_c triggers a ruby script to regenerate
# run-packetProcessing.c.  Avoid ruby, run file does not change anyway.
post-patch:
	cp ${WRKSRC}/sntp/loc/freebsd ${WRKSRC}/sntp/loc/openbsd
	touch ${WRKSRC}/sntp/tests/run-packetProcessing.c

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/ntp
	@@cd ${WRKSRC}/conf && pax -rw * ${PREFIX}/share/examples/ntp

.include <bsd.port.mk>
@


1.71
log
@Security update to 4.2.8p9:
CVE-2016-9311: Trap crash
CVE-2016-9310: Mode 6 unauthenticated trap information disclosure and DDoS vector
CVE-2016-7427: Broadcast Mode Replay Prevention DoS
CVE-2016-7428: Broadcast Mode Poll Interval Enforcement DoS
CVE-2016-9312: Windows: ntpd DoS by oversized UDP packet
CVE-2016-7431: Regression: 010-origin: Zero Origin Timestamp Bypass
CVE-2016-7434: Null pointer dereference in _IO_str_init_static_internal()
CVE-2016-7429: Interface selection attack
CVE-2016-7426: Client rate limiting and server responses
CVE-2016-7433: Reboot sync calculation problem
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2016/06/18 20:19:11 naddy Exp $
d9 1
a9 1
VERSION=	4.2.8p9
d46 2
d50 1
@


1.70
log
@Update to 4.2.8p8 for the latest round of security fixes:
http://support.ntp.org/bin/view/Main/SecurityNotice#June_2016_ntp_4_2_8p8_NTP_Securi
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2016/04/27 09:16:55 naddy Exp $
d9 1
a9 1
VERSION=	4.2.8p8
d39 6
@


1.70.2.1
log
@Security update to 4.2.8p9:
CVE-2016-9311: Trap crash
CVE-2016-9310: Mode 6 unauthenticated trap information disclosure and DDoS vector
CVE-2016-7427: Broadcast Mode Replay Prevention DoS
CVE-2016-7428: Broadcast Mode Poll Interval Enforcement DoS
CVE-2016-9312: Windows: ntpd DoS by oversized UDP packet
CVE-2016-7431: Regression: 010-origin: Zero Origin Timestamp Bypass
CVE-2016-7434: Null pointer dereference in _IO_str_init_static_internal()
CVE-2016-7429: Interface selection attack
CVE-2016-7426: Client rate limiting and server responses
CVE-2016-7433: Reboot sync calculation problem
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2016/12/14 20:05:37 naddy Exp $
d9 1
a9 1
VERSION=	4.2.8p9
a38 6

# autogen >= 5.18.5 required to regenerate outdated files because
# the distribution tarball was updated incompletely
post-extract:
	@@touch ${WRKDIR}/timestamp
	@@find ${WRKSRC} -type f -print0 | xargs -0 touch -r ${WRKDIR}/timestamp
@


1.69
log
@Update to 4.2.8p7 for the latest round of security fixes:
http://support.ntp.org/bin/view/Main/SecurityNotice#April_2016_NTP_4_2_8p7_Security
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2016/02/04 19:55:13 naddy Exp $
d9 1
a9 1
VERSION=	4.2.8p7
@


1.68
log
@Security update to 4.2.8p6.  This addresses numerous security issues.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2015/11/10 18:33:02 jca Exp $
d9 1
a9 1
VERSION=	4.2.8p6
a41 2
# short-circuit regeneration after patching ssl_init.c
	touch ${WRKSRC}/tests/libntp/run-ssl_init.c
@


1.68.2.1
log
@Update to 4.2.8p7 for the latest round of security fixes:
http://support.ntp.org/bin/view/Main/SecurityNotice#April_2016_NTP_4_2_8p7_Security
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2016/02/04 19:55:13 naddy Exp $
d9 1
a9 1
VERSION=	4.2.8p7
d42 2
@


1.68.2.2
log
@Update to 4.2.8p8 for the latest round of security fixes:
http://support.ntp.org/bin/view/Main/SecurityNotice#June_2016_ntp_4_2_8p8_NTP_Securi
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68.2.1 2016/04/27 09:45:39 naddy Exp $
d9 1
a9 1
VERSION=	4.2.8p8
@


1.67
log
@SECURITY update to ntp-4.2.8p4

Per upstream, only low and medium-severity vulns:
http://support.ntp.org/bin/view/Main/SecurityNotice#October_2015_NTP_Security_Vulner

Diff from Daniel Jakots
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2015/10/08 21:19:22 sthen Exp $
d9 1
a9 1
VERSION=	4.2.8p4
d42 2
@


1.66
log
@Bump some ports which reference if_msghdr in their source, so that package
updates are triggered. This is following the struct if_data ABI change a few
days ago; if_msghdr has an embedded if_data.  Some may be unnecessary, but
some are definitely needed and bumps are cheaper than debugging.
Problem reported with wpa_supplicant by Mikolaj Kucharski.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2015/07/01 11:59:24 sthen Exp $
d9 1
a9 1
VERSION=	4.2.8p3
a12 1
REVISION=	0
@


1.65
log
@add a second MASTER_SITES, archive.ntp.org seems unhappy
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2015/07/01 10:35:29 sthen Exp $
d13 1
@


1.65.4.1
log
@SECURITY update to ntp-4.2.8p4; ok sthen@@

Per upstream, only low and medium-severity vulns:
http://support.ntp.org/bin/view/Main/SecurityNotice#October_2015_NTP_Security_Vulner

Tested by Daniel Jakots.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2015/07/01 11:59:24 sthen Exp $
d9 1
a9 1
VERSION=	4.2.8p4
@


1.65.4.2
log
@Security update to 4.2.8p6.  This addresses numerous security issues.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65.4.1 2015/11/11 17:53:00 jca Exp $
d9 1
a9 1
VERSION=	4.2.8p6
a41 2
# short-circuit regeneration after patching ssl_init.c
	touch ${WRKSRC}/tests/libntp/run-ssl_init.c
@


1.64
log
@update to ntp-4.2.8p3, various fixes including a remote crash in some
(uncommon) conditions; if:

- remote configuration of ntpd is enabled (it's disabled by default),
- and an attacker knows the remote configuration password,
- and has access to a computer that is allowed to send remote configuration
requests to ntpd,

the attacker can send a carefully-crafted packet to ntpd that will cause ntpd
to crash.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2015/06/26 20:21:07 sthen Exp $
a12 1
MASTER_SITES=	http://archive.ntp.org/ntp4/ntp-4.2/
d15 3
@


1.63
log
@disable ntpd's audio support for now (it's used for feeding audio from a
radio receiver tuned to WWV or CHU time signal stations, but doesn't build
with recent changes to audio support)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2015/04/08 14:12:44 sthen Exp $
d9 1
a9 2
VERSION=	4.2.8p2
REVISION=	0
@


1.62
log
@security update to ntp-4.2.8p2
http://support.ntp.org/bin/view/Main/SecurityNotice#Recent_Vulnerabilities

CVE-2015-1798 "When ntpd is configured to use a symmetric key to authenticate a
remote NTP server/peer, it checks if the NTP message authentication code (MAC)
in received packets is valid, but not if there actually is any MAC included."

CVE-2015-1799 "An attacker knowing that NTP hosts A and B are peering with each
other (symmetric association) can send a packet to host A with source address
of B which will set the NTP state variables on A to the values sent by the
attacker. Host A will then send on its next poll to B a packet with originate
timestamp that doesn't match the transmit timestamp of B and the packet will be
dropped. If the attacker does this periodically for both hosts, they won't be
able to synchronize to each other."
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2014/12/24 16:35:12 jca Exp $
d10 1
d34 2
a35 1
			  -DKEYFILE="\"${SYSCONFDIR}/ntp.keys\""'
@


1.61
log
@A PLIST change got lost in previous borked commit.

Bump REVISION since people might have started builds since.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2014/12/24 13:10:20 jca Exp $
d5 3
a7 3
# NTP has a 'pN' in its version number, which we don't want
# to confuse with the ports system's 'pN' convention, so we
# convert it to 'pl' for local use.
d9 1
a9 1
VERSION=	4.2.8
a11 1
REVISION=	0
@


1.61.2.1
log
@MFC security update to ntp-4.2.8p2: CVE-2015-1798, CVE-2015-1799
http://support.ntp.org/bin/view/Main/SecurityNotice#Recent_Vulnerabilities
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2015/04/08 14:12:44 sthen Exp $
d5 3
a7 3
# NTP sometimes has a 'pN' in its version number, which we don't want
# to confuse with the ports system's 'pN' convention, so convert it to
# 'pl' for local use.
d9 1
a9 1
VERSION=	4.2.8p2
d12 1
@


1.60
log
@Update to ntp-4.2.8, fixes for several CVEs.

- Weak default key in config_auth() - CVE-2014-9293
- non-cryptographic random number generator with weak seed used by
  ntp-keygen to generate symmetric keys - CVE-2014-9294
- Buffer overflow in crypto_recv() - CVE-2014-9295
- Buffer overflow in ctl_putdata() - CVE-2014-9295
- Buffer overflow in configure() - CVE-2014-9295
- receive(): missing return on error - CVE-2014-9296

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2014/02/09 21:36:46 sthen Exp $
d12 1
@


1.59
log
@Update ports/net/ntp to 4.2.7p418.  This is ntp.org's ntp daemon, *not*
the base system's openntpd.

Update removes a reflected unauthenticated DoS attack vector that has
been hit a lot in the wild recently, see http://www.openntpproject.org/
UDP traffic amplification 19x.

This is a devel version from upstream, they have decided not to fix it in
the stable branch. Users running older versions should add "disable monitor"
to their config and restart, then verify that "monlist" in ntpdc does not
return a list.

ok aja@@, missing build dep spotted by naddy
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2013/10/31 21:12:13 sthen Exp $
d9 2
a10 2
VERSION=	4.2.7p418
DISTNAME=	ntp-dev-${VERSION}
d13 1
a13 1
MASTER_SITES=	http://archive.ntp.org/ntp4/ntp-dev/
d20 1
a20 1
WANTLIB += c crypto edit event_core event_extra event_pthreads
a26 2
AUTOCONF_VERSION= 2.68
AUTOMAKE_VERSION= 1.11
a34 3
BUILD_DEPENDS=	${MODGNU_AUTOCONF_DEPENDS} \
		${MODGNU_AUTOMAKE_DEPENDS} \
		devel/libtool
a37 2
	cd ${WRKSRC}; AUTOCONF_VERSION=${AUTOCONF_VERSION} \
	    AUTOMAKE_VERSION=${AUTOMAKE_VERSION} ./bootstrap
@


1.59.4.1
log
@SECURITY update to ntp-4.2.8, requested by jasper@@

Tested by Daniel Jakots, thanks!

Original commit message:
Update to ntp-4.2.8, fixes for several CVEs.

- Weak default key in config_auth() - CVE-2014-9293
- non-cryptographic random number generator with weak seed used by
ntp-keygen to generate symmetric keys - CVE-2014-9294
- Buffer overflow in crypto_recv() - CVE-2014-9295
- Buffer overflow in ctl_putdata() - CVE-2014-9295
- Buffer overflow in configure() - CVE-2014-9295
- receive(): missing return on error - CVE-2014-9296

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2014/02/09 21:36:46 sthen Exp $
d9 2
a10 2
VERSION=	4.2.8
DISTNAME=	ntp-${VERSION}
d13 1
a13 1
MASTER_SITES=	http://archive.ntp.org/ntp4/ntp-4.2/
d20 1
a20 1
WANTLIB += c crypto edit event_core event_pthreads
d27 2
d37 3
d43 2
@


1.59.4.2
log
@MFC security update to ntp-4.2.8p2: CVE-2015-1798, CVE-2015-1799
http://support.ntp.org/bin/view/Main/SecurityNotice#Recent_Vulnerabilities
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2015/04/08 14:12:44 sthen Exp $
d5 3
a7 3
# NTP sometimes has a 'pN' in its version number, which we don't want
# to confuse with the ports system's 'pN' convention, so convert it to
# 'pl' for local use.
d9 1
a9 1
VERSION=	4.2.8p2
@


1.58
log
@bump REVISION for any ports using route messages. regen some distinfos and
remove unnecessary USE_GROFFs while there.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2013/03/21 08:46:34 ajacoutot Exp $
d9 2
a10 2
VERSION=	4.2.6p5
DISTNAME=	ntp-${VERSION}
a11 1
REVISION=	1
d13 1
a13 1
MASTER_SITES=	http://archive.ntp.org/ntp4/ntp-4.2/
d20 2
a21 1
WANTLIB=	c crypto edit kvm m termcap
d26 8
a33 3
CONFIGURE_STYLE=gnu
CONFIGURE_ARGS=	--enable-parse-clocks \
		--with-binsubdir=sbin
d37 10
a47 2
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/ntp
	@@cd ${WRKSRC}/html && pax -rw * ${PREFIX}/share/doc/ntp
@


1.57
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2013/03/11 11:35:50 espie Exp $
d12 1
a12 1
REVISION=	0
@


1.56
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2012/04/22 11:41:55 ajacoutot Exp $
a25 1
USE_LIBTOOL=	Yes
@


1.55
log
@Use RCDIR instead of /etc/rc.d when refering to packages rc scripts.

discussed with espie and sthen
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2012/04/10 15:06:29 gonzalo Exp $
a19 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.54
log
@Update for ntp:

* I remove the patch patch-ntpd_ntp_intres_c because is applied upstream.
* We doesn't need USE_GROFF here.

OK naddy@@, aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2011/07/11 17:43:14 landry Exp $
d12 1
@


1.53
log
@Rename 'Reference NTP' rc script to xntpd to avoid conflict with the
basesystem's ntpd rc script. Adjust PLIST and bump.
Previous diff looked ok to aja@@, rename to xntpd instead of isc_ntpd
prodded by naddy@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2011/07/08 02:14:59 ajacoutot Exp $
d9 1
a9 1
VERSION=	4.2.6p2
a11 1
REVISION=	7
a28 1
USE_GROFF =	Yes
@


1.52
log
@rc_scripts -> pkg_scripts
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2011/06/02 13:41:40 ajacoutot Exp $
d5 1
a5 1
# ISC's NTP has a 'pN' in its version number, which we don't want
d12 1
a12 1
REVISION=	6
@


1.51
log
@Add a consistent header that substitutes FULLPKGNAME for the READMEs.

ok jasper@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2010/12/27 14:50:23 ajacoutot Exp $
d12 1
a12 1
REVISION=	5
@


1.50
log
@Simplify after recent rc.subr change.
The framework is now stable and we will start documenting it (at last).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2010/12/24 10:40:05 ajacoutot Exp $
d12 1
a12 1
REVISION=	4
@


1.49
log
@Cope with recent rc.subr changes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2010/12/11 12:57:37 ajacoutot Exp $
d12 1
a12 1
REVISION=	3
@


1.48
log
@Move these to rc_reload=NO.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2010/11/10 23:37:32 ajacoutot Exp $
d12 1
a12 1
REVISION=	2
@


1.47
log
@Fix crazy indent.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2010/11/10 21:21:26 jasper Exp $
d12 1
a12 1
REVISION=	1
@


1.46
log
@- switch to pkg-readmes
- add an rc script

looks good to sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2010/10/18 18:36:50 espie Exp $
d12 1
a12 1
REVISION=	0
@


1.45
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2010/07/10 19:48:32 naddy Exp $
d12 1
a36 3
post-build:
	@@${SUBST_CMD} -c ${FILESDIR}/README.OpenBSD ${WRKBUILD}/README.OpenBSD

a41 2
	${INSTALL_DATA} ${WRKBUILD}/README.OpenBSD \
	    ${PREFIX}/share/examples/ntp/
@


1.44
log
@update to 4.2.6p2, which incorporates most of our patches
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2010/07/03 02:49:43 naddy Exp $
d29 1
@


1.43
log
@update to 4.2.6p1 and remove a lot of cruft
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2010/01/20 20:43:59 naddy Exp $
d9 1
a9 1
VERSION=	4.2.6p1
d25 2
a26 1
BUILD_DEPENDS=	::devel/bison
a27 1
SEPARATE_BUILD=	simple
a33 1
YACC=		bison -y
@


1.42
log
@SECURITY:
Fix a DoS attack from certain NTP mode 7 packets.  If an attacker
spoofed a source address, ntpd hosts could be made to endlessly
send responses to each other or to themselves.  CVE-2009-3563.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2009/05/23 16:32:29 naddy Exp $
d9 1
a9 1
VERSION=	4.2.4p7
d11 1
a11 1
PKGNAME=	ntp-${VERSION:S/p/pl/}p0
d13 1
a13 2
MASTER_SITES=	ftp://archive.ntp.org/ntp4/ntp-4.2/ \
		http://archive.ntp.org/ntp4/ntp-4.2/
d17 2
a18 3
# modified ISC license.  However, some files include different
# copyrights.
PERMIT_PACKAGE_CDROM=	No
d20 1
a20 1
PERMIT_DISTFILES_CDROM=	No
d23 3
a25 1
WANTLIB=	c crypto curses kvm m readline 
d29 9
a37 9
AUTOCONF_VERSION= 2.59
CONFIGURE_STYLE= autoconf
CONFIGURE_ARGS+= --bindir='${PREFIX}/sbin' \
		--with-binsubdir=sbin \
	 	--enable-accurate-adjtime --disable-IRIG \
		--enable-parse-clocks \
		--with-openssl-libdir=/usr/lib \
		--with-openssl-incdir=/usr/include \
		--with-crypto=openssl
a43 1
	@@${SUBST_CMD} -c ${FILESDIR}/README.OpenBSD ${WRKBUILD}/README.OpenBSD
@


1.41
log
@SECURITY update to 4.2.4p7:
Fix remote exploit if autokey is enabled (CVE-2009-1252).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2009/04/20 15:32:38 naddy Exp $
d11 1
a11 1
PKGNAME=	ntp-${VERSION:S/p/pl/}
@


1.41.2.1
log
@MFC:

SECURITY FIX

Resolves CVE-2009-3563

ok naddy@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2009/05/23 16:32:29 naddy Exp $
d11 1
a11 1
PKGNAME=	ntp-${VERSION:S/p/pl/}p0
@


1.40
log
@Security:
Prevent a buffer overflow in ntpq.  (CVE-2009-0159)
From upstream via FreeBSD.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2009/02/11 19:36:27 naddy Exp $
d9 1
a9 1
VERSION=	4.2.4p6
d11 1
a11 1
PKGNAME=	ntp-${VERSION:S/p/pl/}p1
d13 1
a13 3
MASTER_SITES=   ftp://ftp.udel.edu/pub/ntp/ntp4/ntp-4.2/ \
		http://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ntp-4.2/ \
		ftp://archive.ntp.org/ntp4/ntp-4.2/ \
@


1.39
log
@properly substitute paths in README.OpenBSD
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2009/01/27 10:21:38 naddy Exp $
d11 1
a11 1
PKGNAME=	ntp-${VERSION:S/p/pl/}p0
@


1.39.2.1
log
@SECURITY FIX:

Fix remote exploit if autokey is enabled (CVE-2009-1252).
(diff taken from pl6 vs. pl7)

Prevent a buffer overflow in ntpq (CVE-2009-0159).
(diff from upstream, via -current via FreeBSD)

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2009/02/11 19:36:27 naddy Exp $
d11 1
a11 1
PKGNAME=	ntp-${VERSION:S/p/pl/}p1
@


1.38
log
@Update to 4.2.4p6.

Kill the multi-packaging.  xntpd is useless without documentation and
if you want a simple NTP server on a tiny machine, use OpenNTPD.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2009/01/26 23:26:02 naddy Exp $
d11 1
a11 1
PKGNAME=	ntp-${VERSION:S/p/pl/}
@


1.37
log
@update to 4.2.4p5; based on a submission by Wim Lewis <wiml@@hhhh.org>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2008/07/01 16:41:19 ajacoutot Exp $
d3 1
a3 2
COMMENT-main=	network time protocol implementation
COMMENT-doc=	network time protocol documentation
d9 3
a11 5
NTP_VERSION=	4.2.4p5
NTP_PKG_VERSION=${NTP_VERSION:S/p/pl/}
DISTNAME=	ntp-${NTP_VERSION}
PKGNAME-main=	ntp-${NTP_PKG_VERSION}
PKGNAME-doc=	ntp-doc-${NTP_PKG_VERSION}
d27 1
a27 4
MULTI_PACKAGES=	-main -doc

PKG_ARCH-doc=	*
WANTLIB-main=	c crypto curses kvm m readline 
@


1.36
log
@- remove Dan Harnett from MAINTAINER per his request
- bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2007/09/17 17:20:44 ajacoutot Exp $
d6 9
a14 4
NTP_VERSION=	4.2.0a
DISTNAME=	ntp-stable-${NTP_VERSION}-20050303
PKGNAME-main=	ntp-${NTP_VERSION}p5
PKGNAME-doc=	ntp-doc-${NTP_VERSION}p2
d16 4
a19 3
MASTER_SITES=	http://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/snapshots/ntp-stable/2005/03/ \
		ftp://ftp.udel.edu/pub/ntp/ntp4/snapshots/ntp-stable/2005/03/ \
		ftp://ftp.cs.umn.edu/ftp00/ftp.udel.edu/pub/ntp/ntp4/snapshots/ntp-stable/2005/03/
d35 3
a37 2
SEPARATE_BUILD=	concurrent
AUTOCONF_VERSION= 2.58
a38 1
CONFIGURE_ENV=	CFLAGS="${CFLAGS} -DHAVE_IPV6"
d40 1
d52 1
a52 3
	@@sed -e s#!!PREFIX!!#${TRUEPREFIX}#g \
	    -e s#!!SYSCONFDIR!!#${SYSCONFDIR}#g \
	    ${FILESDIR}/README.OpenBSD > ${WRKBUILD}/README.OpenBSD
@


1.35
log
@- it's -> its
from Alex J. Avriette <avriette at gmail dot com>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2007/09/15 22:36:56 merdely Exp $
d8 2
a9 2
PKGNAME-main=	ntp-${NTP_VERSION}p4
PKGNAME-doc=	ntp-doc-${NTP_VERSION}p1
a15 2

MAINTAINER=	Dan Harnett <danh@@openbsd.org>
@


1.34
log
@Remove surrounding quotes in COMMENT*/PERMIT_*/BROKEN/ERRORS

Add $OpenBSD$ to p5-SNMP-Info/Makefile (ok kili@@, simon@@)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2006/11/24 21:23:19 steven Exp $
d8 1
a8 1
PKGNAME-main=	ntp-${NTP_VERSION}p3
a20 1
#
@


1.33
log
@new MULTI_PACKAGES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2006/01/24 19:58:58 sturm Exp $
d3 2
a4 2
COMMENT-main=	"network time protocol implementation"
COMMENT-doc=	"network time protocol documentation"
@


1.32
log
@SECURITY:
fix gid confusion when starting ntpd with -u groupname
CAN-2005-2496
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2005/03/08 04:16:42 danh Exp $
d3 1
a3 1
COMMENT=	"network time protocol implementation"
d8 1
a8 1
PKGNAME=	ntp-${NTP_VERSION}p2
d27 1
a27 2
MULTI_PACKAGES=	-doc
SUBPACKAGE?=
d29 2
a30 5
.if defined(PACKAGING) && ${SUBPACKAGE} == "-doc"
PKG_ARCH=	*
.else
WANTLIB=		c crypto curses kvm m readline 
.endif
@


1.31
log
@update to the latest stable tarball, ntp-stable-4.2.0a-20050303
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2005/02/26 12:34:22 alek Exp $
d8 1
a8 1
PKGNAME=	ntp-${NTP_VERSION}p1
@


1.31.4.1
log
@MFC:
SECURITY
fix gid confusion when starting ntpd with -u groupname
CAN-2005-2496

reported by Alexander Bluhm <bluhm at genua.de>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2005/03/08 04:16:42 danh Exp $
d8 1
a8 1
PKGNAME=	ntp-${NTP_VERSION}p2
@


1.31.2.1
log
@MFC:
SECURITY
fix gid confusion when starting ntpd with -u groupname
CAN-2005-2496

reported by Alexander Bluhm <bluhm at genua.de>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2005/03/08 04:16:42 danh Exp $
d8 1
a8 1
PKGNAME=	ntp-${NTP_VERSION}p2
@


1.30
log
@Fix WANTLIB marker
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2004/12/16 00:31:24 alek Exp $
d7 3
a9 3
DISTNAME=	ntp-stable-${NTP_VERSION}-20040525
PKGNAME=	ntp-${NTP_VERSION}
PKGNAME-doc=	ntp-doc-${NTP_VERSION}
d11 3
a13 3
MASTER_SITES=	http://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ \
		ftp://ftp.udel.edu/pub/ntp/ntp4/ \
		ftp://ftp.cs.umn.edu/ftp00/ftp.udel.edu/pub/ntp/ntp4/
@


1.29
log
@Add WANTLIB markers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2004/08/02 16:56:12 danh Exp $
a25 1
WANTLIB=		c crypto curses kvm m readline 
d32 2
@


1.28
log
@enable PARSE clocks; suggested by Matthias Kilian <kili@@outback.escape.de>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2004/07/27 14:39:31 danh Exp $
d26 1
@


1.27
log
@- shorten MESSAGE.
- add a README.OpenBSD file describing how to start ntpd.
- @@dirrm -> dir/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2004/06/05 04:54:53 danh Exp $
d40 1
@


1.26
log
@resolve conflicts from last import
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2003/02/23 21:32:41 danh Exp $
d49 5
@


1.25
log
@resolve conflict from last import and remove files that are no longer
needed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.2 2003/02/23 21:27:28 danh Exp $
d3 2
a4 2
SUBDIR+= stable
SUBDIR+= devel
d6 45
a50 1
.include <bsd.port.subdir.mk>
@


1.24
log
@- fix an off by one in ntpd/ntp_config.c
- bump package patch level

From cloder@@, poked by brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2002/10/01 12:23:42 naddy Exp $
d3 2
a4 2
COMMENT=	"network time protocol implementation"
COMMENT-doc=	"network time protocol documentation"
d6 1
a6 41
VERSION=	4.1.72
DISTNAME=	ntp-${VERSION}
PKGNAME=	ntp-${VERSION}p2
PKGNAME-doc=	ntp-doc-${VERSION}
CATEGORIES=	net
MASTER_SITES=	ftp://ftp.udel.edu/pub/ntp/ntp4/ \
		http://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ \
		ftp://ftp.cs.umn.edu/mirrors00/ftp.udel.edu/pub/ntp/ntp4/

HOMEPAGE=	http://www.ntp.org/

MAINTAINER=	Dan Harnett <danh@@openbsd.org>

PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MULTI_PACKAGES=	-doc
SUBPACKAGE?=

SEPARATE_BUILD=	concurrent
AUTOCONF_NEW=	Yes
CONFIGURE_STYLE= autoconf
CONFIGURE_ARGS+= --bindir='${PREFIX}/sbin' \
	 	--enable-accurate-adjtime --disable-IRIG \
		--with-openssl-libdir=/usr/lib \
		--with-openssl-incdir=/usr/include \
		--with-crypto=openssl

post-patch:
	@@touch ${WRKSRC}/aclocal.m4

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/ntp
	@@cd ${WRKSRC}/html && pax -rw * ${PREFIX}/share/doc/ntp
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/ntp
	@@cd ${WRKSRC}/conf && pax -rw * ${PREFIX}/share/examples/ntp
	@@mv ${PREFIX}/sbin/genkeys ${PREFIX}/sbin/ntp-genkeys

.include <bsd.port.mk>
@


1.23
log
@Fix install by not triggering a secondary configure run.
Problem reported by J.A. Neitzel <jneitzel@@sdf.lonestar.org>,
analyzed by danh@@, this fix from me.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2002/09/12 16:41:26 danh Exp $
d8 1
a8 1
PKGNAME=	ntp-${VERSION}p1
@


1.22
log
@these are not likely to change anytime soon, so drop NEED_VERSION now
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2002/07/08 14:48:14 danh Exp $
d35 3
@


1.21
log
@kernel support for NTP has been dropped; from nordin@@
- bump package patch level
- remove ntptime from package list
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2002/05/11 20:58:14 danh Exp $
a10 1
NEED_VERSION=	1.502
@


1.20
log
@use getifaddrs/freeifaddrs if available

based on suggestion and patches from millert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2001/12/20 21:07:21 danh Exp $
d8 1
a8 1
PKGNAME=	ntp-${VERSION}
@


1.19
log
@update to ntp 4.1.72
- no longer need patches for RAND_file_name; it was fixed in -current
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2001/12/20 15:12:11 danh Exp $
d29 2
a30 1
CONFIGURE_STYLE= gnu
d32 1
a32 1
		 --enable-accurate-adjtime --disable-IRIG \
@


1.18
log
@bump NEED_VERSION
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2001/12/20 06:14:15 danh Exp $
d6 1
a6 1
VERSION=	4.1.71
d8 1
a8 1
PKGNAME=	ntp-${VERSION}p1
@


1.17
log
@* bump patch level of ntp package
* check return of RAND_file_name better; allows ntp-genkeys to continue
  if a seed file is not found.
* regen configure patch
* quote package comments
* files/md5 -> distinfo
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2001/10/04 20:44:45 jakob Exp $
d11 1
a11 1
NEED_VERSION=	1.434
@


1.16
log
@quick fix for sbin/genkeys that should really be installed as sbin/ntp-genkeys (confirmed by mills@@udel.edu)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2001/10/03 19:52:52 danh Exp $
d3 2
a4 2
COMMENT=	network time protocol implementation
COMMENT-doc=	network time protocol documentation
d8 1
a8 1
PKGNAME=	ntp-${VERSION}
@


1.15
log
@update to ntp 4.1.71; work and patches provided by jakob@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2001/08/10 19:08:51 danh Exp $
d41 1
@


1.14
log
@update to ntp 4.1.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2001/04/19 14:51:27 danh Exp $
d6 1
a6 1
VERSION=	4.1.0
d31 4
a34 1
		 --enable-accurate-adjtime --disable-IRIG
@


1.13
log
@update to version 4.0.99k23
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2001/04/06 14:31:23 brad Exp $
d6 1
a6 1
VERSION=	4.0.99k23
d11 1
a11 1
NEED_VERSION=	1.399
@


1.12
log
@bump PKGNAME after security fix.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2001/04/06 13:40:17 danh Exp $
d6 1
a6 1
VERSION=	4.0.99k
d8 2
a9 2
PKGNAME=	ntp-${VERSION}p1
PKGNAME-doc=	ntp-doc-${VERSION}p1
d11 1
a11 1
NEED_VERSION=	1.384
@


1.12.2.1
log
@MFC:
SECURITY FIX: Import ntp-4.0.99k with a fix against remote (x)ntp root
exploit.  This replaces sysutils/xntpd.
@
text
@d1 4
a4 1
# $OpenBSD: Makefile,v 1.12 2001/04/06 14:31:23 brad Exp $
d8 2
d11 1
a11 1
NEED_VERSION=	1.340
a26 6

.if ${SUBPACKAGE} == "-doc"
PKGNAME=	ntp-doc-${VERSION}p1
.else
PKGNAME=	ntp-${VERSION}p1
.endif
@


1.11
log
@better fix
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2001/04/05 14:16:16 danh Exp $
d8 2
d11 1
a11 1
NEED_VERSION=	1.361
a26 2

PKGNAME-doc=	ntp-doc-${VERSION}
@


1.10
log
@keep BROKEN for now
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2001/04/05 11:58:05 espie Exp $
a5 1
BROKEN=		"May be holed"
@


1.9
log
@pull in security patch from FreeBSD
@
text
@d6 1
@


1.8
log
@Ouch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2001/03/16 16:35:19 espie Exp $
a5 1
BROKEN=		"May be holed"
@


1.7
log
@Simplify
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2001/02/13 20:50:30 brad Exp $
d6 1
@


1.6
log
@add another much-needed dist site.
@
text
@d1 4
a4 1
# $OpenBSD: Makefile,v 1.5 2001/02/11 06:16:33 danh Exp $
d9 1
a9 1
NEED_VERSION=	1.352
d26 1
a26 3
.if ${SUBPACKAGE} == "-doc"
PKGNAME=	ntp-doc-${VERSION}
.endif
@


1.5
log
@fix typo in MASTER_SITES; reported by <kwesterback@@home.com>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2001/02/08 14:01:17 danh Exp $
d8 1
d11 1
a11 1
HOMEPAGE=	http://www.eecis.udel.edu/~ntp/
@


1.4
log
@split version into a different variable; patch from jakob@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2001/02/07 18:21:05 danh Exp $
d8 1
a8 1
		ftp://ftp.cs.umn.edu/mirrors00/ftp.udel.edu/pub/ntp/ntp3/
@


1.3
log
@concurrent builds work
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2001/02/07 18:13:43 danh Exp $
d3 2
a4 1
DISTNAME=	ntp-4.0.99k
d23 1
a23 1
PKGNAME=	ntp-doc-4.0.99k
@


1.2
log
@break documentation into a subpackage.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2001/02/07 17:43:21 danh Exp $
d25 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d17 7
@


1.1.1.1
log
@The Network Time Protocol (NTP) is used to synchronize the time of a 
computer client or server to another server or reference time source.
(ok espie@@)
@
text
@@


1.1.1.2
log
@Re-import of net/ntp.  This splits the port into a stable and
development version.  The stable version is 4.1.1c-rc1.  The previous
port used the development version and has been updated to 4.1.74.
Support for IPv6 has been included in the development version.
@
text
@d3 5
a7 2
SUBDIR+= stable
SUBDIR+= devel
d9 20
a28 1
.include <bsd.port.subdir.mk>
@


1.1.1.3
log
@import of ntp-stable-4.2.0a-20040525
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.4 2003/05/15 03:49:33 jakob Exp $
d3 2
a4 2
COMMENT=	"network time protocol implementation"
COMMENT-doc=	"network time protocol documentation"
d6 1
a6 45
NTP_VERSION=	4.2.0a
DISTNAME=	ntp-stable-${NTP_VERSION}-20040525
PKGNAME=	ntp-${NTP_VERSION}
PKGNAME-doc=	ntp-doc-${NTP_VERSION}
CATEGORIES=	net
MASTER_SITES=	http://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ \
		ftp://ftp.udel.edu/pub/ntp/ntp4/ \
		ftp://ftp.cs.umn.edu/ftp00/ftp.udel.edu/pub/ntp/ntp4/

HOMEPAGE=	http://www.ntp.org/

MAINTAINER=	Dan Harnett <danh@@openbsd.org>

# modified ISC license.  However, some files include different
# copyrights.
#
PERMIT_PACKAGE_CDROM=	No
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	No
PERMIT_DISTFILES_FTP=	Yes

MULTI_PACKAGES=	-doc
SUBPACKAGE?=

.if defined(PACKAGING) && ${SUBPACKAGE} == "-doc"
PKG_ARCH=	*
.endif

SEPARATE_BUILD=	concurrent
AUTOCONF_VERSION= 2.58
CONFIGURE_STYLE= autoconf
CONFIGURE_ENV=	CFLAGS="${CFLAGS} -DHAVE_IPV6"
CONFIGURE_ARGS+= --bindir='${PREFIX}/sbin' \
	 	--enable-accurate-adjtime --disable-IRIG \
		--with-openssl-libdir=/usr/lib \
		--with-openssl-incdir=/usr/include \
		--with-crypto=openssl

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/ntp
	@@cd ${WRKSRC}/html && pax -rw * ${PREFIX}/share/doc/ntp
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/ntp
	@@cd ${WRKSRC}/conf && pax -rw * ${PREFIX}/share/examples/ntp

.include <bsd.port.mk>
@


