head	1.3;
access;
symbols
	OPENBSD_4_0:1.2.0.14
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.12
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.10
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.8
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.6
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.4
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.2
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.1.1.1.0.4
	OPENBSD_3_3_BASE:1.1.1.1
	OPENBSD_3_2:1.1.1.1.0.2
	OPENBSD_3_2_BASE:1.1.1.1
	naddy_20020723:1.1.1.1
	naddy:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2006.09.22.05.56.25;	author pvalchev;	state dead;
branches;
next	1.2;

1.2
date	2003.08.22.11.18.19;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2002.07.23.11.52.12;	author naddy;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2002.07.23.11.52.12;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to netatalk-2.0.3 and get rid of old directory structure.
A long due update with important features such as long filenames,
unicode, etc.
From new maintainer "Arnaud Bergeron" <abergeron@@gmail.com>
@
text
@$OpenBSD: patch-etc_atalkd_config_c,v 1.2 2003/08/22 11:18:19 naddy Exp $
--- etc/atalkd/config.c.orig	Wed Mar 19 10:39:30 2003
+++ etc/atalkd/config.c	Mon Aug 18 14:22:49 2003
@@@@ -202,9 +202,10 @@@@ int writeconf( cf )
     }
 
     if (( p = strrchr( path, '/' )) == NULL ) {
-	strcpy( newpath, _PATH_ATALKDTMP );
+	(void)strlcpy( newpath, _PATH_ATALKDTMP,sizeof(newpath));
     } else {
-	sprintf( newpath, "%.*s/%s", (int)(p - path), path, _PATH_ATALKDTMP );
+	snprintf( newpath,sizeof(newpath), "%.*s/%s", (int)(p - path),
+		path, _PATH_ATALKDTMP );
     }
     if (( fd = open( newpath, O_WRONLY|O_CREAT|O_TRUNC, mode )) < 0 ) {
 	LOG(log_error, logtype_atalkd, "%s: %s", newpath, strerror(errno) );
@@@@ -336,8 +337,7 @@@@ int readconf( cf )
 	 * Check that av[ 0 ] is a valid interface.
 	 * Not possible under sysV.
 	 */
-	strncpy( ifr.ifr_name, argv[ 0 ], sizeof(ifr.ifr_name) );
-	ifr.ifr_name[sizeof(ifr.ifr_name) - 1] = '\0';
+	(void)strlcpy( ifr.ifr_name, argv[ 0 ], sizeof(ifr.ifr_name));
 
 	/* for devices that don't support appletalk */
 	if ((ioctl(s, SIOCGIFADDR, &ifr) < 0) && (errno == ENODEV)) {
@@@@ -546,7 +546,7 @@@@ int net( iface, av )
 	stop++;
     }
     net = atoi( nrange );
-    if ( net < 0 || net >= 0xffff ) {
+    if ( net < 1 || net >= 0xffff ) {
 	fprintf( stderr, "Bad network: %d\n", net );
 	return -1;
     }
@@@@ -780,7 +780,7 @@@@ struct interface *newiface( name )
 int plumb()
 {
     struct interface	*iface;
-    char		device[ MAXPATHLEN + 1], *p;
+    char		device[MAXPATHLEN], *p;
     int			fd, ppa;
 
     for ( iface = interfaces; iface != NULL; iface = iface->i_next ) {
@@@@ -788,8 +788,8 @@@@ int plumb()
 	    continue;
 	}
 
-	strcpy( device, "/dev/" );
-	strcat( device, iface->i_name );
+	(void)strlcpy(device, "/dev/", sizef(device));
+	(void)strlcat(device, iface->i_name, sizeof(device));
 	if (( p = strpbrk( device, "0123456789" )) == NULL ) {
 	    LOG(log_error, logtype_atalkd, "plumb: invalid device: %s", device );
 	    return -1;
@


1.2
log
@update to 1.6.3; from Ian McWilliam <ianm@@cit.uws.edu.au>
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@Initial revision
@
text
@d2 26
a27 3
--- etc/atalkd/config.c.orig	Sat Jun 15 04:26:04 2002
+++ etc/atalkd/config.c	Sat Jun 15 04:27:47 2002
@@@@ -545,7 +545,7 @@@@ int net( iface, av )
d36 20
@


1.1.1.1
log
@Import netatalk 1.5.3.1.
Submitted by Ian McWilliam <i.mcwilliam@@uws.edu.au>.

AFP file and print services for AppleTalk/IP networks
@
text
@@
