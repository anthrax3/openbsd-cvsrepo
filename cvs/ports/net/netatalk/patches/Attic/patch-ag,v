head	1.3;
access;
symbols
	OPENBSD_2_6:1.2.0.4
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.2
	OPENBSD_2_5_BASE:1.2
	marc_1999-Jan-18:1.1.1.1
	marc:1.1.1;
locks; strict;
comment	@# @;


1.3
date	99.12.15.02.56.47;	author kevlo;	state dead;
branches;
next	1.2;

1.2
date	99.03.16.12.57.58;	author marc;	state Exp;
branches;
next	1.1;

1.1
date	99.01.19.04.40.13;	author marc;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.01.19.04.40.13;	author marc;	state Exp;
branches;
next	;


desc
@@


1.3
log
@95% of the warnings are fixed. Port no longer destroys /etc/netatalk/rc.atalk
if it exists.
@
text
@--- etc/afpd/file.c.orig	Sat Oct 19 06:33:04 1996
+++ etc/afpd/file.c	Tue Mar 31 02:24:45 1998
@@@@ -25,6 +25,7 @@@@
 #include <unistd.h>
 
 #include "directory.h"
+#include "desktop.h"
 #include "volume.h"
 #include "file.h"
 #include "globals.h"
@@@@ -124,16 +125,16 @@@@
 	    break;
 
 	case FILPBIT_FINFO :
-	    if ( !isad ||
-		    bcmp( ad_entry( &ad, ADEID_FINDERI ), ufinderi, 8 ) == 0 ) {
+	    if ( !isad ) {
 		bcopy( ufinderi, data, 32 );
-		if (( em = getextmap( path )) != NULL ) {
-		    bcopy( em->em_type, data, sizeof( em->em_type ));
-		    bcopy( em->em_creator, data + 4, sizeof( em->em_creator ));
-		}
 	    } else {
 		bcopy( ad_entry( &ad, ADEID_FINDERI ), data, 32 );
 	    }
+	    if ( bcmp( data, ufinderi, 8 ) == 0 &&
+		    ( em = getextmap( path )) != NULL ) {
+		bcopy( em->em_type, data, sizeof( em->em_type ));
+		bcopy( em->em_creator, data + 4, sizeof( em->em_creator ));
+	    }
 	    data += 32;
 	    break;
 
@@@@ -317,7 +318,7 @@@@
 	return( AFPERR_NOOBJ );
     }
 
-    if ((int)ibuf & 1 ) {
+    if ((long)ibuf & 1 ) {
 	ibuf++;
     }
 
@@@@ -666,6 +667,10 @@@@
 {
     struct adouble	ad;
     int			adflags;
+
+    if ( of_findfile( curdir, utompath( file )) != NULL ) {
+	return( AFPERR_BUSY );
+    }
 
     adflags = ADFLAGS_DF|ADFLAGS_HF;
     if ( ad_open( file, adflags, O_RDWR, 0, &ad ) < 0 ) {
@


1.2
log
@patches from Ian McWilliam <I.McWilliam@@cit.nepean.uws.edu.au>
Ian says: Sometime around January 1999 2.4-current sources broke
the handling of afpd group access. Now fixed.
Various fixes and updates to afpd.
@
text
@@


1.1
log
@Initial revision
@
text
@d1 53
a53 11
--- etc/afpd/Makefile.orig	Fri Jan  8 19:06:13 1999
+++ etc/afpd/Makefile	Fri Jan  8 19:06:31 1999
@@@@ -21,7 +21,7 @@@@
 	if [ x"${KRBDIR}" != x ]; then \
 	    KRBLIBS="-lkrb -ldes"; \
 	    KRBLIBDIRS="-L${KRBDIR}/lib"; \
-	    KRBINCPATH="-I${KRBDIR}/include"; \
+	    KRBINCPATH="-I${KRBDIR}/include/kerberosIV"; \
 	    KRBDEFS="-DKRB"; \
 	fi; \
 	if [ x"${AFSDIR}" != x ]; then \
@


1.1.1.1
log
@netatalk 1.4b2 port; ianm@@cit.nepean.uws.edu.au
@
text
@@
