head	1.1;
branch	1.1.1;
access;
symbols
	OPENBSD_6_2:1.1.1.1.0.28
	OPENBSD_6_2_BASE:1.1.1.1
	OPENBSD_6_1:1.1.1.1.0.26
	OPENBSD_6_1_BASE:1.1.1.1
	OPENBSD_6_0:1.1.1.1.0.24
	OPENBSD_6_0_BASE:1.1.1.1
	OPENBSD_5_9:1.1.1.1.0.20
	OPENBSD_5_9_BASE:1.1.1.1
	OPENBSD_5_8:1.1.1.1.0.22
	OPENBSD_5_8_BASE:1.1.1.1
	OPENBSD_5_7:1.1.1.1.0.18
	OPENBSD_5_7_BASE:1.1.1.1
	OPENBSD_5_6:1.1.1.1.0.16
	OPENBSD_5_6_BASE:1.1.1.1
	OPENBSD_5_5:1.1.1.1.0.14
	OPENBSD_5_5_BASE:1.1.1.1
	OPENBSD_5_4:1.1.1.1.0.12
	OPENBSD_5_4_BASE:1.1.1.1
	OPENBSD_5_3:1.1.1.1.0.10
	OPENBSD_5_3_BASE:1.1.1.1
	OPENBSD_5_2:1.1.1.1.0.8
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.6
	OPENBSD_5_0:1.1.1.1.0.4
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.2
	OPENBSD_4_9_BASE:1.1.1.1
	pea_20101025:1.1.1.1
	pea:1.1.1;
locks; strict;
comment	@# @;


1.1
date	2010.10.25.12.42.24;	author pea;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.10.25.12.42.24;	author pea;	state Exp;
branches;
next	;


desc
@@



1.1
log
@Initial revision
@
text
@$OpenBSD$
--- bindgraph.cgi.orig	Mon May  5 00:26:18 2003
+++ bindgraph.cgi	Wed Oct  6 14:02:01 2010
@@@@ -8,11 +8,12 @@@@
 
 use RRDs;
 use strict;
+use POSIX qw(uname);
 
 my $VERSION = '0.1';
 
 # hostname. will be printed in the HTML page
-my $hostname = 'hostname.example.net (please edit bindgraph.cgi)';
+my $hostname = (POSIX::uname())[1];
 # path of the RRD database
 my $rrd = '/var/www/as112/rrd/bindgraph.rrd';
 # temporary directory where the images will be saved
@@@@ -37,7 +38,7 @@@@ my @@graphs = (
 	{ title => 'Year Graph',		seconds => 3600*24*365,	},
 );
 
-my @@query_t = qw(AAAA CNAME NS ANY _other_ A PTR SOA TKEY);
+my @@query_t = qw(AAAA CNAME NS ANY _other_ A MX PTR SOA TKEY);
 my %color = (
 	MX		=> 'AA0000',
 	A		=> 'FF0080',
@@@@ -89,6 +90,10 @@@@ sub graph($$$;$) {
 		}
 	}
 
+       my $comment = 'last update: ' . localtime(last_update($rrd))
+          . '    graph created on ' . localtime(time) . '\r';
+       $comment =~ s|:|\\:|g unless $RRDs::VERSION < 1.199908;
+
 	my ($text, $xs, $ys) = RRDs::graph(
 		$file,
 		'--imgformat', 'PNG',
@@@@ -102,8 +107,7 @@@@ sub graph($$$;$) {
 		@@rrdef,
 		@@rrprint,
 		'COMMENT:\s',
-		'COMMENT:last update: ' . localtime(last_update($rrd))
-			. '    graph created on ' . localtime(time) . '\r',
+                'COMMENT:' . $comment,
 	);
 	my $err = RRDs::error;
 	die_fatal("RRDs::graph($file, ...): $err") if $err;
@@@@ -209,6 +213,7 @@@@ sub main {
 	$uri =~ s#/#,#g;
 	$uri =~ s#~#tilde,#g;
 
+       	mkdir("$tmp_dir", 0755);
 	die_fatal("ERROR: $tmp_dir does not exist") if not -d $tmp_dir;
 
 	if (not -d "$tmp_dir/$uri") {
@


1.1.1.1
log
@Import bindgraph:
Bindgraph makes pretty query statistics about BIND servers. It was derived
from well-known mailgraph package.

ok jasper@@
@
text
@@
