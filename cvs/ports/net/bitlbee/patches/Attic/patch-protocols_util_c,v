head	1.3;
access;
symbols
	OPENBSD_3_9:1.2.0.6
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.4
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.1.0.2
	OPENBSD_3_6_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2006.04.11.15.11.33;	author naddy;	state dead;
branches;
next	1.2;

1.2
date	2004.10.21.14.48.51;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.20.16.27.49;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to 1.0.2; from maintainer Andrew Dalgleish
@
text
@$OpenBSD: patch-protocols_util_c,v 1.2 2004/10/21 14:48:51 naddy Exp $
--- protocols/util.c.orig	Sat Sep 11 02:03:07 2004
+++ protocols/util.c	Thu Oct 14 15:43:35 2004
@@@@ -131,14 +131,15 @@@@ char *str_to_utf8(unsigned char *in)
 void strip_linefeed(gchar *text)
 {
 	int i, j;
-	gchar *text2 = g_malloc(strlen(text) + 1);
+	size_t text_len = strlen(text) + 1;
+	gchar *text2 = g_malloc(text_len);
 
 	for (i = 0, j = 0; text[i]; i++)
 		if (text[i] != '\r')
 			text2[j++] = text[i];
 	text2[j] = '\0';
 
-	strcpy(text, text2);
+	strlcpy(text, text2, text_len);
 	g_free(text2);
 }
 
@@@@ -239,7 +240,6 @@@@ char *normalize(const char *s)
 
 	u = t = g_strdup(s);
 
-	strcpy(t, s);
 	g_strdown(t);
 
 	while (*t && (x < BUF_LEN - 1)) {
@@@@ -304,7 +304,8 @@@@ static htmlentity_t ent[] =
 void strip_html( char *in )
 {
 	char *start = in;
-	char *out = g_malloc( strlen( in ) + 1 );
+	size_t in_len = strlen( in ) + 1;
+	char *out = g_malloc(in_len);
 	char *s = out, *cs;
 	int i, matched;
 	
@@@@ -363,7 +364,7 @@@@ void strip_html( char *in )
 		}
 	}
 	
-	strcpy( start, out );
+	strlcpy( start, out, in_len );
 	g_free( out );
 } 
 
@


1.2
log
@Updated to 0.91; from Andrew Dalgleish <openbsd@@ajd.net.au>.
@
text
@d1 1
a1 1
$OpenBSD: patch-protocols_util_c,v 1.1 2004/06/20 16:27:49 naddy Exp $
@


1.1
log
@Update to 0.90.
Partial audit for string handling.

From: Andrew Dalgleish <openbsd@@ajd.net.au>
@
text
@d1 3
a3 3
$OpenBSD$
--- protocols/util.c.orig	2004-03-18 07:21:12.000000000 +1100
+++ protocols/util.c	2004-06-09 19:29:44.000000000 +1000
d22 1
a22 1
@@@@ -238,7 +239,6 @@@@ char *normalize(const char *s)
d30 1
a30 1
@@@@ -301,7 +301,8 @@@@ static htmlentity_t ent[] =
d38 3
a40 3
 	int i;
 	int matched;
@@@@ -344,6 +345,6 @@@@ void strip_html( char *in )
d48 1
@

