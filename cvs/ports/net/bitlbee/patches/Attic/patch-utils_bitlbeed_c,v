head	1.4;
access;
symbols
	OPENBSD_4_3:1.3.0.8
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.6
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.4
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.2
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.2.0.6
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.4
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.1.0.2
	OPENBSD_3_6_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2008.04.09.22.13.12;	author merdely;	state dead;
branches;
next	1.3;

1.3
date	2006.04.11.15.11.33;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2004.10.21.14.48.51;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.20.16.27.49;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to 1.2.
V1.2 adds nice "account set #" feature to manage accounts.
Remove a lot of string handling patches.
Remove patches to rename bitlbee "root" user to "bitlbee".

tested by Andrew Dalgleish (MAINTAINER), James Turner and Wiktor Izdebski
ok martynas@@, simon@@, okan@@, wcmaier@@
@
text
@$OpenBSD: patch-utils_bitlbeed_c,v 1.3 2006/04/11 15:11:33 naddy Exp $
--- utils/bitlbeed.c.orig	Wed Jul  7 23:27:38 2004
+++ utils/bitlbeed.c	Tue Nov  1 22:07:23 2005
@@@@ -120,8 +120,7 @@@@ int main( int argc, char *argv[] )
 	fcntl( serv_fd, F_SETFD, FD_CLOEXEC );
 	if (set->local) {
 		local_addr.sun_family = AF_LOCAL;
-		strncpy( local_addr.sun_path, set->interface, sizeof( local_addr.sun_path ) - 1 );
-		local_addr.sun_path[sizeof( local_addr.sun_path ) - 1] = '\0';
+		strlcpy( local_addr.sun_path, set->interface, sizeof( local_addr.sun_path ) );
 		
 		/* warning - don't let untrusted users run this program if it
 		   is setuid/setgid! Arbitrary file deletion risk! */
@@@@ -408,14 +407,14 @@@@ void do_log( char *fmt, ... )
 	memset( line, 0, MAX_LOG_LEN );
 	
 	tm = time( NULL );
-	strcpy( line, ctime( &tm ) );
+	strlcpy( line, ctime( &tm ), sizeof(line) );
 	l = strlen( line );
 	line[l-1] = ' ';
 	
 	va_start( params, fmt );
-	vsnprintf( line + l, MAX_LOG_LEN - l - 2, fmt, params );
+	vsnprintf( line + l, sizeof(line) - l - 2, fmt, params );
 	va_end( params );
-	strcat( line, "\n" );
+	strlcat( line, "\n", sizeof(line) );
 	
 	fprintf( logfile, "%s", line );
 }
@


1.3
log
@update to 1.0.2; from maintainer Andrew Dalgleish
@
text
@d1 1
a1 1
$OpenBSD: patch-utils_bitlbeed_c,v 1.2 2004/10/21 14:48:51 naddy Exp $
@


1.2
log
@Updated to 0.91; from Andrew Dalgleish <openbsd@@ajd.net.au>.
@
text
@d1 1
a1 1
$OpenBSD: patch-utils_bitlbeed_c,v 1.1 2004/06/20 16:27:49 naddy Exp $
d3 12
a14 2
+++ utils/bitlbeed.c	Thu Oct 14 15:43:35 2004
@@@@ -408,14 +408,14 @@@@ void do_log( char *fmt, ... )
@


1.1
log
@Update to 0.90.
Partial audit for string handling.

From: Andrew Dalgleish <openbsd@@ajd.net.au>
@
text
@d1 4
a4 4
$OpenBSD$
--- utils/bitlbeed.c.orig	2004-05-15 22:23:20.000000000 +1000
+++ utils/bitlbeed.c	2004-06-09 20:38:47.000000000 +1000
@@@@ -352,14 +352,14 @@@@ void log( char *fmt, ... )
@

