head	1.5;
access;
symbols
	OPENBSD_4_3:1.4.0.2
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.3.0.6
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.4
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.2
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.2.0.6
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.4
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.1.0.2
	OPENBSD_3_6_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2008.04.09.22.13.12;	author merdely;	state dead;
branches;
next	1.4;

1.4
date	2007.11.19.11.44.33;	author martynas;	state Exp;
branches;
next	1.3;

1.3
date	2006.04.11.15.11.33;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2004.10.21.14.48.51;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.20.16.27.49;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update to 1.2.
V1.2 adds nice "account set #" feature to manage accounts.
Remove a lot of string handling patches.
Remove patches to rename bitlbee "root" user to "bitlbee".

tested by Andrew Dalgleish (MAINTAINER), James Turner and Wiktor Izdebski
ok martynas@@, simon@@, okan@@, wcmaier@@
@
text
@$OpenBSD: patch-protocols_yahoo_yahoo_c,v 1.4 2007/11/19 11:44:33 martynas Exp $
--- protocols/yahoo/yahoo.c.orig	Mon Aug 20 16:27:16 2007
+++ protocols/yahoo/yahoo.c	Mon Nov 19 13:39:01 2007
@@@@ -382,8 +382,11 @@@@ static int byahoo_chat_open( struct gaim_connection *g
 	char *roomname;
 	YList *members;
 	
-	roomname = g_new0( char, strlen( gc->username ) + 16 );
-	g_snprintf( roomname, strlen( gc->username ) + 16, "%s-Bee-%d", gc->username, byahoo_chat_id );
+	{
+		size_t len = strlen( gc->username ) + 16;
+		roomname = g_new0( char, len);
+		g_snprintf( roomname, len, "%s-Bee-%d", gc->username, byahoo_chat_id );
+	}
 	
 	c = serv_got_joined_chat( gc, ++byahoo_chat_id, roomname );
 	add_chat_buddy( c, gc->username );
@@@@ -561,13 +564,17 @@@@ void ext_yahoo_login_response( int id, int succ, char 
 		
 		if( url && *url )
 		{
-			s = g_malloc( strlen( "Error %d (%s). See %s for more information." ) + strlen( url ) + strlen( errstr ) + 16 );
-			sprintf( s, "Error %d (%s). See %s for more information.", succ, errstr, url );
+			const char format[] = "Error %d (%s). See %s for more information.";
+			size_t s_len = strlen(format) + strlen( url ) + strlen( errstr ) + 16;
+			s = g_malloc( s_len);
+			snprintf( s, s_len, format, succ, errstr, url );
 		}
 		else
 		{
-			s = g_malloc( strlen( "Error %d (%s)" ) + strlen( errstr ) + 16 );
-			sprintf( s, "Error %d (%s)", succ, errstr );
+			const char format[] = "Error %d (%s)";
+			size_t s_len = strlen(format) + strlen( errstr ) + 16;
+			s = g_malloc(s_len);
+			snprintf( s, s_len, format, succ, errstr );
 		}
 		
 		if( yd->logged_in )
@@@@ -777,7 +784,7 @@@@ int ext_yahoo_connect(char *host, int port)
 		if(!(server = gethostbyname(host))) {
 			return -1;
 		}
-		strncpy(last_host, host, 255);
+		strlcpy(last_host, host, sizeof(last_host));
 	}
 
 	if((servfd = socket(AF_INET, SOCK_STREAM, 0)) < 0) {
@@@@ -788,6 +795,7 @@@@ int ext_yahoo_connect(char *host, int port)
 	{
 		memset(&serv_addr, 0, sizeof(serv_addr));
 		serv_addr.sin_family = AF_INET;
+		assert(server->h_length <= sizeof(serv_addr.sin_addr.s_addr));
 		memcpy(&serv_addr.sin_addr.s_addr, *p, server->h_length);
 		serv_addr.sin_port = htons(port);
 
@@@@ -840,7 +848,7 @@@@ void ext_yahoo_got_conf_invite( int id, char *who, cha
 		if( g_strcasecmp( m->data, gc->username ) != 0 )
 			add_chat_buddy( inv->c, m->data );
 	
-	g_snprintf( txt, 1024, "Got an invitation to chatroom %s from %s: %s", room, who, msg );
+	g_snprintf( txt, sizeof(txt), "Got an invitation to chatroom %s from %s: %s", room, who, msg );
 	
 	do_ask_dialog( gc, txt, inv, byahoo_accept_conf, byahoo_reject_conf );
 }
@


1.4
log
@update to bitlbee-1.0.4
ok simon@@ and maintainer Andrew Dalgleish;  tested by Wiktor Izdebski
@
text
@d1 1
a1 1
$OpenBSD: patch-protocols_yahoo_yahoo_c,v 1.3 2006/04/11 15:11:33 naddy Exp $
@


1.3
log
@update to 1.0.2; from maintainer Andrew Dalgleish
@
text
@d1 4
a4 4
$OpenBSD: patch-protocols_yahoo_yahoo_c,v 1.2 2004/10/21 14:48:51 naddy Exp $
--- protocols/yahoo/yahoo.c.orig	Sun Jan 15 04:09:23 2006
+++ protocols/yahoo/yahoo.c	Sun Jan 29 03:23:16 2006
@@@@ -379,8 +379,11 @@@@ static int byahoo_chat_open( struct gaim
d18 1
a18 1
@@@@ -558,13 +561,17 @@@@ void ext_yahoo_login_response( int id, i
d40 1
a40 1
@@@@ -774,7 +781,7 @@@@ int ext_yahoo_connect(char *host, int po
d49 1
a49 1
@@@@ -785,6 +792,7 @@@@ int ext_yahoo_connect(char *host, int po
d57 1
a57 1
@@@@ -837,7 +845,7 @@@@ void ext_yahoo_got_conf_invite( int id, 
@


1.2
log
@Updated to 0.91; from Andrew Dalgleish <openbsd@@ajd.net.au>.
@
text
@d1 4
a4 4
$OpenBSD: patch-protocols_yahoo_yahoo_c,v 1.1 2004/06/20 16:27:49 naddy Exp $
--- protocols/yahoo/yahoo.c.orig	Thu Sep  9 22:06:54 2004
+++ protocols/yahoo/yahoo.c	Thu Oct 14 15:43:35 2004
@@@@ -360,8 +360,11 @@@@ static int byahoo_chat_open( struct gaim
d18 1
a18 1
@@@@ -527,13 +530,17 @@@@ void ext_yahoo_login_response( int id, i
d40 1
a40 1
@@@@ -736,7 +743,7 @@@@ int ext_yahoo_connect(char *host, int po
d49 9
a57 1
@@@@ -799,7 +806,7 @@@@ void ext_yahoo_got_conf_invite( int id, 
@


1.1
log
@Update to 0.90.
Partial audit for string handling.

From: Andrew Dalgleish <openbsd@@ajd.net.au>
@
text
@d1 4
a4 4
$OpenBSD$
--- protocols/yahoo/yahoo.c.orig	2004-05-11 21:43:50.000000000 +1000
+++ protocols/yahoo/yahoo.c	2004-06-09 20:27:32.000000000 +1000
@@@@ -350,8 +350,11 @@@@ static int byahoo_chat_open( struct gaim
d18 1
a18 1
@@@@ -503,13 +506,17 @@@@ void ext_yahoo_login_response( int id, i
d40 1
a40 1
@@@@ -710,7 +717,7 @@@@ int ext_yahoo_connect(char *host, int po
d49 2
a50 2
@@@@ -772,7 +779,7 @@@@ void ext_yahoo_got_conf_invite( int id, 
 		if( g_ascii_strcasecmp( m->data, gc->username ) != 0 )
@

