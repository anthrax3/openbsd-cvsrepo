head	1.6;
access;
symbols
	OPENBSD_3_8:1.5.0.2
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.4.0.6
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.4.0.4
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.4.0.2
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.1.0.2
	OPENBSD_3_4_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2005.09.09.20.08.54;	author brad;	state dead;
branches;
next	1.5;

1.5
date	2005.04.07.00.49.18;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	2004.02.29.07.12.42;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2003.10.31.16.40.06;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2003.10.29.04.12.47;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2003.08.19.03.52.27;	author jolan;	state Exp;
branches;
next	;


desc
@@


1.6
log
@sync operops patch and add amd64 workaround for silcmath from silc-toolkit
@
text
@$OpenBSD: operops-patch-silcd_command_c,v 1.5 2005/04/07 00:49:18 brad Exp $
--- silcd/command.c.orig	Mon Apr  4 08:47:25 2005
+++ silcd/command.c	Wed Apr  6 12:46:06 2005
@@@@ -3422,6 +3422,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
 						  client_id, TRUE, NULL);
 
   if (target_client != client &&
+      !(client->mode & SILC_UMODE_SERVER_OPERATOR) &&
+      !(client->mode & SILC_UMODE_ROUTER_OPERATOR) &&
       !(sender_mask & SILC_CHANNEL_UMODE_CHANFO) &&
       !(sender_mask & SILC_CHANNEL_UMODE_CHANOP)) {
     silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
@@@@ -3541,8 +3543,10 @@@@ SILC_SERVER_CMD_FUNC(cumode)
     /* Promote to operator */
     if (!(chl->mode & SILC_CHANNEL_UMODE_CHANOP)) {
       if (!(sender_mask & SILC_CHANNEL_UMODE_CHANOP) &&
-          !(sender_mask & SILC_CHANNEL_UMODE_CHANFO)) {
-        silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
+          !(sender_mask & SILC_CHANNEL_UMODE_CHANFO) &&
+          !(client->mode & SILC_UMODE_SERVER_OPERATOR) &&
+          !(client->mode & SILC_UMODE_ROUTER_OPERATOR)) {
+	silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
 					     SILC_STATUS_ERR_NO_CHANNEL_PRIV,
 					     0, 2, tmp_ch_id, tmp_ch_len);
         goto out;
@@@@ -3554,7 +3558,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
   } else {
     if (chl->mode & SILC_CHANNEL_UMODE_CHANOP) {
       if (!(sender_mask & SILC_CHANNEL_UMODE_CHANOP) &&
-          !(sender_mask & SILC_CHANNEL_UMODE_CHANFO)) {
+          !(sender_mask & SILC_CHANNEL_UMODE_CHANFO) &&
+          !(client->mode & SILC_UMODE_SERVER_OPERATOR) &&
+          !(client->mode & SILC_UMODE_ROUTER_OPERATOR)) {
         silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
 					     SILC_STATUS_ERR_NO_CHANNEL_PRIV,
 					     0, 2, tmp_ch_id, tmp_ch_len);
@


1.5
log
@upgrade to silc-server 0.9.19.1
@
text
@d1 1
a1 1
$OpenBSD: operops-patch-silcd_command_c,v 1.4 2004/02/29 07:12:42 brad Exp $
@


1.4
log
@upgrade to silc-server 0.9.17
@
text
@d1 4
a4 4
$OpenBSD$
--- silcd/command.c.orig	2004-02-24 09:39:10.000000000 -0500
+++ silcd/command.c	2004-02-29 01:05:33.000000000 -0500
@@@@ -3354,6 +3354,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d13 1
a13 1
@@@@ -3473,8 +3475,10 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d26 1
a26 1
@@@@ -3486,7 +3490,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
@


1.3
log
@upgrade to silc-server 0.9.15
@
text
@d1 5
a5 5
$OpenBSD: operops-patch-silcd_command_c,v 1.2 2003/10/29 04:12:47 brad Exp $
--- silcd/command.c.orig	2003-10-30 10:01:41.000000000 -0500
+++ silcd/command.c	2003-10-31 11:04:58.000000000 -0500
@@@@ -3329,6 +3329,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
   }
d13 1
a13 1
@@@@ -3440,7 +3442,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d18 1
d22 1
a22 1
         silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
d25 2
a26 1
@@@@ -3453,7 +3457,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
@


1.2
log
@upgrade to silc-server 0.9.14
- takeover as MAINTAINER
--
ok MAINTAINER
@
text
@d1 4
a4 4
$OpenBSD: operops-patch-silcd_command_c,v 1.1 2003/08/19 03:52:27 jolan Exp $
--- silcd/command.c.orig	2003-10-08 14:03:56.000000000 -0400
+++ silcd/command.c	2003-10-27 12:27:12.000000000 -0500
@@@@ -3326,6 +3326,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d13 1
a13 1
@@@@ -3437,7 +3439,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d24 1
a24 1
@@@@ -3450,7 +3454,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
@


1.1
log
@incorporate patches from Dragos Ruiu as a FLAVOR which allow a SILC
operator to give themselves operator status on any channel.
@
text
@d1 4
a4 4
$OpenBSD$
--- silcd/command.c.orig	2003-03-17 11:01:53.000000000 -0600
+++ silcd/command.c	2003-08-18 17:45:58.000000000 -0500
@@@@ -3154,6 +3154,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d12 2
a13 2
     silc_server_command_send_status_reply(cmd, SILC_COMMAND_CUMODE,
@@@@ -3261,7 +3263,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d16 1
a16 1
       if (!(sender_mask & SILC_CHANNEL_UMODE_CHANOP) && 
d20 5
a24 5
+          !(client->mode & SILC_UMODE_ROUTER_OPERATOR)) { 
         silc_server_command_send_status_reply(cmd, SILC_COMMAND_CUMODE,
                                               SILC_STATUS_ERR_NO_CHANNEL_PRIV,
                                               0);
@@@@ -3274,7 +3278,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d31 4
a34 4
+          !(client->mode & SILC_UMODE_ROUTER_OPERATOR)) { 
         silc_server_command_send_status_reply(cmd, SILC_COMMAND_CUMODE,   
                                               SILC_STATUS_ERR_NO_CHANNEL_PRIV,
                                               0);
@

