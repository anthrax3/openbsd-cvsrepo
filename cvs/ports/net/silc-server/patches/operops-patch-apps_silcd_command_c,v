head	1.7;
access;
symbols
	OPENBSD_6_2:1.7.0.14
	OPENBSD_6_2_BASE:1.7
	OPENBSD_6_1:1.7.0.12
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.7.0.10
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.6
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.8
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.4
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.2
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.6.0.18
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.16
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.14
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.12
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.10
	OPENBSD_5_0:1.6.0.8
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.6
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.4
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.2
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.5.0.4
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.2
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.4.0.2
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.1.0.10
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.8
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.6
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.4
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.2
	OPENBSD_3_9_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2014.07.16.21.17.04;	author brad;	state Exp;
branches;
next	1.6;
commitid	bLSrylMZOaYW0Wco;

1.6
date	2009.09.27.19.25.02;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2008.09.26.21.17.57;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	2008.04.22.00.34.30;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2008.04.17.10.26.15;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2008.03.22.23.06.50;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2005.09.09.20.08.54;	author brad;	state Exp;
branches
	1.1.10.1;
next	;

1.1.10.1
date	2008.06.10.04.14.11;	author robert;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Update to silc-server 1.1.19.

ok sthen@@
@
text
@$OpenBSD: operops-patch-apps_silcd_command_c,v 1.6 2009/09/27 19:25:02 sthen Exp $
--- apps/silcd/command.c.orig	Tue May  6 06:28:30 2014
+++ apps/silcd/command.c	Wed Jul 16 12:25:33 2014
@@@@ -3531,6 +3531,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
 						  TRUE, NULL);
 
   if (target_client != client &&
+      !(client->mode & SILC_UMODE_SERVER_OPERATOR) &&
+      !(client->mode & SILC_UMODE_ROUTER_OPERATOR) &&
       !(sender_mask & SILC_CHANNEL_UMODE_CHANFO) &&
       !(sender_mask & SILC_CHANNEL_UMODE_CHANOP)) {
     tmp_ch_id = silc_argument_get_arg_type(cmd->args, 1, &tmp_ch_len);
@@@@ -3654,7 +3656,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
     /* Promote to operator */
     if (!(chl->mode & SILC_CHANNEL_UMODE_CHANOP)) {
       if (!(sender_mask & SILC_CHANNEL_UMODE_CHANOP) &&
-          !(sender_mask & SILC_CHANNEL_UMODE_CHANFO)) {
+          !(sender_mask & SILC_CHANNEL_UMODE_CHANFO) &&
+          !(client->mode & SILC_UMODE_SERVER_OPERATOR) &&
+          !(client->mode & SILC_UMODE_ROUTER_OPERATOR)) {
 	tmp_ch_id = silc_argument_get_arg_type(cmd->args, 1, &tmp_ch_len);
         silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
 					     SILC_STATUS_ERR_NO_CHANNEL_PRIV,
@@@@ -3668,7 +3672,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
   } else {
     if (chl->mode & SILC_CHANNEL_UMODE_CHANOP) {
       if (!(sender_mask & SILC_CHANNEL_UMODE_CHANOP) &&
-          !(sender_mask & SILC_CHANNEL_UMODE_CHANFO)) {
+          !(sender_mask & SILC_CHANNEL_UMODE_CHANFO) &&
+          !(client->mode & SILC_UMODE_SERVER_OPERATOR) &&
+          !(client->mode & SILC_UMODE_ROUTER_OPERATOR)) {
 	tmp_ch_id = silc_argument_get_arg_type(cmd->args, 1, &tmp_ch_len);
         silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
 					     SILC_STATUS_ERR_NO_CHANNEL_PRIV,
@


1.6
log
@Update to 1.1.18, from Brad.
@
text
@d1 4
a4 4
$OpenBSD: operops-patch-apps_silcd_command_c,v 1.5 2008/09/26 21:17:57 brad Exp $
--- apps/silcd/command.c.orig	Sat Sep 26 16:34:12 2009
+++ apps/silcd/command.c	Sat Sep 26 22:38:46 2009
@@@@ -3497,6 +3497,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d13 1
a13 1
@@@@ -3620,7 +3622,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d24 1
a24 1
@@@@ -3634,7 +3638,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
@


1.5
log
@Update to silc-server 1.1.13; bug fix update.

ok johan@@
@
text
@d1 4
a4 4
$OpenBSD: operops-patch-apps_silcd_command_c,v 1.4 2008/04/22 00:34:30 sthen Exp $
--- apps/silcd/command.c.orig	Thu Sep 25 07:09:27 2008
+++ apps/silcd/command.c	Thu Sep 25 13:24:09 2008
@@@@ -3498,6 +3498,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d13 1
a13 1
@@@@ -3621,7 +3623,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d24 1
a24 1
@@@@ -3635,7 +3639,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
@


1.4
log
@update to 1.1.5 + a crash fix from GIT. ok brad (maintainer).
@
text
@d1 4
a4 4
$OpenBSD: operops-patch-apps_silcd_command_c,v 1.3 2008/04/17 10:26:15 sthen Exp $
--- apps/silcd/command.c.orig	Sun Apr 20 17:01:20 2008
+++ apps/silcd/command.c	Sun Apr 20 17:24:58 2008
@@@@ -3490,6 +3490,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d13 1
a13 1
@@@@ -3613,7 +3615,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d24 1
a24 1
@@@@ -3627,7 +3631,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
@


1.3
log
@update to 1.1.4 from Brad - fixes portability bugs including a
remote user-triggerable DoS on strict alignment arch.
@
text
@d1 4
a4 4
$OpenBSD: operops-patch-apps_silcd_command_c,v 1.2 2008/03/22 23:06:50 sthen Exp $
--- apps/silcd/command.c.orig	Wed Apr 16 10:53:47 2008
+++ apps/silcd/command.c	Wed Apr 16 13:37:43 2008
@@@@ -3491,6 +3491,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d13 1
a13 1
@@@@ -3614,7 +3616,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d24 1
a24 1
@@@@ -3628,7 +3632,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
@


1.2
log
@SECURITY update: fixes possible buffer overflow in PKCS#1 message decoding.
Version update 1.0 -> 1.1 as tested by several people.
@
text
@d1 4
a4 4
$OpenBSD: operops-patch-apps_silcd_command_c,v 1.1 2005/09/09 20:08:54 brad Exp $
--- apps/silcd/command.c.orig	Sun Nov 18 07:37:54 2007
+++ apps/silcd/command.c	Fri Feb 29 23:43:39 2008
@@@@ -3486,6 +3486,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d13 1
a13 1
@@@@ -3609,7 +3611,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d24 1
a24 1
@@@@ -3623,7 +3627,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
@


1.1
log
@sync operops patch and add amd64 workaround for silcmath from silc-toolkit
@
text
@d1 5
a5 5
$OpenBSD$
--- apps/silcd/command.c.orig	Fri Sep  9 13:05:36 2005
+++ apps/silcd/command.c	Fri Sep  9 13:08:28 2005
@@@@ -3431,6 +3431,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
 						  client_id, TRUE, NULL);
d12 2
a13 2
     silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
@@@@ -3550,8 +3552,10 @@@@ SILC_SERVER_CMD_FUNC(cumode)
a17 1
-        silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
d21 2
a22 1
+       silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
d24 1
a24 3
 					     0, 2, tmp_ch_id, tmp_ch_len);
         goto out;
@@@@ -3563,7 +3567,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d32 1
a34 1
 					     0, 2, tmp_ch_id, tmp_ch_len);
@


1.1.10.1
log
@update to 1.1.5;

- fixes portability bugs including a
  remote user-triggerable DoS on strict alignment arch.
- a crash fix from GIT

from William Yodlowsky
@
text
@d1 5
a5 5
$OpenBSD: operops-patch-apps_silcd_command_c,v 1.4 2008/04/22 00:34:30 sthen Exp $
--- apps/silcd/command.c.orig	Sun Apr 20 17:01:20 2008
+++ apps/silcd/command.c	Sun Apr 20 17:24:58 2008
@@@@ -3490,6 +3490,8 @@@@ SILC_SERVER_CMD_FUNC(cumode)
 						  TRUE, NULL);
d12 2
a13 2
     tmp_ch_id = silc_argument_get_arg_type(cmd->args, 1, &tmp_ch_len);
@@@@ -3613,7 +3615,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
d18 1
d22 1
a22 2
 	tmp_ch_id = silc_argument_get_arg_type(cmd->args, 1, &tmp_ch_len);
         silc_server_command_send_status_data(cmd, SILC_COMMAND_CUMODE,
d24 3
a26 1
@@@@ -3627,7 +3631,9 @@@@ SILC_SERVER_CMD_FUNC(cumode)
a33 1
 	tmp_ch_id = silc_argument_get_arg_type(cmd->args, 1, &tmp_ch_len);
d36 1
@


