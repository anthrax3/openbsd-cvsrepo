head	1.57;
access;
symbols
	OPENBSD_6_2:1.57.0.2
	OPENBSD_6_2_BASE:1.57
	OPENBSD_6_1:1.51.0.2
	OPENBSD_6_1_BASE:1.51
	OPENBSD_6_0:1.48.0.2
	OPENBSD_6_0_BASE:1.48
	OPENBSD_5_9:1.46.0.2
	OPENBSD_5_9_BASE:1.46
	OPENBSD_5_8:1.43.0.6
	OPENBSD_5_8_BASE:1.43
	OPENBSD_5_7:1.43.0.2
	OPENBSD_5_7_BASE:1.43
	OPENBSD_5_6:1.42.0.2
	OPENBSD_5_6_BASE:1.42
	OPENBSD_5_5:1.40.0.2
	OPENBSD_5_5_BASE:1.40
	OPENBSD_5_4:1.36.0.2
	OPENBSD_5_4_BASE:1.36
	OPENBSD_5_3:1.32.0.2
	OPENBSD_5_3_BASE:1.32
	OPENBSD_5_2:1.25.0.2
	OPENBSD_5_2_BASE:1.25
	OPENBSD_5_1_BASE:1.23
	OPENBSD_5_1:1.23.0.2
	OPENBSD_5_0:1.19.0.2
	OPENBSD_5_0_BASE:1.19
	OPENBSD_4_9:1.9.0.2
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.6.0.2
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.5.0.2
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.4.0.2
	OPENBSD_4_6_BASE:1.4
	landry_20090404:1.1.1.1
	landry:1.1.1;
locks; strict;
comment	@# @;


1.57
date	2017.07.26.22.45.28;	author sthen;	state Exp;
branches;
next	1.56;
commitid	tD4MFrpYYDDL2UFT;

1.56
date	2017.07.16.19.18.58;	author espie;	state Exp;
branches;
next	1.55;
commitid	tt0GhWK5c4uf9ILG;

1.55
date	2017.05.12.07.12.10;	author ajacoutot;	state Exp;
branches;
next	1.54;
commitid	LrSjCINQOhXrbNrv;

1.54
date	2017.04.18.09.13.20;	author sthen;	state Exp;
branches;
next	1.53;
commitid	31jGYmA9hiFBlkpg;

1.53
date	2017.04.17.20.45.38;	author sthen;	state Exp;
branches;
next	1.52;
commitid	EamK9yQHImFXeLW9;

1.52
date	2017.04.10.11.46.32;	author sthen;	state Exp;
branches;
next	1.51;
commitid	HY6VNZxjJWzKQFDV;

1.51
date	2017.02.06.20.28.32;	author sthen;	state Exp;
branches;
next	1.50;
commitid	o4jH3JaEdON0pzgr;

1.50
date	2017.01.11.08.41.32;	author ajacoutot;	state Exp;
branches;
next	1.49;
commitid	Z7b9VuloCOFn8HWG;

1.49
date	2016.08.27.13.37.40;	author ajacoutot;	state Exp;
branches;
next	1.48;
commitid	C2g7CiwsCJHgUUla;

1.48
date	2016.04.18.17.44.40;	author awolk;	state Exp;
branches;
next	1.47;
commitid	APIuRmwpw7hUcd17;

1.47
date	2016.03.20.17.59.21;	author naddy;	state Exp;
branches;
next	1.46;
commitid	DiLpGuORpWJnRdDH;

1.46
date	2016.01.20.11.29.05;	author sthen;	state Exp;
branches;
next	1.45;
commitid	fCq0GB8CwknCsk7Z;

1.45
date	2016.01.19.16.16.37;	author ajacoutot;	state Exp;
branches;
next	1.44;
commitid	JNDURCwQIKxsIObP;

1.44
date	2015.08.19.18.55.04;	author sthen;	state Exp;
branches;
next	1.43;
commitid	IjqIBfZ0w3tzCTnv;

1.43
date	2014.11.07.10.40.05;	author ajacoutot;	state Exp;
branches;
next	1.42;
commitid	QYJaNcIko4VHoTIl;

1.42
date	2014.03.25.11.18.46;	author ajacoutot;	state Exp;
branches;
next	1.41;

1.41
date	2014.03.09.19.46.35;	author espie;	state Exp;
branches;
next	1.40;

1.40
date	2013.08.11.08.57.57;	author ajacoutot;	state Exp;
branches;
next	1.39;

1.39
date	2013.08.10.22.42.24;	author ajacoutot;	state Exp;
branches;
next	1.38;

1.38
date	2013.08.10.12.46.22;	author ajacoutot;	state Exp;
branches;
next	1.37;

1.37
date	2013.08.07.21.32.18;	author naddy;	state Exp;
branches;
next	1.36;

1.36
date	2013.06.09.09.40.19;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2013.05.08.16.14.34;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2013.04.14.08.31.00;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2013.03.11.11.35.48;	author espie;	state Exp;
branches;
next	1.32;

1.32
date	2013.02.09.14.49.52;	author sthen;	state Exp;
branches;
next	1.31;

1.31
date	2012.11.27.12.16.07;	author sthen;	state Exp;
branches;
next	1.30;

1.30
date	2012.10.14.20.01.38;	author sthen;	state Exp;
branches;
next	1.29;

1.29
date	2012.10.12.13.01.15;	author sthen;	state Exp;
branches;
next	1.28;

1.28
date	2012.09.27.08.01.04;	author dcoppa;	state Exp;
branches;
next	1.27;

1.27
date	2012.09.01.14.36.58;	author ajacoutot;	state Exp;
branches;
next	1.26;

1.26
date	2012.08.25.13.12.59;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2012.03.30.16.28.58;	author ajacoutot;	state Exp;
branches
	1.25.2.1;
next	1.24;

1.24
date	2012.03.29.14.58.24;	author ajacoutot;	state Exp;
branches;
next	1.23;

1.23
date	2011.12.05.10.38.42;	author sthen;	state Exp;
branches;
next	1.22;

1.22
date	2011.10.29.08.12.32;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2011.09.18.19.57.30;	author ajacoutot;	state Exp;
branches;
next	1.20;

1.20
date	2011.09.16.11.13.38;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2011.06.08.18.00.49;	author jasper;	state Exp;
branches;
next	1.18;

1.18
date	2011.05.30.13.02.26;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2011.05.17.06.29.25;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2011.05.16.08.24.31;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2011.05.15.09.34.06;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2011.05.11.06.02.15;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2011.05.10.16.23.03;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2011.05.10.16.17.47;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2011.04.26.08.06.41;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2011.03.24.06.50.09;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2010.11.19.22.31.34;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2010.11.11.16.27.54;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2010.08.30.21.14.35;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2010.07.12.22.07.39;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2009.08.10.06.33.43;	author kili;	state Exp;
branches;
next	1.4;

1.4
date	2009.04.26.11.01.04;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2009.04.23.13.26.10;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2009.04.05.15.47.53;	author bernd;	state Exp;
branches;
next	1.1;

1.1
date	2009.04.04.10.07.31;	author landry;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.04.04.10.07.31;	author landry;	state Exp;
branches;
next	;

1.25.2.1
date	2012.10.12.13.02.15;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.57
log
@bump LIBCXX/LIBECXX/COMPILER_LIBCXX ports.
@
text
@# $OpenBSD: Makefile,v 1.56 2017/07/16 19:18:58 espie Exp $

COMMENT-main=		library handling all the details of proxy configuration
COMMENT-webkit=		pacrunner libproxy plugin for webkit-based browsers

GH_ACCOUNT=		libproxy
GH_PROJECT=		libproxy
GH_TAGNAME=		0.4.15
SUBST_VARS=		GH_TAGNAME

PKGNAME-main=		${DISTNAME}
PKGNAME-webkit=		${GH_PROJECT}-webkit-${GH_TAGNAME}
REVISION-main=		0
REVISION-webkit=	0

CATEGORIES=		net

SHARED_LIBS +=  proxy          1.1 # 0.0

HOMEPAGE=		https://libproxy.googlecode.com/

MAINTAINER=		Antoine Jacoutot <ajacoutot@@openbsd.org>

# LGPLv2.1
PERMIT_PACKAGE_CDROM=	Yes

# order matters: cmake must come before python
MODULES=		devel/cmake \
			lang/python

MODPY_VERSION=		${MODPY_DEFAULT_VERSION_3}

# cyclic dependency: libproxy,-webkit -> webkit -> gtk+3|libsoup -> glib2-networking -> libproxy
PSEUDO_FLAVORS=		no_webkit bootstrap
FLAVOR?=		no_webkit bootstrap

MULTI_PACKAGES=		-main -webkit

BUILD_DEPENDS=		lang/vala

RUN_DEPENDS-main=	${MODPY_RUN_DEPENDS}
LIB_DEPENDS-main=	devel/glib2

RUN_DEPENDS-webkit=	# empty
LIB_DEPENDS-webkit=	STEM->=${GH_TAGNAME}:${BUILD_PKGPATH}, \
			www/webkitgtk4

WANTLIB += intl m ${COMPILER_LIBCXX}

WANTLIB-main += ${WANTLIB}
WANTLIB-main += c gio-2.0 glib-2.0 gobject-2.0 perl pthread
WANTLIB-main += perl # uses perl ABI

WANTLIB-webkit += ${WANTLIB}
WANTLIB-webkit += glib-2.0 javascriptcoregtk-4.0 proxy pthread

CONFIGURE_ENV=	LIBlibproxy_VERSION=${LIBproxy_VERSION}
MAKE_ENV=	LIBlibproxy_VERSION=${LIBproxy_VERSION}

CONFIGURE_ARGS=		-DCMAKE_C_FLAGS="${CFLAGS}" \
			-DCMAKE_CXX_FLAGS="${CXXFLAGS}" \
			-DWITH_PERL:BOOL=ON \
			-DPERL_LINK_LIBPERL:BOOL=ON \
			-DWITH_GNOME3:BOOL=ON \
			-DWITH_VALA:BOOL=ON \
			-DWITH_DOTNET:BOOL=OFF \
			-DWITH_NM:BOOL=OFF \
			-DWITH_MOZJS:BOOL=OFF \
			-DWITH_NATUS:BOOL=OFF \
			-DBIPR:BOOL=OFF

.include <bsd.port.arch.mk>
.if ${BUILD_PACKAGES:M-webkit}
CONFIGURE_ARGS +=	-DWITH_WEBKIT3:BOOL=ON
.else
CONFIGURE_ARGS +=	-DWITH_WEBKIT:BOOL=OFF
.endif

.include <bsd.port.mk>
@


1.56
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2017/05/12 07:12:10 ajacoutot Exp $
d13 2
@


1.55
log
@Update to libproxy-0.4.15.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2017/04/18 09:13:20 sthen Exp $
d46 1
a46 1
WANTLIB += intl m ${LIBCXX}
@


1.54
log
@Switch to a simpler clang fix from FreeBSD: just stop defining _POSIX_C_SOURCE
rather than raising the version, and that way _BSD_SOURCE isn't needed either.
Pointed out by ajacoutot.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2017/04/17 20:45:38 sthen Exp $
d8 1
a8 1
GH_TAGNAME=		0.4.14
a9 3

REVISION-main=		2
REVISION-webkit=	1
@


1.53
log
@fix net/libproxy with libc++ by defining _POSIX_C_SOURCE=200809L and _BSD_SOURCE
clues from kettenis, espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2017/04/10 11:46:32 sthen Exp $
d11 2
a12 2
REVISION-main=		1
REVISION-webkit=	0
@


1.52
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2017/02/06 20:28:32 sthen Exp $
d11 2
a12 1
REVISION-main=		0
@


1.51
log
@Add perl to WANTLIB, second batch. This used to be done automatically but
since SHARED_ONLY support was removed across the ports tree the perl module
no longer adds it, so it must be done manually for any perl ports that
provide perl shared-library modules (i.e. libdata/perl5/site_perl/$ARCH/*.so)
and you must not remove them from WANTLIB even if they show as "Extra".
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2017/01/11 08:41:32 ajacoutot Exp $
d48 1
a48 1
WANTLIB += intl m stdc++
@


1.50
log
@Update to libproxy-0.4.14.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2016/08/27 13:37:40 ajacoutot Exp $
d11 2
d52 1
@


1.49
log
@Update to libproxy-0.4.13.
- drop gettext module
- take maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2016/04/18 17:44:40 awolk Exp $
d8 1
a8 1
GH_TAGNAME=		0.4.13
d29 2
a58 1
			-DWITH_PYTHON:BOOL=ON \
@


1.48
log
@Add a patch to prevent a null pointer dereference in net/libproxy under Gnome

Qt5 started to use libproxy and this exposed a crashing bug on OpenBSD
when using Qt5 applications on Gnome 3.

Here's a sample backtrace:
https://gist.github.com/mulander/c03997ae7e3fe4e30af0d4f2ce2965f0

The issue is caused by an unguarded dereference of ign_ip.

Other parts of the code properly expect that sockaddr_from_string
might return null and guard against it.

Adding a proper guard prevents a segfault both in OpenBSD
www/otter-browser and devel/zeal.

Issue reported upstream in:
 https://github.com/libproxy/libproxy/issues/24

OK zhuk@@ aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2016/03/20 17:59:21 naddy Exp $
d8 1
a8 3
GH_TAGNAME=		0.4.12
REVISION=		0
REVISION-main=		1
d20 2
a26 1
			devel/gettext \
d37 2
a38 4
RUN_DEPENDS-main=	${MODGETTEXT_RUN_DEPENDS} \
			${MODPY_RUN_DEPENDS}
LIB_DEPENDS-main=	${LIB_DEPENDS} \
			devel/glib2
d40 1
a40 1
RUN_DEPENDS-webkit=	${MODGETTEXT_RUN_DEPENDS}
d44 1
a44 1
cWANTLIB += m stdc++
d46 1
a46 1
WANTLIB-main += ${cWANTLIB} ${MODGETTEXT_WANTLIB}
d49 1
a49 1
WANTLIB-webkit += ${cWANTLIB} ${MODGETTEXT_WANTLIB}
d59 1
@


1.47
log
@remove SHARED_ONLY from some stragglers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2016/01/20 11:29:05 sthen Exp $
d10 1
@


1.46
log
@Fix libproxy's shared lib version, ok aja@@

cmake.port.mk sets LIBfoo_VERSION for cmake to use as appropriate,
but this only works when the library name matches between SHARED_LIBS
and the cmake infrastructure - in this case there's a mismatch with
"proxy" vs "libproxy".

This used to be handled in this port by patching cmake files but
that's awkward to maintain so no surprise it accidentally got lost
in the last update; replace it by setting appropriate CONFIGURE_ENV
and MAKE_ENV in the port Makefile instead which is more maintainable.

Build problem with dependent ports reported by nigel@@.
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.45 2016/01/19 16:16:37 ajacoutot Exp $

SHARED_ONLY=		Yes
@


1.45
log
@Update to libproxy-0.4.12.
Add KDE support.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2015/08/19 18:55:04 sthen Exp $
d11 1
d19 1
a19 1
SHARED_LIBS +=  proxy          1.0 # 0.0
d55 3
@


1.44
log
@sync WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2014/11/07 10:40:05 ajacoutot Exp $
d8 4
a11 2
VERSION=		0.4.11
DISTNAME=		libproxy-${VERSION}
d13 2
a14 5
PKGNAME-main=		libproxy-${VERSION}
PKGNAME-webkit=		libproxy-webkit-${VERSION}

REVISION-main=		3
REVISION-webkit=	4
d18 1
a18 1
SHARED_LIBS +=  proxy          1.1 # 0.0
a24 2
MASTER_SITES=		${HOMEPAGE}/files/

a29 2
SUBST_VARS+=		VERSION

d44 2
a45 2
LIB_DEPENDS-webkit=	STEM->=${VERSION}:${BUILD_PKGPATH}, \
			www/webkit,gtk3
d53 1
a53 1
WANTLIB-webkit += glib-2.0 javascriptcoregtk-3.0 proxy pthread
a60 1
			-DWITH_KDE4:BOOL=OFF \
d64 1
@


1.43
log
@No need for default CMAKE_BUILD_TYPE.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2014/03/25 11:18:46 ajacoutot Exp $
d15 1
a15 1
REVISION-webkit=	3
d58 1
a58 1
WANTLIB-webkit += glib-2.0 javascriptcoregtk-3.0 proxy
@


1.42
log
@Drop libproxy-mozilla; one JS interpreter (webkit) is enough and there is
no official support upstream for the newer spidermonkey.

discussed with and ok landry@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2014/03/09 19:46:35 espie Exp $
a61 1
			-DCMAKE_BUILD_TYPE:STRING=Release \
@


1.41
log
@put back the "bootstrap" annotation.
It is necessary when BUILD_ONCE is in place, but it was lost in dpb
through a code reorg.
@
text
@d1 1
a1 4
# $OpenBSD: Makefile,v 1.40 2013/08/11 08:57:57 ajacoutot Exp $

# sync with ONLY_FOR_ARCHS in devel/spidermonkey
ONLY_FOR_ARCHS-mozilla=	alpha amd64 i386 hppa mips64el mips64 powerpc sparc64
a5 1
COMMENT-mozilla=	pacrunner libproxy plugin for mozilla-based (gecko) browsers
a11 1
PKGNAME-mozilla=	libproxy-mozilla-${VERSION}
d15 1
a15 2
REVISION-mozilla=	2
REVISION-webkit=	2
d35 3
a37 4
# webkit = cyclic dependency: libproxy,-webkit -> webkit -> libsoup -> libproxy
# mozilla = devel/spidermonkey does not build on all arches
PSEUDO_FLAVORS=		no_mozilla no_webkit bootstrap
FLAVOR?=		no_mozilla no_webkit bootstrap
d39 1
a39 1
MULTI_PACKAGES=		-main -mozilla -webkit
a47 4
RUN_DEPENDS-mozilla=	# empty
LIB_DEPENDS-mozilla=	${BUILD_PKGPATH}>=${VERSION} \
			devel/spidermonkey>=17.0,<18.0

a56 2
WANTLIB-mozilla += ${cWANTLIB} mozjs-17.0 proxy

d70 1
a73 6
.if ${BUILD_PACKAGES:M-mozilla}
CONFIGURE_ARGS +=	-DWITH_MOZJS:BOOL=ON
.else
CONFIGURE_ARGS +=	-DWITH_MOZJS:BOOL=OFF
.endif

@


1.40
log
@Not needed after all.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2013/08/10 22:42:24 ajacoutot Exp $
d44 1
a44 1
FLAVOR?=		no_mozilla no_webkit
@


1.39
log
@Add bootstrap to the default FLAVORs -- prevent cyclic dep on sparc64.
spotted by and slap from landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2013/08/10 12:46:22 ajacoutot Exp $
d44 1
a44 1
FLAVOR?=		no_mozilla no_webkit bootstrap
@


1.38
log
@Add patches from Fedora to fix build with mozjs-17.0 (devel/spidermonkey).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2013/06/09 09:40:19 ajacoutot Exp $
d44 1
a44 1
FLAVOR?=		no_mozilla no_webkit
@


1.37
log
@move http://code.google.com, *.googlecode.com, and sites.google.com to https
suggested by bentley@@
@
text
@d19 3
a21 3
REVISION-main=		2
REVISION-mozilla=	1
REVISION-webkit=	1
d57 1
a57 1
			devel/spidermonkey
d63 1
a63 1
cWANTLIB += m pthread stdc++
d66 1
a66 1
WANTLIB-main += c gio-2.0 glib-2.0 gobject-2.0 perl
d68 1
a68 1
WANTLIB-mozilla += ${cWANTLIB} mozjs185 nspr4 plc4 plds4 proxy
@


1.36
log
@Make get_default_port() threadsafe: getservbyname is not reentrant, and
getservbyname_r is not always available.
This fixes several crashes mostly on webkit-based browsers.
libproxy issue #196, from David Hill
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2013/05/08 16:14:34 ajacoutot Exp $
d19 3
a21 3
REVISION-main=		1
REVISION-mozilla=	0
REVISION-webkit=	0
d27 1
a27 1
HOMEPAGE=		http://libproxy.googlecode.com/
@


1.35
log
@Bring a couple of fixes from upstream, including a mem leak.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2013/04/14 08:31:00 ajacoutot Exp $
d19 3
a21 1
REVISION-main=		0
d63 1
a63 1
cWANTLIB += m stdc++
d66 1
a66 1
WANTLIB-main += c gio-2.0 glib-2.0 gobject-2.0 perl pthread
@


1.34
log
@Update to libproxy-0.4.11.
Re-enable the mozilla FLAVOR now that we have mozjs185.
Add bootstrap to PSEUDO_FLAVOR to prevent the dep loop with WebKit.
Move from if PSEUDO_FLAVOR... to BUILD_PACKAGES.
Fix DESCR-*
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2013/03/11 11:35:48 espie Exp $
d18 2
@


1.33
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 4
a4 1
# $OpenBSD: Makefile,v 1.32 2013/02/09 14:49:52 sthen Exp $
d12 1
a12 1
VERSION=		0.4.10
d32 2
a33 2
			lang/python \
			devel/gettext
d37 4
a40 7
# do not enable webkit support by default because of cyclic dependency:
#     libproxy,-webkit -> webkit -> libsoup -> libproxy
# do not enable mozilla support by default, xulrunner doesn't build on all arches
PSEUDO_FLAVORS=		webkit
# XXX needs mozilla-js>=2.0b12; re-enable in net/Makefile when FLAVOR is back
#PSEUDO_FLAVORS +=	mozilla
FLAVOR?=
d42 1
a42 1
MULTI_PACKAGES=		-main
d53 1
a53 2
			devel/xulrunner/1.9 \
			devel/nspr
d64 1
a64 2
WANTLIB-mozilla += ${cWANTLIB} c modman nspr4 plc4 plds4 proxy
WANTLIB-mozilla += xulrunner1.9/mozjs
d67 1
a67 5
WANTLIB-webkit += GL X11 Xrender atk-1.0 cairo cairo-gobject expat fontconfig
WANTLIB-webkit += freetype gdk-3 gdk_pixbuf-2.0 gio-2.0 glib-2.0 gobject-2.0
WANTLIB-webkit += gtk-3 javascriptcoregtk-3.0 pango-1.0 pangocairo-1.0
WANTLIB-webkit += pangoft2-1.0 pixman-1 png proxy pthread-stubs soup-2.4
WANTLIB-webkit += webkitgtk-3.0 xcb xcb-render xcb-shm z
d81 2
a82 3
.if ${FLAVOR:Mmozilla}
BUILD_DEPENDS +=	devel/xulrunner/1.9,-devel>=1.9.1
MULTI_PACKAGES +=	-mozilla
d88 1
a88 2
.if ${FLAVOR:Mwebkit}
MULTI_PACKAGES +=	-webkit
@


1.32
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2012/11/27 12:16:07 sthen Exp $
a23 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.31
log
@update to libproxy 0.4.10, fixes http chunk-encoded pac files.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2012/10/14 20:01:38 sthen Exp $
d90 1
a90 1
.if ${FLAVOR:L:Mmozilla}
d98 1
a98 1
.if ${FLAVOR:L:Mwebkit}
@


1.30
log
@nigel@@ spotted that the webkit subpackage of libproxy didn't package
because I didn't sync PLIST-webkit (missed because it's only built as
a non-default pseudopackage); fix this by adding VERSION to SUBST_VARS
and syncing PLISTs, which also reduces the risk of problems in the future.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2012/10/12 13:01:15 sthen Exp $
d9 1
a9 2
VERSION=		0.4.9
REVISION=		0
@


1.29
log
@SECURITY update to libproxy 0.4.9; CVE-2012-4504, buffer overflow in PAC
processing.

While there, remove unnecessary patches (some fixed upstream, some workarounds
for header problems which have since been cleaned up, and change the "Build the
pacrunner into libproxy" patch into -DBIPR:BOOL=OFF in CONFIGURE_ARGS instead).

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2012/09/27 08:01:04 dcoppa Exp $
d10 1
d35 2
@


1.28
log
@Fix misuse of CMake

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2012/09/01 14:36:58 ajacoutot Exp $
d9 1
a9 1
VERSION=		0.4.7
a15 4
REVISION-main=		2
REVISION-mozilla=	1
REVISION-webkit=	1

d18 1
a18 1
SHARED_LIBS +=  proxy          1.0 # 0.0
d54 1
a54 1
		 	devel/xulrunner/1.9 \
d85 2
a86 1
			-DWITH_NM:BOOL=OFF
@


1.27
log
@register-plist did not catch the devel/glib2 -main -> empty change.
espie asked me in such a nice way to fix this that I'm bumping all ports
that have a direct dependency on glib2.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2012/08/25 13:12:59 ajacoutot Exp $
d16 1
a16 1
REVISION-main=		1
d82 1
a104 3

pre-configure:
	${SUBST_CMD} ${WRKSRC}/libproxy/cmake/libproxy.cmk
@


1.26
log
@Remove pthread patch and fix static linking.

from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/03/30 16:28:58 ajacoutot Exp $
d16 3
a18 1
REVISION-main=		0
@


1.25
log
@Unbreak the webkit FLAVOR (s/WITH_WEBKIT3/WITH_WEBKIT).

spotted by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/03/29 14:58:24 ajacoutot Exp $
d16 2
d78 2
a79 2
CONFIGURE_ARGS=		-DCMAKE_C_FLAGS="${CFLAGS} -pthread" \
			-DCMAKE_CXX_FLAGS="${CXXFLAGS} -pthread" \
@


1.25.2.1
log
@backport the CVE-2012-4504 security fix for libproxy (not carrying out
a full update as it included a library bump).

http://code.google.com/p/libproxy/source/detail?r=853
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/03/30 16:28:58 ajacoutot Exp $
a9 1
REVISION-main=		0
@


1.24
log
@Update to libproxy-0.4.7.
Moves from gconf to gsettings.
Comment the mozilla FLAVOR for now as it requires a newer xulrunner.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2011/12/05 10:38:42 sthen Exp $
d84 1
a84 2
			-DWITH_NM:BOOL=OFF \
			-DWITH_WEBKIT:BOOL=OFF
d98 1
a98 1
CONFIGURE_ARGS +=	-DWITH_WEBKIT3:BOOL=OFF
@


1.23
log
@Applications linking libproxy need -pthread; add it to the .pc file so
it's listed in "pkg-config --libs libproxy-1.0" output.  ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2011/10/29 08:12:32 ajacoutot Exp $
d9 1
a9 1
VERSION=		0.4.6
a15 4
REVISION-main=		7
REVISION-mozilla=	4
REVISION-webkit=	6

a17 1
SHARED_LIBS +=  modman         0.0 # 1.0
d38 3
a40 1
PSEUDO_FLAVORS=		mozilla webkit
d50 1
a50 1
			devel/gconf2
d59 1
a59 1
			www/webkit>=1.4.0v0
d64 1
a64 1
WANTLIB-main += c gconf-2 glib-2.0 gobject-2.0 gthread-2.0 perl pthread
d70 3
a72 5
WANTLIB-webkit += GL X11 Xau Xcomposite Xcursor Xdamage Xdmcp Xext Xfixes
WANTLIB-webkit += Xi Xinerama Xrandr Xrender Xxf86vm atk-1.0 cairo drm
WANTLIB-webkit += expat fontconfig freetype gdk-x11-2.0 gdk_pixbuf-2.0
WANTLIB-webkit += gio-2.0 glib-2.0 gmodule-2.0 gobject-2.0 gthread-2.0
WANTLIB-webkit += gtk-x11-2.0 modman pango-1.0 pangocairo-1.0
d74 1
a74 1
WANTLIB-webkit += webkitgtk-1.0 xcb xcb-render xcb-shm xml2 z
d80 1
a80 1
			-DWITH_GNOME:BOOL=ON \
d84 2
a85 1
			-DWITH_NM:BOOL=OFF
d97 1
a97 1
CONFIGURE_ARGS +=	-DWITH_WEBKIT:BOOL=ON
d99 1
a99 1
CONFIGURE_ARGS +=	-DWITH_WEBKIT:BOOL=OFF
d103 1
a103 2
	${SUBST_CMD} ${WRKSRC}/libproxy/cmake/libproxy.cmk  \
		${WRKSRC}/libmodman/CMakeLists.txt
@


1.22
log
@Sync dependencies after gconf2 lost its dependency to ORBit.
This should cover all fallout but there may be some dark corners which I
missed...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2011/09/18 19:57:30 ajacoutot Exp $
d16 1
a16 1
REVISION-main=		6
@


1.21
log
@Better DESCR.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2011/09/16 11:13:38 espie Exp $
d16 1
a16 1
REVISION-main=		5
d66 2
a67 3
WANTLIB-main += ${cWANTLIB} ${MODGETTEXT_WANTLIB} c perl pthread
WANTLIB-main += c perl pthread gobject-2.0 gthread-2.0 pthread
WANTLIB-main += ORBit-2 c gconf-2 gio-2.0 glib-2.0 gmodule-2.0
@


1.20
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2011/06/08 18:00:49 jasper Exp $
d17 2
a18 2
REVISION-mozilla=	3
REVISION-webkit=	5
@


1.19
log
@bump after default python version switch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2011/05/30 13:02:26 ajacoutot Exp $
d16 3
a18 3
REVISION-main=		4
REVISION-mozilla=	2
REVISION-webkit=	4
@


1.18
log
@Typo, we're talking about a subpackage here, not a FLAVOR;
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/05/17 06:29:25 ajacoutot Exp $
d16 3
a18 3
REVISION-main=		3
REVISION-mozilla=	1
REVISION-webkit=	3
@


1.17
log
@Add ${MODGETTEXT_RUN_DEPENDS}.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/05/16 08:24:31 ajacoutot Exp $
d16 1
a16 1
REVISION-main=		2
@


1.16
log
@Add the EPOCH to the webkit dependency.

spotted by landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/05/15 09:34:06 ajacoutot Exp $
d16 1
a16 1
REVISION-main=		1
d50 2
a51 1
RUN_DEPENDS-main=	${MODPY_RUN_DEPENDS}
@


1.15
log
@Merge -gnome into -main.

landry@@ is ok with the idea
ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/05/11 06:02:15 ajacoutot Exp $
d18 1
a18 1
REVISION-webkit=	2
d61 1
a61 1
			www/webkit>=1.4.0
@


1.14
log
@Fix after recent webkit update.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/05/10 16:23:03 ajacoutot Exp $
d6 2
a7 3
COMMENT-gnome=		plugin for GNOME
COMMENT-mozilla=	plugin for mozilla-based (gecko) browsers
COMMENT-webkit=		plugin for webkit-based browsers
a12 1
PKGNAME-gnome=		libproxy-gnome-${VERSION}
d16 3
a18 4
REVISION-main=		0
REVISION-gnome=		0
REVISION-mozilla=	0
REVISION-webkit=	1
d46 1
a46 1
MULTI_PACKAGES=		-main -gnome
d51 1
a51 3

RUN_DEPENDS-gnome=	${MODGETTEXT_RUN_DEPENDS}
LIB_DEPENDS-gnome=	${BUILD_PKGPATH}>=${VERSION} \
d65 3
a67 5
WANTLIB-main += ${cWANTLIB} c perl pthread

WANTLIB-gnome += ${cWANTLIB} ${MODGETTEXT_WANTLIB}
WANTLIB-gnome += ORBit-2 c gconf-2 gio-2.0 glib-2.0 gmodule-2.0
WANTLIB-gnome += gobject-2.0 gthread-2.0 modman proxy pthread
@


1.13
log
@xulrunner build depends is only needed for the mozilla flavor... obviously.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/05/10 16:17:47 ajacoutot Exp $
d21 1
a21 1
REVISION-webkit=	0
d66 1
a66 1
			www/webkit
d86 1
a86 1
WANTLIB-webkit += webkit-1.0 xcb xcb-render xcb-shm xml2 z
@


1.12
log
@Add mozilla to the PSEUDO_FLAVOR list and don't build it by default:
xulrunner does not build on all arches.
Prodded by landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/04/26 08:06:41 ajacoutot Exp $
d51 1
a51 2
BUILD_DEPENDS=		devel/xulrunner/1.9,-devel>=1.9.1 \
			lang/vala
d99 1
@


1.11
log
@cmake likes to link with -lpthread instead of -pthread, so prevent that.
Fix dependencies of all subpackages.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/03/24 06:50:09 ajacoutot Exp $
d44 3
a46 2
# libproxy,-webkit -> webkit -> libsoup -> libproxy
PSEUDO_FLAVORS=		webkit
d49 1
a49 1
MULTI_PACKAGES=		-main -gnome -mozilla
a93 1
			-DWITH_MOZJS:BOOL=ON \
d98 7
@


1.10
log
@Major update to libproxy-0.4.6.
Several patches from the FreeBSD port.

Create -mozilla and -webkit subpackages. Do NOT build -webkit by default
because of a cyclic dependency:
libproxy,-webkit -> webkit -> libsoup -> libproxy

tested in a bulk by landry@@
ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/11/19 22:31:34 espie Exp $
d18 5
d40 2
a41 1
			lang/python
d68 1
a68 1
cWANTLIB += m pthread stdc++
d70 1
a70 1
WANTLIB-main += ${cWANTLIB} c perl
d74 1
a74 1
WANTLIB-gnome += gobject-2.0 gthread-2.0 modman proxy
d77 1
d83 1
a83 1
WANTLIB-webkit += gio-2.0 glib-2.0 gmodule-2.0 gnutls gobject-2.0 gthread-2.0
d86 1
a86 1
WANTLIB-webkit += tasn1 webkit-1.0 xcb xcb-render xcb-shm xml2 z
@


1.9
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/11/11 16:27:54 espie Exp $
d3 1
a3 1
SHARED_ONLY=	Yes
d5 4
a8 2
COMMENT-main=	library handling all the details of proxy configuration
COMMENT-gnome=	plugin for GNOME
d10 2
a11 8
VERSION=	0.2.3
DISTNAME=	libproxy-${VERSION}
PKGNAME-main=	libproxy-${VERSION}
PKGNAME-gnome=	libproxy-gnome-${VERSION}
REVISION-main=	2
REVISION-gnome=	1
SHARED_LIBS +=  proxy          0.0               # .0.0
CATEGORIES=	net
d13 11
a23 1
HOMEPAGE=	http://libproxy.googlecode.com/
d33 3
a35 1
MODULES=		lang/python
d37 4
a40 3
USE_LIBTOOL=		Yes
LIBTOOL_FLAGS=		--tag=disable-static
USE_GMAKE=		Yes
d42 1
a42 1
MULTI_PACKAGES=		-main -gnome
d44 2
a45 2
LIB_DEPENDS-gnome=	${BUILD_PKGPATH},-main \
			devel/gconf2
d47 1
a47 2
WANTLIB-main=		ICE SM X11 Xau Xdmcp Xext Xmu Xt c m pthread \
			pthread-stubs xcb
d49 3
a51 9
WANTLIB-gnome =		ICE ORBit-2 SM X11 Xau Xdmcp Xext Xmu Xt dbus-1 \
			dbus-glib-1 glib-2.0 gmodule-2.0 gobject-2.0 \
			gthread-2.0 iconv intl m pcre pthread-stubs xcb \
			proxy gconf-2

CONFIGURE_STYLE=	gnu
CONFIGURE_ARGS+=	${CONFIGURE_SHARED} \
			--without-mozjs \
			--without-webkit
d53 49
a101 2
CONFIGURE_ENV=		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib -pthread"
@


1.8
log
@new WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/08/30 21:14:35 sthen Exp $
d35 2
a36 2
LIB_DEPENDS-gnome=	::${BUILD_PKGPATH},-main \
			::devel/gconf2
@


1.7
log
@bumps for python
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/07/12 22:07:39 sthen Exp $
d35 2
a36 2
LIB_DEPENDS-gnome=	proxy::${BUILD_PKGPATH},-main \
			gconf-2::devel/gconf2
d41 4
a44 3
WANTLIB-gnome =		ICE ORBit-2 SM X11 Xau Xdmcp Xext Xmu Xt dbus-1 dbus-glib-1 \
			glib-2.0 gmodule-2.0 gobject-2.0 gthread-2.0 iconv \
			intl m pcre pthread-stubs xcb
@


1.6
log
@use REVISION, checked with before/after make show=PKGNAMES (plus some
extra-careful checking where there are complicated PSEUDO_FLAVORS).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2009/08/10 06:33:43 kili Exp $
d12 2
a13 2
REVISION-main=	1
REVISION-gnome=	0
@


1.5
log
@WANTLIB changes after xcb addition and bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2009/04/26 11:01:04 ajacoutot Exp $
d10 4
a13 2
PKGNAME-main=	libproxy-${VERSION}p1
PKGNAME-gnome=	libproxy-gnome-${VERSION}p0
@


1.4
log
@CONFIGURE_ENV += PYTHON="${MODPY_BIN}" is inherited from the python module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2009/04/23 13:26:10 ajacoutot Exp $
d10 2
a11 2
PKGNAME-main=	libproxy-${VERSION}p0
PKGNAME-gnome=	libproxy-gnome-${VERSION}
d36 2
a37 1
WANTLIB-main=		ICE SM X11 Xau Xdmcp Xext Xmu Xt c m pthread
d41 1
a41 1
			intl m pcre
@


1.3
log
@- don't trust configure to pick up the python version to use ; this allows
libproxy to compile when several python versions are installed
- safe bump

breakage reported by Julien Cabillot
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2009/04/05 15:47:53 bernd Exp $
d48 1
a48 2
			LDFLAGS="-L${LOCALBASE}/lib -pthread" \
			PYTHON="${MODPY_BIN}"
@


1.2
log
@Unbreak package names. (missing PKGNAME-main and PKGNAME-gnome)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2009/04/04 10:07:31 landry Exp $
d10 1
a10 1
PKGNAME-main=	libproxy-${VERSION}
d48 2
a49 2
			LDFLAGS="-L${LOCALBASE}/lib -pthread"
			
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d8 4
a11 1
DISTNAME=	libproxy-0.2.3
@


1.1.1.1
log
@Import libproxy 0.2.3, a library that provides automatic proxy
configuration management. Currently provides GNOME and KDE plugins,
gecko and webkit plugins may be enabled at some point.
Joint work with and ok jasper@@
@
text
@@
