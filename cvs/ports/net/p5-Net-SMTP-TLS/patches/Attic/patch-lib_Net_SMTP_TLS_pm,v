head	1.3;
access;
symbols
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.2;
locks; strict;
comment	@# @;


1.3
date	2012.07.03.12.56.46;	author sthen;	state dead;
branches;
next	1.2;

1.2
date	2012.06.30.21.27.53;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2011.12.14.14.58.57;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.3
log
@remove 5-year-old unmaintained module in favour of a fork whose
maintainer responds within hours ;)  ok jasper@@
@
text
@$OpenBSD: patch-lib_Net_SMTP_TLS_pm,v 1.2 2012/06/30 21:27:53 sthen Exp $

Add fixes from Net::SMTP::TLS::ButMaintained 0.18 and 0.19

--- lib/Net/SMTP/TLS.pm.orig	Tue Jan 17 14:36:34 2006
+++ lib/Net/SMTP/TLS.pm	Sat Jun 30 19:45:08 2012
@@@@ -115,10 +115,14 @@@@ sub new {
 	
 	my $me	= bless \%args, $pkg;
 	# read the line immediately after connecting
-	my ($rsp,$txt) = $me->_response();
+	my ( $rsp, $txt, $more ) = $me->_response();
 	if(not $rsp == 220){
 		croak "Could not connect to SMTP server: $host $txt\n";
 	}
+
+	# empty the socket of any continuation lines
+	while ( $more eq '-' ) { ( $rsp, $txt, $more ) = $me->_response(); }
+
 	$me->hello(); # the first hello, 2nd after starttls
 	$me->starttls() if not $args{NoTLS}; # why we're here, after all
 	$me->login() if($me->{User} and $me->{Password});
@@@@ -179,7 +183,7 @@@@ sub starttls {
 		croak "Invalid response for STARTTLS: $num $txt\n";
 	}
 	if(not IO::Socket::SSL::socket_to_SSL($me->{sock},
-		SSL_version	=>	"SSLv3 TLSv1")){
+		SSL_version	=>	"TLSv1")){
 			croak "Couldn't start TLS: ".IO::Socket::SSL::errstr."\n";
 	}
 	$me->hello();
@@@@ -251,7 +255,7 @@@@ sub auth_PLAIN{
 	my $me	= shift;
 	my $user= $me->{User};
 	my $pass= $me->{Password};
-	$me->_command(sprintf("AUTH PLAIN %S",
+	$me->_command(sprintf("AUTH PLAIN %s",
 		encode_base64("$user\0$user\0$pass","")));
 	my ($num,$txt) = $me->_response();
 	if(not $num == 235){
@@@@ -367,6 +371,7 @@@@ sub datasend {
 				return undef;
 			}
 			$len -= $w;
+			$offset += $w;
 		}
 		else
 		{
@


1.2
log
@more fixes from Net::SMTP::TLS::ButMaintained (via Mikolaj Kucharski, thanks).
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_Net_SMTP_TLS_pm,v 1.1 2011/12/14 14:58:57 sthen Exp $
@


1.1
log
@add some fixes to Net::SMTP::TLS taken from Net::SMTP::TLS::ButMaintained
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
Add fixes from Net::SMTP::TLS::ButMaintained 0.18
d6 1
a6 1
+++ lib/Net/SMTP/TLS.pm	Wed Dec 14 14:57:11 2011
d23 9
@

