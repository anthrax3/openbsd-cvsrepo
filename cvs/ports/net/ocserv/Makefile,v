head	1.22;
access;
symbols
	OPENBSD_6_0:1.18.0.2
	OPENBSD_6_0_BASE:1.18
	OPENBSD_5_9:1.12.0.2
	OPENBSD_5_9_BASE:1.12
	OPENBSD_5_8:1.6.0.4
	OPENBSD_5_8_BASE:1.6
	sthen_20150326:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.22
date	2017.02.14.23.02.19;	author sthen;	state Exp;
branches;
next	1.21;
commitid	zCLpqtwUmWhVxU57;

1.21
date	2016.11.19.15.35.09;	author sthen;	state Exp;
branches;
next	1.20;
commitid	51mJySZaaYyF1cEr;

1.20
date	2016.09.23.09.00.11;	author sthen;	state Exp;
branches;
next	1.19;
commitid	InnfcaJ6qQjVYnus;

1.19
date	2016.08.12.13.39.30;	author sthen;	state Exp;
branches;
next	1.18;
commitid	DwdxEl2fl8R0iy8P;

1.18
date	2016.06.16.09.21.59;	author sthen;	state Exp;
branches;
next	1.17;
commitid	xdPRoqoUWF1uNPBG;

1.17
date	2016.06.01.21.27.20;	author sthen;	state Exp;
branches;
next	1.16;
commitid	uBpZNBLh41wCwgRB;

1.16
date	2016.04.26.12.11.08;	author sthen;	state Exp;
branches;
next	1.15;
commitid	kl8JjVD3B0TgmGHz;

1.15
date	2016.03.19.20.24.32;	author sthen;	state Exp;
branches;
next	1.14;
commitid	sxvyaSAQ1dErooSK;

1.14
date	2016.03.19.20.03.46;	author sthen;	state Exp;
branches;
next	1.13;
commitid	XcOsRdTLzmOZM0Hl;

1.13
date	2016.02.25.10.22.01;	author sthen;	state Exp;
branches;
next	1.12;
commitid	Pzcmcus5Kw97rYNw;

1.12
date	2016.01.09.16.01.42;	author sthen;	state Exp;
branches;
next	1.11;
commitid	diOndbEE4jakzpYw;

1.11
date	2015.11.30.11.58.57;	author sthen;	state Exp;
branches;
next	1.10;
commitid	3QuISeJ6hOB2VxlS;

1.10
date	2015.11.23.15.10.57;	author sthen;	state Exp;
branches;
next	1.9;
commitid	RnjbJ8TPbdFfpffH;

1.9
date	2015.10.09.14.47.40;	author sthen;	state Exp;
branches;
next	1.8;
commitid	48Ub0LGBiX0TyyK9;

1.8
date	2015.09.04.21.05.55;	author sthen;	state Exp;
branches;
next	1.7;
commitid	VJPwTS9MDHVsEQUf;

1.7
date	2015.08.14.11.20.07;	author sthen;	state Exp;
branches;
next	1.6;
commitid	WHdIEwtpFDhOWWSi;

1.6
date	2015.07.03.10.16.31;	author sthen;	state Exp;
branches;
next	1.5;
commitid	Hgv1kh47UaGQAkhh;

1.5
date	2015.07.02.20.50.21;	author sthen;	state Exp;
branches;
next	1.4;
commitid	SnrRKdNvVNv5If2c;

1.4
date	2015.05.25.21.06.25;	author sthen;	state Exp;
branches;
next	1.3;
commitid	zMquqEHpSOvzrknT;

1.3
date	2015.05.25.20.57.11;	author sthen;	state Exp;
branches;
next	1.2;
commitid	vMYRvuaLowr2nLlN;

1.2
date	2015.03.29.20.02.41;	author sthen;	state Exp;
branches;
next	1.1;
commitid	RhSdL55jdlIWIegZ;

1.1
date	2015.03.26.02.07.59;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;
commitid	0Ou9W6hND0FZCvke;

1.1.1.1
date	2015.03.26.02.07.59;	author sthen;	state Exp;
branches;
next	;
commitid	0Ou9W6hND0FZCvke;


desc
@@


1.22
log
@update to ocserv-0.11.7, from Björn Ketelaars
@
text
@# $OpenBSD: Makefile,v 1.21 2016/11/19 15:35:09 sthen Exp $

COMMENT=	server implementing the AnyConnect SSL VPN protocol

DISTNAME=	ocserv-0.11.7
EXTRACT_SUFX=	.tar.xz

CATEGORIES=	net

HOMEPAGE=	http://www.infradead.org/ocserv/

MAINTAINER=	Stuart Henderson <sthen@@openbsd.org>

# GPLv2+
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += c ev gnutls intl lz4 m ncurses nettle oath pam
WANTLIB += protobuf-c radcli readline talloc

MASTER_SITES=	ftp://ftp.infradead.org/pub/ocserv/

LIB_DEPENDS=	archivers/lz4 \
		devel/gettext \
		devel/libev \
		devel/libtalloc \
		devel/protobuf-c \
		net/radcli>=1.2.5 \
		security/gnutls \
		security/oath-toolkit \
		security/openpam
TEST_DEPENDS=	net/openconnect \
		shells/bash \
		sysutils/coreutils

CONFIGURE_STYLE= autoconf
AUTOCONF_VERSION= 2.69
USE_GMAKE=	Yes
USE_GROFF=	Yes # missing flags
# .NOP \f\*[B-Font]\-s\f[] \f\*[I-Font]file\f[], \f\*[B-Font]\-\-socket\-file\f[]=\f\*[I-Font]file\f[]
# There's also "ERROR: skipping unknown macro: .an-trap" but this is probably unimportant
CONFIGURE_ARGS=	--enable-local-libopts \
		--without-http-parser \
		--without-pcl-lib

CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include" \
		LDFLAGS="-L${LOCALBASE}/lib"

post-extract:
	sed -i 's,#!/bin/bash,#!${LOCALBASE}/bin/bash,' \
	    ${WRKSRC}/tests/test-{iroute,append-routes,user-config}
	sed -i 's,/usr/sbin/openconnect,${LOCALBASE}/sbin/openconnect,' \
	    ${WRKSRC}/tests/common.sh
	sed -i 's,/etc/ocserv,${SYSCONFDIR}/ocserv,' \
	    ${WRKSRC}/src/ocpasswd/ocpasswd.c
	cd ${WRKSRC}; \
	    sed -i 's,/usr/bin/ocserv-fw,${SYSCONFDIR}/ocserv/ocserv-fw,g' \
	    src/ocserv-args.def src/main-user.c doc/ocserv.8 doc/sample.config

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/ocserv
	cd ${WRKSRC}/doc; ${INSTALL_DATA} profile.xml sample.passwd \
	    ${PREFIX}/share/examples/ocserv/
	mv ${PREFIX}/bin/ocserv-fw ${PREFIX}/share/examples/ocserv/
	${SUBST_CMD} -c -m ${SHAREMODE} -o ${SHAREOWN} -g ${SHAREGRP} \
	    ${WRKSRC}/doc/sample.config \
	    ${PREFIX}/share/examples/ocserv/sample.config

pre-test:
	ln -fs ${LOCALBASE}/bin/gtimeout ${WRKDIR}/bin/timeout

post-test:
	@@[ `id -u` == 0 ] || printf \
	 "\n*** NOTE: ocserv has loopback tests which require root ***\n\n"

.include <bsd.port.mk>
@


1.21
log
@update to ocserv-0.11.6 plus patch for autogen problem in the release
from Björn Ketelaars (I added a comment to recheck autogen because it changed
again since that patch)
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.20 2016/09/23 09:00:11 sthen Exp $

# XXX for 0.11.7 update, check both with+without autogen
d5 1
a5 1
DISTNAME=	ocserv-0.11.6
@


1.20
log
@update to ocserv-0.11.5
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.19 2016/08/12 13:39:30 sthen Exp $
d7 1
a7 1
DISTNAME=	ocserv-0.11.5
@


1.19
log
@update to ocserv-0.11.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2016/06/16 09:21:59 sthen Exp $
d5 1
a5 1
DISTNAME=	ocserv-0.11.4
@


1.18
log
@update to ocserv-0.11.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2016/06/01 21:27:20 sthen Exp $
d5 1
a5 1
DISTNAME=	ocserv-0.11.3
@


1.17
log
@Add a patch from Andrew Karpow (committed to ocserv upstream) setting
IFF_MULTICAST, fixing ipv6 tunnel support on OpenBSD.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2016/04/26 12:11:08 sthen Exp $
d5 1
a5 2
DISTNAME=	ocserv-0.11.2
REVISION=	0
@


1.16
log
@update to ocserv-0.11.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2016/03/19 20:24:32 sthen Exp $
d6 1
@


1.15
log
@merge in a simplified version of Bjorn Ketelaars tests diffs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2016/03/19 20:03:46 sthen Exp $
d5 1
a5 1
DISTNAME=	ocserv-0.11.1
d17 2
a18 2
WANTLIB += c ev gnutls lz4 m ncurses nettle oath pam protobuf-c
WANTLIB += pthread radcli readline talloc
a21 1
MODULES=	devel/gettext
d23 1
@


1.14
log
@update to ocserv-0.11.1, mostly similar to part of a diff from Bjorn Ketelaars
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2016/02/25 10:22:01 sthen Exp $
d31 3
a47 2
# most tests are known to fail on OpenBSD anyway, but let's patch the
# obvious issues.
d49 3
a51 3
	sed -i 's,/usr/local/bin/bash,${LOCALBASE}/bin/bash,' \
	    ${WRKSRC}/tests/test-iroute
	sed -i 's,/usr/local/sbin/openconnect,${LOCALBASE}/sbin/openconnect,' \
d53 2
a54 1
	sed -i 's,/etc/ocserv,${SYSCONFDIR}/ocserv,' ${WRKSRC}/src/ocpasswd/ocpasswd.c
d67 7
@


1.13
log
@update to ocserv-0.10.12
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2016/01/09 16:01:42 sthen Exp $
d5 1
a5 1
DISTNAME=	ocserv-0.10.12
d17 2
a18 2
WANTLIB += c gnutls lz4 ncurses oath pam protobuf-c pthread
WANTLIB += radcli readline talloc
d24 2
d27 1
a27 2
		devel/libtalloc \
		net/radcli \
d52 1
a52 1
	sed -i 's,/etc/ocserv,${SYSCONFDIR}/ocserv,' ${WRKSRC}/src/ocpasswd.c
@


1.12
log
@update to ocserv-0.10.11, similar diff from Björn Ketelaars
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2015/11/30 11:58:57 sthen Exp $
d5 1
a5 1
DISTNAME=	ocserv-0.10.11
@


1.11
log
@update to ocserv-0.10.10
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2015/11/23 15:10:57 sthen Exp $
d5 1
a5 1
DISTNAME=	ocserv-0.10.10
@


1.10
log
@enable radius support in ocserv
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2015/10/09 14:47:40 sthen Exp $
d5 1
a5 2
DISTNAME=	ocserv-0.10.9
REVISION=	0
d47 8
a54 3
	perl -pi -e s,/etc/ocserv,${SYSCONFDIR}/ocserv, ${WRKSRC}/src/ocpasswd.c
	perl -pi -e s,/usr/local/bin/bash,${LOCALBASE}/bin/bash, ${WRKSRC}/tests/test-iroute
	perl -pi -e s,/usr/local/sbin/openconnect,${LOCALBASE}/sbin/openconnect, ${WRKSRC}/tests/common.sh
d60 1
@


1.9
log
@update to ocserv-0.10.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2015/09/04 21:05:55 sthen Exp $
d6 1
d18 2
a19 1
WANTLIB += c gnutls lz4 ncurses oath pam protobuf-c pthread readline talloc
d27 1
a33 1
#SEPARATE_BUILD= Yes # nearly; problem with ocserv-args.c
d40 1
a40 2
		--without-pcl-lib \
		--without-radius
@


1.8
log
@update to ocserv-0.10.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2015/08/14 11:20:07 sthen Exp $
d5 1
a5 1
DISTNAME=	ocserv-0.10.8
d17 1
a17 1
WANTLIB += c gnutls lz4 ncurses pam protobuf-c pthread readline talloc
d26 1
@


1.7
log
@update to ocserv-0.10.7, Björn Ketelaars had the same diff
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2015/07/03 10:16:31 sthen Exp $
d5 1
a5 1
DISTNAME=	ocserv-0.10.7
@


1.6
log
@Update ocserv's DESCR, mostly borrowed from the website - better information
about the isolated security process and per-user unprivileged worker processes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2015/07/02 20:50:21 sthen Exp $
d5 1
a5 2
DISTNAME=	ocserv-0.10.6
REVISION=	0
@


1.5
log
@update to ocserv 0.10.6, from Bjorn Ketelaars
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2015/05/25 21:06:25 sthen Exp $
d6 1
@


1.4
log
@additional fix to ocserv (forgot to re-run 'make update-patches' after fixing).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2015/05/25 20:57:11 sthen Exp $
d5 1
a5 2
DISTNAME=	ocserv-0.10.5
REVISION=	0
@


1.3
log
@update to ocserv-0.10.5, mostly from Björn Ketelaars with additional
patches (pcl.c, occtl-time.c) from me.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2015/03/29 20:02:41 sthen Exp $
d6 1
@


1.2
log
@update to ocserv 0.10.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2015/03/26 02:07:59 sthen Exp $
d5 1
a5 1
DISTNAME=	ocserv-0.10.2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d5 1
a5 1
DISTNAME=	ocserv-0.9.2
@


1.1.1.1
log
@import ports/net/ocserv, ok/feedback jasper@@

OpenConnect VPN server (or ocserv) implements the AnyConnect SSL VPN
protocol and is compatible with the OpenConnect VPN client. Its purpose
is to be a small, secure and configurable VPN server that depends on
standard protocols like TLS 1.2, and Datagram TLS. The AnyConnect
SSL VPN protocol was the closest protocol to match this requirement.

The VPN users can be authenticated using password, certificate
authentication or both methods. Authenticated users are assigned their
own unprivileged worker process and obtain a networking (tun) device
and IP from a configurable pool of addresses.
@
text
@@
