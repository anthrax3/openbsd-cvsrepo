head	1.3;
access;
symbols
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.4
	OPENBSD_5_8_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2016.03.19.20.03.46;	author sthen;	state dead;
branches;
next	1.2;
commitid	XcOsRdTLzmOZM0Hl;

1.2
date	2015.07.02.20.50.21;	author sthen;	state Exp;
branches;
next	1.1;
commitid	SnrRKdNvVNv5If2c;

1.1
date	2015.05.25.20.57.11;	author sthen;	state Exp;
branches;
next	;
commitid	vMYRvuaLowr2nLlN;


desc
@@


1.3
log
@update to ocserv-0.11.1, mostly similar to part of a diff from Bjorn Ketelaars
@
text
@$OpenBSD: patch-src_occtl-time_c,v 1.2 2015/07/02 20:50:21 sthen Exp $

time_t is 64 bits on all OpenBSD (and NetBSD) arch; cast time values
to a specific-width type to avoid problems on 32-bit arch

--- src/occtl-time.c.orig	Tue May 26 18:33:38 2015
+++ src/occtl-time.c	Thu Jul  2 06:26:11 2015
@@@@ -36,7 +36,7 @@@@ void print_time_ival7(char output[MAX_TMPSTR_SIZE], ti
 {
 	time_t t = t1 - t2;
 
-	if ((long)t < (long)0) {
+	if ((long long)t < (long long)0) {
 		/* system clock changed? */
 		snprintf(output, MAX_TMPSTR_SIZE, "   ?   ");
 		return;
@@@@ -44,17 +44,17 @@@@ void print_time_ival7(char output[MAX_TMPSTR_SIZE], ti
 	
 	if (t >= 48 * 60 * 60)
 		/* 2 days or more */
-		snprintf(output, MAX_TMPSTR_SIZE, _("%2ludays"), (long)t / (24 * 60 * 60));
+		snprintf(output, MAX_TMPSTR_SIZE, _("%2lludays"), (long long)t / (24 * 60 * 60));
 	else if (t >= 60 * 60)
 		/* 1 hour or more */
 	        /* Translation Hint: Hours:Minutes */
-		snprintf(output, MAX_TMPSTR_SIZE, _("%2luh:%02um"), (long)t / (60 * 60),
+		snprintf(output, MAX_TMPSTR_SIZE, _("%2lluh:%02um"), (long long)t / (60 * 60),
 			(unsigned)((t / 60) % 60));
 	else if (t > 60)
 		/* 1 minute or more */
 	        /* Translation Hint: Minutes:Seconds */
-		snprintf(output, MAX_TMPSTR_SIZE, "%2lum:%02us", (long)t / 60, (unsigned)t % 60);
+		snprintf(output, MAX_TMPSTR_SIZE, "%2llum:%02us", (long long)t / 60, (unsigned)t % 60);
 	else
 	        /* Translation Hint: Seconds:Centiseconds */
-		snprintf(output, MAX_TMPSTR_SIZE, _("%5lus"), (long)t);
+		snprintf(output, MAX_TMPSTR_SIZE, _("%5llus"), (long long)t);
 }
@


1.2
log
@update to ocserv 0.10.6, from Bjorn Ketelaars
@
text
@d1 1
a1 1
$OpenBSD: patch-src_occtl-time_c,v 1.1 2015/05/25 20:57:11 sthen Exp $
@


1.1
log
@update to ocserv-0.10.5, mostly from Bj√∂rn Ketelaars with additional
patches (pcl.c, occtl-time.c) from me.
@
text
@d1 1
a1 1
$OpenBSD$
d6 12
a17 3
--- src/occtl-time.c.orig	Mon May 25 21:50:10 2015
+++ src/occtl-time.c	Mon May 25 21:51:00 2015
@@@@ -43,17 +43,17 @@@@ void print_time_ival7(time_t t1, time_t t2, FILE * fou
d21 2
a22 2
-		fprintf(fout, _("%2ludays"), t / (24 * 60 * 60));
+		fprintf(fout, _("%2lludays"), (long long)t / (24 * 60 * 60));
d26 2
a27 2
-		fprintf(fout, _("%2luh:%02um"), t / (60 * 60),
+		fprintf(fout, _("%2lluh:%02um"), (long long)t / (60 * 60),
d32 2
a33 2
-		fprintf(fout, "%2lum:%02us", t / 60, (unsigned)t % 60);
+		fprintf(fout, "%2llum:%02us", (long long)t / 60, (unsigned)t % 60);
d36 2
a37 2
-		fprintf(fout, _("%5lus"), t);
+		fprintf(fout, _("%5llus"), (long long)t);
@

