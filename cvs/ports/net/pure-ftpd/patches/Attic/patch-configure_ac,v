head	1.6;
access;
symbols
	OPENBSD_5_8:1.5.0.10
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.6
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.4
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.2
	OPENBSD_5_5_BASE:1.5;
locks; strict;
comment	@# @;


1.6
date	2015.10.14.10.01.55;	author sthen;	state dead;
branches;
next	1.5;
commitid	yAWs6xQUKKNMrFKk;

1.5
date	2013.10.25.23.45.55;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2013.08.15.09.47.28;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2003.11.05.00.13.17;	author brad;	state dead;
branches;
next	1.2;

1.2
date	2003.10.30.21.08.25;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.25.22.50.24;	author brad;	state Exp;
branches;
next	;


desc
@@


1.6
log
@update to pure-ftpd 1.0.42, from Brad
@
text
@$OpenBSD: patch-configure_ac,v 1.5 2013/10/25 23:45:55 sthen Exp $

We do PIE by default on arch where it works; don't force it to avoid
problems on arch where it's broken e.g. arm.

From 6e9ec67ae461938caa2c641f7ca617298d5cca08 Mon Sep 17 00:00:00 2001
From: Frank Denis <github@@pureftpd.org>
Date: Tue, 22 Oct 2013 13:10:31 -0700
Subject: [PATCH] Check for arc4random_stir and arc4random_addrandom presence

--- configure.ac.orig	Fri Mar 16 05:28:21 2012
+++ configure.ac	Wed Oct 23 14:39:09 2013
@@@@ -21,12 +21,6 @@@@ AM_PROG_CC_C_O
 AC_USE_SYSTEM_EXTENSIONS
 AC_SEARCH_LIBS([strerror],[cposix])
 
-AX_CHECK_COMPILE_FLAG([-fPIE], [
-  AX_CHECK_LINK_FLAG([-fPIE],
-    [CFLAGS="$CFLAGS -fPIE"]
-  )
-])
-
 AX_CHECK_COMPILE_FLAG([-fcatch-undefined-c99-behavior], [CFLAGS="$CFLAGS -fcatch-undefined-c99-behavior"])
 AX_CHECK_COMPILE_FLAG([-fno-strict-aliasing], [CFLAGS="$CFLAGS -fno-strict-aliasing"])
 AX_CHECK_COMPILE_FLAG([-fno-strict-overflow], [CFLAGS="$CFLAGS -fno-strict-overflow"])
@@@@ -80,7 +74,6 @@@@ AX_CHECK_COMPILE_FLAG([-Wstrict-prototypes], [CWFLAGS=
 AX_CHECK_COMPILE_FLAG([-Wswitch-enum], [CWFLAGS="$CWFLAGS -Wswitch-enum"])
 AX_CHECK_COMPILE_FLAG([-Wvariable-decl], [CWFLAGS="$CWFLAGS -Wvariable-decl"])
 
-AX_CHECK_LINK_FLAG([-pie], [LDFLAGS="$LDFLAGS -pie"])
 AX_CHECK_LINK_FLAG([-z relro], [LDFLAGS="$LDFLAGS -z relro"])
 AX_CHECK_LINK_FLAG([-z now], [LDFLAGS="$LDFLAGS -z now"])
 
@@@@ -961,7 +954,7 @@@@ AC_CHECK_FUNCS(getaddrinfo getnameinfo inet_ntop inet_
 AC_CHECK_FUNCS(setusershell setgroups snprintf vsnprintf vfprintf gethostname)
 AC_CHECK_FUNCS(setlocale timegm)
 AC_CHECK_FUNCS(tzset utime utimes mknod mkfifo)
-AC_CHECK_FUNCS(random srandomdev arc4random)
+AC_CHECK_FUNCS(random srandomdev arc4random arc4random_stir arc4random_addrandom)
 AC_CHECK_FUNCS(closefrom)
 
 AC_MSG_CHECKING([whether statvfs64() is defined])
@


1.5
log
@switch to upstream's patch for arc4random changes; ok brad@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.4 2013/08/15 09:47:28 sthen Exp $
@


1.4
log
@don't force PIE; fixes arm (and it's enabled by default on arches where
it works). ok brad@@
@
text
@d1 1
a1 1
$OpenBSD$
d6 7
a12 2
--- configure.ac.orig	Thu Aug 15 11:00:58 2013
+++ configure.ac	Thu Aug 15 11:01:09 2013
d34 9
@


1.3
log
@upgrade to pure-ftpd 1.0.16c
--
From: Frank Denis <j at pureftpd dot org>
@
text
@d1 28
a28 18
$OpenBSD: patch-configure_ac,v 1.2 2003/10/30 21:08:25 naddy Exp $
--- configure.ac.orig	2003-10-13 15:23:01.000000000 -0400
+++ configure.ac	2003-10-25 18:40:42.000000000 -0400
@@@@ -56,7 +56,13 @@@@ AC_CHECK_HEADERS(unistd.h string.h strin
 AC_CHECK_HEADERS(sys/vfs.h sys/statvfs.h sys/sendfile.h sys/uio.h sys/fsuid.h)
 AC_CHECK_HEADERS(sys/time.h sys/resource.h sys/capability.h)
 AC_CHECK_HEADERS(shadow.h getopt.h stddef.h)
-AC_CHECK_HEADERS(netinet/in_systm.h netinet/in.h sys/mount.h sys/pstat.h)
+AC_CHECK_HEADERS(netinet/in_systm.h netinet/in.h sys/pstat.h)
+
+AC_CHECK_HEADERS(sys/mount.h, [], [],
+[#ifdef HAVE_SYS_PARAM_H
+# include <sys/param.h>
+#endif])
+
 AC_CHECK_HEADERS(fcntl.h sys/fcntl.h sys/loadavg.h sys/ptrace.h)
 AC_CHECK_HEADERS(security/pam_appl.h security/pam_misc.h security/pam_filter.h)
 AC_CHECK_HEADERS(sgtty.h termio.h)
@


1.2
log
@unbreak: use the correct macro
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.1 2003/10/25 22:50:24 brad Exp $
@


1.1
log
@upgrade to pure-ftpd 1.0.16b
--
From: Frank Denis <j at pureftpd dot org>
With a fix from me for the header check for sys/mount.h, we need to include
sys/param.h first.
@
text
@d1 1
a1 1
$OpenBSD$
d11 1
a11 1
+AC_CHECK_HEADER(sys/mount.h, [], [],
@

