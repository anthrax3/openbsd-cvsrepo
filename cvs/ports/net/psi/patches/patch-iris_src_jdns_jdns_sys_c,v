head	1.2;
access;
symbols
	OPENBSD_6_0:1.2.0.12
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.8
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.10
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.6
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.4
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.2
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2013.10.09.16.52.24;	author shadchin;	state Exp;
branches;
next	1.1;

1.1
date	2013.04.21.13.56.27;	author shadchin;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Now _res has minimal support: not define nsaddr_list, only nscount,
therefore psi could not determine dns server. Switch psi on resolv.conf.

tested Matthew Clarke <clamat at telus dot net>
@
text
@$OpenBSD: patch-iris_src_jdns_jdns_sys_c,v 1.1 2013/04/21 13:56:27 shadchin Exp $
--- iris/src/jdns/jdns_sys.c.orig	Thu Oct  4 06:53:09 2012
+++ iris/src/jdns/jdns_sys.c	Sun Jul 14 21:45:39 2013
@@@@ -752,6 +752,7 @@@@ static jdns_dnsparams_t *dnsparams_get_unixsys()
 	if(n == -1)
 		return params;
 
+#ifndef JDNS_OS_OPENBSD
 	// nameservers - ipv6
 	for(n = 0; n < MAXNS && n < RESVAR._u._ext.nscount; ++n)
 	{
@@@@ -775,6 +776,7 @@@@ static jdns_dnsparams_t *dnsparams_get_unixsys()
 		jdns_dnsparams_append_nameserver(params, addr, JDNS_UNICAST_PORT);
 		jdns_address_delete(addr);
 	}
+#endif
 
 	// nameservers - ipv4
 	for(n = 0; n < MAXNS && n < RESVAR.nscount; ++n)
@@@@ -829,6 +831,9 @@@@ static jdns_dnsparams_t *dnsparams_get_unix()
 {
 	jdns_dnsparams_t *params;
 
+#if defined(JDNS_OS_OPENBSD)
+	params = dnsparams_get_unixfiles();
+#else
 	// prefer system calls over files
 	params = dnsparams_get_unixsys();
 	if(params->nameservers->count == 0)
@@@@ -836,6 +841,7 @@@@ static jdns_dnsparams_t *dnsparams_get_unix()
 		jdns_dnsparams_delete(params);
 		params = dnsparams_get_unixfiles();
 	}
+#endif
 
 	apply_hosts_file(params, "/etc/hosts");
 
@


1.1
log
@Update to psi-0.15.
@
text
@d1 3
a3 3
$OpenBSD$
--- iris/src/jdns/jdns_sys.c.orig	Sun Apr  1 13:15:35 2012
+++ iris/src/jdns/jdns_sys.c	Sun Apr  8 14:32:54 2012
d20 18
@

