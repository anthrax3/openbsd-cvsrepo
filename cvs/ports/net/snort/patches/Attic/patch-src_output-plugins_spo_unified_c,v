head	1.2;
access;
symbols
	OPENBSD_4_2:1.1.0.4
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.2
	OPENBSD_4_1_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2008.02.12.14.13.32;	author rui;	state dead;
branches;
next	1.1;

1.1
date	2006.11.25.05.33.28;	author pvalchev;	state Exp;
branches;
next	;


desc
@@


1.2
log
@- update to snort 2.8.0.1.

from Markus Lude with a few changes, tested by many including reyk@@, jdixon@@. Thanks.

ok landry@@
@
text
@$OpenBSD: patch-src_output-plugins_spo_unified_c,v 1.1 2006/11/25 05:33:28 pvalchev Exp $
--- src/output-plugins/spo_unified.c.orig	Fri May 12 20:19:56 2006
+++ src/output-plugins/spo_unified.c	Tue Nov  7 20:28:12 2006
@@@@ -126,7 +126,7 @@@@ typedef struct _UnifiedLog
 typedef struct _UnifiedAlert
 {
     Event event;
-    struct timeval ts;         /* event timestamp */
+    struct pcap_timeval ts;    /* event timestamp */
     u_int32_t sip;             /* src ip */
     u_int32_t dip;             /* dest ip */
     u_int16_t sp;              /* src port */
@@@@ -551,7 +551,11 @@@@ void RealUnifiedLogPacketAlert(Packet *p
          * this will have to be fixed when we transition to the pa_engine
          * code (p->pkth is libpcap specific)
          */ 
-        memcpy(&logheader.pkth, p->pkth, sizeof(SnortPktHeader));
+        logheader.pkth.ts.tv_sec = p->pkth->ts.tv_sec;
+        logheader.pkth.ts.tv_usec = p->pkth->ts.tv_usec;
+        logheader.pkth.caplen = p->pkth->caplen;
+        logheader.pkth.pktlen = p->pkth->len;
+
     }
     else
     {
@@@@ -1260,7 +1264,11 @@@@ void OldUnifiedLogPacketAlert(Packet *p,
         {
             logheader.flags = p->packet_flags;
 
-            memcpy(&logheader.pkth, p->pkth, sizeof(SnortPktHeader));
+            logheader.pkth.ts.tv_sec = p->pkth->ts.tv_sec;
+            logheader.pkth.ts.tv_usec = p->pkth->ts.tv_usec;
+            logheader.pkth.caplen = p->pkth->caplen;
+            logheader.pkth.pktlen = p->pkth->len;
+
 
 #ifdef GIDS
             /*
@


1.1
log
@Differentiate between struct timeval and bpf_timeval.. fixes
logging/alerting on 64-bit platforms.
From nikns@@secure.lv
@
text
@d1 1
a1 1
$OpenBSD$
@

