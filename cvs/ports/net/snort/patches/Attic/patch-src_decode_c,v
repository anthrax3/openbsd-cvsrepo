head	1.2;
access;
symbols
	OPENBSD_5_2:1.1.0.2
	OPENBSD_5_2_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2012.09.26.02.11.05;	author lteo;	state dead;
branches;
next	1.1;

1.1
date	2012.04.07.08.31.39;	author mcbride;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update Snort to 2.9.3.1.

Thank you to all who tested: Markus Lude (sparc64), abieber@@ (macppc),
and Adam Jeanguenat (i386); I also tested on amd64 and i386.  Thank you
to Rodolfo Gouveia for help/tests on earlier versions, and brad@@ for
comments on an earlier version.

From Markus Lude (maintainer), and includes changes done based on
feedback from sthen@@ and myself.

OK abieber@@ sthen@@
@
text
@$OpenBSD: patch-src_decode_c,v 1.1 2012/04/07 08:31:39 mcbride Exp $
--- src/decode.c.orig	Fri Mar 19 02:50:54 2010
+++ src/decode.c	Sat Mar 24 11:23:57 2012
@@@@ -2343,20 +2343,36 @@@@ void DecodePflog(Packet * p, const struct pcap_pkthdr 
         return;
     }
     /* lay the pf header structure over the packet data */
-    if ( *((uint8_t*)pkt) < PFLOG3_HDRMIN )
+    switch(*((uint8_t*)pkt))
     {
-        p->pf2h = (Pflog2Hdr*)pkt;
-        pflen = p->pf2h->length;
-        hlen = PFLOG2_HDRLEN;
-        af = p->pf2h->af;
+        case PFLOG2_HDRMIN:
+            p->pf2h = (Pflog2Hdr*)pkt;
+            pflen = p->pf2h->length;
+            hlen = PFLOG2_HDRLEN;
+            af = p->pf2h->af;
+            break;
+        case PFLOG3_HDRMIN:
+            p->pf3h = (Pflog3Hdr*)pkt;
+            pflen = p->pf3h->length;
+            hlen = PFLOG3_HDRLEN;
+            af = p->pf3h->af;
+            break;
+        case PFLOG4_HDRMIN:
+            p->pf4h = (Pflog4Hdr*)pkt;
+            pflen = p->pf4h->length;
+            hlen = PFLOG4_HDRLEN;
+            af = p->pf4h->af;
+            break;
+        default:
+            if (ScLogVerbose())
+            {
+                ErrorMessage("unrecognized pflog header length! "
+                        "(%d)\n", *((uint8_t*)pkt));
+            }
+            PREPROC_PROFILE_END(decodePerfStats);
+            return;
     }
-    else
-    {
-        p->pf3h = (Pflog3Hdr*)pkt;
-        pflen = p->pf3h->length;
-        hlen = PFLOG3_HDRLEN;
-        af = p->pf3h->af;
-    }
+   
     /* now that we know a little more, do a little more validation */
     if(p->pkth->caplen < hlen)
     {
@


1.1
log
@Support "new" pflog format (revision 1.16 of if_pflog.h, 2010/09/21)

ok sthen
@
text
@d1 1
a1 1
$OpenBSD$
@

