head	1.1;
access;
symbols
	OPENBSD_5_5:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2014.07.24.12.20.06;	author robert;	state dead;
branches
	1.1.2.1;
next	;
commitid	cOs8lzcTgZD5Ekhb;

1.1.2.1
date	2014.07.24.12.20.06;	author robert;	state Exp;
branches;
next	;
commitid	cOs8lzcTgZD5Ekhb;


desc
@@


1.1
log
@file patch-frontends_php_include_defines_inc_php was initially added on branch OPENBSD_5_5.
@
text
@@


1.1.2.1
log
@backport security fix for a Local File Inclusion via XXE Attack vulnerability
https://support.zabbix.com/browse/ZBX-8151

ok jasper@@
@
text
@a0 18
$OpenBSD$
--- frontends/php/include/defines.inc.php.orig	Mon Dec  9 10:15:15 2013
+++ frontends/php/include/defines.inc.php	Thu Jul 24 14:18:50 2014
@@@@ -897,6 +897,14 @@@@ define('XML_TAG_DEPENDENCY',		'dependency');
 
 define('ZBX_DEFAULT_IMPORT_HOST_GROUP', 'Imported hosts');
 
+// XML import flags
+// See ZBX-8151. Old version of libxml suffered from setting DTDLOAD and NOENT flags by default, which allowed
+// performing XXE attacks. Calling libxml_disable_entity_loader(true) also had no affect if flags passed to libxml
+// calls were 0 - so for better security with legacy libxml we need to call libxml_disable_entity_loader(true) AND
+// pass the LIBXML_NONET flag. Please keep in mind that LIBXML_NOENT actually EXPANDS entities, opposite to it's name -
+// so this flag is not needed here.
+define('LIBXML_IMPORT_FLAGS', LIBXML_NONET);
+
 // API errors
 define('ZBX_API_ERROR_INTERNAL',	111);
 define('ZBX_API_ERROR_PARAMETERS',	100);
@

