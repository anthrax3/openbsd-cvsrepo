head	1.2;
access;
symbols
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2011.08.21.09.21.02;	author ajacoutot;	state dead;
branches;
next	1.1;

1.1
date	2011.04.25.07.42.36;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to Zabbix 1.8.6.
For details, see:
http://www.zabbix.com/documentation/1.8/manual/about/what_s_new_1.8.6
@
text
@$OpenBSD: patch-src_libs_zbxcomms_comms_c,v 1.1 2011/04/25 07:42:36 ajacoutot Exp $

comms.c:765: error: 'SOL_IPV6' undeclared (first use in this function)
(patch from FreeBSD)

--- src/libs/zbxcomms/comms.c.orig	Fri Apr 15 21:17:29 2011
+++ src/libs/zbxcomms/comms.c	Mon Apr 25 08:58:46 2011
@@@@ -756,19 +756,14 @@@@ int	zbx_tcp_listen(zbx_sock_t *s, const char *listen_i
 						ip ? ip : "-", port, zbx_sock_last_error(), strerror_from_system(zbx_sock_last_error()));
 			}
 
-#if defined(IPV6_V6ONLY)
-#ifdef _WINDOWS
+#if defined(IPPROTO_IPV6) && defined(IPV6_V6ONLY)
 			if (PF_INET6 == current_ai->ai_family &&
 				ZBX_TCP_ERROR == setsockopt(s->sockets[s->num_socks], IPPROTO_IPV6, IPV6_V6ONLY, (void *)&on, sizeof(on)))
-#else
-			if (PF_INET6 == current_ai->ai_family &&
-				ZBX_TCP_ERROR == setsockopt(s->sockets[s->num_socks], SOL_IPV6, IPV6_V6ONLY, (void *)&on, sizeof(on)))
-#endif
 			{
 				zbx_set_tcp_strerror("setsockopt() with IPV6_V6ONLY for [[%s]:%s] failed with error %d: %s",
 						ip ? ip : "-", port, zbx_sock_last_error(), strerror_from_system(zbx_sock_last_error()));
 			}
-#endif	/* IPV6_V6ONLY */
+#endif
 
 			if (ZBX_TCP_ERROR == bind(s->sockets[s->num_socks], current_ai->ai_addr, current_ai->ai_addrlen))
 			{
@


1.1
log
@Update to zabbix 1.8.5.
See http://www.zabbix.com/documentation/1.8/manual/about/what_s_new_1.8.5
for details.
@
text
@d1 1
a1 1
$OpenBSD$
@

