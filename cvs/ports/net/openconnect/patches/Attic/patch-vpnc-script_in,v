head	1.2;
access;
symbols
	OPENBSD_5_2:1.1.1.1.0.4
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.2
	sthen_20110812:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2012.11.08.16.44.21;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2011.12.08.13.55.28;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.12.08.13.55.28;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Tweak the OpenConnect port: update vpnc-script, enable NLS (gettext
was already pulled in via libs, so no new deps), and avoid SEPARATE_BUILD
for now as the code to detect a version mismatch between binary and lib
in this version doesn't handle it.
@
text
@$OpenBSD: patch-vpnc-script_in,v 1.1 2011/12/08 13:55:28 sthen Exp $
--- vpnc-script.orig	Thu Dec  8 13:18:54 2011
+++ vpnc-script	Thu Dec  8 13:22:05 2011
@@@@ -59,7 +59,7 @@@@ if [ ! -d "/var/run/vpnc" ]; then
 fi
 
 # stupid SunOS: no blubber in /usr/local/bin ... (on stdout)
-IPROUTE="`which ip | grep '^/' 2> /dev/null`"
+IPROUTE="`which ip 2> /dev/null | grep '^/'`"
 
 if [ "$OS" = "Linux" ]; then
 	ifconfig_syntax_ptp="pointopoint"
@@@@ -141,7 +141,7 @@@@ do_ifconfig() {
 
 destroy_tun_device() {
 	case "$OS" in
-	NetBSD|FreeBSD) # and probably others...
+	NetBSD|FreeBSD|OpenBSD) # and probably others...
 		ifconfig "$TUNDEV" destroy
 		;;
         SunOS)
@@@@ -266,7 +266,7 @@@@ else # use route command
 
 	del_network_route() {
 		case "$OS" in
-		Linux|NetBSD|Darwin|SunOS) # and probably others...
+		Linux|NetBSD|Darwin|SunOS|OpenBSD) # and probably others...
 			# routes are deleted automatically on device shutdown
 			return
 			;;
@@@@ -524,7 +524,9 @@@@ do_pre_init() {
 	elif [ "$OS" = "NetBSD" ]; then
 		:
 	elif [ "$OS" = "OpenBSD" ]; then
-		:
+		if ! ifconfig $TUNDEV > /dev/null; then
+			ifconfig $TUNDEV create
+		fi
 	elif [ "$OS" = "SunOS" ]; then
 		:
 	elif [ "$OS" = "Darwin" ]; then
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@import ports/net/openconnect:

OpenConnect is a client for Cisco's AnyConnect SSL VPN, which is
supported by the ASA5500 Series, IOS 12.4(9)T or later on Cisco SR500,
870, 880, 1800, 2800, 3800, 7200 Series and 7301 Routers, and probably
others. Features include:

- Connection through HTTP/SOCKS5 proxy.
- Automatic detection of IPv4 and IPv6 address, routes.
- Authentication via HTTP forms.
- Authentication using SSL certificates.
- Data transport over TCP (HTTPS) or UDP (DTLS).
- Keepalive and Dead Peer Detection on both HTTPS and DTLS.
- Automatic update of VPN server list / configuration.
- Roaming support, allowing reconnection when the local
  IP address changes.

ok/tweaks jasper@@, and *big* thanks to upstream developer David Woodhouse
for letting me have access to his test server, noticing+tracking down
problems with vpnc-script when configuring v6 addresses on tun on OpenBSD,
and testing the fix for this on a range of OS.
@
text
@@
