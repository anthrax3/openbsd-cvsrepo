head	1.3;
access;
symbols
	OPENBSD_4_6:1.2.0.6
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.4
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.2
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.1.0.4
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.2
	OPENBSD_4_2_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2009.10.01.16.28.49;	author sthen;	state dead;
branches;
next	1.2;

1.2
date	2008.06.12.12.46.05;	author wcmaier;	state Exp;
branches;
next	1.1;

1.1
date	2007.05.05.14.23.18;	author claudio;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update scapy to 2.0.1 from new maintainer Jonathan Armani with a little
help from me. The IPv6 features provided by scapy6 are integrated (still
some problems with them, but working well enough) so pkgpath/conflict
markers are set to replace an existing scapy6 installation.

ok wcmaier@@ "if it works go for it" claudio@@
@
text
@$OpenBSD: patch-scapy_py,v 1.2 2008/06/12 12:46:05 wcmaier Exp $
--- scapy.py.orig	Mon Apr  9 08:17:35 2007
+++ scapy.py	Wed Jun 11 08:02:10 2008
@@@@ -1131,6 +1131,7 @@@@ if not LINUX:
         else:
             f=os.popen("netstat -rn") # -f inet
         ok = 0
+        prio_present = False
         mtu_present = False
         routes = []
         for l in f.readlines():
@@@@ -1141,7 +1142,9 @@@@ if not LINUX:
                 continue
             if l.find("Destination") >= 0:
                 ok = 1
-                if l.find("Mtu") >= 0:
+                if l.find("Prio") >= 0:
+                    prio_present = True
+                elif l.find("Mtu") >= 0:
                     mtu_present = True
                 continue
             if ok == 0:
@@@@ -1151,8 +1154,10 @@@@ if not LINUX:
             if SOLARIS:
                 dest,mask,gw,netif,mxfrg,rtt,ref,flg = l.split()[:8]
             else:
-                if mtu_present:
-                    dest,gw,flg,ref,use,mtu,netif = l.split()[:7]
+                if prio_present:
+                    dest,gw,flg,ref,use,mtu,prio,netif = l.split()[:8]
+                elif mtu_present:
+                    dest,gw,flg,ref,use,mtu,netif = l.split(None, 6)[:7]
                 else:
                     dest,gw,flg,ref,use,netif = l.split()[:6]
             if flg.find("Lc") >= 0:
@@@@ -1172,6 +1177,8 @@@@ if not LINUX:
                 dest, = struct.unpack("I",inet_aton(dest))
             if not "G" in flg:
                 gw = '0.0.0.0'
+            if 'L' in netif:
+		_,netif = netif.split()
             ifaddr = get_if_addr(netif)
             routes.append((dest,netmask,gw,netif,ifaddr))
         f.close()
@@@@ -9847,7 +9854,8 @@@@ class PcapWriter:
         """
         
         if self.header_done == 0:
-            if self.linktype == None:
+            linktype = self.linktype
+            if linktype == None:
                 if isinstance(pkt,Packet):
                     linktype = LLNumTypes.get(pkt.__class__,1)
                 else:
@@@@ -12190,4 +12198,5 @@@@ def read_config_file(configfile):
 if __name__ == "__main__":
     interact()
 else:
-    read_config_file(DEFAULT_CONFIG_FILE)
+    if DEFAULT_CONFIG_FILE:
+        read_config_file(DEFAULT_CONFIG_FILE)
@


1.2
log
@Sync scapy with route(8) output now that we support priorities.

Initial report and testing from Tim Donahue <tdonahue at vonsystems
dot com> (and subsequent poke from sthen); thanks!

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-scapy_py,v 1.1 2007/05/05 14:23:18 claudio Exp $
@


1.1
log
@Update scapy to 1.1.1 and add some patches needed to make it more reliable.
OK jasper@@
@
text
@d1 24
a24 4
$OpenBSD$
--- scapy.py.orig	Mon Apr  9 15:17:35 2007
+++ scapy.py	Sat May  5 15:59:19 2007
@@@@ -1152,7 +1152,7 @@@@ if not LINUX:
d27 1
a27 1
                 if mtu_present:
d29 3
d36 1
a36 1
@@@@ -1172,6 +1172,8 @@@@ if not LINUX:
d45 1
a45 1
@@@@ -9847,7 +9849,8 @@@@ class PcapWriter:
d55 1
a55 1
@@@@ -12190,4 +12193,5 @@@@ def read_config_file(configfile):
@

