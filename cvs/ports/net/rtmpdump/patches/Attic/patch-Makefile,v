head	1.9;
access;
symbols
	OPENBSD_4_7:1.5.0.2
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.2.0.2
	OPENBSD_4_6_BASE:1.2
	sthen_20090417:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.9
date	2011.07.17.09.56.04;	author sthen;	state dead;
branches;
next	1.8;

1.8
date	2011.03.21.09.46.31;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2010.04.03.23.41.08;	author sthen;	state dead;
branches;
next	1.6;

1.6
date	2010.03.21.09.36.19;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2010.02.26.18.46.26;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2009.12.26.08.49.10;	author benoit;	state Exp;
branches;
next	1.3;

1.3
date	2009.11.19.01.06.07;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2009.04.29.00.51.23;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2009.04.17.17.56.50;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.04.17.17.56.50;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Update to rtmpdump 2.4, packaged from git. From Nigel Taylor.
Supports RTMPE type 9 handshakes, used by some youtube streams (e.g. UK 4od)
@
text
@$OpenBSD: patch-Makefile,v 1.8 2011/03/21 09:46:31 sthen Exp $
--- Makefile.orig	Wed Jun 30 20:58:35 2010
+++ Makefile	Sun Mar 20 19:11:50 2011
@@@@ -11,9 +11,10 @@@@ SYS=posix
 CRYPTO=OPENSSL
 #CRYPTO=POLARSSL
 #CRYPTO=GNUTLS
-LIB_GNUTLS=-lgnutls -lgcrypt
-LIB_OPENSSL=-lssl -lcrypto
-LIB_POLARSSL=-lpolarssl
+LIBZ=-lz
+LIB_GNUTLS=-lgnutls -lgcrypt $(LIBZ)
+LIB_OPENSSL=-lssl -lcrypto $(LIBZ)
+LIB_POLARSSL=-lpolarssl $(LIBZ)
 CRYPTO_LIB=$(LIB_$(CRYPTO))
 DEF_=-DNO_CRYPTO
 CRYPTO_DEF=$(DEF_$(CRYPTO))
@@@@ -32,10 +33,12 @@@@ SBINDIR=$(DESTDIR)$(sbindir)
 MANDIR=$(DESTDIR)$(mandir)
 
 LIBS_posix=
+LIBS_darwin=
 LIBS_mingw=-lws2_32 -lwinmm -lgdi32
-LIBS=$(CRYPTO_LIB) -lz $(LIBS_$(SYS)) $(XLIBS)
+LIBS=-Llibrtmp -lrtmp $(CRYPTO_LIB) $(LIBS_$(SYS)) $(XLIBS)
 
 THREADLIB_posix=-lpthread
+THREADLIB_darwin=-lpthread
 THREADLIB_mingw=
 THREADLIB=$(THREADLIB_$(SYS))
 SLIBS=$(THREADLIB) $(LIBS)
@@@@ -44,14 +47,17 @@@@ LIBRTMP=librtmp/librtmp.a
 INCRTMP=librtmp/rtmp_sys.h librtmp/rtmp.h librtmp/log.h librtmp/amf.h
 
 EXT_posix=
+EXT_darwin=
 EXT_mingw=.exe
 EXT=$(EXT_$(SYS))
 
-all:	$(LIBRTMP) progs
+PROGS=rtmpdump rtmpgw rtmpsrv rtmpsuck
 
-progs:	rtmpdump rtmpgw rtmpsrv rtmpsuck
+all:	$(LIBRTMP) $(PROGS)
 
-install:	progs
+$(PROGS): $(LIBRTMP)
+
+install:	$(PROGS)
 	-mkdir -p $(BINDIR) $(SBINDIR) $(MANDIR)/man1 $(MANDIR)/man8
 	cp rtmpdump$(EXT) $(BINDIR)
 	cp rtmpgw$(EXT) rtmpsrv$(EXT) rtmpsuck$(EXT) $(SBINDIR)
@@@@ -68,20 +74,17 @@@@ FORCE:
 $(LIBRTMP): FORCE
 	@@cd librtmp; $(MAKE) all
 
-# note: $^ is GNU Make's equivalent to BSD $>
-# we use both since either make will ignore the one it doesn't recognize
+rtmpdump: rtmpdump.o
+	$(CC) $(LDFLAGS) -o $@@$(EXT) $@@.o $(LIBS)
 
-rtmpdump: rtmpdump.o $(LIBRTMP)
-	$(CC) $(LDFLAGS) $^ $> -o $@@$(EXT) $(LIBS)
+rtmpsrv: rtmpsrv.o thread.o
+	$(CC) $(LDFLAGS) -o $@@$(EXT) $@@.o thread.o $(SLIBS)
 
-rtmpsrv: rtmpsrv.o thread.o $(LIBRTMP)
-	$(CC) $(LDFLAGS) $^ $> -o $@@$(EXT) $(SLIBS)
+rtmpsuck: rtmpsuck.o thread.o
+	$(CC) $(LDFLAGS) -o $@@$(EXT) $@@.o thread.o $(SLIBS)
 
-rtmpsuck: rtmpsuck.o thread.o $(LIBRTMP)
-	$(CC) $(LDFLAGS) $^ $> -o $@@$(EXT) $(SLIBS)
-
-rtmpgw: rtmpgw.o thread.o $(LIBRTMP)
-	$(CC) $(LDFLAGS) $^ $> -o $@@$(EXT) $(SLIBS)
+rtmpgw: rtmpgw.o thread.o
+	$(CC) $(LDFLAGS) -o $@@$(EXT) $@@.o thread.o $(SLIBS)
 
 rtmpgw.o: rtmpgw.c $(INCRTMP) Makefile
 rtmpdump.o: rtmpdump.c $(INCRTMP) Makefile
@


1.8
log
@- handle newer rtmp servers; from upstream SVN via Nigel Taylor
- fix the inclusion order of network headers (netinet/in.h before arpa/inet.h)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.7
log
@update to 2.2b
@
text
@d1 38
a38 12
$OpenBSD: patch-Makefile,v 1.6 2010/03/21 09:36:19 sthen Exp $

gmake-isms, r373 upstream

--- Makefile.orig	Sat Mar 20 10:52:53 2010
+++ Makefile	Sat Mar 20 22:41:37 2010
@@@@ -35,24 +35,27 @@@@ cross:
 
 clean:
 	rm -f *.o rtmpdump$(EXT) rtmpgw$(EXT) rtmpsrv$(EXT) rtmpsuck$(EXT)
-	@@$(MAKE) -C librtmp clean
+	@@cd librtmp; $(MAKE) clean
d40 2
a41 1
 FORCE:
d43 11
d55 1
a55 2
-	@@$(MAKE) -C librtmp all CC="$(CC)" CFLAGS="$(CFLAGS)"
+	@@cd librtmp; $(MAKE) all CC="$(CC)" CFLAGS="$(CFLAGS)"
d57 22
a78 18
+# note: $^ is GNU Make's equivalent to BSD $>
+# we use both since either make will ignore the one it doesn't recognize
+
 rtmpdump: rtmpdump.o $(LIBRTMP)
-	$(CC) $(LDFLAGS) $^ -o $@@$(EXT) $(LIBS)
+	$(CC) $(LDFLAGS) $^ $> -o $@@$(EXT) $(LIBS)
 
 rtmpsrv: rtmpsrv.o thread.o $(LIBRTMP)
-	$(CC) $(LDFLAGS) $^ -o $@@$(EXT) $(SLIBS)
+	$(CC) $(LDFLAGS) $^ $> -o $@@$(EXT) $(SLIBS)
 
 rtmpsuck: rtmpsuck.o thread.o $(LIBRTMP)
-	$(CC) $(LDFLAGS) $^ -o $@@$(EXT) $(SLIBS)
+	$(CC) $(LDFLAGS) $^ $> -o $@@$(EXT) $(SLIBS)
 
 rtmpgw: rtmpgw.o thread.o $(LIBRTMP)
-	$(CC) $(LDFLAGS) $^ -o $@@$(EXT) $(SLIBS)
+	$(CC) $(LDFLAGS) $^ $> -o $@@$(EXT) $(SLIBS)
@


1.6
log
@update to 2.2a and remove most of the patches in favour of MAKE_FLAGS.
with J.C. Roberts
@
text
@d1 1
a1 1
$OpenBSD$
@


1.5
log
@- update to 2.1d, fixes a corruption problem with resume
- sync port Makefile with flvstreamer

ok jasper@@, earlier version ok benoit@@
(reminder, ports is not fully open, do not commit without specific permission)
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.4 2009/12/26 08:49:10 benoit Exp $
d3 1
a3 1
avoid gmake-isms
d5 19
a23 15
--- Makefile.orig	Sun Feb 21 17:31:12 2010
+++ Makefile	Tue Feb 23 21:43:51 2010
@@@@ -6,7 +6,7 @@@@ OPT=-O2
 CFLAGS=-Wall $(XCFLAGS) $(INC) $(DEF) $(OPT)
 LDFLAGS=-Wall $(XLDFLAGS)
 LIBS=-lcrypto -lz
-THREADLIB=-lpthread
+THREADLIB=-pthread
 SLIBS=$(THREADLIB) $(LIBS)
 RTMP_OBJS=rtmp.o log.o amf.o
 
@@@@ -35,16 +35,16 @@@@ clean:
 	rm -f *.o rtmpdump$(EXT) streams$(EXT) rtmpsrv$(EXT) rtmpsuck$(EXT)
 
 rtmpdump: rtmpdump.o $(RTMP_OBJS) parseurl.o hashswf.o
d25 1
a25 1
+	$(CC) $(LDFLAGS) $> -o $@@$(EXT) $(LIBS)
d27 1
a27 1
 rtmpsrv: rtmpsrv.o $(RTMP_OBJS) thread.o
d29 1
a29 1
+	$(CC) $(LDFLAGS) $> -o $@@$(EXT) $(SLIBS)
d31 1
a31 1
 rtmpsuck: rtmpsuck.o $(RTMP_OBJS) hashswf.o thread.o
d33 1
a33 1
+	$(CC) $(LDFLAGS) $> -o $@@$(EXT) $(SLIBS)
d35 1
a35 1
 streams: streams.o $(RTMP_OBJS) parseurl.o hashswf.o thread.o
d37 1
a37 1
+	$(CC) $(LDFLAGS) $> -o $@@$(EXT) $(SLIBS)
d39 2
a40 2
 log.o: log.c log.h Makefile
 parseurl.o: parseurl.c parseurl.h log.h Makefile
@


1.4
log
@- update rtmpdump to 2.0
- update patches
- update WANTLIB and MASTER_SITES

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
d5 4
a8 12
--- Makefile.orig	Mon Dec 21 13:39:51 2009
+++ Makefile	Fri Dec 25 17:01:53 2009
@@@@ -1,3 +1,7 @@@@
+.SUFFIXES: .cpp
+.cpp.o:
+	$(CXX) $(CXXFLAGS) -c $< -o $@@
+
 CC=$(CROSS_COMPILE)gcc
 LD=$(CROSS_COMPILE)ld
 
@@@@ -5,7 +9,7 @@@@
 CFLAGS=-Wall $(XCFLAGS) $(INC) $(OPT)
d10 1
a10 1
 LIBS=-lcrypto
d14 4
d19 3
a21 3
 EXT=
@@@@ -38,10 +42,10 @@@@
 	rm -f *.o rtmpdump$(EXT) streams$(EXT)
d23 1
a23 1
 streams: log.o rtmp.o amf.o streams.o parseurl.o
d27 7
a33 3
 rtmpdump: log.o rtmp.o amf.o rtmpdump.o parseurl.o
-	$(CC) $(LDFLAGS) $^ -o $@@$(EXT) $(LIBS)
+	$(CC) $(LDFLAGS) $> -o $@@$(EXT) $(LIBS)
@


1.3
log
@update to 1.9, homepage is now rtmpdump.mplayerhq.hu
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.2 2009/04/29 00:51:23 sthen Exp $
d5 2
a6 2
--- Makefile.orig	Thu Nov 12 13:00:48 2009
+++ Makefile	Thu Nov 19 01:00:33 2009
a12 1
 CXX=$(CROSS_COMPILE)g++
d14 3
a16 2
@@@@ -7,7 +11,7 @@@@ CFLAGS=-Wall $(XCFLAGS) $(INC) $(OPT)
 CXXFLAGS=-Wall $(XCFLAGS) $(INC) $(OPT)
d24 1
a24 1
@@@@ -40,10 +44,10 @@@@ clean:
d27 3
a29 3
 streams: bytes.o log.o rtmp.o AMFObject.o rtmppacket.o streams.o parseurl.o dh.o handshake.o
-	$(CXX) $(LDFLAGS) $^ -o $@@$(EXT) $(SLIBS)
+	$(CXX) $(LDFLAGS) $> -o $@@$(EXT) $(SLIBS)
d31 3
a33 3
 rtmpdump: bytes.o log.o rtmp.o AMFObject.o rtmppacket.o rtmpdump.o parseurl.o dh.o handshake.o
-	$(CXX) $(LDFLAGS) $^ -o $@@$(EXT) $(LIBS)
+	$(CXX) $(LDFLAGS) $> -o $@@$(EXT) $(LIBS)
a34 1
 bytes.o: bytes.c bytes.h Makefile
d36 1
@


1.2
log
@update to 1.5, based on a diff from David Cathcart, adds live stream
dumping and rtmpe.
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.1.1.1 2009/04/17 17:56:50 sthen Exp $
d5 3
a7 6
--- Makefile.orig	Mon Apr 27 13:13:18 2009
+++ Makefile	Tue Apr 28 12:11:56 2009
@@@@ -6,16 +6,20 @@@@ CFLAGS=-Wall
 CXXFLAGS=-Wall
 LDFLAGS=-Wall
 
d12 10
a21 1
 all: rtmpdump
d23 3
a25 2
 clean:
 	rm -f *.o
d28 2
a29 2
-	$(CXX) $(LDFLAGS) $^ -o $@@_x86 -lpthread -lssl -lcrypto
+	$(CXX) $(LDFLAGS) $> -o $@@ -lpthread -lssl -lcrypto
d32 2
a33 2
-	$(CXX) $(LDFLAGS) $^ -o $@@_x86 -lssl -lcrypto
+	$(CXX) $(LDFLAGS) $> -o $@@ -lssl -lcrypto
d35 2
a36 2
 bytes.o: bytes.cpp bytes.h Makefile
 log.o: log.cpp log.h Makefile
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d5 3
a7 3
--- Makefile.orig	Fri Apr 17 12:26:58 2009
+++ Makefile	Fri Apr 17 12:27:00 2009
@@@@ -10,13 +10,17 @@@@ CFLAGS=-Wall
d18 1
a18 1
 	rm -f rtmpdump rtmpdump.exe *.o
d20 3
a22 3
 rtmpdump: bytes.o log.o rtmp.o AMFObject.o rtmppacket.o rtmpdump.o parseurl.o
-	$(CXX) $(LDFLAGS) $^ -o $@@
+	$(CXX) $(LDFLAGS) $> -o $@@
d24 6
a29 2
 win32: bytes.o log.o rtmp.o AMFObject.o rtmppacket.o rtmpdump.o parseurl.o
 	$(CXX) $(LDFLAGS) $^ -o rtmpdump.exe -lws2_32 -lwinmm
@


1.1.1.1
log
@import rtmpdump, based on a ports@@ post from David Cathcart, with BE fixes
and tweaks by myself.

A small dumper for media content streamed over the RTMP protocol.
Supplying an rtmp url will result in a dumped flv file, which can be
played/transcoded using ffmpeg/mplayer, etc.
@
text
@@
