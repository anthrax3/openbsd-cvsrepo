head	1.1;
access;
symbols
	OPENBSD_5_0:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2011.12.20.10.55.53;	author sthen;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2011.12.20.10.55.53;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-validator_val_nsec3_c was initially added on branch OPENBSD_5_0.
@
text
@@


1.1.2.1
log
@Add patches from http://www.unbound.net/downloads/CVE-2011-4528.txt to -stable
@
text
@a0 17
$OpenBSD$

http://www.unbound.net/downloads/patch_CVE-2011-4528_unbound_140-1413.diff

--- validator/val_nsec3.c.orig	Tue Mar  1 12:48:45 2011
+++ validator/val_nsec3.c	Tue Dec 20 10:49:55 2011
@@@@ -1195,6 +1195,10 @@@@ nsec3_do_prove_nodata(struct module_env* env, struct n
 	/* Due to forwarders, cnames, and other collating effects, we
 	 * can see the ordinary unsigned data from a zone beneath an
 	 * insecure delegation under an optout here */
+	if(!ce.nc_rrset) {
+		verbose(VERB_ALGO, "nsec3 nodata proof: no next closer nsec3");
+		return sec_status_bogus;
+	}
 
 	/* We need to make sure that the covering NSEC3 is opt-out. */
 	log_assert(ce.nc_rrset);
@

