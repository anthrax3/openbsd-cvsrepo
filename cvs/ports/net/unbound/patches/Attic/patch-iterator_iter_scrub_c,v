head	1.1;
access;
symbols
	OPENBSD_5_0:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2011.12.20.10.55.53;	author sthen;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2011.12.20.10.55.53;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-iterator_iter_scrub_c was initially added on branch OPENBSD_5_0.
@
text
@@


1.1.2.1
log
@Add patches from http://www.unbound.net/downloads/CVE-2011-4528.txt to -stable
@
text
@a0 21
$OpenBSD$

http://www.unbound.net/downloads/patch_CVE-2011-4528_unbound_140-1413.diff

--- iterator/iter_scrub.c.orig	Fri Jan 28 16:11:49 2011
+++ iterator/iter_scrub.c	Tue Dec 20 10:49:55 2011
@@@@ -187,11 +187,14 @@@@ parse_get_cname_target(struct rrset_parse* rrset, uint
 	size_t* snamelen)
 {
 	if(rrset->rr_count != 1) {
+		struct rr_parse* sig;
 		verbose(VERB_ALGO, "Found CNAME rrset with "
 			"size > 1: %u", (unsigned)rrset->rr_count);
 		/* use the first CNAME! */
 		rrset->rr_count = 1;
 		rrset->size = rrset->rr_first->size;
+		for(sig=rrset->rrsig_first; sig; sig=sig->next)
+			rrset->size += sig->size;
 		rrset->rr_last = rrset->rr_first;
 		rrset->rr_first->next = NULL;
 	}
@

