head	1.2;
access;
symbols
	OPENBSD_6_1:1.1.0.4
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.2
	OPENBSD_6_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2017.05.26.10.34.53;	author mestre;	state Exp;
branches;
next	1.1;
commitid	9oNHXkcfxoj3PrPH;

1.1
date	2016.03.24.20.04.25;	author mestre;	state Exp;
branches;
next	;
commitid	eDJytIXqNrJ2KTYh;


desc
@@


1.2
log
@Fix copy pasto from my last commit
@
text
@$OpenBSD: patch-mcabber_main_c,v 1.1 2016/03/24 20:04:25 mestre Exp $
Index: mcabber/main.c
--- mcabber/main.c.orig
+++ mcabber/main.c
@@@@ -453,6 +453,19 @@@@ int main(int argc, char **argv)
   if (ret == -2)
     exit(EXIT_FAILURE);
 
+  if (settings_opt_get("events_command")) {
+    if (pledge("stdio rpath wpath cpath fattr inet dns tty proc exec", NULL) ==
+      -1) {
+      fprintf(stderr, "Cannot pledge: %s\n", strerror(errno));
+      exit(EXIT_FAILURE);
+    }
+  } else {
+    if (pledge("stdio rpath wpath cpath fattr inet dns tty", NULL) == -1) {
+      fprintf(stderr, "Cannot pledge: %s\n", strerror(errno));
+      exit(EXIT_FAILURE);
+    }
+  }
+
   /* Display configuration settings */
   {
     const char *p;
@


1.1
log
@This patch introduces pledge(2) to mcabber with the following promises:

rpath/wpath/cpath/fattr: it needs to read, write and create files and set the
correct attributes
inet/dns: network application needs both promises
tty: ncurses is used for the interface so it needs this
proc/exec: this is only needed if events are configured in the config files

In order to apply this we have disabled modules support since it would need to
load libraries dinamically and therefore prot_exec promise would be needed but
that is not a good strategy. This is mentioned in DESCR to reflect the change.

OK tim@@ after his suggestions and also OK by the maintainer Markus Hennecke
since no users objected this change.
@
text
@d1 5
a5 4
$OpenBSD$
--- mcabber/main.c.orig	Sat Feb 27 12:41:08 2016
+++ mcabber/main.c	Thu Mar 24 17:36:48 2016
@@@@ -455,6 +455,19 @@@@ int main(int argc, char **argv)
d18 1
a18 1
+      exit(EXIT_FAILURE);exit(EXIT_FAILURE);
@

