head	1.2;
access;
symbols
	OPENBSD_6_0:1.2.0.12
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.8
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.10
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.6
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.4
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.2
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.1.0.8
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.6
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.4
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2014.01.13.15.01.22;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2012.01.12.11.30.45;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.2
log
@New round of fixes from upstream:

New download link for server list
(upstream git commit 458e2c2f0d245eca88e9fea48e66bd40036162f4)

If successfully downloaded a server list, and are not connected at
the moment, try to connect.
This happens when no server met is available on startup.
(upstream git commit 41e0edaed86c9be58ae372e419e2cc02cebfa243)

Fix the blasted DoNetworkRearrange()
upstream git commits:
 http://repo.or.cz/w/amule.git/commit/f2307fa12fb18688131962d11623ec776697b15f
 http://repo.or.cz/w/amule.git/commit/af9cec62ba0bf02e31ae316749234cbd31792db7
 http://repo.or.cz/w/amule.git/commit/85ea02a3abc784f415adadfb384c654057e13c01
 http://repo.or.cz/w/amule.git/commit/d41b28c86b2f07439928720971896dde1ae89bb1

mldonkey_importer.pl can import an unlimited number of files
(upstream git commit c7667a3e341c2499b0c9a7299f5b05096247556d)
@
text
@$OpenBSD: patch-src_ServerList_cpp,v 1.1 2012/01/12 11:30:45 dcoppa Exp $

Bugfix: CServerList::LoadStaticServers() failed on empty lines
(upstream git commit e298b38e9ce22e2861d34c5d7f6e7b2e009476b1)

If successfully downloaded a server list, and are not connected at
the moment, try to connect.
This happens when no server met is available on startup.
(upstream git commit 41e0edaed86c9be58ae372e419e2cc02cebfa243)

--- src/ServerList.cpp.orig	Sat Oct  8 23:07:50 2011
+++ src/ServerList.cpp	Mon Jan 13 13:44:42 2014
@@@@ -455,7 +455,7 @@@@ void CServerList::LoadStaticServers()
 		wxString line = f.ReadLine();
 		
 		// Skip comments
-		if ( line.GetChar(0) == '#' || line.GetChar(0) == '/') {
+		if (line.IsEmpty() || line.GetChar(0) == '#' || line.GetChar(0) == '/') {
 			continue;
 		}
 
@@@@ -840,8 +840,9 @@@@ void CServerList::UpdateServerMetFromURL(const wxStrin
 }
 
 
-void CServerList::DownloadFinished(uint32 result) 
+bool CServerList::DownloadFinished(uint32 result) 
 {
+	bool ret = false;
 	if(result == HTTP_Success) {
 		const CPath tempFilename = CPath(theApp->ConfigDir + wxT("server.met.download"));
 
@@@@ -852,11 +853,13 @@@@ void CServerList::DownloadFinished(uint32 result) 
 		// So, file is loaded and merged, and also saved
 		CPath::RemoveFile(tempFilename);
 		AddLogLineN(CFormat(_("Finished downloading the server list from %s")) % m_URLUpdate);
+		ret = true;
 	} else if (result == HTTP_Skipped) {
 		AddLogLineN(CFormat(_("Skipped download of %s, because requested file is not newer.")) % wxT("server.met"));
 	} else {
 		AddLogLineC(CFormat(_("Failed to download %s from %s")) % wxT("server.met") % m_URLUpdate);
 	}
+	return ret;
 }
 
 
@


1.1
log
@Bugfix: CServerList::LoadStaticServers() failed on empty lines
(upstream git commit e298b38e9ce22e2861d34c5d7f6e7b2e009476b1)

Fix loading of zipped IP filter files
(upstream git commit ab24e8375c23c586de837a9cb7a405ca0499ffde)
@
text
@d1 1
a1 1
$OpenBSD$
d6 7
a12 2
--- src/ServerList.cpp.orig	Wed Jan 11 16:34:34 2012
+++ src/ServerList.cpp	Wed Jan 11 16:35:21 2012
d21 25
@

