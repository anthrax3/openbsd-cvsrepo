head	1.7;
access;
symbols
	OPENBSD_6_2:1.7.0.4
	OPENBSD_6_2_BASE:1.7
	OPENBSD_6_1:1.7.0.2
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.6.0.12
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.8
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.10
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.6
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.4
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.2
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.3.0.8
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.6
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.14
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.12
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.10
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.8
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.6
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.4
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.2
	OPENBSD_4_3_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2016.09.19.14.06.53;	author dcoppa;	state Exp;
branches;
next	1.6;
commitid	5r1M93ZXX9IopG1W;

1.6
date	2014.01.20.21.31.25;	author dcoppa;	state Exp;
branches;
next	1.5;

1.5
date	2014.01.13.15.01.22;	author dcoppa;	state Exp;
branches;
next	1.4;

1.4
date	2013.11.25.11.55.13;	author dcoppa;	state Exp;
branches;
next	1.3;

1.3
date	2011.11.28.15.28.49;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2011.06.24.08.42.31;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2007.10.26.15.00.39;	author steven;	state Exp;
branches;
next	;


desc
@@


1.7
log
@
Finally a new release!
Update to amule-2.3.2
@
text
@$OpenBSD: patch-src_amule_cpp,v 1.6 2014/01/20 21:31:25 dcoppa Exp $

Disable checking for new versions at startup.

--- src/amule.cpp.orig	Fri Sep 16 09:55:07 2016
+++ src/amule.cpp	Sun Sep 18 15:31:21 2016
@@@@ -527,6 +527,7 @@@@ bool CamuleApp::OnInit()
 		AddLogLineNS(msg);
 	}
 
+#ifndef __OPENBSD__
 	// Test if there's any new version
 	if (thePrefs::GetCheckNewVersion()) {
 		// We use the thread base because I don't want a dialog to pop up.
@@@@ -536,6 +537,7 @@@@ bool CamuleApp::OnInit()
 		version_check->Create();
 		version_check->Run();
 	}
+#endif
 
 	// Create main dialog, or fork to background (daemon).
 	InitGui(m_geometryEnabled, m_geometryString);
@


1.6
log
@
Ensure constant value is interpreted as it was meant to be
(upstream git commit bc9ac1221f2d3f27b1c7068dbe590ed013f53c7a)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_amule_cpp,v 1.5 2014/01/13 15:01:22 dcoppa Exp $
d3 1
a3 2
Disable checking for new versions at startup: it's useless and was
causing a crash with amuled on sparc64.
d5 3
a7 18
New download link for server list
(upstream git commit 458e2c2f0d245eca88e9fea48e66bd40036162f4)

Ok() is just an undocumented alias for IsOk()
(upstream git commit 740c0298147a614806f1676f77a89908074b5574)

Less writing of known files list during hashing (every 3000MB instead of 300)
Files have become larger and hashing faster.
(upstream git commit f9b504a11ba7fabde6c7a63184edeeeb15ec7f66)

If successfully downloaded a server list, and are not connected at
the moment, try to connect.
This happens when no server met is available on startup.
(upstream git commit 41e0edaed86c9be58ae372e419e2cc02cebfa243)

--- src/amule.cpp.orig	Sun Sep 18 13:01:52 2011
+++ src/amule.cpp	Mon Jan 20 16:47:20 2014
@@@@ -521,6 +521,7 @@@@ bool CamuleApp::OnInit()
d15 1
a15 1
@@@@ -530,6 +531,7 @@@@ bool CamuleApp::OnInit()
a22 42
@@@@ -586,7 +588,7 @@@@ bool CamuleApp::OnInit()
 		// workaround amuled crash
 #ifndef AMULE_DAEMON
 			serverlist->UpdateServerMetFromURL(
-				wxT("http://gruk.org/server.met.gz"));
+				wxT("http://upd.emule-security.org/server.met"));
 #endif
 		}
 	}
@@@@ -760,7 +762,7 @@@@ bool CamuleApp::ReinitializeNetwork(wxString* msg)
 	// This command just sets a flag to control maximum number of connections.
 	// Notify(true) has already been called to the ListenSocket, so events may
 	// be already comming in.
-	if (listensocket->Ok()) {
+	if (listensocket->IsOk()) {
 		listensocket->StartListening();
 	} else {
 		// If we wern't able to start listening, we need to warn the user
@@@@ -1276,8 +1278,8 @@@@ void CamuleApp::OnFinishedHashing(CHashingEvent& evt)
 			sharedfiles->SafeAddKFile(result);
 
 			bytecount += result->GetFileSize();
-			// If we have added files with a total size of ~300mb
-			if (bytecount >= 314572800) {
+			// If we have added files with a total size of ~3000mb
+			if (bytecount >= wxULL(3145728000)) {
 				AddDebugLogLineN(logKnownFiles, wxT("Failsafe for crash on file hashing creation"));
 				if ( m_app_state != APP_STATE_SHUTTINGDOWN ) {
 					knownfiles->Save();
@@@@ -1532,7 +1534,11 @@@@ void CamuleApp::OnFinishedHTTPDownload(CMuleInternalEv
 			ipfilter->DownloadFinished(event.GetExtraLong());
 			break;
 		case HTTP_ServerMet:
-			serverlist->DownloadFinished(event.GetExtraLong());
+			if (serverlist->DownloadFinished(event.GetExtraLong()) && !IsConnectedED2K()) {
+				// If successfully downloaded a server list, and are not connected at the moment, try to connect.
+				// This happens when no server met is available on startup.
+				serverconnect->ConnectToAnyServer();
+			}
 			break;
 		case HTTP_ServerMetAuto:
 			serverlist->AutoDownloadFinished(event.GetExtraLong());
@


1.5
log
@New round of fixes from upstream:

New download link for server list
(upstream git commit 458e2c2f0d245eca88e9fea48e66bd40036162f4)

If successfully downloaded a server list, and are not connected at
the moment, try to connect.
This happens when no server met is available on startup.
(upstream git commit 41e0edaed86c9be58ae372e419e2cc02cebfa243)

Fix the blasted DoNetworkRearrange()
upstream git commits:
 http://repo.or.cz/w/amule.git/commit/f2307fa12fb18688131962d11623ec776697b15f
 http://repo.or.cz/w/amule.git/commit/af9cec62ba0bf02e31ae316749234cbd31792db7
 http://repo.or.cz/w/amule.git/commit/85ea02a3abc784f415adadfb384c654057e13c01
 http://repo.or.cz/w/amule.git/commit/d41b28c86b2f07439928720971896dde1ae89bb1

mldonkey_importer.pl can import an unlimited number of files
(upstream git commit c7667a3e341c2499b0c9a7299f5b05096247556d)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_amule_cpp,v 1.4 2013/11/25 11:55:13 dcoppa Exp $
d22 1
a22 1
+++ src/amule.cpp	Mon Jan 13 15:04:55 2014
d64 1
a64 1
+			if (bytecount >= 3145728000) {
@


1.4
log
@Bugfixes from upstream:

Fix pre-allocation in CDownloadQueue::CopyFileList
(upstream git commit f8f0eca00153b508831fce03c385fb2fb1c8ae66)

Don't log a critical line on startup if statistics.dat is missing
(upstream git commit 2de1d5fa97de56625459362cc6ccfd94dbf1c044)

Less writing of known files list during hashing (every 3000MB instead
of 300): files have become larger and hashing faster.
(upstream git commit f9b504a11ba7fabde6c7a63184edeeeb15ec7f66)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_amule_cpp,v 1.3 2011/11/28 15:28:49 dcoppa Exp $
d6 3
a11 4
commit f9b504a11ba7fabde6c7a63184edeeeb15ec7f66
Author: upstream svn <svn@@amule.org>
Date:   Thu Nov 7 21:50:55 2013 +0000

d14 6
d22 1
a22 1
+++ src/amule.cpp	Mon Nov 25 11:55:53 2013
d39 9
d68 13
@


1.3
log
@Update to aMule version 2.3.1 - The "unobvious evil date" version.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_amule_cpp,v 1.2 2011/06/24 08:42:31 dcoppa Exp $
d9 7
d17 1
a17 1
+++ src/amule.cpp	Mon Nov 28 10:35:00 2011
d43 11
@


1.2
log
@Update to amule-2.2.6

'go for it' espie@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_amule_cpp,v 1.1 2007/10/26 15:00:39 steven Exp $
d6 7
a12 4
--- src/amule.cpp.orig	Tue Aug 18 18:24:58 2009
+++ src/amule.cpp	Thu Nov  4 15:25:39 2010
@@@@ -727,6 +727,7 @@@@ bool CamuleApp::OnInit()
 		printf("\n%s\n", (const char *)unicode2char(msg));
d17 1
a17 1
 	if (thePrefs::CheckNewVersion()) {
d19 1
a19 1
@@@@ -736,6 +737,7 @@@@ bool CamuleApp::OnInit()
d26 10
a35 1
 	InitGui(geometry_enabled, geom_string);
@


1.1
log
@make this work with wxWidgets 2.8

diff from
http://cvs.pld-linux.org/cgi-bin/cvsweb/SOURCES/aMule-wx.patch?rev=1.2

"just commit it" espie@@
@
text
@d1 10
a10 9
$OpenBSD$
--- src/amule.cpp.orig	Fri Apr 21 05:13:51 2006
+++ src/amule.cpp	Wed Oct 10 17:53:08 2007
@@@@ -97,6 +97,7 @@@@
 		#include <CoreFoundation/CFBundle.h>
 		#include <wx/mac/corefoundation/cfstring.h>
 	#endif
+	#include <wx/msgdlg.h>
 #endif
d12 9
d22 2
@

