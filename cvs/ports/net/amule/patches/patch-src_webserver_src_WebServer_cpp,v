head	1.1;
access;
symbols
	OPENBSD_6_0:1.1.0.18
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.14
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.16
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.12
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.10
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.8
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.6
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.4
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.2
	OPENBSD_5_2_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2012.02.22.07.54.26;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Fix a couple of crashers:

fix crash on truncated statistics.dat
(upstream git commit 5e3682f7efed13eb52e4358a2d91b0e381334120)

fix amuleweb crash on CProgressImage::CreateSpan
(upstream git commit 846dcf92ce64fd42caf8a86d644fe3a3f4683d09)

And:

fix showing of shared files to other clients
(upstream git commit 4e40aecb160baac72aa28a8a4c7aaf19261e051f)

change nodes.dat default download URL to something actually working
(upstream git commit 8dbe597539bcac7272ccf4d46790fde814aeded1)
@
text
@$OpenBSD$

Fix amuleweb crash on CProgressImage::CreateSpan
(upstream git commit 846dcf92ce64fd42caf8a86d644fe3a3f4683d09)

--- src/webserver/src/WebServer.cpp.orig	Mon Jun 13 10:50:25 2011
+++ src/webserver/src/WebServer.cpp	Tue Feb 21 15:54:36 2012
@@@@ -1064,18 +1064,24 @@@@ void CProgressImage::CreateSpan()
 		}
 	} else {
 		uint32 factor = m_file->lFileSize / m_width;
-		for(int i = 1; i <= colored_gaps_size;i++) {
+		for (int i = 1; i <= colored_gaps_size;i++) {
 			uint32 start = colored_gaps[i].start / factor;
 			uint32 end = colored_gaps[i].end / factor;
-			for(uint32 j = start; j < end; j++) {
+			if ((int)end > m_width) {
+				end = m_width;
+			}
+			for (uint32 j = start; j < end; j++) {
 				m_ColorLine[j] = colored_gaps[i].color;
 			}
 		}
 		// overwrite requested parts
-		for(uint32 i = 0; i < m_file->m_ReqParts.size(); i++) {
+		for (uint32 i = 0; i < m_file->m_ReqParts.size(); i++) {
 			uint32 start = m_file->m_ReqParts[i].start / factor;
 			uint32 end = m_file->m_ReqParts[i].end / factor;
-			for(uint32 j = start; j < end; j++) {
+			if ((int)end > m_width) {
+				end = m_width;
+			}
+			for (uint32 j = start; j < end; j++) {
 				m_ColorLine[j] = RGB(255, 208, 0);
 			}
 		}
@
