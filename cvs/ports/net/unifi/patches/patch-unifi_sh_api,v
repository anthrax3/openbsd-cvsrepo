head	1.2;
access;
symbols
	OPENBSD_6_1:1.2.0.8
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.6
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.4
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.1.0.2
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2015.06.25.13.50.52;	author sthen;	state Exp;
branches;
next	1.1;
commitid	eZSlx4mnf55bqxah;

1.1
date	2015.02.05.11.10.18;	author sthen;	state Exp;
branches;
next	;
commitid	8Jms1etxmsyH4OCV;


desc
@@


1.2
log
@update to unifi-4.6.3

Upstream has changed from providing a .war file to providing an unpackaged
webroot instead, so this won't upgrade cleanly. First pkg_delete unifi,
then rm -rf /usr/local/share/unifi/webapps/ROOT, then install. We can't
provide built packages of this port anyway, so this is relatively low
impact.
@
text
@$OpenBSD: patch-unifi_sh_api,v 1.1 2015/02/05 11:10:18 sthen Exp $
--- unifi_sh_api.orig	Thu Jun 25 14:19:49 2015
+++ unifi_sh_api	Thu Jun 25 14:20:21 2015
@@@@ -1,4 +1,4 @@@@
-#!/bin/sh
+#!/bin/ksh
 
 #username=ubnt
 #password=ubnt
@@@@ -7,7 +7,7 @@@@
 
 [ -f ./unifi_sh_env ] && . ./unifi_sh_env
 
-cookie=/tmp/unifi_cookie
+cookie=${cookie:-'/tmp/unifi_cookie'}
 
 curl_cmd="curl --tlsv1 --silent --cookie ${cookie} --cookie-jar ${cookie} --insecure "
 
@@@@ -54,7 +54,7 @@@@ unifi_api() {
     fi
     uri=$1
     shift
-    [ "${uri:0:1}" != "/" ] && uri="/$uri"
+    [ $(echo $uri | cut -c1) != "/" ] && uri="/$uri"
     json="$@@"
     [ "$json" = "" ] && json="{}"
     ${curl_cmd} --data "$json" $baseurl/api/s/$site$uri
@


1.1
log
@update to UniFi 3.2.10 (lots of fixes)
also package the shell API
@
text
@d1 4
a4 4
$OpenBSD$
--- unifi_sh_api.orig	Thu Feb  5 11:00:23 2015
+++ unifi_sh_api	Thu Feb  5 11:05:20 2015
@@@@ -1,10 +1,10 @@@@
d10 4
a13 2
 #baseurl=https://unifi:8443
 #site=default
d19 1
a19 1
@@@@ -51,7 +51,7 @@@@ unifi_api() {
@

