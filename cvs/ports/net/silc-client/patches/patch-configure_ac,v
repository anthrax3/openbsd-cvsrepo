head	1.12;
access;
symbols
	OPENBSD_6_1:1.9.0.12
	OPENBSD_6_1_BASE:1.9
	OPENBSD_6_0:1.9.0.10
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.9.0.6
	OPENBSD_5_9_BASE:1.9
	OPENBSD_5_8:1.9.0.8
	OPENBSD_5_8_BASE:1.9
	OPENBSD_5_7:1.9.0.4
	OPENBSD_5_7_BASE:1.9
	OPENBSD_5_6:1.9.0.2
	OPENBSD_5_6_BASE:1.9
	OPENBSD_5_5:1.8.0.2
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.7.0.16
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.14
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.12
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.10
	OPENBSD_5_0:1.7.0.8
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.6
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.4
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.5.0.4
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.2
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.4.0.4
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.2
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.2.0.2
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_0:1.1.0.6
	OPENBSD_3_9:1.1.0.4
	OPENBSD_4_1:1.1.0.2
	OPENBSD_4_1_BASE:1.1;
locks; strict;
comment	@# @;


1.12
date	2017.09.26.14.17.16;	author dcoppa;	state Exp;
branches;
next	1.11;
commitid	1a3y2S9ODwJ3fjfr;

1.11
date	2017.04.16.20.36.58;	author sthen;	state Exp;
branches;
next	1.10;
commitid	nmyPwFbAYOmWfWlZ;

1.10
date	2017.04.16.10.38.10;	author sthen;	state Exp;
branches;
next	1.9;
commitid	1f2MtxuPFLs5xG7w;

1.9
date	2014.07.16.16.15.32;	author brad;	state Exp;
branches;
next	1.8;
commitid	dsFvlZCsXKhZnCuV;

1.8
date	2013.11.04.21.50.22;	author brad;	state Exp;
branches;
next	1.7;

1.7
date	2009.08.01.19.24.34;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2009.08.01.12.58.06;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2009.01.11.02.03.55;	author martynas;	state Exp;
branches;
next	1.4;

1.4
date	2008.01.23.16.06.40;	author todd;	state Exp;
branches;
next	1.3;

1.3
date	2007.10.01.22.03.53;	author simon;	state Exp;
branches;
next	1.2;

1.2
date	2007.04.01.20.43.59;	author steven;	state Exp;
branches;
next	1.1;

1.1
date	2006.10.03.18.34.50;	author brad;	state Exp;
branches
	1.1.4.1
	1.1.6.1;
next	;

1.1.4.1
date	2007.03.22.21.35.15;	author sturm;	state Exp;
branches;
next	;

1.1.6.1
date	2007.03.23.07.25.55;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.12
log
@
Unbreak autoconf check with clang by not using nested functions
@
text
@$OpenBSD: patch-configure_ac,v 1.11 2017/04/16 20:36:58 sthen Exp $
Index: configure.ac
--- configure.ac.orig
+++ configure.ac
@@@@ -100,9 +100,6 @@@@ AM_CONDITIONAL(SILC_X86_64, test x$cpu_x86_64 = xtrue)
 AM_CONDITIONAL(SILC_POWERPC, test x$cpu_ppc = xtrue)
 AM_CONDITIONAL(SILC_IA64, test x$cpu_ia64 = xtrue)
 
-# Control compiler optimizations
-CFLAGS=`echo $CFLAGS | sed 's/-O[ 0123456789s]*//g'`
-
 AC_PROG_CC
 AC_C_INLINE
 AC_C_CONST
@@@@ -169,12 +166,13 @@@@ AC_DEFUN([SILC_ADD_CFLAGS],
 # Function to check if compiler flag works, destination specifiable
 # Usage: SILC_ADD_CC_FLAGS(VAR, FLAGS, [ACTION-IF-FAILED])
 AC_DEFUN([SILC_ADD_CC_FLAGS],
-[ tmp_CFLAGS="$1_CFLAGS"
-  $1_CFLAGS="${$1_CFLAGS} $2"
+[ tmp_CFLAGS="$CFLAGS"
+  $CFLAGS="${$1_CFLAGS} $2"
   AC_MSG_CHECKING(whether $CC accepts $2 flag)
-  AC_TRY_LINK([], [], [AC_MSG_RESULT(yes)], [AC_MSG_RESULT(no)
-				       $1_CFLAGS="$tmp_CFLAGS"
+  AC_TRY_LINK([], [], [AC_MSG_RESULT(yes)
+      $1_CFLAGS="$CFLAGS"], [AC_MSG_RESULT(no)
 				       $3])
+  CFLAGS="$tmp_CFLAGS"
   unset tmp_CFLAGS
 ])
 
@@@@ -387,8 +385,7 @@@@ AC_TRY_COMPILE(
   [
     #include <stdarg.h>
     #include <stdlib.h>
-  ],
-  [
+
     int t(int x, ...)
     {
       va_list va, cp;
@@@@ -400,12 +397,11 @@@@ AC_TRY_COMPILE(
       va_end(cp);
       return 0;
     }
-    int main()
-    {
-      return t(0, 0xff11);
-    }
   ],
   [
+    return t(0, 0xff11);
+  ],
+  [
     AC_DEFINE([HAVE_VA_COPY], [], [HAVE_VA_COPY])
     AC_MSG_RESULT(yes)
     va_copy=true
@@@@ -422,8 +418,7 @@@@ if test x$va_copy = xfalse; then
   [
     #include <stdarg.h>
     #include <stdlib.h>
-  ],
-  [
+
     int t(int x, ...)
     {
       va_list va, cp;
@@@@ -435,12 +430,11 @@@@ if test x$va_copy = xfalse; then
       va_end(cp);
       return 0;
     }
-    int main()
-    {
-      return t(0, 0xff11);
-    }
   ],
   [
+    return t(0, 0xff11);
+  ],
+  [
     AC_DEFINE([HAVE___VA_COPY], [], [HAVE___VA_COPY])
     AC_MSG_RESULT(yes)
     va_copy=true
@@@@ -485,59 +479,9 @@@@ fi
 ## Compiler and compiler flag checks
 ##
 
-if test "$GCC"; then
-  # GCC specific options
-  if test "x$summary_debug" = "xyes"; then
-    SILC_ADD_CFLAGS(-g)
-  else
-    SILC_ADD_CFLAGS(-g)
-  fi
-  SILC_ADD_CFLAGS(-Wall -finline-functions)
-  SILC_ADD_CFLAGS(-Wno-pointer-sign)
-else
-  # Other compilers
-  case "$target" in
-    alpha*-dec-osf*)
-      SILC_ADD_CFLAGS(-g3)
-      ;;
-    mips*-sgi-irix*)
-      SILC_ADD_CFLAGS(-g3)
-      ;;
-    *)
-      SILC_ADD_CFLAGS(-g)
-      ;;
-  esac
+SILC_ADD_CFLAGS(-Wall -finline-functions)
+SILC_ADD_CFLAGS(-Wno-pointer-sign)
 
-  # Intel C++ Compiler needs -restrict
-  if test "x$CC" = "xicc"; then
-    SILC_ADD_CFLAGS(-restrict)
-  fi
-fi
-
-if test x$want_cc_optimizations = xtrue; then
-  if test "$GCC"; then
-    # GCC specific options
-    if test "x$summary_debug" = "xyes"; then
-      SILC_ADD_CFLAGS(-O)
-    else
-      SILC_ADD_CFLAGS(-O2)
-    fi
-  else
-    # Other compilers
-    case "$target" in
-      alpha*-dec-osf*)
-        SILC_ADD_CFLAGS(-O2, SILC_ADD_CFLAGS(-O))
-        ;;
-      mips*-sgi-irix*)
-        SILC_ADD_CFLAGS(-O2, SILC_ADD_CFLAGS(-O))
-        ;;
-      *)
-        SILC_ADD_CFLAGS(-O2, SILC_ADD_CFLAGS(-O))
-        ;;
-    esac
-  fi
-fi
-
 #
 # Workaround a bug in GCC 2.x which causes memory exhaustion
 # when compiling sha1 with optimizations on UltraSPARC.
@@@@ -630,8 +574,8 @@@@ if test -n "$with_silc_includes" || test -n "$with_sil
 
 else
   # pkg-config check
-  PKG_CHECK_MODULES(SILC, [silc >= 1.1], compile_libs=false, compile_libs=true)
-  PKG_CHECK_MODULES(SILCCLIENT, [silcclient >= 1.1.1], compile_libs=false, compile_libs=true)
+  #PKG_CHECK_MODULES(SILC, [silc >= 1.1], compile_libs=false, compile_libs=true)
+  #PKG_CHECK_MODULES(SILCCLIENT, [silcclient >= 1.1.1], compile_libs=false, compile_libs=true)
 
   if test x$compile_libs = xfalse; then
     LIBSUBDIR=
@@@@ -1314,7 +1258,7 @@@@ fi
 
 SILC_ADD_CC_FLAGS(SILC_CRYPTO, -fno-regmove)
 if test x$summary_debug = xno -a x$want_cc_optimizations = xtrue; then
-  SILC_ADD_CC_FLAGS(SILC_CRYPTO, -fomit-frame-pointer -O3)
+  SILC_ADD_CC_FLAGS(SILC_CRYPTO, -fomit-frame-pointer)
 fi
 
 AC_SUBST(SILC_CRYPTO_CFLAGS)
@@@@ -1350,7 +1294,6 @@@@ if test x$compile_libs = xtrue; then
 AC_MSG_NOTICE([configuring math library])
 
 if test x$want_cc_optimizations = xtrue; then
-  SILC_ADD_CC_FLAGS(MATH, -O3, SILC_ADD_CC_FLAGS(MATH, -O2))
   SILC_ADD_CC_FLAGS(MATH, -funroll-all-loops)
 fi
 if test x$enable_stack_trace != xyes; then
@


1.11
log
@Fix SILC_ADD_CC_FLAGS to actually test that the compiler flags work,
they were testing the wrong thing. silc-toolkit diff from espie,
ports diff for all 3 from Brad.
@
text
@d1 4
a4 3
$OpenBSD: patch-configure_ac,v 1.10 2017/04/16 10:38:10 sthen Exp $
--- configure.ac.orig	Tue May 13 02:47:22 2014
+++ configure.ac	Sun Apr 16 13:26:43 2017
d33 53
a85 1
@@@@ -485,59 +483,9 @@@@ fi
d147 1
a147 1
@@@@ -630,8 +578,8 @@@@ if test -n "$with_silc_includes" || test -n "$with_sil
d158 1
a158 1
@@@@ -1314,7 +1262,7 @@@@ fi
d167 1
a167 1
@@@@ -1350,7 +1298,6 @@@@ if test x$compile_libs = xtrue; then
@


1.10
log
@Remove the use of -fno-regmove to appease Clang.  From Brad.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.9 2014/07/16 16:15:32 brad Exp $
d3 1
a3 1
+++ configure.ac	Sat Apr 15 17:48:03 2017
d14 19
a32 1
@@@@ -485,59 +482,9 @@@@ fi
d94 1
a94 1
@@@@ -630,8 +577,8 @@@@ if test -n "$with_silc_includes" || test -n "$with_sil
d105 1
a105 3
@@@@ -1312,9 +1259,8 @@@@ case "$host_cpu" in
 esac
 fi
d107 1
a107 1
-SILC_ADD_CC_FLAGS(SILC_CRYPTO, -fno-regmove)
d114 1
a114 1
@@@@ -1350,7 +1296,6 @@@@ if test x$compile_libs = xtrue; then
@


1.9
log
@Update to silc-client 1.1.11.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.8 2013/11/04 21:50:22 brad Exp $
d3 1
a3 1
+++ configure.ac	Sat Jul 12 16:56:45 2014
d87 3
a89 1
@@@@ -1314,7 +1261,7 @@@@ fi
d91 1
a91 1
 SILC_ADD_CC_FLAGS(SILC_CRYPTO, -fno-regmove)
d98 1
a98 1
@@@@ -1350,7 +1297,6 @@@@ if test x$compile_libs = xtrue; then
@


1.8
log
@Respect CFLAGS throughout the whole build.

ok sthen@@
@
text
@d1 4
a4 4
$OpenBSD: patch-configure_ac,v 1.7 2009/08/01 19:24:34 sthen Exp $
--- configure.ac.orig	Sat Aug  1 02:53:41 2009
+++ configure.ac	Sun Aug 21 01:56:13 2011
@@@@ -97,9 +97,6 @@@@ AM_CONDITIONAL(SILC_X86_64, test x$cpu_x86_64 = xtrue)
d14 1
a14 1
@@@@ -471,59 +468,9 @@@@ fi
d76 1
a76 1
@@@@ -616,8 +563,8 @@@@ if test -n "$with_silc_includes" || test -n "$with_sil
d87 1
a87 1
@@@@ -1294,7 +1241,7 @@@@ fi
d96 1
a96 1
@@@@ -1330,7 +1277,6 @@@@ if test x$compile_libs = xtrue; then
@


1.7
log
@honour CFLAGS; from Brad.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.6 2009/08/01 12:58:06 sthen Exp $
d3 1
a3 1
+++ configure.ac	Sat Aug  1 12:15:39 2009
d87 17
@


1.6
log
@SECURITY update to 1.1.8, fixes a serious format string vulnerability.
From Brad.
@
text
@d1 76
a76 4
$OpenBSD: patch-configure_ac,v 1.5 2009/01/11 02:03:55 martynas Exp $
--- configure.ac.orig	Sat Aug  1 05:46:13 2009
+++ configure.ac	Sat Aug  1 05:46:45 2009
@@@@ -616,8 +616,8 @@@@ if test -n "$with_silc_includes" || test -n "$with_sil
@


1.5
log
@- update to silc-client-1.1.7
- remove --without-libtoolfix, since it does not exist;  sthen/brad
ok brad (maintainer), sthen@@;  also tested by Simon Kuhnle
@
text
@d1 4
a4 14
$OpenBSD: patch-configure_ac,v 1.4 2008/01/23 16:06:40 todd Exp $
--- configure.ac.orig	Sat Jan 10 18:11:36 2009
+++ configure.ac	Sat Jan 10 18:27:58 2009
@@@@ -50,6 +50,9 @@@@ case "$target" in
   *-*-netbsd*)
     check_threads=true
     ;;
+  *-*-openbsd*)
+    check_threads=true
+    ;;
   *-*-*bsd*)
     check_threads=false
     ;;
@@@@ -613,8 +616,8 @@@@ if test -n "$with_silc_includes" || test -n "$with_sil
@


1.4
log
@update to 1.1.3; works for me
from brad@@
@
text
@d1 14
a14 4
$OpenBSD: patch-configure_ac,v 1.3 2007/10/01 22:03:53 simon Exp $
--- configure.ac.orig	Tue Nov  6 09:45:06 2007
+++ configure.ac	Sat Nov 10 00:58:14 2007
@@@@ -613,8 +613,8 @@@@ if test -n "$with_silc_includes" || test -n "$with_sil
@


1.3
log
@update to version 1.12

with fixes from Simon Kunhle
from brad@@
@
text
@d1 4
a4 4
$OpenBSD: patch-configure_ac,v 1.2 2007/04/01 20:43:59 steven Exp $
--- configure.ac.orig	Thu Jun 28 12:54:19 2007
+++ configure.ac	Sat Jun 30 15:15:40 2007
@@@@ -605,8 +605,8 @@@@ if test -n "$with_silc_includes" || test -n "$with_sil
@


1.2
log
@USE_LIBTOOL, disable-shared, regen patches
@
text
@d1 4
a4 4
$OpenBSD: patch-configure_ac,v 1.1 2006/10/03 18:34:50 brad Exp $
--- configure.ac.orig	Wed Mar  7 20:02:19 2007
+++ configure.ac	Sun Apr  1 22:30:31 2007
@@@@ -455,8 +455,9 @@@@ if test -n "$with_silc_includes" || test -n "$with_sil
d8 4
a11 5
-  PKG_CHECK_MODULES(SILC, silc, compile_libs=false, compile_libs=true)
-  PKG_CHECK_MODULES(SILCCLIENT, silcclient, compile_libs=false, compile_libs=true)
+  #PKG_CHECK_MODULES(SILC, silc, compile_libs=false, compile_libs=true)
+  #PKG_CHECK_MODULES(SILCCLIENT, silcclient, compile_libs=false, compile_libs=true)
+  compile_libs=true
@


1.1
log
@upgrade to silc-client 1.0.3

From nikns <nikns at secure dot lv>
@
text
@d1 4
a4 4
$OpenBSD$
--- configure.ac.orig	Fri Jan  6 08:46:28 2006
+++ configure.ac	Tue Oct  3 14:20:37 2006
@@@@ -455,8 +455,9 @@@@ if test -n "$with_silc_includes" || test
@


1.1.6.1
log
@MFC:
- security update to silc-client-1.0.4.1;
- disable perl (not usable);
- unmark NO_SHARED_ARCHS;
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.1 2006/10/03 18:34:50 brad Exp $
@


1.1.4.1
log
@MFC:
- security update to silc-client-1.0.4.1;
- disable perl (not usable);
- unmark NO_SHARED_ARCHS;
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_ac,v 1.1 2006/10/03 18:34:50 brad Exp $
@

