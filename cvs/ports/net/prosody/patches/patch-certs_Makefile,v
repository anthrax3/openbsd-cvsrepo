head	1.6;
access;
symbols
	OPENBSD_6_2:1.6.0.2
	OPENBSD_6_2_BASE:1.6
	OPENBSD_6_1:1.5.0.6
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.4
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.4.0.6
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.3.0.2
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.2.0.6
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.4
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2;
locks; strict;
comment	@# @;


1.6
date	2017.05.14.16.36.55;	author danj;	state Exp;
branches;
next	1.5;
commitid	flPmDzhr6w8AOahN;

1.5
date	2016.01.11.12.11.36;	author sthen;	state Exp;
branches;
next	1.4;
commitid	lqi9QVbsTGPM6q0J;

1.4
date	2015.01.15.11.13.21;	author edd;	state Exp;
branches
	1.4.6.1;
next	1.3;
commitid	3nclN6FbuEHW7Ydk;

1.3
date	2014.04.23.17.59.01;	author jca;	state Exp;
branches;
next	1.2;

1.2
date	2012.10.08.09.11.35;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2012.10.05.14.38.09;	author jasper;	state Exp;
branches;
next	;

1.4.6.1
date	2016.01.11.12.15.57;	author jasper;	state Exp;
branches;
next	;
commitid	mKceXs40bNc6xneR;


desc
@@


1.6
log
@Update to prosody-0.9.12

From Henrik Friedrichsen (maintainer)
@
text
@$OpenBSD: patch-certs_Makefile,v 1.5 2016/01/11 12:11:36 sthen Exp $
--- certs/Makefile.orig	Mon Dec  5 13:54:23 2016
+++ certs/Makefile	Mon Mar 27 19:18:16 2017
@@@@ -2,13 +2,13 @@@@
 keysize=2048
 
 # How to:
-# First, `make yourhost.cnf` which creates a openssl config file.
+# First, `${MAKE_PROGRAM} yourhost.cnf` which creates a openssl config file.
 # Then edit this file and fill in the details you want it to have,
 # and add or change hosts and components it should cover.
-# Then `make yourhost.key` to create your private key, you can
+# Then `${MAKE_PROGRAM} yourhost.key` to create your private key, you can
 # include keysize=number to change the size of the key.
-# Then you can either `make yourhost.csr` to generate a certificate
-# signing request that you can submit to a CA, or `make yourhost.crt`
+# Then you can either `${MAKE_PROGRAM} yourhost.csr` to generate a certificate
+# signing request that you can submit to a CA, or `${MAKE_PROGRAM} yourhost.crt`
 # to generate a self signed certificate.
 
 .PRECIOUS: %.cnf %.key
@@@@ -28,3 +28,5 @@@@ keysize=2048
 %.key:
 	umask 0077 && openssl genrsa -out $@@ $(keysize)
 	@@chmod 400 $@@
+	@@chown _prosody $@@ || \
+		echo "***WARNING***: You will need to 'chown _prosody $@@'"
@


1.5
log
@security update to Prosody 0.9.9, from maintainer Henrik Friedrichsen
(plus, compared to Henrik's diff, reinstate some make/MAKE_PROGRAM patches)

- mod_http_files could serve requests outside of the configured public root
- server-to-server dialback authentication (mod_dialback) weak RNG
@
text
@d1 3
a3 3
$OpenBSD: patch-certs_Makefile,v 1.4 2015/01/15 11:13:21 edd Exp $
--- certs/Makefile.orig	Fri Jan  8 13:07:07 2016
+++ certs/Makefile	Mon Jan 11 12:01:57 2016
d22 1
a22 2
@@@@ -27,4 +27,6 @@@@ keysize=2048
 
d25 1
a25 2
-	@@chmod 400 $@@ -c
+	@@chmod 400 $@@
@


1.4
log
@Update to prosody-0.9.7.

MAINTAINER has tested and is happy. Input from sthen.

OK sthen@@
@
text
@d1 3
a3 3
$OpenBSD: patch-certs_Makefile,v 1.3 2014/04/23 17:59:01 jca Exp $
--- certs/Makefile.orig	Fri Oct 24 23:30:55 2014
+++ certs/Makefile	Mon Jan 12 23:30:53 2015
d22 2
a23 1
@@@@ -28,3 +28,5 @@@@ keysize=2048
d25 3
a27 2
 	openssl genrsa $(keysize) > $@@
 	@@chmod 400 $@@
@


1.4.6.1
log
@security update to Prosody 0.9.9, from maintainer Henrik Friedrichsen
(plus, compared to Henrik's diff, reinstate some make/MAKE_PROGRAM patches)

- mod_http_files could serve requests outside of the configured public root
- server-to-server dialback authentication (mod_dialback) weak RNG
@
text
@d1 3
a3 3
$OpenBSD: patch-certs_Makefile,v 1.5 2016/01/11 12:11:36 sthen Exp $
--- certs/Makefile.orig	Fri Jan  8 13:07:07 2016
+++ certs/Makefile	Mon Jan 11 12:01:57 2016
d22 1
a22 2
@@@@ -27,4 +27,6 @@@@ keysize=2048
 
d24 2
a25 3
 	umask 0077 && openssl genrsa -out $@@ $(keysize)
-	@@chmod 400 $@@ -c
+	@@chmod 400 $@@
@


1.3
log
@Update to prosody-0.9.4, from Henrik Friedrichsen <henrik@@diff.cc> (new
maintainer) and a few tweaks by me.
@
text
@d1 3
a3 3
$OpenBSD$
--- certs/Makefile.orig	Thu Feb 27 20:04:09 2014
+++ certs/Makefile	Thu Feb 27 20:05:11 2014
d22 6
@


1.2
log
@- fixup the commands in the cert/Makefile
- adjust permissions on the default certificates so that prosody can use them

ok MAINTAINER
@
text
@d1 4
a4 11
$OpenBSD: patch-certs_Makefile,v 1.1 2012/10/05 14:38:09 jasper Exp $

- use '.crt' as the certificate extension
- set correct Make program for this GNU Makefile
- make sure the permissions are restricted for the .key files

--- certs/Makefile.orig	Sun Jun 12 23:21:39 2011
+++ certs/Makefile	Fri Oct  5 17:08:16 2012
@@@@ -1,14 +1,14 @@@@
-.DEFAULT: localhost.cert
+.DEFAULT: localhost.crt
d16 1
a16 1
-# signing request that you can submit to a CA, or `make yourhost.cert`
a21 14
@@@@ -18,7 +18,7 @@@@ keysize=2048
 	openssl req -new -key $(lastword $^) -out $@@ -utf8 -config $(firstword $^)
 
 # Self signed
-%.cert: %.cnf %.key
+%.crt: %.cnf %.key
 	openssl req -new -x509 -nodes -key $(lastword $^) -days 365 \
 		-sha1 -out $@@ -utf8 -config $(firstword $^)
 
@@@@ -28,3 +28,4 @@@@ keysize=2048
 %.key:
 	openssl genrsa $(keysize) > $@@
 	@@chmod 400 $@@
+	@@chown _prosody $@@
@


1.1
log
@  - Use the more common '.crt' extension for certificates and fix
      an inconsistency along the way.

      ok MAINTAINER
@
text
@d1 9
a9 4
$OpenBSD$
--- certs/Makefile.orig	Fri Oct  5 16:17:36 2012
+++ certs/Makefile	Fri Oct  5 16:17:56 2012
@@@@ -1,4 +1,4 @@@@
d15 6
a20 2
@@@@ -8,7 +8,7 @@@@ keysize=2048
 # Then `make yourhost.key` to create your private key, you can
d22 1
a22 1
 # Then you can either `make yourhost.csr` to generate a certificate
d24 2
a25 1
+# signing request that you can submit to a CA, or `make yourhost.crt`
d38 5
@

