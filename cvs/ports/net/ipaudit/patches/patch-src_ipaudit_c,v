head	1.3;
access;
symbols
	OPENBSD_6_0:1.3.0.2
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.2.0.22
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.24
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.20
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.18
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.16
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.14
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.12
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.10
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.8
	OPENBSD_5_0:1.2.0.6
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.4
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.1.0.6
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.4
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.2
	OPENBSD_4_5_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2016.03.17.19.52.40;	author naddy;	state Exp;
branches;
next	1.2;
commitid	vJszzPtC5iQR3Bk0;

1.2
date	2010.07.10.23.18.58;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2009.01.27.01.01.16;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.3
log
@fix errno declaration
@
text
@$OpenBSD: patch-src_ipaudit_c,v 1.2 2010/07/10 23:18:58 naddy Exp $
--- src/ipaudit.c.orig	Thu Jan 25 22:04:00 2001
+++ src/ipaudit.c	Thu Mar 17 17:34:39 2016
@@@@ -40,6 +40,9 @@@@ Include Files
 #include <stdio.h>
 #include <stdlib.h>
 #include <sys/types.h>
+#include <sys/socket.h>
+#include <net/if.h>
+#include <errno.h>
 #include <string.h>
 #include <pcap.h>
 #include <signal.h>
@@@@ -50,7 +53,13 @@@@ Include Files
 #include <netinet/in.h>
 #include "hash.h"
 
+#ifdef DLT_PFLOG
+#include <net/if_pflog.h>
+#endif
 
+#ifdef DLT_ENC
+#include <net/if_enc.h>
+#endif
 
 /*
 ------------------------------------------------------------------------
@@@@ -217,7 +226,6 @@@@ typedef struct {
 Global variables
 ------------------------------------------------------------------------
 */
-extern int errno;
 extern char pcap_version[];
 
 
@@@@ -434,6 +442,16 @@@@ if (debug_m) {
 				printf ("DataLinkType = %s\n", "DLT_RAW"); break;
 			case DLT_ATM_RFC1483: 
 				printf ("DataLinkType = %s\n", "DLT_ATM_RFC1483"); break;
+			case DLT_LOOP:
+				printf ("DataLinkType = %s\n", "DLT_LOOP"); break;
+			case DLT_ENC:
+				printf ("DataLinkType = %s\n", "DLT_ENC"); break;
+			case DLT_PPP_ETHER: 
+				printf ("DataLinkType = %s\n", "DLT_PPP_ETHER"); break;
+			case DLT_PFLOG: 
+				printf ("DataLinkType = %s\n", "DLT_PFLOG"); break;
+			case DLT_PFSYNC: 
+				printf ("DataLinkType = %s\n", "DLT_PFSYNC"); break;
 			default:
 				printf ("DataLinkType = %d\n", DataLinkType);
 		}
@@@@ -1278,6 +1296,19 @@@@ int get_packetoffset (int DataLinkType) {
 		case DLT_NULL:
 			PacketOffset = POFF_NULL;
 			break;
+		case DLT_LOOP:
+		case DLT_PFSYNC:
+			PacketOffset = 4;
+			break;
+		case DLT_PPP_ETHER:
+			PacketOffset = 8;
+			break;
+		case DLT_ENC:
+			PacketOffset = ENC_HDRLEN;
+                        break;
+		case DLT_PFLOG:
+			PacketOffset = PFLOG_HDRLEN;
+                        break;
 		/*  Currently only know ethernet, ppp, for others we guess  */
 		default:
 			PacketOffset = 0;
@


1.2
log
@fix after removal of DLT_OLD_PFLOG; from Markus Lude <markus.lude@@gmx.de>
@
text
@d1 1
a1 1
$OpenBSD: patch-src_ipaudit_c,v 1.1 2009/01/27 01:01:16 sthen Exp $
d3 2
a4 2
+++ src/ipaudit.c	Thu Jul  8 15:58:01 2010
@@@@ -40,6 +40,8 @@@@ Include Files
d10 1
d14 1
a14 1
@@@@ -50,7 +52,13 @@@@ Include Files
d28 8
@


1.1
log
@remove non-useful MESSAGE, add header lengths for additional link types
(including DLT_ENC requested by Rod Whitworth a while ago), regen PLIST
and bump.
@
text
@d1 3
a3 3
$OpenBSD$
--- src/ipaudit.c.orig	Thu Jan 25 21:04:00 2001
+++ src/ipaudit.c	Tue Jan 27 00:36:02 2009
d27 1
a27 1
@@@@ -434,6 +442,18 @@@@ if (debug_m) {
a36 2
+			case DLT_OLD_PFLOG: 
+				printf ("DataLinkType = %s\n", "DLT_OLD_PFLOG"); break;
d44 1
a44 1
@@@@ -1278,6 +1298,22 @@@@ int get_packetoffset (int DataLinkType) {
a53 3
+			break;
+		case DLT_OLD_PFLOG:
+			PacketOffset = 28;
@

