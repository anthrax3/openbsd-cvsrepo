head	1.7;
access;
symbols
	OPENBSD_2_6:1.5.0.2
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.4.0.2
	OPENBSD_2_5_BASE:1.4
	OPENBSD_2_4:1.2.0.2
	OPENBSD_2_4_BASE:1.2
	form_980616:1.1.1.1
	form:1.1.1;
locks; strict;
comment	@# @;


1.7
date	99.11.08.15.54.42;	author turan;	state dead;
branches;
next	1.6;

1.6
date	99.10.27.22.54.43;	author brad;	state Exp;
branches;
next	1.5;

1.5
date	99.08.23.00.53.25;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	99.03.12.15.23.34;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	99.02.22.05.13.33;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	98.07.02.07.42.41;	author form;	state Exp;
branches;
next	1.1;

1.1
date	98.06.16.07.05.33;	author form;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.06.16.07.05.33;	author form;	state Exp;
branches;
next	;


desc
@@


1.7
log
@nuke insecure proftpd port.  ok'd by maint.
@
text
@--- modules/mod_auth.c.orig	Sat Oct 23 01:18:49 1999
+++ modules/mod_auth.c	Wed Oct 27 17:36:14 1999
@@@@ -70,7 +70,7 @@@@
 		      "closing control connection.",
                       TimeoutLogin);
   
-  main_exit((void*) LOG_NOTICE, "FTP login timed out, disconnected.",
+  main_exit((void*) LOG_INFO, "FTP login timed out, disconnected.",
 	    (void*) 0, NULL);
   
 /* should never be reached */
@@@@ -784,9 +784,9 @@@@
     resolve_anonymous_dirs(c->subset);
 
   if(c)
-    log_auth(LOG_NOTICE, "ANON %s: Login successful.", origuser);
+    log_auth(LOG_INFO, "ANON %s: Login successful.", origuser);
   else
-    log_auth(LOG_NOTICE,"USER %s: Login successful.", origuser);
+    log_auth(LOG_INFO,"USER %s: Login successful.", origuser);
 
   /* Write the login to wtmp.  This must be done here because we won't
    * have access after we give up root.  This can result in falsified
@@@@ -1146,7 +1146,7 @@@@
 			"Too many users in your class, "
 			"please try again later.");
 	
-	log_auth(LOG_NOTICE, "Connection refused (max clients for class %s).",
+	log_auth(LOG_INFO, "Connection refused (max clients for class %s).",
 		 session.class->name);
 	
 	end_login(0);
@@@@ -1179,7 +1179,7 @@@@
       send_response(R_530,"%s",
                     sreplace(cmd->tmp_pool,maxstr,"%m",maxn,NULL));
 
-      log_auth(LOG_NOTICE, "Connection refused (max clients per host %d).",
+      log_auth(LOG_INFO, "Connection refused (max clients per host %d).",
 	       max);
       
       end_login(0);
@@@@ -1203,7 +1203,7 @@@@
     if(cur >= max) {
       send_response(R_530, "%s",
 		    sreplace(cmd->tmp_pool, maxstr, "%m", maxn, NULL));
-      log_auth(LOG_NOTICE, "Connection refused (max clients %d).", max);
+      log_auth(LOG_INFO, "Connection refused (max clients %d).", max);
       end_login(0);
     }
 
@


1.6
log
@upgrade to proftpd 1.2.0pre9
@
text
@@


1.5
log
@upgrade to proftpd 1.2.0pre3a
@
text
@d1 12
a12 12
--- modules/mod_auth.c.orig	Sun Aug 22 20:23:51 1999
+++ modules/mod_auth.c	Sun Aug 22 20:23:53 1999
@@@@ -69,7 +69,7 @@@@
 		  (void*)0,NULL);
 
 /*
-  schedule(main_exit,0,(void*)LOG_NOTICE,"FTP login timed out, disconnected.",
+  schedule(main_exit,0,(void*)LOG_INFO,"FTP login timed out, disconnected.",
            (void*)0,NULL);
   remove_timer(TIMER_IDLE,ANY_MODULE);
   remove_timer(TIMER_NOXFER,ANY_MODULE);
@@@@ -787,13 +787,13 @@@@
d16 2
a17 6
-    log_auth(LOG_NOTICE,"ANONYMOUS FTP login as '%s' from %s [%s] to %s:%i",
+    log_auth(LOG_INFO,"ANONYMOUS FTP login as '%s' from %s [%s] to %s:%i",
       origuser,session.c->remote_name,
       inet_ascii(p,session.c->remote_ipaddr),
       inet_ascii(p,session.c->local_ipaddr),
       session.c->local_port);
d19 2
a20 8
-    log_auth(LOG_NOTICE,"FTP login as '%s' from %s [%s] to %s:%i",
+    log_auth(LOG_INFO,"FTP login as '%s' from %s [%s] to %s:%i",
       origuser,session.c->remote_name,
       inet_ascii(p,session.c->remote_ipaddr),
       inet_ascii(p,session.c->local_ipaddr),
@@@@ -1155,7 +1155,7 @@@@
       send_response(R_530,"%s",
                     sreplace(cmd->tmp_pool,maxstr,"%m",maxn,NULL));
d22 11
a32 5
-      log_auth(LOG_NOTICE,"connection refused (max clients per host %d)",
+      log_auth(LOG_INFO,"connection refused (max clients per host %d)",
                max);
       end_login(0);
     }
d37 11
a47 3
-      log_auth(LOG_NOTICE,"connection refused (max clients %d)",
+      log_auth(LOG_INFO,"connection refused (max clients %d)",
                max);
a49 1
@@@@ -1266,7 +1266,7 @@@@
a50 7
     if(++auth_tries >= max) {
       send_response(R_530,"Login incorrect");
-      log_auth(LOG_NOTICE,"Maximum login attempts exceeded from %s [%s] to %s:%i",
+      log_auth(LOG_INFO,"Maximum login attempts exceeded from %s [%s] to %s:%i",
                session.c->remote_name,
                inet_ascii(cmd->tmp_pool,session.c->remote_ipaddr),
 	       inet_ascii(cmd->tmp_pool,session.c->local_ipaddr),
@


1.4
log
@upgrade to ProFTPD 1.2.0pr3
@
text
@d1 2
a2 2
--- modules/mod_auth.c.orig	Fri Mar 12 10:05:47 1999
+++ modules/mod_auth.c	Fri Mar 12 10:11:32 1999
d28 1
a28 1
@@@@ -1156,7 +1156,7 @@@@
d37 1
a37 1
@@@@ -1180,7 +1180,7 @@@@
d46 1
a46 1
@@@@ -1267,7 +1267,7 @@@@
@


1.3
log
@upgrade to proftpd-1.2.0pre2
@
text
@d1 6
a6 6
--- modules/mod_auth.c.orig	Sat Oct 17 22:24:41 1998
+++ modules/mod_auth.c	Mon Dec 14 15:26:02 1998
@@@@ -61,7 +61,7 @@@@
   /* Is this the proper behavior when timing out? */
   send_response_async(R_421,"Login Timeout (%d seconds): closing control connection.",
                       TimeoutLogin);
d12 1
a12 1
@@@@ -763,13 +763,13 @@@@
d28 1
a28 1
@@@@ -1132,7 +1132,7 @@@@
d37 1
a37 1
@@@@ -1156,7 +1156,7 @@@@
d46 1
a46 1
@@@@ -1243,7 +1243,7 @@@@
@


1.2
log
@fix setre[gu]id() problem
@
text
@d1 54
a54 88
*** modules/mod_auth.c.orig	Tue May 26 21:24:39 1998
--- modules/mod_auth.c	Thu Jul  2 14:33:59 1998
***************
*** 177,183 ****
    /* Is this the proper behavior when timing out? */
    send_response_async(R_421,"Login Timeout (%d seconds): closing control connection.",
                        TimeoutLogin);
!   schedule(main_exit,0,(void*)LOG_NOTICE,"FTP login timed out, disconnected.",
             (void*)0,NULL);
    remove_timer(TIMER_IDLE,ANY_MODULE);
    remove_timer(TIMER_NOXFER,ANY_MODULE);
--- 177,183 ----
    /* Is this the proper behavior when timing out? */
    send_response_async(R_421,"Login Timeout (%d seconds): closing control connection.",
                        TimeoutLogin);
!   schedule(main_exit,0,(void*)LOG_INFO,"FTP login timed out, disconnected.",
             (void*)0,NULL);
    remove_timer(TIMER_IDLE,ANY_MODULE);
    remove_timer(TIMER_NOXFER,ANY_MODULE);
***************
*** 763,772 ****
    }
  
    if(c)
!     log_auth(LOG_NOTICE,"ANONYMOUS FTP login as '%s' from %s [%s]",
      origuser,session.c->remote_name,inet_ntoa(*session.c->remote_ipaddr));
    else
!     log_auth(LOG_NOTICE,"FTP login as '%s' from %s [%s]",
      origuser,session.c->remote_name,inet_ntoa(*session.c->remote_ipaddr));
  
    session.user = pstrdup(permanent_pool,auth_map_uid(pw->pw_uid));
--- 763,772 ----
    }
  
    if(c)
!     log_auth(LOG_INFO,"ANONYMOUS FTP login as '%s' from %s [%s]",
      origuser,session.c->remote_name,inet_ntoa(*session.c->remote_ipaddr));
    else
!     log_auth(LOG_INFO,"FTP login as '%s' from %s [%s]",
      origuser,session.c->remote_name,inet_ntoa(*session.c->remote_ipaddr));
  
    session.user = pstrdup(permanent_pool,auth_map_uid(pw->pw_uid));
***************
*** 869,881 ****
      end_login(1);
    }
  
!   if(setregid(pw->pw_gid,pw->pw_gid) == -1 ||
!      setreuid(pw->pw_uid,pw->pw_uid) == -1) {
  
      PRIVS_RELINQUISH
  
      send_response(R_530,"Unable to set user privileges.");
!     log_pri(LOG_ERR,"%s setregid() or setreuid(): %s",
              session.user,strerror(errno));
  
      end_login(1);
--- 869,881 ----
      end_login(1);
    }
  
!   if(setgid(pw->pw_gid) == -1 ||
!      setuid(pw->pw_uid) == -1) {
  
      PRIVS_RELINQUISH
  
      send_response(R_530,"Unable to set user privileges.");
!     log_pri(LOG_ERR,"%s setgid() or setuid(): %s",
              session.user,strerror(errno));
  
      end_login(1);
***************
*** 987,993 ****
        send_response(R_530,"%s",
                      sreplace(cmd->tmp_pool,maxstr,"%m",maxn,NULL));
  
!       log_auth(LOG_NOTICE,"connection refused (max clients %d)",
                 max);
        end_login(0);
      }
--- 987,993 ----
        send_response(R_530,"%s",
                      sreplace(cmd->tmp_pool,maxstr,"%m",maxn,NULL));
  
!       log_auth(LOG_INFO,"connection refused (max clients %d)",
                 max);
        end_login(0);
      }
@


1.1
log
@Initial revision
@
text
@d1 88
a88 33
--- modules//mod_auth.c.orig	Sun Jun  7 16:17:57 1998
+++ modules/mod_auth.c	Sun Jun  7 16:21:29 1998
@@@@ -177,7 +177,7 @@@@
   /* Is this the proper behavior when timing out? */
   send_response_async(R_421,"Login Timeout (%d seconds): closing control connection.",
                       TimeoutLogin);
-  schedule(main_exit,0,(void*)LOG_NOTICE,"FTP login timed out, disconnected.",
+  schedule(main_exit,0,(void*)LOG_INFO,"FTP login timed out, disconnected.",
            (void*)0,NULL);
   remove_timer(TIMER_IDLE,ANY_MODULE);
   remove_timer(TIMER_NOXFER,ANY_MODULE);
@@@@ -763,10 +763,10 @@@@
   }
 
   if(c)
-    log_auth(LOG_NOTICE,"ANONYMOUS FTP login as '%s' from %s [%s]",
+    log_auth(LOG_INFO,"ANONYMOUS FTP login as '%s' from %s [%s]",
     origuser,session.c->remote_name,inet_ntoa(*session.c->remote_ipaddr));
   else
-    log_auth(LOG_NOTICE,"FTP login as '%s' from %s [%s]",
+    log_auth(LOG_INFO,"FTP login as '%s' from %s [%s]",
     origuser,session.c->remote_name,inet_ntoa(*session.c->remote_ipaddr));
 
   session.user = pstrdup(permanent_pool,auth_map_uid(pw->pw_uid));
@@@@ -987,7 +987,7 @@@@
       send_response(R_530,"%s",
                     sreplace(cmd->tmp_pool,maxstr,"%m",maxn,NULL));
 
-      log_auth(LOG_NOTICE,"connection refused (max clients %d)",
+      log_auth(LOG_INFO,"connection refused (max clients %d)",
                max);
       end_login(0);
     }
@


1.1.1.1
log
@proftpd 1.0.3, apache-like configurable ftp daemon
@
text
@@
