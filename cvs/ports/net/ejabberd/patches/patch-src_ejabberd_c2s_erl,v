head	1.1;
access;
symbols
	OPENBSD_6_0:1.1.0.12
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.8
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.10
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.6
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_6:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2014.10.27.15.44.20;	author jasper;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;
commitid	lj3wWqiFAd0seny2;

1.1.2.1
date	2014.10.27.15.47.04;	author jasper;	state Exp;
branches;
next	;
commitid	BO38BxzrALNAxd8n;

1.1.4.1
date	2014.10.27.15.47.11;	author jasper;	state Exp;
branches;
next	;
commitid	953fPx5iBQb9D0ay;


desc
@@


1.1
log
@Security fix for CVE-2014-8760

ok MAINTAINER
@
text
@$OpenBSD$

Security fix for CVE-2014-8760
https://github.com/processone/ejabberd/commit/7bdc1151b11d26d33649c5cce2817b74a4f231a8

--- src/ejabberd_c2s.erl.orig	Tue Feb  5 17:22:34 2013
+++ src/ejabberd_c2s.erl	Mon Oct 27 15:51:33 2014
@@@@ -615,7 +615,7 @@@@ wait_for_feature_request({xmlstreamelement, El}, State
     TLSRequired = StateData#state.tls_required,
     SockMod = (StateData#state.sockmod):get_sockmod(StateData#state.socket),
     case {xml:get_attr_s("xmlns", Attrs), Name} of
-	{?NS_SASL, "auth"} when not ((SockMod == gen_tcp) and TLSRequired) ->
+	{?NS_SASL, "auth"} when TLSEnabled or not TLSRequired ->
 	    Mech = xml:get_attr_s("mechanism", Attrs),
 	    ClientIn = jlib:decode_base64(xml:get_cdata(Els)),
 	    case cyrsasl:server_start(StateData#state.sasl_state,
@@@@ -722,7 +722,7 @@@@ wait_for_feature_request({xmlstreamelement, El}, State
 	    end;
 	_ ->
 	    if
-		(SockMod == gen_tcp) and TLSRequired ->
+		TLSRequired and not TLSEnabled ->
 		    Lang = StateData#state.lang,
 		    send_element(StateData, ?POLICY_VIOLATION_ERR(
 					       Lang,
@


1.1.4.1
log
@Security fix for CVE-2014-8760

ok maintainer
@
text
@d1 1
a1 1
$OpenBSD: patch-src_ejabberd_c2s_erl,v 1.1 2014/10/27 15:44:20 jasper Exp $
@


1.1.2.1
log
@Security fix for CVE-2014-8760

ok maintainer
@
text
@d1 1
a1 1
$OpenBSD: patch-src_ejabberd_c2s_erl,v 1.1 2014/10/27 15:44:20 jasper Exp $
@

