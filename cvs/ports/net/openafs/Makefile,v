head	1.59;
access;
symbols
	OPENBSD_6_1:1.59.0.2
	OPENBSD_6_1_BASE:1.59
	OPENBSD_6_0:1.58.0.2
	OPENBSD_6_0_BASE:1.58
	OPENBSD_5_9:1.55.0.2
	OPENBSD_5_9_BASE:1.55
	OPENBSD_5_8:1.54.0.4
	OPENBSD_5_8_BASE:1.54
	OPENBSD_5_7:1.53.0.2
	OPENBSD_5_7_BASE:1.53
	OPENBSD_5_6:1.52.0.2
	OPENBSD_5_6_BASE:1.52
	OPENBSD_5_5:1.51.0.2
	OPENBSD_5_5_BASE:1.51
	OPENBSD_5_4:1.50.0.2
	OPENBSD_5_4_BASE:1.50
	OPENBSD_5_3:1.45.0.2
	OPENBSD_5_3_BASE:1.45
	OPENBSD_5_2:1.42.0.2
	OPENBSD_5_2_BASE:1.42
	OPENBSD_5_1_BASE:1.39
	OPENBSD_5_1:1.39.0.2
	OPENBSD_5_0:1.37.0.2
	OPENBSD_5_0_BASE:1.37
	OPENBSD_4_9:1.34.0.2
	OPENBSD_4_9_BASE:1.34
	OPENBSD_4_8:1.32.0.2
	OPENBSD_4_8_BASE:1.32
	OPENBSD_4_7:1.30.0.2
	OPENBSD_4_7_BASE:1.30
	OPENBSD_4_6:1.28.0.2
	OPENBSD_4_6_BASE:1.28
	OPENBSD_4_5:1.24.0.2
	OPENBSD_4_5_BASE:1.24
	OPENBSD_4_4:1.19.0.2
	OPENBSD_4_4_BASE:1.19
	OPENBSD_4_3:1.16.0.2
	OPENBSD_4_3_BASE:1.16
	OPENBSD_4_2:1.12.0.2
	OPENBSD_4_2_BASE:1.12
	OPENBSD_4_1:1.11.0.2
	OPENBSD_4_1_BASE:1.11
	OPENBSD_4_0:1.10.0.2
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.9.0.2
	OPENBSD_3_9_BASE:1.9
	openafs-2006_01_30:1.1.1.1
	openafs:1.1.1;
locks; strict;
comment	@# @;


1.59
date	2017.03.05.15.22.00;	author naddy;	state Exp;
branches;
next	1.58;
commitid	HoJq7HeImRZ4hAiw;

1.58
date	2016.07.04.07.48.23;	author jasper;	state Exp;
branches;
next	1.57;
commitid	DMjIxt9ngYKdJxW0;

1.57
date	2016.03.16.21.19.38;	author naddy;	state Exp;
branches;
next	1.56;
commitid	eS3Ayl3CL8hkKETd;

1.56
date	2016.03.11.20.28.29;	author naddy;	state Exp;
branches;
next	1.55;
commitid	UYLP8TE6V7RS2GhJ;

1.55
date	2015.11.09.22.45.07;	author sthen;	state Exp;
branches
	1.55.2.1;
next	1.54;
commitid	ZyZv3nMoccgCuz4O;

1.54
date	2015.06.19.11.27.52;	author sthen;	state Exp;
branches;
next	1.53;
commitid	ghCdNPLorBchcTlB;

1.53
date	2015.01.02.15.16.12;	author naddy;	state Exp;
branches;
next	1.52;
commitid	rca25lsZgUS0OA1p;

1.52
date	2014.07.16.14.42.49;	author naddy;	state Exp;
branches;
next	1.51;
commitid	Kgsjsb3WLZWYt8Oy;

1.51
date	2014.01.12.14.58.30;	author naddy;	state Exp;
branches;
next	1.50;

1.50
date	2013.07.07.21.33.16;	author naddy;	state Exp;
branches;
next	1.49;

1.49
date	2013.06.18.11.22.23;	author ajacoutot;	state Exp;
branches;
next	1.48;

1.48
date	2013.06.17.19.29.40;	author ajacoutot;	state Exp;
branches;
next	1.47;

1.47
date	2013.05.12.17.32.10;	author rpe;	state Exp;
branches;
next	1.46;

1.46
date	2013.03.11.11.35.50;	author espie;	state Exp;
branches;
next	1.45;

1.45
date	2013.02.09.14.49.52;	author sthen;	state Exp;
branches;
next	1.44;

1.44
date	2013.02.01.17.15.01;	author naddy;	state Exp;
branches;
next	1.43;

1.43
date	2013.02.01.09.48.38;	author brad;	state Exp;
branches;
next	1.42;

1.42
date	2012.06.21.13.54.14;	author sthen;	state Exp;
branches;
next	1.41;

1.41
date	2012.06.04.20.20.07;	author pascal;	state Exp;
branches;
next	1.40;

1.40
date	2012.04.28.10.52.08;	author ajacoutot;	state Exp;
branches;
next	1.39;

1.39
date	2012.01.13.00.23.29;	author naddy;	state Exp;
branches;
next	1.38;

1.38
date	2011.11.16.00.20.09;	author sthen;	state Exp;
branches;
next	1.37;

1.37
date	2011.07.18.19.04.20;	author naddy;	state Exp;
branches;
next	1.36;

1.36
date	2011.06.02.13.41.40;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2011.03.02.10.38.03;	author jasper;	state Exp;
branches;
next	1.34;

1.34
date	2011.01.15.01.19.35;	author naddy;	state Exp;
branches
	1.34.2.1;
next	1.33;

1.33
date	2010.11.15.08.11.17;	author jasper;	state Exp;
branches;
next	1.32;

1.32
date	2010.07.24.23.01.56;	author naddy;	state Exp;
branches;
next	1.31;

1.31
date	2010.07.12.22.07.39;	author sthen;	state Exp;
branches;
next	1.30;

1.30
date	2010.01.29.15.53.19;	author naddy;	state Exp;
branches;
next	1.29;

1.29
date	2009.09.07.04.34.54;	author todd;	state Exp;
branches;
next	1.28;

1.28
date	2009.06.25.01.09.15;	author jolan;	state Exp;
branches;
next	1.27;

1.27
date	2009.06.18.16.18.12;	author todd;	state Exp;
branches;
next	1.26;

1.26
date	2009.03.28.16.11.48;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2009.03.26.21.28.47;	author todd;	state Exp;
branches;
next	1.24;

1.24
date	2008.10.24.19.59.18;	author todd;	state Exp;
branches;
next	1.23;

1.23
date	2008.10.21.02.57.51;	author todd;	state Exp;
branches;
next	1.22;

1.22
date	2008.10.12.17.31.17;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2008.10.12.00.12.07;	author todd;	state Exp;
branches;
next	1.20;

1.20
date	2008.10.08.15.45.55;	author todd;	state Exp;
branches;
next	1.19;

1.19
date	2008.07.28.23.09.43;	author todd;	state Exp;
branches;
next	1.18;

1.18
date	2008.07.21.03.13.01;	author todd;	state Exp;
branches;
next	1.17;

1.17
date	2008.07.06.15.26.14;	author naddy;	state Exp;
branches;
next	1.16;

1.16
date	2008.02.22.20.56.05;	author naddy;	state Exp;
branches;
next	1.15;

1.15
date	2007.09.29.12.18.06;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2007.09.24.19.36.49;	author todd;	state Exp;
branches;
next	1.13;

1.13
date	2007.09.15.22.36.56;	author merdely;	state Exp;
branches;
next	1.12;

1.12
date	2007.08.05.15.38.09;	author naddy;	state Exp;
branches;
next	1.11;

1.11
date	2007.02.19.21.09.10;	author bernd;	state Exp;
branches;
next	1.10;

1.10
date	2006.08.04.16.34.43;	author naddy;	state Exp;
branches;
next	1.9;

1.9
date	2006.02.18.02.05.49;	author todd;	state Exp;
branches;
next	1.8;

1.8
date	2006.02.13.17.27.01;	author david;	state Exp;
branches;
next	1.7;

1.7
date	2006.02.10.19.09.00;	author marco;	state Exp;
branches;
next	1.6;

1.6
date	2006.02.08.14.50.07;	author todd;	state Exp;
branches;
next	1.5;

1.5
date	2006.02.07.13.41.52;	author bernd;	state Exp;
branches;
next	1.4;

1.4
date	2006.02.06.12.39.24;	author todd;	state Exp;
branches;
next	1.3;

1.3
date	2006.02.02.03.21.57;	author todd;	state Exp;
branches;
next	1.2;

1.2
date	2006.02.02.02.10.11;	author todd;	state Exp;
branches;
next	1.1;

1.1
date	2006.01.31.02.49.24;	author marco;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.01.31.02.49.24;	author marco;	state Exp;
branches;
next	;

1.34.2.1
date	2011.03.09.09.15.22;	author jasper;	state Exp;
branches;
next	;

1.55.2.1
date	2016.07.04.11.50.28;	author jasper;	state Exp;
branches;
next	;
commitid	GcIc7HVYwBZNXpTo;


desc
@@


1.59
log
@recognize OpenBSD 6.1
@
text
@# $OpenBSD: Makefile,v 1.58 2016/07/04 07:48:23 jasper Exp $

ONLY_FOR_ARCHS=		i386

COMMENT=		OpenAFS distributed filesystem

VERSION=		1.4.7
DISTNAME=		openafs-${VERSION}
REVISION=		31

CATEGORIES=		net

HOMEPAGE=		http://www.openafs.org

MAINTAINER=		Todd T. Fries <todd@@openbsd.org>

# IBM Public License 1.0
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB=		c

SHARED_LIBS=	afssetpag 1.0

MASTER_SITES=		http://www.openafs.org/dl/openafs/${VERSION}/

EXTRACT_SUFX=		-src.tar.bz2

NO_TEST=		Yes

AUTOCONF_VERSION=	2.60
CONFIGURE_STYLE=	automake autoconf

CONFIGURE_ARGS+=	--disable-transarc-paths \
			--enable-namei-fileserver \
			--enable-largefile-fileserver \
			--with-afs-sysname=${ARCH}_obsd${OSrev} \
			--enable-fast-restart \
			--disable-kernel-module \
			--enable-supergroups

FLAVORS=	debug
FLAVOR?=

post-patch:
	@@sed 's/%OSrev%/'${OSrev}'/g;s/i386/'${ARCH}'/g' \
		${FILESDIR}/param.i386_obsd.h \
		> ${WRKSRC}/src/config/param.${ARCH}_obsd${OSrev}.h

pre-build:
	@@perl -pi -e s,dprintf,debugprintf, ${WRKSRC}/src/bucoord/*.[ch]
	@@perl -pi -e s,dprintf,debugprintf, ${WRKSRC}/src/config/*.h
	@@perl -pi -e s,dprintf,debugprintf, ${WRKSRC}/src/sgistuff/*.c

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/openafs
	${SUBST_CMD} -o ${BINOWN} -g ${BINGRP} -m ${SHAREMODE} \
	    -c ${FILESDIR}/krb5.conf ${PREFIX}/share/examples/openafs/krb5.conf
	${SUBST_CMD} -o ${BINOWN} -g ${BINGRP} -m ${BINMODE} -c \
	    ${FILESDIR}/openafs-setup ${PREFIX}/sbin/openafs-setup

.if ${FLAVOR:Mdebug}
CONFIGURE_ARGS+=	--enable-debug
CONFIGURE_ARGS+=	--enable-debug-lwp
.endif

.include <bsd.port.arch.mk>

.if ${PROPERTIES:Mle}
CONFIGURE_ARGS+=	--enable-littleendian
.else
CONFIGURE_ARGS+=	--enable-bigendian
.endif

.include <bsd.port.mk>
@


1.58
log
@Fix for CVE-2016-2860

MAINTAINER timed-out
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2016/03/16 21:19:38 naddy Exp $
d9 1
a9 1
REVISION=		30
@


1.57
log
@remove SHARED_ONLY from ports that use only the gnu module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2016/03/11 20:28:29 naddy Exp $
d9 1
a9 1
REVISION=		29
@


1.56
log
@garbage collect CONFIGURE_SHARED
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2015/11/09 22:45:07 sthen Exp $
a3 1
SHARED_ONLY=		Yes
@


1.55
log
@With the new strict modes checking, openafs needs SUBST_CMD -m.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2015/06/19 11:27:52 sthen Exp $
d34 1
a34 2
CONFIGURE_ARGS+=	${CONFIGURE_SHARED} \
			--disable-transarc-paths \
@


1.55.2.1
log
@Fix for CVE-2016-2860
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2015/11/09 22:45:07 sthen Exp $
d10 1
a10 1
REVISION=		30
@


1.54
log
@changes to net/openafs:
- recognize more OpenBSD releases
- set SHARED_ONLY (it's i386-only anyway) and merge PFRAG.shared into PLIST
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2015/01/02 15:16:12 naddy Exp $
d10 1
a10 1
REVISION=		28
d57 3
a59 3
	@@${INSTALL_DATA_DIR} ${PREFIX}/share/examples/openafs
	${SUBST_CMD} -o ${BINOWN} -g ${BINGRP} -c ${FILESDIR}/krb5.conf \
		${PREFIX}/share/examples/openafs/krb5.conf
d61 1
a61 1
		${FILESDIR}/openafs-setup ${PREFIX}/sbin/openafs-setup
@


1.53
log
@recognize OpenBSD 5.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2014/07/16 14:42:49 naddy Exp $
d4 1
d10 1
a10 1
REVISION=		27
@


1.52
log
@recognize OpenBSD 5.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2014/01/12 14:58:30 naddy Exp $
d9 1
a9 1
REVISION=		26
@


1.51
log
@bump for plist changes 5.4 -> 5.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2013/07/07 21:33:16 naddy Exp $
d9 1
a9 1
REVISION=		25
@


1.50
log
@recognize 5.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2013/06/18 11:22:23 ajacoutot Exp $
d9 1
a9 1
REVISION=		24
@


1.49
log
@Unbreak.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2013/06/17 19:29:40 ajacoutot Exp $
d9 1
a9 1
REVISION=		23
@


1.48
log
@Temporarily mark broken after the Heimdal update; I'm working on it and
will commit a fix by tomorrow.
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.47 2013/05/12 17:32:10 rpe Exp $

BROKEN=			temporarily broken during the Heimdal update
@


1.47
log
@use SUBST_CMD with -o -g [-m] to replace the multi-step process
SUBST_CMD/chown/chmod?

ok sthen@@ todd@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.46 2013/03/11 11:35:50 espie Exp $
d11 1
a11 1
REVISION=		22
a34 2
CONFIGURE_ENV+=		KRB5CFLAGS="-I/usr/include/kerberosV -DUSING_HEIMDAL" \
			KRB5LIBS="-lkrb5"
@


1.46
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2013/02/09 14:49:52 sthen Exp $
d59 1
a59 1
	${SUBST_CMD} -c ${FILESDIR}/krb5.conf \
d61 2
a62 6
	${SUBST_CMD} -c ${FILESDIR}/openafs-setup \
		${PREFIX}/sbin/openafs-setup
	chown ${BINOWN}:${BINGRP} \
		${PREFIX}/share/examples/openafs/krb5.conf \
		${PREFIX}/sbin/openafs-setup
	chmod u+x ${PREFIX}/sbin/openafs-setup
@


1.45
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2013/02/01 17:15:01 naddy Exp $
a18 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d28 1
a28 1
NO_REGRESS=		Yes
@


1.44
log
@recognize 5.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2013/02/01 09:48:38 brad Exp $
d71 1
a71 1
.if ${FLAVOR:L:Mdebug}
@


1.43
log
@Rename dprintf macro/function to debugprintf so as to not conflict with
POSIX function name.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2012/06/21 13:54:14 sthen Exp $
d9 1
a9 1
REVISION=		21
@


1.42
log
@recognize 5.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2012/06/04 20:20:07 pascal Exp $
d9 1
a9 1
REVISION=		20
d54 5
@


1.41
log
@Make use of new PROPERTIES:Mle.

ok naddy@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2012/04/28 10:52:08 ajacoutot Exp $
d9 1
a9 1
REVISION=		19
@


1.40
log
@--localstatedir=/var is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2012/01/13 00:23:29 naddy Exp $
d71 3
a73 7
.if ${MACHINE} == "alpha" || \
	${MACHINE} == "amd64" || \
	${MACHINE} == "arm" || \
	${MACHINE} == "i386" || \
	${MACHINE} == "mips64" || \
	${MACHINE} == "sh" || \
	${MACHINE} == "vax"
@


1.39
log
@recognize 5.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2011/11/16 00:20:09 sthen Exp $
a38 1
			--localstatedir=/var \
@


1.38
log
@bumps; net/if.h
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2011/07/18 19:04:20 naddy Exp $
d9 1
a9 1
REVISION=		18
@


1.37
log
@recognize 5.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2011/06/02 13:41:40 ajacoutot Exp $
d9 1
a9 1
REVISION=		17
@


1.36
log
@Add a consistent header that substitutes FULLPKGNAME for the READMEs.

ok jasper@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2011/03/02 10:38:03 jasper Exp $
d9 1
a9 1
REVISION=		16
@


1.35
log
@- Security fix for OpenAFS Security Advisory 2009-001 (CVE-2009-1251).

ok todd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2011/01/15 01:19:35 naddy Exp $
d9 1
a9 1
REVISION=		15
@


1.34
log
@recognize OpenBSD 4.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2010/11/15 08:11:17 jasper Exp $
d9 1
a9 1
REVISION=		14
@


1.34.2.1
log
@- Security fix for OpenAFS Security Advisory 2009-001 (CVE-2009-1251).

ok todd@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2011/03/02 10:38:03 jasper Exp $
d9 1
a9 1
REVISION=		15
@


1.33
log
@- switch to pkg-readmes

ok todd@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2010/07/24 23:01:56 naddy Exp $
d9 1
a9 1
REVISION=		13
@


1.32
log
@recognize OpenBSD 4.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2010/07/12 22:07:39 sthen Exp $
d9 1
a9 1
REVISION=		12
a56 3
	@@${INSTALL_DATA_DIR} ${PREFIX}/share/openafs
	${SUBST_CMD} -c ${FILESDIR}/README.OpenBSD \
		${PREFIX}/share/openafs/README.OpenBSD
a62 1
		${PREFIX}/share/openafs/README.OpenBSD \
@


1.31
log
@use REVISION, checked with before/after make show=PKGNAMES (plus some
extra-careful checking where there are complicated PSEUDO_FLAVORS).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2010/01/29 15:53:19 naddy Exp $
d9 1
a9 1
REVISION=		11
@


1.30
log
@recognize 4.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2009/09/07 04:34:54 todd Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p11
@


1.29
log
@o s/xfs/nnpfs/g
o attach orphan files dont nuke during salvage
o bump pkgname
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2009/06/25 01:09:15 jolan Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p10
@


1.28
log
@dont install compile_et, avoids a conflict with sysutils/e2fsprogs and
the base system
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2009/06/18 16:18:12 todd Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p9
@


1.27
log
@o correct example output
o fix tyop
bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2009/03/28 16:11:48 ajacoutot Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p8
@


1.26
log
@- use TRUEPREFIX instead of LOCALBASE where it makes sense (following
previous commit)
- fix mkdir args (from todd@@)

ok todd@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2009/03/26 21:28:47 todd Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p7
@


1.25
log
@PREFIX -> LOCALBASE, my bad, caused installation ``fun''
.. found first by Josh Grosse josh at jgimi dot homeip dot net
.. reminded by Alexander Hall alexander at beard dot se
.. tested by Alexander
use $SUDO_USER if it exists instead of defaulting to 'todd'
use $defuser for example afs homedir
bump pkgname
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2008/10/24 19:59:18 todd Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p6
@


1.24
log
@Instead of commenting out an example full salvage of the server, suggest a
volume by volume salvage by default.  This way, servers with lots of files
can be up salvaging volume by volume instead of down until the last volume
is salvaged.
"if it works, go for it" ckuethe@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2008/10/21 02:57:51 todd Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p5
@


1.23
log
@o remove bogus vars in commented out suggested rc.local bit in README.OpenBSD
o function'ize openafs-setup and let it setup not just the 1st but also
  subsequent afs servers, letting admins choose which afs server programs to
  run on each, `works for me(tm)'
bump PKGNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2008/10/12 17:31:17 ajacoutot Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p4
@


1.22
log
@- s/LOCALBASE/PREFIX
- s/%SYSCONFDIR%/etc where it makes sense (e.g. /etc/rc.conf.local will
always be /etc/rc.conf.local whatever value ${SYSCONFDIR} is set to)
- use SUBST_CMD
- don't hardcode /usr/local
- precise license marker
- s/definately/definitely/ (from sthen@@)

"looks good" sthen@@, ok todd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2008/10/12 00:12:07 todd Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p3
@


1.21
log
@o add autoconf to CONFIGURE_STYLE to fix autoconf depend
o no longer require kernel sources since not building lkm; if this changes,
  the attic can be raided
o typo in openafs-setup comments from sthen@@; thanks!
o obey CFLAGS and CC
o twiddle lwp.h patch to be OpenBSD specific
bump PKGNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2008/07/28 23:09:43 todd Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p2
d17 1
d58 2
a59 5
.for file in README.OpenBSD
	sed -e s,%LOCALBASE%,${LOCALBASE},g \
		-e s,%SYSCONFDIR%,${SYSCONFDIR},g \
		< ${FILESDIR}/${file} > ${PREFIX}/share/openafs/${file}
.endfor
d61 9
a69 12
.for file in krb5.conf
	sed -e s,%LOCALBASE%,${LOCALBASE},g \
		-e s,%SYSCONFDIR%,${SYSCONFDIR},g \
		< ${FILESDIR}/${file} > \
		${PREFIX}/share/examples/openafs/${file}
.endfor
.for file in openafs-setup
	sed -e s,%LOCALBASE%,${LOCALBASE},g \
		-e s,%SYSCONFDIR%,${SYSCONFDIR},g \
		< ${FILESDIR}/${file} > ${PREFIX}/sbin/${file}
	chmod u+x ${PREFIX}/sbin/${file}
.endfor
@


1.20
log
@o fix autoconf dependency; otherwise any autoconf-* would match then it would
  fail to exec autoconf-2.60
o update README.OpenBSD to include rc.local and rc.shutdown bits
o invade and cleanup openafs-setup
  - polish consistency
  - prompt for a sample general purpose user
  - backup CellServDB and restore on script failure
  - compact output
  - better cleanup incase it is restarted
  - show all afs commands as they are run
  - reorder various places to make more logical sense
  - DO NOT DO RECURSIVE MOUNTS, this leads to panics;
    (thanks bob/art for explaining).. i.e. no 'fs mkm /afs/.root.afs root.afs')
  - add a few gratuitous remote cells during setup as examples
  - add files of consequence to /etc/changelist
bump PKGNAME
@
text
@d9 1
a9 1
PKGNAME=		${DISTNAME}p1
d32 2
a33 1
CONFIGURE_STYLE=	GNU
a46 3
AUTOCONF_VERSION=	2.60
BUILD_DEPENDS+=		:autoconf-${AUTOCONF_VERSION}:devel/autoconf/${AUTOCONF_VERSION}

a48 19

pre-configure:	patch
	@@if [ ! -d /usr/src/sys ] ; then \
		echo ; \
		echo "*** Error: Building this package requires the kernel sources" ; \
		echo "***        to be available in directory /usr/src/sys" ; \
		echo ; \
		exit 1 ; \
	fi
	@@( \
		cd ${WRKBUILD} ; \
		cp -p configure configure.orig ; \
		cp -p configure-libafs configure-libafs.orig ; \
		env AUTOCONF_VERSION=${AUTOCONF_VERSION} autoconf ; \
		env AUTOCONF_VERSION=${AUTOCONF_VERSION} \
			autoconf configure-libafs.in > configure-libafs ; \
		chmod +x configure-libafs ; \
		rm -r autom4te.cache \
	)
@


1.19
log
@fix CATEGORIES, noticed by brad@@
bump PKGNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2008/07/21 03:13:01 todd Exp $
d9 1
a9 1
PKGNAME=		${DISTNAME}p0
a45 1

d47 1
a47 1
BUILD_DEPENDS=		::devel/autoconf/${AUTOCONF_VERSION}
@


1.18
log
@o update openafs to 1.4.7
o add README.OpenBSD (includes heimdal setup instructions)
o rework openafs-setup to use arla's afsd in base, and heimdal
o fix a bug since 4.1 to not blow the thread stack on 64bit time functions in libc
@
text
@d1 1
a1 1
# $OpenBSD$
d9 1
d11 1
a11 1
CATEGORIES=		net wipstuff/net
@


1.17
log
@recognize 4.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2008/02/22 20:56:05 naddy Exp $
d3 1
a3 1
ONLY_FOR_ARCHS= 	i386
d5 1
a5 1
COMMENT=		distributed filesystem OpenAFS
d7 4
a10 4
V=			1.4.0
DISTNAME=		openafs-${V}-src
PKGNAME=		openafs-${V}p9
CATEGORIES=		net
a15 1
# IPL
d18 1
a18 1
PERMIT_DISTFILES_CDROM= Yes
d21 9
a29 1
WANTLIB=		c pthread
d31 1
a31 2
MASTER_SITES=		http://www.openafs.org/dl/openafs/${V}/
EXTRACT_SUFX=		.tar.bz2
d33 2
a34 2
CONFIGURE_STYLE=	autoconf
AUTOCONF_VERSION=	2.13
d36 2
a39 1
			--enable-supergroups \
d41 29
a69 3
			--disable-kernel-module

WRKDIST=		${WRKDIR}/${DISTNAME:S/-src$//}
d72 2
a73 1
	@@sed 's/%OSrev%/'${OSrev}'/g' ${FILESDIR}/param.i386_obsd.h \
d77 13
a89 1
	@@${INSTALL_DATA_DIR} ${PREFIX}/share/
d91 2
a92 1
	@@sed -e s,%PREFIX%,${PREFIX},g -e s,%SYSCONFDIR%,${SYSCONFDIR},g \
d94 1
a94 1
	@@chmod u+x ${PREFIX}/sbin/${file}
d96 18
a113 1
 
@


1.16
log
@recognize 4.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2007/09/29 12:18:06 ajacoutot Exp $
d9 1
a9 1
PKGNAME=		openafs-${V}p8
@


1.15
log
@Some cleanup:
 - lowercase COMMENT
 - add a $V variable for version number to ease upgrades
 - s/$LOCALBASE/$PREFIX in files/openafs-setup
 - use $SYSCONFDIR instead of /etc for files/openafs-setup
 (where appropriate)

"go fot it" todd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2007/09/24 19:36:49 todd Exp $
d9 1
a9 1
PKGNAME=		openafs-${V}p7
@


1.14
log
@unbreak openafs by not compiling the lkm; this is temporary
use one param.i386_obsd.h file to support any release instead of
 adding/removing files each OSrev of OpenBSD
regen patches while here
bump PKGNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2007/09/15 22:36:56 merdely Exp $
d5 1
a5 1
COMMENT=		Distributed filesystem OpenAFS
d7 3
a9 2
DISTNAME=		openafs-1.4.0-src
PKGNAME=		openafs-1.4.0p6
d24 1
a24 1
MASTER_SITES=		http://www.openafs.org/dl/openafs/1.4.0/
d45 2
a46 2
	@@sed s,%LOCALBASE%,${LOCALBASE},g < ${FILESDIR}/${file} > \
	${PREFIX}/sbin/${file}
@


1.13
log
@Remove surrounding quotes in COMMENT*/PERMIT_*/BROKEN/ERRORS

Add $OpenBSD$ to p5-SNMP-Info/Makefile (ok kili@@, simon@@)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2007/08/05 15:38:09 naddy Exp $
a2 1
BROKEN=			does not build
d8 1
a8 1
PKGNAME=		openafs-1.4.0p5
d32 2
a33 1
			--with-afs-sysname=${ARCH}_obsd${OSrev} 
d38 2
a39 11
	@@cp ${FILESDIR}/param.i386_obsd40.h \
		${WRKSRC}/src/config/param.${ARCH}_obsd${OSrev}.h

pre-configure:
	@@if [ ! -d /usr/src/sys ]; then \
		echo ""; \
		echo "*** Error: Building this package requires the"; \
		echo "*** kernel sources to be available under /usr/src/sys"; \
		echo ""; \
		exit 1; \
	fi
@


1.12
log
@acknowledge that this port is BROKEN
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2007/02/19 21:09:10 bernd Exp $
d6 1
a6 1
COMMENT=		"Distributed filesystem OpenAFS"
@


1.11
log
@Unbreak build with 4.1. todd@@ takes maintainership.

ok espie@@, todd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2006/08/04 16:34:43 naddy Exp $
d3 1
@


1.10
log
@fix build on 4.0 and clean up a bit
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2006/02/18 02:05:49 todd Exp $
d8 1
a8 1
PKGNAME=		openafs-1.4.0p4
d13 1
a13 1
MAINTAINER=		Jaime Fournier <ober@@linbsd.org>
d37 2
a38 1
	@@cp ${FILESDIR}/param.i386_obsd40.h ${WRKSRC}/src/config/
@


1.9
log
@from maint
o more feedback/typos/etc fixes

bump PKGNAME
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.8 2006/02/13 17:27:01 david Exp $
a14 2
ONLY_FOR_ARCHS= i386

d21 1
a21 1
WANTLIB=	c pthread
d35 3
@


1.8
log
@fix various typos in openafs-setup
replace /usr/local with PREFIX in MESSAGE
bump PKGNAME
ok MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2006/02/10 19:09:00 marco Exp $
d6 1
a6 1
PKGNAME=		openafs-1.4.0p3
d32 2
a33 3
			--with-afs-sysname=${ARCH}_obsd${OSrev} \
			--enable-debug
COPTS+= -ggdb
@


1.7
log
@bump PKGNAME

yelled at by Nikolay & Bernd, sorry forgot.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2006/02/08 14:50:07 todd Exp $
d6 1
a6 1
PKGNAME=		openafs-1.4.0p2
@


1.6
log
@keep the testing feedback coming, improvements to openafs-setup from maint, bump PKGNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2006/02/07 13:41:52 bernd Exp $
d6 1
a6 1
PKGNAME=		openafs-1.4.0p1
@


1.5
log
@Unbreak. Use corrent WRKDIST. Noticed by Jaime Fournier on ports@@, thanks!
Slightly different fix committed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2006/02/06 12:39:24 todd Exp $
d6 1
a6 1
PKGNAME=		openafs-1.4.0p0
@


1.4
log
@from maint
o small cleanups, better COMMENT/DESCR

per report on ports@@
o permit 'make clean' to work w/out /sys, patterned after lsof

bump PKGNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2006/02/02 03:21:57 todd Exp $
d35 1
a35 1
WRKDIST=		${WRKDIR}/${PKGNAME}
@


1.3
log
@add WANTLIB, ok maint
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2006/02/02 02:10:11 todd Exp $
d3 1
a3 1
COMMENT=		"OpenAFS"
d6 1
a6 1
PKGNAME=		openafs-1.4.0
d11 1
a11 1
MAINTAINER=		Ober J. Heim <ober@@linbsd.org>
d15 1
a15 1
# ???
d37 8
a44 3
.if !exists(/usr/src/sys/lib/libkern/libkern.h)
ERRORS += "Fatal: You cannot build this port without kernel sources"
.endif
@


1.2
log
@1. Require kernel source code.
2. set the executable bit on the openafs-setup script.
from maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2006/01/31 02:49:24 marco Exp $
d20 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.template,v 1.44 2004/07/15 22:08:00 sturm Exp $
d35 4
d44 1
@


1.1.1.1
log
@initial import of openafs
@
text
@@
