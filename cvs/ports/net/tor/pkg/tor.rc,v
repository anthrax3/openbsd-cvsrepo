head	1.5;
access;
symbols
	OPENBSD_6_2:1.5.0.10
	OPENBSD_6_2_BASE:1.5
	OPENBSD_6_1:1.5.0.8
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.6
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.4
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.1.0.16
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.14
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.12
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.10
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.8
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.6
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@ * @;


1.5
date	2015.07.20.19.55.58;	author ajacoutot;	state Exp;
branches;
next	1.4;
commitid	tWQ6flU2RD1e4cje;

1.4
date	2015.07.15.13.54.55;	author ajacoutot;	state Exp;
branches;
next	1.3;
commitid	5zU8eNi4mCtWRbs2;

1.3
date	2015.06.25.10.27.05;	author pascal;	state Exp;
branches;
next	1.2;
commitid	UhXpjqpq6FiNUYnn;

1.2
date	2015.04.03.15.26.10;	author pascal;	state Exp;
branches;
next	1.1;
commitid	Z9nwb47LKqoFNemE;

1.1
date	2011.03.11.06.49.55;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Tweak pkill invocation.
@
text
@#!/bin/sh
#
# $OpenBSD: tor.rc,v 1.4 2015/07/15 13:54:55 ajacoutot Exp $

daemon="${TRUEPREFIX}/bin/tor"
daemon_timeout=60

. /etc/rc.d/rc.subr

rc_stop() {
	pkill -INT -xf "${pexp}"
}

rc_cmd $1
@


1.4
log
@No need to override the default pexp after recent rc.subr(8) change.
@
text
@d3 1
a3 1
# $OpenBSD: tor.rc,v 1.3 2015/06/25 10:27:05 pascal Exp $
d11 1
a11 1
	pkill -INT -xf "^${pexp}"
@


1.3
log
@In some situations, it is desirable to start multiple tor instances on the
same machine.  While this is of course done outside the rc.subr(8) framework,
the package's rc.d(8) script should not interfere with these instances.

Require exact pexp matches in order to achieve this.  Patch by "nusenu",
developer of ansible-relayor, tested by me in various situations.
@
text
@d3 1
a3 1
# $OpenBSD: tor.rc,v 1.2 2015/04/03 15:26:10 pascal Exp $
a9 2
pexp="${daemon}${daemon_flags:+ ${daemon_flags}}$"

d11 1
a11 1
	pkill -INT -f "^${pexp}"
@


1.2
log
@Use SIGINT instead of SIGTERM to terminate the tor process in rc_stop().

For clients, this means no change.

For relays, this instructs tor to do a clean shutdown, leaving 30s for other
peers to find another route.  Increase daemon_timeout to one minute to give
tor a bit more time on slow machines (like my BBB).

Hint from Michael McConvill, "go ahead" ajacoutot@@
@
text
@d3 1
a3 1
# $OpenBSD: tor.rc,v 1.1 2011/03/11 06:49:55 ajacoutot Exp $
d9 2
@


1.1
log
@Bugfix update to tor-0.2.1.30.
* amongst other things, add a tweak to Tor's TLS handshake that makes
relays and bridges that run this new version reachable from Iran.

Add an rc script.

from Pascal Stumpf.
MAINTAINER timeout.
@
text
@d3 1
a3 1
# $OpenBSD$
d6 1
d9 4
@

