head	1.2;
access;
symbols
	OPENBSD_6_0:1.1.0.4
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.2
	OPENBSD_5_9_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2016.08.03.15.40.31;	author pascal;	state dead;
branches;
next	1.1;
commitid	67gHXrafoEPu9WG1;

1.1
date	2015.11.25.21.04.07;	author pascal;	state Exp;
branches;
next	;
commitid	s4WM9WmwAJhQkvfp;


desc
@@


1.2
log
@Update to 0.2.8.6.
@
text
@$OpenBSD: patch-configure_ac,v 1.1 2015/11/25 21:04:07 pascal Exp $

Make this work w/ libevent2 on OpenBSD
https://trac.torproject.org/projects/tor/attachment/ticket/16651/event2-b.patch

--- configure.ac.orig	Fri Nov 13 14:41:42 2015
+++ configure.ac	Mon Nov 23 18:38:05 2015
@@@@ -505,10 +505,7 @@@@ AC_CHECK_MEMBERS([struct event.min_heap_idx], , ,
 AC_CHECK_HEADERS(event2/event.h event2/dns.h event2/bufferevent_ssl.h)
 
 LIBS="$save_LIBS"
-LDFLAGS="$save_LDFLAGS"
-CPPFLAGS="$save_CPPFLAGS"
 
-
 AM_CONDITIONAL(USE_EXTERNAL_EVDNS, test x$ac_cv_header_event2_dns_h = xyes)
 
 if test "$enable_static_libevent" = "yes"; then
@@@@ -518,8 +515,24 @@@@ if test "$enable_static_libevent" = "yes"; then
      TOR_LIBEVENT_LIBS="$TOR_LIBDIR_libevent/libevent.a $STATIC_LIBEVENT_FLAGS"
    fi
 else
-     TOR_LIBEVENT_LIBS="-levent"
+     if test x$ac_cv_header_event2_event_h = "xyes"; then
+       AC_SEARCH_LIBS(event_new, [event event_core])
+       AC_SEARCH_LIBS(evdns_base_new, [event event_extra])
+
+       if test $ac_cv_search_event_new != "none required"; then
+         TOR_LIBEVENT_LIBS="$ac_cv_search_event_new"
+       fi
+       if test $ac_cv_search_evdns_base_new != "none required"; then
+         TOR_LIBEVENT_LIBS="$ac_cv_search_evdns_base_new $TOR_LIBEVENT_LIBS"
+       fi
+     else
+       TOR_LIBEVENT_LIBS="-levent"
+     fi
 fi
+
+LIBS="$save_LIBS"
+LDFLAGS="$save_LDFLAGS"
+CPPFLAGS="$save_CPPFLAGS"
 
 dnl This isn't the best test for Libevent 2.0.3-alpha.  Once it's released,
 dnl we can do much better.
@


1.1
log
@Update to tor 0.2.7.5.  Switch to libevent2 by default, as recommended by
upstream.

Based on diffs from Daniel Jakots.
@
text
@d1 1
a1 1
$OpenBSD$
@

