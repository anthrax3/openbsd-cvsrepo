head	1.2;
access;
symbols
	OPENBSD_5_2:1.1.0.6
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2012.10.18.14.01.45;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2011.11.28.22.40.25;	author sthen;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2011.11.29.08.57.07;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to Net-SNMP 5.7.2; lots of fixes and improvements

- many of our local patches are now committed upstream
@
text
@$OpenBSD: patch-agent_mibgroup_ucd-snmp_disk_hw_c,v 1.1 2011/11/28 22:40:25 sthen Exp $

chunk 0 - bug #3434824: SIGSEGV when reading disk directive after SIGHUP
chunk 1 - 9aa1e70: off-by-one in dskIndex

--- agent/mibgroup/ucd-snmp/disk_hw.c.orig	Mon Nov 28 13:38:09 2011
+++ agent/mibgroup/ucd-snmp/disk_hw.c	Mon Nov 28 13:50:43 2011
@@@@ -137,6 +137,7 @@@@ disk_free_config(void)
   if (disks) {
      free( disks );
      disks = NULL;
+     maxdisks = numdisks = 0;
   }
   allDisksIncluded = 0;
 }
@@@@ -321,7 +322,7 @@@@ tryAgain:
 
     switch (vp->magic) {
     case MIBINDEX:
-        long_ret = disknum;
+        long_ret = disknum + 1;
         return ((u_char *) (&long_ret));
     case ERRORNAME:            /* DISKPATH */
         *var_len = strlen(entry->path);
@


1.1
log
@various fixes to Net-SNMP, mostly from upstream repo, one chunk suggested
by Joel Knight to avoid a segfault
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@Update to net-snmp in -stable to 5.7.1 + patches from -current; the older
version was returning incorrect data for hrStorageUsed and sometimes
encountering segfaults when querying hrStorageTable. Problems reported
and fix tested by Joel Knight.
@
text
@d1 1
a1 1
$OpenBSD: patch-agent_mibgroup_ucd-snmp_disk_hw_c,v 1.1 2011/11/28 22:40:25 sthen Exp $
@

