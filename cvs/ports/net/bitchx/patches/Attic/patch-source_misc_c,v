head	1.4;
access;
symbols
	OPENBSD_4_8:1.3.0.6
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.4
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.2
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.2.0.22
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.20
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.18
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.16
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.14
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.12
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.10
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.8
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.6
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.4
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.1.0.6
	OPENBSD_3_4_BASE:1.1
	OPENBSD_3_3:1.1.0.4
	OPENBSD_3_2:1.1.0.2;
locks; strict;
comment	@# @;


1.4
date	2010.09.20.07.56.06;	author sthen;	state dead;
branches;
next	1.3;

1.3
date	2009.03.24.21.43.10;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2004.01.04.23.46.49;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.27.15.46.11;	author brad;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2003.03.28.01.17.18;	author brad;	state Exp;
branches;
next	;

1.1.4.1
date	2003.05.03.03.00.15;	author brad;	state Exp;
branches;
next	;


desc
@@


1.4
log
@remove bitchx; unmaintained in ports or upstream, and has various unfixed
security problems e.g. CVE-2007-3360, CVE-2007-4584, CVE-2007-5839.

pointed out by James Hozier on misc@@.  ok aja@@
@
text
@$OpenBSD: patch-source_misc_c,v 1.3 2009/03/24 21:43:10 naddy Exp $
--- source/misc.c.orig	Mon Jan  8 07:24:22 2001
+++ source/misc.c	Tue Mar 24 22:41:56 2009
@@@@ -3108,42 +3108,47 @@@@ char *cluster (char *hostname)
 	static char result[IRCD_BUFFER_SIZE/4 + 1];
 	char temphost[BIG_BUFFER_SIZE + 1];
 	char *host;
+	char *atsign;
 
 	if (!hostname)
 		return NULL;
-	host = temphost;
-	*result = 0;
-	memset(result, 0, sizeof(result));
-	memset(temphost, 0, sizeof(temphost));
-	if (strchr(hostname, '@@'))
-	{
-		if (*hostname == '~')
-			hostname++;
-		strcpy(result, hostname);
-		*strchr(result, '@@') = '\0';
-		if (strlen(result) > 9)
-		{
-			result[8] = '*';
-			result[9] = '\0';
+
+	atsign = strchr(hostname, '@@');
+	if (atsign) {
+		if (*hostname == '~') {
+			strcpy(result, "~*@@");
+		} else {
+			size_t ident_len = atsign - hostname;
+			
+			if (ident_len <= 9) {
+				/* copy ident@@ */
+				strmcpy(result, hostname, ident_len + 1);
+			} else {
+				strmcpy(result, hostname, 8);
+				result[8] = '*';
+				result[9] = '@@';
+				result[10] = '\0';
+			}
 		}
-		strcat(result, "@@");
-		if (!(hostname = strchr(hostname, '@@')))
-			return NULL;
-		hostname++;
+		hostname = atsign + 1;
+	} else {
+		*result = 0;
 	}
-	strcpy(host, hostname);
 
-	if (*host && isdigit(*(host + strlen(host) - 1)))
+	strlcpy(temphost, hostname, sizeof temphost);
+	host = temphost;
+
+	if (*host && isdigit((unsigned char)*(host + strlen(host) - 1)))
 	{
 		/* Thanks icebreak for this small patch which fixes this function */
                 int i;
                 char *tmp;
-                char count=0;
+                char count = 0;
 
                 tmp = host;
-                while((tmp-host)<strlen(host))
+                while((tmp - host) < strlen(host))
                 {
-	                if((tmp=strchr(tmp,'.'))==NULL) 
+	                if((tmp = strchr(tmp,'.')) == NULL) 
 				break;
         	        count++;
                 	tmp++;
@@@@ -3152,8 +3157,8 @@@@ char *cluster (char *hostname)
                 for (i = 0; i < count; i++)
                         tmp = strchr(tmp, '.') + 1;
                 *tmp = '\0';
-                strcat(result, host);
-                strcat(result, "*");
+                strlcat(result, host, sizeof result);
+                strlcat(result, "*", sizeof result);
 	}
 	else
 	{
@@@@ -3175,16 +3180,17 @@@@ char *cluster (char *hostname)
 			else
 				return (char *) NULL;
 		}
+		
+		/* We don't need strlcat for these first two, because
+		 * at this point the maximum length of the string in
+		 * result is 10 */
 		strcat(result, "*");
 		if (my_stricmp(host, temphost))
 			strcat(result, ".");
-		strcat(result, host);
+		strlcat(result, host, sizeof result);
 	}
 	return result;
 }
-
-
-
 
 struct _sock_manager
 {
@


1.3
log
@sync patches
@
text
@d1 1
a1 1
$OpenBSD: patch-source_misc_c,v 1.2 2004/01/04 23:46:49 espie Exp $
@


1.2
log
@preproc fixes for gcc3.
@
text
@d1 3
a3 3
$OpenBSD: patch-source_misc_c,v 1.1 2003/03/27 15:46:11 brad Exp $
--- source/misc.c.orig	2001-01-08 07:24:22.000000000 +0100
+++ source/misc.c	2004-01-05 00:37:21.000000000 +0100
a25 5
-		}
-		strcat(result, "@@");
-		if (!(hostname = strchr(hostname, '@@')))
-			return NULL;
-		hostname++;
d43 5
a47 1
+		}
d86 1
a86 1
@@@@ -3175,17 +3180,18 @@@@ char *cluster (char *hostname)
a101 1
 
d105 1
a107 1
 	int init;
@


1.1
log
@fixes some potential remote buffer overflows

http://marc.theaimsgroup.com/?l=bugtraq&m=104766521328322&w=2
@
text
@d1 3
a3 3
$OpenBSD$
--- source/misc.c.orig	Mon Jan  8 01:24:22 2001
+++ source/misc.c	Wed Mar 26 23:00:45 2003
d26 5
d48 1
a48 5
 		}
-		strcat(result, "@@");
-		if (!(hostname = strchr(hostname, '@@')))
-			return NULL;
-		hostname++;
d87 1
a87 1
@@@@ -3175,16 +3180,17 @@@@ char *cluster (char *hostname)
d103 1
a106 1
 
d109 1
@


1.1.4.1
log
@MFC:
fixes some potential remote buffer overflows

http://marc.theaimsgroup.com/?l=bugtraq&m=104766521328322&w=2
@
text
@d1 1
a1 1
$OpenBSD: patch-source_misc_c,v 1.1 2003/03/27 15:46:11 brad Exp $
@


1.1.2.1
log
@MFC:
fixes some potential remote buffer overflows

http://marc.theaimsgroup.com/?l=bugtraq&m=104766521328322&w=2
@
text
@d1 1
a1 1
$OpenBSD: patch-source_misc_c,v 1.1 2003/03/27 15:46:11 brad Exp $
@

