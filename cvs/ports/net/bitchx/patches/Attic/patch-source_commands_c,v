head	1.4;
access;
symbols
	OPENBSD_4_8:1.3.0.28
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.26
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.24
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.22
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.20
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.18
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.16
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.14
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.12
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.10
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.8
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.6
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.4
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.2
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.2.0.6
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.4
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.2
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.1.0.2
	OPENBSD_3_1_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2010.09.20.07.56.06;	author sthen;	state dead;
branches;
next	1.3;

1.3
date	2004.01.04.23.46.49;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2002.06.30.18.23.31;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2002.03.01.00.18.11;	author brad;	state Exp;
branches;
next	;


desc
@@


1.4
log
@remove bitchx; unmaintained in ports or upstream, and has various unfixed
security problems e.g. CVE-2007-3360, CVE-2007-4584, CVE-2007-5839.

pointed out by James Hozier on misc@@.  ok aja@@
@
text
@$OpenBSD: patch-source_commands_c,v 1.3 2004/01/04 23:46:49 espie Exp $
--- source/commands.c.orig	2001-01-08 07:24:22.000000000 +0100
+++ source/commands.c	2004-01-05 00:38:36.000000000 +0100
@@@@ -203,8 +203,8 @@@@ IrcCommand irc_command[] =
 	{ "ADDLAMENICK","AddLameNick",	add_bad_nick,		0,	"%Y<%Cnick%G|%Cnick%C nick nick%Y>%n\n - Adds %Y<%Cnick%Y>%n to your lame nicklist, bans nick!*@@*"},
 	{ "ADDNOFLOOD",	"AddNoFlood",	add_no_flood,		0,	"%Y<%Cnick%Y>%n\n - Adds %Cnick%n to your no flood list" },
 #ifdef WANT_USERLIST
-	{ "ADDSHIT",	"AddShit",	add_shit,		0,	"%Y<%Cnick%G|%Cnick%G!%nuser%Y@@%n
-	hostname%Y>%n %Y<%Bchannel%G|%Y*>%n %R[%nshitlevel%R]%n %R[%nreason%R]%n\n- Add %Y<%Cnick%G|%Cnick%G!%nuser%Y@@%nhostname%Y>%n to your shitlist on %Y<%Bchannel%G|%Y*>%n with %R[%nshitlevel%R]%n and for %R[%nreason%R]%n" },
+	{ "ADDSHIT",	"AddShit",	add_shit,		0,	"%Y<%Cnick%G|%Cnick%G!%nuser%Y@@%n\n"
+"	hostname%Y>%n %Y<%Bchannel%G|%Y*>%n %R[%nshitlevel%R]%n %R[%nreason%R]%n\n- Add %Y<%Cnick%G|%Cnick%G!%nuser%Y@@%nhostname%Y>%n to your shitlist on %Y<%Bchannel%G|%Y*>%n with %R[%nshitlevel%R]%n and for %R[%nreason%R]%n" },
 	{ "ADDUSER",	"AddUser",	add_user,		0,	"%Y<%Cnick%G|%Cnick%G!%nuser%Y@@%nhostname%Y>%n %Y<%Bchannel%G|%Y*>%n %R[%nuserlevel%R]%n %R[%nauto-op%R]%n %R[%nprotection%R]%n %R[%npassword%R]%n\n - Adds %Y<%Cnick%G|%Cnick%G!%nuser%Y@@%nhostname%Y>%n on %Y<%Bchannel%G|%Y*>%n with %R[%nuserlevel%R]%n %R[%nauto-op%R]%n and %R[%nprotection%R]%n levels to your userlist" },
 #endif
 	{ "ADDWORD",	NULL,		add_ban_word,		0,	"%Y<%Bchannel%G|%Y*>%n %Y<%nword%y(%ns%y)%Y>%n\n- Adds %Y<%nword%y(%ns%y)%Y>%n to wordlist, anyone saying it in %Y<%Bchannel%G|%Y*>%n will be kicked" },
@@@@ -2604,13 +2604,13 @@@@ BUILT_IN_COMMAND(e_hostname)
 		int i;
 		char *newhost = NULL;
 #if !defined(__linux__) && !defined(__EMX__)
-#if defined(_BSDI_VERSION) && _BSDI_VERSION < 199701
+#if defined(_BSDI_VERSION) && _BSDI_VERSION < 199701 || defined(__OpenBSD__)
 		char device[80];
 #endif
 #endif
 
 		tmpnam(filename);
-#if defined(_BSDI_VERSION) && _BSDI_VERSION < 199701
+#if defined(_BSDI_VERSION) && _BSDI_VERSION < 199701 || defined(__OpenBSD__)
 		if (!(p = path_search("netstat", "/sbin:/usr/sbin:/bin:/usr/bin")))
 		{
 			yell("No Netstat to be found");
@@@@ -2637,10 +2637,16 @@@@ BUILT_IN_COMMAND(e_hostname)
 			unlink(filename);
 			return;
 		}
-#if defined(_BSDI_VERSION) && _BSDI_VERSION < 199701
+#if defined(_BSDI_VERSION) && _BSDI_VERSION < 199701 || defined(__OpenBSD__)
 		fgets(comm, 200, fptr);
 		fgets(comm, 200, fptr);
 		p = next_arg(comm, &q);
+#ifdef __OpenBSD__
+		while ((*p == 'l') && (*(p+1) == 'o')) {
+			fgets(comm, 200, fptr);
+			p = next_arg(comm, &q);
+		}
+#endif
 		strncpy(device, p, 79);
 		bitchsay("Looking for hostnames on device %s", device);
 #else
@@@@ -2655,7 +2661,7 @@@@ BUILT_IN_COMMAND(e_hostname)
 			if (strstr(comm, "inet6 addr") || strstr(comm, "inet addr"))
 #else
 			if (strstr(comm, "inet addr"))
-#endif
+#endif /* ifdef IPV6 */
 			{
 				/* inet addr:127.0.0.1  Mask:... */
 				/* inet6 addr: ::1/128 Scope:... */
@@@@ -2672,11 +2678,15 @@@@ BUILT_IN_COMMAND(e_hostname)
 				}
 				*q = 0;
 
-#elif defined(_BSDI_VERSION) && _BSDI_VERSION < 199701
+#elif defined(_BSDI_VERSION) && _BSDI_VERSION < 199701 || defined(__OpenBSD__)
 			if (!strncmp(comm, device, strlen(device)))
 			{
 				p = comm;
+#if defined(_BSDI_VERSION) && _BSDI_VERSION < 199701
 				p += 24;
+#elif defined(__OpenBSD__)
+				p += strlen("Name    Mtu   Network     ")-1;
+#endif
 				while (*p && *p == ' ') p++;
 				q = strchr(p, ' ');
 				*q = 0;
@


1.3
log
@preproc fixes for gcc3.
@
text
@d1 1
a1 1
$OpenBSD: patch-source_commands_c,v 1.2 2002/06/30 18:23:31 brad Exp $
@


1.2
log
@- disable auto rejoin
- add RCS ids to patches
@
text
@d1 14
a14 3
$OpenBSD$
--- source/commands.c.orig	Mon Jan  8 01:24:22 2001
+++ source/commands.c	Thu Feb 28 17:29:03 2002
@


1.1
log
@upgrade to BitchX 1.0c18
--
Based on patches from & the new maintainer:
Vincent Derrien <vincent.derrien@@free.fr>
@
text
@d1 1
@

