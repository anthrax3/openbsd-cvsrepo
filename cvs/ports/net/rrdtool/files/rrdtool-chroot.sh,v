head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.6
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.4
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.2
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.2.0.6
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.8
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.4
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.2
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.1.0.2
	OPENBSD_5_5_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2016.04.26.15.57.28;	author sthen;	state Exp;
branches;
next	1.2;
commitid	cssCtM5fm3usUvDT;

1.2
date	2014.04.06.17.01.34;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2013.11.05.17.49.01;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.3
log
@fix rrdtool-chroot.sh script, problem reported by Predrag Punosevac,
he didn't get chance to test yet but it works for my use case anyway.
@
text
@#!/bin/ksh
#
# make rrdtool(1) available in webserver chroot(8): copy in library
# dependencies and generate barebones fontconfig configuration

# WARNING: /var/www/usr/libexec/ld.so and /var/www/lib/* may be shared
# by other executables in the chroot(8)

if [ "$(id -u)" -ne 0 ]; then
	echo " *** Error: need root privileges to run this script"
	exit 1
fi

do_enable() {
	mkdir -p /var/www{/etc/fonts/TTF,/usr/lib,/usr/libexec,${LOCALBASE}/bin,${X11BASE}/lib,/cache/fontconfig}
	cp -p ${LOCALBASE}/bin/rrdtool /var/www${LOCALBASE}/bin
	for i in $(ldd ${LOCALBASE}/bin/rrdtool | grep 'lib/' | awk '{ print $7 }') ; do \
		cp -p $i /var/www/usr/lib/
	done
	cp -p /usr/libexec/ld.so /var/www/usr/libexec/
	cp -p /usr/X11R6/lib/X11/fonts/TTF/DejaVuSans.ttf /var/www/etc/fonts/TTF
	cat << EOF > /var/www/etc/fonts/fonts.conf
<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<fontconfig>
	<dir>/etc/fonts/TTF</dir>
	<cachedir>/cache/fontconfig</cachedir>
</fontconfig>
EOF
}

do_disable() {
	rm -rf /var/www/usr/local/bin/rrdtool \
		/var/www/usr/libexec/ld.so \
		/var/www/etc/fonts \
		/var/www/cache/fontconfig
	for i in $(ldd ${LOCALBASE}/bin/rrdtool | grep 'lib/' | awk '{ print $7 }') ; do \
		rm -f /var/www/usr/lib/$(basename $i | sed -e 's,\.so.*,,')*
	done
	rmdir /var/www{/etc/fonts,${LOCALBASE}/bin,${LOCALBASE},/usr/lib,/usr/libexec,/usr} 2>/dev/null
}

case $1 in
enable)
	do_disable
	do_enable
	;;
disable)
	do_disable
	;;
*)
	echo "usage: ${0##*/} {enable|disable}"
	;;
esac
@


1.2
log
@Remove MODRUBY_REV and switch to the default Ruby version now that packages
are available on a wider range of arches. Adjust comments in rrdtool-chroot
script (talk about "web server" rather than Apache).
@
text
@d4 1
a4 1
# dependencies and generate barebones pango/fontconfig/pango configuration
d15 1
a15 1
	mkdir -p /var/www{/etc/{pango,fonts/TTF},/usr/lib,/usr/libexec,${LOCALBASE}/bin,${X11BASE}/lib,/cache/fontconfig}
a19 1
	cp -p ${LOCALBASE}/lib/pango/*/modules/pango-basic-fc.so /var/www/usr/lib/
a29 3
	cat << EOF > /var/www/etc/pango/pango.modules
/usr/lib/pango-basic-fc.so BasicScriptEngineFc PangoEngineShape PangoRenderFc common:
EOF
a35 1
		/var/www/etc/pango \
a39 1
	rm -f /var/www/usr/lib/pango-basic-fc.so
@


1.1
log
@Update to rrdtool 1.4.8. Merge p5-RRD into the main package.

Note that this now uses cairo for graphics generation and pango/fontconfig
for text rendering; if you are using this in a chroot jail (for cgi/php
scripts, etc) you will need to take additional steps to install the relevant
files. A script is provided to copy the relevant libraries and support files;
see /usr/local/share/doc/pkg-readmes/rrdtool-1.4.8 for more details.
@
text
@d3 2
a4 1
# make rrdtool(1) available in Apache chroot(8)
@

