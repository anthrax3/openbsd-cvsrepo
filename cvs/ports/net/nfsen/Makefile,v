head	1.36;
access;
symbols
	OPENBSD_6_0:1.35.0.2
	OPENBSD_6_0_BASE:1.35
	OPENBSD_5_9:1.34.0.2
	OPENBSD_5_9_BASE:1.34
	OPENBSD_5_8:1.33.0.4
	OPENBSD_5_8_BASE:1.33
	OPENBSD_5_7:1.29.0.2
	OPENBSD_5_7_BASE:1.29
	OPENBSD_5_6:1.25.0.4
	OPENBSD_5_6_BASE:1.25
	OPENBSD_5_5:1.25.0.2
	OPENBSD_5_5_BASE:1.25
	OPENBSD_5_4:1.23.0.2
	OPENBSD_5_4_BASE:1.23
	OPENBSD_5_3:1.19.0.2
	OPENBSD_5_3_BASE:1.19
	OPENBSD_5_2:1.16.0.2
	OPENBSD_5_2_BASE:1.16
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.2
	OPENBSD_5_0:1.12.0.2
	OPENBSD_5_0_BASE:1.12
	OPENBSD_4_9:1.6.0.2
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.4.0.2
	OPENBSD_4_8_BASE:1.4
	sthen_20100502:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.36
date	2017.01.25.14.22.46;	author sthen;	state Exp;
branches;
next	1.35;
commitid	RYmyt1Nl8Px2tmIw;

1.35
date	2016.04.11.08.51.28;	author sthen;	state Exp;
branches
	1.35.2.1;
next	1.34;
commitid	CiETL9FZU391CDDI;

1.34
date	2015.10.05.12.59.12;	author kirby;	state Exp;
branches
	1.34.2.1;
next	1.33;
commitid	uBdVhmncPejAajda;

1.33
date	2015.07.07.14.44.58;	author sthen;	state Exp;
branches;
next	1.32;
commitid	3ip2eKfpCQusYvJT;

1.32
date	2015.07.06.11.25.36;	author sthen;	state Exp;
branches;
next	1.31;
commitid	fXrDP8itzF5x6yPc;

1.31
date	2015.06.05.06.00.22;	author robert;	state Exp;
branches;
next	1.30;
commitid	PS9YXjRm9KQkIZjT;

1.30
date	2015.04.20.12.04.22;	author sthen;	state Exp;
branches;
next	1.29;
commitid	IzgRrpPWfaTiyme3;

1.29
date	2015.01.09.18.04.19;	author sthen;	state Exp;
branches;
next	1.28;
commitid	litCaiKfK5Q5Wubp;

1.28
date	2014.11.06.17.13.39;	author sthen;	state Exp;
branches;
next	1.27;
commitid	ig1O4RkSPXzTZYwZ;

1.27
date	2014.09.17.09.20.01;	author sthen;	state Exp;
branches;
next	1.26;
commitid	9556sXFJBr6vsHaj;

1.26
date	2014.09.16.09.07.03;	author espie;	state Exp;
branches;
next	1.25;
commitid	RMOje3pTBXZOKU4I;

1.25
date	2013.11.05.17.49.33;	author sthen;	state Exp;
branches;
next	1.24;

1.24
date	2013.08.12.04.11.20;	author robert;	state Exp;
branches;
next	1.23;

1.23
date	2013.05.03.09.49.01;	author sthen;	state Exp;
branches;
next	1.22;

1.22
date	2013.05.03.09.31.23;	author sthen;	state Exp;
branches;
next	1.21;

1.21
date	2013.05.03.01.17.10;	author sthen;	state Exp;
branches;
next	1.20;

1.20
date	2013.03.11.11.35.50;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2012.12.28.21.03.39;	author naddy;	state Exp;
branches;
next	1.18;

1.18
date	2012.08.31.16.57.23;	author sthen;	state Exp;
branches;
next	1.17;

1.17
date	2012.08.28.23.33.33;	author sthen;	state Exp;
branches;
next	1.16;

1.16
date	2012.04.22.11.41.55;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2012.03.20.13.57.44;	author sthen;	state Exp;
branches;
next	1.14;

1.14
date	2011.11.16.15.56.37;	author robert;	state Exp;
branches;
next	1.13;

1.13
date	2011.09.16.11.13.39;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2011.07.08.22.31.59;	author robert;	state Exp;
branches;
next	1.11;

1.11
date	2011.06.02.13.41.40;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2011.05.11.12.03.19;	author jasper;	state Exp;
branches;
next	1.9;

1.9
date	2011.05.06.13.04.08;	author sthen;	state Exp;
branches;
next	1.8;

1.8
date	2011.05.05.21.49.48;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2011.03.24.23.04.00;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2010.11.19.22.31.35;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2010.10.12.09.55.51;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2010.07.12.22.07.39;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2010.07.03.02.44.14;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2010.05.03.09.49.17;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2010.05.02.20.52.32;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.05.02.20.52.32;	author sthen;	state Exp;
branches;
next	;

1.34.2.1
date	2016.04.11.08.54.19;	author sthen;	state Exp;
branches;
next	;
commitid	E2IlqqXE1Km3L13i;

1.35.2.1
date	2017.01.25.14.23.29;	author sthen;	state Exp;
branches;
next	;
commitid	7gsaJEwh3TumsQDy;


desc
@@


1.36
log
@update to NfSen 1.3.8, fixing a shell escaping problem
@
text
@# $OpenBSD: Makefile,v 1.35 2016/04/11 08:51:28 sthen Exp $

COMMENT=		web-based front end for the nfdump netflow tools

V=			1.3.8
DISTNAME=		nfsen-$V
CATEGORIES=		net www
HOMEPAGE=		http://nfsen.sourceforge.net/

MAINTAINER=		Stuart Henderson <sthen@@openbsd.org>

# BSD
PERMIT_PACKAGE_CDROM=	Yes

MASTER_SITES=		${MASTER_SITE_SOURCEFORGE:=nfsen/}

MODULES=		perl lang/php
RUN_DEPENDS=		net/rrdtool \
			mail/p5-Mail-Tools \
			net/p5-Socket6 \
			net/nfdump,-nfprofile \
			net/nfdump>=1.6.9
BUILD_DEPENDS=		${RUN_DEPENDS}

NO_BUILD=		Yes
NO_TEST=		Yes
WWWDIR=			${WRKINST}/var/www/htdocs
PKG_ARCH=		*

pre-configure:
	@@${SUBST_CMD} ${WRKSRC}/etc/nfsen-dist.conf
	@@cd ${WRKSRC}/html; [ -r index.php ] || echo \
	    '<?php header("Location: nfsen.php"); ?>' > index.php

# XXX installer requires /dev/log causing problems for ports builds in a jail

do-install:
	${INSTALL_DATA_DIR} ${WWWDIR}/
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/nfsen
	${INSTALL_DATA_DIR} ${PREFIX}/${P5SITE}/NfSen/installer-items
	cd ${WRKSRC} && INSTPREFIX=${WRKINST}/ ./install.pl etc/nfsen-dist.conf copy < /dev/null
	${INSTALL_DATA} ${WRKINST}/etc/nfsen.conf ${PREFIX}/share/examples/nfsen
	rm ${WRKINST}/etc/nfsen*
	${INSTALL_SCRIPT} ${WRKSRC}/install.pl ${PREFIX}/bin/install-nfsen.pl
	perl -pi \
	    -e 's,use lib "./libexec";,use lib "${TRUEPREFIX}/${P5SITE}/NfSen";,;' \
	    -e 's,use lib "./installer-items";,use lib "${TRUEPREFIX}/${P5SITE}/NfSen/installer-items";,' \
	    ${PREFIX}/bin/install-nfsen.pl
	${INSTALL_SCRIPT} ${WRKSRC}/installer-items/* ${PREFIX}/${P5SITE}/NfSen/installer-items
	${INSTALL_SCRIPT} ${WRKSRC}/contrib/PortTracker/PortTracker.pm ${PREFIX}/lib/nfsen/plugins/
	${INSTALL_SCRIPT} ${WRKSRC}/contrib/PortTracker/PortTracker.php ${WWWDIR}/nfsen/plugins/
	-mv ${WWWDIR}/nfsen/conf.php ${WWWDIR}/nfsen/conf.php.dist
	find ${WRKINST} -name '*.orig' -or -name '._*' -print0 | xargs -0r rm
	chown -R ${SHAREOWN}:${SHAREGRP} ${WRKINST}/var/www/htdocs/nfsen
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/bin ${PREFIX}/lib ${PREFIX}/libdata

.include <bsd.port.mk>
@


1.35
log
@Patch a problem with nfsen's install.pl that was introduced in the 1.3.7
update reported by mlnospam at yahoo.com

Garbage-collect pkg/MESSAGE while there. Most of the contents are already
in pkg/README and I've merged the other bit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2015/10/05 12:59:12 kirby Exp $
d5 1
a5 2
V=			1.3.7
REVISION=		5
@


1.35.2.1
log
@MFC update to NfSen 1.3.8, fixing a shell escaping problem
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2016/04/11 08:51:28 sthen Exp $
d5 2
a6 1
V=			1.3.8
@


1.34
log
@fix rcctl syntax
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2015/07/07 14:44:58 sthen Exp $
d6 1
a6 1
REVISION=		4
@


1.34.2.1
log
@MFC: Patch a problem with nfsen's install.pl that was introduced in the 1.3.7
update reported by mlnospam at yahoo.com

Garbage-collect pkg/MESSAGE while there. Most of the contents are already
in pkg/README and I've merged the other bit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2016/04/11 08:51:28 sthen Exp $
d6 1
a6 1
REVISION=		5
@


1.33
log
@use su -m instead of -s /bin/sh, suggested by millert
add some missing -c
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2015/07/06 11:25:36 sthen Exp $
d6 1
a6 1
REVISION=		3
@


1.32
log
@Remove use of sudo from pkg READMEs in a few ports as packages and their
instructions are meant to work on a fresh install.

- easy cases: replace some '$ sudo somecommand' with '# somecommand'
(while there I've swapped some "${RCDIR}/foo start" with "rcctl foo start").

- replace some 'sudo -u user somecommand foo bar' with
'su -s /bin/sh user "/path/to/somecommand foo bar"' and similar.
Not pretty with the -s, but many of the uids that need to run
these commands have /sbin/nologin as their usual shell.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2015/06/05 06:00:22 robert Exp $
d6 1
a6 1
REVISION=		2
@


1.31
log
@bump revision due to the change of the default php version to 5.6
ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2015/04/20 12:04:22 sthen Exp $
d6 1
a6 1
REVISION=		1
@


1.30
log
@handle rrdtool versions >=1.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2015/01/09 18:04:19 sthen Exp $
d6 1
a6 1
REVISION=		0
@


1.29
log
@update to nfsen 1.3.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2014/11/06 17:13:39 sthen Exp $
d6 1
@


1.28
log
@bump REVISION for php version switch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2014/09/17 09:20:01 sthen Exp $
d5 1
a5 2
V=			1.3.6p1
REVISION=		5
a6 1
PKGNAME=		${DISTNAME:S/p/pl/}
d20 1
d53 1
a53 1
	find ${WRKINST} -name '*.orig' -print0 | xargs -0r rm
@


1.27
log
@patch install.pl to allow FAKE_AS_ROOT build
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2014/09/16 09:07:03 espie Exp $
d6 1
a6 1
REVISION=		4
@


1.26
log
@explicitly mark the few ports that don't build with FAKE_AS_ROOT=No
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2013/11/05 17:49:33 sthen Exp $
a3 1
FAKE_AS_ROOT =		Yes
d6 1
a6 1
REVISION=		3
@


1.25
log
@handle rrdtool update
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2013/08/12 04:11:20 robert Exp $
d4 1
@


1.24
log
@bump REVISION due to the php update
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2013/05/03 09:49:01 sthen Exp $
d6 1
a6 1
REVISION=		2
d20 1
a20 1
RUN_DEPENDS=		net/rrdtool,-perl \
@


1.23
log
@oh, socket6 isn't needed at all: inet_ntop was added to Socket in Perl 5.12
so we can use it from there.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2013/05/03 09:31:23 sthen Exp $
d6 1
a6 1
REVISION=		1
@


1.22
log
@only import the required function from Socket6, avoids console spam from
importing the whole lot (several things in Socket6 are now in Perl base).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2013/05/03 01:17:10 sthen Exp $
d6 1
a6 1
REVISION=		0
@


1.21
log
@update to NfSen 1.3.6p1, to go with updated nfdump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2013/03/11 11:35:50 espie Exp $
d6 1
@


1.20
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2012/12/28 21:03:39 naddy Exp $
d3 3
a5 7
MULTI_PACKAGES=		-main -web
COMMENT-main=		web-based front end for the nfdump netflow tools
COMMENT-web=		html/php parts for nfsen

V=			1.3.5
REVISION-main=		8
REVISION-web=		2
d7 1
a7 2
PKGNAME-main=		${DISTNAME}
PKGNAME-web=		nfsen-web-$V
d19 1
a19 1
COMMON_DEPENDS=		net/rrdtool,-perl \
d22 2
a23 4
			net/nfdump>=1.6.3
BUILD_DEPENDS=		${COMMON_DEPENDS}
RUN_DEPENDS-main=	${COMMON_DEPENDS} \
			nfsen-web-$V:net/nfsen,-web
d27 1
a27 2
PREFIX-web=		/var/www
WWWDIR=			${WRKINST}${PREFIX-web}/htdocs
d52 1
@


1.19
log
@remove trailing whitespace in PLIST
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2012/08/31 16:57:23 sthen Exp $
a19 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d33 1
a33 1
NO_REGRESS=		Yes
@


1.18
log
@revert previous workaround, no longer needed with bsd.port.mk r1.1188
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2012/08/28 23:33:33 sthen Exp $
d8 1
a8 1
REVISION-main=		7
@


1.17
log
@Use SUBST_CMD-main explicitly rather than SUBST_CMD; following bsd.port.mk
r1.1183 this is now subpackage-dependent - nfsen sets a different PREFIX for
different subpackages and this change caused failures in DPB builds (but not
normal builds) as they pass the subpackage in SUBDIR.

Problem reported by krw, ok espie@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2012/04/22 11:41:55 ajacoutot Exp $
d42 1
a42 1
	@@${SUBST_CMD-main} ${WRKSRC}/etc/nfsen-dist.conf
@


1.16
log
@Use RCDIR instead of /etc/rc.d when refering to packages rc scripts.

discussed with espie and sthen
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2012/03/20 13:57:44 sthen Exp $
d42 1
a42 1
	@@${SUBST_CMD} ${WRKSRC}/etc/nfsen-dist.conf
@


1.15
log
@add comment re /dev/log needed during install to remind me to look at
it next time I update; noted by aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/11/16 15:56:37 robert Exp $
d8 1
a8 1
REVISION-main=		6
@


1.14
log
@switch php to version 5.3 by default
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/09/16 11:13:39 espie Exp $
d45 2
@


1.13
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/07/08 22:31:59 robert Exp $
d8 2
a9 2
REVISION-main=		5
REVISION-web=		1
@


1.12
log
@switch to lang/php
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/06/02 13:41:40 ajacoutot Exp $
d8 2
a9 2
REVISION-main=		4
REVISION-web=		0
@


1.11
log
@Add a consistent header that substitutes FULLPKGNAME for the READMEs.

ok jasper@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/05/11 12:03:19 jasper Exp $
d8 2
a9 1
REVISION-main=		3
d26 1
a26 1
MODULES=		perl
a33 1
RUN_DEPENDS-web=	www/php5/core
@


1.10
log
@Sanitize some @@unexec/@@extraunexec calls to rm: move them up in the
PLIST and delete everything under the @@sample'd directory instead of the
directory itself to prevent a warning from pkg_delete(1) trying to
remove a non existing directory and to help preventing left-over files
and directories.

ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/05/06 13:04:08 sthen Exp $
d8 1
a8 1
REVISION-main=		2
@


1.9
log
@tweaks following feedback from aja@@; ok aja.

- don't use ${rcexec} where not needed

- disable reloads; if certain config changes are made, manual confirmation
is required, users should use the standard "/usr/local/bin/nfsen reconfigure"
by hand.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2011/05/05 21:49:48 sthen Exp $
d8 1
a8 1
REVISION-main=		1
@


1.8
log
@add an rc script for nfsen, prompted by a mail from Barry Grumbine
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2011/03/24 23:04:00 sthen Exp $
d8 1
a8 1
REVISION-main=		0
@


1.7
log
@update NfSen to 1.3.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/11/19 22:31:35 espie Exp $
d8 1
@


1.6
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/10/12 09:55:51 sthen Exp $
d7 1
a7 1
V=			1.3.2
a9 1
REVISION-main=		1
d28 1
a28 1
			net/nfdump>=1.5.8p0
d37 1
a39 3
post-extract:
	rm ${WRKSRC}/html/nfsen.php.orig # in the distfile

d41 3
a43 1
	${SUBST_CMD} ${WRKSRC}/etc/nfsen-dist.conf
d46 1
a46 1
	${INSTALL_DATA_DIR} ${WRKINST}/var/www/htdocs
d49 1
a49 1
	cd ${WRKSRC} && INSTDIR=${WRKINST}/ ./install.pl etc/nfsen-dist.conf copy < /dev/null
d58 4
a61 1
	chown -R ${SHAREOWN}:${SHAREGRP} ${WRKINST}/var/www/htdocs/nfsen ${PREFIX}/share/doc/nfsen
@


1.5
log
@Don't try and syslog during build, it interferes with aja's bulk builds
inside a chroot. ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/07/12 22:07:39 sthen Exp $
d26 4
a29 4
COMMON_DEPENDS=		:p5-RRD-*:net/rrdtool,-perl \
			::mail/p5-Mail-Tools \
			:nfprofile-*:net/nfdump,-nfprofile \
			:nfdump->=1.5.8p0:net/nfdump
d32 2
a33 2
			:nfsen-web-$V:net/nfsen,-web
RUN_DEPENDS-web=	::www/php5/core
@


1.4
log
@use REVISION, checked with before/after make show=PKGNAMES (plus some
extra-careful checking where there are complicated PSEUDO_FLAVORS).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/07/03 02:44:14 naddy Exp $
d10 1
a10 1
REVISION-main=		0
@


1.3
log
@Kill all instances of the dangerous RUN_DEPENDS=${BUILD_DEPENDS} idiom.
Bump pkgname where necessary.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/05/03 09:49:17 sthen Exp $
d9 2
a10 1
PKGNAME-main=		${DISTNAME}p0
@


1.2
log
@Remind people to remove the _nfcapd user from group www when the package
is uninstalled. Suggested by ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/05/02 20:52:32 sthen Exp $
d25 1
a25 1
BUILD_DEPENDS=		:p5-RRD-*:net/rrdtool,-perl \
d29 2
a30 1
RUN_DEPENDS-main=	${BUILD_DEPENDS} \
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.template,v 1.54 2008/01/13 16:43:57 espie Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}
@


1.1.1.1
log
@Import ports/net/nfsen, this companion to net/nfdump is a nice web-based
interface for working with netflow captures, including those from pflow(4).
See teamcymru episode 19 on youtube or the RIPE50 presentation slides to
get an idea of what it can do. Port requested by henning@@.

NfSen is a graphical web based front end for the nfdump netflow
tools, allowing you to:

* Display your netflow data:
  Flows, Packets and Bytes using RRD (Round Robin Database).
* Easily navigate through the netflow data.
* Process the netflow data within the specified time span.
* Create history as well as continuous profiles.
* Set alerts, based on various conditions.
* Write your own plugins to process netflow data on a regular interval.

Different tasks need different interfaces to your netflow data.
NfSen allows you to keep all the convenient advantages of the command
line using nfdump directly and gives you also a graphical overview
over your netflow data.
@
text
@@
