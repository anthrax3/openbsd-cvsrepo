head	1.51;
access;
symbols
	OPENBSD_6_0:1.45.0.2
	OPENBSD_6_0_BASE:1.45
	OPENBSD_5_9:1.42.0.2
	OPENBSD_5_9_BASE:1.42
	OPENBSD_5_8:1.38.0.4
	OPENBSD_5_8_BASE:1.38
	OPENBSD_5_7:1.35.0.2
	OPENBSD_5_7_BASE:1.35
	OPENBSD_5_6:1.34.0.2
	OPENBSD_5_6_BASE:1.34
	OPENBSD_5_5:1.33.0.2
	OPENBSD_5_5_BASE:1.33
	OPENBSD_5_4:1.32.0.2
	OPENBSD_5_4_BASE:1.32
	OPENBSD_5_3:1.25.0.2
	OPENBSD_5_3_BASE:1.25
	OPENBSD_5_2:1.24.0.2
	OPENBSD_5_2_BASE:1.24
	OPENBSD_5_1_BASE:1.20
	OPENBSD_5_1:1.20.0.2
	OPENBSD_5_0:1.14.0.2
	OPENBSD_5_0_BASE:1.14
	OPENBSD_4_9:1.13.0.2
	OPENBSD_4_9_BASE:1.13
	OPENBSD_4_8:1.10.0.6
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.4
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.2
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.7.0.2
	OPENBSD_4_5_BASE:1.7
	jasper_20081002:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.51
date	2017.01.20.08.26.39;	author florian;	state Exp;
branches;
next	1.50;
commitid	AQsgozh27owEvBmP;

1.50
date	2017.01.13.15.38.46;	author florian;	state Exp;
branches;
next	1.49;
commitid	CoSfBTk85oKleIc2;

1.49
date	2016.12.31.03.32.10;	author jsg;	state Exp;
branches;
next	1.48;
commitid	Z3MV0nuBAKv50pcN;

1.48
date	2016.09.23.09.16.57;	author sthen;	state Exp;
branches;
next	1.47;
commitid	XLnI6AbHAmyVU5mO;

1.47
date	2016.08.31.14.25.04;	author florian;	state Exp;
branches;
next	1.46;
commitid	KIFuDGttfdLNXeKU;

1.46
date	2016.08.17.20.58.19;	author sthen;	state Exp;
branches;
next	1.45;
commitid	3YTVpXXidJQjfavt;

1.45
date	2016.06.09.14.30.20;	author florian;	state Exp;
branches
	1.45.2.1;
next	1.44;
commitid	uqrTg23IyKX5b0rA;

1.44
date	2016.03.16.21.19.39;	author naddy;	state Exp;
branches;
next	1.43;
commitid	eS3Ayl3CL8hkKETd;

1.43
date	2016.03.04.08.53.44;	author florian;	state Exp;
branches;
next	1.42;
commitid	jSZ6WZ3lfCC7s9hZ;

1.42
date	2016.02.21.16.17.26;	author jsg;	state Exp;
branches;
next	1.41;
commitid	IZQsfcjAwN1evvTh;

1.41
date	2015.11.06.17.35.10;	author florian;	state Exp;
branches;
next	1.40;
commitid	jgZ1b0onNq2iLjFH;

1.40
date	2015.09.16.10.09.52;	author florian;	state Exp;
branches;
next	1.39;
commitid	Eo3D8fFcsgFOmv8y;

1.39
date	2015.09.07.20.24.55;	author jca;	state Exp;
branches;
next	1.38;
commitid	FjkPzc2biarYgrlY;

1.38
date	2015.07.01.21.10.42;	author sthen;	state Exp;
branches
	1.38.4.1;
next	1.37;
commitid	xg0enzUDfo5Y5qjr;

1.37
date	2015.05.08.13.13.14;	author florian;	state Exp;
branches;
next	1.36;
commitid	gbtfvn0x8TwqNBM1;

1.36
date	2015.04.14.18.10.27;	author florian;	state Exp;
branches;
next	1.35;
commitid	Lg7dNBY14HoseEFJ;

1.35
date	2014.09.13.18.09.21;	author brad;	state Exp;
branches;
next	1.34;
commitid	PpbRjVZdAmlrmi8q;

1.34
date	2014.04.21.14.11.30;	author sthen;	state Exp;
branches;
next	1.33;

1.33
date	2013.11.10.12.38.34;	author espie;	state Exp;
branches;
next	1.32;

1.32
date	2013.06.20.06.54.37;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2013.06.18.14.18.47;	author sthen;	state Exp;
branches;
next	1.30;

1.30
date	2013.06.17.19.28.36;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2013.06.12.20.36.34;	author brad;	state Exp;
branches;
next	1.28;

1.28
date	2013.05.25.00.33.10;	author brad;	state Exp;
branches;
next	1.27;

1.27
date	2013.03.21.08.46.35;	author ajacoutot;	state Exp;
branches;
next	1.26;

1.26
date	2013.03.11.11.35.55;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2013.02.09.14.49.52;	author sthen;	state Exp;
branches;
next	1.24;

1.24
date	2012.05.17.21.39.44;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2012.05.17.10.27.02;	author sthen;	state Exp;
branches;
next	1.22;

1.22
date	2012.04.25.23.03.09;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2012.04.23.17.15.18;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2012.01.28.08.07.26;	author sthen;	state Exp;
branches;
next	1.19;

1.19
date	2012.01.11.02.01.59;	author sthen;	state Exp;
branches;
next	1.18;

1.18
date	2012.01.11.01.41.47;	author sthen;	state Exp;
branches;
next	1.17;

1.17
date	2011.12.17.22.01.13;	author sthen;	state Exp;
branches;
next	1.16;

1.16
date	2011.10.28.07.23.39;	author jasper;	state Exp;
branches;
next	1.15;

1.15
date	2011.09.16.11.13.39;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2011.05.11.12.03.19;	author jasper;	state Exp;
branches
	1.14.2.1;
next	1.13;

1.13
date	2010.11.19.22.31.37;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2010.11.11.16.27.55;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2010.10.18.18.36.56;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2009.06.23.22.59.57;	author sthen;	state Exp;
branches;
next	1.9;

1.9
date	2009.06.18.20.08.25;	author naddy;	state Exp;
branches;
next	1.8;

1.8
date	2009.06.18.01.42.41;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2009.02.11.08.15.20;	author jasper;	state Exp;
branches;
next	1.6;

1.6
date	2009.02.10.21.38.51;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2009.02.10.21.05.09;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2008.12.16.10.30.27;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2008.10.28.15.21.49;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2008.10.07.21.02.53;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2008.10.02.18.40.41;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.10.02.18.40.41;	author jasper;	state Exp;
branches;
next	;

1.14.2.1
date	2012.01.11.02.01.18;	author sthen;	state Exp;
branches;
next	1.14.2.2;

1.14.2.2
date	2012.01.28.10.49.34;	author sthen;	state Exp;
branches;
next	1.14.2.3;

1.14.2.3
date	2012.04.05.09.15.38;	author sthen;	state Exp;
branches;
next	;

1.38.4.1
date	2015.09.18.18.19.58;	author jasper;	state Exp;
branches;
next	1.38.4.2;
commitid	gEjurVKrXWWyoxz5;

1.38.4.2
date	2015.11.16.12.40.25;	author jasper;	state Exp;
branches;
next	;
commitid	yZ1UvyN4rLsu7ggF;

1.45.2.1
date	2017.01.30.08.53.17;	author robert;	state Exp;
branches;
next	;
commitid	akYwpi0MgpQxagdR;


desc
@@


1.51
log
@update to 4.0.3
OK ajacoutot
@
text
@# $OpenBSD: Makefile,v 1.50 2017/01/13 15:38:46 florian Exp $

BROKEN-hppa =		undefined reference to `__sync_fetch_and_add_4'

COMMENT-main=		modular authoritative nameserver (with database support)
COMMENT-mysql=		MySQL database access module for PowerDNS
COMMENT-pgsql=		PGSQL database access module for PowerDNS
COMMENT-ldap=		LDAP module for PowerDNS

V=			4.0.3
DISTNAME=		pdns-${V}
EXTRACT_SUFX =		.tar.bz2
PKGNAME=		powerdns-${V}
PKGNAME-main=		powerdns-${V}
PKGNAME-mysql=		powerdns-mysql-${V}
PKGNAME-pgsql=		powerdns-pgsql-${V}
PKGNAME-ldap=		powerdns-ldap-${V}
CATEGORIES=		net
HOMEPAGE=		http://www.powerdns.com/
MAINTAINER=		Florian Obser <florian+ports@@narrans.de>

MULTI_PACKAGES=		-main -mysql -pgsql -ldap

# GPLv2
PERMIT_PACKAGE_CDROM=	Yes

MODULES +=	gcc4
MODGCC4_ARCHS =	*
MODGCC4_LANGS =	c++

WANTLIB += m pthread
#WANTLIB += ${MODGCC4_CPPWANTLIB}

WANTLIB-main += ${WANTLIB}
WANTLIB-main += boost_program_options-mt boost_serialization-mt
WANTLIB-main += bz2 c crypto gmp sqlite3 z

MASTER_SITES=		http://downloads.powerdns.com/releases/

NO_TEST=		Yes

LIB_DEPENDS-main=	${LIB_DEPENDS} \
			databases/sqlite3 \
			devel/boost \
			devel/gmp

PSEUDO_FLAVORS+=	no_mysql no_pgsql no_ldap
FLAVOR?=

BACKENDS=		gsqlite3

SYSCONFDIR=		${BASESYSCONFDIR}/pdns

CONFIGURE_STYLE=	gnu
CONFIGURE_ARGS+=	--disable-shared \
			--with-modules="bind" \
			--with-sqlite3 \
			--with-dynmodules="${BACKENDS}" \
			--without-lua \
			--disable-hardening \
			--without-protobuf

CONFIGURE_ENV+=		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib"
LIBTOOL_FLAGS=		--tag=disable-static

.include <bsd.port.arch.mk>

# MySQL
.if ${BUILD_PACKAGES:M-mysql}
CONFIGURE_ARGS+=	--with-mysql=${LOCALBASE}
BACKENDS+=		gmysql
.else
CONFIGURE_ARGS+=	--without-mysql
.endif
LIB_DEPENDS-mysql=	${LIB_DEPENDS} \
			databases/mariadb
RUN_DEPENDS-mysql=	${FULLPKGNAME-main}:net/powerdns
WANTLIB-mysql+=		crypto lib/mysql/mysqlclient ssl z ${WANTLIB}

# PostgreSQL
.if ${BUILD_PACKAGES:M-pgsql}
CONFIGURE_ARGS+=	--with-pgsql=${LOCALBASE} \
			--with-pgsql-includes=${LOCALBASE}/include/postgresql
BACKENDS+=		gpgsql
.else
CONFIGURE_ARGS+=	--without-pgsql
.endif
LIB_DEPENDS-pgsql=	${LIB_DEPENDS} \
			databases/postgresql,-main
RUN_DEPENDS-pgsql=	${FULLPKGNAME-main}:net/powerdns
WANTLIB-pgsql=		crypto pq>=2 ssl ${WANTLIB}

# LDAP
.if ${BUILD_PACKAGES:M-ldap}
BACKENDS+=		ldap
.else
CONFIGURE_ARGS+=	--without-ldap
.endif
LIB_DEPENDS-ldap=	${LIB_DEPENDS} \
			databases/openldap
RUN_DEPENDS-ldap=	${FULLPKGNAME-main}:net/powerdns
WANTLIB-ldap+=		${WANTLIB} crypto lber-2.4 ldap_r-2.4 sasl2 ssl

EXAMPLE_DIR=		${PREFIX}/share/examples/pdns/
post-install:
	rm -f ${PREFIX}/lib/pdns/*.la
	${INSTALL_DATA_DIR} ${EXAMPLE_DIR}
.for t in tables-mysql.sql tables-pgsql.sql tables-sqlite.sql
	${INSTALL_DATA} ${FILESDIR}/$t ${EXAMPLE_DIR}
.endfor
	${INSTALL_DATA} ${WRKSRC}/pdns/pdns.conf-dist ${EXAMPLE_DIR}
	${INSTALL_DATA} ${FILESDIR}/pdns.conf ${EXAMPLE_DIR}

.include <bsd.port.mk>
@


1.50
log
@powerdns has no business touching /var/pdnsd/.
Pointed out by Peter van Dijk <peter.van.dijk AT powerdns.com>,
thanks!
OK sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2016/12/31 03:32:10 jsg Exp $
d10 1
a10 1
V=			4.0.1
a20 1
REVISION-main=		1
@


1.49
log
@powerdns already builds with ports gcc, now that the arm baseline is
armv6k builtin atomics are available on arm and this builds so stop
marking it as BROKEN on arm.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2016/09/23 09:16:57 sthen Exp $
d21 1
a21 1
REVISION-main=		0
@


1.48
log
@Cope with moving sqlite3 back to ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2016/08/31 14:25:04 florian Exp $
a2 1
BROKEN-arm =		undefined reference to `__sync_fetch_and_add_4'
@


1.47
log
@Update to 4.0.1
c++11 clue bat & OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2016/08/17 20:58:19 sthen Exp $
d22 1
d45 1
@


1.46
log
@bump ports that might pick up IP_SENDSRCADDR
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2016/06/09 14:30:20 florian Exp $
d11 1
a11 2
V=			3.4.9
REVISION-main=		0
d28 6
a33 1
WANTLIB += m pthread stdc++
d36 1
a36 1
WANTLIB-main += boost_program_options-mt boost_serialization-mt botan-1.10
d43 3
a45 3
LIB_DEPENDS-main=	devel/boost \
			devel/gmp \
			security/botan
d56 1
a56 1
			--with-modules="geo bind" \
d60 3
a62 2
			--enable-botan1.10 \
			--disable-hardening
d76 2
a77 1
LIB_DEPENDS-mysql=	databases/mariadb
d89 2
a90 1
LIB_DEPENDS-pgsql=	databases/postgresql,-main
d100 2
a101 1
LIB_DEPENDS-ldap=	databases/openldap
a103 1

@


1.45
log
@Trivial update to 3.4.9
OK sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2016/03/16 21:19:39 naddy Exp $
d12 1
@


1.45.2.1
log
@apply patches from upstream for CVE-2016-5426, CVE-2016-5427
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2016/06/09 14:30:20 florian Exp $
a21 2

REVISION-main=		0
@


1.44
log
@remove SHARED_ONLY from ports that use only the gnu module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2016/03/04 08:53:44 florian Exp $
d11 1
a11 1
V=			3.4.8
@


1.43
log
@Update to 3.4.8
OK ajacoutot
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2016/02/21 16:17:26 jsg Exp $
a4 2

SHARED_ONLY=		Yes
@


1.42
log
@Don't attempt to build on arm.  sync atomic builtins required.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2015/11/06 17:35:10 florian Exp $
d13 1
a13 1
V=			3.4.7
@


1.41
log
@simple update to 3.4.7
OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2015/09/16 10:09:52 florian Exp $
d3 2
a4 1
BROKEN-hppa =		"undefined reference to `__sync_fetch_and_add_4'"
@


1.40
log
@update to 3.4.6
OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2015/09/07 20:24:55 jca Exp $
d12 1
a12 1
V=			3.4.6
@


1.39
log
@BROKEN-hppa, missing gcc atomic ops.  ok florian@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2015/07/01 21:10:42 sthen Exp $
d12 1
a12 1
V=			3.4.5
@


1.38
log
@update to PowerDNS 3.4.5, ok florian@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.37 2015/05/08 13:13:14 florian Exp $
@


1.38.4.1
log
@Security fix for CVE-2015-5230
http://blog.powerdns.com/2015/09/02/powerdns-security-advisory-2015-02

ok florian@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2015/07/01 21:10:42 sthen Exp $
a17 1
REVISION-main=		0
@


1.38.4.2
log
@Security fix for CVE-2015-5311; from upstream
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38.4.1 2015/09/18 18:19:58 jasper Exp $
d18 1
a18 1
REVISION-main=		1
@


1.37
log
@Update to 3.4.4.
OK weerd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2015/04/14 18:10:27 florian Exp $
d10 1
a10 1
V=			3.4.4
@


1.36
log
@Update to 3.4.3.
This is a major upgrade from the old 2.9.x version, refer to
https://doc.powerdns.com/md/authoritative/upgrading/ for upgrading
instructions.
testing by me and weerd@@
Input, tweaks and OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2014/09/13 18:09:21 brad Exp $
d10 1
a10 1
V=			3.4.3
@


1.35
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2014/04/21 14:11:30 sthen Exp $
d5 1
a5 1
COMMENT-main=		modern authoritative nameserver
d10 1
a10 1
V=			2.9.22.6
d12 1
d20 1
a20 3

REVISION=		4
REVISION-mysql=		5
d27 5
a31 2
WANTLIB=		m stdc++ z pthread
WANTLIB-main=		c sqlite3>=8 ${WANTLIB}
d37 3
a39 1
BUILD_DEPENDS=		devel/boost
d46 14
d71 1
a71 1
WANTLIB-mysql+=		crypto lib/mysql/mysqlclient ssl ${WANTLIB}
a84 1

a86 2
CONFIGURE_ARGS+=	--with-ldap=${LOCALBASE} \
			--with-ldap-includes=${LOCALBASE}/include
a90 1

d96 1
a96 22
BUILD_DEPENDS+=		${MODGNU_AUTOCONF_DEPENDS}

SYSCONFDIR=		${BASESYSCONFDIR}/pdns

CONFIGURE_STYLE=	autoconf
AUTOCONF_VERSION=	2.65
CONFIGURE_ARGS+=	--disable-shared \
			--libdir="${PREFIX}/lib/powerdns" \
			--with-modules="geo" \
			--with-dynmodules="${BACKENDS}" \
			--with-sqlite3=/usr \
			--with-sqlite3-includes=/usr/include \
			--without-sqlite \
			--disable-recursor # OpenBSD lacks ucontext.h, see PR 5099
CONFIGURE_ENV+=		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib"

EXAMPLE_TABLES=		tables-mysql.sql \
			tables-pgsql.sql \
			tables-sqlite.sql
EXAMPLE_DIR=		${PREFIX}/share/examples/powerdns/

d98 1
d100 1
a100 1
.for t in ${EXAMPLE_TABLES}
@


1.34
log
@sync wantlib (ldap/pg)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2013/11/10 12:38:34 espie Exp $
d21 1
d51 1
a51 1
LIB_DEPENDS-mysql=	databases/mysql
d53 1
a53 1
WANTLIB-mysql+=		crypto lib/mysql/mysqlclient>=10 ssl ${WANTLIB}
@


1.33
log
@use bsd.port.arch.mk
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2013/06/20 06:54:37 ajacoutot Exp $
d20 1
a20 4
REVISION-main=		2
REVISION-mysql=		3
REVISION-pgsql=		1
REVISION-ldap=		1
d64 1
a64 2
WANTLIB-pgsql=		com_err crypto pq>=2 ssl asn1 heimbase krb5 \
			roken wind ${WANTLIB}
d78 1
a78 2
WANTLIB-ldap+=		asn1 com_err crypto gssapi krb5 lber-2.4 ldap_r-2.4 \
			heimbase roken wind sasl2 ssl ${WANTLIB}
@


1.32
log
@Unbreak after hx509 and ntlm removal from Kerberos.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2013/06/18 14:18:47 sthen Exp $
d25 1
a25 1
MULTI_PACKAGES=		-main
d39 1
a39 1
PSEUDO_FLAVORS+=	no_mysql no_pgsql
d44 2
d47 4
a50 1
.if ${FLAVOR:Mno_mysql}
d52 1
a52 3
.else
MULTI_PACKAGES+=	-mysql
CONFIGURE_ARGS+=	--with-mysql=${LOCALBASE}
a55 2
BACKENDS+=		gmysql
.endif
d58 1
a58 4
.if ${FLAVOR:Mno_pgsql}
CONFIGURE_ARGS+=	--without-pgsql
.else
MULTI_PACKAGES+=	-pgsql
d61 4
d69 1
a69 2
BACKENDS+=		gpgsql
.endif
d72 5
a76 1
.if ${FLAVOR:Mno_ldap}
d78 2
a79 2
.else
MULTI_PACKAGES+=	-ldap
a81 2
CONFIGURE_ARGS+=	--with-ldap=${LOCALBASE} \
			--with-ldap-includes=${LOCALBASE}/include
d84 1
a84 2
BACKENDS+=		ldap
.endif
@


1.31
log
@missed bump (kerbV)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2013/06/17 19:28:36 ajacoutot Exp $
d20 4
a23 4
REVISION-main=		1
REVISION-mysql=		2
REVISION-pgsql=		0
REVISION-ldap=		0
d65 1
a65 1
WANTLIB-pgsql=		com_err crypto pq>=2 ssl asn1 heimbase hx509 krb5 \
d80 1
a80 1
			heimbase heimntlm hx509 roken wind sasl2 ssl ${WANTLIB}
@


1.30
log
@Some trivial WANTLIB and tweaks to unbreak after the Heimdal update.
Stop hardcoding the Kerberos libs and use krb5-config(1).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2013/06/12 20:36:34 brad Exp $
a14 1
REVISION-mysql=		1
d21 1
a21 1
REVISION-mysql=		0
@


1.29
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2013/05/25 00:33:10 brad Exp $
d21 4
a24 1
REVISION-main=		0
d31 2
a32 2
WANTLIB=		m stdc++ z
WANTLIB-main=		c pthread sqlite3>=8 ${WANTLIB}
d66 2
a67 1
WANTLIB-pgsql=		com_err crypto pq>=2 ssl ${WANTLIB}
d80 2
a81 1
WANTLIB-ldap+=		asn1 com_err crypto gssapi krb5 lber-2.4 ldap_r-2.4 sasl2 ssl ${WANTLIB}
@


1.28
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2013/03/21 08:46:35 ajacoutot Exp $
d15 1
a15 1
REVISION-mysql=		0
d48 1
a48 1
LIB_DEPENDS-mysql=	databases/mariadb
@


1.27
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2013/03/11 11:35:55 espie Exp $
d15 1
d48 1
a48 1
LIB_DEPENDS-mysql=	databases/mysql
@


1.26
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2013/02/09 14:49:52 sthen Exp $
a82 1
USE_LIBTOOL=		Yes
@


1.25
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/05/17 21:39:44 sthen Exp $
a25 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d32 1
a32 1
NO_REGRESS=		Yes
@


1.24
log
@Tweak powerdns wantlib; libz is common so put it in WANTLIB rather than
all the various WANTLIB-foo.  From Brad, no pkg change.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/05/17 10:27:02 sthen Exp $
d45 1
a45 1
.if ${FLAVOR:L:Mno_mysql}
d57 1
a57 1
.if ${FLAVOR:L:Mno_pgsql}
d70 1
a70 1
.if ${FLAVOR:L:Mno_ldap}
@


1.23
log
@roll sqlite3 into the main PowerDNS package, remove sqlite2 support, from Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2012/04/25 23:03:09 espie Exp $
d30 2
a31 2
WANTLIB=		m stdc++
WANTLIB-main=		c pthread sqlite3>=8 z ${WANTLIB}
d52 1
a52 1
WANTLIB-mysql+=		crypto lib/mysql/mysqlclient>=10 ssl z ${WANTLIB}
d65 1
a65 1
WANTLIB-pgsql=		com_err crypto pq>=2 ssl z ${WANTLIB}
d78 1
a78 1
WANTLIB-ldap+=		asn1 com_err crypto gssapi krb5 lber-2.4 ldap_r-2.4 sasl2 ssl z ${WANTLIB}
@


1.22
log
@sqlite in base
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2012/04/23 17:15:18 espie Exp $
a7 2
COMMENT-sqlite=		SQLite database access module for PowerDNS
COMMENT-sqlite3=	SQLite3 database access module for PowerDNS
a15 2
PKGNAME-sqlite=		powerdns-sqlite-${V}
PKGNAME-sqlite3=	powerdns-sqlite3-${V}
d20 2
d31 1
a31 1
WANTLIB-main=		c pthread z ${WANTLIB}
d39 1
a39 1
PSEUDO_FLAVORS+=	no_mysql no_pgsql no_sqlite no_sqlite3
d42 1
a42 1
BACKENDS=
a68 27
# SQLite
.if ${FLAVOR:L:Mno_sqlite}
CONFIGURE_ARGS+=	--without-sqlite
.else
MULTI_PACKAGES+=	-sqlite
CONFIGURE_ARGS+=	--with-sqlite=${LOCALBASE} \
			--with-sqlite-includes=${LOCALBASE}/include
LIB_DEPENDS-sqlite=	databases/sqlite
RUN_DEPENDS-sqlite=	${FULLPKGNAME-main}:net/powerdns
WANTLIB-sqlite+=	sqlite>=8 z ${WANTLIB}
BACKENDS+=		gsqlite
.endif

# SQLite3
.if ${FLAVOR:L:Mno_sqlite3}
CONFIGURE_ARGS+=	--without-sqlite3
.else
MULTI_PACKAGES+=	-sqlite3
CONFIGURE_ARGS+=	--with-sqlite3=/usr \
			--with-sqlite3-includes=/usr/include
LIB_DEPENDS-sqlite3=	
RUN_DEPENDS-sqlite3=	${FULLPKGNAME-main}:net/powerdns
WANTLIB-sqlite3+=	sqlite3>=8 z ${WANTLIB}
BACKENDS+=		gsqlite3
REVISION-sqlite3 =		0
.endif

d93 3
@


1.21
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2012/01/28 08:07:26 sthen Exp $
d89 2
a90 2
CONFIGURE_ARGS+=	--with-sqlite3=${LOCALBASE} \
			--with-sqlite3-includes=${LOCALBASE}/include
@


1.20
log
@update to powerdns 2.9.22.6, ok ajacoutot@@

   The improvements to the master/slave engine in 2.9.22.5 contained one
   serious bug that can cause crashes on busy setups. 2.9.22.6 fixes this
   crash.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2012/01/11 02:01:59 sthen Exp $
d91 1
a91 1
LIB_DEPENDS-sqlite3=	databases/sqlite3
d95 1
@


1.19
log
@fix whitespace
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2012/01/11 01:41:47 sthen Exp $
d12 1
a12 1
V=			2.9.22.5
@


1.18
log
@update to PowerDNS 2.9.22.5; CVE-2012-0206; can be caused to loop packets
http://doc.powerdns.com/powerdns-advisory-2012-01.html - From Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/12/17 22:01:13 sthen Exp $
d54 1
a54 1
WANTLIB-mysql+= 	crypto lib/mysql/mysqlclient>=10 ssl z ${WANTLIB}
d110 1
a110 1
BUILD_DEPENDS+=          ${MODGNU_AUTOCONF_DEPENDS}
d122 2
a123 2
CONFIGURE_ENV+=         CPPFLAGS="-I${LOCALBASE}/include" \
                        LDFLAGS="-L${LOCALBASE}/lib"
d125 1
a125 1
EXAMPLE_TABLES= 	tables-mysql.sql \
@


1.17
log
@Where a program with an rc script _requires_ a certain command line
parameter to daemonize, move the parameter from daemon to daemon_flags,
so that the user cannot inadvertently prevent it from daemonizing by
adjusting the flags.

Discussed with ajacoutot and schwarze, this method was suggested
by schwarze@@ as a simpler alternative to my diff. ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/10/28 07:23:39 jasper Exp $
d6 5
a10 5
COMMENT-mysql=		mysql database access module for powerdns
COMMENT-pgsql=		pgsql database access module for powerdns
COMMENT-sqlite=		sqlite database access module for powerdns
COMMENT-sqlite3=	sqlite3 database access module for powerdns
COMMENT-ldap=		ldap module for powerdns
d12 1
a12 1
V=			2.9.22
a23 7
REVISION-main=		2
REVISION-mysql=		0
REVISION-pgsql=		0
REVISION-sqlite=	0
REVISION-sqlite3=	0
REVISION-ldap=		0

d32 2
a33 1
WANTLIB-main=		c m pthread stdc++ z
a36 1
USE_GROFF =		Yes
d54 1
a54 1
WANTLIB-mysql+= 	crypto m ssl z lib/mysql/mysqlclient>=10
d67 1
a67 1
WANTLIB-pgsql=		crypto ssl z pq>=2
d80 1
a80 1
WANTLIB-sqlite+=	z sqlite>=8 
d93 1
a93 1
WANTLIB-sqlite3+=	z sqlite3>=8
d106 1
a106 1
WANTLIB-ldap+=		asn1 com_err crypto gssapi krb5 sasl2 ssl z lber ldap_r
a109 2
USE_LIBTOOL=		Yes

d112 1
a112 1
AUTOCONF_VERSION=	2.61
d114 4
a117 4
CONFIGURE_STYLE=	gnu autoconf
CONFIGURE_ENV+=		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib"
CONFIGURE_ARGS+=	--enable-shared=no \
d122 2
a138 2

CONFIGURE_ARGS+=	--sysconfdir="${SYSCONFDIR}/pdns" \
@


1.16
log
@missing bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/09/16 11:13:39 espie Exp $
d18 1
a18 1
PKGNAME-sqlite= 	powerdns-sqlite-${V}
d24 6
a29 6
REVISION-main=		1
REVISION-mysql =	0
REVISION-pgsql =	0
REVISION-sqlite =	0
REVISION-sqlite3 =	0
REVISION-ldap =		0
@


1.15
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/05/11 12:03:19 jasper Exp $
d24 1
a24 1
REVISION-main=		0
@


1.14
log
@Sanitize some @@unexec/@@extraunexec calls to rm: move them up in the
PLIST and delete everything under the @@sample'd directory instead of the
directory itself to prevent a warning from pkg_delete(1) trying to
remove a non existing directory and to help preventing left-over files
and directories.

ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2010/11/19 22:31:37 espie Exp $
d25 5
@


1.14.2.1
log
@MFC: update to PowerDNS 2.9.22.5; CVE-2012-0206; can be caused to loop packets
http://doc.powerdns.com/powerdns-advisory-2012-01.html - From Brad

With a slight tweak as BASESYSCONFDIR was not supported in 5.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2012/01/11 01:41:47 sthen Exp $
d6 5
a10 5
COMMENT-mysql=		MySQL database access module for PowerDNS
COMMENT-pgsql=		PGSQL database access module for PowerDNS
COMMENT-sqlite=		SQLite database access module for PowerDNS
COMMENT-sqlite3=	SQLite3 database access module for PowerDNS
COMMENT-ldap=		LDAP module for PowerDNS
d12 1
a12 1
V=			2.9.22.5
d18 1
a18 1
PKGNAME-sqlite=		powerdns-sqlite-${V}
d24 2
d34 1
a34 2
WANTLIB=		m stdc++
WANTLIB-main=		c pthread z ${WANTLIB}
d38 1
d56 1
a56 1
WANTLIB-mysql+= 	crypto lib/mysql/mysqlclient>=10 ssl z ${WANTLIB}
d69 1
a69 1
WANTLIB-pgsql=		com_err crypto pq>=2 ssl z ${WANTLIB}
d82 1
a82 1
WANTLIB-sqlite+=	sqlite>=8 z ${WANTLIB}
d95 1
a95 1
WANTLIB-sqlite3+=	sqlite3>=8 z ${WANTLIB}
d108 1
a108 1
WANTLIB-ldap+=		asn1 com_err crypto gssapi krb5 lber-2.4 ldap_r-2.4 sasl2 ssl z ${WANTLIB}
d112 2
d116 6
a121 4
USE_LIBTOOL=		Yes
CONFIGURE_STYLE=	autoconf
AUTOCONF_VERSION=	2.65
CONFIGURE_ARGS+=	--disable-shared \
a125 2
CONFIGURE_ENV+=         CPPFLAGS="-I${LOCALBASE}/include" \
                        LDFLAGS="-L${LOCALBASE}/lib"
@


1.14.2.2
log
@MFC powerdns update to 2.9.22.6

--/--
update to powerdns 2.9.22.6, ok ajacoutot@@

The improvements to the master/slave engine in 2.9.22.5 contained one
serious bug that can cause crashes on busy setups. 2.9.22.6 fixes this
crash.
--/--
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14.2.1 2012/01/11 02:01:18 sthen Exp $
d12 1
a12 1
V=			2.9.22.6
@


1.14.2.3
log
@Restore -rdynamic -> -Wl,-export-dynamic patch for PowerDNS in 5.0-stable,
this is still needed until post-5.0.

Problem reported by mailinglist@@modernbiztonsag.org, cause identified by
Brad, diff from me, no response to testing request but it should be correct.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14.2.2 2012/01/28 10:49:34 sthen Exp $
a12 1
REVISION=		0
@


1.13
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2010/11/11 16:27:55 espie Exp $
d23 2
@


1.12
log
@new WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2010/10/18 18:36:56 espie Exp $
d39 1
a39 1
BUILD_DEPENDS=		::devel/boost
d52 3
a54 3
LIB_DEPENDS-mysql=	::databases/mysql
RUN_DEPENDS-mysql=	:${FULLPKGNAME-main}:net/powerdns
WANTLIB-mysql+= 	crypto m ssl z lib/mysql/mysqlclient.>=10
d65 3
a67 3
LIB_DEPENDS-pgsql=	::databases/postgresql,-main
RUN_DEPENDS-pgsql=	:${FULLPKGNAME-main}:net/powerdns
WANTLIB-pgsql=		crypto ssl z pq.>=2
d78 3
a80 3
LIB_DEPENDS-sqlite=	::databases/sqlite
RUN_DEPENDS-sqlite=	:${FULLPKGNAME-main}:net/powerdns
WANTLIB-sqlite+=	z sqlite.>=8 
d91 3
a93 3
LIB_DEPENDS-sqlite3=	::databases/sqlite3
RUN_DEPENDS-sqlite3=	:${FULLPKGNAME-main}:net/powerdns
WANTLIB-sqlite3+=	z sqlite3.>=8
d102 2
a103 2
LIB_DEPENDS-ldap=	::databases/openldap
RUN_DEPENDS-ldap=	:${FULLPKGNAME-main}:net/powerdns
@


1.11
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2009/06/23 22:59:57 sthen Exp $
d36 1
a36 1
USE_GROFF =	Yes
d52 1
a52 1
LIB_DEPENDS-mysql=	lib/mysql/mysqlclient.>=10::databases/mysql
d54 1
a54 1
WANTLIB-mysql+= 	crypto m ssl z
d65 1
a65 1
LIB_DEPENDS-pgsql=	pq.>=2::databases/postgresql,-main
d67 1
a67 1
WANTLIB-pgsql=		crypto ssl z
d78 1
a78 1
LIB_DEPENDS-sqlite=	sqlite.>=8::databases/sqlite
d80 1
a80 1
WANTLIB-sqlite+=	z
d91 1
a91 1
LIB_DEPENDS-sqlite3=	sqlite3.>=8::databases/sqlite3
d93 1
a93 1
WANTLIB-sqlite3+=	z
d102 1
a102 1
LIB_DEPENDS-ldap=	lber,ldap_r::databases/openldap
d106 1
a106 1
WANTLIB-ldap+=		asn1 com_err crypto gssapi krb5 sasl2 ssl z
@


1.10
log
@- update to 2.9.22, enable ldap.

- unbreak modules; when any module was enabled pdns_server was failing
to start up(!). Brad traced this to a LINK_SPEC problem and came up
with the workaround in patch-configure_in, thanks very much!

- set SHARED_ONLY and merge PFRAG.shared into PLISTs; PowerDNS itself
can work static-only, but you need to compile-in the relevant modules,
which doesn't mix well with MULTI_PACKAGES.

mysql backend is tested; other backends not yet, but this is a big
improvement on what's there at the moment.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2009/06/18 20:08:25 naddy Exp $
d36 1
@


1.9
log
@* don't compile in gmysql module, use --with-modules to override default
* fixup wantlibs
* make module subpackages depend on main server package

with sthen@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.8 2009/06/18 01:42:41 sthen Exp $
d10 1
d12 1
a12 1
V=			2.9.21.2
d15 6
a20 5
PKGNAME-main=		powerdns-${V}p3
PKGNAME-mysql=		powerdns-mysql-${V}p2
PKGNAME-pgsql=		powerdns-pgsql-${V}p2
PKGNAME-sqlite= 	powerdns-sqlite-${V}p2
PKGNAME-sqlite3=	powerdns-sqlite3-${V}p2
a23 6
SHARED_LIBS=		geobackend 	0.0 \
			gmysqlbackend	0.0 \
			gpgsqlbackend	0.0 \
			gsqlite3backend	0.0 \
			gsqlitebackend	0.0

d66 1
d96 13
d118 3
a120 1
CONFIGURE_ARGS+=	--with-modules="geo" \
d139 1
a139 1
CONFIGURE_ARGS+=	--sysconfdir="${SYSCONFDIR}/pdns"
@


1.8
log
@the main powerdns binary gets linked with mysqlclient; actually only
the mysql module should be linking with it. work-around this problem
for now by adding a LIB_DEPENDS-main on mysqlclient. this ensures that
people pkg_add'ing have the relevant library available. no functional
change for existing users.

nobody screamed when I sent it to ports@@, and it's better than the
current state, but still this is an incorrect fix to unbreak the
package, it should be fixed properly.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2009/02/11 08:15:20 jasper Exp $
d12 5
a16 5
PKGNAME-main=		powerdns-${V}p2
PKGNAME-mysql=		powerdns-mysql-${V}p1
PKGNAME-pgsql=		powerdns-pgsql-${V}p1
PKGNAME-sqlite= 	powerdns-sqlite-${V}p1
PKGNAME-sqlite3=	powerdns-sqlite3-${V}p1
d34 1
a34 1
WANTLIB-main=		c crypto m pthread ssl stdc++ z
a46 7
# XXX this is wrong. but at least it means packages work.
#
# the main binary gets linked with mysqlclient; actually only the
# mysql module should link with it.
#
LIB_DEPENDS-main=	lib/mysql/mysqlclient.>=10::databases/mysql

d54 2
a55 1
WANTLIB-mysql+= 	z
d66 2
a67 1
LIB_DEPENDS-pgsql=	pq.>=2:postgresql-client-*:databases/postgresql
d79 1
d92 1
d106 2
a107 1
CONFIGURE_ARGS+=	--with-dynmodules="${BACKENDS}" \
@


1.7
log
@- tweak the command for rc.local, prodded by Piotr Sikora
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2009/02/10 21:38:51 jasper Exp $
d12 5
a16 5
PKGNAME-main=		powerdns-${V}p1
PKGNAME-mysql=		powerdns-mysql-${V}p0
PKGNAME-pgsql=		powerdns-pgsql-${V}p0
PKGNAME-sqlite= 	powerdns-sqlite-${V}p0
PKGNAME-sqlite3=	powerdns-sqlite3-${V}p0
d46 7
@


1.6
log
@hmm...i forgot to bump the package names; fixit
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2009/02/10 21:05:09 jasper Exp $
d12 1
a12 1
PKGNAME-main=		powerdns-${V}p0
@


1.5
log
@- fix typo in COMMENT
- completely overhaul DESCR files

from Piotr Sikora, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2008/12/16 10:30:27 jasper Exp $
d12 5
a16 5
PKGNAME-main=		powerdns-${V}
PKGNAME-mysql=		powerdns-mysql-${V}
PKGNAME-pgsql=		powerdns-pgsql-${V}
PKGNAME-sqlite= 	powerdns-sqlite-${V}
PKGNAME-sqlite3=	powerdns-sqlite3-${V}
@


1.4
log
@- SECURITY UPDATE of powerdns to 2.9.21.2
* fixes CVE-2008-5277 "CH HINFO Denial of Service Vulnerability"
- sprinkle some comments in the patch-files
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2008/10/28 15:21:49 naddy Exp $
d4 1
a4 1
COMMENT-mysql=		mysql database access emodule for powerdns
@


1.3
log
@Change "${SYSCONFDIR}" to "/etc" for files that are *always* in the
latter location.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2008/10/07 21:02:53 jasper Exp $
d9 1
a9 1
V=			2.9.21.1
d12 1
a12 1
PKGNAME-main=		powerdns-${V}p1
d95 5
a99 1
CONFIGURE_STYLE=	gnu
@


1.2
log
@- re-organize Makefile a bit
- rename user and use it's id in pdns.conf
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2008/10/02 18:40:41 jasper Exp $
d12 1
a12 1
PKGNAME-main=		powerdns-${V}p0
@


1.1
log
@Initial revision
@
text
@d1 7
a7 1
# $OpenBSD$
d12 5
a19 6
COMMENT-main=		modern authoritative nameserver
COMMENT-mysql=		mysql database access emodule for powerdns
COMMENT-pgsql=		pgsql database access module for powerdns
COMMENT-sqlite=		sqlite database access module for powerdns
COMMENT-sqlite3=	sqlite3 database access module for powerdns

d42 1
d47 1
a47 2
# mysql
PSEUDO_FLAVORS+=	no_mysql
d58 1
a58 2
# postgresql
PSEUDO_FLAVORS+=	no_pgsql
d69 1
a69 2
# sqlite
PSEUDO_FLAVORS+=	no_sqlite
d81 1
a81 2
# sqlite3
PSEUDO_FLAVORS+=	no_sqlite3
@


1.1.1.1
log
@import powerdns 2.9.21.1

pdnsd is a proxy dns server with permanent caching (the cache
contents are written to hard disk on exit) that is designed to cope
with unreachable or down dns servers (for example in dial-in
networking).

original port by dlg@@ and robert@@, banged into shape by me.
not hooked to the builds as this needs further testing/tweaking
@
text
@@
