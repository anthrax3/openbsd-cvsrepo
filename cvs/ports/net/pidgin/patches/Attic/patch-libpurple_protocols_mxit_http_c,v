head	1.1;
access;
symbols
	OPENBSD_5_9:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2016.07.05.07.16.52;	author jasper;	state dead;
branches
	1.1.2.1;
next	;
commitid	ATFCg0d2YCHGzcS2;

1.1.2.1
date	2016.07.05.07.16.52;	author jasper;	state Exp;
branches;
next	;
commitid	ATFCg0d2YCHGzcS2;


desc
@@


1.1
log
@file patch-libpurple_protocols_mxit_http_c was initially added on branch OPENBSD_5_9.
@
text
@@


1.1.2.1
log
@Security fixes for: CVE-2016-2376 - CVE 2016-2380, CVE-2016-4323,
CVE-2016-2365 - CVE-2016-2375 (only affecting the mxit protocol)

originally pointed out by Jeremy Thorn
@
text
@a0 73
$OpenBSD$

Security fixes for:
CVE-2016-2376 - CVE 2016-2380,
CVE 2016-4323,
CVE-2016-2365 - CVE-2016-2375

--- libpurple/protocols/mxit/http.c.orig	Mon Jul  4 13:22:37 2016
+++ libpurple/protocols/mxit/http.c	Mon Jul  4 13:22:58 2016
@@@@ -63,9 +63,9 @@@@ static void free_http_request( struct http_request* re
  *  @@param pktlen		The length of the packet data
  *  @@return				Return -1 on error, otherwise 0
  */
-static int mxit_http_raw_write( int fd, const char* pktdata, int pktlen )
+static int mxit_http_raw_write( int fd, const char* pktdata, size_t pktlen )
 {
-	int		written;
+	size_t	written;
 	int		res;
 
 	written = 0;
@@@@ -97,9 +97,9 @@@@ static void mxit_cb_http_read( gpointer user_data, gin
 {
 	struct MXitSession*	session		= (struct MXitSession*) user_data;
 	char				buf[256];
-	int					buflen;
+	unsigned int		buflen;
 	char*				body;
-	int					bodylen;
+	unsigned int		bodylen;
 	char*				ch;
 	int					len;
 	char*				tmp;
@@@@ -182,7 +182,7 @@@@ nextpacket:
 			goto done;
 		}
 		tmp = g_strndup( ch, tmp - ch );
-		bodylen = atoi( tmp );
+		bodylen = strtoul( tmp, NULL, 10 );
 		g_free( tmp );
 		tmp = NULL;
 
@@@@ -315,22 +315,25 @@@@ static void mxit_cb_http_connect( gpointer user_data, 
  *	@@param session		The MXit session object
  *	@@param host			The server name to connect to
  *	@@param port			The port number to connect to
- *	@@param data			The HTTP request data (including HTTP headers etc.)
+ *	@@param header		The HTTP header.
+ *	@@param data			The HTTP request data.
  *	@@param datalen		The HTTP request data length
  */
-void mxit_http_send_request( struct MXitSession* session, char* host, int port, const char* data, int datalen )
+void mxit_http_send_request( struct MXitSession* session, char* host, int port, gchar* header, const char* data, size_t datalen )
 {
 	PurpleProxyConnectData*		con	= NULL;
 	struct http_request*		req;
+	size_t						headerlen = strlen( header );
 
 	/* build the http request */
 	req = g_new0( struct http_request, 1 );
 	req->session = session;
 	req->host = host;
 	req->port = port;
-	req->data = g_malloc0( datalen );
-	memcpy( req->data, data, datalen );
-	req->datalen = datalen;
+	req->data = g_malloc0( headerlen + datalen );
+	memcpy( req->data, header, headerlen );
+	memcpy( req->data + headerlen, data, datalen );
+	req->datalen = headerlen + datalen;
 
 	/* open connection to the HTTP server */
 	con = purple_proxy_connect( NULL, session->acc, host, port, mxit_cb_http_connect, req );
@

