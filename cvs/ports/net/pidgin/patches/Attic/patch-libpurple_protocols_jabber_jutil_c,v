head	1.1;
access;
symbols
	OPENBSD_5_6:1.1.0.6
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_4:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2014.10.30.07.37.30;	author brad;	state dead;
branches
	1.1.2.1
	1.1.4.1
	1.1.6.1;
next	;
commitid	m6VWQUdGf2sBMx2J;

1.1.2.1
date	2014.10.30.07.37.30;	author brad;	state Exp;
branches;
next	;
commitid	m6VWQUdGf2sBMx2J;

1.1.4.1
date	2014.10.30.07.39.10;	author brad;	state Exp;
branches;
next	;
commitid	WQNd7LozvjAC4lPY;

1.1.6.1
date	2014.10.30.07.40.49;	author brad;	state Exp;
branches;
next	;
commitid	zm0kqMBvEx3BHQZ2;


desc
@@


1.1
log
@file patch-libpurple_protocols_jabber_jutil_c was initially added on branch OPENBSD_5_4.
@
text
@@


1.1.6.1
log
@Security fixes from 2.10.10... CVE-2014-3695, CVE-2014-3696, CVE-2014-3698.

The commit for 2.10.10 mentioned CVE-2014-3697 but after looking at it
again I noticed it is a Windows specific issue.
@
text
@a0 28
$OpenBSD$

Potential information leak from XMPP. CVE-2014-3698

--- libpurple/protocols/jabber/jutil.c.orig	Thu Oct 30 02:35:23 2014
+++ libpurple/protocols/jabber/jutil.c	Thu Oct 30 02:41:25 2014
@@@@ -81,10 +81,10 @@@@ jabber_idn_validate(const char *str, const char *at, c
 
 		if (slash) {
 			domain_len = slash - str;
-			resource = slash;
+			resource = slash + 1;
 			resource_len = null - (slash + 1);
 		} else {
-			domain_len = null - (str + 1);
+			domain_len = null - str;
 		}
 	}
 
@@@@ -126,6 +126,8 @@@@ jabber_idn_validate(const char *str, const char *at, c
 			jid = NULL;
 			goto out;
 		}
+
+		jid->domain = g_strndup(domain, domain_len);
 	} else {
 		/* Apply nameprep */
 		if (stringprep_nameprep(idn_buffer, sizeof(idn_buffer)) != STRINGPREP_OK) {
@


1.1.4.1
log
@Security fixes from 2.10.10... CVE-2014-3695, CVE-2014-3696, CVE-2014-3698.

The commit for 2.10.10 mentioned CVE-2014-3697 but after looking at it
again I noticed it is a Windows specific isue.
@
text
@a0 28
$OpenBSD$

Potential information leak from XMPP. CVE-2014-3698

--- libpurple/protocols/jabber/jutil.c.orig	Thu Oct 30 02:35:23 2014
+++ libpurple/protocols/jabber/jutil.c	Thu Oct 30 02:41:25 2014
@@@@ -81,10 +81,10 @@@@ jabber_idn_validate(const char *str, const char *at, c
 
 		if (slash) {
 			domain_len = slash - str;
-			resource = slash;
+			resource = slash + 1;
 			resource_len = null - (slash + 1);
 		} else {
-			domain_len = null - (str + 1);
+			domain_len = null - str;
 		}
 	}
 
@@@@ -126,6 +126,8 @@@@ jabber_idn_validate(const char *str, const char *at, c
 			jid = NULL;
 			goto out;
 		}
+
+		jid->domain = g_strndup(domain, domain_len);
 	} else {
 		/* Apply nameprep */
 		if (stringprep_nameprep(idn_buffer, sizeof(idn_buffer)) != STRINGPREP_OK) {
@


1.1.2.1
log
@Security fixes from 2.10.10... CVE-2014-3695, CVE-2014-3696, CVE-2014-3698.

The commit for 2.10.10 mentioned CVE-2014-3697 but after looking at it
again I noticed it is a Windows specific isue.
@
text
@a0 28
$OpenBSD$

Potential information leak from XMPP. CVE-2014-3698

--- libpurple/protocols/jabber/jutil.c.orig	Thu Oct 30 02:35:23 2014
+++ libpurple/protocols/jabber/jutil.c	Thu Oct 30 02:41:25 2014
@@@@ -81,10 +81,10 @@@@ jabber_idn_validate(const char *str, const char *at, c
 
 		if (slash) {
 			domain_len = slash - str;
-			resource = slash;
+			resource = slash + 1;
 			resource_len = null - (slash + 1);
 		} else {
-			domain_len = null - (str + 1);
+			domain_len = null - str;
 		}
 	}
 
@@@@ -126,6 +126,8 @@@@ jabber_idn_validate(const char *str, const char *at, c
 			jid = NULL;
 			goto out;
 		}
+
+		jid->domain = g_strndup(domain, domain_len);
 	} else {
 		/* Apply nameprep */
 		if (stringprep_nameprep(idn_buffer, sizeof(idn_buffer)) != STRINGPREP_OK) {
@

