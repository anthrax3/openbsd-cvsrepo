head	1.6;
access;
symbols
	OPENBSD_6_2:1.6.0.30
	OPENBSD_6_2_BASE:1.6
	OPENBSD_6_1:1.6.0.28
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.6.0.26
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.22
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.24
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.20
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.18
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.16
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.14
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.12
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.10
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.8
	OPENBSD_5_0:1.6.0.6
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.4
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.2
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.5.0.8
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.6
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.4
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.2
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.3.0.2
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.2.0.8
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.6
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.4
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.2
	OPENBSD_3_9_BASE:1.2;
locks; strict;
comment	@# @;


1.6
date	2010.04.09.09.48.18;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2008.07.15.16.11.02;	author brad;	state Exp;
branches
	1.5.8.1;
next	1.4;

1.4
date	2008.03.31.11.39.48;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2008.01.16.21.02.49;	author kili;	state Exp;
branches;
next	1.2;

1.2
date	2006.01.29.21.27.52;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2005.10.15.03.21.13;	author brad;	state Exp;
branches;
next	;

1.5.8.1
date	2010.06.24.01.33.14;	author william;	state Exp;
branches;
next	;


desc
@@


1.6
log
@- Security update of libnids to 1.24
http://freefr.dl.sourceforge.net/project/libnids/libnids/1.24/libnids-1.24.releasenotes.txt

- Bump dsniff as it statically links to libnids, suggested by sthen@@

ok sthen@@
@
text
@$OpenBSD: patch-src_libnids_c,v 1.5 2008/07/15 16:11:02 brad Exp $
--- src/libnids.c.orig	Mon Mar  1 22:13:25 2010
+++ src/libnids.c	Fri Apr  9 10:00:43 2010
@@@@ -14,7 +14,9 @@@@
 #include <stdlib.h>
 #include <string.h>
 #include <syslog.h>
+#ifndef __OpenBSD__
 #include <alloca.h>
+#endif
 #include <pcap.h>
 #include <errno.h>
 #include <config.h>
@@@@ -32,6 +34,12 @@@@
 #include <glib.h>
 #endif
 
+#ifdef DLT_PFLOG
+#include <sys/socket.h>
+#include <net/if.h>
+#include <net/if_pflog.h>
+#endif
+
 #ifdef __linux__
 extern int set_all_promisc();
 #endif
@@@@ -619,22 +627,46 @@@@ int nids_init()
     case DLT_NULL:
         nids_linkoffset = 4;
         break;
-#endif        
+#endif
+#ifdef DLT_LOOP
+    case DLT_LOOP:
+        nids_linkoffset = 4;
+        break;
+#endif
     case DLT_EN10MB:
 	nids_linkoffset = 14;
 	break;
     case DLT_PPP:
 	nids_linkoffset = 4;
 	break;
+#ifdef DLT_PPP_ETHER
+    case DLT_PPP_ETHER:
+	nids_linkoffset = 8;
+	break;
+#endif
 	/* Token Ring Support by vacuum@@technotronic.com, thanks dugsong! */
     case DLT_IEEE802:
 	nids_linkoffset = 22;
 	break;
-
     case DLT_RAW:
     case DLT_SLIP:
 	nids_linkoffset = 0;
 	break;
+#ifdef DLT_OLD_PFLOG
+    case DLT_OLD_PFLOG:
+	nids_linkoffset = 28;
+	break;
+#endif
+#ifdef DLT_PFLOG
+    case DLT_PFLOG:
+	nids_linkoffset = PFLOG_HDRLEN;
+	break;
+#endif
+#ifdef DLT_PFSYNC
+    case DLT_PFSYNC:
+	nids_linkoffset = 4;
+	break;
+#endif
 #define DLT_LINUX_SLL   113
     case DLT_LINUX_SLL:
 	nids_linkoffset = 16;
@


1.5
log
@upgrade to libnids 1.23.

ok sthen@@
@
text
@d1 14
a14 4
$OpenBSD: patch-src_libnids_c,v 1.4 2008/03/31 11:39:48 sthen Exp $
--- src/libnids.c.orig	Thu Feb 21 05:47:12 2008
+++ src/libnids.c	Wed Jul  9 23:20:06 2008
@@@@ -31,6 +31,12 @@@@
d27 1
a27 1
@@@@ -618,22 +624,46 @@@@ int nids_init()
@


1.5.8.1
log
@MFC:

SECURITY UPDATE to libnids-1.24
http://freefr.dl.sourceforge.net/project/libnids/libnids/1.24/libnids-1.24.releasenotes.txt

Also bump dsniff as it statically links to libnids (originally suggested
by sthen@@ for -current)

ok jasper@@
@
text
@d1 4
a4 14
$OpenBSD: patch-src_libnids_c,v 1.5 2008/07/15 16:11:02 brad Exp $
--- src/libnids.c.orig	Mon Mar  1 22:13:25 2010
+++ src/libnids.c	Fri Apr  9 10:00:43 2010
@@@@ -14,7 +14,9 @@@@
 #include <stdlib.h>
 #include <string.h>
 #include <syslog.h>
+#ifndef __OpenBSD__
 #include <alloca.h>
+#endif
 #include <pcap.h>
 #include <errno.h>
 #include <config.h>
@@@@ -32,6 +34,12 @@@@
d17 1
a17 1
@@@@ -619,22 +627,46 @@@@ int nids_init()
@


1.4
log
@Add pflog/pfsync support to libnids. From Brad, tested by me.
@
text
@d1 6
a6 6
$OpenBSD: patch-src_libnids_c,v 1.3 2008/01/16 21:02:49 kili Exp $
--- src/libnids.c.orig	Sat Jan 29 05:03:24 2005
+++ src/libnids.c	Fri Jan 25 19:06:09 2008
@@@@ -28,6 +28,12 @@@@
 #include "util.h"
 #include "nids.h"
d17 1
a17 17
@@@@ -214,6 +220,7 @@@@ static void pcap_hand(u_char * par, struct pcap_pkthdr
 #endif
 #ifdef DLT_IEEE802_11
     case DLT_IEEE802_11:
+    case DLT_IEEE802_11_RADIO:
 	/* I don't know why frame control is always little endian, but it 
 	 * works for tcpdump, so who am I to complain? (wam)
 	 */
@@@@ -462,6 +469,7 @@@@ int nids_init()
     case DLT_PRISM_HEADER:
 #endif
     case DLT_IEEE802_11:
+    case DLT_IEEE802_11_RADIO:
 	/* wireless, need to calculate offset per frame */
 	break;
 #endif
@@@@ -469,22 +477,46 @@@@ int nids_init()
d19 1
a19 1
         linkoffset = 4;
d25 1
a25 1
+        linkoffset = 4;
d29 1
a29 1
 	linkoffset = 14;
d32 1
a32 1
 	linkoffset = 4;
d36 1
a36 1
+	linkoffset = 8;
d41 1
a41 1
 	linkoffset = 22;
d46 1
a46 1
 	linkoffset = 0;
d50 1
a50 1
+	linkoffset = 28;
d55 1
a55 1
+	linkoffset = PFLOG_HDRLEN;
d60 1
a60 1
+	linkoffset = 4;
d65 1
a65 1
 	linkoffset = 16;
@


1.3
log
@
Support DLT_PPP_ETHER for use with kernel PPPoE.

From Brad.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_libnids_c,v 1.2 2006/01/29 21:27:52 brad Exp $
d3 15
a17 2
+++ src/libnids.c	Mon Nov  5 04:30:05 2007
@@@@ -214,6 +214,7 @@@@ static void pcap_hand(u_char * par, struct pcap_pkthdr
d25 1
a25 1
@@@@ -462,6 +463,7 @@@@ int nids_init()
d33 1
a33 1
@@@@ -469,12 +471,20 @@@@ int nids_init()
d49 2
a50 1
+	break;
d53 2
a54 1
 	break;
d57 25
@


1.2
log
@upgrade to libnids 1.20; fixes crashing with TCP options parsing.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_libnids_c,v 1.1 2005/10/15 03:21:13 brad Exp $
d3 2
a4 2
+++ src/libnids.c	Sun Jan 29 13:43:53 2006
@@@@ -214,6 +214,7 @@@@ static void pcap_hand(u_char * par, stru
d20 1
a20 1
@@@@ -469,7 +471,12 @@@@ int nids_init()
d34 8
@


1.1
log
@recognize some other DLT types, this allows me to use dsniff on tun(4).
@
text
@d1 5
a5 5
$OpenBSD$
--- src/libnids.c.orig	Fri Oct 10 13:41:32 2003
+++ src/libnids.c	Fri Oct 14 22:58:32 2005
@@@@ -198,6 +198,7 @@@@ static void pcap_hand(u_char * par, stru
 	break;
d12 3
a14 3
@@@@ -441,6 +442,7 @@@@ int nids_init()
     switch ((linktype = pcap_datalink(desc))) {
 #ifdef DLT_IEEE802_11
d20 1
a20 1
@@@@ -448,7 +450,12 @@@@ int nids_init()
@

