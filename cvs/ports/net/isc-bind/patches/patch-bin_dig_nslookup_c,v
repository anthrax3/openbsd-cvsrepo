head	1.2;
access;
symbols
	OPENBSD_6_1:1.1.0.4
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2017.05.03.20.20.42;	author sthen;	state Exp;
branches;
next	1.1;
commitid	Mn85r2RkIV0pryCt;

1.1
date	2017.01.24.11.46.35;	author sthen;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;
commitid	XRs8XNeIv80JWdqa;

1.1.2.1
date	2017.02.09.00.05.52;	author sthen;	state Exp;
branches;
next	;
commitid	DEfadRDbdVXIVfRp;

1.1.4.1
date	2017.06.15.09.02.53;	author sthen;	state Exp;
branches;
next	;
commitid	eRLhuEKkg8KPPcb4;


desc
@@


1.2
log
@update to BIND 9.10.5
@
text
@$OpenBSD: patch-bin_dig_nslookup_c,v 1.1 2017/01/24 11:46:35 sthen Exp $
--- bin/dig/nslookup.c.orig	Fri Apr 14 04:54:11 2017
+++ bin/dig/nslookup.c	Thu Apr 20 09:35:26 2017
@@@@ -913,8 +913,19 @@@@ main(int argc, char **argv) {
 	result = isc_app_start();
 	check_result(result, "isc_app_start");
 
+	if (pledge("stdio rpath inet unix dns", NULL) == -1) {
+		perror("pledge");
+		exit(1);
+	}
+
 	setup_libs();
 	progname = argv[0];
+
+	/* inet for network connections, dns for resolv.conf */
+	if (pledge("stdio inet dns", NULL) == -1) {
+		perror("pledge");
+		exit(1);
+	}
 
 	parse_args(argc, argv);
 
@


1.1
log
@add pledges for dig/host/nslookup in the ports version of BIND. initial
pledge is "stdio rpath inet unix dns", dropping to "stdio inet dns"
after argument parsing.

access to resolv.conf is required late; the dns pledge is used for this
rather than requiring full rpath; however contrary to the version in
base, inet is allowed as well, so that it can be used as a debug tool
for servers on alternate ports.

works fine for me; no feedback after posting yet so committing to get
real-world testing. please report any issues.
@
text
@d1 4
a4 4
$OpenBSD$
--- bin/dig/nslookup.c.orig	Sun Dec 11 22:05:58 2016
+++ bin/dig/nslookup.c	Mon Jan 16 10:02:34 2017
@@@@ -905,8 +905,19 @@@@ main(int argc, char **argv) {
@


1.1.4.1
log
@update to BIND 9.10.5-P1

* With certain RPZ configurations, a response with TTL 0 could cause
named to go into an infinite query loop. This flaw is disclosed in
CVE-2017-3140. [RT #45181]

A server is potentially vulnerable to degradation of service if
1. the server is configured to use RPZ,
2. the server uses NSDNAME or NSIP policy rules, and
3. an attacker can cause the server to process a specific query
@
text
@d1 4
a4 4
$OpenBSD: patch-bin_dig_nslookup_c,v 1.2 2017/05/03 20:20:42 sthen Exp $
--- bin/dig/nslookup.c.orig	Fri Apr 14 04:54:11 2017
+++ bin/dig/nslookup.c	Thu Apr 20 09:35:26 2017
@@@@ -913,8 +913,19 @@@@ main(int argc, char **argv) {
@


1.1.2.1
log
@update to BIND 9.10.4-P6

* If a server is configured with a response policy zone (RPZ) that
rewrites an answer with local data, and is also configured for DNS64
address mapping, a NULL pointer can be read triggering a server crash.
This flaw is disclosed in CVE-2017-3135. [RT #44434]

* A synthesized CNAME record appearing in a response before the associated
DNAME could be cached, when it should not have been. This was a
regression introduced while addressing CVE-2016-8864. [RT #44318]
@
text
@d1 1
a1 1
$OpenBSD: patch-bin_dig_nslookup_c,v 1.1 2017/01/24 11:46:35 sthen Exp $
@

