head	1.58;
access;
symbols
	OPENBSD_6_1:1.57.0.6
	OPENBSD_6_1_BASE:1.57
	OPENBSD_6_0:1.57.0.4
	OPENBSD_6_0_BASE:1.57
	OPENBSD_5_9:1.57.0.2
	OPENBSD_5_9_BASE:1.57
	OPENBSD_5_8:1.55.0.6
	OPENBSD_5_8_BASE:1.55
	OPENBSD_5_7:1.55.0.2
	OPENBSD_5_7_BASE:1.55
	OPENBSD_5_6:1.54.0.2
	OPENBSD_5_6_BASE:1.54
	OPENBSD_5_5:1.53.0.2
	OPENBSD_5_5_BASE:1.53
	OPENBSD_5_4:1.52.0.2
	OPENBSD_5_4_BASE:1.52
	OPENBSD_5_3:1.44.0.2
	OPENBSD_5_3_BASE:1.44
	OPENBSD_5_2:1.42.0.2
	OPENBSD_5_2_BASE:1.42
	OPENBSD_5_1_BASE:1.41
	OPENBSD_5_1:1.41.0.2
	OPENBSD_5_0:1.39.0.4
	OPENBSD_5_0_BASE:1.39
	OPENBSD_4_9:1.39.0.2
	OPENBSD_4_9_BASE:1.39
	OPENBSD_4_8:1.36.0.2
	OPENBSD_4_8_BASE:1.36
	OPENBSD_4_7:1.35.0.8
	OPENBSD_4_7_BASE:1.35
	OPENBSD_4_6:1.35.0.6
	OPENBSD_4_6_BASE:1.35
	OPENBSD_4_5:1.35.0.4
	OPENBSD_4_5_BASE:1.35
	OPENBSD_4_4:1.35.0.2
	OPENBSD_4_4_BASE:1.35
	OPENBSD_4_3:1.34.0.2
	OPENBSD_4_3_BASE:1.34
	OPENBSD_4_2:1.31.0.2
	OPENBSD_4_2_BASE:1.31
	OPENBSD_4_1:1.28.0.2
	OPENBSD_4_1_BASE:1.28
	OPENBSD_4_0:1.27.0.2
	OPENBSD_4_0_BASE:1.27
	OPENBSD_3_9:1.22.0.2
	OPENBSD_3_9_BASE:1.22
	OPENBSD_3_8:1.19.0.2
	OPENBSD_3_8_BASE:1.19
	OPENBSD_3_7:1.10.0.2
	OPENBSD_3_7_BASE:1.10
	jakob_20041117:1.1.1.2
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2
	jakob_20040529:1.1.1.1
	jakob:1.1.1;
locks; strict;
comment	@# @;


1.58
date	2017.04.10.11.46.32;	author sthen;	state Exp;
branches;
next	1.57;
commitid	HY6VNZxjJWzKQFDV;

1.57
date	2015.08.25.11.16.12;	author sthen;	state Exp;
branches;
next	1.56;
commitid	1hGS08C33CJ9tr3x;

1.56
date	2015.08.17.20.04.16;	author sthen;	state Exp;
branches;
next	1.55;
commitid	Yxo2r3gGS2UtmrOy;

1.55
date	2014.09.13.18.09.21;	author brad;	state Exp;
branches;
next	1.54;
commitid	PpbRjVZdAmlrmi8q;

1.54
date	2014.04.21.16.30.40;	author sthen;	state Exp;
branches;
next	1.53;

1.53
date	2013.10.11.23.50.18;	author naddy;	state Exp;
branches;
next	1.52;

1.52
date	2013.06.20.08.26.13;	author ajacoutot;	state Exp;
branches;
next	1.51;

1.51
date	2013.06.20.06.54.37;	author ajacoutot;	state Exp;
branches;
next	1.50;

1.50
date	2013.06.17.19.28.36;	author ajacoutot;	state Exp;
branches;
next	1.49;

1.49
date	2013.06.12.20.36.34;	author brad;	state Exp;
branches;
next	1.48;

1.48
date	2013.05.25.00.33.10;	author brad;	state Exp;
branches;
next	1.47;

1.47
date	2013.05.17.09.12.26;	author kirby;	state Exp;
branches;
next	1.46;

1.46
date	2013.03.21.08.46.34;	author ajacoutot;	state Exp;
branches;
next	1.45;

1.45
date	2013.03.11.11.35.48;	author espie;	state Exp;
branches;
next	1.44;

1.44
date	2013.02.09.14.49.52;	author sthen;	state Exp;
branches;
next	1.43;

1.43
date	2012.08.24.07.24.12;	author jasper;	state Exp;
branches;
next	1.42;

1.42
date	2012.04.28.10.52.08;	author ajacoutot;	state Exp;
branches
	1.42.2.1;
next	1.41;

1.41
date	2011.09.25.13.57.51;	author naddy;	state Exp;
branches;
next	1.40;

1.40
date	2011.09.16.11.13.38;	author espie;	state Exp;
branches;
next	1.39;

1.39
date	2010.11.19.22.31.34;	author espie;	state Exp;
branches;
next	1.38;

1.38
date	2010.11.11.14.00.45;	author espie;	state Exp;
branches;
next	1.37;

1.37
date	2010.10.18.18.36.49;	author espie;	state Exp;
branches;
next	1.36;

1.36
date	2010.07.12.22.07.38;	author sthen;	state Exp;
branches;
next	1.35;

1.35
date	2008.07.09.09.36.18;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2007.10.25.21.05.33;	author steven;	state Exp;
branches;
next	1.33;

1.33
date	2007.09.15.23.36.43;	author merdely;	state Exp;
branches;
next	1.32;

1.32
date	2007.09.15.22.36.54;	author merdely;	state Exp;
branches;
next	1.31;

1.31
date	2007.04.12.15.15.18;	author aanriot;	state Exp;
branches;
next	1.30;

1.30
date	2007.04.03.15.04.32;	author jasper;	state Exp;
branches;
next	1.29;

1.29
date	2007.04.01.13.12.41;	author steven;	state Exp;
branches;
next	1.28;

1.28
date	2006.11.11.14.38.23;	author mbalmer;	state Exp;
branches;
next	1.27;

1.27
date	2006.08.03.23.15.57;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2006.05.14.17.31.16;	author steven;	state Exp;
branches;
next	1.25;

1.25
date	2006.04.16.18.54.31;	author naddy;	state Exp;
branches;
next	1.24;

1.24
date	2006.04.14.22.20.08;	author naddy;	state Exp;
branches;
next	1.23;

1.23
date	2006.04.10.05.43.48;	author jakob;	state Exp;
branches;
next	1.22;

1.22
date	2005.11.14.12.46.04;	author bernd;	state Exp;
branches
	1.22.2.1;
next	1.21;

1.21
date	2005.11.13.18.48.45;	author bernd;	state Exp;
branches;
next	1.20;

1.20
date	2005.09.14.10.41.02;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2005.08.31.19.55.37;	author sturm;	state Exp;
branches
	1.19.2.1;
next	1.18;

1.18
date	2005.08.02.15.58.13;	author naddy;	state Exp;
branches;
next	1.17;

1.17
date	2005.06.10.19.56.37;	author naddy;	state Exp;
branches;
next	1.16;

1.16
date	2005.05.26.19.10.21;	author naddy;	state Exp;
branches;
next	1.15;

1.15
date	2005.05.24.00.46.37;	author naddy;	state Exp;
branches;
next	1.14;

1.14
date	2005.05.05.15.53.26;	author jakob;	state Exp;
branches;
next	1.13;

1.13
date	2005.05.05.06.59.28;	author jakob;	state Exp;
branches;
next	1.12;

1.12
date	2005.05.03.09.55.01;	author alek;	state Exp;
branches;
next	1.11;

1.11
date	2005.03.23.17.02.53;	author naddy;	state Exp;
branches;
next	1.10;

1.10
date	2005.03.17.17.32.24;	author naddy;	state Exp;
branches
	1.10.2.1;
next	1.9;

1.9
date	2005.03.17.17.12.44;	author naddy;	state Exp;
branches;
next	1.8;

1.8
date	2005.03.08.10.10.18;	author alek;	state Exp;
branches;
next	1.7;

1.7
date	2004.12.16.00.31.22;	author alek;	state Exp;
branches;
next	1.6;

1.6
date	2004.11.17.21.11.07;	author jakob;	state Exp;
branches;
next	1.5;

1.5
date	2004.11.17.21.08.26;	author jakob;	state Exp;
branches;
next	1.4;

1.4
date	2004.10.08.15.27.27;	author naddy;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.06.01.08.17;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.10.09.38.34;	author xsa;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	2004.05.29.13.12.30;	author jakob;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.05.29.13.12.30;	author jakob;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2004.11.17.06.36.39;	author jakob;	state Exp;
branches;
next	;

1.2.2.1
date	2005.03.27.21.50.33;	author robert;	state Exp;
branches;
next	1.2.2.2;

1.2.2.2
date	2005.08.03.16.49.49;	author sturm;	state Exp;
branches;
next	1.2.2.3;

1.2.2.3
date	2005.08.31.19.46.33;	author sturm;	state Exp;
branches;
next	;

1.10.2.1
date	2005.05.23.20.22.21;	author robert;	state Exp;
branches;
next	1.10.2.2;

1.10.2.2
date	2005.08.03.16.52.25;	author sturm;	state Exp;
branches;
next	1.10.2.3;

1.10.2.3
date	2005.08.31.19.51.41;	author sturm;	state Exp;
branches;
next	1.10.2.4;

1.10.2.4
date	2006.04.17.11.03.44;	author sturm;	state Exp;
branches;
next	;

1.19.2.1
date	2006.04.17.14.09.09;	author sturm;	state Exp;
branches;
next	;

1.22.2.1
date	2006.05.01.14.27.09;	author sturm;	state Exp;
branches;
next	;

1.42.2.1
date	2012.08.24.07.25.59;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.58
log
@use LIBCXX
@
text
@# $OpenBSD: Makefile,v 1.57 2015/08/25 11:16:12 sthen Exp $

COMMENT=		jabber server
DISTNAME=		jabberd-2.0s11
REVISION=		9
EPOCH=			1
CATEGORIES=		net
HOMEPAGE=		http://jabberd2.org/

# GPL
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB=		c crypto ssl

MASTER_SITES=		http://www.linklevel.net/distfiles/

JABBERDUSER=		_jabberd
JABBERDGROUP=		_jabberd
JABBERDDIR=		/var/jabberd

CONFIG_DIR=		${SYSCONFDIR}/jabberd
EXAMPLES=		${PREFIX}/share/examples/jabberd

SUBST_VARS=		CONFIG_DIR EXAMPLES \
			JABBERDUSER JABBERDGROUP JABBERDDIR

STORAGES=		mysql postgresql db
FLAVORS=		${STORAGES} ldap
FLAVOR?=		mysql

CONFIGURE_STYLE=	gnu
CONFIGURE_ARGS=		--enable-debug \
			--enable-ssl \
			--disable-idn \
			--with-extra-include-path="${EXTRA_INCLUDE_PATH}" \
			--with-extra-library-path="${EXTRA_LIBRARY_PATH}"
EXTRA_INCLUDE_PATH=	${LOCALBASE}/include
EXTRA_LIBRARY_PATH=	${LOCALBASE}/lib

.if ${FLAVOR:Mmysql}
LIB_DEPENDS+=		databases/mariadb
WANTLIB +=		lib/mysql/mysqlclient m pthread ${LIBCXX} z
CONFIGURE_ARGS+=	--enable-mysql
.else
CONFIGURE_ARGS+=	--disable-mysql
.endif

.if ${FLAVOR:Mpostgresql}
LIB_DEPENDS+=		databases/postgresql
WANTLIB +=		pq>=4
CONFIGURE_ARGS+=	--enable-pgsql
.else
CONFIGURE_ARGS+=	--disable-pgsql
.endif

.if ${FLAVOR:Mdb}
LIB_DEPENDS+=		databases/db/v4
WANTLIB +=		lib/db4/db>=4
CONFIGURE_ARGS+=	--enable-db
EXTRA_INCLUDE_PATH:=	${EXTRA_INCLUDE_PATH}:${LOCALBASE}/include/db4
.else
CONFIGURE_ARGS+=	--disable-db
.endif

.if ${FLAVOR:Mldap}
LIB_DEPENDS+=		databases/openldap>=2.3
WANTLIB +=		lber-2.4 ldap-2.4 sasl2
CONFIGURE_ARGS+=	--enable-ldap
.else
CONFIGURE_ARGS+=	--disable-ldap
.endif

.for s in ${STORAGES}
.  if ${FLAVOR:M$s}
storage_flag=1
.  endif
.endfor
.if !defined(storage_flag)
ERRORS+=		"Fatal: You need to select at least one storage driver"
.endif

do-install:
	${INSTALL_SCRIPT} ${WRKSRC}/tools/jabberd ${PREFIX}/sbin
	${INSTALL_PROGRAM_DIR} ${PREFIX}/libexec/jabberd
.for dir in c2s resolver router s2s sm
	${INSTALL_PROGRAM} ${WRKSRC}/${dir}/${dir} ${PREFIX}/libexec/jabberd
.endfor
	${INSTALL_MAN} ${WRKSRC}/man/*.8 ${PREFIX}/man/man8
	${INSTALL_DATA_DIR} ${EXAMPLES}
	${INSTALL_DATA_DIR} ${EXAMPLES}/templates
	${INSTALL_DATA} ${WRKSRC}/etc/jabberd.cfg.dist ${EXAMPLES}/jabberd.cfg
	${INSTALL_DATA} ${WRKSRC}/etc/c2s.xml.dist ${EXAMPLES}/c2s.xml
	${INSTALL_DATA} ${WRKSRC}/etc/resolver.xml.dist ${EXAMPLES}/resolver.xml
	${INSTALL_DATA} ${WRKSRC}/etc/router-users.xml.dist ${EXAMPLES}/router-users.xml
	${INSTALL_DATA} ${WRKSRC}/etc/router.xml.dist ${EXAMPLES}/router.xml
	${INSTALL_DATA} ${WRKSRC}/etc/s2s.xml.dist ${EXAMPLES}/s2s.xml
	${INSTALL_DATA} ${WRKSRC}/etc/sm.xml.dist ${EXAMPLES}/sm.xml
	${INSTALL_DATA} ${WRKSRC}/etc/templates/roster.xml.dist ${EXAMPLES}/templates/roster.xml
.if ${FLAVOR:Mmysql}
	${INSTALL_DATA} ${WRKSRC}/tools/db-setup.mysql ${EXAMPLES}
	${INSTALL_DATA} ${WRKSRC}/tools/db-update.mysql ${EXAMPLES}
.endif
.if ${FLAVOR:Mpostgresql}
	${INSTALL_DATA} ${WRKSRC}/tools/db-setup.pgsql ${EXAMPLES}
.endif

.include <bsd.port.mk>
@


1.57
log
@wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2015/08/17 20:04:16 sthen Exp $
d42 1
a42 1
WANTLIB +=		lib/mysql/mysqlclient m pthread stdc++ z
@


1.56
log
@sync WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2014/09/13 18:09:21 brad Exp $
d5 1
a5 1
REVISION=		8
d42 1
a42 1
WANTLIB +=		lib/mysql/mysqlclient m pthread z
@


1.55
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2014/04/21 16:30:40 sthen Exp $
d5 1
a5 1
REVISION=		7
d42 1
a42 1
WANTLIB +=		lib/mysql/mysqlclient m z
@


1.54
log
@sync wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2013/10/11 23:50:18 naddy Exp $
d5 1
a5 1
REVISION=		6
d41 2
a42 2
LIB_DEPENDS+=		databases/mysql
WANTLIB +=		lib/mysql/mysqlclient>=10 m z
@


1.53
log
@Drop USE_GROFF since groff and mandoc produce identical output.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2013/06/20 08:26:13 ajacoutot Exp $
d5 1
a5 1
REVISION= 		5
d42 1
a42 1
WANTLIB +=		lib/mysql/mysqlclient>=10
d67 1
a67 1
WANTLIB +=		heimbase lber-2.4 ldap-2.4 roken wind
a68 1
WANTLIB+=		sasl2 asn1 com_err gssapi krb5
@


1.52
log
@No need for pthread.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2013/06/20 06:54:37 ajacoutot Exp $
a30 1
USE_GROFF =		Yes
@


1.51
log
@Unbreak after hx509 and ntlm removal from Kerberos.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2013/06/17 19:28:36 ajacoutot Exp $
d5 1
a5 1
REVISION= 		4
d68 1
a68 1
WANTLIB +=		heimbase lber-2.4 ldap-2.4 pthread roken wind
@


1.50
log
@Some trivial WANTLIB and tweaks to unbreak after the Heimdal update.
Stop hardcoding the Kerberos libs and use krb5-config(1).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2013/06/12 20:36:34 brad Exp $
d5 1
a5 1
REVISION= 		3
d68 1
a68 1
WANTLIB +=		heimbase heimntlm hx509 lber-2.4 ldap-2.4 pthread roken wind
@


1.49
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2013/05/25 00:33:10 brad Exp $
d5 1
a5 1
REVISION= 		2
d68 1
a68 1
WANTLIB +=		ldap>=8 lber>=8
@


1.48
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2013/05/17 09:12:26 kirby Exp $
d5 1
a5 1
REVISION= 		1
d42 1
a42 1
LIB_DEPENDS+=		databases/mariadb
@


1.47
log
@ - update HOMEPAGE, reminded by natano at natano dot net
 - update MASTER_SITES
 - regen distinfo while here.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2013/03/21 08:46:34 ajacoutot Exp $
d5 1
a5 1
REVISION= 		0
d42 1
a42 1
LIB_DEPENDS+=		databases/mysql
@


1.46
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2013/03/11 11:35:48 espie Exp $
d5 1
d8 1
a8 1
HOMEPAGE=		http://codex.xiaoka.com/wiki/jabberd2:start
d15 1
a15 3
MASTER_SITES=		http://files.jabberstudio.org/jabberd2/ \
			http://jabberstudio.rediris.es/jabberd2/ \
			http://jabberstudio.2nw.net/jabberd2/
@


1.45
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2013/02/09 14:49:52 sthen Exp $
a31 1
USE_LIBTOOL=		Yes
@


1.44
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2012/08/24 07:24:12 jasper Exp $
a10 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.43
log
@Security fix for CVE-2012-3525
jabberd XMPP Dialback Protection Bypass Vulnerability

(this port could really use an update too fwiw)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2012/04/28 10:52:08 ajacoutot Exp $
d46 1
a46 1
.if ${FLAVOR:L:Mmysql}
d54 1
a54 1
.if ${FLAVOR:L:Mpostgresql}
d62 1
a62 1
.if ${FLAVOR:L:Mdb}
d71 1
a71 1
.if ${FLAVOR:L:Mldap}
d81 1
a81 1
.  if ${FLAVOR:L:M$s}
@


1.42
log
@--localstatedir=/var is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2011/09/25 13:57:51 naddy Exp $
d5 1
a5 1
EPOCH=			0
d7 1
a7 1
HOMEPAGE=		http://jabberd2.xiaoka.com/
@


1.42.2.1
log
@Security fix for CVE-2012-3525
jabberd XMPP Dialback Protection Bypass Vulnerability
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2012/04/28 10:52:08 ajacoutot Exp $
a5 1
REVISION=		0
d7 1
a7 1
HOMEPAGE=		http://codex.xiaoka.com/wiki/jabberd2:start
@


1.41
log
@the pkg tools think 2.0s11 < 2.0s9, so bump the EPOCH
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2011/09/16 11:13:38 espie Exp $
d38 1
a38 2
CONFIGURE_ARGS=		--localstatedir=/var \
			--enable-debug \
@


1.40
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2010/11/19 22:31:34 espie Exp $
d5 1
a5 1
REVISION=		6
@


1.39
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2010/11/11 14:00:45 espie Exp $
d5 1
a5 1
REVISION=		5
@


1.38
log
@more WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2010/10/18 18:36:49 espie Exp $
d36 1
a36 1
USE_GROFF =	Yes
d48 2
a49 2
LIB_DEPENDS+=		::databases/mysql
WANTLIB +=		lib/mysql/mysqlclient.>=10
d56 2
a57 2
LIB_DEPENDS+=		::databases/postgresql
WANTLIB +=		pq.>=4
d64 2
a65 2
LIB_DEPENDS+=		::databases/db/v4
WANTLIB +=		lib/db4/db.>=4
d73 2
a74 2
LIB_DEPENDS+=		:openldap-client->=2.3:databases/openldap
WANTLIB +=		ldap.>=8 lber.>=8
@


1.37
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2010/07/12 22:07:38 sthen Exp $
d48 2
a49 1
LIB_DEPENDS+=		lib/mysql/mysqlclient.>=10::databases/mysql
d56 2
a57 1
LIB_DEPENDS+=		pq.>=4::databases/postgresql
d64 2
a65 1
LIB_DEPENDS+=		lib/db4/db.>=4::databases/db/v4
d73 2
a74 1
LIB_DEPENDS+=		ldap.>=8,lber.>=8:openldap-client->=2.3:databases/openldap
@


1.36
log
@use REVISION, checked with before/after make show=PKGNAMES (plus some
extra-careful checking where there are complicated PSEUDO_FLAVORS).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2008/07/09 09:36:18 espie Exp $
d36 1
@


1.35
log
@fix spec (openldap-server WON'T have the required libraries)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2007/10/25 21:05:33 steven Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p5
d14 1
@


1.34
log
@db.=4 -> db.>=4  in preparation of db4 update

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2007/09/15 23:36:43 merdely Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p4
d68 1
a68 1
LIB_DEPENDS+=		ldap.>=8,lber.>=8:openldap-*->=2.3:databases/openldap
@


1.33
log
@Put quotes back around ERRORS.

From simon@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2007/09/15 22:36:54 merdely Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p3
d60 1
a60 1
LIB_DEPENDS+=		lib/db4/db.=4::databases/db/v4
@


1.32
log
@Remove surrounding quotes in COMMENT*/PERMIT_*/BROKEN/ERRORS

Add $OpenBSD$ to p5-SNMP-Info/Makefile (ok kili@@, simon@@)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2007/04/12 15:15:18 aanriot Exp $
d81 1
a81 1
ERRORS+=		Fatal: You need to select at least one storage driver
@


1.31
log
@configure with --enable-debug to get feedback from the software
(database connectivity, permissions, etc.) using the '-D' switch.

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2007/04/03 15:04:32 jasper Exp $
d3 1
a3 1
COMMENT=		"jabber server"
d81 1
a81 1
ERRORS+=		"Fatal: You need to select at least one storage driver"
@


1.30
log
@- plug a file descriptor leak, which makes hungry machines eat all the descriptors.
- fix HOMEPAGE.
- MAINTAINER drops maintainership.
- regen patches.

from Ingo Schwarze <schwarze@@usta.de>

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2007/04/01 13:12:41 steven Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p2
d37 1
@


1.29
log
@USE_LIBTOOL, regen plist
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2006/11/11 14:38:23 mbalmer Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p1
d7 1
a7 2
HOMEPAGE=		http://jabberd.jabberstudio.org/2/
MAINTAINER=		Gerardo Santana Gomez Garrido <gerardo.santana@@gmail.com>
@


1.28
log
@Fix WANTLIB after openldap changes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2006/08/03 23:15:57 espie Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p0
d35 1
@


1.27
log
@new style specs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2006/05/14 17:31:16 steven Exp $
d5 1
d69 1
a69 1
WANTLIB+=		sasl2
@


1.26
log
@add a few backup master sites.
ok maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2006/04/16 18:54:31 naddy Exp $
d44 1
a44 1
LIB_DEPENDS+=		lib/mysql/mysqlclient.10::databases/mysql
d51 1
a51 1
LIB_DEPENDS+=		pq.4::databases/postgresql
d66 1
a66 1
LIB_DEPENDS+=		ldap.8,lber.8:openldap-*->=2.3:databases/openldap
@


1.25
log
@SECURITY: update to 2.0s11

http://jabberstudio.org/projects/jabberd2/releases/view.php?id=826
* Sending a stanza before an stanza during a SASL negotiation can
cause a c2s segfault. Leading to a remote DoS

http://jabberstudio.org/projects/jabberd2/releases/view.php?id=802
* fixed SASL anonymous, bug#126
* fixed edge cases with new dynamic jid code
* fixed incorrect free order in c2s, byg#125
* corrected debug logging, bug#119
* fixed s2s bus error on 64-bit architectures, bug#122
* fixed c2s collisions due to long jids, bug#118
* fixed error response to iq result, bug#110
* fixed roster pushing packets without id, bug#73
* applied new dynamic jid patch, bug#100
* fixed double free of nad in c2s and s2s, bug#97
* major memory enhancement, made jid structure dynamically allocated, bug#100
* fixed glibc error with custom sql statements, bug#106
* fixed segfault with keepalives, bug#102

From: maintainer Gerardo Santana Gomez Garrido
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2006/04/14 22:20:08 naddy Exp $
d16 3
a18 1
MASTER_SITES=		http://files.jabberstudio.org/jabberd2/
@


1.24
log
@bump PKGNAME after MAINTAINER address change
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2006/04/10 05:43:48 jakob Exp $
d4 1
a4 2
DISTNAME=		jabberd-2.0s9
PKGNAME=		${DISTNAME}p4
@


1.23
log
@update MAINTAINER email adress; from gerardo santana
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2005/11/14 12:46:04 bernd Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p3
@


1.22
log
@sasl2 WANTLIB only for ldap FLAVOR. Bump PKGNAME.

ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2005/11/13 18:48:45 bernd Exp $
d8 1
a8 1
MAINTAINER=		Gerardo Santana Gomez Garrido <santana@@openbsd.org.mx>
@


1.22.2.1
log
@MFC:
SECURITY: update to 2.0s11

http://jabberstudio.org/projects/jabberd2/releases/view.php?id=826
* Sending a stanza before an stanza during a SASL negotiation can
cause a c2s segfault. Leading to a remote DoS

http://jabberstudio.org/projects/jabberd2/releases/view.php?id=802
* fixed SASL anonymous, bug#126
* fixed edge cases with new dynamic jid code
* fixed incorrect free order in c2s, byg#125
* corrected debug logging, bug#119
* fixed s2s bus error on 64-bit architectures, bug#122
* fixed c2s collisions due to long jids, bug#118
* fixed error response to iq result, bug#110
* fixed roster pushing packets without id, bug#73
* applied new dynamic jid patch, bug#100
* fixed double free of nad in c2s and s2s, bug#97
* major memory enhancement, made jid structure dynamically allocated, bug#100
* fixed glibc error with custom sql statements, bug#106
* fixed segfault with keepalives, bug#102
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2005/11/14 12:46:04 bernd Exp $
d4 2
a5 1
DISTNAME=		jabberd-2.0s11
@


1.21
log
@Fix WANTLIB/LIB_DEPENDS after openldap update.

"looks good" espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2005/09/14 10:41:02 espie Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p2
d15 1
a15 1
WANTLIB=		c crypto ssl sasl2
d67 1
@


1.20
log
@@@pkgpath annotations to help update
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2005/08/31 19:55:37 sturm Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p1
d15 1
a15 1
WANTLIB=		c crypto ssl
d65 1
a65 1
LIB_DEPENDS+=		ldap.2,lber::databases/openldap
@


1.19
log
@bump PKGNAME so that 3.7 won't have higher PKGNAMEs than 3.8

suggested by espie@@, ok pval@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2005/08/02 15:58:13 naddy Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p0
@


1.19.2.1
log
@MFC:
SECURITY: update to 2.0s11

http://jabberstudio.org/projects/jabberd2/releases/view.php?id=826
* Sending a stanza before an stanza during a SASL negotiation can
cause a c2s segfault. Leading to a remote DoS

http://jabberstudio.org/projects/jabberd2/releases/view.php?id=802
* fixed SASL anonymous, bug#126
* fixed edge cases with new dynamic jid code
* fixed incorrect free order in c2s, byg#125
* corrected debug logging, bug#119
* fixed s2s bus error on 64-bit architectures, bug#122
* fixed c2s collisions due to long jids, bug#118
* fixed error response to iq result, bug#110
* fixed roster pushing packets without id, bug#73
* applied new dynamic jid patch, bug#100
* fixed double free of nad in c2s and s2s, bug#97
* major memory enhancement, made jid structure dynamically allocated, bug#100
* fixed glibc error with custom sql statements, bug#106
* fixed segfault with keepalives, bug#102

From: maintainer Gerardo Santana Gomez Garrido
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2005/08/31 19:55:37 sturm Exp $
d4 2
a5 1
DISTNAME=		jabberd-2.0s11
@


1.18
log
@SECURITY:
Fix a buffer overflow that could be used to perform a DoS attack
and possible code execution.
From: Gerardo Santana Gomez Garrido <santana@@openbsd.org.mx>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2005/06/10 19:56:37 naddy Exp $
d5 1
@


1.17
log
@Add a missing file and regroup some files for specific flavors.
From: maintainer Gerardo Santana Gomez Garrido
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2005/05/26 19:10:21 naddy Exp $
d4 1
a4 2
DISTNAME=		jabberd-2.0s8
PKGNAME=		${DISTNAME}p1
@


1.16
log
@Optionally support postgresql and db storages.
From maintainer Gerardo Santana.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2005/05/24 00:46:37 naddy Exp $
d5 1
a5 1
PKGNAME=		${DISTNAME}p0
d97 1
d99 5
@


1.15
log
@drop extraneous WANTLIBs; from maintainer Gerardo Santana
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2005/05/05 15:53:26 jakob Exp $
d29 2
a30 1
FLAVORS=		mysql ldap
d34 1
a34 1
CONFIGURE_ARGS+=	--localstatedir=/var \
d37 4
a40 2
			--with-extra-include-path=${LOCALBASE}/include \
			--with-extra-library-path=${LOCALBASE}/lib
d49 15
d65 1
a65 1
LIB_DEPENDS+=		ldap.2,lber:openldap-client-2.*:databases/openldap
d71 7
a77 2
.if ! ${FLAVOR:L:Mmysql}
BROKEN=			"You need to select at least one storage driver"
@


1.14
log
@fix dependencies for MySQL
fix typo in BROKEN message
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2005/05/05 06:59:28 jakob Exp $
d5 1
d15 1
a15 1
WANTLIB=		c crypto m ssl z
@


1.13
log
@move MySQL to separate (default) flavour
add LDAP flavour
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2005/05/03 09:55:01 alek Exp $
a38 1
BUILD_DEPENDS+=		::databases/mysql,-server
d53 1
a53 1
BROKEN=			"You need to select least one storage driver"
@


1.12
log
@Update to 2.0s8
- http://jabberstudio.org/projects/jabberd2/releases/view.php?id=740
- http://jabberstudio.org/projects/jabberd2/releases/view.php?id=754

From Gerardo Santana Gomez Garrido <santana@@openbsd.org.mx> (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2005/03/23 17:02:53 naddy Exp $
d28 2
a29 1
LIB_DEPENDS=		lib/mysql/mysqlclient.10::databases/mysql
d36 1
a36 1
			--with-extra-library-path=${LOCALBASE}/lib \
d38 18
a55 4
# MySQL backend
CONFIGURE_ARGS+=	--enable-mysql \
			--with-extra-include-path=${LOCALBASE}/include/mysql \
			--with-extra-library-path=${LOCALBASE}/lib/mysql
@


1.11
log
@Update to 2.0s6 that fixes some security and reliability bugs.
From: Gerardo Santana Gomez Garrido <santana@@openbsd.org.mx>
@
text
@d1 1
a1 1
# $OpenBSD$
d4 1
a4 1
DISTNAME=		jabberd-2.0s6
@


1.10
log
@back out; ports are locked
@
text
@d4 1
a4 2
DISTNAME=		jabberd-2.0s4
PKGNAME=		${DISTNAME}p0
d16 1
a16 1
MASTER_SITES=		http://www.jabberstudio.org/files/jabberd2/
@


1.10.2.1
log
@SECURITY: update to 2.0s6
fixes multiple vulnerabilities
http://www.vuxml.org/openbsd/52619d3a-9bf3-11d9-afb3-00065bd5b0b6.html

ok brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2005/03/17 17:32:24 naddy Exp $
d4 2
a5 1
DISTNAME=		jabberd-2.0s6
@


1.10.2.2
log
@MFC:

SECURITY:
Fix a buffer overflow that could be used to perform a DoS attack
and possible code execution.
From: Gerardo Santana Gomez Garrido <santana@@openbsd.org.mx>

ok brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10.2.1 2005/05/23 20:22:21 robert Exp $
d4 1
a4 1
DISTNAME=		jabberd-2.0s9
@


1.10.2.3
log
@updated packages for these ports where not build in a sane environment
bump PKGNAME for fixed packages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10.2.2 2005/08/03 16:52:25 sturm Exp $
a4 1
PKGNAME=		${DISTNAME}p0
@


1.10.2.4
log
@MFC:
SECURITY: update to 2.0s11

http://jabberstudio.org/projects/jabberd2/releases/view.php?id=826
* Sending a stanza before an stanza during a SASL negotiation can
cause a c2s segfault. Leading to a remote DoS

http://jabberstudio.org/projects/jabberd2/releases/view.php?id=802
* fixed SASL anonymous, bug#126
* fixed edge cases with new dynamic jid code
* fixed incorrect free order in c2s, byg#125
* corrected debug logging, bug#119
* fixed s2s bus error on 64-bit architectures, bug#122
* fixed c2s collisions due to long jids, bug#118
* fixed error response to iq result, bug#110
* fixed roster pushing packets without id, bug#73
* applied new dynamic jid patch, bug#100
* fixed double free of nad in c2s and s2s, bug#97
* major memory enhancement, made jid structure dynamically allocated, bug#100
* fixed glibc error with custom sql statements, bug#106
* fixed segfault with keepalives, bug#102

From: maintainer Gerardo Santana Gomez Garrido
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10.2.3 2005/08/31 19:51:41 sturm Exp $
d4 2
a5 1
DISTNAME=		jabberd-2.0s11
d17 1
a17 1
MASTER_SITES=		http://files.jabberstudio.org/jabberd2/
@


1.9
log
@Update to 2.0s6 that fixes some security and reliability bugs.
From: Gerardo Santana Gomez Garrido <santana@@openbsd.org.mx>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2005/03/08 10:10:18 alek Exp $
d4 2
a5 1
DISTNAME=		jabberd-2.0s6
d17 1
a17 1
MASTER_SITES=		http://files.jabberstudio.org/jabberd2/
@


1.8
log
@- MODULES=iconv is not needed here
- Bump PKGNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2004/12/16 00:31:22 alek Exp $
d4 1
a4 2
DISTNAME=		jabberd-2.0s4
PKGNAME=		${DISTNAME}p0
d16 1
a16 1
MASTER_SITES=		http://www.jabberstudio.org/files/jabberd2/
@


1.7
log
@Add WANTLIB markers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2004/11/17 21:11:07 jakob Exp $
d5 1
a29 2

MODULES+=		iconv
@


1.6
log
@clarify why mysql is separated in configure
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2004/11/17 21:08:26 jakob Exp $
d14 1
@


1.5
log
@resolve conflict and update to 2.0s4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2004/10/08 15:27:27 naddy Exp $
a34 1
			--enable-mysql \
d38 1
@


1.4
log
@kill INSTALL/DEINSTALL, overhaul; ok maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2004/10/06 01:08:17 naddy Exp $
d4 1
a4 1
DISTNAME=		jabberd-2.0s3
d29 1
a29 1
MODULES=		converters/libiconv
d32 2
a33 1
CONFIGURE_ARGS=		--localstatedir=${JABBERDDIR:H} \
d35 5
@


1.3
log
@update to 2.0s3; from  Gerardo Santana Gomez Garrido <santana@@openbsd.org.mx>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2004/08/10 09:38:34 xsa Exp $
a26 1
BUILD_DEPENDS=		::databases/mysql,-server
@


1.2
log
@
more new-style MODULES.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2004/05/29 13:12:30 jakob Exp $
d4 1
a4 1
DISTNAME=		jabberd-2.0s2
d33 4
a36 1
CONFIGURE_ARGS=		--localstatedir=${JABBERDDIR:H}
@


1.2.2.1
log
@SECURITY:
Update to 2.0s6 that fixes some security and reliability bugs.
http://www.vuxml.org/openbsd/52619d3a-9bf3-11d9-afb3-00065bd5b0b6.html

ok brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2004/08/10 09:38:34 xsa Exp $
d4 1
a4 1
DISTNAME=		jabberd-2.0s6
d15 1
a15 1
MASTER_SITES=		http://files.jabberstudio.org/jabberd2/
d33 1
a33 3
CONFIGURE_ARGS=		--localstatedir=${JABBERDDIR:H} \
			--disable-idn \
			--disable-mysql
@


1.2.2.2
log
@MFC:

SECURITY:
Fix a buffer overflow that could be used to perform a DoS attack
and possible code execution.
From: Gerardo Santana Gomez Garrido <santana@@openbsd.org.mx>

ok brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2.2.1 2005/03/27 21:50:33 robert Exp $
d4 1
a4 1
DISTNAME=		jabberd-2.0s9
@


1.2.2.3
log
@updated packages for these ports where not build in a sane environment
bump PKGNAME for fixed packages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2.2.2 2005/08/03 16:49:49 sturm Exp $
a4 1
PKGNAME=		${DISTNAME}p0
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d30 1
a30 1
MODULES=iconv
@


1.1.1.1
log
@jabberd; from Gerardo Santana Gomez Garrido
@
text
@@


1.1.1.2
log
@jabber server
@
text
@d1 2
a2 2
# $OpenBSD: Makefile,v 1.1.1.1 2002/05/20 22:23:25 jsyn Exp $
			
d4 2
a5 7

DISTNAME=		jabberd-2.0s4
CATEGORIES=    		net

MAINTAINER=		Jakob Schlyter <jakob@@openbsd.org>

MASTER_SITES=		http://www.jabberstudio.org/files/jabberd2/
d7 1
d11 1
a11 1
PERMIT_PACKAGE_FTP=	Yes 
d15 16
a30 1
USE_GMAKE=		Yes
d33 1
a33 13
CONFIGURE_ARGS+=	--localstatedir=/var \
			--enable-ssl \
			--disable-idn \
			--enable-mysql \
			--with-extra-include-path=${LOCALBASE}/include \
			--with-extra-library-path=${LOCALBASE}/lib \

CONFIGURE_ARGS+=	--enable-mysql \
			--with-extra-include-path=${LOCALBASE}/include/mysql \
			--with-extra-library-path=${LOCALBASE}/lib/mysql
LIB_DEPENDS+=		lib/mysql/mysqlclient.10::databases/mysql

MODULES+=	iconv
d36 1
a36 1
	${INSTALL_PROGRAM} ${WRKSRC}/tools/jabberd ${PREFIX}/sbin
d42 11
a52 10
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/jabberd
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/jabberd/templates
	${INSTALL_DATA} \
		${WRKSRC}/tools/*sql \
		${WRKSRC}/etc/*.xml.dist \
		${WRKSRC}/etc/*.cfg.dist \
		${PREFIX}/share/examples/jabberd
	${INSTALL_DATA} \
		${WRKSRC}/etc/templates/*.xml.dist \
		${PREFIX}/share/examples/jabberd/templates
@

