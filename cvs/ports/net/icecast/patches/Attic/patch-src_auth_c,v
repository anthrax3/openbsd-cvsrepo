head	1.3;
access;
symbols
	OPENBSD_3_8:1.2.0.2
	OPENBSD_3_8_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2005.10.21.15.59.54;	author naddy;	state dead;
branches;
next	1.2;

1.2
date	2005.04.16.21.24.15;	author sturm;	state Exp;
branches;
next	1.1;

1.1
date	2005.04.16.15.37.31;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to 2.3.0 from maintainer Moritz Grimm.

New features:
  * Support Ogg Speex, Ogg FLAC, Ogg Midi
  * Intro file support
  * On-demand relays
  * Improved mount-level settings
  * URL listener authenticator
  * Authentication for on-demand files
  * Updated admin/web interface
  * Various reliability bug fixes

Port changes:
  * Ogg Theora streaming is now enabled
  * Revamped README.OpenBSD file, tightened DESCR
  * <fileserve> directive not disabled any longer in icecast.xml.dist
@
text
@$OpenBSD: patch-src_auth_c,v 1.2 2005/04/16 21:24:15 sturm Exp $
--- src/auth.c.orig	Wed Jul 14 20:25:48 2004
+++ src/auth.c	Sat Apr 16 22:02:01 2005
@@@@ -354,6 +354,7 @@@@ int auth_htpasswd_deleteuser(auth_t *aut
     char *sep;
     char *tmpfile = NULL;
     int tmpfile_len = 0;
+    int ret;
 
     state = auth->state;
     passwdfile = fopen(state->filename, "rb");
@@@@ -365,7 +366,18 @@@@ int auth_htpasswd_deleteuser(auth_t *aut
     }
     tmpfile_len = strlen(state->filename) + 6;
     tmpfile = calloc(1, tmpfile_len);
-    sprintf(tmpfile, ".%s.tmp", state->filename);
+    if(tmpfile == NULL ) {
+        WARN0("Failed to allocate memory for temporary file");
+        return AUTH_FAILED;
+    }
+
+    ret = snprintf(tmpfile, tmpfile_len, ".%s.tmp", state->filename);
+    if (ret == -1 || ret >= tmpfile_len) {
+        WARN0("Error generating temporary filename in auth_htpasswd_deleteuser()");
+        fclose(passwdfile);
+        free(tmpfile);
+        return AUTH_FAILED;
+    }
 
     tmp_passwdfile = fopen(tmpfile, "wb");
 
@


1.2
log
@more cleanup from maintainer Moritz Grimm <gtgbr at gmx.net>
@
text
@d1 1
a1 1
$OpenBSD: patch-src_auth_c,v 1.1 2005/04/16 15:37:31 sturm Exp $
@


1.1
log
@convert simple sprintf() to snprintf()

from maintainer Moritz Grimm <gtgbr at gmx.net>
@
text
@d1 12
a12 4
$OpenBSD$
--- src/auth.c.orig	Mon Mar  7 13:59:17 2005
+++ src/auth.c	Mon Mar  7 14:00:59 2005
@@@@ -365,7 +365,7 @@@@ int auth_htpasswd_deleteuser(auth_t *aut
d17 12
a28 1
+    snprintf(tmpfile, tmpfile_len, ".%s.tmp", state->filename);
@

