head	1.2;
access;
symbols
	OPENBSD_5_6:1.2.0.2
	OPENBSD_4_4:1.1.0.8
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.6
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.4
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.2
	OPENBSD_4_1_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2008.11.18.21.22.03;	author pea;	state dead;
branches
	1.2.2.1;
next	1.1;

1.1
date	2006.11.16.17.06.21;	author naddy;	state Exp;
branches;
next	;

1.2.2.1
date	2015.04.14.06.49.35;	author jasper;	state Exp;
branches;
next	;
commitid	WeHErLxNn5YAbKLC;


desc
@@


1.2
log
@Update to 2.3.2 and add the following modifications:

+ add user _icecast (home directory in /var/icecast)
+ enable chroot by default
+ populate chroot with all the necessary files

ok okan@@ sthen@@ ajacoutot@@
@
text
@$OpenBSD: patch-src_auth_url_c,v 1.1 2006/11/16 17:06:21 naddy Exp $
--- src/auth_url.c.orig	Thu Nov 16 18:00:51 2006
+++ src/auth_url.c	Thu Nov 16 18:01:18 2006
@@@@ -112,14 +112,6 @@@@ static void auth_url_clear(auth_t *self)
 }
 
 
-/* make sure that prompting at the console does not occur */
-static int my_getpass(void *client, char *prompt, char *buffer, int buflen)
-{
-    buffer[0] = '\0';
-    return 0;
-}
-
-
 static int handle_returned_header (void *ptr, size_t size, size_t nmemb, void *stream)
 {
     auth_client *auth_user = stream;
@@@@ -518,7 +510,6 @@@@ int auth_get_url_auth (auth_t *authentic
     curl_easy_setopt (url_info->handle, CURLOPT_WRITEDATA, url_info->handle);
     curl_easy_setopt (url_info->handle, CURLOPT_NOSIGNAL, 1L);
     curl_easy_setopt (url_info->handle, CURLOPT_TIMEOUT, 15L);
-    curl_easy_setopt (url_info->handle, CURLOPT_PASSWDFUNCTION, my_getpass);
     curl_easy_setopt (url_info->handle, CURLOPT_ERRORBUFFER, &url_info->errormsg[0]);
 
     if (url_info->username && url_info->password)
@


1.2.2.1
log
@Apply security fix for CVE-2015-3026
@
text
@d1 5
a5 27
$OpenBSD$

Security fix for CVE-2015-3026,
icecast: NULL pointer dereference in stream_auth handler leading to DoS
https://trac.xiph.org/changeset/27abfbbd688df3e3077b535997330aa06603250f/icecast-server

--- src/auth_url.c.orig	Thu Nov  6 12:56:21 2014
+++ src/auth_url.c	Mon Apr 13 15:26:53 2015
@@@@ -539,9 +539,19 @@@@ static void url_stream_auth (auth_client *auth_user)
     host = util_url_escape (config->hostname);
     port = config->port;
     config_release_config ();
-    user = util_url_escape (client->username);
-    pass = util_url_escape (client->password);
     ipaddr = util_url_escape (client->con->ip);
+
+    if (client->username) {
+        user = util_url_escape(client->username);
+    } else {
+        user = strdup("");
+    }
+
+    if (client->password) {
+        pass = util_url_escape(client->password);
+    } else {
+        pass = strdup("");
+    }
d7 20
a26 2
     snprintf (post, sizeof (post),
             "action=stream_auth&mount=%s&ip=%s&server=%s&port=%d&user=%s&pass=%s%s",
@


1.1
log
@fix build with recent libcurl
@
text
@d1 1
a1 1
$OpenBSD$
@

