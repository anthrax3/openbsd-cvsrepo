head	1.9;
access;
symbols
	OPENBSD_5_5:1.8.0.2
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.6.0.2
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2;
locks; strict;
comment	@# @;


1.9
date	2014.04.22.10.01.01;	author ajacoutot;	state dead;
branches;
next	1.8;

1.8
date	2013.11.02.15.55.53;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2013.10.02.10.46.37;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2013.03.21.07.50.56;	author landry;	state Exp;
branches;
next	1.5;

1.5
date	2013.03.19.22.06.44;	author landry;	state Exp;
branches;
next	1.4;

1.4
date	2013.03.12.05.19.57;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2013.03.02.14.05.59;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2012.11.27.08.13.15;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2012.08.25.13.17.54;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Remove opal. Nothing uses it anymore and it never played well with rthreads.
@
text
@$OpenBSD: patch-plugins_video_H_264_h264-x264_cxx,v 1.8 2013/11/02 15:55:53 ajacoutot Exp $

LOCALBASE/include/libavutil/common.h:170: error: 'UINT64_C' was not declared in this scope,
so move headers so that __STDC_CONSTANT_MACROS is defined at the right time.

--- plugins/video/H.264/h264-x264.cxx.orig	Thu Aug 15 01:22:47 2013
+++ plugins/video/H.264/h264-x264.cxx	Sat Nov  2 16:28:49 2013
@@@@ -40,6 +40,9 @@@@
 #include "plugin-config.h"
 #endif
 
+#define FF_IDCT_H264 11
+#define CODEC_FLAG2_SKIP_RD 0x00004000
+
 #include <codec/opalplugin.hpp>
 
 #include "../common/ffmpeg.h"
@@@@ -1071,13 +1074,10 @@@@ class MyDecoder : public PluginCodec<MY_CODEC>
         return false;
 
       m_context->workaround_bugs = FF_BUG_AUTODETECT;
-      m_context->error_recognition = FF_ER_AGGRESSIVE;
       m_context->idct_algo = FF_IDCT_H264;
       m_context->error_concealment = FF_EC_GUESS_MVS | FF_EC_DEBLOCK;
       m_context->flags = CODEC_FLAG_INPUT_PRESERVED | CODEC_FLAG_EMU_EDGE;
-      m_context->flags2 = CODEC_FLAG2_BRDO |
-                          CODEC_FLAG2_MEMC_ONLY |
-                          CODEC_FLAG2_DROP_FRAME_TIMECODE |
+      m_context->flags2 = CODEC_FLAG2_DROP_FRAME_TIMECODE |
                           CODEC_FLAG2_SKIP_RD |
                           CODEC_FLAG2_CHUNKS;
 
@


1.8
log
@Fix unresolved symbols with newer FFmpeg (from Arch Linux).
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_video_H_264_h264-x264_cxx,v 1.7 2013/10/02 10:46:37 ajacoutot Exp $
@


1.7
log
@Update to opal-3.10.11.
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_video_H_264_h264-x264_cxx,v 1.6 2013/03/21 07:50:56 landry Exp $
d7 2
a8 9
+++ plugins/video/H.264/h264-x264.cxx	Tue Oct  1 18:33:36 2013
@@@@ -36,15 +36,15 @@@@
  * $Date: 2012-07-17 22:41:57 -0500 (Tue, 17 Jul 2012) $
  */
 
+#include "../common/ffmpeg.h"
+#include "../common/dyna.h"
+
 #ifndef PLUGIN_CODEC_DLL_EXPORTS
d12 3
d17 2
a18 7
-#include "../common/ffmpeg.h"
-#include "../common/dyna.h"
-
 #include "shared/h264frame.h"
 #include "shared/x264wrap.h"
 
@@@@ -1071,13 +1071,10 @@@@ class MyDecoder : public PluginCodec<MY_CODEC>
@


1.6
log
@Resurrect chunk that was mistakenly removed in previous. Fixes build for good this time.
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_video_H_264_h264-x264_cxx,v 1.5 2013/03/19 22:06:44 landry Exp $
d6 2
a7 2
--- plugins/video/H.264/h264-x264.cxx.orig	Wed Feb 20 03:18:02 2013
+++ plugins/video/H.264/h264-x264.cxx	Thu Mar 21 08:47:42 2013
@


1.5
log
@Fix build after ffmpeg 1.1 update, since brad doesnt seem to care..

Adapted from https://projects.archlinux.org/svntogit/packages.git/commit/?h=packages/opal&id=278c8f93262ee8372b05c650a2e6456ad2d04950
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_video_H_264_h264-x264_cxx,v 1.4 2013/03/12 05:19:57 brad Exp $
d6 21
a26 2
--- plugins/video/H.264/h264-x264.cxx.orig	Tue Mar 19 22:15:18 2013
+++ plugins/video/H.264/h264-x264.cxx	Tue Mar 19 22:52:56 2013
@


1.4
log
@Correct shared lib creation for OpenBSD.


ok ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_video_H_264_h264-x264_cxx,v 1.3 2013/03/02 14:05:59 ajacoutot Exp $
d6 4
a9 5
--- plugins/video/H.264/h264-x264.cxx.orig	Tue Feb 19 21:18:02 2013
+++ plugins/video/H.264/h264-x264.cxx	Mon Mar 11 19:52:33 2013
@@@@ -36,14 +36,14 @@@@
  * $Date: 2012-07-17 22:41:57 -0500 (Tue, 17 Jul 2012) $
  */
d11 11
a21 6
+#include "../common/ffmpeg.h"
+#include "../common/dyna.h"
+
 #ifndef PLUGIN_CODEC_DLL_EXPORTS
 #include "plugin-config.h"
 #endif
a22 7
 #include <codec/opalplugin.hpp>
-
-#include "../common/ffmpeg.h"
-#include "../common/dyna.h"
 
 #include "shared/h264frame.h"
 #include "shared/x264wrap.h"
@


1.3
log
@Update to opal-3.10.10.
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_video_H_264_h264-x264_cxx,v 1.2 2012/11/27 08:13:15 ajacoutot Exp $
d6 2
a7 2
--- plugins/video/H.264/h264-x264.cxx.orig	Wed Feb 20 03:18:02 2013
+++ plugins/video/H.264/h264-x264.cxx	Sun Feb 24 09:19:31 2013
@


1.2
log
@Update to opal-3.10.9.
@
text
@d1 1
a1 1
$OpenBSD: patch-plugins_video_H_264_h264-x264_cxx,v 1.1 2012/08/25 13:17:54 ajacoutot Exp $
d6 2
a7 2
--- plugins/video/H.264/h264-x264.cxx.orig	Mon Nov 26 11:48:24 2012
+++ plugins/video/H.264/h264-x264.cxx	Tue Nov 27 08:23:29 2012
@


1.1
log
@Update to opal-3.10.7.
@
text
@d1 1
a1 1
$OpenBSD$
d6 2
a7 2
--- plugins/video/H.264/h264-x264.cxx.orig	Sat Aug 25 09:14:53 2012
+++ plugins/video/H.264/h264-x264.cxx	Sat Aug 25 09:15:26 2012
@

