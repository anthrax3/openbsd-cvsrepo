head	1.32;
access;
symbols
	OPENBSD_5_5:1.31.0.2
	OPENBSD_5_5_BASE:1.31
	OPENBSD_5_4:1.28.0.2
	OPENBSD_5_4_BASE:1.28
	OPENBSD_5_3:1.25.0.2
	OPENBSD_5_3_BASE:1.25
	OPENBSD_5_2:1.23.0.2
	OPENBSD_5_2_BASE:1.23
	OPENBSD_5_1_BASE:1.19
	OPENBSD_5_1:1.19.0.2
	OPENBSD_5_0:1.17.0.2
	OPENBSD_5_0_BASE:1.17
	OPENBSD_4_9:1.14.0.2
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.11.0.2
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.7.0.4
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.7.0.2
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.6.0.2
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.2.0.2
	OPENBSD_4_4_BASE:1.2
	ajacoutot_20080429:1.1.1.1
	ajacoutot:1.1.1;
locks; strict;
comment	@# @;


1.32
date	2014.04.22.10.01.01;	author ajacoutot;	state dead;
branches;
next	1.31;

1.31
date	2013.11.02.16.23.55;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2013.11.02.15.55.53;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2013.10.02.10.46.36;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2013.03.12.05.19.57;	author brad;	state Exp;
branches;
next	1.27;

1.27
date	2013.03.11.11.35.50;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2013.03.02.14.05.59;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2012.11.27.08.13.15;	author ajacoutot;	state Exp;
branches;
next	1.24;

1.24
date	2012.08.25.13.17.54;	author ajacoutot;	state Exp;
branches;
next	1.23;

1.23
date	2012.06.22.12.59.09;	author ajacoutot;	state Exp;
branches;
next	1.22;

1.22
date	2012.06.21.14.24.22;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2012.04.20.13.28.50;	author dcoppa;	state Exp;
branches;
next	1.20;

1.20
date	2012.03.02.09.04.21;	author ajacoutot;	state Exp;
branches;
next	1.19;

1.19
date	2011.11.13.15.53.14;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2011.10.26.16.59.34;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2011.06.16.08.07.20;	author sthen;	state Exp;
branches;
next	1.16;

1.16
date	2011.04.01.06.52.47;	author jakemsr;	state Exp;
branches;
next	1.15;

1.15
date	2011.03.27.10.30.35;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2010.11.19.22.31.35;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2010.09.01.14.42.51;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2010.09.01.14.40.23;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2010.05.31.06.31.39;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2010.05.21.12.28.52;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2010.03.27.14.41.15;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2010.03.23.21.13.37;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2009.05.28.10.00.44;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2009.02.18.11.56.25;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2009.01.17.14.14.14;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2008.09.08.17.17.10;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2008.09.02.23.16.01;	author todd;	state Exp;
branches;
next	1.2;

1.2
date	2008.05.22.19.30.41;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2008.04.29.07.01.18;	author ajacoutot;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.04.29.07.01.18;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.32
log
@Remove opal. Nothing uses it anymore and it never played well with rthreads.
@
text
@# $OpenBSD: Makefile,v 1.31 2013/11/02 16:23:55 ajacoutot Exp $

SHARED_ONLY=	Yes

COMMENT=	Open Phone Abstraction Library

V=		3.10.11
DISTNAME=	opal-${V}
EXTRACT_SUFX=	.tar.bz2
SUBST_VARS=	V
REVISION=	1

SHARED_LIBS=	opal	3.1	# 3.10.11

CATEGORIES=	net devel telephony

HOMEPAGE=	http://www.opalvoip.org/

MAINTAINER=	Antoine Jacoutot <ajacoutot@@openbsd.org>

# MPL 1.0
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += avutil c celt0 crypto gsm m pt spandsp speex speexdsp
WANTLIB += stdc++ theora tiff x264

MASTER_SITES=	${MASTER_SITE_SOURCEFORGE:=opalvoip/}

LIB_DEPENDS=	audio/celt \
		devel/ptlib \
		graphics/ffmpeg \
		telephony/spandsp

# dlopen(3) libavcodec.so.X.Y; shows as "Extra:" in check-lib-depends
# but we want to be sure we track ABI and shared lib version changes
# see LIBAVCODEC_LIB_NAME in plugins/configure
WANTLIB += avcodec

ALL_TARGET=	default_target
USE_GMAKE=	Yes
NO_TEST=	Yes

MODGNU_CONFIG_GUESS_DIRS= ${WRKSRC} ${WRKSRC}/plugins

CONFIGURE_STYLE=gnu

# LDFLAGS needed for the spandsp plugin
CONFIGURE_ENV=	LDFLAGS="-L${LOCALBASE}/lib" \
		ac_cv_path_SWIG= #ruby, java

# XXX internal ilbc (port libilbc?)
CONFIGURE_ARGS=	--disable-sbc #bluetooth

# plugins/audio/SILK/ReadMe.txt; not for commercial
# http://developer.skype.com/silk
CONFIGURE_ARGS+= --disable-silk

MAKE_ENV=	VERBOSE=1
MAKE_FLAGS=	RELEASE_LIB_NAME=libopal.so.${LIBopal_VERSION} \
		RELEASE_LIB_FILENAME_SHARED_PAT=libopal.so.${LIBopal_VERSION}

pre-configure:
	${SUBST_CMD} ${WRKSRC}/plugins/configure
	perl -pi -e 's,SUBDIRS\+=\",SUBDIRS=\"\$${SUBDIRS},g' \
		${WRKSRC}/plugins/configure

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/opal
	${INSTALL_DATA} ${WRKSRC}/opal_inc.mak ${PREFIX}/share/opal
	${INSTALL_DATA} ${WRKSRC}/version.h ${PREFIX}/share/opal
	rm ${PREFIX}/lib/libopal_s.a

.include <bsd.port.mk>
@


1.31
log
@Better DEPENDS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2013/11/02 15:55:53 ajacoutot Exp $
@


1.30
log
@Fix unresolved symbols with newer FFmpeg (from Arch Linux).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2013/10/02 10:46:36 ajacoutot Exp $
d11 1
a11 1
REVISION=	0
d24 2
a25 2
WANTLIB += c celt0 crypto gsm m pt spandsp speex speexdsp stdc++
WANTLIB += theora tiff x264 avutil
d31 1
d37 1
a37 2
WANTLIB+=	avcodec
LIB_DEPENDS+=	graphics/ffmpeg
@


1.29
log
@Update to opal-3.10.11.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2013/03/12 05:19:57 brad Exp $
d11 1
d25 1
a25 1
WANTLIB += theora tiff x264
d30 1
a30 1
		devel/ptlib>=2.10.11 \
@


1.28
log
@Correct shared lib creation for OpenBSD.


ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2013/03/11 11:35:50 espie Exp $
d7 4
a10 4
DISTNAME=	opal-3.10.10
REVISION=	0

SHARED_LIBS=	opal	3.1	# 3.10.10
d12 1
a12 1
EXTRACT_SUFX=	.tar.bz2
d23 2
a24 2
WANTLIB += c celt0>=1 crypto gsm m ogg pt spandsp speex
WANTLIB += speexdsp stdc++ theora tiff x264
d28 2
a29 2
LIB_DEPENDS=	devel/ptlib>=2.10.10 \
		audio/celt \
d34 1
a38 5

MAKE_ENV=	CC=${CC} CPLUS=${CXX} VERBOSE=1
MAKE_FLAGS=	RELEASE_LIB_NAME=libopal.so.${LIBopal_VERSION} \
		RELEASE_LIB_FILENAME_SHARED_PAT=libopal.so.${LIBopal_VERSION}

d45 7
a51 7
CONFIGURE_ENV=	CPPFLAGS="-I${X11BASE}/include -I${LOCALBASE}/include" \
		LDFLAGS="-L${X11BASE}/lib -L${LOCALBASE}/lib" \
		ac_cv_path_SWIG= # ruby, java
# internal ilbc (port libilbc?)
CONFIGURE_ARGS=	--disable-sbc \
		--enable-plugins \
		--with-plugin-installdir=opal
d57 3
a59 5
# XXX
# ekiga:/usr/local/lib/opal-3.6.6/lid/vpb_lid_pwplugin.so:
# undefined symbol '_Z18vpb_set_event_maskit'
# <...>
CONFIGURE_ARGS+= --disable-vpb
d70 1
@


1.27
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2013/03/02 14:05:59 ajacoutot Exp $
d8 1
@


1.26
log
@Update to opal-3.10.10.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/11/27 08:13:15 ajacoutot Exp $
a20 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM= Yes
PERMIT_DISTFILES_FTP=	Yes
d43 1
a43 1
NO_REGRESS=	Yes
@


1.25
log
@Update to opal-3.10.9.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/08/25 13:17:54 ajacoutot Exp $
d7 1
a7 1
DISTNAME=	opal-3.10.9
d9 1
a9 1
SHARED_LIBS=	opal	3.0	# 3.10.9
d30 1
a30 1
LIB_DEPENDS=	devel/ptlib>=2.10.9 \
@


1.24
log
@Update to opal-3.10.7.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/06/22 12:59:09 ajacoutot Exp $
d7 1
a7 1
DISTNAME=	opal-3.10.7
d9 1
a9 1
SHARED_LIBS=	opal	2.0	# 3.10.3
d25 1
a25 1
WANTLIB += c celt0>=1 crypto gsm m ogg pt pthread spandsp speex
d30 1
a30 1
LIB_DEPENDS=	devel/ptlib>=2.10.7 \
d37 1
a37 1
LIB_DEPENDS+=	graphics/ffmpeg>=20110306
@


1.23
log
@Depend on ptlib>=2.10.5; that should fix the breakage reported by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2012/06/21 14:24:22 ajacoutot Exp $
d7 1
a7 2
DISTNAME=	opal-3.10.5
REVISION=	0
d30 2
a31 2
LIB_DEPENDS=	devel/ptlib>=2.10.5 \
		audio/celt>=0.11.0 \
d34 2
a35 2
# dlopen(3) libavcodec.so; shows as Extra: in check-lib-depends but
# this is ok, we want to be sure we track ABI changes
d52 4
a55 7
		LDFLAGS="-L${X11BASE}/lib -L${LOCALBASE}/lib -pthread" \
		ac_cv_path_SWIG=${LOCALBASE}/bin/swig
CONFIGURE_ARGS=	--disable-localspeex \
		--disable-localgsm \
		--enable-ixj \
		--disable-ruby \
		--disable-sbc \
d58 4
@


1.22
log
@Update to opal-3.10.5.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2012/04/20 13:28:50 dcoppa Exp $
d8 1
d31 1
a31 1
LIB_DEPENDS=	devel/ptlib>=2.10.4 \
@


1.21
log
@Fix after celt update

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2012/03/02 09:04:21 ajacoutot Exp $
d7 1
a7 3
DISTNAME=	opal-3.10.4

REVISION=	0
@


1.20
log
@Update to opal-3.10.4.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2011/11/13 15:53:14 ajacoutot Exp $
d9 2
d27 2
a28 2
WANTLIB += c celt0 crypto gsm m ogg pt pthread spandsp speex speexdsp
WANTLIB += stdc++ theora tiff x264
d33 1
a33 1
		audio/celt \
@


1.19
log
@Use SUBST_CMD now that nigel@@ fixed Subst.pm.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2011/10/26 16:59:34 ajacoutot Exp $
d7 1
a7 1
DISTNAME=	opal-3.10.3
d30 1
a30 1
LIB_DEPENDS=	devel/ptlib>=2.10.3 \
@


1.18
log
@Major update to opal-3.10.3.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/06/16 08:07:20 sthen Exp $
d69 2
a70 3
# use perl(1) instead of SUBST_CMD to prevent breaking the configure script
	perl -pi -e "s,!!LOCALBASE!!,${LOCALBASE},g;" \
		-e 's,SUBDIRS\+=\",SUBDIRS=\"\$${SUBDIRS},g' \
@


1.17
log
@Handle the dlopen()'d libavcodec the same way as transcode does with xvidcore;
move it from a BUILD+RUN_DEPENDS to WANTLIB+LIB_DEPENDS so that the dependency
is tracked and opal gets updated if the FFmpeg API changes. Comment to explain
why check-lib-depends says it's extra. Pointed out by Brad, ajacoutot@@ hates
it but is ok with it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/04/01 06:52:47 jakemsr Exp $
d7 1
a7 2
V=		3.6.8
DISTNAME=	opal-${V}
d9 1
a9 5
REVISION=	3

SUBST_VARS+=	V

SHARED_LIBS=	opal	1.0 # .2.2.11
d25 3
d30 3
a32 8
WANTLIB += SDL c crypto expat lber ldap ldap_r m ogg sasl2
WANTLIB += ssl speex speexdsp x264 theora gsm pt pthread stdc++

LIB_DEPENDS=	audio/speex \
		multimedia/libtheora \
		audio/gsm \
		devel/ptlib \
		multimedia/x264
d39 1
a39 2
ALL_TARGET=	opt
OPAL_FILE=	libopal.so
d42 2
a43 2
MAKE_FLAGS=	OPAL_FILE=${OPAL_FILE} \
		RELEASE_LIB_FILENAME_SHARED_PAT=${OPAL_FILE}.${LIBopal_VERSION}
d51 3
a53 2
CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include" \
		LDFLAGS="-L${LOCALBASE}/lib -pthread"
d56 5
a60 1
		--enable-plugins
d68 5
a72 3
.ifndef DEBUG
CONFIGURE_ENV+=	DEBUG_BUILD="no"
.endif
@


1.16
log
@fix ffmpeg support which broke with the recent ffmpeg update

ok ajacoutot@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/03/27 10:30:35 ajacoutot Exp $
d10 1
a10 1
REVISION=	2
d41 4
a44 2
BUILD_DEPENDS=	${RUN_DEPENDS}
RUN_DEPENDS=	graphics/ffmpeg>=20110306 # dlopen(3) libavcodec.so
@


1.15
log
@Remove now unneeded ffmpeg related patch.

from Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2010/11/19 22:31:35 espie Exp $
d10 1
a10 1
REVISION=	1
d42 1
a42 1
RUN_DEPENDS=	graphics/ffmpeg>=20100512 # dlopen(3) libavcodec.so
@


1.14
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2010/09/01 14:42:51 ajacoutot Exp $
d10 1
a10 1
REVISION=	0
@


1.13
log
@Duh, I forgot to bump...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2010/09/01 14:40:23 ajacoutot Exp $
d35 5
a39 5
LIB_DEPENDS=	::audio/speex \
		::multimedia/libtheora \
		::audio/gsm \
		::devel/ptlib \
		::multimedia/x264
d42 1
a42 1
RUN_DEPENDS=	:ffmpeg->=20100512:graphics/ffmpeg # dlopen(3) libavcodec.so
@


1.12
log
@Enable h264 and h263 support.
Switch to new DEPENDS/REVISION.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2010/05/31 06:31:39 ajacoutot Exp $
d9 2
@


1.11
log
@Update to opal-3.6.8.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2010/05/21 12:28:52 ajacoutot Exp $
d31 1
a31 1
WANTLIB += ssl
d33 8
a40 4
LIB_DEPENDS=	speex.>=7,speexdsp::audio/speex \
		theora::multimedia/libtheora \
		gsm::audio/gsm \
		pt.>=3::devel/ptlib
d56 1
a56 1
		LDFLAGS="-L${LOCALBASE}/lib"
a65 7

# XXX our FFmpeg is too old
CONFIGURE_ARGS+= --disable-h264
#BUILD_DEPENDS=	${RUN_DEPENDS}
#RUN_DEPENDS=	::graphics/ffmpeg # dlopen(3) libavcodec.so
#LIB_DEPENDS+=	x264::multimedia/x264
#LDFLAGS+=	-pthread
@


1.10
log
@We have posix_memalign(3) now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/03/27 14:41:15 ajacoutot Exp $
d7 1
a7 1
V=		3.6.6
a8 1
PKGNAME=	${DISTNAME}p1
@


1.9
log
@Fix compilation under amd64.
spotted by viq at viq dot ath dot cx
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/03/23 21:13:37 ajacoutot Exp $
d9 1
a9 1
PKGNAME=	${DISTNAME}p0
@


1.8
log
@Major update to opal-3.6.6.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2009/05/28 10:00:44 ajacoutot Exp $
d9 1
@


1.7
log
@- better homepage
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2009/02/18 11:56:25 jasper Exp $
d7 10
a16 4
DISTNAME=	opal-2.2.11
PKGNAME=	${DISTNAME}p4
SHARED_LIBS=	opal	0.0 # .2.2.11
CATEGORIES=	net devel
d28 1
a28 1
MASTER_SITES=	${HOMEPAGE}/admin/downloads/latest/sources/sources/
d30 2
a31 1
WANTLIB=	SDL crypto expat lber ldap ldap_r sasl2 ssl
d34 3
a36 1
		pt.>=2::devel/pwlib
d38 1
a38 1
ALL_TARGET=	optshared
d41 1
a41 1
MAKE_ENV=	CC=${CC} CPLUS=${CXX} BUILDSELF="1"
d43 1
a43 2
		LIB_SONAME=${OPAL_FILE}.${LIBopal_VERSION} \
		LIBNAME_PAT=${OPAL_FILE}.${LIBopal_VERSION}
d48 2
d53 25
a77 5
CONFIGURE_ARGS=	--disable-localspeex

pre-configure:
	@@perl -pi -e 's,!!PREFIX!!,${PREFIX},g' \
		${WRKSRC}/opal_inc.mak.in
@


1.6
log
@- fix potential 64-bit issue

maintainer (ajacoutot@@) would agree
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2009/01/17 14:14:14 ajacoutot Exp $
d8 1
a8 1
PKGNAME=	${DISTNAME}p3
d12 1
a12 1
HOMEPAGE=	http://www.ekiga.org/
@


1.5
log
@- sync WANTLIB+PLIST after latest pwlib changes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2008/09/08 17:17:10 ajacoutot Exp $
d8 1
a8 1
PKGNAME=	${DISTNAME}p2
@


1.4
log
@- sanitize STDCCFLAGS/CFLAGS
- add -fPIC unconditionally (requested by naddy@@) by adding it to
unix.mak (in pwlib) which get sourced by the other ports

feedback from and ok naddy@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2008/09/02 23:16:01 todd Exp $
d8 1
a8 1
PKGNAME=	${DISTNAME}p1
d24 1
a24 1
WANTLIB=	SDL crypto expat lber ldap ldap_r ossaudio sasl2 ssl
@


1.3
log
@give macppc a fighting chance, set the correct pic flag for this lib for macppc
ok ajacoutot@@ (maint)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2008/05/22 19:30:41 ajacoutot Exp $
d8 1
a8 1
PKGNAME=	${DISTNAME}p0
a27 5

.if ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "sparc64" \
 || ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "macppc"
CFLAGS+=	-fPIC
.endif
@


1.2
log
@- fix WANTLIB after pwlib FLAVORs merge
- cope with new speex version
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2008/04/29 07:01:18 ajacoutot Exp $
d30 1
a30 1
 || ${MACHINE_ARCH} == "alpha"
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d8 1
d24 1
a24 1
WANTLIB=	crypto expat ossaudio ssl
d26 1
a26 1
LIB_DEPENDS=	speex.>=4::audio/speex \
@


1.1.1.1
log
@Import opal-2.2.11

OPAL is an open-source class library for the development of applications
that wish to use the SIP and H.323 protocols for multi-media
communications over packet based networks.
@
text
@@
