head	1.12;
access;
symbols
	OPENBSD_6_2:1.12.0.2
	OPENBSD_6_2_BASE:1.12
	OPENBSD_6_1:1.11.0.2
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.9.0.6
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.9.0.2
	OPENBSD_5_9_BASE:1.9
	OPENBSD_5_8:1.9.0.4
	OPENBSD_5_8_BASE:1.9
	OPENBSD_5_7:1.8.0.2
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.4.0.6
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.4.0.4
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.4.0.2
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2
	sthen_20130115:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.12
date	2017.06.25.10.31.47;	author landry;	state Exp;
branches;
next	1.11;
commitid	9WUY2ey6XepWrMlb;

1.11
date	2016.11.21.14.19.48;	author sthen;	state Exp;
branches;
next	1.10;
commitid	PtTkfmL1rz9GgLew;

1.10
date	2016.11.14.09.35.38;	author landry;	state Exp;
branches;
next	1.9;
commitid	3d6rpZF08XNxq5Tp;

1.9
date	2015.06.19.16.34.41;	author sthen;	state Exp;
branches;
next	1.8;
commitid	ZeUuk8Q1fSMJgm1B;

1.8
date	2015.01.08.14.08.15;	author ajacoutot;	state Exp;
branches;
next	1.7;
commitid	c2EjIBU5fxm7ZaFa;

1.7
date	2014.10.11.21.11.20;	author sthen;	state Exp;
branches;
next	1.6;
commitid	o8l9PCL4q7XU0XHl;

1.6
date	2014.10.11.16.13.36;	author landry;	state Exp;
branches;
next	1.5;
commitid	foym6BixOZZ3sJsY;

1.5
date	2014.10.09.13.06.04;	author sthen;	state Exp;
branches;
next	1.4;
commitid	1vyxAzXEdxneat1q;

1.4
date	2013.03.28.18.24.29;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2013.03.11.11.35.58;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2013.01.16.20.54.40;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2013.01.15.23.02.19;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2013.01.15.23.02.19;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.12
log
@Update to xl2tpd 1.3.9.

ok sthen@@
@
text
@# $OpenBSD: Makefile,v 1.11 2016/11/21 14:19:48 sthen Exp $

COMMENT=	l2tp client/server

GH_ACCOUNT=	xelerance
GH_PROJECT=	xl2tpd
GH_TAGNAME=	v1.3.9

CATEGORIES=	net

HOMEPAGE=	http://www.xelerance.com/services/software/xl2tpd/

# GPLv2
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += c util

FAKE_FLAGS=	DESTDIR= MANDIR=${WRKINST}${PREFIX}/man
NO_TEST=	Yes

do-configure:
	perl -pi -e 's,/etc,${SYSCONFDIR},' ${WRKSRC}/file.h

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/xl2tpd/
	cd ${WRKSRC}/doc; ${INSTALL_DATA} l2tpd.conf.sample \
	    l2tp-secrets.sample ../examples/ppp-options.xl2tpd \
	    ${PREFIX}/share/examples/xl2tpd/

# Only build xl2tpd/xl2tpd-control for now; pfc A) needs something that was
# stripped from our libpcap and B) isn't useful with our old pppd anyway.
# If enabling this, these 4 lines can go.
ALL_TARGET=	xl2tpd xl2tpd-control
do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/xl2tpd{,-control} ${PREFIX}/sbin/
	${INSTALL_DATA} ${WRKSRC}/doc/*.8 ${PREFIX}/man/man8/
	${INSTALL_DATA} ${WRKSRC}/doc/*.5 ${PREFIX}/man/man5/

.include <bsd.port.mk>
@


1.11
log
@drop maintainer, I'm not using xl2tpd any more
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2016/11/14 09:35:38 landry Exp $
a4 2
DISTNAME=	xl2tpd-1.3.8
REVISION=	0
d7 1
a7 1
GH_COMMIT=	cec1ebe1523bf248f134647dd6030a333d93e19b
d16 1
a16 1
WANTLIB += c m util
@


1.10
log
@Update to xl2tpd 1.3.8, xelerance switched to github.

Most of our patches merged upstream, and while here remove a -Os from
CFLAGS (spotted by jca@@). With this update, i've (finally!) been able to
connect to an OpenBSD VPN running isakmpd with psk/npppd.

ok sthen@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2015/06/19 16:34:41 sthen Exp $
d6 1
a13 2

MAINTAINER=	Stuart Henderson <sthen@@openbsd.org>
@


1.9
log
@Add a fix from Sergey Ryazanov <ryazanov.s.a / gmail.com> to handle
fragmented ppp frames while reading from pty. From Sergey's mail:

=====
xl2tpd could not correctly handle fragmented ppp frame while read it
from pty if one of consequent read operation return an error.
That's happening because xl2tpd too often cleans the buffer and
assumes that each read frame operation is performed for new frame,
since xl2tpd uses single buffer for pty and for socket read operations.

The attached patch moves all pty related buffers into _call_ context
and corrects calculation of buffer position, what fixes issue with
handling of fragmented frames. Now we can use MTU > 1000. I tested
these changes with load (L2TP tunnel without IPSec) and all seems work
normally. No more "Protocol-Reject" frames.
=====

Performance is still poor (Sergey was seeing ~2Mb/s, I am seeing less
despite low cpu use) but the tunnel now seems reliable.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2015/01/08 14:08:15 ajacoutot Exp $
d5 4
a8 2
DISTNAME=	xl2tpd-1.3.1
REVISION=	6
d19 1
a19 4
WANTLIB += c util

# https://github.com/xelerance/xl2tpd/
MASTER_SITES=	http://download.openswan.org/xl2tpd/
@


1.8
log
@Fix rcctl(8) usage.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2014/10/11 21:11:20 sthen Exp $
d6 1
a6 1
REVISION=	5
@


1.7
log
@don't re-create the fifo if it still exists from a previous failed startup,
noted by landry
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2014/10/11 16:13:36 landry Exp $
d6 1
a6 1
REVISION=	4
@


1.6
log
@Fix typo (s/pppo0/ppp0/) - thanks stuart for that awesomely detailed README :)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2014/10/09 13:06:04 sthen Exp $
d6 1
a6 1
REVISION=	3
@


1.5
log
@Add some notes on l2tp+ipsec. Definitely not perfect as there are some issues
with fragments and stalls under high load, but it is possible to connect to
npppd using l2tp+ipsec with this information.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2013/03/28 18:24:29 sthen Exp $
d6 1
a6 1
REVISION=	2
@


1.4
log
@enable xl2tpd-control and adjust README
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2013/03/11 11:35:58 espie Exp $
d6 1
a6 1
REVISION=	1
d20 1
a20 2
MASTER_SITES=	http://ftp.openswan.org/xl2tpd/ \
		ftp://ftp.xelerance.com/xl2tpd/
@


1.3
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2013/01/16 20:54:40 sthen Exp $
d6 1
a6 1
REVISION=	0
d35 4
a38 5
# Only build xl2tpd itself for now; pfc A) needs something that was
# stripped from our libpcap and B) isn't useful with our old pppd anyway;
# xl2tpd-control requires fmemopen() which we don't have. If enabling
# these, these 4 lines can go.
ALL_TARGET=	xl2tpd
d40 1
a40 1
	${INSTALL_PROGRAM} ${WRKSRC}/xl2tpd ${PREFIX}/sbin/
@


1.2
log
@additional notes for README
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2013/01/15 23:02:19 sthen Exp $
a15 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d24 1
a24 1
NO_REGRESS=	Yes
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d6 1
@


1.1.1.1
log
@import ports/net/xl2tpd, ok pirofti@@

xl2tpd is an implementation of the Layer 2 Tunnelling Protocol (RFC 2661),
which works by opening a pseudo-tty for communicating with pppd.

L2TP allows you to tunnel PPP over UDP. Some ISPs use L2TP to tunnel user
sessions from dial-in servers (modem banks, ADSL DSLAMs) to back-end PPP
servers. Another important application is Virtual Private Networks where
the IPsec protocol is used to secure the L2TP connection (L2TP/IPsec,
RFC 3193).
@
text
@@
