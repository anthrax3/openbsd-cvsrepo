head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.22
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.20
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.18
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.14
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.16
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.12
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.10
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.8
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.6
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.4
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.2
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.34
	OPENBSD_5_0:1.2.0.32
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.30
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.28
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.26
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.24
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.22
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.20
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.18
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.16
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.14
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.12
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.10
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.8
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.6
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.4
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.1.1.1.0.10
	OPENBSD_3_4_BASE:1.1.1.1
	OPENBSD_3_3:1.1.1.1.0.8
	OPENBSD_3_3_BASE:1.1.1.1
	OPENBSD_3_2:1.1.1.1.0.6
	OPENBSD_3_2_BASE:1.1.1.1
	OPENBSD_3_1:1.1.1.1.0.4
	OPENBSD_3_1_BASE:1.1.1.1
	OPENBSD_3_0:1.1.1.1.0.2
	OPENBSD_3_0_BASE:1.1.1.1
	OPENBSD_2_9_TRACKING_SWITCH:1.1.1.1
	fgsch_20010712:1.1.1.1
	fgsch:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2012.04.13.14.12.52;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2003.12.14.01.39.18;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2001.07.13.02.27.16;	author fgsch;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.07.13.02.27.16;	author fgsch;	state Exp;
branches;
next	;


desc
@@


1.3
log
@include <sys/param.h> at the top, not inside a function body, which fails
on alpha because param.h pulls in all sorts of kernel headers
@
text
@Deal with _POSIX_SAVED_IDS when relinquishing privileges
use MAXHOSTNAMELEN

$OpenBSD: patch-unix_init_c,v 1.2 2003/12/14 01:39:18 naddy Exp $
--- unix/init.c.orig	Thu May 29 08:08:49 2003
+++ unix/init.c	Fri Apr 13 15:54:54 2012
@@@@ -49,6 +49,10 @@@@
 #if ! HAVE_GETHOSTNAME && HAVE_UNAME
 #include <sys/utsname.h>
 #endif
+#if HAVE_GETHOSTNAME
+/* Get a value for MAXHOSTNAMELEN. */
+#include <sys/param.h>
+#endif
 
 /* Use getcwd in preference to getwd; if we have neither, we will be
    using a getcwd replacement.  */
@@@@ -209,7 +213,7 @@@@ usysdep_initialize (puuconf,iflags)
   if (iuuconf == UUCONF_NOT_FOUND)
     {
 #if HAVE_GETHOSTNAME
-      char ab[256];
+      char ab[MAXHOSTNAMELEN];
 
       if (gethostname (ab, sizeof ab - 1) < 0)
 	ulog (LOG_FATAL, "gethostname: %s", strerror (errno));
@@@@ -271,8 +275,10 @@@@ usysdep_initialize (puuconf,iflags)
       && geteuid () == 0)
     {
       q = getpwnam (OWNER);
-      if (q != NULL)
+      if (q != NULL) {
+	seteuid (q->pw_uid);
 	setuid (q->pw_uid);
+      }
     }
 
   if ((iflags & INIT_GETCWD) != 0)
@@@@ -370,8 +376,10 @@@@ usysdep_exit (fsuccess)
 boolean fsysdep_other_config (z)
      const char *z ATTRIBUTE_UNUSED;
 {
-  (void) setuid (getuid ());
+  (void) setegid (getgid ());
   (void) setgid (getgid ());
+  (void) seteuid (getuid ());
+  (void) setuid (getuid ());
   return TRUE;
 }
 
@


1.2
log
@update to 1.07
@
text
@d4 15
a18 4
$OpenBSD: patch-unix_init_c,v 1.1.1.1 2001/07/13 02:27:16 fgsch Exp $
--- unix/init.c.orig	2003-05-29 08:08:49.000000000 +0200
+++ unix/init.c	2003-11-11 21:28:58.000000000 +0100
@@@@ -209,7 +209,8 @@@@ usysdep_initialize (puuconf,iflags)
a22 1
+#include <sys/param.h>
d27 1
a27 1
@@@@ -271,8 +272,10 @@@@ usysdep_initialize (puuconf,iflags)
d39 1
a39 1
@@@@ -370,8 +373,10 @@@@ usysdep_exit (fsuccess)
@


1.1
log
@Initial revision
@
text
@d4 4
a7 4
$OpenBSD$
--- unix/init.c.orig	Sun Aug 20 15:30:24 1995
+++ unix/init.c	Thu Jul 12 21:56:10 2001
@@@@ -210,7 +210,8 @@@@ usysdep_initialize (puuconf,iflags)
d17 1
a17 1
@@@@ -272,8 +273,10 @@@@ usysdep_initialize (puuconf,iflags)
d29 1
a29 1
@@@@ -371,8 +374,10 @@@@ usysdep_exit (fsuccess)
d31 1
a31 1
      const char *z;
@


1.1.1.1
log
@uucp port as talked in !c2k1; a minor things left to be complete.
@
text
@@
