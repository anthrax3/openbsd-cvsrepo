head	1.4;
access;
symbols
	OPENBSD_3_4:1.3.0.2
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.1.0.2
	OPENBSD_3_3_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2003.10.06.07.11.14;	author david;	state dead;
branches;
next	1.3;

1.3
date	2003.06.01.08.41.00;	author david;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.28.21.34.40;	author david;	state dead;
branches;
next	1.1;

1.1
date	2003.01.22.07.30.26;	author pvalchev;	state Exp;
branches;
next	;


desc
@@


1.4
log
@update to mICQ 0.4.10.4 (fixes a remote DoS)
@
text
@$OpenBSD: patch-src_contact_c,v 1.3 2003/06/01 08:41:00 david Exp $
--- src/contact.c.orig	Mon May 12 09:38:39 2003
+++ src/contact.c	Fri May 23 17:22:16 2003
@@@@ -587,7 +587,7 @@@@ BOOL ContactMetaLoad (Contact *cont)
             if (enc & ENC_AUTO && (enc ^ prG->enc_loc) & ~ENC_AUTO)
                 return FALSE;
 #else
-            if (enc != prG->enc_loc & ~ENC_AUTO)
+            if ((enc ^ prG->enc_loc) & ~ENC_AUTO)
                 return FALSE;
 #endif
             enc &= ~ENC_AUTO;
@@@@ -738,7 +738,7 @@@@ void ContactSetCap (Contact *cont, Cap *
             cont->v1 = (ver >> 6) - 1;
             cont->v2 = ver & 0x1f;
             cont->v3 = cont->v4 = 0;
-            if (ver <= 0x108)
+            if (ver <= 0x48)
                 cont->caps &= ~(1 << CAP_UTF8);
         }
         else /* KOtzPEKE */
@


1.3
log
@upstream fixes: contact list loading and setup wizard
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@update micq to 0.4.10.2 (bug fix and translation update release)
my snprintf and spelling patches were integrated
ok pvalchev@@
@
text
@d1 19
a19 13
$OpenBSD: patch-src_contact_c,v 1.1 2003/01/22 07:30:26 pvalchev Exp $
--- src/contact.c.orig	Tue Jan  7 10:12:05 2003
+++ src/contact.c	Fri Jan 10 03:03:00 2003
@@@@ -885,9 +885,9 @@@@ void ContactSetVersion (Contact *cont)
         if (cont->v1 || cont->v2 || cont->v3 || cont->v4)
         {
             strcat (buf, " ");
-                                      sprintf (buf + strlen (buf), "%d.%d", cont->v1, cont->v2);
-            if (cont->v3 || cont->v4) sprintf (buf + strlen (buf), ".%d", cont->v3);
-            if (cont->v4)             sprintf (buf + strlen (buf), ".%d", cont->v4);
+                                      snprintf (buf + strlen (buf), sizeof(buf) - strlen (buf), "%d.%d", cont->v1, cont->v2);
+            if (cont->v3 || cont->v4) snprintf (buf + strlen (buf), sizeof(buf) - strlen (buf), ".%d", cont->v3);
+            if (cont->v4)             snprintf (buf + strlen (buf), sizeof(buf) - strlen (buf), ".%d", cont->v4);
d21 1
a21 2
         if (tail) strcat (buf, tail);
     }
@


1.1
log
@use snprintf; from maintainer David Krause
@
text
@d1 1
a1 1
$OpenBSD$
@

