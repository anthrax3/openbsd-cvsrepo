head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2005.03.01.00.12.23;	author david;	state dead;
branches;
next	1.1;

1.1
date	2005.02.20.07.19.57;	author david;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to micq-0.5.0.1 (translation and bug fix release)
@
text
@$OpenBSD: patch-src_tcp_c,v 1.1 2005/02/20 07:19:57 david Exp $
--- src/tcp.c.orig	2004-12-21 13:09:54.000000000 -0600
+++ src/tcp.c	2005-02-20 01:14:55.000000000 -0600
@@@@ -596,9 +596,10 @@@@ static void TCPDispatchPeer (Connection 
         return;
     }
 
+    peer->connect &= ~CONNECT_SELECT_W;
     /* Recv all packets before doing anything else.
          The objective is to delete any packets CANCELLED by the remote user. */
-    while (UtilIOSelectIs (peer->sok, READFDS) && i++ <= TCP_MSG_QUEUE)
+    while (UtilIOSelectIs (peer->sok, READFDS | WRITEFDS) && i++ <= TCP_MSG_QUEUE)
     {
         if (!(pak = TCPReceivePacket (peer)))
             return;
@@@@ -645,7 +646,6 @@@@ static void TCPDispatchPeer (Connection 
         UtilIOSelectAdd (peer->sok, READFDS);
         UtilIOSelect();
     }
-    peer->connect &= ~CONNECT_SELECT_W;
 }
 
 /*********************************************/
@


1.1
log
@add upstream patch from author to fix OpenSSL connections
@
text
@d1 1
a1 1
$OpenBSD$
@

