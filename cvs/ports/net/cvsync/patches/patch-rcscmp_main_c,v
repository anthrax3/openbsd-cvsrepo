head	1.1;
access;
symbols
	OPENBSD_6_0:1.1.0.10
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.6
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.8
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.4
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.2
	OPENBSD_5_6_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2014.06.25.17.54.07;	author naddy;	state Exp;
branches;
next	;
commitid	H1YfraZmPQVw4z3c;


desc
@@


1.1
log
@Add full support for commitid and bump protocol version.
Old clients will receive updates with commitid stripped out.

Upstream author agrees with the direction taken.

Heavy lifting by jca@@, debugging and tweaks by yours truly
ok jcs@@
@
text
@$OpenBSD$
--- rcscmp/main.c.orig	Mon Jul 18 16:37:38 2005
+++ rcscmp/main.c	Wed Jun 25 00:48:47 2014
@@@@ -220,6 +220,10 @@@@ rcscmp_hash(struct rcslib_file *rcs, const struct hash
 			(*hashops->update)(ctx, rev->next.n_str,
 					   rev->next.n_len);
 		}
+		if (rev->commitid.i_len > 0) {
+			(*hashops->update)(ctx, rev->commitid.i_id,
+					   rev->commitid.i_len);
+		}
 	}
 
 	if (rcs->desc.s_len > 0)
@
