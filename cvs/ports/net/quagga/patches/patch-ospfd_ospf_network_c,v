head	1.2;
access;
symbols
	OPENBSD_6_2:1.2.0.6
	OPENBSD_6_2_BASE:1.2
	OPENBSD_6_1:1.2.0.4
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.2
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.1.0.12
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.14
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.10
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.8
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.6
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.4
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.2
	OPENBSD_5_3_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2016.03.22.12.57.54;	author jca;	state Exp;
branches;
next	1.1;
commitid	UMHjWDfFsEz4krLO;

1.1
date	2013.01.04.00.24.10;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to 1.0.20160315, ok sthen@@ (maintainer)

Announce:

  https://lists.quagga.net/pipermail/quagga-users/2016-March/014293.html

ChangeLog:

  http://savannah.spinellicreations.com/quagga/quagga-1.0.20160315.changelog.txt
  http://savannah.spinellicreations.com/quagga/quagga-1.0.20160309.changelog.txt

Note that this update brings a fix for CVE-2016-2342.  This vulnerability
affects quagga MPLS VPN setups which probably aren't possible on OpenBSD.
@
text
@$OpenBSD: patch-ospfd_ospf_network_c,v 1.1 2013/01/04 00:24:10 sthen Exp $

Revert 69bf3a39; does not work on at least (Open/Net)BSD.
This can be put back if we get RFC3678 support.

--- ospfd/ospf_network.c.orig	Wed Mar 16 00:17:17 2016
+++ ospfd/ospf_network.c	Mon Mar 21 01:24:12 2016
@@@@ -52,8 +52,8 @@@@ ospf_if_add_allspfrouters (struct ospf *top, struct pr
 {
   int ret;
   
-  ret = setsockopt_ipv4_multicast (top->fd, IP_ADD_MEMBERSHIP,
-                                   htonl (OSPF_ALLSPFROUTERS),
+  ret = setsockopt_multicast_ipv4 (top->fd, IP_ADD_MEMBERSHIP,
+                                   p->u.prefix4, htonl (OSPF_ALLSPFROUTERS),
                                    ifindex);
   if (ret < 0)
     zlog_warn ("can't setsockopt IP_ADD_MEMBERSHIP (fd %d, addr %s, "
@@@@ -73,8 +73,8 @@@@ ospf_if_drop_allspfrouters (struct ospf *top, struct p
 {
   int ret;
 
-  ret = setsockopt_ipv4_multicast (top->fd, IP_DROP_MEMBERSHIP,
-                                   htonl (OSPF_ALLSPFROUTERS),
+  ret = setsockopt_multicast_ipv4 (top->fd, IP_DROP_MEMBERSHIP,
+                                   p->u.prefix4, htonl (OSPF_ALLSPFROUTERS),
                                    ifindex);
   if (ret < 0)
     zlog_warn ("can't setsockopt IP_DROP_MEMBERSHIP (fd %d, addr %s, "
@@@@ -93,8 +93,8 @@@@ ospf_if_add_alldrouters (struct ospf *top, struct pref
 {
   int ret;
 
-  ret = setsockopt_ipv4_multicast (top->fd, IP_ADD_MEMBERSHIP,
-                                   htonl (OSPF_ALLDROUTERS),
+  ret = setsockopt_multicast_ipv4 (top->fd, IP_ADD_MEMBERSHIP,
+                                   p->u.prefix4, htonl (OSPF_ALLDROUTERS),
                                    ifindex);
   if (ret < 0)
     zlog_warn ("can't setsockopt IP_ADD_MEMBERSHIP (fd %d, addr %s, "
@@@@ -113,8 +113,8 @@@@ ospf_if_drop_alldrouters (struct ospf *top, struct pre
 {
   int ret;
 
-  ret = setsockopt_ipv4_multicast (top->fd, IP_DROP_MEMBERSHIP,
-                                   htonl (OSPF_ALLDROUTERS),
+  ret = setsockopt_multicast_ipv4 (top->fd, IP_DROP_MEMBERSHIP,
+                                   p->u.prefix4, htonl (OSPF_ALLDROUTERS),
                                    ifindex);
   if (ret < 0)
     zlog_warn ("can't setsockopt IP_DROP_MEMBERSHIP (fd %d, addr %s, "
@@@@ -149,7 +149,8 @@@@ ospf_if_ipmulticast (struct ospf *top, struct prefix *
     zlog_warn ("can't setsockopt IP_MULTICAST_TTL(1) for fd %d: %s",
 	       top->fd, safe_strerror (errno));
 
-  ret = setsockopt_ipv4_multicast_if (top->fd, ifindex);
+  ret = setsockopt_multicast_ipv4 (top->fd, IP_MULTICAST_IF,
+                                   p->u.prefix4, 0, ifindex);
   if (ret < 0)
     zlog_warn("can't setsockopt IP_MULTICAST_IF(fd %d, addr %s, "
 	      "ifindex %u): %s",
@


1.1
log
@revert multicast changes in last upstream release, they do not work on OS
which require the interface IP address for IP_{ADD,DROP}_MEMBERSHIP

reported by Raphael Mazelier
@
text
@d1 1
a1 1
$OpenBSD$
d6 2
a7 2
--- ospfd/ospf_network.c.orig	Tue Apr 17 14:56:26 2012
+++ ospfd/ospf_network.c	Thu Jan  3 00:24:26 2013
d30 1
a30 1
@@@@ -94,8 +94,8 @@@@ ospf_if_add_alldrouters (struct ospf *top, struct pref
d41 1
a41 1
@@@@ -115,8 +115,8 @@@@ ospf_if_drop_alldrouters (struct ospf *top, struct pre
d52 1
a52 1
@@@@ -151,7 +151,8 @@@@ ospf_if_ipmulticast (struct ospf *top, struct prefix *
@

