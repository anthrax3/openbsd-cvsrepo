head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2012.03.31.10.51.47;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2012.03.20.20.56.26;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to quagga 0.99.20.1 rolling in the security fixes which we had as
separate patches.

multicast support changed in 0.99.20 and not fully tested, no response to
my ports@@ call for testing, so if this breaks things send me a mail with
details.
@
text
@$OpenBSD: patch-ospfd_ospf_dump_c,v 1.1 2012/03/20 20:56:26 sthen Exp $

from 0.99.20.1 upstream

--- ospfd/ospf_dump.c.orig	Mon Sep 26 09:50:48 2011
+++ ospfd/ospf_dump.c	Tue Mar 20 20:05:06 2012
@@@@ -115,6 +115,16 @@@@ const struct message ospf_network_type_msg[] =
 };
 const int ospf_network_type_msg_max = OSPF_IFTYPE_MAX;
 
+/* AuType */
+const struct message ospf_auth_type_str[] =
+{
+  { OSPF_AUTH_NULL,          "Null"          },
+  { OSPF_AUTH_SIMPLE,        "Simple"        },
+  { OSPF_AUTH_CRYPTOGRAPHIC, "Cryptographic" },
+};
+const size_t ospf_auth_type_str_max = sizeof (ospf_auth_type_str) /
+  sizeof (ospf_auth_type_str[0]);
+
 /* Configuration debug option variables. */
 unsigned long conf_debug_ospf_packet[5] = {0, 0, 0, 0, 0};
 unsigned long conf_debug_ospf_event = 0;
@@@@ -657,18 +667,19 @@@@ static void
 ospf_header_dump (struct ospf_header *ospfh)
 {
   char buf[9];
+  u_int16_t auth_type = ntohs (ospfh->auth_type);
 
   zlog_debug ("Header");
   zlog_debug ("  Version %d", ospfh->version);
   zlog_debug ("  Type %d (%s)", ospfh->type,
-	     ospf_packet_type_str[ospfh->type]);
+	     LOOKUP (ospf_packet_type_str, ospfh->type));
   zlog_debug ("  Packet Len %d", ntohs (ospfh->length));
   zlog_debug ("  Router ID %s", inet_ntoa (ospfh->router_id));
   zlog_debug ("  Area ID %s", inet_ntoa (ospfh->area_id));
   zlog_debug ("  Checksum 0x%x", ntohs (ospfh->checksum));
-  zlog_debug ("  AuType %d", ntohs (ospfh->auth_type));
+  zlog_debug ("  AuType %s", LOOKUP (ospf_auth_type_str, auth_type));
 
-  switch (ntohs (ospfh->auth_type))
+  switch (auth_type)
     {
     case OSPF_AUTH_NULL:
       break;
@@@@ -1457,7 +1468,7 @@@@ DEFUN (show_debugging_ospf,
     if (IS_DEBUG_OSPF_PACKET (i, SEND) && IS_DEBUG_OSPF_PACKET (i, RECV))
       {
 	vty_out (vty, "  OSPF packet %s%s debugging is on%s",
-		 ospf_packet_type_str[i + 1],
+		 LOOKUP (ospf_packet_type_str, i + 1),
 		 IS_DEBUG_OSPF_PACKET (i, DETAIL) ? " detail" : "",
 		 VTY_NEWLINE);
       }
@@@@ -1465,12 +1476,12 @@@@ DEFUN (show_debugging_ospf,
       {
 	if (IS_DEBUG_OSPF_PACKET (i, SEND))
 	  vty_out (vty, "  OSPF packet %s send%s debugging is on%s",
-		   ospf_packet_type_str[i + 1],
+		   LOOKUP (ospf_packet_type_str, i + 1),
 		   IS_DEBUG_OSPF_PACKET (i, DETAIL) ? " detail" : "",
 		   VTY_NEWLINE);
 	if (IS_DEBUG_OSPF_PACKET (i, RECV))
 	  vty_out (vty, "  OSPF packet %s receive%s debugging is on%s",
-		   ospf_packet_type_str[i + 1],
+		   LOOKUP (ospf_packet_type_str, i + 1),
 		   IS_DEBUG_OSPF_PACKET (i, DETAIL) ? " detail" : "",
 		   VTY_NEWLINE);
       }
@


1.1
log
@add SECURITY patches from quagga 0.99.20.1

CVE-2012-0249 - Quagga ospfd DoS on malformed LS-Update packet
CVE-2012-0250 - Quagga ospfd DoS on malformed Network-LSA data
CVE-2012-0255 - Quagga bgpd DoS on malformed OPEN message
@
text
@d1 1
a1 1
$OpenBSD$
@

