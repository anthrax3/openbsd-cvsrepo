head	1.4;
access;
symbols
	OPENBSD_6_1:1.4.0.2
	OPENBSD_6_1_BASE:1.4
	OPENBSD_6_0:1.3.0.2
	OPENBSD_6_0_BASE:1.3;
locks; strict;
comment	@# @;


1.4
date	2016.09.01.12.21.05;	author dcoppa;	state Exp;
branches;
next	1.3;
commitid	vbQbGmGriHby5Tqc;

1.3
date	2016.05.26.09.29.23;	author dcoppa;	state Exp;
branches;
next	1.2;
commitid	3fh51VJZLS9pXnED;

1.2
date	2016.01.12.10.22.32;	author dcoppa;	state dead;
branches;
next	1.1;
commitid	jQfhHmZVMd9a92aW;

1.1
date	2016.01.11.09.28.16;	author dcoppa;	state Exp;
branches;
next	;
commitid	LVCv3oVwpn4k0Sle;


desc
@@


1.4
log
@
Update to impacket-0.9.15
@
text
@$OpenBSD: patch-examples_raiseChild_py,v 1.3 2016/05/26 09:29:23 dcoppa Exp $
--- examples/raiseChild.py.orig	Tue Jun 28 19:26:31 2016
+++ examples/raiseChild.py	Thu Sep  1 08:05:39 2016
@@@@ -1443,16 +1443,16 @@@@ if __name__ == '__main__':
     if len(sys.argv)==1:
         parser.print_help()
         print "\nExamples: "
-        print "\tpython raiseChild.py childDomain.net/adminuser\n"
+        print "\t${MODPY_BIN} raiseChild.py childDomain.net/adminuser\n"
         print "\tthe password will be asked, or\n"
-        print "\tpython raiseChild.py childDomain.net/adminuser:mypwd\n"
+        print "\t${MODPY_BIN} raiseChild.py childDomain.net/adminuser:mypwd\n"
         print "\tor if you just have the hashes\n"
-        print "\tpython raiseChild.py -hashes LMHASH:NTHASH childDomain.net/adminuser\n"
+        print "\t${MODPY_BIN} raiseChild.py -hashes LMHASH:NTHASH childDomain.net/adminuser\n"
 
         print "\tThis will perform the attack and then psexec against target-exec as Enterprise Admin"
-        print "\tpython raiseChild.py -target-exec targetHost childDomainn.net/adminuser\n"
+        print "\t${MODPY_BIN} raiseChild.py -target-exec targetHost childDomainn.net/adminuser\n"
         print "\tThis will save the final goldenTicket generated in the ccache target file"
-        print "\tpython raiseChild.py -w ccache childDomain.net/adminuser\n"
+        print "\t${MODPY_BIN} raiseChild.py -w ccache childDomain.net/adminuser\n"
         sys.exit(1)
  
     options = parser.parse_args()
@


1.3
log
@
Update (again) to impacket-0.9.14 + fixes
@
text
@d1 4
a4 44
$OpenBSD$

commit f8b900f2a8adae3dbfb79c123f76f2b57a2022a3
Author: asolino <bethus@@gmail.com>
Date:   Fri May 6 14:56:46 2016 -0300

Fix ERROR_DS_DIFFERENT_REPL_EPOCHS when running against a domain
with dwReplEpoch != 0

commit 8d8aab419fa17ce7d922a307f1c7ed0ed8e0b130
Author: asolino <bethus@@gmail.com>
Date:   Sun May 15 18:47:15 2016 -0300

Fix empty domain check

--- examples/raiseChild.py.orig	Wed Jan  6 09:54:29 2016
+++ examples/raiseChild.py	Wed May 25 09:10:06 2016
@@@@ -838,6 +838,25 @@@@ class RAISECHILD:
         request['pextClient']['rgb'] = list(str(drs))
         resp = self.__drsr.request(request)
 
+        # Let's dig into the answer to check the dwReplEpoch. This field should match the one we send as part of
+        # DRSBind's DRS_EXTENSIONS_INT(). If not, it will fail later when trying to sync data.
+        drsExtensionsInt = drsuapi.DRS_EXTENSIONS_INT()
+
+        # If dwExtCaps is not included in the answer, let's just add it so we can unpack DRS_EXTENSIONS_INT right.
+        ppextServer = ''.join(resp['ppextServer']['rgb']) + '\x00' * (
+        len(drsuapi.DRS_EXTENSIONS_INT()) - resp['ppextServer']['cb'])
+        drsExtensionsInt.fromString(ppextServer)
+
+        if drsExtensionsInt['dwReplEpoch'] != 0:
+            # Different epoch, we have to call DRSBind again
+            if logging.getLogger().level == logging.DEBUG:
+                logging.debug("DC's dwReplEpoch != 0, setting it to %d and calling DRSBind again" % drsExtensionsInt[
+                    'dwReplEpoch'])
+            drs['dwReplEpoch'] = drsExtensionsInt['dwReplEpoch']
+            request['pextClient']['cb'] = len(drs)
+            request['pextClient']['rgb'] = list(str(drs))
+            resp = self.__drsr.request(request)
+
         self.__hDrs = resp['phDrs']
 
         # Now let's get the NtdsDsaObjectGuid UUID to use when querying NCChanges
@@@@ -1397,16 +1416,16 @@@@ if __name__ == '__main__':
a25 9
@@@@ -1427,7 +1446,7 @@@@ if __name__ == '__main__':
     else:
         logging.getLogger().setLevel(logging.INFO)
 
-    if domain is None:
+    if domain is '':
         logging.critical('Domain should be specified!')
         sys.exit(1)
 
@


1.2
log
@
Revert previous: 0.9.14 is broken.
I'll open an issue on upstream's github.
@
text
@d1 44
a44 4
$OpenBSD: patch-examples_raiseChild_py,v 1.1 2016/01/11 09:28:16 dcoppa Exp $
--- examples/raiseChild.py.orig	Mon Jan 11 09:53:32 2016
+++ examples/raiseChild.py	Mon Jan 11 09:56:22 2016
@@@@ -1397,16 +1397,16 @@@@ if __name__ == '__main__':
d66 9
@


1.1
log
@
Update to impacket-0.9.14
@
text
@d1 1
a1 1
$OpenBSD$
@

