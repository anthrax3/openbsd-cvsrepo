head	1.19;
access;
symbols
	OPENBSD_6_1:1.13.0.2
	OPENBSD_6_1_BASE:1.13
	OPENBSD_6_0:1.10.0.2
	OPENBSD_6_0_BASE:1.10
	OPENBSD_5_9:1.8.0.2
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.4.0.4
	OPENBSD_5_8_BASE:1.4
	jca_20150412:1.1.1.1
	jca:1.1.1;
locks; strict;
comment	@# @;


1.19
date	2017.08.22.10.14.10;	author espie;	state Exp;
branches;
next	1.18;
commitid	CwQ3MRkqbTqWQq8J;

1.18
date	2017.07.23.12.39.37;	author zhuk;	state Exp;
branches;
next	1.17;
commitid	fItCWBSUVbAs3WXU;

1.17
date	2017.06.29.17.10.06;	author jca;	state Exp;
branches;
next	1.16;
commitid	Fs7Fz6Egcl8mPkwz;

1.16
date	2017.06.03.10.44.41;	author jca;	state Exp;
branches;
next	1.15;
commitid	nwtQYlXQiXLXCJhI;

1.15
date	2017.06.02.04.26.23;	author jca;	state Exp;
branches;
next	1.14;
commitid	OPcbwJbVRd8E4WMr;

1.14
date	2017.06.01.13.42.01;	author jca;	state Exp;
branches;
next	1.13;
commitid	3UifAiZVbL5o2fn0;

1.13
date	2016.12.30.15.47.55;	author jca;	state Exp;
branches
	1.13.2.1;
next	1.12;
commitid	3Sm4ek68W3sWMGGM;

1.12
date	2016.11.12.16.29.16;	author jca;	state Exp;
branches;
next	1.11;
commitid	9rmIyfDdBfOIMW4x;

1.11
date	2016.08.11.12.04.17;	author jca;	state Exp;
branches;
next	1.10;
commitid	vXrvJGXHPiFgUKgv;

1.10
date	2016.03.11.20.28.28;	author naddy;	state Exp;
branches;
next	1.9;
commitid	UYLP8TE6V7RS2GhJ;

1.9
date	2016.03.03.12.33.41;	author jca;	state Exp;
branches;
next	1.8;
commitid	oWccP7Paeb9xn38u;

1.8
date	2015.12.01.20.36.31;	author jca;	state Exp;
branches;
next	1.7;
commitid	7ILla3kU3EedkfdZ;

1.7
date	2015.11.20.17.17.50;	author sthen;	state Exp;
branches;
next	1.6;
commitid	5jJ7D9qeiviUpxXN;

1.6
date	2015.10.05.19.20.20;	author jca;	state Exp;
branches;
next	1.5;
commitid	8edLCLINmYRVYGas;

1.5
date	2015.09.29.21.01.55;	author jca;	state Exp;
branches;
next	1.4;
commitid	rZZiGmrHj337Pzan;

1.4
date	2015.04.27.11.06.22;	author jca;	state Exp;
branches
	1.4.4.1;
next	1.3;
commitid	X78MyEfy636DWKaz;

1.3
date	2015.04.14.06.38.23;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	sUhQA76oPnqNasfZ;

1.2
date	2015.04.12.16.26.10;	author jca;	state Exp;
branches;
next	1.1;
commitid	2pCioLa67I2Ll0Dz;

1.1
date	2015.04.12.16.07.13;	author jca;	state Exp;
branches
	1.1.1.1;
next	;
commitid	CpTWhahIOKHdZQm7;

1.1.1.1
date	2015.04.12.16.07.13;	author jca;	state Exp;
branches;
next	;
commitid	CpTWhahIOKHdZQm7;

1.4.4.1
date	2015.12.02.16.38.03;	author jasper;	state Exp;
branches;
next	;
commitid	V59mgUkbsmdV6bZW;

1.13.2.1
date	2017.06.30.14.11.08;	author sthen;	state Exp;
branches;
next	;
commitid	DfePu52UMQPXI740;


desc
@@


1.19
log
@conform to old style
@
text
@# $OpenBSD: Makefile,v 1.18 2017/07/23 12:39:37 zhuk Exp $

COMMENT =		authoritative DNS server

DISTNAME =		knot-2.4.5
REVISION =		0

SHARED_LIBS +=	zscanner             1.0      # .1.0
SHARED_LIBS +=	knot                 1.1      # .5.0
SHARED_LIBS +=	dnssec               0.0      # .3.0

CATEGORIES =		net

HOMEPAGE =		https://www.knot-dns.cz/

MAINTAINER =		Pierre Emeriaud <petrus.lt+openbsd@@gmail.com>, \
			Jeremie Courreges-Anglas <jca@@wxcvbn.org>

# GPLv3+
PERMIT_PACKAGE_CDROM =	Yes

WANTLIB += c curses edit ffi gmp gnutls hogweed iconv idn idn2
WANTLIB += intl jansson m nettle p11-kit pthread tasn1 unistring
WANTLIB += urcu urcu-common z

MASTER_SITES =		https://secure.nic.cz/files/knot-dns/
EXTRACT_SUFX =		.tar.xz

# Needs TLS emulation, and atomic builtins on arm
COMPILER =		gcc
COMPILER_LANGS =	c

BUILD_DEPENDS =		devel/bison
LIB_DEPENDS =		devel/gettext \
			devel/libidn \
			devel/liburcu \
			devel/jansson \
			security/gnutls

CONFIGURE_STYLE =	gnu
CONFIGURE_ARGS +=	--with-storage=${LOCALSTATEDIR}/db/knot \
			--with-libidn \
			--disable-dnstap

CONFIGURE_ENV =		ac_cv_path_PDFLATEX="false" \
			ac_cv_path_SPHINXBUILD="false"

.if ${MACHINE_ARCH} == "i386"
CFLAGS += -march=i586
.endif

post-install:
	mv ${WRKINST}/etc/knot/ ${PREFIX}/share/examples/knot/

.include <bsd.port.mk>
@


1.18
log
@Make knot successfully build with our libtool & make.

The patches are needed to avoid putting two different symbols with
same name (net_send). More correct way will be to rename function
in libknotd, of course, but this is more invasive.

okay jca@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2017/06/29 17:10:06 jca Exp $
d30 1
a30 1
COMPILER =		base gcc
@


1.17
log
@SECURITY update to knot-2.4.5

o Improper TSIG validity period check can allow TSIG forgery
  No CVE assigned (yet?)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2017/06/03 10:44:41 jca Exp $
d6 1
a39 2
USE_GMAKE =		Yes
USE_LIBTOOL=		gnu
@


1.16
log
@Fix build on i386, requires 64 bits atomics

This means you need at least an i586 processor to run knot.  The other
32 bits archs are probably still broken.

Reported by & ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2017/06/02 04:26:23 jca Exp $
d5 1
a5 2
DISTNAME =		knot-2.4.2
REVISION =		0
d8 1
a8 1
SHARED_LIBS +=	knot                 1.0      # .5.0
@


1.15
log
@Drop the gettext module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2017/06/01 13:42:01 jca Exp $
d49 4
@


1.14
log
@Major update to knot-2.4.2

Upstream stopped supporting LTS 1.6.* releases.  Let's move to the 2.x
branch which only supports LMDB (patched to use MDB_WRITEMAP) and
uses __thread (thus, needs clang or lang/gcc).

The config format changed a bit, /usr/local/libexec/knot1to2 might help.

Most work done by Alexis Vachette, ok fcambus@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2016/12/30 15:47:55 jca Exp $
d6 1
d22 3
a24 3
WANTLIB += c curses edit ffi gmp gnutls hogweed idn idn2 jansson
WANTLIB += m nettle p11-kit pthread tasn1 unistring urcu urcu-common
WANTLIB += z
a28 1
MODULES =		devel/gettext
d34 2
a35 1
LIB_DEPENDS =		devel/libidn \
@


1.13
log
@Use lang/gcc for atomic builtins on arm (also needs liburcu built with lang/gcc)
@
text
@d1 1
a1 4
# $OpenBSD: Makefile,v 1.12 2016/11/12 16:29:16 jca Exp $

PORTROACH =		limit:^1\. skipv:1.99.1
PORTROACH_COMMENT =	knot-2.x uses __thread and lmdb
d5 1
a5 1
DISTNAME =		knot-1.6.8
d7 3
a9 2
SHARED_LIBS +=  zscanner             0.0      # .0.1
SHARED_LIBS +=  knot                 0.0      # .0.1
d21 3
a23 1
WANTLIB += c crypto idn m pthread urcu urcu-common z
a25 1

d28 4
a31 3
MODULES =		devel/gettext gcc4
# for atomic builtins: __sync_add_and_fetch_4, __sync_sub_and_fetch_4
MODGCC4_ARCHS =		arm
d35 3
a37 1
			devel/liburcu
d44 3
a46 5
			--disable-dnstap \
			--disable-lmdb
CONFIGURE_ENV =		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib" \
			ac_cv_path_PDFLATEX="false" \
@


1.13.2.1
log
@Backport fix for Knot DNS TSIG forgery issue from upstream's repo.  ok jca@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2016/12/30 15:47:55 jca Exp $
a8 1
REVISION =		0
@


1.12
log
@Tell portroach to skip 1.99.1, for it is not an LTS version.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2016/08/11 12:04:17 jca Exp $
d29 4
a32 1
MODULES =		devel/gettext
@


1.11
log
@Update to knot-1.6.8

from Pierre Emeriaud
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2016/03/11 20:28:28 naddy Exp $
d3 1
a3 1
PORTROACH =		limit:^1\.
@


1.10
log
@garbage collect CONFIGURE_SHARED
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2016/03/03 12:33:41 jca Exp $
d8 1
a8 1
DISTNAME =		knot-1.6.7
@


1.9
log
@Update to knot-1.6.7

from Pierre Emeriaud
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2015/12/01 20:36:31 jca Exp $
d37 1
a37 2
CONFIGURE_ARGS +=	${CONFIGURE_SHARED} \
			--with-storage=${LOCALSTATEDIR}/db/knot \
@


1.8
log
@Update to knot-1.6.6, fixes a potential out-of-bound read in the packet parser.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2015/11/20 17:17:50 sthen Exp $
d8 1
a8 1
DISTNAME =		knot-1.6.6
@


1.7
log
@remove the remaining devel/flex build deps
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2015/10/05 19:20:20 jca Exp $
d8 1
a8 1
DISTNAME =		knot-1.6.5
@


1.6
log
@Add PORTROACH_COMMENT: knot-2.x uses __thread and lmdb
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2015/09/29 21:01:55 jca Exp $
d30 1
a30 2
BUILD_DEPENDS =		devel/bison \
			devel/flex
@


1.5
log
@Update to knot-1.6.5

knot-1.* will be LTS releases.  knot-2 is a newer version that needs
TLS (__thread) support and lmdb (broken on OpenBSD).
@
text
@d1 4
a4 1
# $OpenBSD: Makefile,v 1.4 2015/04/27 11:06:22 jca Exp $
@


1.4
log
@Update to knot-1.6.3

From Pierre Emeriaud (maintainer), ok florian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2015/04/14 06:38:23 ajacoutot Exp $
d5 1
a5 1
DISTNAME =		knot-1.6.3
@


1.4.4.1
log
@Apply fix for "Out-of-bound read in packet parser for malformed NAPTR records"

ok jca@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2015/04/27 11:06:22 jca Exp $
a5 1
REVISION =		0
@


1.3
log
@Sanitize rc.d script:
- no need to override rc_start()
- only checkconf when it makes sense

ok jca@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2015/04/12 16:26:10 jca Exp $
d5 1
a5 2
DISTNAME =		knot-1.6.2
REVISION =		0
@


1.2
log
@More fixes before import.

- --without-stuff -> --disable-stuff where needed
- replace /var and /etc with LOCALSTATEDIR and SYSCONFDIR
- add "OpenBSD" cvs tag to knot.rc

The two latter nits were pointed out by portcheck(1).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2015/04/12 16:07:13 jca Exp $
d6 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d36 1
a36 1
			--with-storage=/var/db/knot \
d38 2
a39 2
			--without-dnstap \
			--without-lmdb
@


1.1.1.1
log
@Import knot-1.6.2

Tests by Pierre Emeriaud (co-maintainer) and florian@@, ok sthen@@

DESCR:
Knot DNS is a high-performance authoritative-only DNS server which
supports all key features of the domain name system including zone
transfers and DNSSEC.  Among its goals is support for on-line addition
and removal of zones.

@
text
@@
