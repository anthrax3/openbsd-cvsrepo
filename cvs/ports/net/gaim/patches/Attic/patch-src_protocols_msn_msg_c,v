head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2005.08.17.16.22.34;	author robert;	state dead;
branches;
next	1.2;

1.2
date	2005.08.11.16.58.52;	author fgsch;	state Exp;
branches;
next	1.1;

1.1
date	2005.08.11.15.54.24;	author fgsch;	state Exp;
branches;
next	;


desc
@@


1.3
log
@SECURITY: upgrade to 1.5.0;
fixes several secuirty vulnerabilities.
http://www.vuxml.org/openbsd/0dfcb310-0f38-11da-ba28-00065bd5b0b6.html

ok brad@@ pvalchev@@
@
text
@$OpenBSD: patch-src_protocols_msn_msg_c,v 1.2 2005/08/11 16:58:52 fgsch Exp $
--- src/protocols/msn/msg.c.orig	Thu Jun  9 23:29:45 2005
+++ src/protocols/msn/msg.c	Thu Aug 11 13:31:35 2005
@@@@ -187,7 +187,8 @@@@ msn_message_parse_slp_body(MsnMessage *m
 
 	if (body_len > 0) {
 		msg->body_len = len - (tmp - body);
-		msg->body = g_memdup(tmp, msg->body_len);
+		msg->body = g_malloc0(msg->body_len + 1);
+		memcpy(msg->body, tmp, msg->body_len);
 		tmp += body_len;
 	}
 }
@@@@ -300,7 +301,8 @@@@ msn_message_parse_payload(MsnMessage *ms
 		/* Import the body. */
 		if (body_len > 0) {
 			msg->body_len = body_len;
-			msg->body = g_memdup(tmp, msg->body_len);
+			msg->body = g_malloc0(msg->body_len + 1);
+			memcpy(msg->body, tmp, msg->body_len);
 			tmp += body_len;
 		}
 
@@@@ -315,7 +317,8 @@@@ msn_message_parse_payload(MsnMessage *ms
 	{
 		if (payload_len - (tmp - tmp_base) > 0) {
 			msg->body_len = payload_len - (tmp - tmp_base);
-			msg->body = g_memdup(tmp, msg->body_len);
+			msg->body = g_malloc0(msg->body_len + 1);
+			memcpy(msg->body, tmp, msg->body_len);
 		}
 	}
 
@@@@ -511,7 +514,8 @@@@ msn_message_set_bin_data(MsnMessage *msg
 
 	if (data != NULL && len > 0)
 	{
-		msg->body = g_memdup(data, len);
+		msg->body = g_malloc0(len + 1);
+		memcpy(msg->body, data, len);
 		msg->body_len = len;
 	}
 	else
@


1.2
log
@ops, previous diff was wrong. correct one now. bump package again. sorry.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_protocols_msn_msg_c,v 1.1 2005/08/11 15:54:24 fgsch Exp $
@


1.1
log
@fix more crashes. maintainer ok. also sent to gaim devs.
@
text
@d1 3
a3 3
$OpenBSD$
--- src/protocols/msn/msg.c.orig	Wed Aug 10 20:26:48 2005
+++ src/protocols/msn/msg.c	Wed Aug 10 20:28:08 2005
d9 2
a10 2
+		msg->body = g_memdup(tmp, msg->body_len + 1);
+		msg->body[msg->body_len] = '\0';
d19 2
a20 2
+			msg->body = g_memdup(tmp, msg->body_len + 1);
+			msg->body[msg->body_len] = '\0';
d29 2
a30 2
+			msg->body = g_memdup(tmp, msg->body_len + 1);
+			msg->body[msg->body_len] = '\0';
d39 2
a40 2
+		msg->body = g_memdup(data, len + 1);
+		msg->body[len] = '\0';
@

