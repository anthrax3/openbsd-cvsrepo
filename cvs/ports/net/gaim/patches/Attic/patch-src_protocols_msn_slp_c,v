head	1.5;
access;
symbols
	OPENBSD_3_6:1.1.0.2
	OPENBSD_3_6_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2004.10.22.19.16.01;	author brad;	state dead;
branches;
next	1.4;

1.4
date	2004.10.14.03.02.37;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2004.09.22.05.49.56;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2004.09.17.02.07.35;	author brad;	state dead;
branches;
next	1.1;

1.1
date	2004.08.14.00.27.06;	author robert;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2005.03.27.15.15.35;	author sturm;	state dead;
branches;
next	;


desc
@@


1.5
log
@upgrade to gaim 1.0.2

fixes 2 remote DoS issues and a buffer overflow.

CAN-2004-0891
@
text
@$OpenBSD: patch-src_protocols_msn_slp_c,v 1.4 2004/10/14 03:02:37 brad Exp $
--- src/protocols/msn/slp.c.orig	Sat Oct  2 07:33:49 2004
+++ src/protocols/msn/slp.c	Sun Oct 10 23:30:05 2004
@@@@ -235,6 +235,8 @@@@ send_decline(MsnSlpCall *slpcall, const 
 	msn_slplink_queue_slpmsg(slplink, slpmsg);
 }
 
+#define MAX_FILE_NAME_LEN 0x226
+
 static void
 got_sessionreq(MsnSlpCall *slpcall, const char *branch,
 			   const char *euf_guid, const char *context)
@@@@ -318,6 +320,7 @@@@ got_sessionreq(MsnSlpCall *slpcall, cons
 		int bin_len;
 		guint32 file_size;
 		char *file_name;
+		gunichar2 *uni_name;
 
 		account = slpcall->slplink->session->account;
 
@@@@ -331,6 +334,13 @@@@ got_sessionreq(MsnSlpCall *slpcall, cons
 
 		gaim_base64_decode(context, &bin, &bin_len);
 		file_size = GUINT32_FROM_LE(*((gsize *)bin + 2));
+		
+		uni_name = (gunichar2 *)(bin + 20);
+		while(*uni_name != 0 && ((char *)uni_name - (bin + 20)) < MAX_FILE_NAME_LEN) {
+			*uni_name = GUINT16_FROM_LE(*uni_name);
+			uni_name++;
+		}
+		
 		file_name = g_utf16_to_utf8((const gunichar2 *)(bin + 20), -1,
 									NULL, NULL, NULL);
 
@


1.4
log
@upgrade to gaim 1.0.1
@
text
@d1 1
a1 1
$OpenBSD: patch-src_protocols_msn_slp_c,v 1.3 2004/09/22 05:49:56 brad Exp $
@


1.3
log
@fix MSN file transfer support on big-endian systems
@
text
@d1 3
a3 3
$OpenBSD$
--- src/protocols/msn/slp.c.orig	Tue Aug 24 21:45:41 2004
+++ src/protocols/msn/slp.c	Wed Sep 22 01:23:39 2004
d14 1
a14 1
 		gsize bin_len;
@


1.2
log
@upgrade to gaim 0.82.1
@
text
@d1 33
a33 16
$OpenBSD: patch-src_protocols_msn_slp_c,v 1.1 2004/08/14 00:27:06 robert Exp $
--- src/protocols/msn/slp.c.orig	Tue Jun 15 04:37:25 2004
+++ src/protocols/msn/slp.c	Fri Aug 13 00:04:47 2004
@@@@ -645,8 +645,12 @@@@
 			if ((c = strchr(status, '\r')) || (c = strchr(status, '\n')) ||
 				(c = strchr(status, '\0')))
 			{
-				strncpy(temp, status, c - status);
-				temp[c - status] = '\0';
+				size_t offset =  c - status;
+				if (offset >= sizeof(temp))
+					offset = sizeof(temp) - 1;
+		      
+				strncpy(temp, status, offset);
+				temp[offset] = '\0';
 			}
a34 1
 			gaim_debug_error("msn", "Received non-OK result: %s\n", temp);
@


1.1
log
@SECURITY:
Gaim contains several remote overflows related to the MSN-protocol
parsing functions that may allow remote code execution.
The added patch fixes these issues.

ok brad@@, pvalchev@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@update to gaim 1.1.4, fixes lots of bugs and a few security issues

ok brad@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_protocols_msn_slp_c,v 1.1 2004/08/14 00:27:06 robert Exp $
@


