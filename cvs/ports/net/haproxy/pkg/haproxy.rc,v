head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.6
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.4
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.2.0.14
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.10
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.8
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.6
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.4
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2;
locks; strict;
comment	@ * @;


1.3
date	2015.10.24.14.31.26;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	wiH6ZvAf5VGyiPUj;

1.2
date	2012.10.30.19.40.19;	author gonzalo;	state Exp;
branches
	1.2.14.1;
next	1.1;

1.1
date	2012.08.27.13.03.06;	author gonzalo;	state Exp;
branches;
next	;

1.2.14.1
date	2015.10.24.14.34.46;	author ajacoutot;	state Exp;
branches;
next	;
commitid	n2UI0B9E25l0avQL;


desc
@@


1.3
log
@Unbreak reloading haproxy.
rc_reload() appends '-sf pid' which broke the default pexp.

breakage reported by Alexandre Perrin via Daniel Jakots (maintainer)
@
text
@#!/bin/sh
#
# $OpenBSD: haproxy.rc,v 1.2 2012/10/30 19:40:19 gonzalo Exp $

daemon="${TRUEPREFIX}/sbin/haproxy"
daemon_flags="-f ${HAPROXYCONF}/haproxy.cfg"

. /etc/rc.d/rc.subr

# rc_reload() appends '-sf ...'
pexp="${daemon}${daemon_flags:+ ${daemon_flags}}.*"

rc_reload() {
	${daemon} ${daemon_flags} -sf $(cat /var/run/haproxy.pid)
}

rc_cmd $1
@


1.2
log
@Update for haproxy to 1.4.22:

    - BUG/MEDIUM: option forwardfor if-none doesn't work with some configurations
    - BUG/MINOR: checks: expire on timeout.check if smaller than timeout.connect
    - REORG/MINOR: use dedicated proxy flags for the cookie handling
    - BUG/MINOR: config: do not report twice the incompatibility between cookie and non-http
    - MINOR: contrib/iprange: add a network IP range to mask converter
    - BUG/MEDIUM: ebtree: ebmb_insert() must not call cmp_bits on full-length matches
    - OPTIM: halog: make use of memchr() on platforms which provide a fast one
    - OPTIM: halog: improve cold-cache behaviour when loading a file
    - MINOR: config: tolerate server "cookie" setting in non-HTTP mode
    - BUG/MINOR: tarpit: fix condition to return the HTTP 500 message

And others, while here remove for real the maintainer and add reload to rc.d(8) script.

Very initial update from chipitsine at gmail.com with tweaks by me. Thanks!

Ok aja@@
@
text
@d3 1
a3 1
# $OpenBSD: haproxy.rc,v 1.1 2012/08/27 13:03:06 gonzalo Exp $
d10 3
d14 1
a14 1
        ${daemon} ${daemon_flags} -sf $(cat /var/run/haproxy.pid)
@


1.2.14.1
log
@From current:
Unbreak reloading haproxy.
rc_reload() appends '-sf pid' which broke the default pexp.

breakage reported by Alexandre Perrin via Daniel Jakots (maintainer)
@
text
@d3 1
a3 1
# $OpenBSD: haproxy.rc,v 1.3 2015/10/24 14:31:26 ajacoutot Exp $
a9 3
# rc_reload() appends '-sf ...'
pexp="${daemon}${daemon_flags:+ ${daemon_flags}}.*"

d11 1
a11 1
	${daemon} ${daemon_flags} -sf $(cat /var/run/haproxy.pid)
@


1.1
log
@Update for haproxy to 1.4.21 with some changes:

    - MINOR: stats admin: allow unordered parameters in POST requests
    - BUG/MAJOR: possible crash when using capture headers on TCP frontends
    - MINOR: config: disable header captures in TCP mode and complain
    - CLEANUP: http: message parser must ignore HTTP_MSG_ERROR
    - BUG/MAJOR: checks: don't call set_server_status_* when no LB algo is set
    - MINOR: proxy: make findproxy() return proxies from numeric IDs too
    - BUG/MINOR: stop connect timeout when connect succeeds

And others (http://haproxy.1wt.eu/download/1.4/src/CHANGELOG), while here GROFF is not needed,
add a rc.d(8) script and maintainer drop maintainership.

Tested on i386.

Ok sthen@@ (untested)
@
text
@d3 1
a3 1
# $OpenBSD$
d9 4
@

