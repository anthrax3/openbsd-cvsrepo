head	1.2;
access;
symbols
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2014.04.30.14.12.19;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2013.04.01.14.30.32;	author brad;	state Exp;
branches;
next	;


desc
@@


1.2
log
@drop workarounds for missing AI_ADDRCONFIG
@
text
@$OpenBSD: patch-configure_ac,v 1.1 2013/04/01 14:30:32 brad Exp $

Remove incredibly stupid autoconf test which assumes that the lack
of the getaddrinfo() flag AI_ADDRCONFIG means getaddrinfo() is not
thread-safe. Although that was the case in the past it is no longer
true.

--- configure.ac.orig	Mon Apr  1 03:13:31 2013
+++ configure.ac	Mon Apr  1 03:24:30 2013
@@@@ -219,29 +219,7 @@@@ AC_SEARCH_LIBS([dlopen], [dl], [],
 DNS_TEXT=blocking
 if test "x$TDNS" != "xno"; then
 	old_TDNS=$TDNS
-	AX_PTHREAD([
-		AC_MSG_CHECKING([whether getaddrinfo() supports AI_ADDRCONFIG])
-		AC_COMPILE_IFELSE([
-			AC_LANG_PROGRAM([[
-				#include <sys/types.h>
-				#include <sys/socket.h>
-				#include <netdb.h>
-			]], [[
-				int x = AI_ADDRCONFIG;
-				(void) x;
-			]])
-		], [
-			AC_MSG_RESULT([yes])
-			TDNS=yes
-		], [
-			AC_MSG_RESULT([no])
-			TDNS=no
-			# Note that broken systems, such as OpenBSD, NetBSD, which don't support AI_ADDRCONFIG,
-			# also have thread-unsafe getaddrinfo().
-		])
-	], [
-		TDNS=no
-	])
+	AX_PTHREAD([TDNS=yes], [TDNS=no])
 	if test "x$TDNS" = "xyes"; then
 		DNS_TEXT=threads
 		AC_DEFINE([HAVE_THREADED_DNS], [1], [Define if threaded DNS is enabled])
@


1.1
log
@Enable the threaded DNS support for znc now that our getaddrinfo()
is thread-safe. Remove an incredibly stupid autoconf test which
assumes that the lack of the getaddrinfo() flag AI_ADDRCONFIG means
getaddrinfo() is not thread-safe. Although that was the case in the
past and properly resulted in the threaded DNS support not being
utilized on OpenBSD/NetBSD it is no longer true.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
@

