head	1.1;
access;
symbols
	OPENBSD_4_6:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2010.04.08.03.16.48;	author william;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2010.04.08.03.16.48;	author william;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-FileUtils_cpp was initially added on branch OPENBSD_4_6.
@
text
@@


1.1.2.1
log
@SECURITY FIX

Resolves CVE-2009-2658

ok jasper@@
@
text
@a0 25
$OpenBSD$

SECURITY FIX

Resolves CVE-2009-2658


--- FileUtils.cpp.orig	Wed May 20 06:36:34 2009
+++ FileUtils.cpp	Tue Dec 29 19:43:58 2009
@@@@ -460,6 +460,15 @@@@ CString CDir::ChangeDir(const CString& sPath, const CS
 	return (sRet.empty()) ? "/" : sRet;
 }
 
+CString CDir::CheckPathPrefix(const CString& sPath, const CString& sAdd, const CString& sHomeDir) {
+	CString sPrefix = sPath.Replace_n("//", "/").TrimRight_n("/") + "/";
+	CString sAbsolutePath = ChangeDir(sPrefix, sAdd, sHomeDir);
+
+	if (sAbsolutePath.Left(sPrefix.length()) != sPrefix)
+		return "";
+	return sAbsolutePath;
+}
+
 bool CDir::MakeDir(const CString& sPath, mode_t iMode) {
 	CString sDir;
 	VCString dirs;
@

