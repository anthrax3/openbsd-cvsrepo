head	1.65;
access;
symbols
	OPENBSD_6_1:1.60.0.2
	OPENBSD_6_1_BASE:1.60
	OPENBSD_6_0:1.56.0.2
	OPENBSD_6_0_BASE:1.56
	OPENBSD_5_9:1.49.0.2
	OPENBSD_5_9_BASE:1.49
	OPENBSD_5_8:1.30.0.4
	OPENBSD_5_8_BASE:1.30
	OPENBSD_5_7:1.25.0.2
	OPENBSD_5_7_BASE:1.25
	OPENBSD_5_6:1.15.0.2
	OPENBSD_5_6_BASE:1.15;
locks; strict;
comment	@# @;


1.65
date	2017.07.26.22.45.27;	author sthen;	state Exp;
branches;
next	1.64;
commitid	tD4MFrpYYDDL2UFT;

1.64
date	2017.07.16.19.18.58;	author espie;	state Exp;
branches;
next	1.63;
commitid	tt0GhWK5c4uf9ILG;

1.63
date	2017.05.31.08.08.17;	author espie;	state Exp;
branches;
next	1.62;
commitid	ij92FtFXiSiT1ani;

1.62
date	2017.05.24.10.31.21;	author espie;	state Exp;
branches;
next	1.61;
commitid	UcTDYuRaq63gz4Sg;

1.61
date	2017.04.04.20.51.45;	author sthen;	state Exp;
branches;
next	1.60;
commitid	QJE1kLos4JtQjM2g;

1.60
date	2017.02.13.19.58.00;	author sthen;	state Exp;
branches;
next	1.59;
commitid	YpWgJRcXCtPSKl4i;

1.59
date	2017.02.07.23.53.19;	author sthen;	state Exp;
branches;
next	1.58;
commitid	WsbhJLflEDnHkozg;

1.58
date	2017.02.05.20.26.19;	author sthen;	state Exp;
branches;
next	1.57;
commitid	zEvbVdKWDjMNLeFu;

1.57
date	2017.02.02.21.36.18;	author sthen;	state Exp;
branches;
next	1.56;
commitid	KBZfhQxu073nU4eN;

1.56
date	2016.06.22.21.42.49;	author sthen;	state Exp;
branches;
next	1.55;
commitid	2oeD5oaAAVKjbehc;

1.55
date	2016.05.20.08.13.41;	author sthen;	state Exp;
branches;
next	1.54;
commitid	gHOdTzGz5lyfta4A;

1.54
date	2016.04.21.21.19.17;	author sthen;	state Exp;
branches;
next	1.53;
commitid	cQLlG91xKrbL7wMw;

1.53
date	2016.03.18.23.12.19;	author naddy;	state Exp;
branches;
next	1.52;
commitid	KZAl4KEiw6a3Jixw;

1.52
date	2016.03.16.12.52.22;	author sthen;	state Exp;
branches;
next	1.51;
commitid	7cnjAHxZ1iS9wDy0;

1.51
date	2016.02.25.09.29.49;	author sthen;	state Exp;
branches;
next	1.50;
commitid	yK8sBQ6gDFxwfUdU;

1.50
date	2016.02.25.02.19.14;	author jsg;	state Exp;
branches;
next	1.49;
commitid	7EqluVlje3WtS3zf;

1.49
date	2016.02.08.19.07.43;	author sthen;	state Exp;
branches;
next	1.48;
commitid	oSaVRxiMEshZu405;

1.48
date	2015.12.24.12.57.17;	author sthen;	state Exp;
branches;
next	1.47;
commitid	F5wxnYqzgxv3OAWn;

1.47
date	2015.12.08.13.49.36;	author sthen;	state Exp;
branches;
next	1.46;
commitid	R01EUw8zLL4y3veZ;

1.46
date	2015.11.30.13.11.08;	author sthen;	state Exp;
branches;
next	1.45;
commitid	flbWM8oe5VLfBWKo;

1.45
date	2015.11.26.18.03.02;	author sthen;	state Exp;
branches;
next	1.44;
commitid	6XJfh6EwxlGhkc70;

1.44
date	2015.11.19.20.17.15;	author sthen;	state Exp;
branches;
next	1.43;
commitid	IKqYejklJIUnnmFU;

1.43
date	2015.11.16.20.29.55;	author sthen;	state Exp;
branches;
next	1.42;
commitid	qYlDtork3dGtChXG;

1.42
date	2015.11.16.12.51.42;	author sthen;	state Exp;
branches;
next	1.41;
commitid	4LLdcMGw1oGA1bSN;

1.41
date	2015.11.16.12.19.12;	author sthen;	state Exp;
branches;
next	1.40;
commitid	uLNbBj18MR2C5AdL;

1.40
date	2015.11.14.22.56.24;	author sthen;	state Exp;
branches;
next	1.39;
commitid	e1dLD6H9EwIMYwfW;

1.39
date	2015.11.09.22.36.38;	author sthen;	state Exp;
branches;
next	1.38;
commitid	pStTXQXOgWLHK3JY;

1.38
date	2015.10.21.19.10.34;	author sthen;	state Exp;
branches;
next	1.37;
commitid	p4NpajqfMQxjHOCA;

1.37
date	2015.10.21.09.34.03;	author sthen;	state Exp;
branches;
next	1.36;
commitid	rjISfahisASp2lkZ;

1.36
date	2015.10.21.09.03.22;	author sthen;	state Exp;
branches;
next	1.35;
commitid	v6t4YdicAu5d6Hs5;

1.35
date	2015.10.20.21.34.29;	author sthen;	state Exp;
branches;
next	1.34;
commitid	HQNIC6StTIBxiU5X;

1.34
date	2015.10.20.20.59.40;	author sthen;	state Exp;
branches;
next	1.33;
commitid	LWpoBtGolMamlkI5;

1.33
date	2015.10.20.13.54.13;	author sthen;	state Exp;
branches;
next	1.32;
commitid	zYjt2ixUNz0c9XYu;

1.32
date	2015.08.25.15.22.38;	author sthen;	state Exp;
branches;
next	1.31;
commitid	6Fci7JL7wfBk97II;

1.31
date	2015.08.25.13.53.28;	author sthen;	state Exp;
branches;
next	1.30;
commitid	jzxfzuvBERku53ll;

1.30
date	2015.07.07.14.44.59;	author sthen;	state Exp;
branches;
next	1.29;
commitid	3ip2eKfpCQusYvJT;

1.29
date	2015.07.06.11.25.36;	author sthen;	state Exp;
branches;
next	1.28;
commitid	fXrDP8itzF5x6yPc;

1.28
date	2015.07.02.20.16.54;	author sthen;	state Exp;
branches;
next	1.27;
commitid	ulanFhzl3VMygUgE;

1.27
date	2015.06.30.09.19.48;	author sthen;	state Exp;
branches;
next	1.26;
commitid	gTvgOsXdjVX3hVqz;

1.26
date	2015.05.12.09.37.03;	author sthen;	state Exp;
branches;
next	1.25;
commitid	HpfUcqYDCTjXHiXR;

1.25
date	2015.02.06.22.53.27;	author sthen;	state Exp;
branches;
next	1.24;
commitid	ZHxyFilGE59NRuYF;

1.24
date	2015.01.20.18.42.38;	author landry;	state Exp;
branches;
next	1.23;
commitid	6RPVQLhgLkIoZ7aY;

1.23
date	2015.01.04.21.47.14;	author sthen;	state Exp;
branches;
next	1.22;
commitid	uWTlaRjyHPT6ajAh;

1.22
date	2015.01.04.21.32.24;	author sthen;	state Exp;
branches;
next	1.21;
commitid	DultdL51ymwN16Te;

1.21
date	2014.12.19.01.20.16;	author sthen;	state Exp;
branches;
next	1.20;
commitid	UvXht7jZWMpk3vWX;

1.20
date	2014.12.17.22.10.30;	author sthen;	state Exp;
branches;
next	1.19;
commitid	AGB6bUJ4AbXoSD18;

1.19
date	2014.12.01.23.45.58;	author sthen;	state Exp;
branches;
next	1.18;
commitid	PwRKbhgCd6bz4seR;

1.18
date	2014.11.23.20.28.01;	author sthen;	state Exp;
branches;
next	1.17;
commitid	Axxt0O5vZt7pBypE;

1.17
date	2014.11.22.00.13.03;	author sthen;	state Exp;
branches;
next	1.16;
commitid	nmet3xtaN5ESeGNI;

1.16
date	2014.09.13.18.09.21;	author brad;	state Exp;
branches;
next	1.15;
commitid	PpbRjVZdAmlrmi8q;

1.15
date	2014.07.19.22.36.13;	author ajacoutot;	state Exp;
branches;
next	1.14;
commitid	MSFt4PoL3vJ8bL97;

1.14
date	2014.07.12.11.22.10;	author sthen;	state Exp;
branches;
next	1.13;
commitid	gODVE8HvhOXSelog;

1.13
date	2014.07.10.15.01.17;	author sthen;	state Exp;
branches;
next	1.12;
commitid	ZNBbuomfuWXpv5vW;

1.12
date	2014.07.10.12.58.31;	author ajacoutot;	state Exp;
branches;
next	1.11;
commitid	rOPyKbvHOk8hvFGm;

1.11
date	2014.07.10.11.14.20;	author rpe;	state Exp;
branches;
next	1.10;
commitid	Sb2cXcpuaaWDejkM;

1.10
date	2014.07.09.15.06.06;	author rpe;	state Exp;
branches;
next	1.9;
commitid	9uYa9AiN6FlqjitQ;

1.9
date	2014.07.01.22.55.27;	author sthen;	state Exp;
branches;
next	1.8;
commitid	680xZ9XfnpI4d5L1;

1.8
date	2014.06.27.00.28.02;	author sthen;	state Exp;
branches;
next	1.7;
commitid	dBlZHCCbV6ykKl4C;

1.7
date	2014.06.27.00.14.27;	author sthen;	state Exp;
branches;
next	1.6;
commitid	FlZeosG4WCUCAy88;

1.6
date	2014.06.27.00.09.29;	author sthen;	state Exp;
branches;
next	1.5;
commitid	GlVVOHNRabBPzaHb;

1.5
date	2014.06.24.16.51.35;	author sthen;	state Exp;
branches;
next	1.4;
commitid	V36HVttV3iupUWj9;

1.4
date	2014.06.22.20.54.26;	author sthen;	state Exp;
branches;
next	1.3;
commitid	ou3It7x1ivuJknrs;

1.3
date	2014.06.20.22.11.57;	author sthen;	state Exp;
branches;
next	1.2;
commitid	Ur0oKvmqNfvszTSx;

1.2
date	2014.06.19.23.33.09;	author sthen;	state Exp;
branches;
next	1.1;
commitid	kGYbymriA5J0MjkN;

1.1
date	2014.06.19.23.24.47;	author sthen;	state Exp;
branches;
next	;
commitid	dM3oec1M6F44RRq4;


desc
@@


1.65
log
@bump LIBCXX/LIBECXX/COMPILER_LIBCXX ports.
@
text
@# $OpenBSD: Makefile,v 1.64 2017/07/16 19:18:58 espie Exp $

BROKEN-arm =	needs atomic ops; __sync_add_and_fetch_4
BROKEN-hppa =	needs atomic ops; __sync_add_and_fetch_4
BROKEN-powerpc = link fails, .gnu.linkonce.t.foo referenced in section .gnu.linkonce.r.foo [..] defined in discarded section

COMMENT-main =	network monitoring system
COMMENT-mysql =	MySQL support for icinga2
COMMENT-pgsql =	PostgreSQL support for icinga2

V =		2.6.3
EPOCH =		0
GH_ACCOUNT =	Icinga
GH_PROJECT =	icinga2
GH_TAGNAME =	v$V
PKGNAME-main =	icinga2-$V
PKGNAME-mysql =	icinga2-ido-mysql-$V
PKGNAME-pgsql =	icinga2-ido-pgsql-$V
REVISION-main =	0
REVISION-mysql =0
REVISION-pgsql =0

SHARED_LIBS +=	base                      0.0 # 2.6
SHARED_LIBS +=	checker                   0.0 # 2.6
SHARED_LIBS +=	cli                       0.0 # 2.6
SHARED_LIBS +=	compat                    0.0 # 2.6
SHARED_LIBS +=	config                    0.0 # 2.6
SHARED_LIBS +=	db_ido                    0.0 # 2.6
SHARED_LIBS +=	db_ido_mysql              0.0 # 2.6
SHARED_LIBS +=	db_ido_pgsql              0.0 # 2.6
SHARED_LIBS +=	execvpe                   0.0 # 2.6
SHARED_LIBS +=	icinga                    0.0 # 2.6
SHARED_LIBS +=	livestatus                0.0 # 2.6
SHARED_LIBS +=	methods                   0.0 # 2.6
SHARED_LIBS +=	mmatch                    0.0 # 2.6
SHARED_LIBS +=	notification              0.0 # 2.6
SHARED_LIBS +=	perfdata                  0.0 # 2.6
SHARED_LIBS +=	remote                    0.0 # 2.6
SHARED_LIBS +=	socketpair                0.0 # 2.6

HOMEPAGE =	https://www.icinga.org/icinga2/

# GPLv2+ with OpenSSL exemption
PERMIT_PACKAGE_CDROM =	Yes

WANTLIB += boost_atomic-mt boost_chrono-mt boost_date_time-mt
WANTLIB += boost_program_options-mt boost_regex-mt boost_system-mt
WANTLIB += boost_thread-mt crypto execinfo m pthread ssl
WANTLIB += yajl ${COMPILER_LIBCXX}

MODULES =		devel/cmake

COMPILER =		gcc

PSEUDO_FLAVORS =	test
FLAVOR ?=

BUILD_DEPENDS =		devel/bison

MULTI_PACKAGES =	-main -mysql -pgsql

WANTLIB-main +=		${WANTLIB} c edit termcap
LIB_DEPENDS-main =	${LIB_DEPENDS} \
			devel/boost \
			devel/libexecinfo \
			devel/libyajl
RUN_DEPENDS-main =	net/monitoring-plugins
RUN_DEPENDS =           ${BASE_PKGPATH},-main # default for subpackages

WANTLIB-mysql +=	${WANTLIB} mysqlclient \
			lib/icinga2/base \
			lib/icinga2/config \
			lib/icinga2/db_ido \
			lib/icinga2/execvpe \
			lib/icinga2/icinga \
			lib/icinga2/mmatch \
			lib/icinga2/remote \
			lib/icinga2/socketpair
LIB_DEPENDS-mysql =	${LIB_DEPENDS} \
			${BASE_PKGPATH},-main \
			databases/mariadb

WANTLIB-pgsql +=	${WANTLIB} pq \
			lib/icinga2/base \
			lib/icinga2/config \
			lib/icinga2/db_ido \
			lib/icinga2/execvpe \
			lib/icinga2/icinga \
			lib/icinga2/mmatch \
			lib/icinga2/remote \
			lib/icinga2/socketpair
LIB_DEPENDS-pgsql =	${LIB_DEPENDS} \
			${BASE_PKGPATH},-main \
			databases/postgresql

CONFIGURE_ARGS += \
	-DCMAKE_INSTALL_MANDIR:String=${PREFIX}/man \
	-DCMAKE_INSTALL_SYSCONFDIR:String=${PREFIX}/share/examples \
	-DCMAKE_INSTALL_FULL_SYSCONFDIR:String=${WRKINST}${SYSCONFDIR} \
	-DCMAKE_INSTALL_LOCALSTATEDIR:String=${LOCALSTATEDIR} \
	-DICINGA2_USER:String=_icinga \
	-DICINGA2_GROUP:String=_icinga \
	-DICINGA2_GIT_VERSION_INFO:Boolean=OFF \
	-DICINGA2_PLUGINDIR:String=${LOCALBASE}/libexec/nagios

# uses too much memory full-stop on 32-bit arches.
# uses too much memory for my amd64 workstation to not hang for minutes
# at a time during the build.
CONFIGURE_ARGS += -DICINGA2_UNITY_BUILD=OFF

post-configure:
	@@sed -i 's,%SYSCONFDIR%,${SYSCONFDIR},' ${WRKBUILD}/config.h

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/nano
	${INSTALL_DATA} ${WRKSRC}/tools/syntax/nano/*nanorc ${PREFIX}/share/nano
.for i in ftdetect syntax
	${INSTALL_DATA_DIR} ${PREFIX}/share/vim/vimfiles/$i
	${INSTALL_DATA} ${WRKSRC}/tools/syntax/vim/$i/* ${PREFIX}/share/vim/vimfiles/$i
.endfor
	sed -i "s,/usr/share/icinga2,${PREFIX}/share/icinga2,g" \
		${PREFIX}/share/doc/icinga2/markdown/*

.if ${FLAVOR:Mtest}
pre-test:
	@@if pkg_info | grep libconfig- > /dev/null; then \
	    printf "\n*** icinga2 tests do not work if libconfig is installed ***\n\n"; \
	    exit 1; \
	fi
.else
post-patch:
	@@printf "\n*** Disabling tests to avoid conflict if libconfig is present at build time.\n*** Use \"FLAVOR=test make\" to avoid this.\n\n"
	sed -i 's,add_subdirectory(test),#add_subdirectory(test),' ${WRKSRC}/CMakeLists.txt

pre-test:
	@@printf "\n*** Tests were disabled to avoid potential build conflict.\n*** Re-build with \"FLAVOR=test make\" to avoid this.\n\n"
	@@exit 1
.endif

.include <bsd.port.mk>
@


1.64
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2017/05/31 08:08:17 espie Exp $
d19 3
@


1.63
log
@switch everything to new COMPILER idiom, even stuff that won't build with clang
yet, but at least that part is done.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2017/05/24 10:31:21 espie Exp $
d46 1
a46 1
WANTLIB += yajl ${LIBECXX}
@


1.62
log
@WANT_CXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2017/04/04 20:51:45 sthen Exp $
d50 1
a50 1
WANT_CXX =		base gcc
@


1.61
log
@update to icinga2 2.6.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2017/02/13 19:58:00 sthen Exp $
d45 2
a46 2
WANTLIB += boost_thread-mt crypto execinfo m pthread ssl estdc++
WANTLIB += yajl
d48 3
a50 4
MODULES =		devel/cmake \
			gcc4
MODGCC4_ARCHS =		*
MODGCC4_LANGS =		c++
@


1.60
log
@update to icinga2-2.6.2

disable unity build (upstream default) everywhere, it was previously disabled on
!amd64, but the large c++ files involved are bringing my amd64 workstation to its
knees with long hangs making X unusable for many minutes at a time
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2017/02/07 23:53:19 sthen Exp $
d11 1
a11 1
V =		2.6.2
@


1.59
log
@Remove the BROKEN-sparc64 marker, it's now using gcc 4.9 and unity build is
disabled, so the reasons given no longer apply. (Untested, but time to give it
another chance).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2017/02/05 20:26:19 sthen Exp $
d11 1
a11 1
V =		2.6.1
d104 5
a135 5
.endif

.include <bsd.port.arch.mk>
.if !${ARCH:Mamd64}
CONFIGURE_ARGS += -DICINGA2_UNITY_BUILD=OFF
@


1.58
log
@Disable unity build on !amd64 to reduce memory use during build.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2017/02/02 21:36:18 sthen Exp $
a4 1
BROKEN-sparc64 = gcc 4.2.1 fails "Illegal operands", gcc 4.9 hangs for 2h (icinga_unity.cpp)
@


1.57
log
@update to icinga2-2.6.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2016/06/22 21:42:49 sthen Exp $
d132 5
@


1.56
log
@update to icinga2 2.4.10
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2016/05/20 08:13:41 sthen Exp $
d12 1
a12 1
V =		2.4.10
a16 1
DISTNAME =	icinga2-$V
d21 18
d46 1
a46 1
WANTLIB += boost_thread-mt crypto execinfo m pthread ssl stdc++
d51 2
d62 2
a63 1
LIB_DEPENDS-main =	devel/boost \
d69 25
a93 7
WANTLIB-mysql +=	${WANTLIB} mysqlclient_r
LIB_DEPENDS-mysql =	${LIB_DEPENDS} databases/mariadb
RUN_DEPENDS-mysql =	${BASE_PKGPATH},-main

WANTLIB-pgsql +=	${WANTLIB} pq
LIB_DEPENDS-pgsql =	${LIB_DEPENDS} databases/postgresql
RUN_DEPENDS-pgsql =	${BASE_PKGPATH},-main
d115 2
@


1.55
log
@update to icinga2-2.4.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2016/04/21 21:19:17 sthen Exp $
d12 1
a12 1
V =		2.4.9
@


1.54
log
@update to icinga2-2.4.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2016/03/18 23:12:19 naddy Exp $
d12 1
a12 1
V =		2.4.7
d27 1
d29 2
a30 1
WANTLIB += boost_thread-mt crypto execinfo m pthread ssl stdc++ yajl
@


1.53
log
@remove SHARED_ONLY from ports that only use modules that neither set nor
read this variable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2016/03/16 12:52:22 sthen Exp $
d12 1
a12 1
V =		2.4.4
@


1.52
log
@update to icinga2-2.4.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2016/02/25 09:29:49 sthen Exp $
a6 2

SHARED_ONLY =	Yes
@


1.51
log
@update to icinga2-2.4.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2016/02/25 02:19:14 jsg Exp $
d14 1
a14 1
V =		2.4.3
@


1.50
log
@Don't attempt to build on arm.  sync atomic builtins required.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2016/02/08 19:07:43 sthen Exp $
d14 1
a14 1
V =		2.4.1
a15 1
REVISION-main =	0
@


1.49
log
@mark BROKEN-powerpc to avoid wasting build time; linker issues.

`.gnu.linkonce.t._ZN6icinga5ValueC1EPNS_6ObjectE' referenced in section `.gnu.linkonce.r._ZN6icinga5ValueC1EPNS_6ObjectE' of lib/base/CMakeFiles/base.dir/boolean-script.cpp.o: defined in discarded section `.gnu.linkonce.t._ZN6icinga5ValueC1EPNS_6ObjectE' of lib/base/CMakeFiles/base.dir/boolean-script.cpp.o
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2015/12/24 12:57:17 sthen Exp $
d3 2
a4 1
BROKEN-hppa =	needs 64-bit atomic ops; __sync_add_and_fetch_4
@


1.48
log
@fix package name for icinga-web2 in README; pointed out by rpe@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2015/12/08 13:49:36 sthen Exp $
d5 1
@


1.47
log
@mark as broken on sparc64, toolchain issues (errors out with gcc 4.2,
hangs with gcc 4.9).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2015/11/30 13:11:08 sthen Exp $
d14 1
@


1.46
log
@In the normal icinga2 build, disable tests from building (I previously had a
check for "make test"); in some occasions if devel/libconfig is installed at
build time it can cause the wrong libconfig to be picked up, resulting in
build failures. Add a pseudo-flavour to enable them if needed.

(I didn't run into this myself but, as found by ajacoutot@@, in some builds
CMake decides to list -L/usr/local/lib before -L${WRKBUILD}/Bin/Release).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2015/11/26 18:03:02 sthen Exp $
d4 2
a31 7

# Try with gcc 4.9 on sparc64; with base gcc 4.2.1 build fails thusly:
#
# {standard input}:38466: Error: Illegal operands: %lo requires arguments in ()
# c++: Internal error: Illegal instruction (program cc1plus)
MODGCC4_ARCHS =		sparc64
MODGCC4_LANGS =		c++
@


1.45
log
@update to icinga2-2.4.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2015/11/19 20:17:15 sthen Exp $
d38 3
d81 1
d87 9
@


1.44
log
@remove build dep on ports flex
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2015/11/16 20:29:55 sthen Exp $
d10 1
a10 1
V =		2.4.0
@


1.43
log
@update to Icinga 2 v2.4.0, featuring a new RESTful API using basic auth
or client certificates for:

- filters, types, permissions
- query/create/modify/delete config objects at runtime
- status queries for global stats
- actions (e.g. acknowledge all service problems)
- event streams
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2015/11/16 12:51:42 sthen Exp $
d38 1
a38 3
BUILD_DEPENDS =		devel/bison \
			devel/flex
# needs flex 2.5.31+
a61 1
	-DFLEX_EXECUTABLE=${LOCALBASE}/bin/gflex \
@


1.42
log
@also set group ownership on icinga2 cmd dir
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2015/11/16 12:19:12 sthen Exp $
d10 1
a10 3
V =		2.3.11
REVISION =	1
REVISION-main =	6
d44 1
a44 1
WANTLIB-main +=		${WANTLIB} c
@


1.41
log
@allows chroot()ed web interfaces to find the command socket.

- patch constants.conf to use /var/www/var/run/icinga2 as default RunDir
- modify startup script to create above RunDir and symlink into /var/run/icinga2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2015/11/14 22:56:24 sthen Exp $
d12 1
a12 1
REVISION-main =	5
@


1.40
log
@try building icinga2 with ports gcc (4.9) on sparc64, it fails with system gcc

{standard input}:38466: Error: Illegal operands: %lo requires arguments in ()
c++: Internal error: Illegal instruction (program cc1plus)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2015/11/09 22:36:38 sthen Exp $
d12 1
a12 1
REVISION-main =	4
@


1.39
log
@Add upstream patches for Icinga2 so that opening a fifo doesn't block
open()s in other threads, fixing an issue where the daemon doesn't start
correctly when the command listener is enabled.

Many thanks to dnsmichi and gunnarbeutner from Icinga for tracking this
down and fixing it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2015/10/21 19:10:34 sthen Exp $
d30 9
a38 1
MODULES =		devel/cmake
@


1.38
log
@trimmed a bit too much in previous, reinstate SYSCONFDIR subst.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2015/10/21 09:34:03 sthen Exp $
d12 1
a12 1
REVISION-main =	3
@


1.37
log
@clean up Makefile, install editor syntax files in the right place
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2015/10/21 09:03:22 sthen Exp $
d12 1
a12 1
REVISION-main =	2
d63 3
@


1.36
log
@Adjust the icinga2 port:

- Replace previous backout with fixes from Gunnar Beutner (upstream):

 . Make sure the timer thread is gone when calling fork()
 . Ensure that the main thread pool gets re-initialized properly after fork()

- Add a check so that 'make test' fails early with a useful error if the
libconfig package is installed; the objects in the build directory don't
have a finalized rpath and they are looking in /usr/local/lib before the
build directory, so the wrong libconfig so is picked up.

I think this port should now be in good shape, please let me know if you're
using it and run into problems with forking etc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2015/10/20 21:34:29 sthen Exp $
d12 1
d34 1
d54 9
a62 20
	-DCMAKE_INSTALL_MANDIR:String="${PREFIX}/man" \
	-DCMAKE_INSTALL_SYSCONFDIR:String="${PREFIX}/share/examples" \
	-DCMAKE_INSTALL_FULL_SYSCONFDIR:String="${WRKINST}${SYSCONFDIR}" \
	-DCMAKE_INSTALL_LOCALSTATEDIR:String="${LOCALSTATEDIR}" \
	-DICINGA2_COMMAND_USER:String="_icinga" \
	-DICINGA2_COMMAND_GROUP:String="_icingacmd" \
	-DICINGA2_USER:String="_icinga" \
	-DICINGA2_GROUP:String="_icinga" \
	-DICINGA2_GIT_VERSION_INFO:Boolean="OFF" \
	-DICINGA2_PLUGINDIR:String="${LOCALBASE}/libexec/nagios"

pre-configure:
	ln -sf ${LOCALBASE}/bin/gflex ${WRKDIR}/bin/flex

post-configure:
	perl -pi -e 's,%SYSCONFDIR%,${SYSCONFDIR},' ${WRKBUILD}/config.h \
	    ${WRKBUILD}/etc/icinga/icinga-classic-apache.conf

pre-install:
	mkdir -p ${PREFIX}
d65 6
a70 3
	cp -r ${WRKSRC}/tools/syntax ${PREFIX}/share/examples/icinga2/
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share/examples/icinga2/syntax
	chmod -R u=rwX,g=rX,o=rX ${PREFIX}/share/examples/icinga2/syntax
@


1.35
log
@rename the icinga2 database subpackages to icinga2-ido-XXsql, to match the
standard package names used on other OS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2015/10/20 20:59:40 sthen Exp $
d11 1
a11 1
REVISION =	0
d78 5
a82 5
# XXX this target isn't actually needed in order to run the tests, but they
# are all failing for me with ld.so errors (possibly rpath-related) and
# the -V makes it more obvious what's going on.
do-test:
	cd ${WRKBUILD}; ctest -V
@


1.34
log
@Adjust the pexp regex in the rc script, it needs a trailing .* to match
the process arguments when they're modified after a reload.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2015/10/20 13:54:13 sthen Exp $
d11 1
a11 1
REVISION-main =	0
d18 2
a19 2
PKGNAME-mysql =	icinga2-mysql-$V
PKGNAME-pgsql =	icinga2-pgsql-$V
@


1.33
log
@Update to icinga2-2.3.11 and unbreak by adding patches to revert oldish
upstream commit 86819f446e2 which broke daemon activation on OpenBSD.
Without this reversion ConfigItem::ActivateItems() doesn't get any
further after the call to DynamicObject::RestoreObjects().
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2015/08/25 15:22:38 sthen Exp $
d11 1
@


1.32
log
@remove @@extraunexec that end up under /var/run as well, req'd by aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2015/08/25 13:53:28 sthen Exp $
a2 1
BROKEN =	doesn't startup correctly; ConfigItem::ActivateItems() doesn't proceed after DynamicObject::RestoreObjects() call
d10 1
a10 2
V =		2.3.8
REVISION-main =	0
@


1.31
log
@- remove @@samples that end up under /var/run, req'd by ajacoutot
- on the off-chance, try an update while there
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2015/07/07 14:44:59 sthen Exp $
d12 1
@


1.30
log
@use su -m instead of -s /bin/sh, suggested by millert
add some missing -c
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2015/07/06 11:25:36 sthen Exp $
d11 1
a11 1
V =		2.3.5
a12 1
REVISION-main =	1
@


1.29
log
@Remove use of sudo from pkg READMEs in a few ports as packages and their
instructions are meant to work on a fresh install.

- easy cases: replace some '$ sudo somecommand' with '# somecommand'
(while there I've swapped some "${RCDIR}/foo start" with "rcctl foo start").

- replace some 'sudo -u user somecommand foo bar' with
'su -s /bin/sh user "/path/to/somecommand foo bar"' and similar.
Not pretty with the -s, but many of the uids that need to run
these commands have /sbin/nologin as their usual shell.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2015/07/02 20:16:54 sthen Exp $
d13 1
a20 1
REVISION-main =	0
@


1.28
log
@Slightly better BROKEN marker for icinga2. Any clues very welcome...

ConfigItem::ActivateItems() calls DynamicObject::RestoreObjects().
DynamicObject::RestoreObjects() runs to the last line of the function,
however control is not returned to the following line in
ConfigItem::ActivateItems() (i.e. the calling function).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2015/06/30 09:19:48 sthen Exp $
d20 1
@


1.27
log
@update to icinga2-2.3.5, still no closer to solving the problems though so
it remains marked BROKEN.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2015/05/12 09:37:03 sthen Exp $
d3 1
a3 1
BROKEN =	doesn't daemonize correctly. also suspect some thread-related problems with forking.
a61 3

# CFLAGS +=	-pthread
# LDFLAGS +=	-lpthread
@


1.26
log
@update to icinga2 2.3.4. mark BROKEN until I can get some handle on what's
going on with daemonization (not backgrounding when expected) and hangs seen
in some cases.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2015/02/06 22:53:27 sthen Exp $
d11 1
a11 1
V =		2.3.4
d75 5
@


1.25
log
@Update to icinga2-2.2.4. Change rc script to use "icinga2 daemon" and rc_bg to
force running in the background; it was previously using "icinga2 daemon -d",
but since 2.2.2 this has been hanging on OpenBSD.

Disable vfork as was done upstream on MacOS (to stop a hang there) in the
hope it may also stop a runtime hang seen occasionally here.

There are still some odd things going on and I don't think this is production-
ready on OpenBSD yet, so the warning in DESCR-main remains, but I think this
is not worse than 2.2.1.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2015/01/20 18:42:38 landry Exp $
d3 3
a5 3
# XXX note that rc_bg is used in the rc script; it shouldn't be necessary,
# -d should work, but when that's used we run into hangs on OpenBSD, more at
# http://marc.info/?l=openbsd-ports&m=142317662106234&w=2
a6 2
SHARED_ONLY =	Yes
BROKEN-hppa =	undefined reference to __sync_add_and_fetch_4 when linking icinga2
d11 1
a11 1
V =		2.2.4
d53 1
a53 1
	-DCMAKE_INSTALL_SYSCONFDIR:String="${SYSCONFDIR}" \
d63 2
a64 2
CFLAGS +=	-pthread
LDFLAGS +=	-lpthread
d70 2
a71 2
	perl -pi -e 's,}${SYSCONFDIR}/icinga2,}${TRUEPREFIX}/share/examples/icinga2,g' \
	    ${WRKBUILD}/etc/cmake_install.cmake
@


1.24
log
@Broken on hppa for missing atomic ops
@
text
@d1 5
a5 1
# $OpenBSD: Makefile,v 1.23 2015/01/04 21:47:14 sthen Exp $
d8 1
a8 1
BROKEN-hppa =	undefined reference to `__sync_add_and_fetch_4' when linking icinga2
d13 1
a13 1
V =		2.2.1
a14 1
REVISION-main =	0
d78 1
a78 1
# this target isn't actually needed in order to run the tests, but they
@


1.23
log
@tweak DESCR, make it clear that this isn't considered entirely stable on OpenBSD
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2015/01/04 21:32:24 sthen Exp $
d4 1
a4 1

@


1.22
log
@revert to icinga2 2.2.1, at least daemonizing fails on openbsd, possibly more.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2014/12/17 22:10:30 sthen Exp $
d11 1
@


1.21
log
@update to icinga2-2.2.2, various bugfixes
@
text
@d9 2
a10 1
V =		2.2.2
@


1.20
log
@Remove some bogus information about web chroot setup that was modified from
the icinga1 readme, it can go back later when icinga web 2 is ready. Problems
spotted by florian@@.

Mention that icinga2-migration is now a package.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2014/12/01 23:45:58 sthen Exp $
d9 1
a9 2
V =		2.2.1
REVISION-main =	0
@


1.19
log
@update to icinga 2.2.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2014/11/23 20:28:01 sthen Exp $
d10 1
@


1.18
log
@remove WRKDIST=${WRKDIR}/${DISTNAME} lines, they are the default anyway
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2014/11/22 00:13:03 sthen Exp $
d9 1
a9 1
V =		2.2.0
@


1.17
log
@update to icinga2 2.2.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2014/09/13 18:09:21 brad Exp $
a24 2

WRKDIST =		${WRKDIR}/${DISTNAME}
@


1.16
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 24
# $OpenBSD: Makefile,v 1.15 2014/07/19 22:36:13 ajacoutot Exp $

# THIS IS A WORK IN PROGRESS, IT IS NOT YET READY FOR USE.
#
# Remaining problems:

# 1. tests fail for sthen but not rpe ... from cd ${WRKBUILD}; ctest --verbose:
#
# libicinga.so: undefined symbol '_ZN6icinga11AExpression9OpLiteralEPKS0_RKN5boost10shared_ptrINS_10DictionaryEEE'
# libicinga.so: undefined symbol '_ZN6icinga11AExpression5OpSetEPKS0_RKN5boost10shared_ptrINS_10DictionaryEEE'
# libicinga.so: undefined symbol '_ZN6icinga10ObjectRule12RegisterTypeERKNS_6StringERKN5boost8functionIFvRKSt6vectorIS0_SaIS0_EEEEE'
# lazy binding failed!
# Test setup error: memory access violation at address: 0x00000000: no mapping at fault address
#
# Only obvious difference in build log is that -rpath-link is ordered
# differently, /usr/X11R6/lib:/usr/local/lib vs /usr/local/lib:/usr/X11R6/lib

# 2. directory structure and chroot.
# icinga1: /var/icinga /var/log/icinga /etc/icinga in chroot and symlinked
# icinga2: s/icinga/icinga2 and adds /var/{lib,spool}/icinga2 - are these
# required in chroot? add to README if needed.
#
# for OpenBSD hier it *ought* to use var/db/icinga2 rather than var/lib/icinga2
# but this is rather an intrusive change in the code..
d9 4
a12 1
V =		2.0.1
a17 3
REVISION-main =	0
REVISION-mysql = 0

d24 1
a24 1
WANTLIB += boost_thread-mt crypto execinfo m pthread ssl stdc++
a25 6
# switch to a proper uploaded tar (rather than github autogenerated
# file) if one becomes available
GH_ACCOUNT =		Icinga
GH_PROJECT =		icinga2
GH_TAGNAME =		v$V
GH_COMMIT =		b80c3b2df420bfb0a5830ecd51750c2d247b4e20
a31 3
LIB_DEPENDS =		devel/boost \
			devel/libexecinfo
RUN_DEPENDS =           ${BASE_PKGPATH},-main
d36 3
d40 1
d53 1
d60 1
a60 1
	-DICINGA2_SYSCONFIGFILE:String="${PREFIX}/share/examples/icinga2/sysconfig"
a66 1
	@@${SUBST_CMD} ${WRKSRC}/etc/icinga2/constants.conf
d71 9
@


1.15
log
@/etc/rc.d -> ${RCDIR}
(as pedantic and useless as /usr/local vs LOCALBASE|PREFIX but well...)

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2014/07/12 11:22:10 sthen Exp $
d39 1
d71 1
a71 1
LIB_DEPENDS-mysql =	${LIB_DEPENDS} databases/mysql
@


1.14
log
@don't use "echo 'pkg_scripts="${pkg_scripts} icinga' >> /etc/rc.conf.local"
examples

chase monitoring-plugins change (missed commit yesterday)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2014/07/10 15:01:17 sthen Exp $
d37 2
@


1.13
log
@update to icinga 2.0.1, I still see all tests failing (seems to be dlopen
related), but now it seems to start reliably without segfaults.

(still not linked to the build at this point).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2014/07/10 12:58:31 ajacoutot Exp $
d65 1
a65 1
RUN_DEPENDS-main =	net/nagios/plugins
@


1.12
log
@rc.conf.local is always under /etc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2014/07/10 11:14:20 rpe Exp $
a25 2
# 3. intermittent segfaults at startup (~50% of the time or so?)

d32 1
a32 1
V =		2.0.0
a37 2
REVISION-main=	0

d51 2
a52 1
GH_COMMIT =		30384a4340011723869969e76a3dd2801786cf2e
d67 1
a67 1
WANTLIB-mysql +=	${WANTLIB} mysqlclient
@


1.11
log
@Add commit id to ensure to fetch the exact same distfile even upstream
commits to the tag after the initial release.

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2014/07/09 15:06:06 rpe Exp $
d39 2
@


1.10
log
@Switch to new way of handling github.

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2014/07/01 22:55:27 sthen Exp $
d53 1
@


1.9
log
@add todo comment re intermittent segfaults at startup (so far resistant to
getting a core dump)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2014/06/27 00:28:02 sthen Exp $
a47 1
MASTER_SITES =		https://github.com/Icinga/icinga2/archive/
d50 3
a52 1
DISTFILES =		${DISTNAME}{v${V}}${EXTRACT_SUFX}
@


1.8
log
@remove obsolete comments
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2014/06/27 00:14:27 sthen Exp $
d25 2
@


1.7
log
@LIB_DEPENDS on libexecinfo
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2014/06/27 00:09:29 sthen Exp $
d19 6
a24 12
# icinga1 had a simple structure for directories written at runtime,
# basically just var/icinga and var/log/icinga, so easy to move into
# chroot (see core/pkg/README-main). icinga2 uses var/lib/icinga2,
# var/log/icinga2, var/run/icinga2, var/spool/icinga2; README needs
# adapting to move these into the right place, plus for OpenBSD hier
# it should use var/db/icinga2 rather than var/lib/icinga2

# 3. doesn't pick up libexecinfo. maybe FindBacktrace.cmake from
# audio/clementine will help

# 4. needs new gid for COMMAND_GROUP and set this in CONFIGURE_ARGS
# (upstream uses icingacmd)
@


1.6
log
@Add a dedicated _icingacmd group for use with icinga2 command pipes and livestatus
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2014/06/24 16:51:35 sthen Exp $
d61 2
a62 1
LIB_DEPENDS =		devel/boost
@


1.5
log
@pick up backtrace() functions from libexecinfo by using FindBacktrace.cmake

XXX comments because ports version of FindBacktrace uses BACKTRACE_ rather
than Backtrace_ as used in the version committed to cmake 3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2014/06/22 20:54:26 sthen Exp $
d82 1
a82 1
	-DICINGA2_COMMAND_GROUP:String="_icinga" \
@


1.4
log
@add notes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2014/06/20 22:11:57 sthen Exp $
d50 1
a50 1
WANTLIB += boost_thread-mt crypto m pthread ssl stdc++
a97 3

# XXX for diffable build logs whilst testing
USE_NINJA=No
@


1.3
log
@As rpe noticed, CMAKE_INSTALL_SYSCONFDIR isn't just used for installation,
it makes it into binaries/scripts. So set it to ${SYSCONFDIR} and then
(because cmake doesn't let us simply override variables at install time
like autoconf does) patch the generated cmake_install.cmake files to
install under share/examples.
@
text
@d1 30
a30 1
# $OpenBSD: Makefile,v 1.2 2014/06/19 23:33:09 sthen Exp $
d53 2
a58 1
# TODO devel/libexecinfo - want it, cmake doesn't find it
a76 1
# XXX different group for COMMAND_GROUP, upstream uses icingacmd
a90 2
# XXX tests fail for sthen but not rpe ...

d98 3
@


1.2
log
@improvements, from rpe, minor tweaks by me
@
text
@d1 1
a1 1
# $OpenBSD$
d50 1
a50 1
	-DCMAKE_INSTALL_SYSCONFDIR:String="${PREFIX}/share/examples" \
d67 4
@


1.1
log
@Add icinga/core2, WIP port of icinga2, ok rpe@@.
(Unlinked for now; working on it with rpe.)
@
text
@d5 3
a7 1
COMMENT =	network monitoring system
a13 5
COMMENT-main =	network monitoring system
COMMENT-mysql =	MySQL support for icinga2
COMMENT-pgsql =	PostgreSQL support for icinga2

CATEGORIES =	net
d24 1
a24 1
DISTFILES =		${DISTNAME}${EXTRACT_SUFX}{v${V}${EXTRACT_SUFX}}
d27 2
d31 2
d36 2
a37 1
# TODO devel/libexecinfo - want it, cmake doesn't find it
d39 1
a39 1
LIB_DEPENDS =		devel/boost
d41 1
a41 1
LIB_DEPENDS-pgsql =	${LIB_DEPENDS} databases/postgresql
a42 2
WANTLIB-main +=		${WANTLIB} c
WANTLIB-mysql +=	${WANTLIB} mysqlclient
d44 2
a45 10

#RUN_DEPENDS =		???
#TEST_DEPENDS =		???

#MAKE_FLAGS =		???
#MAKE_ENV =		???
#FAKE_FLAGS =		???

# XXX all tests fail
#TEST_FLAGS =		???
d62 2
a64 1
	###echo '#define VERSION "$V"' >> ${WRKSRC}/icinga-version.h.fallback
d66 1
@

