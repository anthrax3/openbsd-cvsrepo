head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.6
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.4
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3;
locks; strict;
comment	@# @;


1.3
date	2016.02.02.01.29.05;	author sthen;	state Exp;
branches;
next	1.2;
commitid	4rlK6pnnwabuUN4Z;

1.2
date	2016.01.03.18.20.48;	author sthen;	state Exp;
branches;
next	1.1;
commitid	v6XycDesAJsz0Vd4;

1.1
date	2015.11.16.20.30.34;	author sthen;	state Exp;
branches;
next	;
commitid	QAgG6YJbVIsIcAYm;


desc
@@


1.3
log
@Remove patches from the icingaweb2 package that were hacking around the
mismatch between chrooted and non-chrooted paths (there are both CLI
scripts and a web app; both need to refer to the same paths and as well
as being complicated, the patches weren't quite working correctly,
as noticed by sebastia@@).

Now you must setup a symlink "/var/www/var/www -> .." instead as
described in the new version of the pkg-readme, allowing icingaweb2 to
always use /var/www paths whether inside or outside the jail.

Note: Existing users of this package will need to create that symlink too.
@
text
@$OpenBSD: patch-modules_setup_application_views_scripts_form_setup-welcome_phtml,v 1.2 2016/01/03 18:20:48 sthen Exp $

Minimal patches to avoid showing confusing path to users in the welcome
screen (PHP is normally run chroot'ed on OpenBSD), and use group "_icingaweb2"
as per OpenBSD standard naming for groups from packages.

--- modules/setup/application/views/scripts/form/setup-welcome.phtml.orig	Wed Dec 23 13:24:06 2015
+++ modules/setup/application/views/scripts/form/setup-welcome.phtml	Tue Feb  2 01:19:39 2016
@@@@ -8,7 +8,7 @@@@ use Icinga\Web\Wizard;
 $phpUser = Platform::getPhpUser();
 $configDir = Icinga::app()->getConfigDir();
 $setupTokenPath = rtrim($configDir, '/') . '/setup.token';
-$cliPath = realpath(Icinga::app()->getApplicationDir() . '/../bin/icingacli');
+$cliPath = '/var/www/icinga-web2/bin/icingacli';
 
 $groupadd = null;
 if (! (false === ($distro = Platform::getLinuxDistro(1)) || $distro === 'linux')) {
@@@@ -81,11 +81,11 @@@@ if (! (false === ($distro = Platform::getLinuxDistro(1
       ); ?></p>
       <p><?= $this->translate('In any case, make sure that all of the following applies to your environment:'); ?></p>
       <ul>
-        <li><?= $this->translate('A system group called "icingaweb2" exists'); ?></li>
+        <li><?= $this->translate('A system group called "_icingaweb2" exists'); ?></li>
         <?php if ($phpUser): ?>
-        <li><?= sprintf($this->translate('The user "%s" is a member of the system group "icingaweb2"'), $phpUser); ?></li>
+        <li><?= sprintf($this->translate('The user "%s" is a member of the system group "_icingaweb2"'), $phpUser); ?></li>
         <?php else: ?>
-        <li><?= $this->translate('Your webserver\'s user is a member of the system group "icingaweb2"'); ?></li>
+        <li><?= $this->translate('Your webserver\'s user is a member of the system group "_icingaweb2"'); ?></li>
         <?php endif ?>
       </ul>
       <?php if (! ($groupadd === null || $usermod === null)) { ?>
@@@@ -96,12 +96,12 @@@@ if (! (false === ($distro = Platform::getLinuxDistro(1
       <?php } ?>
       <p><?= $this->translate('If you\'ve got the IcingaCLI installed you can do the following:'); ?></p>
       <div class="code">
-        <span><?= $cliPath ? $cliPath : 'icingacli'; ?> setup config directory --group icingaweb2<?= $configDir !== '/etc/icingaweb2' ? ' --config ' . $configDir : ''; ?>;</span>
+        <span><?= $cliPath ? $cliPath : 'icingacli'; ?> setup config directory --group _icingaweb2<?= $configDir !== '/etc/icingaweb2' ? ' --config ' . $configDir : ''; ?>;</span>
         <span><?= $cliPath ? $cliPath : 'icingacli'; ?> setup token create;</span>
       </div>
       <p><?= $this->translate('In case the IcingaCLI is missing you can create the token manually:'); ?></p>
       <div class="code">
-        <span>su <?= $phpUser ?: $this->translate('<your-webserver-user>'); ?> -c "mkdir -m 2770 <?= dirname($setupTokenPath); ?>; chgrp icingaweb2 <?= dirname($setupTokenPath); ?>; head -c 12 /dev/urandom | base64 | tee <?= $setupTokenPath; ?>; chmod 0660 <?= $setupTokenPath; ?>;";</span>
+        <span>su <?= $phpUser ?: $this->translate('<your-webserver-user>'); ?> -c "mkdir -m 2770 /var/www/etc/icingaweb2; chgrp _icingaweb2 /var/www/etc/icingaweb2; ?>; head -c 12 /dev/urandom | base64 | tee <?= $setupTokenPath; ?>; chmod 0660 <?= $setupTokenPath; ?>;";</span>
       </div>
       <p><?= sprintf(
         $this->translate('Please see the %s for an extensive description on how to access and use this wizard.'),
@


1.2
log
@update to icinga-web2-2.1.0
@
text
@d1 1
a1 1
$OpenBSD: patch-modules_setup_application_views_scripts_form_setup-welcome_phtml,v 1.1 2015/11/16 20:30:34 sthen Exp $
d7 2
a8 2
--- modules/setup/application/views/scripts/form/setup-welcome.phtml.orig	Tue Dec 22 13:59:48 2015
+++ modules/setup/application/views/scripts/form/setup-welcome.phtml	Thu Dec 24 12:56:13 2015
d18 15
@


1.1
log
@Icinga Web 2 v2.1.0
@
text
@d1 1
a1 1
$OpenBSD$
d7 2
a8 2
--- modules/setup/application/views/scripts/form/setup-welcome.phtml.orig	Tue Nov 10 17:48:40 2015
+++ modules/setup/application/views/scripts/form/setup-welcome.phtml	Tue Nov 10 18:00:38 2015
d17 2
a18 2
 $usermod = null;
@@@@ -90,12 +90,12 @@@@ if (! (false === ($distro = Platform::getLinuxDistro(1
@

