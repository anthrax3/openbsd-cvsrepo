head	1.36;
access;
symbols
	OPENBSD_6_1:1.34.0.2
	OPENBSD_6_1_BASE:1.34
	OPENBSD_6_0:1.14.0.2
	OPENBSD_6_0_BASE:1.14
	OPENBSD_5_9:1.13.0.2
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.13.0.4
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.10.0.2
	OPENBSD_5_7_BASE:1.10
	OPENBSD_5_6:1.7.0.6
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.4
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.2
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.4.0.10
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.4.0.8
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.4
	OPENBSD_5_1:1.4.0.6
	OPENBSD_5_0:1.4.0.4
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.2
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.1.1.1.0.8
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.6
	OPENBSD_4_7_BASE:1.1.1.1
	OPENBSD_4_6:1.1.1.1.0.4
	OPENBSD_4_6_BASE:1.1.1.1
	OPENBSD_4_5:1.1.1.1.0.2
	OPENBSD_4_5_BASE:1.1.1.1
	kevlo_2008-Dec-17:1.1.1.1
	kevlo:1.1.1;
locks; strict;
comment	@# @;


1.36
date	2017.05.13.09.49.50;	author espie;	state Exp;
branches;
next	1.35;
commitid	Qq9CIQtBjFqtn5SM;

1.35
date	2017.04.12.10.58.36;	author ajacoutot;	state Exp;
branches;
next	1.34;
commitid	x4zlr4qDRupHph9x;

1.34
date	2017.01.31.05.19.52;	author ajacoutot;	state Exp;
branches;
next	1.33;
commitid	7atWKYIk9jGke9os;

1.33
date	2016.12.12.15.12.04;	author ajacoutot;	state Exp;
branches;
next	1.32;
commitid	OwbTeLi1tOG7xIUJ;

1.32
date	2016.12.09.13.14.02;	author ajacoutot;	state Exp;
branches;
next	1.31;
commitid	hklTZojRnQxnW7p9;

1.31
date	2016.12.02.10.05.06;	author ajacoutot;	state Exp;
branches;
next	1.30;
commitid	UHG6wuPxLrx0uRa6;

1.30
date	2016.12.01.09.08.37;	author ajacoutot;	state Exp;
branches;
next	1.29;
commitid	ra20etnC4QOZvm8o;

1.29
date	2016.11.19.12.02.37;	author ajacoutot;	state Exp;
branches;
next	1.28;
commitid	n3iDjgrFJJS8qV3w;

1.28
date	2016.10.10.08.06.38;	author ajacoutot;	state Exp;
branches;
next	1.27;
commitid	jA2LhZPvUji9HRXl;

1.27
date	2016.10.07.13.34.56;	author ajacoutot;	state Exp;
branches;
next	1.26;
commitid	JyWgcLh8SDFbaO7Z;

1.26
date	2016.10.07.12.59.42;	author ajacoutot;	state Exp;
branches;
next	1.25;
commitid	BDpMKdNJiQBm6KoC;

1.25
date	2016.10.07.10.05.16;	author ajacoutot;	state Exp;
branches;
next	1.24;
commitid	pTe3zqP8vjMdkeqz;

1.24
date	2016.09.17.14.42.13;	author ajacoutot;	state Exp;
branches;
next	1.23;
commitid	uuzfa3059k4rELnT;

1.23
date	2016.09.08.08.16.12;	author ajacoutot;	state Exp;
branches;
next	1.22;
commitid	hjISGcRYydkiTPXa;

1.22
date	2016.09.07.14.50.18;	author dcoppa;	state Exp;
branches;
next	1.21;
commitid	k55uKUlf3lNA2nSN;

1.21
date	2016.09.07.10.56.02;	author ajacoutot;	state Exp;
branches;
next	1.20;
commitid	mdOvo7YBIxQ9q5UC;

1.20
date	2016.09.06.16.12.57;	author ajacoutot;	state Exp;
branches;
next	1.19;
commitid	9i3B3xETZz1rb8xH;

1.19
date	2016.09.01.13.14.00;	author ajacoutot;	state Exp;
branches;
next	1.18;
commitid	JCvhgRockvq5Mx0K;

1.18
date	2016.08.31.07.58.01;	author ajacoutot;	state Exp;
branches;
next	1.17;
commitid	XediNRNr16ooQaj2;

1.17
date	2016.08.27.12.58.07;	author ajacoutot;	state Exp;
branches;
next	1.16;
commitid	IyOcPpi1kXlcSEBw;

1.16
date	2016.08.27.08.18.42;	author ajacoutot;	state Exp;
branches;
next	1.15;
commitid	ODB2zfxrpoPdPwLQ;

1.15
date	2016.08.27.06.39.14;	author ajacoutot;	state Exp;
branches;
next	1.14;
commitid	VgK3y5AGX55LwTNu;

1.14
date	2016.03.01.00.07.17;	author sthen;	state Exp;
branches;
next	1.13;
commitid	QBhOYg1ODJRuhu7C;

1.13
date	2015.07.19.16.38.48;	author sthen;	state Exp;
branches;
next	1.12;
commitid	36KxHNN9JqYXFuyr;

1.12
date	2015.06.18.07.25.44;	author bentley;	state Exp;
branches;
next	1.11;
commitid	CYEUqLmoizkROARF;

1.11
date	2015.03.16.18.07.51;	author naddy;	state Exp;
branches;
next	1.10;
commitid	IJdm3Zowcdkcxp5X;

1.10
date	2015.01.21.06.23.34;	author bentley;	state Exp;
branches;
next	1.9;
commitid	mZdnLaBzccfpxHTo;

1.9
date	2014.11.05.11.43.59;	author sthen;	state Exp;
branches;
next	1.8;
commitid	RB64hioD1zIM5GcO;

1.8
date	2014.09.13.16.36.54;	author ajacoutot;	state Exp;
branches;
next	1.7;
commitid	N2TalFGi4jKRwS2u;

1.7
date	2013.03.21.08.46.33;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2013.03.11.11.35.45;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2013.03.03.08.12.05;	author landry;	state Exp;
branches;
next	1.4;

1.4
date	2010.11.19.22.31.32;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2010.11.11.11.54.08;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2010.10.12.20.12.52;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2008.12.17.01.34.53;	author kevlo;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.12.17.01.34.53;	author kevlo;	state Exp;
branches;
next	;


desc
@@


1.36
log
@first batch of WANT_CXX
@
text
@# $OpenBSD: Makefile,v 1.35 2017/04/12 10:58:36 ajacoutot Exp $

COMMENT=		network analysis and security monitoring framework

DISTNAME=		bro-2.5
REVISION=		5

SHARED_LIBS +=  broccoli                  5.1 # 5.1

CATEGORIES=		net security

HOMEPAGE=		https://www.bro.org/

MAINTAINER=		Antoine Jacoutot <ajacoutot@@openbsd.org>

# BSD
PERMIT_PACKAGE_CDROM= 	Yes

WANTLIB += GeoIP c crypto m pcap pthread ssl z
WANTLIB += ${MODPY_WANTLIB} lib/libbind/bind

MASTER_SITES=		https://www.bro.org/downloads/

MODULES=		lang/python

# c++11
WANT_CXX =		base gcc

MODPY_ADJ_FILES=	aux/broctl/bin/broctl.in \
			aux/broctl/bin/stats-to-csv \
			aux/btest/btest \
			aux/broctl/aux/trace-summary/trace-summary

BUILD_DEPENDS=		devel/bison \
			devel/cmake \
			devel/swig

LIB_DEPENDS=		${MODPY_LIB_DEPENDS} \
			net/GeoIP \
			net/libbind

RUN_DEPENDS=		net/GeoIP,-asn \
			net/GeoIP,-city

# XXX the bundled sqlite seems to pick up ICU4C if present and will error out if
# it gets junked during the build; I could not find a proper way to disable it
# make: don't know how to make /usr/local/include/unicode/bytestream.h
# (prerequisite of: src/CMakeFiles/bro.dir/3rdparty/sqlite3.c.o)
BUILD_DEPENDS +=	textproc/icu4c

# share/broctl/scripts
BUILD_DEPENDS +=	shells/bash
RUN_DEPENDS +=		misc/findutils \
			shells/bash

# share/bro/base/utils/active-http.bro
RUN_DEPENDS +=		net/curl

CONFIGURE_STYLE=	simple

CONFIGURE_ENV=		LDFLAGS="${LDFLAGS} -L${LOCALBASE}/lib/libbind \
				-lbind -Wl,-rpath ${LOCALBASE}/lib/libbind"

CONFIGURE_ARGS=		--prefix=${PREFIX} \
			--conf-files-dir=${SYSCONFDIR}/bro \
			--localstatedir=${LOCALSTATEDIR} \
			--spooldir=${LOCALSTATEDIR}/spool/bro \
			--logdir=${LOCALSTATEDIR}/log/bro \
			--python-install-dir=${PREFIX}/lib/python${MODPY_VERSION}/site-packages \
			--with-python=${MODPY_BIN} \
			--binary-package

SUBST_VARS=		MODPY_SITEPKG

pre-configure:
	${SUBST_CMD} ${WRKSRC}/aux/broctl/BroControl/options.py

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples
	mv ${WRKINST}/etc/bro ${PREFIX}/share/examples/bro
	rm -rf ${WRKINST}/var/{log,spool}/bro
	mv ${PREFIX}/share/bro/site/ ${PREFIX}/share/examples/bro/
	cd ${PREFIX}/share/bro && ln -sf ${SYSCONFDIR}/bro/site
	mv ${PREFIX}/lib/broctl/BroControl \
		${WRKINST}/${MODPY_SITEPKG}/
	mv ${PREFIX}/lib/broctl/plugins \
		${WRKINST}/${MODPY_SITEPKG}/BroControl/
	rm ${WRKINST}/${MODPY_SITEPKG}/BroControl/options.py.{beforesubst,orig}
	${MODPY_BIN} ${MODPY_LIBDIR}/compileall.py ${WRKINST}/${MODPY_SITEPKG}

# handled by exec-add / exec-delete ; symlink changes according to spooldir
	rm ${PREFIX}/share/broctl/scripts/broctl-config.sh

.include <bsd.port.mk>
@


1.35
log
@Conflict with archivers/brotli.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2017/01/31 05:19:52 ajacoutot Exp $
d27 1
a27 3
MODULES +=		gcc4
MODGCC4_LANGS=		c++
MODGCC4_ARCHS=		*
@


1.34
log
@The bundled sqlite seems to pick up ICU4C if present and will error out if
it gets junked during the build; I could not find a proper way to disable
it...
So just BDEP on textproc/icu4c for now and hope this will workaround the
issue.

breakage reported by naddy@@ a couple of times
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2016/12/12 15:12:04 ajacoutot Exp $
d6 1
a6 1
REVISION=		4
@


1.33
log
@Tweak.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2016/12/09 13:14:02 ajacoutot Exp $
d6 1
a6 1
REVISION=		3
d46 6
@


1.32
log
@Make it possible to load dynamic plugins.
from Daniel Thayer (upstream)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2016/12/02 10:05:06 ajacoutot Exp $
d6 1
a6 1
REVISION=		2
@


1.31
log
@Drop the setrlimit patch, it's not needed anymore; prodded by Daniel Thayer
http -> https in README while here.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2016/12/01 09:08:37 ajacoutot Exp $
d6 1
a6 1
REVISION=		1
@


1.30
log
@Needs gfind to run some of the bro scripts.
@@sample local-logger.bro which was forgotten after the update to 2.5.

reported by Daniel Thayer, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2016/11/19 12:02:37 ajacoutot Exp $
d6 1
a6 1
REVISION=		0
@


1.29
log
@Update to bro-2.5.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2016/10/10 08:06:38 ajacoutot Exp $
d6 1
d49 2
a50 1
RUN_DEPENDS +=		shells/bash
@


1.28
log
@Add a small entry for 'broctl cron'.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2016/10/07 13:34:56 ajacoutot Exp $
d5 1
a5 2
DISTNAME=		bro-2.4.1
REVISION=		9
d18 1
a18 1
WANTLIB += GeoIP c crypto m pcap pthread ssl stdc++ z
d24 5
@


1.27
log
@Handle the ${PREFIX}/share/broctl/scripts/broctl-config.sh symlink at
install time (@@exec-add/@@exec-delete). The target changes according to the
spooldir and "@@comment no checksum" does not work for symlinks.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2016/10/07 12:59:42 ajacoutot Exp $
d6 1
a6 1
REVISION=		8
@


1.26
log
@Revert the cmake patch again and use LDFLAGS. We want to make sure libbind
is used to prevent conflicts.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2016/10/07 10:05:16 ajacoutot Exp $
d6 1
a6 1
REVISION=		7
d80 3
@


1.25
log
@Use setrlimit() in broctl, at least 256 FDs are needed.
Fix rc_reload().
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2016/09/17 14:42:13 ajacoutot Exp $
d6 1
a6 1
REVISION=		6
d50 3
@


1.24
log
@Properly @@sample local site files so that they can be modified by the admin.
Noticed by and input from semarie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2016/09/08 08:16:12 ajacoutot Exp $
d6 1
a6 1
REVISION=		5
@


1.23
log
@512 openfiles seems to be enough.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2016/09/07 14:50:18 dcoppa Exp $
d6 1
a6 1
REVISION=		4
d69 2
@


1.22
log
@
Use the right cmake lingo to set a non-standard RPATH.

ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2016/09/07 10:56:02 ajacoutot Exp $
d6 1
a6 1
REVISION=		3
@


1.21
log
@Drop cmake/FindBIND.cmake and use LDFLAGS until I understand what magic is
needed to handle RPATH.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2016/09/06 16:12:57 ajacoutot Exp $
a49 3

CONFIGURE_ENV=		LDFLAGS="${LDFLAGS} -L${LOCALBASE}/lib/libbind \
				-lbind -Wl,-rpath ${LOCALBASE}/lib/libbind"
@


1.20
log
@Add a couple of build patches from Michael Shirk.
While here, fix a warning.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2016/09/01 13:14:00 ajacoutot Exp $
d6 1
a6 1
REVISION=		2
d50 3
@


1.19
log
@Make sure we pick up the correct python version.

reported by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2016/08/31 07:58:01 ajacoutot Exp $
d6 1
a6 1
REVISION=		1
a49 2

CONFIGURE_ENV=		LDFLAGS="${LDFLAGS} -L${LOCALBASE}/lib/libbind -lbind -Wl,-rpath ${LOCALBASE}/lib/libbind"
@


1.18
log
@Missing bdep on bison.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2016/08/27 12:58:07 ajacoutot Exp $
d59 1
@


1.17
log
@Depends on several GeoIP DBs.
Few tweaks while here.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2016/08/27 08:18:42 ajacoutot Exp $
d31 2
a32 1
BUILD_DEPENDS=		devel/cmake \
@


1.16
log
@Tweak README a bit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2016/08/27 06:39:14 ajacoutot Exp $
d6 1
a6 1
REVISION=		0
d34 7
a46 4

LIB_DEPENDS=		${MODPY_LIB_DEPENDS} \
			net/GeoIP \
			net/libbind
@


1.15
log
@Long overdue update to bro-2.4.1.
Take maintainer while here.

Only slightly tested so far; so may get a few tweaks in the next days if
needed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2016/03/01 00:07:17 sthen Exp $
d6 1
@


1.14
log
@bump (GeoIP pkgpath change)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2015/07/19 16:38:48 sthen Exp $
d3 1
a3 1
COMMENT=	highly flexible sniffer/NIDS
d5 1
a5 3
V=		1.4
DISTNAME=	bro-${V}-release
PKGNAME=	bro-${V}
d7 1
a7 1
REVISION=	6
d9 1
a9 1
SHARED_LIBS= 	broccoli	0.0	# .2.0
d11 1
a11 1
CATEGORIES=	net security
d13 1
a13 1
HOMEPAGE=	https://www.bro.org/
d18 2
a19 1
WANTLIB=	c crypto m pcap pthread ssl stdc++ termcap z GeoIP>=5 magic>=1
d21 1
a21 1
MASTER_SITES=	https://www.bro.org/downloads/archive/
d23 1
a23 2
LIB_DEPENDS=	net/GeoIP \
		devel/libmagic
d25 46
a70 8
CONFIGURE_STYLE=autoconf
AUTOCONF_VERSION=2.59

WRKDIST=	${WRKDIR}/bro-${V}

FAKE_FLAGS=	sysconfdir=${PREFIX}/share/examples/bro

NO_TEST=	Yes
@


1.13
log
@change SSLv3_method to SSLv23_method, not tested but the former isn't
going to work anyway.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2015/06/18 07:25:44 bentley Exp $
d9 1
a9 1
REVISION=	5
@


1.12
log
@Replace dead mirror and update homepage.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2015/03/16 18:07:51 naddy Exp $
d9 1
a9 1
REVISION=	4
@


1.11
log
@fold lib-only PFRAG.shared into PLIST, regen PLIST, and bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2015/01/21 06:23:34 bentley Exp $
d9 1
a9 1
REVISION=	3
d15 1
a15 1
HOMEPAGE=	http://www.bro-ids.org/
d22 1
a22 1
MASTER_SITES=	ftp://bro-ids.org/
@


1.10
log
@Remove Kevin Lo as maintainer, by request.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2014/11/05 11:43:59 sthen Exp $
d9 1
a9 1
REVISION=	2
@


1.9
log
@sync WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2014/09/13 16:36:54 ajacoutot Exp $
d9 1
a9 1
REVISION=	1
a15 2

MAINTAINER=	Kevin Lo <kevlo@@openbsd.org>
@


1.8
log
@--disable-gtk-doc is handled by the infrastructure now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2013/03/21 08:46:33 ajacoutot Exp $
d9 1
a9 1
REVISION=	0
d22 1
a22 1
WANTLIB=	c crypto m pcap ssl stdc++ termcap z GeoIP>=5 magic>=1
@


1.7
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2013/03/11 11:35:45 espie Exp $
a30 7

CONFIGURE_ARGS =--disable-gtk-doc
# If one of these tools is found at configure stage, it might be used,
# no matter whether we use --disable-gtk-doc or not.
CONFIGURE_ENV +=ac_cv_path_GTKDOC_CHECK="" \
		ac_cv_path_GTKDOC_REBASE="" \
		ac_cv_path_GTKDOC_MKPDF=""
@


1.6
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2013/03/03 08:12:05 landry Exp $
a28 1
USE_LIBTOOL=	Yes
@


1.5
log
@Properly disable gtk-doc, otherwise it's picked as a hidden dep during
build.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/11/19 22:31:32 espie Exp $
a20 3
PERMIT_PACKAGE_FTP=   	Yes
PERMIT_DISTFILES_CDROM= Yes
PERMIT_DISTFILES_FTP= 	Yes
d44 1
a44 1
NO_REGRESS=	Yes
@


1.4
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/11/11 11:54:08 espie Exp $
d35 7
@


1.3
log
@WANTLIB conversion
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/10/12 20:12:52 robert Exp $
d25 1
a25 1
WANTLIB=	c crypto m pcap ssl stdc++ termcap z GeoIP.>=5 magic.>=1
d29 2
a30 2
LIB_DEPENDS=	::net/GeoIP \
		::devel/libmagic
@


1.2
log
@Fix OpenSSL update fallout by using a diff from bro ticket #247
which checks and uses the correct API
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2008/12/17 01:34:53 kevlo Exp $
d25 1
a25 1
WANTLIB=	c crypto m pcap ssl stdc++ termcap z
d29 2
a30 2
LIB_DEPENDS=	GeoIP.>=5::net/GeoIP \
		magic.>=1::devel/libmagic
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d9 2
d33 2
a34 1
CONFIGURE_STYLE=gnu
@


1.1.1.1
log
@initial import of bro-1.4

Bro is an open-source, Unix-based Network Intrusion Detection
System (NIDS) that passively monitors network traffic and looks
for suspicious activity.

ok ajacoutot@@
@
text
@@
