head	1.7;
access;
symbols
	OPENBSD_6_0:1.7.0.2
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.4.0.4
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.6
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.3.0.2
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.2.0.6
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.4
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2;
locks; strict;
comment	@# @;


1.7
date	2016.07.10.12.07.26;	author sthen;	state Exp;
branches;
next	1.6;
commitid	vMWmPoCHP7FYHFsG;

1.6
date	2016.04.25.00.03.04;	author sthen;	state Exp;
branches;
next	1.5;
commitid	5utYeomCAHehWQKz;

1.5
date	2016.04.12.10.18.21;	author sthen;	state Exp;
branches;
next	1.4;
commitid	PFgHfO6ZJFMwblOY;

1.4
date	2014.11.05.15.42.09;	author sthen;	state Exp;
branches;
next	1.3;
commitid	r3Gb5UT6Agg7kLiO;

1.3
date	2014.07.22.10.55.41;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	3LzguPEQl5LkjlcD;

1.2
date	2013.01.06.07.54.13;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2013.01.05.22.52.07;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.7
log
@fix config path in readme, from Caspar Schutijser
@
text
@$OpenBSD: README,v 1.6 2016/04/25 00:03:04 sthen Exp $

+-----------------------------------------------------------------------
| Running ${FULLPKGNAME} on OpenBSD
+-----------------------------------------------------------------------

Basic configuration
===================

Smokeping is split into two main parts, the daemon (running the probes
and updating RRD files) and the part responsible for generating website
graphs.

Edit ${SYSCONFDIR}/config (at least add some hosts to
monitor) and enable the daemon:

    rcctl enable smokeping
    rcctl start smokeping

The simplest method to generate graphs is as static HTML and images.
There is no possibility to zoom into graphs interactively from the
browser, but it is easy to configure and might be quite acceptable.
Do this by running 'smokeping --static=/path/to/html-dir' from cron.

Alternatively it will run as a CGI/FastCGI script with a web server.
Smokeping itself doesn't work well with a chroot jail, but the script
can be run as a persistant process outside the jail, and communicate
with a chroot'ed webserver via FastCGI. The included smokeping_fcgi
rc script will start Smokeping ready to communicate over a FastCGI
UNIX socket /var/www/run/smokeping.sock. If you wish to use this
method, enable this:

    rcctl enable smokeping_fcgi
    rcctl start smokeping_fcgi

And configure your web server to access it - here is a sample
configuration section for use with nginx:

    location ~ /smokeping/smokeping.cgi$ {
	fastcgi_pass	unix:run/smokeping.sock;
	fastcgi_split_path_info ^(/cgi-bin/[^/]+)(.*);
	fastcgi_param	PATH_INFO $fastcgi_path_info;
	fastcgi_param	SCRIPT_FILENAME $fastcgi_script_name;
	include		fastcgi_params;
    }

Other probe types
=================

Smokeping is commonly used to perform ICMP monitoring using fping, but
also includes probes to monitor other protocols. Some have additional
dependencies which are not forcibly installed. Use pkg_add to install
the relevant packages if needed.

 RADIUS:	   p5-Authen-Radius
 TelnetIOSPing:	   p5-Net-Telnet
 OpenSSHEOSPing:   p5-Net-OpenSSH, p5-IO-Pty
 OpenSSHJunOSPing: p5-Net-OpenSSH, p5-IO-Pty
 AnotherDNS:	   p5-Net-DNS
 LDAP:		   p5-ldap, p5-IO-Socket-SSL

Advanced topic: Heavy load systems
==================================

If problems are seen with excessive load or i/o, it is possible to
configure Smokeping to use rrdcached instead. Read through the whole
section before starting; this is *not* needed for a typical setup.

To do this, group permissions should be set to allow Smokeping to
access the rrdcached socket, and to allow rrdcached to access
Smokeping's files, e.g.:

	$ grep _smokeping /etc/group
	_smokeping:*:562:_rrdcached
	_rrdcached:*:726:_smokeping

	# chgrp -R _rrdcached /var/db/smokeping
	# chmod -R g+w /var/db/smokeping

The rrdcached daemon must be running:

	# rcctl enable rrdcached
	# rcctl set rrdcached flags -b /var/db/smokeping -B -m 770 \
	    -l unix:/var/run/rrd/rrdcached.sock -j /var/db/smokeping/journal \
	    -p /var/run/rrd/rrdcached.pid
	# rcctl restart rrdcached

Smokeping must be told to use the daemon. This is done by setting an
environment variable; add this to /etc/login.conf:

smokeping:setenv=RRDCACHED_ADDRESS=unix\c/var/run/rrd/rrdcached.sock:tc=daemon

The Smokeping FastCGI script must also be told to use the daemon.
This is done by setting the variable in your web server. For nginx:

fastcgi_param  RRDCACHED_ADDRESS unix:/var/run/rrd/rrdcached.sock;

Then restart smokeping and smokeping_fcgi. Use -d to show more information
in case of errors at startup.

	# rcctl -d restart smokeping
	# rcctl -d restart smokeping_fcgi
@


1.6
log
@fix rcctl args
@
text
@d1 1
a1 1
$OpenBSD: README,v 1.5 2016/04/12 10:18:21 sthen Exp $
d14 1
a14 1
Edit ${SYSCONFDIR}/smokeping/config (at least add some hosts to
@


1.5
log
@add a section on using smokeping with rrdcached, mostly for large installations
@
text
@d1 1
a1 1
$OpenBSD: README,v 1.4 2014/11/05 15:42:09 sthen Exp $
d101 2
a102 2
	# rcctl restart -d smokeping
	# rcctl restart -d smokeping_fcgi
@


1.4
log
@update to smokeping 2.6.11
- add a new rc script to run as FastCGI
@
text
@d1 1
a1 1
$OpenBSD: README,v 1.3 2014/07/22 10:55:41 ajacoutot Exp $
d50 4
a53 3
Smokeping is commonly used to perform ICMP monitoring using fping,
but also includes probes to monitor other protocols. Some require
additional dependencies:
d61 42
@


1.3
log
@Tweak documentation according to recent rc changes.

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD: README,v 1.2 2013/01/06 07:54:13 ajacoutot Exp $
d10 3
a12 3
Symlink the sample apache config file into the modules directory:

# ln -s ../modules.sample/smokeping.conf /var/www/conf/modules/
d15 1
a15 4
monitor).

To have smokeping start at boot time, add "smokeping" to rc_scripts
in /etc/rc.conf.local, e.g.:
d17 2
a18 1
rc_scripts="${rc_scripts} smokeping"
d20 33
a52 2
To use probes other than the most common fping probe, you may need to
install additional packages:
d56 2
a57 1
 OpenSSHJunOSPing: p5-Net-OpenSSH
d59 1
a59 38
 LDAP:		   p5-ldap (and p5-IO-Socket-SSL for starttls)

chroot considerations
=====================

By default OpenBSD's httpd uses chroot(2) so that only files
within /var/www are accessible; this doesn't work with smokeping's
CGI scripts (at least without major work copying large parts of
Perl and Smokeping into the chroot jail). Simpler options are:

- Disable chroot by setting the following in /etc/rc.conf.local:
    httpd_flags=-u

- Create static HTML and images rather than allowing them to be
viewed/zoomed; do this by running 'smokeping --static=/path/to/html-dir'
from cron.

Alternatively, Smokeping now uses FastCGI, so it would be possible
to pass the requests across from a jailed httpd to a copy of Smokeping
running outside the jail. Please contact the port maintainer if you
have a working configuration for this which you would be willing to
share.


Remote sensors
==============

This feature requires that the userid running the webserver is
able to create new .cache files and write to existing .rrd files
under /var/db/smokeping. After adjusting the configuration file
and starting smokeping to generate the rrd files, adjust the
group ownership and permissions accordingly, e.g.

# chgrp -R www /var/db/smokeping/*
# chmod -R g+rwX /var/db/smokeping/*

This will need to be repeated if additional hosts are monitored
via remote sensors.
@


1.2
log
@Adapt to README.template.

ok sthen@@ (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: README,v 1.1 2013/01/05 22:52:07 sthen Exp $
d39 2
a40 1
- Disable chroot by setting httpd_flags="-u" in /etc/rc.conf.local
@


1.1
log
@update Smokeping to 2.6.8 and add an rc.d script

- note that the script file location has changed, it's probably simplest
to use the new sample httpd config.
@
text
@d1 1
a1 1
$OpenBSD$
d3 3
a5 2
Running Smokeping on OpenBSD
============================
d7 2
a8 2
Basic configuration:
--------------------
d32 1
a32 1
---------------------
d53 1
a53 1
--------------
@

