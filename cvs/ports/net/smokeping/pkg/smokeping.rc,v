head	1.5;
access;
symbols
	OPENBSD_6_1:1.5.0.8
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.6
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.4
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.1.0.8
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.6
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.4
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.2
	OPENBSD_5_3_BASE:1.1;
locks; strict;
comment	@ * @;


1.5
date	2015.07.15.23.17.11;	author sthen;	state Exp;
branches;
next	1.4;
commitid	gkSf9j5LijNYHgwC;

1.4
date	2014.11.12.12.19.13;	author sthen;	state Exp;
branches;
next	1.3;
commitid	EB6QT3emhBgCnhzH;

1.3
date	2014.11.07.23.56.23;	author sthen;	state Exp;
branches;
next	1.2;
commitid	UTL2ymaofLL2arU1;

1.2
date	2014.11.05.15.42.09;	author sthen;	state Exp;
branches;
next	1.1;
commitid	r3Gb5UT6Agg7kLiO;

1.1
date	2013.01.05.22.52.07;	author sthen;	state Exp;
branches
	1.1.8.1;
next	;

1.1.8.1
date	2014.11.07.23.48.59;	author sthen;	state Exp;
branches;
next	;
commitid	X0KNZ2NlPSLtbA4m;


desc
@@


1.5
log
@handle rc.subr pexp changes
@
text
@#!/bin/sh
#
# $OpenBSD: smokeping.rc,v 1.4 2014/11/12 12:19:13 sthen Exp $

daemon="${TRUEPREFIX}/bin/smokeping"
daemon_user="_smokeping"

. /etc/rc.d/rc.subr

# N.B. If adjusting, has to match single and multi process modes, but not cgi  
pexp="(perl:|/usr/bin/perl) ${daemon}( .*|$)"

rc_pre() {
	install -d -o _smokeping /var/run/smokeping
}

rc_cmd $1
@


1.4
log
@adjust pexp again; it has to match various different modes. single-process -
perl: /usr/local/bin/smokeping [FPing]

multi-process -
perl: /usr/local/bin/smokeping [AnotherDNS]
perl: /usr/local/bin/smokeping [FPing]
/usr/bin/perl /usr/local/bin/smokeping

and not "/usr/bin/perl /usr/local/bin/smokeping_cgi". Not optimal as this
should signal only the master process when in multi-process mode, but that
can't be arranged with rc.subr's pgrep scheme (sometimes there are
advantages to pidfiles).
@
text
@d3 1
a3 1
# $OpenBSD: smokeping.rc,v 1.3 2014/11/07 23:56:23 sthen Exp $
d11 1
a11 1
pexp="(perl:|/usr/bin/perl) ${daemon}( |$)"
@


1.3
log
@tweak pexp to match only the main smokeping process, not subprocesses or the cgi
@
text
@d3 1
a3 1
# $OpenBSD: smokeping.rc,v 1.2 2014/11/05 15:42:09 sthen Exp $
d10 2
a11 1
pexp="/usr/bin/perl ${daemon}${daemon_flags:+ ${daemon_flags}}\$"
@


1.2
log
@update to smokeping 2.6.11
- add a new rc script to run as FastCGI
@
text
@d3 1
a3 1
# $OpenBSD: smokeping.rc,v 1.1 2013/01/05 22:52:07 sthen Exp $
d10 1
a10 1
pexp="perl: ${daemon}"
@


1.1
log
@update Smokeping to 2.6.8 and add an rc.d script

- note that the script file location has changed, it's probably simplest
to use the new sample httpd config.
@
text
@d3 1
a3 1
# $OpenBSD$
d6 1
@


1.1.8.1
log
@fix startup problem in smokeping on 5.6 reported by Lars Hecking
@
text
@d3 1
a3 1
# $OpenBSD: smokeping.rc,v 1.1 2013/01/05 22:52:07 sthen Exp $
a5 1
daemon_user="_smokeping"
d9 1
a9 1
pexp="/usr/bin/perl ${daemon}${daemon_flags:+ ${daemon_flags}}\$"
@


