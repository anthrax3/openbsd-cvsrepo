head	1.4;
access;
symbols;
locks; strict;
comment	@# @;


1.4
date	2014.02.07.08.56.53;	author brad;	state dead;
branches;
next	1.3;

1.3
date	2014.01.25.05.27.13;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2008.06.09.14.29.17;	author ckuethe;	state dead;
branches;
next	1.1;

1.1
date	2008.05.17.22.33.31;	author ckuethe;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to darkstat 3.0.718.

- Contains additional time_t related fixes.
- The author removed an assertion in timer_stop() I had run into and even
  though monotonic time is used somehow time went backwards.
- Change the rc.d script to use localhost instead of 127.0.0.1 to have
  darkstat also bind to the v6 address.

ok sthen@@
@
text
@$OpenBSD: patch-graph_db_c,v 1.3 2014/01/25 05:27:13 brad Exp $
--- graph_db.c.orig	Mon Jan 20 16:27:36 2014
+++ graph_db.c	Mon Jan 20 16:15:04 2014
@@@@ -47,7 +48,7 @@@@ static struct graph *graph_db[] = {
 };
 
 static unsigned int graph_db_size = sizeof(graph_db)/sizeof(*graph_db);
-static long start_mono, start_real, last_real;
+static time_t start_mono, start_real, last_real;
 
 void graph_init(void) {
    unsigned int i;
@@@@ -169,7 +170,7 @@@@ static void graph_resync(const time_t new_real) {
 }
 
 void graph_rotate(void) {
-   long t, td;
+   time_t t, td;
    struct tm *tm;
    unsigned int i;
 
@@@@ -287,7 +288,7 @@@@ struct str *html_front_page(void) {
    struct str *buf, *rf;
    unsigned int i;
    char start_when[100];
-   long d_real, d_mono;
+   time_t d_real, d_mono;
 
    buf = str_make();
    html_open(buf, "Graphs", /*path_depth=*/0, /*want_graph_js=*/1);
@


1.3
log
@An attempt at trying to fix the time_t related issues with darkstat. Replace
some long's with time_t. Fixes darkstat on 32-bit archs.

From Remi Locherer

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@update to darkstat 3.0.708, mostly concerned with decreased memory usage.
all local patches merged upstream.
@
text
@d1 5
a5 6
$OpenBSD: patch-graph_db_c,v 1.1 2008/05/17 22:33:31 ckuethe Exp $
--- graph_db.c.orig	Fri May 16 13:23:14 2008
+++ graph_db.c	Fri May 16 13:41:43 2008
@@@@ -27,6 +27,8 @@@@
 #define GRAPH_WIDTH "320"
 #define GRAPH_HEIGHT "200"
d7 3
a9 6
+extern const char *interface;
+
 struct graph {
    uint64_t *in, *out;
    unsigned int offset; /* i.e. seconds start at 0, days start at 1 */
@@@@ -348,11 +350,12 @@@@ html_front_page(void)
d11 10
a20 10
    buf = str_make();
    str_append(buf, html_header_1);
-   str_append(buf, "<title>" PACKAGE_STRING " : graphs</title>\n");
+   str_appendf(buf, "<title>" PACKAGE_STRING " : graphs (%s)</title>\n",
+               interface);
    str_append(buf, "<script src=\"graph.js\" type=\"text/javascript\">"
                    "</script>\n");
    str_append(buf, html_header_2);
-   str_append(buf, "<h2 class=\"pageheader\">Graphs</h2>\n");
+   str_appendf(buf, "<h2 class=\"pageheader\">Graphs (%s)</h2>\n", interface);
d22 6
a27 1
    str_append(buf, "<p>\n");
d29 2
@


1.1
log
@add the interface name to the title and report header. this is quite
useful when you're running darkstat on a box with 3 network feeds...
@
text
@d1 1
a1 1
$OpenBSD$
@

