head	1.1;
access;
symbols
	OPENBSD_5_2:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2013.01.14.12.26.25;	author sthen;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2013.01.14.12.26.25;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-cgi_history_c was initially added on branch OPENBSD_5_2.
@
text
@@


1.1.2.1
log
@Add a patch for CVE-2012-6096 to nagios in -stable, stack-based buffer overflow in history.cgi
@
text
@a0 44
$OpenBSD$

CVE-2012-6096. And yay, ^M shit in the source files, a sign of quality crafted code!

--- cgi/history.c.orig	Mon Jan 14 12:18:14 2013
+++ cgi/history.c	Mon Jan 14 12:20:49 2013
@@@@ -805,16 +805,16 @@@@ void get_history(void) {
 			else if(display_type == DISPLAY_HOSTS) {
 
 				if(history_type == HOST_HISTORY || history_type == SERVICE_HISTORY) {
-					sprintf(match1, " HOST ALERT: %s;", host_name);
-					sprintf(match2, " SERVICE ALERT: %s;", host_name);
+					snprintf(match1, sizeof(match1), " HOST ALERT: %s;", host_name);
+					snprintf(match2, sizeof(match2), " SERVICE ALERT: %s;", host_name);
 					}
 				else if(history_type == HOST_FLAPPING_HISTORY || history_type == SERVICE_FLAPPING_HISTORY) {
-					sprintf(match1, " HOST FLAPPING ALERT: %s;", host_name);
-					sprintf(match2, " SERVICE FLAPPING ALERT: %s;", host_name);
+					snprintf(match1, sizeof(match1), " HOST FLAPPING ALERT: %s;", host_name);
+					snprintf(match2, sizeof(match2), " SERVICE FLAPPING ALERT: %s;", host_name);
 					}
 				else if(history_type == HOST_DOWNTIME_HISTORY || history_type == SERVICE_DOWNTIME_HISTORY) {
-					sprintf(match1, " HOST DOWNTIME ALERT: %s;", host_name);
-					sprintf(match2, " SERVICE DOWNTIME ALERT: %s;", host_name);
+					snprintf(match1, sizeof(match1), " HOST DOWNTIME ALERT: %s;", host_name);
+					snprintf(match2, sizeof(match2), " SERVICE DOWNTIME ALERT: %s;", host_name);
 					}
 
 				if(show_all_hosts == TRUE)
@@@@ -853,11 +853,11 @@@@ void get_history(void) {
 			else if(display_type == DISPLAY_SERVICES) {
 
 				if(history_type == SERVICE_HISTORY)
-					sprintf(match1, " SERVICE ALERT: %s;%s;", host_name, svc_description);
+					snprintf(match1, sizeof(match1), " SERVICE ALERT: %s;%s;", host_name, svc_description);
 				else if(history_type == SERVICE_FLAPPING_HISTORY)
-					sprintf(match1, " SERVICE FLAPPING ALERT: %s;%s;", host_name, svc_description);
+					snprintf(match1, sizeof(match1), " SERVICE FLAPPING ALERT: %s;%s;", host_name, svc_description);
 				else if(history_type == SERVICE_DOWNTIME_HISTORY)
-					sprintf(match1, " SERVICE DOWNTIME ALERT: %s;%s;", host_name, svc_description);
+					snprintf(match1, sizeof(match1), " SERVICE DOWNTIME ALERT: %s;%s;", host_name, svc_description);
 
 				if(strstr(temp_buffer, match1) && (history_type == SERVICE_HISTORY || history_type == SERVICE_FLAPPING_HISTORY || history_type == SERVICE_DOWNTIME_HISTORY))
 					display_line = TRUE;
@

