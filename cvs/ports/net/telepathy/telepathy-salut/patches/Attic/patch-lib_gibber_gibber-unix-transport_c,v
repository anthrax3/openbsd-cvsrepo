head	1.5;
access;
symbols
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2;
locks; strict;
comment	@# @;


1.5
date	2010.09.24.13.09.57;	author ajacoutot;	state dead;
branches;
next	1.4;

1.4
date	2010.09.23.15.04.01;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2010.09.23.13.47.35;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2010.04.23.13.49.24;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2010.04.23.12.43.44;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Remove unused patch, this code path is ifdef __linux
@
text
@$OpenBSD: patch-lib_gibber_gibber-unix-transport_c,v 1.4 2010/09/23 15:04:01 jasper Exp $

- OpenBSD lacks two defines (should they move to sys/socket.h ?)
- OpenBSD's struct ucred doesn't have a pid member.

--- lib/gibber/gibber-unix-transport.c.orig	Wed Aug 18 09:52:58 2010
+++ lib/gibber/gibber-unix-transport.c	Thu Sep 23 17:01:03 2010
@@@@ -22,6 +22,13 @@@@
 /* needed for struct ucred */
 #define _GNU_SOURCE
 
+#include <sys/types.h>
+#include <sys/param.h>
+#include <sys/uio.h>
+#include <netinet/in.h>
+#include <sys/socket.h>
+#include <sys/ucred.h>
+
 #include <glib.h>
 
 #ifdef G_OS_UNIX
@@@@ -34,9 +41,6 @@@@
 #include <fcntl.h>
 #include <string.h>
 #include <errno.h>
-#include <sys/types.h>
-#include <sys/socket.h>
-#include <sys/un.h>
 
 #include "gibber-unix-transport.h"
 #include "gibber-util.h"
@@@@ -44,6 +48,14 @@@@
 #define DEBUG_FLAG DEBUG_NET
 #include "gibber-debug.h"
 
+#ifndef SCM_CREDENTIALS
+#  define SCM_CREDENTIALS	0x9001
+#endif
+
+#ifndef SO_PASSCRED
+#  define SO_PASSCRED	0x9002
+#endif
+
 G_DEFINE_TYPE(GibberUnixTransport, gibber_unix_transport, \
     GIBBER_TYPE_FD_TRANSPORT)
 
@@@@ -245,9 +257,14 @@@@ gibber_unix_transport_send_credentials (GibberUnixTran
   ch->cmsg_type = SCM_CREDENTIALS;
 
   cred = (struct ucred *) CMSG_DATA (ch);
+#ifndef __OpenBSD__
   cred->pid = getpid ();
   cred->uid = getuid ();
   cred->gid = getgid ();
+#else
+  cred->cr_uid = getuid ();
+  cred->cr_gid = getgid ();
+#endif
 
   ret = sendmsg (fd, &msg, 0);
   if (ret == -1)
@@@@ -344,9 +361,15 @@@@ gibber_unix_transport_read (GibberFdTransport *transpo
       GibberCredentials credentials;
 
       cred = (struct ucred *) CMSG_DATA (ch);
+#ifndef __OpenBSD__
       credentials.pid = cred->pid;
       credentials.uid = cred->uid;
       credentials.gid = cred->gid;
+#else
+      credentials.pid = getpid();
+      credentials.uid = cred->cr_uid;
+      credentials.gid = cred->cr_gid;
+#endif
 
       priv->recv_creds_cb (self, &buf, &credentials, NULL,
           priv->recv_creds_data);
@


1.4
log
@- tweak this patch and add a comment
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_gibber_gibber-unix-transport_c,v 1.3 2010/09/23 13:47:35 jasper Exp $
@


1.3
log
@- update telepathy-salut to 0.3.13
@
text
@d1 7
a7 3
$OpenBSD: patch-lib_gibber_gibber-unix-transport_c,v 1.2 2010/04/23 13:49:24 jasper Exp $
--- lib/gibber/gibber-unix-transport.c.orig	Tue Sep 21 20:16:36 2010
+++ lib/gibber/gibber-unix-transport.c	Tue Sep 21 20:18:38 2010
d32 1
a32 1
@@@@ -44,6 +48,9 @@@@
d36 7
a42 2
+#define SCM_CREDENTIALS	0x9001
+#define SO_PASSCRED	0x9002
d47 1
a47 1
@@@@ -245,9 +252,8 @@@@ gibber_unix_transport_send_credentials (GibberUnixTran
d51 5
a55 3
-  cred->pid = getpid ();
-  cred->uid = getuid ();
-  cred->gid = getgid ();
d58 1
d62 1
a62 1
@@@@ -344,9 +350,9 @@@@ gibber_unix_transport_read (GibberFdTransport *transpo
d66 5
a70 3
-      credentials.pid = cred->pid;
-      credentials.uid = cred->uid;
-      credentials.gid = cred->gid;
d74 1
@


1.2
log
@- fix include mess
@
text
@d1 4
a4 4
$OpenBSD: patch-lib_gibber_gibber-unix-transport_c,v 1.1 2010/04/23 12:43:44 jasper Exp $
--- lib/gibber/gibber-unix-transport.c.orig	Mon Mar 22 00:13:59 2010
+++ lib/gibber/gibber-unix-transport.c	Fri Apr 23 15:47:59 2010
@@@@ -22,15 +22,19 @@@@
d15 4
a18 3
 #include <stdio.h>
 #include <stdlib.h>
 #include <unistd.h>
d28 1
a28 1
@@@@ -38,6 +42,9 @@@@
d38 1
a38 1
@@@@ -227,9 +234,8 @@@@ gibber_unix_transport_send_credentials (GibberUnixTran
d50 1
a50 1
@@@@ -326,9 +332,9 @@@@ gibber_unix_transport_read (GibberFdTransport *transpo
@


1.1
log
@- update telepathy-salut to 0.3.11
@
text
@d1 4
a4 4
$OpenBSD$
--- lib/gibber/gibber-unix-transport.c.orig	Thu Apr 22 17:42:08 2010
+++ lib/gibber/gibber-unix-transport.c	Thu Apr 22 18:04:21 2010
@@@@ -22,15 +22,21 @@@@
a8 1
+#include <sys/socket.h>
a9 3
+#include <sys/un.h>
+#include <sys/ucred.h>
+#include <sys/socket.h>
d12 2
d27 1
a27 1
@@@@ -38,6 +44,9 @@@@
d37 1
a37 1
@@@@ -227,9 +236,8 @@@@ gibber_unix_transport_send_credentials (GibberUnixTran
d49 1
a49 1
@@@@ -326,9 +334,9 @@@@ gibber_unix_transport_read (GibberFdTransport *transpo
@

