head	1.5;
access;
symbols
	OPENBSD_6_0:1.5.0.2
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.4
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.3.0.6
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.4
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.2
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2016.05.02.02.28.46;	author lteo;	state Exp;
branches;
next	1.4;
commitid	EM4Qjg0BlxRy9Q7r;

1.4
date	2015.05.29.03.27.27;	author lteo;	state Exp;
branches;
next	1.3;
commitid	XBJboLGIkHz5CC0A;

1.3
date	2014.01.30.03.22.48;	author lteo;	state Exp;
branches;
next	1.2;

1.2
date	2013.08.21.02.21.15;	author lteo;	state Exp;
branches;
next	1.1;

1.1
date	2013.07.17.18.18.05;	author lteo;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update to DAQ 2.0.6.

ok maintainer Markus Lude (who had the same diff)
@
text
@$OpenBSD: patch-os-daq-modules_daq_ipfw_c,v 1.4 2015/05/29 03:27:27 lteo Exp $

This patch removes DAQ_CAPA_UNPRIV_START from the list of capabilities so that
Snort can run as an unprivileged user in inline mode.  Sent upstream:
http://marc.info/?l=snort-devel&m=136254358118711&w=2

--- os-daq-modules/daq_ipfw.c.orig	Tue Sep  9 15:57:31 2014
+++ os-daq-modules/daq_ipfw.c	Fri Apr 29 10:54:35 2016
@@@@ -403,7 +403,7 @@@@ static int ipfw_daq_get_snaplen (void* handle)
 static uint32_t ipfw_daq_get_capabilities (void* handle)
 {
     return DAQ_CAPA_BLOCK | DAQ_CAPA_REPLACE | DAQ_CAPA_INJECT | DAQ_CAPA_INJECT_RAW
-        | DAQ_CAPA_BREAKLOOP | DAQ_CAPA_UNPRIV_START | DAQ_CAPA_BPF;
+        | DAQ_CAPA_BREAKLOOP | DAQ_CAPA_BPF;
 }
 
 static int ipfw_daq_get_datalink_type(void *handle)
@


1.4
log
@Update to DAQ 2.0.5, from maintainer Markus Lude.

Tested with Snort 2.9.7.3 (which will be committed soon) by maintainer
and myself.
@
text
@d1 1
a1 1
$OpenBSD: patch-os-daq-modules_daq_ipfw_c,v 1.3 2014/01/30 03:22:48 lteo Exp $
d7 3
a9 3
--- os-daq-modules/daq_ipfw.c.orig	Thu Apr 23 02:15:57 2015
+++ os-daq-modules/daq_ipfw.c	Sun May 24 16:51:39 2015
@@@@ -404,7 +404,7 @@@@ static int ipfw_daq_get_snaplen (void* handle)
@


1.3
log
@Update to DAQ 2.0.2, from maintainer Markus Lude.

Tested with Snort 2.9.6.0 (which will be committed soon) on sparc64 by
maintainer and on amd64 and macppc by myself.
@
text
@d1 1
a1 1
$OpenBSD: patch-os-daq-modules_daq_ipfw_c,v 1.2 2013/08/21 02:21:15 lteo Exp $
d7 3
a9 3
--- os-daq-modules/daq_ipfw.c.orig	Tue Nov  5 16:00:32 2013
+++ os-daq-modules/daq_ipfw.c	Thu Jan 23 22:05:29 2014
@@@@ -403,7 +403,7 @@@@ static int ipfw_daq_get_snaplen (void* handle)
@


1.2
log
@Update to DAQ 2.0.1, maintainer timeout

Upstream has accepted one of my IPFW DAQ fixes, so update the patch file
accordingly.

Tested with Snort 2.9.5.3 (which will be committed shortly) on amd64 and
i386.  Before the 64-bit time_t change, it was also tested on amd64 and
i386 (by myself and Adam Jeanguenat) and on macppc.
@
text
@d1 1
a1 1
$OpenBSD: patch-os-daq-modules_daq_ipfw_c,v 1.1 2013/07/17 18:18:05 lteo Exp $
d7 3
a9 3
--- os-daq-modules/daq_ipfw.c.orig	Mon Jul  1 12:44:59 2013
+++ os-daq-modules/daq_ipfw.c	Mon Aug  5 14:33:20 2013
@@@@ -401,7 +401,7 @@@@ static int ipfw_daq_get_snaplen (void* handle)
@


1.1
log
@Fix two bugs in the IPFW DAQ module that prevented Snort from running
properly in inline mode:

1. A bug in ipfw_daq_inject() ignores the buf and len arguments that are
   passed to it.  This prevents Snort inline mode from dropping/rejecting
   packets that match "drop" or "reject" rules.

2. Remove DAQ_CAPA_UNPRIV_START from the list of capabilities so that
   Snort can run as an unprivileged user when using the IPFW DAQ module.

Tested by myself and Adam Jeanguenat.  Received guidance from sthen@@.
Both fixes have been sent upstream.
@
text
@d1 1
a1 1
$OpenBSD$
d3 3
a5 2
This patch fixes two issues in the IPFW DAQ module that is used by
Snort in inline mode (both fixes have been sent upstream):
d7 3
a9 20
1. Fixes a bug where ipfw_daq_inject() ignores the buf and len
   arguments that are passed to it, causing packet injections to fail
   http://marc.info/?l=snort-devel&m=136185602610571&w=2

2. Removes DAQ_CAPA_UNPRIV_START from the list of capabilities so that
   Snort can run as an unprivileged user in inline mode
   http://marc.info/?l=snort-devel&m=136254358118711&w=2

--- os-daq-modules/daq_ipfw.c.orig	Thu Sep  6 11:17:26 2012
+++ os-daq-modules/daq_ipfw.c	Fri May 31 17:26:38 2013
@@@@ -256,7 +256,7 @@@@ static int ipfw_daq_inject (
     int reverse)
 {
     IpfwImpl* impl = (IpfwImpl*)handle;
-    int status = ipfw_daq_forward(impl, hdr, impl->buf, hdr->pktlen, 0);
+    int status = ipfw_daq_forward(impl, hdr, buf, len, 0);
 
     if ( status == DAQ_SUCCESS )
         impl->stats.packets_injected++;
@@@@ -397,7 +397,7 @@@@ static int ipfw_daq_get_snaplen (void* handle)
@

