head	1.241;
access;
symbols
	OPENBSD_6_1:1.235.0.2
	OPENBSD_6_1_BASE:1.235
	OPENBSD_6_0:1.227.0.2
	OPENBSD_6_0_BASE:1.227
	OPENBSD_5_9:1.215.0.2
	OPENBSD_5_9_BASE:1.215
	OPENBSD_5_8:1.201.0.4
	OPENBSD_5_8_BASE:1.201
	OPENBSD_5_7:1.200.0.2
	OPENBSD_5_7_BASE:1.200
	OPENBSD_5_6:1.195.0.2
	OPENBSD_5_6_BASE:1.195
	OPENBSD_5_5:1.190.0.2
	OPENBSD_5_5_BASE:1.190
	OPENBSD_5_4:1.186.0.2
	OPENBSD_5_4_BASE:1.186
	OPENBSD_5_3:1.177.0.2
	OPENBSD_5_3_BASE:1.177
	OPENBSD_5_2:1.166.0.2
	OPENBSD_5_2_BASE:1.166
	OPENBSD_5_1_BASE:1.154
	OPENBSD_5_1:1.154.0.2
	OPENBSD_5_0:1.147.0.2
	OPENBSD_5_0_BASE:1.147
	OPENBSD_4_9:1.132.0.2
	OPENBSD_4_9_BASE:1.132
	OPENBSD_4_8:1.120.0.2
	OPENBSD_4_8_BASE:1.120
	OPENBSD_4_7:1.110.0.2
	OPENBSD_4_7_BASE:1.110
	OPENBSD_4_6:1.105.0.2
	OPENBSD_4_6_BASE:1.105
	OPENBSD_4_5:1.100.0.2
	OPENBSD_4_5_BASE:1.100
	OPENBSD_4_4:1.94.0.2
	OPENBSD_4_4_BASE:1.94
	OPENBSD_4_3:1.89.0.2
	OPENBSD_4_3_BASE:1.89
	OPENBSD_4_2:1.85.0.2
	OPENBSD_4_2_BASE:1.85
	OPENBSD_4_1:1.79.0.2
	OPENBSD_4_1_BASE:1.79
	OPENBSD_4_0:1.68.0.2
	OPENBSD_4_0_BASE:1.68
	OPENBSD_3_9:1.67.0.2
	OPENBSD_3_9_BASE:1.67
	OPENBSD_3_8:1.54.0.2
	OPENBSD_3_8_BASE:1.54
	OPENBSD_3_7:1.49.0.14
	OPENBSD_3_7_BASE:1.49
	OPENBSD_3_6:1.49.0.12
	OPENBSD_3_6_BASE:1.49
	OPENBSD_3_5:1.49.0.10
	OPENBSD_3_5_BASE:1.49
	OPENBSD_3_4:1.49.0.8
	OPENBSD_3_4_BASE:1.49
	OPENBSD_3_3:1.49.0.6
	OPENBSD_3_3_BASE:1.49
	OPENBSD_3_2:1.49.0.4
	OPENBSD_3_2_BASE:1.49
	OPENBSD_3_1:1.49.0.2
	OPENBSD_3_1_BASE:1.49
	OPENBSD_3_0:1.44.0.2
	OPENBSD_3_0_BASE:1.44
	OPENBSD_2_9_TRACKING_SWITCH:1.42
	OPENBSD_2_9:1.37.0.2
	OPENBSD_2_9_BASE:1.37
	OPENBSD_2_8:1.33.0.2
	OPENBSD_2_8_BASE:1.33
	OPENBSD_2_7:1.31.0.2
	OPENBSD_2_7_BASE:1.31
	OPENBSD_2_6:1.21.0.2
	OPENBSD_2_6_BASE:1.21
	OPENBSD_2_5:1.17.0.2
	OPENBSD_2_5_BASE:1.17
	OPENBSD_2_4:1.15.0.2
	OPENBSD_2_4_BASE:1.15
	form_980505:1.1.1.2
	form_980504:1.1.1.2
	form:1.1.1
	OPENBSD_2_3:1.6.0.2
	OPENBSD_2_3_BASE:1.6
	samba_1_9_17:1.1.1.1
	samba:1.1.1;
locks; strict;
comment	@# @;


1.241
date	2017.09.25.13.26.52;	author jca;	state Exp;
branches;
next	1.240;
commitid	YsnHkY0m8hspNYET;

1.240
date	2017.09.23.22.59.18;	author jca;	state Exp;
branches;
next	1.239;
commitid	Kpzi2XbATO4SCvs3;

1.239
date	2017.09.18.11.52.04;	author jca;	state Exp;
branches;
next	1.238;
commitid	lsnPYM6tqWVwzdM5;

1.238
date	2017.07.13.00.52.29;	author jca;	state Exp;
branches;
next	1.237;
commitid	ux5uITLBoW2ggnih;

1.237
date	2017.05.24.11.58.29;	author jca;	state Exp;
branches;
next	1.236;
commitid	G2hBrT9A3788czfM;

1.236
date	2017.05.16.08.45.32;	author ajacoutot;	state Exp;
branches;
next	1.235;
commitid	nLFY3zu9TSsIVchq;

1.235
date	2017.04.01.11.37.38;	author jca;	state Exp;
branches
	1.235.2.1;
next	1.234;
commitid	aUqGYwdX0VF58z0d;

1.234
date	2017.03.25.17.00.01;	author jca;	state Exp;
branches;
next	1.233;
commitid	ZUWFhcrst9V2kUGH;

1.233
date	2017.03.16.09.53.33;	author jca;	state Exp;
branches;
next	1.232;
commitid	EoyXqHytSKEX7LO6;

1.232
date	2016.12.20.14.15.11;	author jca;	state Exp;
branches;
next	1.231;
commitid	94BVBlOUCZtpkwyy;

1.231
date	2016.12.19.10.12.18;	author jca;	state Exp;
branches;
next	1.230;
commitid	eEZAlJyzgHaG8rtn;

1.230
date	2016.11.11.15.16.57;	author ajacoutot;	state Exp;
branches;
next	1.229;
commitid	IuXHv16EopAC3gjY;

1.229
date	2016.11.09.15.59.37;	author jca;	state Exp;
branches;
next	1.228;
commitid	OorcGvxn91N3xC0g;

1.228
date	2016.09.12.15.38.22;	author jca;	state Exp;
branches;
next	1.227;
commitid	rmRFiRYRiZR7rtEA;

1.227
date	2016.07.08.18.39.50;	author jca;	state Exp;
branches
	1.227.2.1;
next	1.226;
commitid	cu9P1WErla0hiV84;

1.226
date	2016.07.06.16.43.16;	author jca;	state Exp;
branches;
next	1.225;
commitid	vKfDwyYx8SM7rweG;

1.225
date	2016.05.15.01.10.07;	author jca;	state Exp;
branches;
next	1.224;
commitid	ER3ugd2YDux6Um7Q;

1.224
date	2016.05.06.11.34.41;	author jca;	state Exp;
branches;
next	1.223;
commitid	vg0COUAVw4eQ7eNx;

1.223
date	2016.04.25.15.01.29;	author jca;	state Exp;
branches;
next	1.222;
commitid	ck9OZP9QPB0OulUk;

1.222
date	2016.04.25.08.58.10;	author jca;	state Exp;
branches;
next	1.221;
commitid	PJVy0Vae2AQg2voD;

1.221
date	2016.04.22.11.48.36;	author jca;	state Exp;
branches;
next	1.220;
commitid	i7xEeasW0hmVMIQY;

1.220
date	2016.04.13.11.25.40;	author jca;	state Exp;
branches;
next	1.219;
commitid	tYJixPZGzdU1MChG;

1.219
date	2016.04.12.17.42.09;	author jca;	state Exp;
branches;
next	1.218;
commitid	UGRk8kk9vV3gDO72;

1.218
date	2016.03.23.19.08.15;	author jca;	state Exp;
branches;
next	1.217;
commitid	siLLCHU0ssttyqrn;

1.217
date	2016.03.20.15.58.26;	author naddy;	state Exp;
branches;
next	1.216;
commitid	kD9ZPBluLnwfHdUE;

1.216
date	2016.03.09.19.40.11;	author jca;	state Exp;
branches;
next	1.215;
commitid	EN6cdXsl2FGbrNBW;

1.215
date	2016.01.18.12.10.51;	author sthen;	state Exp;
branches
	1.215.2.1;
next	1.214;
commitid	ZSmriDgduq04C4Hr;

1.214
date	2016.01.17.17.29.10;	author sthen;	state Exp;
branches;
next	1.213;
commitid	bS2FIbTCCkF3XjOq;

1.213
date	2015.12.23.12.37.21;	author jca;	state Exp;
branches;
next	1.212;
commitid	pugbUhllVsLWHDDm;

1.212
date	2015.11.29.15.50.20;	author ajacoutot;	state Exp;
branches;
next	1.211;
commitid	R4zDyQEPMusoKaj3;

1.211
date	2015.10.15.16.57.19;	author jca;	state Exp;
branches;
next	1.210;
commitid	NaCALSzJDzw3MKwP;

1.210
date	2015.09.30.18.16.14;	author jca;	state Exp;
branches;
next	1.209;
commitid	2kwq3dm9deHJsBom;

1.209
date	2015.09.11.11.35.09;	author jca;	state Exp;
branches;
next	1.208;
commitid	giqFujuzyBEsJczZ;

1.208
date	2015.08.26.18.05.31;	author jca;	state Exp;
branches;
next	1.207;
commitid	iXVZJmdqhf7kl7Wj;

1.207
date	2015.08.25.15.38.16;	author jca;	state Exp;
branches;
next	1.206;
commitid	CehUBjtPs0RZ0tXV;

1.206
date	2015.08.25.12.03.21;	author ajacoutot;	state Exp;
branches;
next	1.205;
commitid	9yVXPDtSde9PTQPj;

1.205
date	2015.08.25.11.41.15;	author jca;	state Exp;
branches;
next	1.204;
commitid	rLIhgY9u26eBpYOR;

1.204
date	2015.08.25.11.10.41;	author jca;	state Exp;
branches;
next	1.203;
commitid	RNTF7UuKQDzknHuD;

1.203
date	2015.08.25.11.07.45;	author jca;	state Exp;
branches;
next	1.202;
commitid	VAHTI6fMMPysailI;

1.202
date	2015.08.25.11.04.39;	author jca;	state Exp;
branches;
next	1.201;
commitid	jWHBCzKs5xKamlhw;

1.201
date	2015.07.07.14.43.36;	author ajacoutot;	state Exp;
branches;
next	1.200;
commitid	WQPaMXMumvuZgEof;

1.200
date	2015.02.25.01.37.49;	author jca;	state Exp;
branches;
next	1.199;
commitid	CphfFwcm1N2dhc1T;

1.199
date	2015.02.17.22.08.36;	author sthen;	state Exp;
branches;
next	1.198;
commitid	xaIHtCntkggL7CxN;

1.198
date	2015.02.05.02.04.00;	author jca;	state Exp;
branches;
next	1.197;
commitid	ObTuNRrOD6GDuh90;

1.197
date	2015.02.04.11.50.21;	author jca;	state Exp;
branches;
next	1.196;
commitid	4Ub0OhLT6Bclu38O;

1.196
date	2014.12.08.10.57.09;	author ajacoutot;	state Exp;
branches;
next	1.195;
commitid	pz71RdO0gxd0iylf;

1.195
date	2014.07.11.16.20.37;	author ajacoutot;	state Exp;
branches
	1.195.2.1;
next	1.194;
commitid	CySj5hGosumaE9xL;

1.194
date	2014.07.10.13.09.06;	author ajacoutot;	state Exp;
branches;
next	1.193;
commitid	Xpirey71VpT09196;

1.193
date	2014.06.26.11.43.54;	author sthen;	state Exp;
branches;
next	1.192;
commitid	FE5sCsVNlwiWgw8A;

1.192
date	2014.04.21.22.24.17;	author sthen;	state Exp;
branches;
next	1.191;

1.191
date	2014.04.10.00.50.58;	author brad;	state Exp;
branches;
next	1.190;

1.190
date	2014.02.06.04.33.24;	author brad;	state Exp;
branches
	1.190.2.1;
next	1.189;

1.189
date	2013.12.05.13.08.50;	author nigel;	state Exp;
branches;
next	1.188;

1.188
date	2013.10.06.22.00.48;	author brad;	state Exp;
branches;
next	1.187;

1.187
date	2013.09.18.04.48.52;	author kirby;	state Exp;
branches;
next	1.186;

1.186
date	2013.06.20.06.54.37;	author ajacoutot;	state Exp;
branches
	1.186.2.1;
next	1.185;

1.185
date	2013.06.17.19.30.53;	author ajacoutot;	state Exp;
branches;
next	1.184;

1.184
date	2013.05.21.18.08.58;	author brad;	state Exp;
branches;
next	1.183;

1.183
date	2013.05.03.18.43.28;	author sthen;	state Exp;
branches;
next	1.182;

1.182
date	2013.05.03.03.06.08;	author brad;	state Exp;
branches;
next	1.181;

1.181
date	2013.04.27.15.44.21;	author ajacoutot;	state Exp;
branches;
next	1.180;

1.180
date	2013.03.29.18.13.31;	author ajacoutot;	state Exp;
branches;
next	1.179;

1.179
date	2013.03.28.15.26.47;	author brad;	state Exp;
branches;
next	1.178;

1.178
date	2013.03.11.11.35.56;	author espie;	state Exp;
branches;
next	1.177;

1.177
date	2013.02.09.14.49.52;	author sthen;	state Exp;
branches
	1.177.2.1;
next	1.176;

1.176
date	2013.01.30.23.22.05;	author brad;	state Exp;
branches;
next	1.175;

1.175
date	2013.01.23.13.34.41;	author sthen;	state Exp;
branches;
next	1.174;

1.174
date	2013.01.05.12.45.45;	author ajacoutot;	state Exp;
branches;
next	1.173;

1.173
date	2012.12.17.00.52.58;	author brad;	state Exp;
branches;
next	1.172;

1.172
date	2012.11.04.00.22.50;	author brad;	state Exp;
branches;
next	1.171;

1.171
date	2012.09.25.20.11.11;	author brad;	state Exp;
branches;
next	1.170;

1.170
date	2012.09.04.10.00.20;	author sthen;	state Exp;
branches;
next	1.169;

1.169
date	2012.08.25.10.14.37;	author ajacoutot;	state Exp;
branches;
next	1.168;

1.168
date	2012.08.04.15.28.14;	author ajacoutot;	state Exp;
branches;
next	1.167;

1.167
date	2012.08.04.14.45.34;	author ajacoutot;	state Exp;
branches;
next	1.166;

1.166
date	2012.07.04.13.00.46;	author ajacoutot;	state Exp;
branches;
next	1.165;

1.165
date	2012.06.27.07.29.17;	author sthen;	state Exp;
branches;
next	1.164;

1.164
date	2012.05.22.11.43.31;	author sthen;	state Exp;
branches;
next	1.163;

1.163
date	2012.05.03.07.40.05;	author sthen;	state Exp;
branches;
next	1.162;

1.162
date	2012.04.28.10.52.08;	author ajacoutot;	state Exp;
branches;
next	1.161;

1.161
date	2012.04.22.13.44.09;	author ajacoutot;	state Exp;
branches;
next	1.160;

1.160
date	2012.04.16.21.58.34;	author sthen;	state Exp;
branches;
next	1.159;

1.159
date	2012.04.10.22.37.02;	author sthen;	state Exp;
branches;
next	1.158;

1.158
date	2012.04.10.22.01.20;	author sthen;	state Exp;
branches;
next	1.157;

1.157
date	2012.03.29.13.38.49;	author sthen;	state Exp;
branches;
next	1.156;

1.156
date	2012.03.02.08.22.20;	author sthen;	state Exp;
branches;
next	1.155;

1.155
date	2012.02.16.21.36.08;	author sthen;	state Exp;
branches;
next	1.154;

1.154
date	2012.01.31.09.12.58;	author sthen;	state Exp;
branches
	1.154.2.1;
next	1.153;

1.153
date	2011.12.17.22.01.13;	author sthen;	state Exp;
branches;
next	1.152;

1.152
date	2011.10.21.20.10.51;	author sthen;	state Exp;
branches;
next	1.151;

1.151
date	2011.09.26.09.32.12;	author sthen;	state Exp;
branches;
next	1.150;

1.150
date	2011.09.16.11.13.40;	author espie;	state Exp;
branches;
next	1.149;

1.149
date	2011.09.13.10.54.15;	author sthen;	state Exp;
branches;
next	1.148;

1.148
date	2011.08.22.10.03.24;	author giovanni;	state Exp;
branches;
next	1.147;

1.147
date	2011.07.29.08.13.51;	author giovanni;	state Exp;
branches
	1.147.2.1;
next	1.146;

1.146
date	2011.07.14.08.42.02;	author sthen;	state Exp;
branches;
next	1.145;

1.145
date	2011.07.08.02.14.59;	author ajacoutot;	state Exp;
branches;
next	1.144;

1.144
date	2011.06.15.19.34.45;	author sthen;	state Exp;
branches;
next	1.143;

1.143
date	2011.06.03.10.21.54;	author sthen;	state Exp;
branches;
next	1.142;

1.142
date	2011.06.02.13.41.40;	author ajacoutot;	state Exp;
branches;
next	1.141;

1.141
date	2011.05.19.20.44.51;	author gsoares;	state Exp;
branches;
next	1.140;

1.140
date	2011.04.17.08.33.14;	author sthen;	state Exp;
branches;
next	1.139;

1.139
date	2011.04.03.18.07.52;	author ajacoutot;	state Exp;
branches;
next	1.138;

1.138
date	2011.03.21.09.40.04;	author sthen;	state Exp;
branches;
next	1.137;

1.137
date	2011.03.21.09.20.35;	author sthen;	state Exp;
branches;
next	1.136;

1.136
date	2011.03.17.16.49.27;	author ajacoutot;	state Exp;
branches;
next	1.135;

1.135
date	2011.03.15.13.49.44;	author sthen;	state Exp;
branches;
next	1.134;

1.134
date	2011.03.09.19.37.47;	author ajacoutot;	state Exp;
branches;
next	1.133;

1.133
date	2011.03.02.08.24.03;	author sthen;	state Exp;
branches;
next	1.132;

1.132
date	2011.01.17.17.58.03;	author ajacoutot;	state Exp;
branches
	1.132.2.1;
next	1.131;

1.131
date	2010.12.06.19.41.54;	author ajacoutot;	state Exp;
branches;
next	1.130;

1.130
date	2010.11.19.22.31.38;	author espie;	state Exp;
branches;
next	1.129;

1.129
date	2010.11.11.17.20.28;	author espie;	state Exp;
branches;
next	1.128;

1.128
date	2010.11.06.07.56.48;	author ajacoutot;	state Exp;
branches;
next	1.127;

1.127
date	2010.10.29.12.41.58;	author ajacoutot;	state Exp;
branches;
next	1.126;

1.126
date	2010.10.29.09.40.41;	author espie;	state Exp;
branches;
next	1.125;

1.125
date	2010.10.18.19.07.19;	author sthen;	state Exp;
branches;
next	1.124;

1.124
date	2010.10.18.18.36.57;	author espie;	state Exp;
branches;
next	1.123;

1.123
date	2010.09.18.12.36.27;	author sthen;	state Exp;
branches;
next	1.122;

1.122
date	2010.09.18.12.35.55;	author sthen;	state Exp;
branches;
next	1.121;

1.121
date	2010.08.28.18.55.18;	author sthen;	state Exp;
branches;
next	1.120;

1.120
date	2010.07.26.20.28.00;	author ajacoutot;	state Exp;
branches;
next	1.119;

1.119
date	2010.07.23.12.01.47;	author ajacoutot;	state Exp;
branches;
next	1.118;

1.118
date	2010.07.14.07.20.18;	author sthen;	state Exp;
branches;
next	1.117;

1.117
date	2010.07.12.22.07.41;	author sthen;	state Exp;
branches;
next	1.116;

1.116
date	2010.07.02.14.42.29;	author giovanni;	state Exp;
branches;
next	1.115;

1.115
date	2010.06.25.17.39.12;	author sthen;	state Exp;
branches;
next	1.114;

1.114
date	2010.05.26.08.47.43;	author kili;	state Exp;
branches;
next	1.113;

1.113
date	2010.05.20.18.16.39;	author sthen;	state Exp;
branches;
next	1.112;

1.112
date	2010.04.28.08.02.38;	author sthen;	state Exp;
branches;
next	1.111;

1.111
date	2010.04.26.17.31.57;	author sthen;	state Exp;
branches;
next	1.110;

1.110
date	2010.03.05.09.01.45;	author giovanni;	state Exp;
branches
	1.110.2.1;
next	1.109;

1.109
date	2010.02.26.18.13.25;	author espie;	state Exp;
branches;
next	1.108;

1.108
date	2009.11.22.16.40.03;	author ajacoutot;	state Exp;
branches;
next	1.107;

1.107
date	2009.10.11.19.45.46;	author sthen;	state Exp;
branches;
next	1.106;

1.106
date	2009.09.15.17.37.21;	author jasper;	state Exp;
branches;
next	1.105;

1.105
date	2009.06.30.21.38.38;	author naddy;	state Exp;
branches
	1.105.2.1;
next	1.104;

1.104
date	2009.05.22.14.06.13;	author ajacoutot;	state Exp;
branches;
next	1.103;

1.103
date	2009.05.19.07.05.25;	author giovanni;	state Exp;
branches;
next	1.102;

1.102
date	2009.05.14.17.05.46;	author giovanni;	state Exp;
branches;
next	1.101;

1.101
date	2009.04.10.11.59.06;	author ajacoutot;	state Exp;
branches;
next	1.100;

1.100
date	2008.12.07.03.52.56;	author brad;	state Exp;
branches
	1.100.2.1;
next	1.99;

1.99
date	2008.09.18.13.37.41;	author ajacoutot;	state Exp;
branches;
next	1.98;

1.98
date	2008.09.17.10.38.59;	author brad;	state Exp;
branches;
next	1.97;

1.97
date	2008.09.12.07.49.11;	author brad;	state Exp;
branches;
next	1.96;

1.96
date	2008.08.30.17.02.26;	author ajacoutot;	state Exp;
branches;
next	1.95;

1.95
date	2008.08.29.19.50.20;	author mbalmer;	state Exp;
branches;
next	1.94;

1.94
date	2008.07.25.22.01.17;	author brad;	state Exp;
branches;
next	1.93;

1.93
date	2008.07.12.12.33.21;	author brad;	state Exp;
branches;
next	1.92;

1.92
date	2008.07.11.11.40.33;	author brad;	state Exp;
branches;
next	1.91;

1.91
date	2008.05.13.11.34.12;	author dlg;	state Exp;
branches;
next	1.90;

1.90
date	2008.03.18.09.15.50;	author dlg;	state Exp;
branches;
next	1.89;

1.89
date	2008.01.04.17.48.37;	author espie;	state Exp;
branches;
next	1.88;

1.88
date	2007.12.14.08.53.27;	author mbalmer;	state Exp;
branches;
next	1.87;

1.87
date	2007.10.25.09.46.44;	author wilfried;	state Exp;
branches;
next	1.86;

1.86
date	2007.09.15.22.36.59;	author merdely;	state Exp;
branches;
next	1.85;

1.85
date	2007.07.02.21.56.57;	author mbalmer;	state Exp;
branches;
next	1.84;

1.84
date	2007.06.04.16.19.13;	author cnst;	state Exp;
branches;
next	1.83;

1.83
date	2007.06.03.16.54.36;	author steven;	state Exp;
branches;
next	1.82;

1.82
date	2007.05.28.20.03.01;	author mbalmer;	state Exp;
branches;
next	1.81;

1.81
date	2007.04.06.14.20.35;	author ajacoutot;	state Exp;
branches;
next	1.80;

1.80
date	2007.03.29.22.12.06;	author deanna;	state Exp;
branches;
next	1.79;

1.79
date	2007.02.06.07.01.13;	author mbalmer;	state Exp;
branches;
next	1.78;

1.78
date	2007.01.12.10.58.11;	author mbalmer;	state Exp;
branches;
next	1.77;

1.77
date	2006.12.14.09.07.56;	author steven;	state Exp;
branches;
next	1.76;

1.76
date	2006.11.25.13.00.41;	author espie;	state Exp;
branches;
next	1.75;

1.75
date	2006.11.20.20.00.05;	author bernd;	state Exp;
branches;
next	1.74;

1.74
date	2006.11.18.11.42.26;	author mbalmer;	state Exp;
branches;
next	1.73;

1.73
date	2006.11.15.21.11.04;	author mbalmer;	state Exp;
branches;
next	1.72;

1.72
date	2006.11.11.15.16.24;	author mbalmer;	state Exp;
branches;
next	1.71;

1.71
date	2006.10.29.12.55.50;	author mbalmer;	state Exp;
branches;
next	1.70;

1.70
date	2006.10.20.13.21.33;	author sturm;	state Exp;
branches;
next	1.69;

1.69
date	2006.10.03.14.07.10;	author mbalmer;	state Exp;
branches;
next	1.68;

1.68
date	2006.08.09.12.54.04;	author bernd;	state Exp;
branches
	1.68.2.1;
next	1.67;

1.67
date	2006.02.17.16.02.17;	author mbalmer;	state Exp;
branches
	1.67.2.1;
next	1.66;

1.66
date	2006.02.10.18.33.46;	author steven;	state Exp;
branches;
next	1.65;

1.65
date	2006.02.08.16.20.47;	author bernd;	state Exp;
branches;
next	1.64;

1.64
date	2006.02.02.09.40.43;	author mbalmer;	state Exp;
branches;
next	1.63;

1.63
date	2006.01.14.14.06.45;	author mbalmer;	state Exp;
branches;
next	1.62;

1.62
date	2006.01.03.21.21.52;	author steven;	state Exp;
branches;
next	1.61;

1.61
date	2005.11.03.19.52.18;	author mbalmer;	state Exp;
branches;
next	1.60;

1.60
date	2005.11.03.17.58.10;	author mbalmer;	state Exp;
branches;
next	1.59;

1.59
date	2005.11.03.15.10.20;	author mbalmer;	state Exp;
branches;
next	1.58;

1.58
date	2005.10.13.21.00.38;	author mbalmer;	state Exp;
branches;
next	1.57;

1.57
date	2005.09.12.16.57.39;	author mbalmer;	state Exp;
branches;
next	1.56;

1.56
date	2005.09.12.16.54.29;	author mbalmer;	state Exp;
branches;
next	1.55;

1.55
date	2005.09.07.10.42.05;	author espie;	state Exp;
branches;
next	1.54;

1.54
date	2005.08.16.13.22.51;	author espie;	state Exp;
branches
	1.54.2.1;
next	1.53;

1.53
date	2005.05.27.04.54.40;	author sturm;	state Exp;
branches;
next	1.52;

1.52
date	2005.05.03.04.33.24;	author sturm;	state Exp;
branches;
next	1.51;

1.51
date	2005.04.09.17.04.17;	author alek;	state Exp;
branches;
next	1.50;

1.50
date	2005.04.03.11.20.37;	author mbalmer;	state Exp;
branches;
next	1.49;

1.49
date	2001.12.26.20.29.00;	author naddy;	state Exp;
branches;
next	1.48;

1.48
date	2001.12.26.19.18.20;	author brad;	state Exp;
branches;
next	1.47;

1.47
date	2001.12.26.19.15.09;	author brad;	state Exp;
branches;
next	1.46;

1.46
date	2001.12.04.00.41.46;	author dhartmei;	state Exp;
branches;
next	1.45;

1.45
date	2001.10.24.15.33.57;	author dhartmei;	state Exp;
branches;
next	1.44;

1.44
date	2001.09.01.20.13.28;	author brad;	state Exp;
branches;
next	1.43;

1.43
date	2001.08.29.13.26.15;	author dhartmei;	state Exp;
branches;
next	1.42;

1.42
date	2001.07.13.11.24.33;	author naddy;	state Exp;
branches;
next	1.41;

1.41
date	2001.06.25.15.14.26;	author dhartmei;	state Exp;
branches;
next	1.40;

1.40
date	2001.05.19.00.10.03;	author matt;	state Exp;
branches;
next	1.39;

1.39
date	2001.05.16.00.59.47;	author matt;	state Exp;
branches;
next	1.38;

1.38
date	2001.05.09.14.55.49;	author naddy;	state Exp;
branches;
next	1.37;

1.37
date	2001.04.19.16.24.06;	author naddy;	state Exp;
branches
	1.37.2.1;
next	1.36;

1.36
date	2001.04.18.12.24.24;	author naddy;	state Exp;
branches;
next	1.35;

1.35
date	2001.04.18.11.35.57;	author naddy;	state Exp;
branches;
next	1.34;

1.34
date	2001.04.10.11.33.46;	author brad;	state Exp;
branches;
next	1.33;

1.33
date	2000.07.22.00.58.28;	author brad;	state Exp;
branches
	1.33.2.1;
next	1.32;

1.32
date	2000.07.19.10.15.42;	author peter;	state Exp;
branches;
next	1.31;

1.31
date	2000.03.24.22.11.53;	author espie;	state Exp;
branches
	1.31.2.1;
next	1.30;

1.30
date	2000.03.23.18.02.58;	author brad;	state Exp;
branches;
next	1.29;

1.29
date	2000.03.23.08.00.40;	author brad;	state Exp;
branches;
next	1.28;

1.28
date	2000.03.23.07.56.32;	author brad;	state Exp;
branches;
next	1.27;

1.27
date	2000.02.15.05.04.59;	author turan;	state Exp;
branches;
next	1.26;

1.26
date	2000.02.12.08.02.27;	author turan;	state Exp;
branches;
next	1.25;

1.25
date	2000.02.11.00.37.34;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	2000.01.29.23.22.32;	author brad;	state Exp;
branches;
next	1.23;

1.23
date	99.12.29.07.19.38;	author brad;	state Exp;
branches;
next	1.22;

1.22
date	99.11.12.19.12.15;	author turan;	state Exp;
branches;
next	1.21;

1.21
date	99.07.24.20.50.00;	author niklas;	state Exp;
branches;
next	1.20;

1.20
date	99.07.22.01.54.53;	author brad;	state Exp;
branches;
next	1.19;

1.19
date	99.05.30.23.02.58;	author brad;	state Exp;
branches;
next	1.18;

1.18
date	99.05.09.07.26.14;	author brad;	state Exp;
branches;
next	1.17;

1.17
date	99.04.06.17.50.40;	author marc;	state Exp;
branches;
next	1.16;

1.16
date	99.03.19.09.06.04;	author brad;	state Exp;
branches;
next	1.15;

1.15
date	98.10.20.08.39.47;	author form;	state Exp;
branches;
next	1.14;

1.14
date	98.09.10.06.49.25;	author marc;	state Exp;
branches;
next	1.13;

1.13
date	98.08.11.13.32.35;	author form;	state Exp;
branches;
next	1.12;

1.12
date	98.08.05.02.36.36;	author form;	state Exp;
branches;
next	1.11;

1.11
date	98.06.15.02.38.09;	author form;	state Exp;
branches;
next	1.10;

1.10
date	98.05.13.04.41.46;	author form;	state Exp;
branches;
next	1.9;

1.9
date	98.05.12.05.14.58;	author form;	state Exp;
branches;
next	1.8;

1.8
date	98.05.11.03.29.11;	author form;	state Exp;
branches;
next	1.7;

1.7
date	98.05.06.02.21.19;	author form;	state Exp;
branches;
next	1.6;

1.6
date	98.03.30.16.51.35;	author marc;	state Exp;
branches;
next	1.5;

1.5
date	98.03.14.22.05.22;	author marc;	state Exp;
branches;
next	1.4;

1.4
date	98.01.29.15.10.01;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	97.11.17.21.47.37;	author joey;	state Exp;
branches;
next	1.2;

1.2
date	97.11.16.22.01.36;	author todd;	state Exp;
branches;
next	1.1;

1.1
date	97.11.16.20.06.44;	author joey;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	97.11.16.20.06.44;	author joey;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	98.05.04.04.10.36;	author form;	state Exp;
branches;
next	;

1.31.2.1
date	2000.09.15.05.10.12;	author marc;	state Exp;
branches;
next	;

1.33.2.1
date	2001.04.18.12.48.39;	author naddy;	state Exp;
branches;
next	1.33.2.2;

1.33.2.2
date	2001.05.09.15.00.58;	author naddy;	state Exp;
branches;
next	1.33.2.3;

1.33.2.3
date	2001.07.04.00.52.16;	author naddy;	state Exp;
branches;
next	;

1.37.2.1
date	2001.05.09.14.59.52;	author naddy;	state Exp;
branches;
next	1.37.2.2;

1.37.2.2
date	2001.07.04.08.46.47;	author naddy;	state Exp;
branches;
next	;

1.54.2.1
date	2006.08.11.04.16.27;	author sturm;	state Exp;
branches;
next	;

1.67.2.1
date	2006.08.11.04.17.29;	author sturm;	state Exp;
branches;
next	1.67.2.2;

1.67.2.2
date	2007.02.07.19.52.53;	author sturm;	state Exp;
branches;
next	;

1.68.2.1
date	2007.02.07.20.36.14;	author sturm;	state Exp;
branches;
next	;

1.100.2.1
date	2009.07.15.02.32.40;	author william;	state Exp;
branches;
next	;

1.105.2.1
date	2010.02.13.03.53.25;	author william;	state Exp;
branches;
next	;

1.110.2.1
date	2010.06.19.03.34.51;	author william;	state Exp;
branches;
next	;

1.132.2.1
date	2011.04.10.02.19.49;	author william;	state Exp;
branches;
next	;

1.147.2.1
date	2012.03.02.08.21.54;	author sthen;	state Exp;
branches;
next	1.147.2.2;

1.147.2.2
date	2012.04.12.15.09.17;	author gsoares;	state Exp;
branches;
next	;

1.154.2.1
date	2012.04.11.14.14.29;	author sthen;	state Exp;
branches;
next	1.154.2.2;

1.154.2.2
date	2012.05.03.07.40.59;	author sthen;	state Exp;
branches;
next	;

1.177.2.1
date	2013.10.28.14.50.32;	author jasper;	state Exp;
branches;
next	;

1.186.2.1
date	2013.10.30.12.54.47;	author jasper;	state Exp;
branches;
next	1.186.2.2;

1.186.2.2
date	2014.02.06.08.35.12;	author jasper;	state Exp;
branches;
next	1.186.2.3;

1.186.2.3
date	2014.04.18.06.10.37;	author brad;	state Exp;
branches;
next	;

1.190.2.1
date	2014.04.12.21.24.12;	author brad;	state Exp;
branches;
next	1.190.2.2;

1.190.2.2
date	2014.06.26.11.46.10;	author sthen;	state Exp;
branches;
next	;
commitid	BDGnDJDp3QHcS5hs;

1.195.2.1
date	2015.02.25.20.24.17;	author jca;	state Exp;
branches;
next	;
commitid	rIt8GcXmVuLVcjO5;

1.215.2.1
date	2016.04.17.17.08.29;	author jca;	state Exp;
branches;
next	1.215.2.2;
commitid	ZMnLkV4M50X9F3yT;

1.215.2.2
date	2016.05.04.19.38.24;	author jca;	state Exp;
branches;
next	1.215.2.3;
commitid	ANggemlf3GLLc854;

1.215.2.3
date	2016.06.29.12.29.35;	author jca;	state Exp;
branches;
next	1.215.2.4;
commitid	qY96PMwtPNRh5uFY;

1.215.2.4
date	2016.07.08.19.03.30;	author jca;	state Exp;
branches;
next	;
commitid	gmxP95qMCCdb3F6E;

1.227.2.1
date	2016.12.23.22.35.36;	author jca;	state Exp;
branches;
next	1.227.2.2;
commitid	ROr0Ptf5whU2K9J8;

1.227.2.2
date	2017.02.18.09.45.51;	author jca;	state Exp;
branches;
next	1.227.2.3;
commitid	j77awAf6K7eLfDp5;

1.227.2.3
date	2017.03.27.23.26.23;	author jca;	state Exp;
branches;
next	1.227.2.4;
commitid	d41s9RCNlh5gGwWp;

1.227.2.4
date	2017.04.05.14.52.13;	author jca;	state Exp;
branches;
next	;
commitid	HcQoZLewNeawlwNM;

1.235.2.1
date	2017.05.24.12.03.02;	author jca;	state Exp;
branches;
next	1.235.2.2;
commitid	lYWRfTA3GdKw4chq;

1.235.2.2
date	2017.07.13.00.53.25;	author jca;	state Exp;
branches;
next	1.235.2.3;
commitid	a1vgqARpUN93as7u;

1.235.2.3
date	2017.09.26.03.14.20;	author jca;	state Exp;
branches;
next	;
commitid	NJBT5K6oCjC83Hq0;


desc
@@


1.241
log
@Avoid nested function in waf test

Innocuous, but changes the actual output of a command (smbd -b), so
bump.
@
text
@# $OpenBSD: Makefile,v 1.240 2017/09/23 22:59:18 jca Exp $

VERSION =		4.5.14
DISTNAME =		samba-${VERSION}

COMMENT-main =		SMB and CIFS client and server for UNIX
COMMENT-ldb =		LDAP-like embedded database
COMMENT-tevent =	event system based on talloc
COMMENT-util =		common libraries for Samba suite
COMMENT-docs =		additional documentation and examples for Samba

PKGNAME-main =		${PKGNAME}
PKGNAME-ldb =		ldb-${LDB_V}
PKGNAME-tevent =	tevent-${TEVENT_V}
PKGNAME-util =		samba-util-${VERSION}
PKGNAME-docs =		samba-docs-${VERSION}

REVISION-main =		0
REVISION-tevent =	1
REVISION-ldb =		0

PKG_ARCH-docs =		*

LDB_V =			1.1.27
TEVENT_V =		0.9.29

SHARED_LIBS =		asn1-samba4		0.0 \
			com_err-samba4		0.0 \
			dcerpc			0.0 \
			dcerpc-binding		1.0 \
			dcerpc-samr		0.0 \
			dcerpc-server		2.0 \
			gssapi-samba4		0.0 \
			hcrypto-samba4		0.0 \
			hdb-samba4		0.0 \
			heimbase-samba4		0.0 \
			heimntlm-samba4		0.0 \
			hx509-samba4		0.0 \
			kdc-samba4		0.0 \
			krb5-samba4		0.0 \
			ldb			0.3 \
			ndr			0.2 \
			ndr-krb5pac		0.1 \
			ndr-nbt			0.1 \
			ndr-standard		1.0 \
			netapi			2.0 \
			pyldb-util		0.0 \
			roken-samba4		0.0 \
			samba-credentials	0.0 \
			samba-errors		0.0 \
			samba-hostconfig	2.0 \
			samba-passdb		0.1 \
			samba-policy		0.0 \
			samba-util		1.1 \
			samdb			0.0 \
			smbclient		4.1 \
			smbconf			1.0 \
			smbldap			0.0 \
			tevent			0.2 \
			tevent-util		0.1 \
			wbclient		3.1 \
			wind-samba4		0.0 \
			replace			1.0 \
			util-setid		1.0

CATEGORIES =		net sysutils security

HOMEPAGE =		https://www.samba.org/

MAINTAINER =		Ian McWilliam <kaosagnt@@gmail.com>, \
			Jeremie Courreges-Anglas <jca@@wxcvbn.org>

# GPLv3, LGPLv3
PERMIT_PACKAGE_CDROM =	Yes

UTIL_LIBS =		replace util-setid
# TODO WAF scripts link to those without version info, but those are
# not "plugins" or such.
UTIL_WANTLIB =		${UTIL_LIBS:S@@^@@lib/samba/@@}

WANTLIB-common =	c pthread

WANTLIB-main =		${WANTLIB-common} ${MODPY_WANTLIB}
WANTLIB-main +=		z
WANTLIB-main +=		avahi-client avahi-common cups dbus-1 execinfo fam
WANTLIB-main +=		iconv intl lber ldap pam popt gnutls
WANTLIB-main +=		ldb pyldb-util pytalloc-util tdb talloc tevent
WANTLIB-main +=		${UTIL_WANTLIB}

WANTLIB-ldb =		${WANTLIB-common} ${MODPY_WANTLIB}
WANTLIB-ldb +=		popt talloc tevent

WANTLIB-tevent =	${WANTLIB-common} ${MODPY_WANTLIB}
WANTLIB-tevent +=	talloc

WANTLIB-util =		${WANTLIB-common}

WANTLIB-docs =

MASTER_SITES =		https://download.samba.org/pub/samba/stable/ \
			https://download.samba.org/pub/samba/old-versions/

MULTI_PACKAGES =	-main -ldb -tevent -util -docs

MODULES =		lang/python perl

BUILD_DEPENDS =		devel/p5-Parse-Yapp>=1.0.5 \
			net/py-dnspython \
			textproc/docbook-xsl \
			x11/dbus

RUN_DEPENDS-main =	net/py-dnspython

RUN_DEPENDS-docs =

LIB_DEPENDS-main =	${BUILD_PKGPATH},-ldb>=${LDB_V} \
			${BUILD_PKGPATH},-util>=${VERSION} \
			converters/libiconv \
			databases/openldap \
			databases/tdb>=1.3.8 \
			devel/gettext \
			devel/libexecinfo \
			devel/libtalloc>=2.1.6 \
			net/avahi \
			print/cups,-libs \
			security/gnutls \
			security/openpam \
			sysutils/gamin

LIB_DEPENDS-ldb =	${BUILD_PKGPATH},-tevent>=${TEVENT_V} \
			devel/libtalloc>=2.1.6 \
			devel/popt

LIB_DEPENDS-tevent =	devel/libtalloc>=2.1.6

LIB_DEPENDS-docs =

CONFIGURE_STYLE =	simple

CONFIGURE_ARGS =	--enable-fhs \
			--abi-check-disable \
			--bundled-libraries="!crypto,ldb,!talloc,!tdb,tevent" \
			--prefix=${PREFIX} \
			--destdir=${WRKINST} \
			--docdir=${PREFIX}/share/doc \
			--mandir=${PREFIX}/man \
			--localedir=${PREFIX}/share/locale \
			--localstatedir=${BASELOCALSTATEDIR} \
			--private-libraries="NONE" \
			--sharedstatedir=${VARBASE} \
			--sysconfdir=${SYSCONFDIR} \
			--with-configdir=${SYSCONFDIR}/samba \
			--with-statedir=${VARBASE}/samba \
			--with-privatedir=${VARBASE}/samba/private \
			--with-lockdir=${VARBASE}/run/samba \
			--with-privileged-socket-dir=${VARBASE}/samba \
			--without-pie \
			--pedantic \
			--without-regedit \
			--without-acl-support \
			--without-libarchive \
			--disable-rpath \
			--with-ntvfs-fileserver \
			--without-gpgme

# XXX Remember to remove --enable-developer, it prints passwords in logs.
#CONFIGURE_ARGS +=	--enable-developer

WAF =			${WRKSRC}/buildtools/bin/waf
WAF_ARGS =		-v -j ${MAKE_JOBS}

CONFIGURE_ENV =		LC_ALL=en_US.UTF-8 \
			CPP="/usr/libexec/cpp"

MAKE_ENV =		LC_ALL=en_US.UTF-8 \
			PYTHON=${MODPY_BIN} \
			WAF_ARGS="${WAF_ARGS}"

.for _l _v in ${SHARED_LIBS}
MAKE_ENV +=		LIB${_l:S/-/_/g}_VERSION=${_v}
.endfor

SAMBA_CONFIG =		${PREFIX}/share/examples/samba/smb.conf.default
SAMBA_LOGDIR =		${VARBASE}/log/samba

SUBST_VARS =		SAMBA_LOGDIR

post-patch:
	find ${WRKSRC} -type f | xargs ${MODPY_BIN_ADJ}

# Avoid bogus -L/usr/local/lib at the start of linker options
post-configure:
	perl -pi.ldflags -e 's/^LINKFLAGS_PYEMBED.*/LINKFLAGS_PYEMBED = []/' \
	    ${WRKBUILD}/bin/c4che/default.cache.py

post-install:
	# removing extra files
	find ${PREFIX} \
	    -name '*${PATCHORIG}' -or \
	    -name '*.beforesubst' -or \
	    -name '*.deconforig' | \
		xargs -rt rm --
	# fix path to perl modules
	mv ${PREFIX}/share/perl5/* ${PREFIX}/${P5SITE}
	# precompiling Python modules
	${MODPY_BIN} ${MODPY_LIBDIR}/compileall.py ${WRKINST}${MODPY_SITEPKG}
	${MODPY_BIN} -O ${MODPY_LIBDIR}/compileall.py ${WRKINST}${MODPY_SITEPKG}
	# removing extra symlinks
	find ${PREFIX}/lib -type l -name '*.so' -exec rm {} ';'
	# creating library symlinks
.for _l in ${UTIL_LIBS}
	cd ${PREFIX}/lib && ln -fs samba/lib${_l}.so.${LIB${_l}_VERSION}
.endfor
	# install samba docs and sample config
	${INSTALL_DATA_DIR} ${PREFIX}/share/{doc,examples}/samba
	cp -R ${WRKDIST}/examples/* ${PREFIX}/share/examples/samba
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share/examples/samba
	find ${PREFIX}/share/examples/samba -type f | xargs chmod ${SHAREMODE}
	find ${PREFIX}/share/examples/samba -type d | xargs chmod ${DIRMODE}
	sed -e 's:/usr/spool/samba:/var/spool/samba:g' \
	     -e 's:/usr/local/samba/var/log:${SAMBA_LOGDIR}/smbd:g' \
	     -e 's:MYGROUP:WORKGROUP:' \
	     ${WRKDIST}/examples/smb.conf.default > ${SAMBA_CONFIG}.tmp && \
	    mv ${SAMBA_CONFIG}.tmp ${SAMBA_CONFIG}

.include <bsd.port.mk>
@


1.240
log
@SECURITY update to samba-4.5.14

o  CVE-2017-12150 (SMB1/2/3 connections may not require signing where
   they should)
o  CVE-2017-12151 (SMB3 connections don't keep encryption across DFS
   redirects)
o  CVE-2017-12163 (Server memory information leak over SMB1)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.239 2017/09/18 11:52:04 jca Exp $
d18 1
@


1.239
log
@Update to samba-4.5.13, the latest release of the 4.5.x series

Putting this in now to help handle future possible security issues on
the 6.2 branch.  Tested by Ian McWilliam.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.238 2017/07/13 00:52:29 jca Exp $
d3 1
a3 1
VERSION =		4.5.13
@


1.238
log
@SECURITY fix for CVE-2017-11103

CVE-2017-11103: Orpheus' Lyre mutual authentication validation bypass

The fix affects the embedded Heimdal copy.

  https://github.com/heimdal/heimdal/commit/6dd3eb836bbb80a00ffced4ad57077a1cdf227ea
  https://www.orpheus-lyre.info/
  https://www.samba.org/samba/security/CVE-2017-11103.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.237 2017/05/24 11:58:29 jca Exp $
d3 1
a3 1
VERSION =		4.5.8
d18 2
a19 2
REVISION-main =		1
REVISION-tevent =	0
d44 1
a44 1
			ndr-standard		0.1 \
d62 2
a63 2
			replace			0.0 \
			util-setid		0.0
@


1.237
log
@SECURITY fix for CVE-2017-7494

o CVE-2017-7494 rpc_server3: Refuse to open pipe names with /
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.236 2017/05/16 08:45:32 ajacoutot Exp $
d18 1
a18 1
REVISION-main =		0
@


1.236
log
@/usr/local/include/samba-4.0/ was not registered in any subpackage; make
-tevent own it since all include/samba-4.0 consumers depend on it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.235 2017/04/01 11:37:38 jca Exp $
d18 1
@


1.235
log
@Update to samba-4.5.8

Fix regression with "follow symlinks = no".  ok Ian sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.234 2017/03/25 17:00:01 jca Exp $
d17 2
@


1.235.2.1
log
@SECURITY fix for CVE-2017-7494

o CVE-2017-7494 rpc_server3: Refuse to open pipe names with /
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.235 2017/04/01 11:37:38 jca Exp $
a16 2

REVISION-main =		0
@


1.235.2.2
log
@SECURITY fix for CVE-2017-11103

CVE-2017-11103: Orpheus' Lyre mutual authentication validation bypass

The fix affects the embedded Heimdal copy.

  https://github.com/heimdal/heimdal/commit/6dd3eb836bbb80a00ffced4ad57077a1cdf227ea
  https://www.orpheus-lyre.info/
  https://www.samba.org/samba/security/CVE-2017-11103.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.235.2.1 2017/05/24 12:03:02 jca Exp $
d18 1
a18 1
REVISION-main =		1
@


1.235.2.3
log
@Missing bump in previous

Spotted by Steven Surdock & Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.235.2.2 2017/07/13 00:53:25 jca Exp $
d18 1
a18 1
REVISION-main =		2
@


1.234
log
@SECURITY update to samba-4.5.7

o CVE-2017-2619 (Symlink race allows access outside share definition)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.233 2017/03/16 09:53:33 jca Exp $
d3 1
a3 1
VERSION =		4.5.7
@


1.233
log
@Update to samba-4.5.6

Tests by Ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.232 2016/12/20 14:15:11 jca Exp $
d3 1
a3 1
VERSION =		4.5.6
@


1.232
log
@SECURITY update to samba-4.5.3

CVE-2016-2123 (Samba NDR Parsing ndr_pull_dnsp_name Heap-based Buffer
Overflow Remote Code Execution Vulnerability).

CVE-2016-2125 (Unconditional privilege delegation to Kerberos servers in
trusted realms).

CVE-2016-2126 (Flaws in Kerberos PAC validation can trigger privilege
elevation).

ok Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.231 2016/12/19 10:12:18 jca Exp $
d3 1
a3 1
VERSION =		4.5.3
@


1.231
log
@Update to samba-4.5.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.230 2016/11/11 15:16:57 ajacoutot Exp $
d3 1
a3 1
VERSION =		4.5.2
@


1.230
log
@-util should own the /usr/local/lib/samba/ directory to prevent the following
warning when pkg_delete samba:
Error deleting directory /usr/local/lib/samba: Directory not empty

ok jca@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.229 2016/11/09 15:59:37 jca Exp $
d3 1
a3 1
VERSION =		4.5.1
a16 3

REVISION-main =		0
REVISION-util =		0
@


1.229
log
@Update to samba-4.5.1

Changes:
  https://www.samba.org/samba/history/samba-4.5.0.html
  https://www.samba.org/samba/history/samba-4.5.1.html

powerpc build test kirby@@, ok Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.228 2016/09/12 15:38:22 jca Exp $
d17 3
@


1.228
log
@Repair samba-tool domain provision --use-ntvfs

The situation is a mess.  Upstream says that s3fs (the original smb code
from samba3) requires filesystem ACLs, which we don't have.  The ntvfs
code (new in samba4, but now deprecated) fit the job, but
adding --with-ntvfs-fileserver doesn't actually provide a working 'smb'
service (see "server services" in smb.conf(5)).

So right now it seems that the workaround is to provision
using --use-ntvfs, but then to strip 'smb' from the 'server services'
line.

Reports welcome...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.227 2016/07/08 18:39:50 jca Exp $
d3 1
a3 1
VERSION =		4.4.5
a17 4
REVISION-main =		0
REVISION-ldb =		0
REVISION-tevent =	0

d20 2
a21 2
LDB_V =			1.1.26
TEVENT_V =		0.9.28
d28 1
a28 1
			dcerpc-server		1.0 \
d37 5
a41 6
			ldb			0.2 \
			tevent-unix-util	0.0 \
			ndr			0.1 \
			ndr-krb5pac		0.0 \
			ndr-nbt			0.0 \
			ndr-standard		0.0 \
d47 1
a47 1
			samba-hostconfig	1.0 \
d50 1
a50 1
			samba-util		1.0 \
d53 1
a53 1
			smbconf			0.0 \
d56 2
a57 2
			tevent-util		0.0 \
			wbclient		3.0 \
d159 2
a160 1
			--with-ntvfs-fileserver
@


1.227
log
@SECURITY update to samba-4.4.5

 * CVE-2016-2119 (Client side SMB2/3 required signing can be downgraded)

ok ajacoutot@@, Ian McWilliam, sthen@@ on a previous version.  ok danj@@
who noted missing entries in PLIST.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.226 2016/07/06 16:43:16 jca Exp $
d18 1
d163 2
a164 1
			--disable-rpath
@


1.227.2.1
log
@SECURITY update for 4.4.8 CVEs

CVE-2016-2123: Fix DNS vuln ZDI-CAN-3995.
CVE-2016-2125: Don't send delegated credentials to all servers.
CVE-2016-2126: auth/kerberos: Only allow known checksum types in check_pac_checksum().

Test by Ian MacWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.227 2016/07/08 18:39:50 jca Exp $
a17 1
REVISION-main =		0
@


1.227.2.2
log
@Fix samba-tool domain --use-ntvfs

It is not clear whether s3fs is a valid alternative to ntvfs, so keep
providing ntvfs support for people who run an AD DC (AD support is
supposed to require s3fs).  The same fix was committed to -current some
time ago.  Prodded by Alex McWhirter and Ian McWilliam.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.227.2.1 2016/12/23 22:35:36 jca Exp $
d18 1
a18 1
REVISION-main =		1
d163 1
a163 2
			--disable-rpath \
			--with-ntvfs-fileserver
@


1.227.2.3
log
@SECURITY fixes for CVE-2017-2619

(Symlink race allows access outside share definition)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.227.2.2 2017/02/18 09:45:51 jca Exp $
d18 1
a18 1
REVISION-main =		2
@


1.227.2.4
log
@Fix a regression introduced by the fix for CVE-2017-2619

* BUG 12721: Fix regression with "follow symlinks = no"
Patch adapted from samba-4.4.13.  Tests & ok Ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.227.2.3 2017/03/27 23:26:23 jca Exp $
d18 1
a18 1
REVISION-main =		3
@


1.226
log
@Update to samba-4.4.4

Diff from Ian, tests & ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.225 2016/05/15 01:10:07 jca Exp $
d3 1
a3 1
VERSION =		4.4.4
d31 1
a31 1
			dcerpc-server		0.0 \
@


1.225
log
@Fix quota handling that resulted in spam in logs.

Prodded by jung@@, ok jung@@ Ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.224 2016/05/06 11:34:41 jca Exp $
d3 1
a3 1
VERSION =		4.4.3
a17 1
REVISION-main =		0
@


1.224
log
@Update to samba-4.4.3, bringing fixes for the regression introduced by 4.4.2.

Tested by Vijay Sankar and I.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.223 2016/04/25 15:01:29 jca Exp $
d18 1
@


1.223
log
@Better workaround for clearenv
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.222 2016/04/25 08:58:10 jca Exp $
d3 1
a3 1
VERSION =		4.4.2
a17 1
REVISION-main =		0
a19 1
REVISION-util =		0
@


1.222
log
@Drop gettext module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.221 2016/04/22 11:48:36 jca Exp $
d18 1
@


1.221
log
@Update to samba-4.4.2

Tests by Vijay Sankar and Ian, ok Ian

This release contains the security fixes introduced by 4.4.2, plus the
new features and improvements from 4.4.0:

  https://www.samba.org/samba/history/samba-4.4.0.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.220 2016/04/13 11:25:40 jca Exp $
d18 4
d84 1
a84 1
WANTLIB-main =		${WANTLIB-common} ${MODGETTEXT_WANTLIB} ${MODPY_WANTLIB}
d87 1
a87 1
WANTLIB-main +=		lber ldap pam popt gnutls
d106 1
a106 1
MODULES =		devel/gettext lang/python perl
d119 1
a119 1
			${MODGETTEXT_LIB_DEPENDS} \
d122 1
@


1.220
log
@SECURITY update to samba-4.3.8

ok sthen@@ Ian McWilliam

CVE-2015-5370 (Multiple errors in DCE-RPC code)
CVE-2016-2110 (Man in the middle attacks possible with NTLMSSP)
CVE-2016-2111 (NETLOGON Spoofing Vulnerability)
CVE-2016-2112 (LDAP client and server don't enforce integrity)
CVE-2016-2113 (Missing TLS certificate validation)
CVE-2016-2114 ("server signing = mandatory" not enforced)
CVE-2016-2115 (SMB IPC traffic is not integrity protected)
CVE-2016-2118 (SAMR and LSA man in the middle attacks possible)

See https://www.samba.org/samba/history/samba-4.3.8.html for more
information.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.219 2016/04/12 17:42:09 jca Exp $
d3 1
a3 1
VERSION =		4.3.8
d20 2
a21 2
LDB_V =			1.1.21
TEVENT_V =		0.9.25
d24 1
d26 1
a26 2
			dcerpc-atsvc		0.0 \
			dcerpc-binding		0.0 \
a28 1
			gensec			0.0 \
d37 2
a38 1
			ldb			0.1 \
a44 1
			registry		0.0 \
d47 3
a49 2
			samba-hostconfig	0.0 \
			samba-passdb		0.0 \
a53 1
			smbclient-raw		0.0 \
d56 1
a56 1
			tevent			0.1 \
a57 1
			torture			0.0 \
d78 1
a78 1
WANTLIB-common =	c m pthread util ${MODPY_WANTLIB}
d80 4
a83 4
WANTLIB-main =		${WANTLIB-common} ${MODGETTEXT_WANTLIB}
WANTLIB-main +=		com_err ncurses z
WANTLIB-main +=		avahi-client avahi-common cups execinfo fam iniparser
WANTLIB-main +=		lber ldap pam popt sasl2 gcrypt gnutls
d87 2
a88 3
WANTLIB-ldb =		${WANTLIB-common}
WANTLIB-ldb +=		popt tdb talloc tevent
WANTLIB-ldb +=		${UTIL_WANTLIB}
d90 1
a90 1
WANTLIB-tevent =	${WANTLIB-common}
a91 1
WANTLIB-tevent +=	${UTIL_WANTLIB}
a93 1
WANTLIB-util +=		pytalloc-util talloc
d106 2
a107 1
			textproc/docbook-xsl
d117 1
a117 2
			databases/tdb>=1.3.7 \
			devel/iniparser \
d119 1
a119 1
			devel/libtalloc>=2.1.3 \
a121 1
			security/cyrus-sasl2 \
a122 1
			security/libgcrypt \
a123 1
			sysutils/e2fsprogs \
d127 1
a127 3
			${BUILD_PKGPATH},-util>=${VERSION} \
			databases/tdb>=1.3.7 \
			devel/libtalloc>=2.1.3 \
d130 1
a130 5
LIB_DEPENDS-tevent =	${BUILD_PKGPATH},-util>=${VERSION} \
			devel/libtalloc>=2.1.3

LIB_DEPENDS-util =	${MODPY_LIB_DEPENDS} \
			devel/libtalloc>=2.1.3
@


1.219
log
@Update to samba-4.3.6

i386 build by danj@@, ok sthen@@

The changelog between 4.1.23 and 4.3.6 is too big to be described here.
The point of updating now is that 4.1.x won't receive updates for the
freshly published security advisories.  samba-4.3.8 will follow.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.218 2016/03/23 19:08:15 jca Exp $
d3 1
a3 1
VERSION =		4.3.6
@


1.218
log
@Stop fetching and packaging outdated pdf docs; ok Ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.217 2016/03/20 15:58:26 naddy Exp $
d3 1
a3 1
VERSION =		4.1.23
a17 4
REVISION-ldb =		7
REVISION-tevent =	6
REVISION-docs =		0

d20 2
a21 2
LDB_V =			1.1.17
TEVENT_V =		0.9.18
d38 2
a39 3
			ldb			0.0 \
			mit_samba		0.0 \
			ndr			0.0 \
a43 2
			ntdb			0.0 \
			pdb			0.0 \
d49 1
d53 1
a53 1
			smbclient		4.0 \
d57 1
a57 2
			smbsharemodes		2.0 \
			tevent			0.0 \
d60 1
a60 1
			wbclient		2.0 \
a61 4
			winbind_krb5_locator	0.0 \
			nss_wrapper		0.0 \
			socket_wrapper		0.0 \
			uid_wrapper		0.0 \
d63 1
a63 1
			util_setid		0.0
d75 1
a75 2
UTIL_LIBS =		nss_wrapper socket_wrapper uid_wrapper replace
UTIL_LIBS +=		util_setid
d121 1
a121 1
			databases/tdb>=1.2.12 \
d124 1
a124 1
			devel/libtalloc>=2.1.2 \
d136 2
a137 2
			databases/tdb>=1.2.12 \
			devel/libtalloc>=2.1.2 \
d141 1
a141 1
			devel/libtalloc>=2.1.2
d144 1
a144 1
			devel/libtalloc>=2.1.2
d152 1
a152 1
			--bundled-libraries="!crypto,ldb,ntdb,!talloc,!tdb,tevent" \
a167 1
			--enable-selftest \
d169 4
a172 1
			--without-regedit
d180 2
a181 1
CONFIGURE_ENV =		LC_ALL=en_US.UTF-8
a197 1
	${SUBST_CMD} ${WRKSRC}/lib/testtools/testtools/tests/test_compat.py
d216 2
@


1.217
log
@remove SHARED_ONLY
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.216 2016/03/09 19:40:11 jca Exp $
a4 3
DOCSVERSION =		v3-5-test-4c5a1b6b
DISTFILES =		${DISTNAME}${EXTRACT_SUFX} \
			samba-docs-${DOCSVERSION}.tar.bz2:0
d20 1
a116 2
MASTER_SITES0 =		https://www.samba.org/~samba-bugs/docs/v3-5-test/

a231 2
	${INSTALL_DATA} ${WRKDIR}/samba-docs-${DOCSVERSION}/*.pdf \
		${PREFIX}/share/doc/samba
@


1.216
log
@SECURITY update to samba-4.1.23; ok Ian McWilliam

Fixes for CVE-2015-7560 and CVE-2016-0771.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.215 2016/01/18 12:10:51 sthen Exp $
a2 1
SHARED_ONLY =		Yes
@


1.215
log
@bump tevent
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.214 2016/01/17 17:29:10 sthen Exp $
d4 1
a4 1
VERSION =		4.1.22
d22 2
a23 4
REVISION-main =		0
REVISION-ldb =		6
REVISION-tevent =	5
REVISION-util =		0
@


1.215.2.1
log
@Backport SECURITY update to samba-4.3.8

ok sthen@@

Fixes for:

CVE-2015-7560 (Incorrect ACL get/set allowed on symlink path)
CVE-2016-0771 (Out-of-bounds read in internal DNS server)

CVE-2015-5370 (Multiple errors in DCE-RPC code)
CVE-2016-2110 (Man in the middle attacks possible with NTLMSSP)
CVE-2016-2111 (NETLOGON Spoofing Vulnerability)
CVE-2016-2112 (LDAP client and server don't enforce integrity)
CVE-2016-2113 (Missing TLS certificate validation)
CVE-2016-2114 ("server signing = mandatory" not enforced)
CVE-2016-2115 (SMB IPC traffic is not integrity protected)
CVE-2016-2118 (SAMR and LSA man in the middle attacks possible)

CVE-2016-2118 is http://badlock.org/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.215 2016/01/18 12:10:51 sthen Exp $
d4 1
a4 1
VERSION =		4.3.8
d6 3
d22 5
d29 2
a30 2
LDB_V =			1.1.21
TEVENT_V =		0.9.25
d47 3
a49 2
			ldb			0.1 \
			ndr			0.1 \
d54 2
a60 1
			samba-passdb		0.0 \
d64 1
a64 1
			smbclient		4.1 \
d68 2
a69 1
			tevent			0.1 \
d72 1
a72 1
			wbclient		3.0 \
d74 4
d79 1
a79 1
			util-setid		0.0
d91 2
a92 1
UTIL_LIBS =		replace util-setid
d122 2
d140 1
a140 1
			databases/tdb>=1.3.7 \
d143 1
a143 1
			devel/libtalloc>=2.1.3 \
d155 2
a156 2
			databases/tdb>=1.3.7 \
			devel/libtalloc>=2.1.3 \
d160 1
a160 1
			devel/libtalloc>=2.1.3
d163 1
a163 1
			devel/libtalloc>=2.1.3
d171 1
a171 1
			--bundled-libraries="!crypto,ldb,!talloc,!tdb,tevent" \
d187 1
d189 1
a189 4
			--without-regedit \
			--without-acl-support \
			--without-libarchive \
			--disable-rpath
d197 1
a197 2
CONFIGURE_ENV =		LC_ALL=en_US.UTF-8 \
			CPP="/usr/libexec/cpp"
d214 1
a232 2
	# removing extra symlinks
	find ${PREFIX}/lib -type l -name '*.so' -exec rm {} ';'
d239 2
@


1.215.2.2
log
@Update to samba-4.3.9, with fixes for the regressions brought by 4.3.8.

ok jung@@ Ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.215.2.1 2016/04/17 17:08:29 jca Exp $
d4 1
a4 1
VERSION =		4.3.9
d19 1
a19 1
REVISION-ldb =		0
d22 1
a22 3
TEVENT_V =		0.9.28

PKG_ARCH-docs =		*
d58 1
a58 1
			tevent			0.2 \
@


1.215.2.3
log
@Bugfix update to samba-4.3.10

While this is not a security update, it reduces the gap for the upcoming
security releases.  This helps tracking down potential regressions.

While here, backport a patch from -current to avoid spam related to
(too?) strict permissions checks in quotactl(2).

Diff and tests from Ian (co-maintainer), update discussed with jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.215.2.2 2016/05/04 19:38:24 jca Exp $
d4 1
a4 1
VERSION =		4.3.10
@


1.215.2.4
log
@SECURITY update to samba-4.3.11

* CVE-2016-2119 (Client side SMB2/3 required signing can be downgraded)

ok sthen@@ danj@@, thanks danj@@ for spotting a few missing PLIST entries.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.215.2.3 2016/06/29 12:29:35 jca Exp $
d4 1
a4 1
VERSION =		4.3.11
d31 1
a31 1
			dcerpc-server		1.0 \
@


1.214
log
@sync WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.213 2015/12/23 12:37:21 jca Exp $
d24 1
a24 1
REVISION-tevent =	4
@


1.213
log
@SECURITY update to samba-4.1.22; ok Ian McWilliam

ChangeLog and descriptions of the relevant CVE's:

  https://www.samba.org/samba/history/samba-4.1.22.html

This update changed the signature of a few functions in libsamba-util,
so bump the shlib major.  Also update Ian's email adress while here.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.212 2015/11/29 15:50:20 ajacoutot Exp $
d22 1
d25 1
d97 1
a97 1
WANTLIB-common =	m pthread util ${MODPY_WANTLIB}
d100 1
a100 1
WANTLIB-main +=		c com_err ncurses z
d107 1
a107 1
WANTLIB-ldb +=		c popt tdb talloc tevent
@


1.212
log
@daemon_timeout is not passed to the child scripts either.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.211 2015/10/15 16:57:19 jca Exp $
d4 1
a4 1
VERSION =		4.1.21
d22 2
a23 3
REVISION-ldb =		5
REVISION-tevent =	3
REVISION-main =		0
d60 1
a60 1
			samba-util		0.0 \
d83 1
a83 1
MAINTAINER =		Ian McWilliam <kaosagnt@@tpg.com.au>, \
@


1.211
log
@Bugfix update to samba-4.1.21

"diff looks fine" Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.210 2015/09/30 18:16:14 jca Exp $
d24 1
@


1.210
log
@Backport usage warning for smbstatus(1), picked from upstream.

Problem noticed and different patch proposed by giovanni@@.
ok giovanni@@ Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.209 2015/09/11 11:35:09 jca Exp $
d4 1
a4 1
VERSION =		4.1.20
a21 1
REVISION-main =		0
@


1.209
log
@Update to samba-4.1.20; ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.208 2015/08/26 18:05:31 jca Exp $
d22 1
@


1.208
log
@Do not mention SWAT, it has been removed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.207 2015/08/25 15:38:16 jca Exp $
d4 1
a4 1
VERSION =		4.1.19
d22 2
a23 5
REVISION-main =		7
REVISION-ldb =		4
REVISION-tevent =	2
REVISION-util =		2
REVISION-docs =		2
@


1.207
log
@Stray @@sample /var/run/samba, noticed earlier by ajacoutot@@

/var/run gets cleaned at boot time.  The samba daemons create this
directory at startup.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.206 2015/08/25 12:03:21 ajacoutot Exp $
d26 1
a26 1
REVISION-docs =		1
@


1.206
log
@No need to explicitely list textproc/libxslt; the dependency on
docbook-xsl is enough.

ok jca@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.205 2015/08/25 11:41:15 jca Exp $
d22 1
a22 1
REVISION-main =		6
@


1.205
log
@Add a note about nmbd being broken in AD DC setups, and bump.

Requested by giovanni@@, putting it here instead of current.html so that
new users will be aware too.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.204 2015/08/25 11:10:41 jca Exp $
d131 1
a131 2
			textproc/docbook-xsl \
			textproc/libxslt
@


1.204
log
@Ian McWilliam and I will co-maintain this.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.203 2015/08/25 11:07:45 jca Exp $
d22 1
a22 1
REVISION-main =		5
@


1.203
log
@Tweak rc scripts and README.  Tests, input from and ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.202 2015/08/25 11:04:39 jca Exp $
d86 2
a87 1
#MAINTAINER =		???
@


1.202
log
@Move samba4 to samba, and tweak the ports tree to use it.

ok ajacoutot@@

Upcoming commits will add additional tweaks.

Many thanks to Vadim Zhukov (who did most of the work), Ian McWilliam
(co-maintainer), Stuart Henderson who provided lots of support and
feedback, Antoine Jacoutot who patiently dealt with my broken diffs,
and more generally all the people involved.  Most of the recent work was
done during p2k15 and c2k15.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2015/07/18 13:33:08 jca Exp $
d22 1
a22 1
REVISION-main =		4
@


1.201
log
@Move some obvious sudo -> '#' (root) in READMEs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.200 2015/02/25 01:37:49 jca Exp $
d3 204
a206 1
SHARED_ONLY=		Yes
d208 2
a209 2
COMMENT-main=		SMB and CIFS client and server for UNIX
COMMENT-docs=		additional documentation and examples for Samba
d211 1
a211 116
DISTNAME=		samba-3.6.15
PKGNAME-main=		${DISTNAME}
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}
FULLPKGPATH-docs=	net/samba,-docs
REVISION-main=		15
REVISION-docs=		1

SHARED_LIBS=		smbclient	3.0 \
			smbsharemodes	1.0 \
			netapi		1.0 \
			wbclient	1.0

CATEGORIES=		net

HOMEPAGE=		http://www.samba.org/

MAINTAINER=		Ian McWilliam <kaosagnt@@tpg.com.au>

# GPLv3+
PERMIT_PACKAGE_CDROM=		Yes

WANTLIB += c cups execinfo iniparser ncurses popt pthread readline talloc
WANTLIB += tdb z

MASTER_SITES=	http://ftp.samba.org/pub/samba/stable/ \
		http://ftp.samba.org/pub/samba/old-versions/

MODULES=	converters/libiconv

BUILD_DEPENDS=	${MODGNU_AUTOCONF_DEPENDS}
LIB_DEPENDS=	databases/tdb>=1.2.7 \
		devel/iniparser \
		devel/libexecinfo \
		devel/libtalloc \
		devel/popt \
		print/cups,-libs

MAKE_FLAGS+=	PASSWD_PROGRAM="/usr/bin/passwd" \
		LIBSMBCLIENT_SHARED_TARGET_SONAME="bin/libsmbclient.so.${LIBsmbclient_VERSION}" \
		LIBSMBSHAREMODES_SHARED_TARGET_SONAME="bin/libsmbsharemodes.so.${LIBsmbsharemodes_VERSION}" \
		LIBNETAPI_SHARED_TARGET_SONAME="bin/libnetapi.so.${LIBnetapi_VERSION}" \
		LIBADDNS_SHARED_TARGET_SONAME="bin/libaddns.so.${LIBaddns_VERSION}" \
		LIBWBCLIENT_SHARED_TARGET_SONAME="bin/libwbclient.so.${LIBwbclient_VERSION}"

CONFDIR=		${SYSCONFDIR}/samba
SAMBA_LOGDIR=		/var/log/samba
SUBST_VARS=		CONFDIR

USE_GMAKE=		Yes
USE_GROFF=		Yes
CONFIGURE_STYLE=	gnu
AUTOCONF_VERSION=	2.69

CONFIGURE_ARGS=		--disable-fam \
			--without-ads \
			--without-pam \
			--libdir="${PREFIX}/lib/samba" \
			--sbindir="${PREFIX}/libexec" \
			--with-configdir="${CONFDIR}" \
			--with-modulesdir="${PREFIX}/lib/samba" \
			--with-lockdir="/var/spool/samba" \
			--with-piddir="/var/run" \
			--with-logfilebase="${SAMBA_LOGDIR}" \
			--with-privatedir="${CONFDIR}" \
			--with-libsmbclient \
			--with-swatdir="${PREFIX}/share/swat" \
			--with-syslog \
			--with-utmp \
			--with-winbind \
			--with-wbclient \
			--enable-avahi=no \
			--enable-external-libtdb=yes \
			--enable-external-libtalloc=yes \
			--enable-pthreadpool

# Uncomment to enable debugging symbols.
#CONFIGURE_ARGS+=	--enable-debug

CONFIGURE_ENV=		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib"

FLAVORS=		ldap
FLAVOR?=

MULTI_PACKAGES=		-main -docs

.if ${FLAVOR:Mldap}
LIB_DEPENDS+=	databases/openldap
WANTLIB +=	ldap lber
.else
CONFIGURE_ARGS+=	--without-ldap
.endif

PKG_ARCH-docs=		*
LIB_DEPENDS-docs=
WANTLIB-docs=
RUN_DEPENDS-docs=

# REGRESSION testing is currently borked. Builds, runs
# tests fail. Fix one day.
NO_TEST=		Yes
#TEST_TARGET=	test
#.ifmake test
#CONFIGURE_ARGS+=	--enable-socket-wrapper \
#			--enable-nss-wrapper
#.endif

WRKSRC=		${WRKDIR}/${DISTNAME}/source3

SAMBA_DOCS=	${WRKDIST}/README \
		${WRKDIST}/docs/history \
		${WRKDIST}/docs/registry/*.reg

SAMPLE_CONFIG=	${PREFIX}/share/examples/samba/smb.conf.default

SAMBA_MANPAGES= ${WRKDIST}/docs/manpages
d214 2
a215 3
	@@cd ${WRKSRC}; \
	    AUTOCONF_VERSION=${AUTOCONF_VERSION} \
	    ./autogen.sh
d217 4
a220 2
pre-configure:
	@@${SUBST_CMD} ${SAMBA_MANPAGES}/swat.8
d223 28
a250 40
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/samba/pdf
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/samba/htmldocs
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/samba
	${INSTALL_DATA_DIR} ${PREFIX}/lib/pkgconfig
	${INSTALL_DATA} ${WRKSRC}/pkgconfig/*.pc \
		${PREFIX}/lib/pkgconfig
	@@cp -R ${WRKDIST}/examples/* ${PREFIX}/share/examples/samba
	@@chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share/examples/samba
	@@find ${PREFIX}/share/examples/samba -type f | \
	    xargs chmod ${SHAREMODE}
	@@find ${PREFIX}/share/examples/samba -type d | \
	    xargs chmod ${DIRMODE}
	@@for i in ${SAMBA_DOCS}; do \
	 ${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba ;	\
	done
	@@for i in ${WRKDIST}/docs/*.pdf ; do \
	 ${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba/pdf ; \
	done
	@@for i in ${WRKDIST}/docs/htmldocs/* ; do \
	 if [ -f $$i ]; then \
	  ${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba/htmldocs ;\
	 fi \
	done
	@@sed -e 's:/usr/spool/samba:/var/spool/samba:g' \
	 -e 's:/usr/local/samba/var/log:${SAMBA_LOGDIR}/smbd:g' \
	 -e 's:MYGROUP:WORKGROUP:' \
	 ${WRKDIST}/examples/smb.conf.default > ${SAMPLE_CONFIG}
	${INSTALL_SCRIPT} ${WRKSRC}/script/mksmbpasswd.sh \
	 ${PREFIX}/bin/mksmbpasswd
	@@chown ${BINOWN}:${BINGRP} ${PREFIX}/bin/smbpasswd
	@@ln -s samba/libsmbclient.so.${LIBsmbclient_VERSION} \
	 ${PREFIX}/lib/libsmbclient.so.${LIBsmbclient_VERSION}
	@@ln -s samba/libsmbsharemodes.so.${LIBsmbsharemodes_VERSION} \
	 ${PREFIX}/lib/libsmbsharemodes.so.${LIBsmbsharemodes_VERSION}
	@@ln -s samba/libnetapi.so.${LIBnetapi_VERSION} \
	 ${PREFIX}/lib/libnetapi.so.${LIBnetapi_VERSION}
	@@ln -s samba/libwbclient.so.${LIBwbclient_VERSION} \
	 ${PREFIX}/lib/libwbclient.so.${LIBwbclient_VERSION}
	@@rmdir ${WRKINST}${SYSCONFDIR}/samba
	@@rmdir ${WRKINST}/var/spool/samba
@


1.200
log
@SECURITY update for CVE-2015-0240

talloc free on uninitialized stack pointer in netlogon server could lead
to remote-code execution.

  https://www.samba.org/samba/security/CVE-2015-0240
  https://bugzilla.samba.org/show_bug.cgi?id=11077

ok sthen@@ naddy@@ Ian McWilliam (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.199 2015/02/17 22:08:36 sthen Exp $
d12 1
a12 1
REVISION-main=		14
@


1.199
log
@Adjust the "meta" rc-scripts (these are used in ports with multiple daemons
which should all be started/stopped together), previously "restart" would
restart each sub-daemon in turn, but actually it should stop all daemons
and only then start them again. Additionally, as suggested by ajacoutot,
stop the procedure and return an error if stopping one of the rc scripts
failed.  ok ajacoutot@@ rpe@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.198 2015/02/05 02:04:00 jca Exp $
d12 1
a12 1
REVISION-main=		13
@


1.198
log
@Repair conflict between -main and -docs, introduced in previous.

The intended diff had this conflict resolved, but I ended up committing
the previous diff...  Problem spotted by Markus Lude.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.197 2015/02/04 11:50:21 jca Exp $
d12 1
a12 1
REVISION-main=		12
@


1.197
log
@Move the ldap files from the -docs to the -main samba package.

Requested by Marcus Merighi, patch by Ian McWilliam (MAINTAINER),
input from sthen@@ and tweaks by me.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.196 2014/12/08 10:57:09 ajacoutot Exp $
d12 2
a13 2
REVISION-main=		11
REVISION-docs=		0
@


1.196
log
@Make all meta rc.d scripts consistent.
While here, unbreak when options are passed (e.g. /etc/rc.d/foobar -df start)

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.195 2014/07/11 16:20:37 ajacoutot Exp $
d12 2
a13 1
REVISION-main=		10
@


1.195
log
@services(5) already contains what we need.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.194 2014/07/10 13:09:06 ajacoutot Exp $
d12 1
a12 1
REVISION-main=		9
@


1.195.2.1
log
@MFC SECURITY update for CVE-2015-0240

Requested by and ok jasper@@.  Original log message:

talloc free on uninitialized stack pointer in netlogon server could lead
to remote-code execution.

https://www.samba.org/samba/security/CVE-2015-0240
https://bugzilla.samba.org/show_bug.cgi?id=11077
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.195 2014/07/11 16:20:37 ajacoutot Exp $
d12 1
a12 1
REVISION-main=		10
@


1.194
log
@rc.conf.local is in man(1) section 8, at least for now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.193 2014/06/26 11:43:54 sthen Exp $
d12 1
a12 1
REVISION-main=		8
@


1.193
log
@Backport fixes to samba from 3.6.24, from Ian McWilliam (maintainer)

CVE-2014-0244: malformed packet can nmbd to loop, preventing further
NetBIOS name service

CVE-2014-3493: smbd "crash involving overwriting memory on an
authenticated connection" (just classed as a DoS in release notes,
but that may be optimistic)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.192 2014/04/21 22:24:17 sthen Exp $
d12 1
a12 1
REVISION-main=		7
@


1.192
log
@remove ads flavour, it requires krb5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.191 2014/04/10 00:50:58 brad Exp $
d12 1
a12 1
REVISION-main=		6
@


1.191
log
@Fix a security issue with Samba..

Password lockout not enforced for SAMR password changes. CVE-2013-4496

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.190 2014/02/06 04:33:24 brad Exp $
d12 1
a12 1
REVISION-main=		5
a56 1
#SEPARATE_BUILD=		Yes
d61 1
d88 1
a88 1
FLAVORS=		ldap ads
d93 1
a93 5
.if ${FLAVOR:Mldap} && ${FLAVOR:Mads}
ERRORS+= "Fatal: ldap and ads flavors conflict"
.endif

.if ${FLAVOR:Mldap} || ${FLAVOR:Mads}
a97 16
.endif

.if ${FLAVOR:Mads}
CONFIGURE_ARGS+=	--with-krb5="${WRKDIR}/usr"

# Merged build cruft needs loads of work. Disable until ready.
#SEPERATE_BUILD=	simple
#CONFIGURE_ARGS+=	--enable-merged-build
#MODULES+=		lang/python
#MODPY_RUNDEP=		No
LIB_DEPENDS += 		sysutils/e2fsprogs

WANTLIB += asn1 crypto gssapi heimbase krb5 roken
WANTLIB += wind com_err uuid
.else
CONFIGURE_ARGS+=	--without-ads
@


1.190
log
@Fix 2 security issues with Samba...

DCE-RPC fragment length field is incorrectly checked. CVE-2013-4408
ACLs are not checked on opening an alternate data stream on a file or directory. CVE-2013-4475

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.189 2013/12/05 13:08:50 nigel Exp $
d12 1
a12 1
REVISION-main=		4
@


1.190.2.1
log
@Fix a security issue with Samba..

Password lockout not enforced for SAMR password changes. CVE-2013-4496

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.190 2014/02/06 04:33:24 brad Exp $
d12 1
a12 1
REVISION-main=		5
@


1.190.2.2
log
@MFC: Backport fixes to samba from 3.6.24, based on -current diff from
Ian McWilliam (maintainer)

CVE-2014-0244: malformed packet can nmbd to loop, preventing further
NetBIOS name service

CVE-2014-3493: smbd "crash involving overwriting memory on an
authenticated connection" (just classed as a DoS in release notes,
but that may be optimistic)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.190.2.1 2014/04/12 21:24:12 brad Exp $
d12 1
a12 1
REVISION-main=		6
@


1.189
log
@Fix WANTLIB/LDEP sysutils/e2fsprogs for ads FLAVOR

Ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.188 2013/10/06 22:00:48 brad Exp $
d12 1
a12 1
REVISION-main=		3
@


1.188
log
@Add a DoS fix.. Missing integer wrap protection in EA list reading can cause
server to loop with DoS. CVE-2013-4124

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.187 2013/09/18 04:48:52 kirby Exp $
d12 1
a12 1
REVISION-main=		2
d36 1
a36 2
BUILD_DEPENDS=	${MODGNU_AUTOCONF_DEPENDS} \
		sysutils/e2fsprogs
d112 1
d115 1
a115 1
WANTLIB += wind com_err
@


1.187
log
@fix MASTER_SITES
with permission from maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.186 2013/06/20 06:54:37 ajacoutot Exp $
d12 1
a12 1
REVISION-main=		1
@


1.186
log
@Unbreak after hx509 and ntlm removal from Kerberos.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.185 2013/06/17 19:30:53 ajacoutot Exp $
d31 2
a32 3
MASTER_SITES=	http://download.samba.org/samba/ftp/ \
		http://us2.samba.org/samba/ftp/ \
		http://ftp.samba.org/samba/ftp/old-versions/
@


1.186.2.1
log
@Security fix for CVE-2013-4124
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.186 2013/06/20 06:54:37 ajacoutot Exp $
d12 1
a12 1
REVISION-main=		2
@


1.186.2.2
log
@apply security updates for CVE-2013-4408 and CVE-2013-4475
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.186.2.1 2013/10/30 12:54:47 jasper Exp $
d12 1
a12 1
REVISION-main=		3
@


1.186.2.3
log
@Fix a security issue with Samba..

Password lockout not enforced for SAMR password changes. CVE-2013-4496

and

Fix WANTLIB/LDEP sysutils/e2fsprogs for ads FLAVOR
fix MASTER_SITES

ok MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.186.2.2 2014/02/06 08:35:12 jasper Exp $
d12 1
a12 1
REVISION-main=		4
d31 3
a33 2
MASTER_SITES=	http://ftp.samba.org/pub/samba/stable/ \
		http://ftp.samba.org/pub/samba/old-versions/
d37 2
a38 1
BUILD_DEPENDS=	${MODGNU_AUTOCONF_DEPENDS}
a113 1
LIB_DEPENDS += 		sysutils/e2fsprogs
d116 1
a116 1
WANTLIB += wind com_err uuid
@


1.185
log
@Unbreak with new Heimdal; get rid of self-cooked krb5-config since we
have it in base now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.184 2013/05/21 18:08:58 brad Exp $
d12 1
a12 1
REVISION-main=		0
d115 1
a115 1
WANTLIB += asn1 crypto gssapi heimbase heimntlm hx509 krb5 roken
@


1.184
log
@Update to Samba 3.6.15.

ok MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.183 2013/05/03 18:43:28 sthen Exp $
d12 1
d115 2
a116 1
WANTLIB+=		com_err
a151 4

post-extract:
	@@cp ${FILESDIR}/krb5-config ${WRKDIR}/bin
	@@chmod a+x ${WRKDIR}/bin/krb5-config
@


1.183
log
@extra sanity checking, ensure that the rc.d scripts run by the meta script
are executable, I needed it for the bacula script which runs daemons split
between two packages, ajacoutot suggested applying to other similar scripts.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.182 2013/05/03 03:06:08 brad Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.14
a11 1
REVISION-main=		0
@


1.182
log
@Update to Samba 3.6.14.

From MAINTAINER
ok giovanni@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.181 2013/04/27 15:44:21 ajacoutot Exp $
d12 1
@


1.181
log
@Tweak MESSAGEs/READMEs now that inetd(8) is off by default.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.180 2013/03/29 18:13:31 ajacoutot Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.13
a11 1
REVISION-main=		1
@


1.180
log
@Install the pkgconfig files.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.179 2013/03/28 15:26:47 brad Exp $
d12 1
a12 1
REVISION-main=		0
@


1.179
log
@Update to Samba 3.6.13.

ok MAINTAINER sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.178 2013/03/11 11:35:56 espie Exp $
d12 1
d160 3
@


1.178
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.177 2013/02/09 14:49:52 sthen Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.12
d27 2
a28 2
WANTLIB += asn1 c crypto cups execinfo gssapi iniparser krb5 m ncurses
WANTLIB += popt pthread readline ssl talloc tdb z
d60 1
a60 1
AUTOCONF_VERSION=	2.68
@


1.177
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.176 2013/01/30 23:22:05 brad Exp $
a25 3
PERMIT_PACKAGE_FTP=		Yes
PERMIT_DISTFILES_CDROM=		Yes
PERMIT_DISTFILES_FTP=		Yes
d126 3
a128 3
NO_REGRESS=		Yes
#REGRESS_TARGET=	test
#.ifmake regress
@


1.177.2.1
log
@Security fix for CVE-2013-4124;
missing integer wrap protection in EA list reading can cause server to loop with DoS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.177 2013/02/09 14:49:52 sthen Exp $
a11 1
REVISION-main=		0
@


1.176
log
@Update to Samba 3.6.12. Fixes two security issues with SWAT. CVE-2013-0213, CVE-2013-0214
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.175 2013/01/23 13:34:41 sthen Exp $
d97 1
a97 1
.if ${FLAVOR:L:Mldap} && ${FLAVOR:L:Mads}
d101 1
a101 1
.if ${FLAVOR:L:Mldap} || ${FLAVOR:L:Mads}
d108 1
a108 1
.if ${FLAVOR:L:Mads}
@


1.175
log
@bugfix update to Samba 3.6.11, from maintainer Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.174 2013/01/05 12:45:45 ajacoutot Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.11
@


1.174
log
@Explicitely compile --without-pam.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.173 2012/12/17 00:52:58 brad Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.10
a11 1
REVISION-main=		0
@


1.173
log
@Update to Samba 3.6.10. Also add a patch from naddy@@ to make use
of posix_openpt().

From MAINTAINER

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.172 2012/11/04 00:22:50 brad Exp $
d12 1
d67 1
@


1.172
log
@Update to Samba 3.6.9.

ok MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.171 2012/09/25 20:11:11 brad Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.9
@


1.171
log
@Update to Samba 3.6.8 and fix potential fd leaks upon error with the utmp code.

ok sthen@@ MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.170 2012/09/04 10:00:20 sthen Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.8
d30 2
a31 2
WANTLIB += asn1 c crypto cups execinfo gssapi krb5 m ncurses popt
WANTLIB += pthread readline ssl talloc tdb z
d42 1
a42 1
		devel/popt \
d45 1
@


1.170
log
@update to Samba 3.6.7, from Ian McWilliam (maintainer)
- sync md5 patch to configure.in with ticket 9037 upstream, suggested by Brad

ok maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.169 2012/08/25 10:14:37 ajacoutot Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.7
d62 1
a62 1
AUTOCONF_VERSION=	2.63
@


1.169
log
@Simplify how the order of the _pkg_scripts entries get reversed on stop.

from rpe, ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.168 2012/08/04 15:28:14 ajacoutot Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.6
a9 1
REVISION-main=		3
@


1.168
log
@Set rc_usercheck to NO.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.167 2012/08/04 14:45:34 ajacoutot Exp $
d10 1
a10 1
REVISION-main=		2
@


1.167
log
@Remove the cups FLAVOR and depends on cups,-libs.
Fix to build with cups >= 1.6.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.166 2012/07/04 13:00:46 ajacoutot Exp $
d10 1
a10 1
REVISION-main=		1
@


1.166
log
@Add comment that daemon_flags, daemon_user and daemon_class are not passed
to the child scripts.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.165 2012/06/27 07:29:17 sthen Exp $
d10 1
a10 1
REVISION-main=		0
d31 2
a32 1
WANTLIB=	c execinfo ncurses popt pthread readline talloc tdb>=3.0 z
d45 2
a46 1
		devel/libtalloc
d91 1
a91 1
FLAVORS=		cups ldap ads
a95 7
.if ${FLAVOR:L:Mcups}
LIB_DEPENDS+=		print/cups
WANTLIB+=		asn1 crypto gssapi krb5 m ssl z cups
.else
CONFIGURE_ARGS+= --disable-cups
.endif

d116 1
a116 1
WANTLIB+=		asn1 com_err crypto gssapi krb5
@


1.165
log
@Update to Samba 3.6.6, from maintainer Ian McWilliam.

o  Fix possible memory leaks in the Samba master process (bug #8970).
o  Fix uninitialized memory read in talloc_free().
o  Fix joining of XP Pro workstations to 3.6 DCs (bug #8373).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.164 2012/05/22 11:43:31 sthen Exp $
d10 1
@


1.164
log
@samba autoconf picks up uuid/uuid.h if installed; set BUILD_DEPENDS on
e2fsprogs to make sure dpb doesn't junk it. unclear if it actually changes
anything in the package but bumping anyway to be sure.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.163 2012/05/03 07:40:05 sthen Exp $
d8 1
a8 2
DISTNAME=		samba-3.6.5
REVISION-main=		0
@


1.163
log
@SECURITY update to Samba 3.6.5, from maintainer Ian McWilliam
http://www.samba.org/samba/security/CVE-2012-2111

Samba versions 3.4.x to 3.6.4 inclusive are affected by a
vulnerability that allows arbitrary users to modify privileges on a
file server.

Security checks were incorrectly applied to the Local Security
Authority (LSA) remote proceedure calls (RPC) CreateAccount,
OpenAccount, AddAccountRights and RemoveAccountRights allowing any
authenticated user to modify the privileges database.

This is a serious error, as it means that authenticated users can
connect to the LSA and grant themselves the "take ownership"
privilege. This privilege is used by the smbd file server to grant the
ability to change ownership of a file or directory which means users
could take ownership of files or directories they do not own.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.162 2012/04/28 10:52:08 ajacoutot Exp $
d9 1
d39 2
a40 1
BUILD_DEPENDS=	${MODGNU_AUTOCONF_DEPENDS}
d152 2
a153 2
            AUTOCONF_VERSION=${AUTOCONF_VERSION} \
            ./autogen.sh
@


1.162
log
@--localstatedir=/var is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.161 2012/04/22 13:44:09 ajacoutot Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.4
a9 1
REVISION-main=		1
@


1.161
log
@/etc/rc.d -> RCDIR
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.160 2012/04/16 21:58:34 sthen Exp $
a62 1
			--localstatedir="/var" \
@


1.160
log
@add patches to samba, from Brad, ok with maintainer, also tested by nigel@@

- backport *BSD sys_statvfs() wrapper
- tweak autoconf check for cups
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.159 2012/04/10 22:37:02 sthen Exp $
d10 1
a10 1
REVISION-main=		0
@


1.159
log
@*NASTY* security update to samba 3.6.4: remote code execution as root by
anonymous user.  https://www.samba.org/samba/security/CVE-2012-1182

Note when MFC'ing: do not sync the new entries in PLIST-main back to
stable, they depend on dirfd being a function.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.158 2012/04/10 22:01:20 sthen Exp $
d10 1
@


1.158
log
@fix WRKSRC/WRKDIST insanity
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.157 2012/03/29 13:38:49 sthen Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.3
@


1.157
log
@Change SEPARATE_BUILD=(concurrent|simple) to Yes; bsd.port.mk doesn't
make a distinction between these.  ok aja@@ dcoppa@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.156 2012/03/02 08:22:20 sthen Exp $
d139 1
a139 1
WRKDIST=	${WRKDIR}/${DISTNAME}/source3
d141 3
a143 3
SAMBA_DOCS=	${WRKSRC}/../README \
		${WRKSRC}/../docs/history \
		${WRKSRC}/../docs/registry/*.reg
d147 1
a147 1
SAMBA_MANPAGES= ${WRKSRC}/../docs/manpages
d165 1
a165 1
	@@cp -R ${WRKSRC}/../examples/* ${PREFIX}/share/examples/samba
d174 1
a174 1
	@@for i in ${WRKSRC}/../docs/*.pdf ; do \
d177 1
a177 1
	@@for i in ${WRKSRC}/../docs/htmldocs/* ; do \
d185 1
a185 1
	 ${WRKSRC}/../examples/smb.conf.default > ${SAMPLE_CONFIG}
@


1.156
log
@fix MASTER_SITES; eloshinsky at gmail
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.155 2012/02/16 21:36:08 sthen Exp $
d57 1
a57 1
#SEPARATE_BUILD=		simple
@


1.155
log
@Update to samba 3.6.3; various bugfixes. From maintainer Ian McWilliam,
also tested by nigel@@.

This rolls in the DoS fix which we previously handled via a patch.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.154 2012/01/31 09:12:58 sthen Exp $
d34 1
a34 1
		http://us2.samba.org/samba/ftp/old-versions/
@


1.154
log
@SECURITY fix for CVE-2012-0817, memory leak affecting samba 3.6.0 to 3.6.2
can cause DoS. Pointed out by maintainer.

http://ftp.samba.org/pub/samba/patches/security/samba-3.6.2-CVE-2012-0817.patch

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.153 2011/12/17 22:01:13 sthen Exp $
d8 1
a8 2
DISTNAME=		samba-3.6.1
REVISION-main=		1
@


1.154.2.1
log
@MFC samba update to 5.1-stable. From Ian McWilliam.

*NASTY* security update to samba 3.6.4: remote code execution as root by
anonymous user.  https://www.samba.org/samba/security/CVE-2012-1182
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.154 2012/01/31 09:12:58 sthen Exp $
d8 2
a9 1
DISTNAME=		samba-3.6.4
d35 1
a35 1
		http://ftp.samba.org/samba/ftp/old-versions/
@


1.154.2.2
log
@SECURITY update to Samba 3.6.5, from maintainer Ian McWilliam
http://www.samba.org/samba/security/CVE-2012-2111

Samba versions 3.4.x to 3.6.4 inclusive are affected by a
vulnerability that allows arbitrary users to modify privileges on a
file server.

Security checks were incorrectly applied to the Local Security
Authority (LSA) remote proceedure calls (RPC) CreateAccount,
OpenAccount, AddAccountRights and RemoveAccountRights allowing any
authenticated user to modify the privileges database.

This is a serious error, as it means that authenticated users can
connect to the LSA and grant themselves the "take ownership"
privilege. This privilege is used by the smbd file server to grant the
ability to change ownership of a file or directory which means users
could take ownership of files or directories they do not own.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.154.2.1 2012/04/11 14:14:29 sthen Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.5
@


1.153
log
@Where a program with an rc script _requires_ a certain command line
parameter to daemonize, move the parameter from daemon to daemon_flags,
so that the user cannot inadvertently prevent it from daemonizing by
adjusting the flags.

Discussed with ajacoutot and schwarze, this method was suggested
by schwarze@@ as a simpler alternative to my diff. ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.152 2011/10/21 20:10:51 sthen Exp $
d9 1
a9 1
REVISION-main=		0
@


1.152
log
@update to samba 3.6.1; lots of bugfixes.
similar diff / ok Ian McWilliam (maintainer).
also tested by dhill, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.151 2011/09/26 09:32:12 sthen Exp $
d9 1
@


1.151
log
@update to samba 3.6.0, from Ian McWilliam / Stefan Rinkes
tweaks/testing from me and nigel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.150 2011/09/16 11:13:40 espie Exp $
d8 1
a8 1
DISTNAME=		samba-3.6.0
d44 6
a49 6
MAKE_FLAGS+=	PASSWD_PROGRAM="/usr/bin/passwd"  \
		LIBSMBCLIENT_SOVER="${LIBsmbclient_VERSION}" \
		LIBSMBSHAREMODES_SOVER="${LIBsmbsharemodes_VERSION}" \
		LIBNETAPI_SOVER="${LIBnetapi_VERSION}" \
		LIBADDNS_SOVER="${LIBaddns_VERSION}" \
		LIBWBCLIENT_SOVER="${LIBwbclient_VERSION}"
@


1.150
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.149 2011/09/13 10:54:15 sthen Exp $
d8 1
a8 1
DISTNAME=		samba-3.5.11
a9 1
REVISION-main=		1
d13 4
a16 4
SHARED_LIBS=		smbclient	2.0 \
			smbsharemodes	0.0 \
			netapi		0.0 \
			wbclient	0.0
d30 1
a30 1
WANTLIB=	c execinfo ncurses popt pthread readline talloc tdb z
d39 1
a39 1
LIB_DEPENDS=	databases/tdb>=1.2 \
d57 1
a57 1
SEPARATE_BUILD=		simple
a75 1
			--with-pthreads \
d79 2
a80 1
			--enable-external-libtalloc=yes
d88 1
a88 1
FLAVORS=	  	cups ldap ads
d95 1
a95 1
WANTLIB+= 		asn1 crypto gssapi krb5 m ssl z cups
d108 1
a108 1
CONFIGURE_ARGS+= 	--without-ldap
d112 1
a112 1
CONFIGURE_ARGS+= 	--with-krb5="${WRKDIR}/usr"
d136 1
a136 1
#			--enable-nss-wrapper 
d142 2
a143 2
        	${WRKSRC}/../docs/history \
        	${WRKSRC}/../docs/registry/*.reg
@


1.149
log
@don't install manpages for non-existing programs; from Pascal Stumpf, feedback
from nigel@@ espie@@, earlier version ok maintainer.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.148 2011/08/22 10:03:24 giovanni Exp $
d10 1
a10 1
REVISION-main=		0
@


1.148
log
@
Bugfix update to 3.5.11, from maintainer Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.147 2011/07/29 08:13:51 giovanni Exp $
d10 1
@


1.147
log
@
Update to 3.5.10
Fixes:
CVE-2011-2522 (Cross-Site Request Forgery in SWAT) and
CVE-2011-2694 (Cross-Site Scripting vulnerability in SWAT).

From maintainer Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.146 2011/07/14 08:42:02 sthen Exp $
d8 1
a8 1
DISTNAME=		samba-3.5.10
@


1.147.2.1
log
@fix MASTER_SITES; eloshinsky at gmail
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.147 2011/07/29 08:13:51 giovanni Exp $
d34 1
a34 1
		http://ftp.samba.org/samba/ftp/old-versions/
@


1.147.2.2
log
@*NASTY* security update to samba-3.5.14: remote code execution as root by
anonymous user.  https://www.samba.org/samba/security/CVE-2012-1182

OK sthen@@ jeremy@@ gonzalo@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.147.2.1 2012/03/02 08:21:54 sthen Exp $
d8 1
a8 1
DISTNAME=		samba-3.5.14
@


1.146
log
@Add missing directory in PLIST-main (share/doc/samba/), pointed out by fgsch@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.145 2011/07/08 02:14:59 ajacoutot Exp $
d8 1
a8 1
DISTNAME=		samba-3.5.9
a11 2

REVISION-main=		1
@


1.145
log
@rc_scripts -> pkg_scripts
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.144 2011/06/15 19:34:45 sthen Exp $
d13 1
a13 1
REVISION-main=		0
@


1.144
log
@update to samba 3.5.9, from maintainer Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.143 2011/06/03 10:21:54 sthen Exp $
d12 3
@


1.143
log
@Change the sample cap_mkdb command so it only runs if login.conf.db is present.
ok Ian McWilliam, aja@@, landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.142 2011/06/02 13:41:40 ajacoutot Exp $
d8 1
a8 3
REVISION-main=		6

DISTNAME=		samba-3.5.8
@


1.142
log
@Add a consistent header that substitutes FULLPKGNAME for the READMEs.

ok jasper@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.141 2011/05/19 20:44:51 gsoares Exp $
d8 1
a8 1
REVISION-main=		5
@


1.141
log
@- use TRUEPREFIX instead of hardcoding it; ok aja@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.140 2011/04/17 08:33:14 sthen Exp $
d8 1
a8 1
REVISION-main=		4
@


1.140
log
@- remove libutf8 build dependency for the ldap flavours, locale support
in base is good enough.

- remove NULL casts which are no longer needed.

ok Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.139 2011/04/03 18:07:52 ajacoutot Exp $
d8 1
a8 1
REVISION-main=		3
@


1.139
log
@Rewrite samba.rc and make it a wrapper script that calls the provided
rc.d(8) script. This is much more simple, makes much more sense and
allow for proper debugging.

discussed with robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.138 2011/03/21 09:40:04 sthen Exp $
d8 1
a8 1
REVISION-main=		2
a107 1
BUILD_DEPENDS+=	misc/libutf8
@


1.138
log
@bsd.port.mk now specifies groff 1.21, no need to force the version in
BUILD_DEPENDS here. bump not needed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.137 2011/03/21 09:20:35 sthen Exp $
d8 1
a8 1
REVISION-main=		1
@


1.137
log
@- remove workaround for old groff
- remove MESSAGE-main referring to a config change, people upgrading
have had plenty of time to adapt

ok Ian McWilliam (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.136 2011/03/17 16:49:27 ajacoutot Exp $
d39 1
a39 2
BUILD_DEPENDS=	${MODGNU_AUTOCONF_DEPENDS} \
		textproc/groff>=1.21
@


1.136
log
@Remove all redirections -- rc.subr(8) now takes care of it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.135 2011/03/15 13:49:44 sthen Exp $
d8 1
a8 1
REVISION-main=		0
d39 2
a40 1
BUILD_DEPENDS=	${MODGNU_AUTOCONF_DEPENDS}
a159 3
# Samba's man pages kill OpenBSD's groff/nroff/man implementation.
# This workaround will be needed until the new usr.bin/mandoc is
# finished and enabled.
a162 9
	@@for file in ${SAMBA_MANPAGES}/*; do \
	 if [ -f $$file ]; then \
	  cp $$file $$file.crap; \
	  sed -e 's:\\FC::g' -e 's:\\F\[\]::g' -e 's:\.\\\":\ \\\":g' \
	   -e 's:SH-xref:Sx:g' -e 's:\\m\[\]::g' -e 's:toupper:tu:g' \
	   -e 's:\.\.\\\":\\\":g' -e 's:^.tu :\\":g' -e's:\\m\[blue\]::g' \
	   -e's:\\m\[\]::g' $$file.crap  > $$file; \
	 fi; \
	done
@


1.135
log
@update to 3.5.8, ok aja@@ giovanni@@ Ian McWilliam (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.134 2011/03/09 19:37:47 ajacoutot Exp $
d7 2
@


1.134
log
@These aren't needed either.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.133 2011/03/02 08:24:03 sthen Exp $
d8 1
a8 1
DISTNAME=		samba-3.5.7
a9 1
REVISION-main=		0
@


1.133
log
@SECURITY update to 3.5.7; fixes CVE-2011-0719 FD_SET overflow
Same diff from maintainer Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.132 2011/01/17 17:58:03 ajacoutot Exp $
d10 1
@


1.132
log
@Add rc scripts.
While here, fix the LOCALBASE vs PREFIX and SYSCONFDIR vs /etc mess.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.131 2010/12/06 19:41:54 ajacoutot Exp $
d8 1
a8 1
DISTNAME=		samba-3.5.6
a9 1
REVISION-main =		4
@


1.132.2.1
log
@SECURITY UPDATE to samba-3.5.8

Resolves CVE-2011-0719 FD_SET overflow and has bugfixes

ok ajacoutot jasper
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.132 2011/01/17 17:58:03 ajacoutot Exp $
d8 1
a8 3
REVISION-main=		2

DISTNAME=		samba-3.5.8
d10 1
@


1.131
log
@Remove a left-over powerpc optimization workaround.

from Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.130 2010/11/19 22:31:38 espie Exp $
d10 1
a10 1
REVISION-main =		3
@


1.130
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.129 2010/11/11 17:20:28 espie Exp $
d10 1
a10 1
REVISION-main =		2
@


1.129
log
@finish net WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.128 2010/11/06 07:56:48 ajacoutot Exp $
d39 4
a42 4
LIB_DEPENDS=	:tdb->=1.2:databases/tdb \
		::devel/popt \
		::devel/libexecinfo \
		::devel/libtalloc
d94 1
a94 1
LIB_DEPENDS+=		::print/cups
d105 1
a105 1
LIB_DEPENDS+=	::databases/openldap
d107 1
a107 1
BUILD_DEPENDS+=	::misc/libutf8
@


1.128
log
@Cosmetic, be consistent with how we set the rcs id in other files.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.127 2010/10/29 12:41:58 ajacoutot Exp $
d94 2
a95 2
LIB_DEPENDS+=		cups::print/cups
WANTLIB+= 		asn1 crypto gssapi krb5 m ssl z
d105 2
a106 1
LIB_DEPENDS+=	ldap,lber::databases/openldap
@


1.127
log
@Add RCS IDs and remove useless MESSAGEs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.126 2010/10/29 09:40:41 espie Exp $
d10 1
a10 1
REVISION-main =		1
@


1.126
log
@convert to new pkg-readmes. This one keeps a MESSAGE because it says
something.
(wanted to check multi-packages...)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.125 2010/10/18 19:07:19 sthen Exp $
d10 1
a10 1
REVISION-main =		0
@


1.125
log
@update Samba to 3.5.6; various bugfixes. From maintainer Ian McWilliam.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.124 2010/10/18 18:36:57 espie Exp $
d10 1
a182 3
	@@${SUBST_CMD} -o ${SHAREOWN} -g ${SHAREGRP} \
	    -c ${FILESDIR}/README.OpenBSD \
	    ${PREFIX}/share/doc/samba/README.OpenBSD
@


1.124
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.123 2010/09/18 12:36:27 sthen Exp $
d8 1
a8 1
DISTNAME=		samba-3.5.5
a14 1
			addns		0.0 \
d54 2
a55 1
USE_GMAKE=		yes
a58 1
USE_GROFF =	Yes
@


1.123
log
@new-style WANTLIB/LIB_DEPENDS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.121 2010/08/28 18:55:18 sthen Exp $
d59 1
@


1.122
log
@SECURITY update to samba 3.5.5; fixes CVE-2010-3069, CVE-2010-3069.
From maintainer Ian McWilliam.
@
text
@d30 1
a30 1
WANTLIB=	c ncurses pthread readline z
d39 4
a42 4
LIB_DEPENDS=	tdb.>=2:tdb->=1.2:databases/tdb \
		popt::devel/popt \
		execinfo::devel/libexecinfo \
		talloc::devel/libtalloc
@


1.121
log
@Run README.OpenBSD through SUBST_CMD, bump REVISION-main.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.120 2010/07/26 20:28:00 ajacoutot Exp $
d8 1
a8 1
DISTNAME=		samba-3.5.4
a9 1
REVISION-main=		4
@


1.120
log
@Remove obsolete powerpc workaround, from Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.119 2010/07/23 12:01:47 ajacoutot Exp $
d10 1
a10 1
REVISION-main=		3
d183 3
a185 1
	${INSTALL_DATA} ${FILESDIR}/README.OpenBSD ${PREFIX}/share/doc/samba
@


1.119
log
@Use "WORKGROUP" as a default workgroup name. It is the default in Mac OS
as well as previous Windows versions. At least it gives you a chance to
browse and mount smb shares with gvfs (or any other application using
smb.conf to get the workgroup name) without the need to configure
anything.

input and ok sthen@@ on a previous version of this diff
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.118 2010/07/14 07:20:18 sthen Exp $
d10 1
a10 1
REVISION-main=		2
a83 5

.if ${MACHINE_ARCH:Mpowerpc}
# XXX gcc 3.3 ICE
MAKE_FLAGS +=		CFLAGS_smbd/smb2_create.o=-O0
.endif
@


1.118
log
@Rather than use Makefile workarounds for the broken shared lib handling,
fix it in configure.in so it can be sent upstream. From Brad, looks ok to
Ian McWilliam (maintainer).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.117 2010/07/12 22:07:41 sthen Exp $
d10 1
a10 1
REVISION-main=		1
d202 1
@


1.117
log
@use REVISION, checked with before/after make show=PKGNAMES (plus some
extra-careful checking where there are complicated PSEUDO_FLAVORS).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.116 2010/07/02 14:42:29 giovanni Exp $
d10 1
a10 1
REVISION-main=		0
d90 2
a91 2
LDFLAGS+=		-L${LOCALBASE}/lib -Wl,--export-dynamic -Wl,--no-as-needed
CONFIGURE_ENV=		CPPFLAGS+="-I${LOCALBASE}/include" LDFLAGS="${LDFLAGS}"
d155 1
a155 1
	cd ${WRKSRC}; \
@


1.116
log
@
Tell the user how to correctly enable samba as a Pdc
ok Ian McWilliam (Maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.115 2010/06/25 17:39:12 sthen Exp $
d9 2
a10 1
PKGNAME-main=		${DISTNAME}p0
@


1.115
log
@update to 3.5.4, from new maintainer, Ian McWilliam.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.114 2010/05/26 08:47:43 kili Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}
@


1.114
log
@On powerpc, compile smbd/smb2_create.c with -O0 to avoid an ICE with gcc3.

ok, and some simplification, sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.113 2010/05/20 18:16:39 sthen Exp $
d8 1
a8 1
DISTNAME=		samba-3.5.3
d22 2
d134 8
a141 1
REGRESS_TARGET=		torture
@


1.113
log
@Update to 3.5.3, from Ian McWilliam
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.112 2010/04/28 08:02:38 sthen Exp $
d81 5
@


1.112
log
@Samba uses modules; mark it SHARED_ONLY and collapse PFRAG.shared-main
into PLIST-main. From Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.111 2010/04/26 17:31:57 sthen Exp $
d8 2
a9 2
DISTNAME=		samba-3.5.2
PKGNAME-main=		${DISTNAME}p0
@


1.111
log
@update Samba to 3.5.2, most of the work done by Ian McWilliam

Note that the default passdb backend has been changed to 'tdbsam'.
See /usr/local/share/doc/samba/README.OpenBSD (or files/README.OpenBSD)
for more information and instructions for people who wish to convert an
existing smbpasswd-based installation.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.110 2010/03/05 09:01:45 giovanni Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}
@


1.110
log
@
Fix man pages (spotted by Charles Smith)
Remove unused configure args
Regen plist
ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.109 2010/02/26 18:13:25 espie Exp $
d3 2
a4 2
COMMENT-main=	SMB and CIFS client and server for UNIX
COMMENT-docs=	additional documentation and examples for Samba
d6 3
a8 3
DISTNAME=		samba-3.0.37
PKGNAME-main=		${DISTNAME}p1
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}p0
d10 15
a24 2
SHARED_LIBS=		smbclient	1.0 \
			msrpc		1.0
d26 1
a26 11
CATEGORIES=	net

HOMEPAGE=	http://www.samba.org/

# GPLv2+
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

WANTLIB=	c ncurses readline
d32 1
a32 1
MODULES= 	converters/libiconv
d34 42
a75 1
LIB_DEPENDS=	popt::devel/popt
d77 2
a78 25
MAKE_FLAGS=	PASSWD_PROGRAM="/usr/bin/passwd" \
		LIBsmbclient_VERSION=${LIBsmbclient_VERSION} \
		LIBmsrpc_VERSION=${LIBmsrpc_VERSION}

CONFDIR=	${SYSCONFDIR}/samba
SAMBA_LOGDIR=	/var/log
SUBST_VARS=	CONFDIR

SEPARATE_BUILD= concurrent
CONFIGURE_STYLE= gnu
CONFIGURE_ARGS= --disable-fam \
		--localstatedir="/var" \
		--sbindir="${PREFIX}/libexec" \
		--with-configdir="${CONFDIR}" \
		--with-libdir="${PREFIX}/lib/samba" \
		--with-lockdir="/var/spool/samba" \
		--with-piddir="/var/run" \
		--with-logfilebase="${SAMBA_LOGDIR}" \
		--with-privatedir="${CONFDIR}" \
		--with-libsmbclient \
		--with-swatdir="${PREFIX}/share/swat" \
		--with-syslog \
		--with-utmp
CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include" \
		LDFLAGS="-L${LOCALBASE}/lib -Wl,--export-dynamic"
d80 4
a83 1
FLAVORS=        cups ldap ads
d86 1
a86 1
MULTI_PACKAGES= -main -docs
d89 2
a90 2
LIB_DEPENDS+=	cups::print/cups
WANTLIB += asn1 crypto gssapi krb5 m pthread ssl z
d96 1
a96 1
ERRORS+="Fatal: ldap and ads flavors conflict"
d103 1
a103 1
CONFIGURE_ARGS+= --without-ldap
d107 9
a115 2
CONFIGURE_ARGS+= --with-krb5="${WRKDIR}/usr"
WANTLIB+=	asn1 com_err gssapi krb5
d117 1
a117 1
CONFIGURE_ARGS+= --without-ads
d120 1
a120 5
.if ${FLAVOR:L:Mads}
WANTLIB+=	crypto
.endif

PKG_ARCH-docs=	*
d125 1
a125 1
NO_REGRESS=	Yes
d127 1
a127 1
WRKDIST=	${WRKDIR}/${DISTNAME}/source
d129 3
a131 3
SAMBA_DOCS=${WRKSRC}/../README \
        ${WRKSRC}/../docs/history \
        ${WRKSRC}/../docs/registry/*.reg
d137 5
d143 1
a143 1
	@@${SUBST_CMD} ${WRKSRC}/../docs/manpages/swat.8
d152 1
a152 1
         if [ -f $$file ]; then \
d191 6
a196 2
	@@ln -s samba/libmsrpc.so.${LIBmsrpc_VERSION} \
	 ${PREFIX}/lib/libmsrpc.so.${LIBmsrpc_VERSION}
@


1.110.2.1
log
@SECURITY FIX

Resolves CVE-2010-2063
patch from upstream

Note: -current's samba is not affected by this bug
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.110 2010/03/05 09:01:45 giovanni Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}p2
@


1.109
log
@fix FULLPKGPATH (ports is locked)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.108 2009/11/22 16:40:03 ajacoutot Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}p0
a53 3
		--with-ssl \
		--with-sslinc="/usr/include/ssl" \
		--with-ssllib="/usr/lib" \
d108 2
d113 3
d119 9
@


1.108
log
@Regen WANTLIB after CUPS gnutls -> openssl move.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.107 2009/10/11 19:45:46 sthen Exp $
d8 2
a9 1
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}
@


1.107
log
@SECURITY update to Samba 3.0.37. From Brad.

This is a security release to address CVE-2009-2813, CVE-2009-2948
and CVE-2009-2906.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.106 2009/09/15 17:37:21 jasper Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}
d68 1
a68 2
WANTLIB += asn1 crypto gcrypt gnutls gpg-error gssapi intl krb5
WANTLIB += m pthread z
@


1.106
log
@remove marc balmer as maintainer of all of his ports, to take away the
illusion marc still maintains them. as requested by himself.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.105 2009/06/30 21:38:38 naddy Exp $
d6 3
a8 3
DISTNAME=		samba-3.0.34
PKGNAME-main=		${DISTNAME}p2
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}p0
@


1.105
log
@security fix for CVE-2009-1888; from william@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.104 2009/05/22 14:06:13 ajacoutot Exp $
d7 2
a8 2
PKGNAME-main=		${DISTNAME}p1
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}
a14 2

MAINTAINER=	Marc Balmer <mbalmer@@openbsd.org>
@


1.105.2.1
log
@MFC:

SECURITY UPDATE

samba-3.0.37

Resolves:

CVE-2009-2813, CVE-2009-2948, and CVE-2009-2906

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.108 2009/11/22 16:40:03 ajacoutot Exp $
d6 2
a7 2
DISTNAME=		samba-3.0.37
PKGNAME-main=		${DISTNAME}
d16 2
d70 2
a71 1
WANTLIB += asn1 crypto gssapi krb5 m pthread ssl z
@


1.104
log
@- regen WANTLIB (from cups kerberos support)
- bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.103 2009/05/19 07:05:25 giovanni Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}p0
@


1.103
log
@
Fix pkgname-main
spotted by Mikolaj Kucharski
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.102 2009/05/14 17:05:46 giovanni Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}
d70 2
a71 1
WANTLIB+=	gcrypt gnutls gpg-error intl tasn1 m pthread z
@


1.102
log
@
Update to 3.0.34
"fine with me to commit it" jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.101 2009/04/10 11:59:06 ajacoutot Exp $
d7 1
@


1.101
log
@- fix WANTLIB after cups update
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.100 2008/12/07 03:52:56 brad Exp $
d6 1
a6 2
DISTNAME=		samba-3.0.33
PKGNAME-main=		${DISTNAME}p0
@


1.100
log
@Update to Samba 3.0.33. A security release to address CVE-2008-4314.

ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.99 2008/09/18 13:37:41 ajacoutot Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}
d70 1
a70 1
WANTLIB+=	ssl m pthread z
d93 1
a93 1
.if ${FLAVOR:L:Mads} || ${FLAVOR:L:Mcups}
@


1.100.2.1
log
@SECURITY FIX

Resolve CVE-2009-1888, from upstream

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.100 2008/12/07 03:52:56 brad Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}p0
@


1.99
log
@- SYSCONFDIR and LOCALBASE are already part of the generic SUBST_VARS

looks good to landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.98 2008/09/17 10:38:59 brad Exp $
d6 2
a7 2
DISTNAME=		samba-3.0.32
PKGNAME-main=		${DISTNAME}p0
@


1.98
log
@- Disable FAM so autoconf will not pull it in if it is installed
- Tweak how CONFIGURE_ARGS are passed along so as to remove
  cases where the Makefile will pass along --without-foo
  --with-foo
- Add missing crypto lib for WANTLIB with the ads FLAVOR

Part of the CONFIGURE_ARGS tweaking from form@@
Missing lib from WANTLIB pointed out by sthen@@

ok sthen@@ ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.97 2008/09/12 07:49:11 brad Exp $
d38 3
a40 3
CONFDIR=        ${SYSCONFDIR}/samba
SAMBA_LOGDIR=   /var/log
SUBST_VARS=     CONFDIR LOCALBASE SYSCONFDIR
@


1.97
log
@Update to Samba 3.0.32.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.96 2008/08/30 17:02:26 ajacoutot Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}
d44 2
a45 1
CONFIGURE_ARGS= --localstatedir="/var" \
a59 1

a68 1
CONFIGURE_ARGS+= --enable-cups
d70 1
a70 1
WANTLIB+=	ssl crypto m pthread z
d79 1
a79 2
.if ${FLAVOR:L:Mldap}
CONFIGURE_ARGS+= --with-ldap --without-ads
d83 1
a83 1
CONFIGURE_ARGS+= --without-ldap --without-ads
d87 1
a87 3
CONFIGURE_ARGS+= --with-ldap --with-krb5="${WRKDIR}/usr" --with-ads
LIB_DEPENDS+=	ldap,lber::databases/openldap
BUILD_DEPENDS+=	::misc/libutf8
d90 5
a94 1
CONFIGURE_ARGS+= --without-ldap --without-ads
@


1.96
log
@- don't use $SYSCONFDIR for base system files (which are always
installed under /etc, whatever $SYSCONFDIR value is)
- s/PREFIX/LOCALBASE and the opposite where it makes sense
- README.OpenBSD is part of samba-docs, so no need to tell the user to
install samba-docs

ok mbalmer@@ who gave me ten bonus points for solving the samba puzzle!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.95 2008/08/29 19:50:20 mbalmer Exp $
d4 1
a4 1
COMMENT-docs=	documentation and examples for samba
d6 3
a8 3
DISTNAME=		samba-3.0.31
PKGNAME-main=		${DISTNAME}p0
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}p1
a106 1
        ${WRKSRC}/../docs/THANKS \
@


1.95
log
@s/SYSCONDIR/SYSCONFDIR/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.94 2008/07/25 22:01:17 brad Exp $
d7 2
a8 2
PKGNAME-main=		${DISTNAME}
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}p0
@


1.94
log
@Update to Samba 3.0.31; A bug fix release.

ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.93 2008/07/12 12:33:21 brad Exp $
d8 1
a8 1
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}
@


1.93
log
@Correct the permissions of the examples files.

Issue and an initial patch provided by RD Thrush <rd at thrush dot com>
ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.92 2008/07/11 11:40:33 brad Exp $
d6 2
a7 2
DISTNAME=		samba-3.0.30
PKGNAME-main=		${DISTNAME}p0
@


1.92
log
@Update to Samba 3.0.30; bug fixes and a security issue fixed,
CVE-2008-1105.

Specifically crafted SMB responses can result in a heap overflow
in the Samba client code. Because the server process, smbd, can
itself act as a client during operations such as printer
notification and domain authentication, this issue affects both
Samba client and server installations.

Feedback from sthen@@
ok mbalmer@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.91 2008/05/13 11:34:12 dlg Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}
d126 4
@


1.91
log
@disable a workaround for the MIT kerberos implementation that we
dont need because we use heimdal instead. this lets the ads flavor
of samba manage the kerberos keytab on openbsd.

no objections from mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.90 2008/03/18 09:15:50 dlg Exp $
d6 2
a7 2
DISTNAME=		samba-3.0.28
PKGNAME-main=		${DISTNAME}p1
d18 1
a18 1
# GPL
d114 1
a114 3
	@@perl -pi -e 's,!!SYSCONFDIR!!,${SYSCONFDIR},g;' \
		-e 's,!!LOCALBASE!!,${LOCALBASE},g' \
		${WRKSRC}/../docs/manpages/swat.8
d117 2
a118 2
	cp ${FILESDIR}/krb5-config ${WRKDIR}/bin
	chmod a+x ${WRKDIR}/bin/krb5-config
@


1.90
log
@add support for talking to active directory with an ads flavor.

ok mbalmer@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.88 2007/12/14 08:53:27 mbalmer Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}p0
@


1.89
log
@tweak FAKE_FLAGS semantics to saner defaults.
@
text
@d7 1
a7 1
PKGNAME-main=		${DISTNAME}
d63 1
a63 1
FLAVORS=        cups ldap
d76 4
d88 9
d117 4
@


1.88
log
@Update Samba to version 3.0.28 and add two patches from FreeBSD to allow
for non FFS filesystems (e.g. CD-ROMs) to be shared with Samba again.

This fixes CVE-2007-6015 and several other security problems.

ok winiger
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.87 2007/10/25 09:46:44 wilfried Exp $
a34 3
		LIBsmbclient_VERSION=${LIBsmbclient_VERSION} \
		LIBmsrpc_VERSION=${LIBmsrpc_VERSION}
FAKE_FLAGS=	DESTDIR="${DESTDIR}" \
@


1.87
log
@fix plist, ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.86 2007/09/15 22:36:59 merdely Exp $
d6 3
a8 3
DISTNAME=		samba-3.0.25b
PKGNAME-main=		${DISTNAME}p0
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}p0
@


1.86
log
@Remove surrounding quotes in COMMENT*/PERMIT_*/BROKEN/ERRORS

Add $OpenBSD$ to p5-SNMP-Info/Makefile (ok kili@@, simon@@)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.85 2007/07/02 21:56:57 mbalmer Exp $
d7 2
a8 2
PKGNAME-main=		${DISTNAME}
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}
@


1.85
log
@Update to Samba 3.0.25b

See http://www.samba.org/samba/history/samba-3.0.25b.html for the full
list of changes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.84 2007/06/04 16:19:13 cnst Exp $
d3 2
a4 2
COMMENT-main=	"SMB and CIFS client and server for UNIX"
COMMENT-docs=	"documentation and examples for samba"
@


1.84
log
@add 'echo -n ...' to the rc.local example in pkg/MESSAGE; ok mbalmer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.83 2007/06/03 16:54:36 steven Exp $
d6 2
a7 2
DISTNAME=		samba-3.0.25a
PKGNAME-main=		${DISTNAME}p1
@


1.83
log
@fix config file location in man page.

ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.82 2007/05/28 20:03:01 mbalmer Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}p0
@


1.82
log
@Update to Samba 3.0.25a.

See http://www.samba.org/samba/history/samba-3.0.25a.html for full details.

SECURITY:

This update fixes the following vulnerabilites:
CVE-2007-2444, CVE-2007-2446, CVE-2007-2447.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2007/04/06 14:20:35 ajacoutot Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}
@


1.81
log
@- don't use hardcoded paths in swat man page
- regen patches while here

"if it works for you" mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.80 2007/03/29 22:12:06 deanna Exp $
d6 2
a7 2
DISTNAME=		samba-3.0.24
PKGNAME-main=		${DISTNAME}p1
d9 2
a10 2
SHARED_LIBS=		smbclient	0.3 \
			msrpc		0.2
d46 1
a46 2
AUTOCONF_VERSION= 2.59
CONFIGURE_STYLE= autoconf
@


1.80
log
@Adjust cups flavor WANTLIB since it's moved from gnutls to openssl.

ok mbalmer, pvalchev
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2007/02/06 07:01:13 mbalmer Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}p0
d103 5
@


1.79
log
@Security update to Samba 3.0.24.

This fixes the following problems:

o CVE-2007-0452 (Potential Denial of Service bug in smbd)
o CVE-2007-0453 (Buffer overrun in NSS host lookup Winbind
NSS library on Solaris)
o CVE-2007-0454 (Format string bug in afsacl.so VFS plugin)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2007/02/05 21:11:24 mbalmer Exp $
d7 1
d75 1
a75 2
WANTLIB+=	gcrypt gnutls gpg-error m pthread z
MODULES=	devel/gettext
@


1.78
log
@Correct path to swat in swat(8), remove instructions on how to install swat
from source.
Found by Bachman Kharazmi <bahkha@@gmail.com>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.77 2006/12/14 09:07:56 steven Exp $
d6 1
a6 2
DISTNAME=		samba-3.0.23d
PKGNAME-main=		${DISTNAME}p2
d25 2
a26 1
MASTER_SITES=	http://us2.samba.org/samba/ftp/ \
@


1.77
log
@use BASE_PKGPATH instead of homegrown variable, no bumps needed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.76 2006/11/25 13:00:41 espie Exp $
d7 1
a7 1
PKGNAME-main=		${DISTNAME}p1
@


1.76
log
@new MULTI_PACKAGES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.75 2006/11/20 20:00:05 bernd Exp $
d42 1
a42 2
MAINPATH=	${PKGPATH}${FLAVOR_EXT:S/-/,/g}
SUBST_VARS=     CONFDIR LOCALBASE SYSCONFDIR MAINPATH
@


1.75
log
@Fix {BUILD,RUN}_DEPENDS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.74 2006/11/18 11:42:26 mbalmer Exp $
d3 1
a3 1
COMMENT=	"SMB and CIFS client and server for UNIX"
d7 1
a7 1
PKGNAME=		${DISTNAME}p0
d42 2
a43 1
SUBST_VARS=     CONFDIR LOCALBASE SYSCONFDIR
d70 1
a70 2
MULTI_PACKAGES= -docs
SUBPACKAGE?=
d89 4
a92 6
.if defined(PACKAGING) && ${SUBPACKAGE} == "-docs"
PKG_ARCH=	*
LIB_DEPENDS=
WANTLIB=
MODULES=
.endif
@


1.74
log
@misc/libutf8 is a build dependency for the ldap flavor.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2006/11/15 21:11:04 mbalmer Exp $
d84 1
a84 1
BUILD_DEPENDS+=	utf8::misc/libutf8
@


1.73
log
@Update to Samba 3.0.23d.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2006/11/11 15:16:24 mbalmer Exp $
d7 1
d84 1
@


1.72
log
@Fix some WANTLIB entries.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2006/10/29 12:55:50 mbalmer Exp $
d6 1
a6 2
DISTNAME=		samba-3.0.23c
PKGNAME=		${DISTNAME}p1
@


1.71
log
@Enable logging to syslog.  Requested by Jeff Ross <jross@@openvistas.net> a
while ago.  Why not.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2006/10/20 13:21:33 sturm Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p0
d75 1
a75 1
WANTLIB+=	gcrypt gnutls gpg-error z
d83 1
a83 2
LIB_DEPENDS+=	ldap,lber::databases/openldap \
		utf8::misc/libutf8
@


1.70
log
@use in ${SYSCONFDIR} in post-install, not /etc
no need to bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2006/10/03 14:07:10 mbalmer Exp $
d7 1
d60 1
@


1.69
log
@Update to Samba-3.0.23c.  Tested on various platforms and also with local
KDE clients (Konqueror).

ok brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2006/08/09 12:54:04 bernd Exp $
d133 1
a133 1
	@@rmdir ${WRKINST}/etc/samba
@


1.68
log
@Add security fix for CVE-2006-3403. http://secunia.com/advisories/20980/

Change LD_CONFIGURE_FLAGS to make VFS modules work. (from mbalmer@@)

ok espie@@, mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2006/02/17 16:02:17 mbalmer Exp $
d6 1
a6 2
DISTNAME=		samba-3.0.21b
PKGNAME=		${DISTNAME}p3
d8 2
a9 2
SHARED_LIBS=		smbclient	0.2 \
			msrpc		0.1
d133 2
@


1.68.2.1
log
@This security update fixes the following problems:

o CVE-2007-0452 (Potential Denial of Service bug in smbd)
o CVE-2007-0454 (Format string bug in afsacl.so VFS plugin)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2006/08/09 12:54:04 bernd Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p4
@


1.67
log
@Bump the package name after changing the pkg/MESSAGE.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2006/02/10 18:33:46 steven Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p2
d63 1
a63 1
		LDFLAGS="-L${LOCALBASE}/lib"
@


1.67.2.1
log
@MFC:
Add security fix for CVE-2006-3403. http://secunia.com/advisories/20980/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2006/02/17 16:02:17 mbalmer Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p3
@


1.67.2.2
log
@This security update fixes the following problems:

o CVE-2007-0452 (Potential Denial of Service bug in smbd)
o CVE-2007-0454 (Format string bug in afsacl.so VFS plugin)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67.2.1 2006/08/11 04:17:29 sturm Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p4
@


1.66
log
@fix WANTLIB for cups flavor.

ok bernd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2006/02/08 16:20:47 bernd Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p1
@


1.65
log
@Fix left over example dir. Bump PKGNAME.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2006/02/02 09:40:43 mbalmer Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p0
d74 2
a75 1
WANTLIB+=	crypto ssl
@


1.64
log
@Update to Samba 3.0.21b.

requested by and ok brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2005/05/03 04:33:24 sturm Exp $
d7 1
@


1.63
log
@List share/examples/samba/ in PLIST and PLIST-docs.  Bump package name.

found and reported by espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2006/01/03 21:21:52 steven Exp $
d6 1
a6 2
DISTNAME=		samba-3.0.20b
PKGNAME=		${DISTNAME}p2
d8 2
a9 1
SHARED_LIBS=		smbclient 0.1
d33 2
a34 1
		LIBsmbclient_VERSION=${LIBsmbclient_VERSION}
d36 3
a38 2
		LIBsmbclient_VERSION=${LIBsmbclient_VERSION}
 
a127 1
	#@@rm ${PREFIX}/lib/libsmbclient.so.${LIBsmbclient_VERSION}
d130 2
@


1.62
log
@SHARED_LIBS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2005/11/03 19:52:18 mbalmer Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p1
@


1.61
log
@Add a message to give directions for a simple Samba setup.

requested by espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2005/11/03 17:58:10 mbalmer Exp $
d9 1
d32 4
a35 2
MAKE_FLAGS=	PASSWD_PROGRAM="/usr/bin/passwd"
FAKE_FLAGS=	DESTDIR="${DESTDIR}"
d126 3
a128 3
	#@@rm ${PREFIX}/lib/libsmbclient.so.0.1
	@@ln -s samba/libsmbclient.so.0.1 \
	 ${PREFIX}/lib/libsmbclient.so.0.1
@


1.60
log
@Add a DESCR that makes more sense.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2005/11/03 15:10:20 mbalmer Exp $
d36 1
a36 1
SUBST_VARS=     CONFDIR
@


1.59
log
@Correct filename extensions for shared libraries.

requested by espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2005/05/03 04:33:24 sturm Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p0
@


1.58
log
@Update to Samba 3.0.20b.

Note for LDAP users:  The 'ldap filter' statement in smb.conf is no
longer available.
@
text
@d7 1
d123 3
@


1.57
log
@Activate mickeys utmp support.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2005/09/12 16:54:29 mbalmer Exp $
d6 2
a7 3
DISTNAME=		samba-3.0.13
PKGNAME=		${DISTNAME}p2
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}p2
@


1.56
log
@Add utmp patch from mickey.  Bump package name.

ok mickey@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2005/09/07 10:42:05 espie Exp $
d53 2
a54 1
		--with-ssllib="/usr/lib"
@


1.55
log
@mark that this used to be called net/samba/stable.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2005/08/16 13:22:51 espie Exp $
d7 2
a8 2
PKGNAME=		${DISTNAME}p1
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}p1
@


1.54
log
@missing bump, okay pval
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2005/05/27 04:54:40 sturm Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p0
@


1.54.2.1
log
@MFC:
Add security fix for CVE-2006-3403. http://secunia.com/advisories/20980/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2005/08/16 13:22:51 espie Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p1
@


1.53
log
@fix some NULL pointer sentinels
fix pathes in the port's Makefile
add a missing directory to PLIST

ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2005/05/03 04:33:24 sturm Exp $
d8 1
a8 1
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}p0
@


1.52
log
@find old versions on MASTER_SITES

ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2005/04/09 17:04:17 alek Exp $
d7 1
d31 2
a32 8
MAKE_FLAGS=     PASSWD_PROGRAM="/usr/bin/passwd"
FAKE_FLAGS=     prefix="${WRKINST}${PREFIX}" \
                BASEDIR="${PREFIX}" \
		LIBDIR="${WRKINST}${PREFIX}/lib/samba" \
                PIDDIR="${WRKINST}/var/run" \
                SWATDIR="${WRKINST}${PREFIX}/share/swat" \
                SBINDIR="${WRKINST}${PREFIX}/libexec" \
                VARDIR="${WRKINST}/var"
d41 1
a41 2
CONFIGURE_ARGS=	--libdir="${PREFIX}/lib/samba" \
		--localstatedir="/var" \
d44 1
@


1.51
log
@- Fix -docs dependencies
- Bump PKGNAME

ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2005/04/03 11:20:37 mbalmer Exp $
d23 2
a24 1
MASTER_SITES=	http://us2.samba.org/samba/ftp/
@


1.50
log
@Update to Samba 3.0.13.

ok alek@@, espie@@, pval@@, xsa@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2003/10/26 09:33:23 sturm Exp $
d7 1
a7 1
FULLPKGNAME-docs=	${DISTNAME:S/-/-docs-/}
d66 1
d82 7
@


1.49
log
@tsk, tsk
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2001/12/26 19:18:20 brad Exp $
d3 2
a4 2
#     SUBDIR+= snapshot
     SUBDIR+= stable
d6 114
a119 1
.include <bsd.port.subdir.mk>
@


1.48
log
@snapshot instead of devel
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2001/12/26 19:15:09 brad Exp $
d6 1
a6 1
.include <bsd.subdir.mk>
@


1.47
log
@Move Samba 2.2.x into the stable dir. Make room for an eventual port of
the developement branch (3.0).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2001/12/04 00:41:46 dhartmei Exp $
d3 1
a3 1
#     SUBDIR+= devel
@


1.46
log
@Use /var/spool/samba instead of /var/spool/lock, since samba wants
specific permissions on it. From Mike Pechkin.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2001/10/24 15:33:57 dhartmei Exp $
d3 2
a4 1
COMMENT=	"SMB and CIFS client and server for UNIX"
d6 1
a6 88
DISTNAME=	samba-2.2.2
CATEGORIES=	net
NEED_VERSION=	1.481

HOMEPAGE=	http://www.samba.org/

MAINTAINER=	Daniel Hartmeier <daniel@@benzedrine.cx>

PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MASTER_SITES=	ftp://ftp.samba.org/pub/samba/ \
		http://us1.samba.org/samba/ftp/ \
		ftp://ca.samba.org/pub/samba/ \
		ftp://ftp.uni-trier.de/pub/unix/network/samba/ \
		ftp://ring.asahi-net.or.jp/pub/net/samba/ \
		ftp://ftp.funet.fi/pub/mirrors/ftp.samba.org/pub/samba/old-versions/

NO_REGRESS=	Yes

FAKE_FLAGS+=	prefix="${WRKINST}${PREFIX}" \
		BASEDIR="${WRKINST}${PREFIX}" \
		LIBDIR="${WRKINST}${PREFIX}/lib/samba" \
		SWATDIR="${WRKINST}${PREFIX}/share/swat" \
		SBINDIR="${WRKINST}${PREFIX}/libexec"

SEPARATE_BUILD=	concurrent
CONFIGURE_STYLE= autoconf
CONFIGURE_ARGS=	--libdir="${PREFIX}/lib/samba" \
		--localstatedir="/var" \
		--sbindir="${PREFIX}/libexec" \
		--with-configdir="${SYSCONFDIR}/samba" \
		--with-lockdir="/var/spool/samba" \
		--with-privatedir="${SYSCONFDIR}/samba" \
		--with-swatdir="${PREFIX}/share/swat" \
		--with-ssl \
		--with-sslinc=/usr/include/ssl \
		--with-ssllib=/usr/lib

# Warning: these aditional options have not been tested.
#CONFIGURE_ARGS+=       --with-afs
#CONFIGURE_ARGS+=       --with-dfs
#CONFIGURE_ARGS+=       --with-krb4=/etc/kerberosIV
#CONFIGURE_ARGS+=       --with-krb5=base-dir

MAKE_FLAGS=	PASSWD_PROGRAM="/usr/bin/passwd"

WRKDIST=	${WRKDIR}/${DISTNAME}/source

SAMBA_SPOOL=	/var/spool/samba
SAMBA_LOGDIR=	/var/log

SAMBA_DOCS=${WRKSRC}/../README \
	${WRKSRC}/../docs/THANKS \
	${WRKSRC}/../docs/history \
	${WRKSRC}/../docs/announce \
	${WRKSRC}/../docs/Registry/*.reg
SAMPLE_CONFIG=	${PREFIX}/share/examples/samba/smb.conf.default

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/samba/faq
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/samba/textdocs
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/samba
	@@cp -r ${WRKSRC}/../examples/* ${PREFIX}/share/examples/samba
	@@chown -R root.bin ${PREFIX}/share/examples/samba
	${INSTALL_DATA} ${FILESDIR}/README.OpenBSD ${PREFIX}/share/doc/samba
	@@for i in ${SAMBA_DOCS}; do \
	 ${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba ;	\
	done
	@@for i in ${WRKSRC}/../docs/faq/* ; do \
	 ${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba/faq ; \
	done
	@@for i in ${WRKSRC}/../docs/textdocs/* ; do \
	 if [ -f $$i ]; then \
	  ${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba/textdocs ;\
	 fi \
	done
	@@sed -e 's:/usr/spool/samba:${SAMBA_SPOOL}:g' \
	 -e 's:/usr/local/samba/var/log:${SAMBA_LOGDIR}/smbd:g' \
	 ${WRKSRC}/../examples/smb.conf.default > ${SAMPLE_CONFIG}
	${INSTALL_SCRIPT} ${WRKSRC}/script/mksmbpasswd.sh ${PREFIX}/bin
	${INSTALL_SCRIPT} ${WRKSRC}/script/convert_smbpasswd ${PREFIX}/bin
	@@chown root.bin ${PREFIX}/bin/smbpasswd
	@@chmod 111 ${PREFIX}/bin/smbpasswd

.include <bsd.port.mk>
@


1.45
log
@Update to 2.2.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2001/09/01 20:13:28 brad Exp $
d39 1
a39 1
		--with-lockdir="/var/spool/lock" \
@


1.44
log
@Don't try to enable Samba's ACL support when we do not have ACLs in
OpenBSD.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2001/08/29 13:26:15 dhartmei Exp $
d5 1
a5 1
DISTNAME=	samba-2.2.1a
d7 1
a7 1
NEED_VERSION=	1.435
d25 2
d63 1
a63 1
	${WRKSRC}/../docs/*.reg
@


1.43
log
@Update to 2.2.1a. Remove one patch (part of the originial distribution now),
ignore obsolete textdocs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2001/07/13 11:24:33 naddy Exp $
d7 1
a7 1
NEED_VERSION=	1.396
d32 1
a32 1
CONFIGURE_STYLE=	autoconf
a35 1
		--with-acl-support \
a90 1

@


1.42
log
@MASTER_SITES fix by Heikki Korpela <heko@@saitti.net>:
- Add ftp.funet.fi and ftp.sunet.se mirrors where available.
- Remove broken ftp.funet.fi references.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2001/06/25 15:14:26 dhartmei Exp $
d5 1
a5 1
DISTNAME=	samba-2.2.0a
d79 3
a81 1
	 ${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba/textdocs ;\
d87 1
@


1.41
log
@security bugfix, ok brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2001/05/19 00:10:03 matt Exp $
d22 2
a23 1
		ftp://ring.asahi-net.or.jp/pub/net/samba/
@


1.40
log
@fix for PR 1634, from maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2001/05/16 00:59:47 matt Exp $
d5 1
a5 1
DISTNAME=	samba-2.2.0
@


1.39
log
@- update to 2.2.0 (tdb.c patch is from samba CVS to fix a bug), new MAINTAINER (daniel@@benzedrine.cx)
- put daemons in ${PREFIX}/libexec, respect CFLAGS (me)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2001/04/18 18:55:00 dhartmei Exp $
d80 1
a80 1
	@@sed -e 's:/usr/spool/samba/:${SAMBA_SPOOL}:g' \
@


1.38
log
@Update to 2.0.9; requested by matt@@
SECURITY FIX for the /tmp hole not adequately fixed in 2.0.8.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2001/04/19 16:24:06 naddy Exp $
d5 1
a5 1
DISTNAME=	samba-2.0.9
d7 1
a7 6
NEED_VERSION=	1.384
MASTER_SITES=	ftp://ftp.samba.org/pub/samba/ \
		http://us1.samba.org/samba/ftp/ \
		ftp://ca.samba.org/pub/samba/ \
		ftp://ftp.uni-trier.de/pub/unix/network/samba/ \
		ftp://ring.asahi-net.or.jp/pub/net/samba/
d11 1
a11 1
MAINTAINER=	ports@@openbsd.org
d18 12
d31 1
a31 2
CONFIGURE_STYLE= autoconf
CONFIGURE_ENV=	LIBS=-lcurses
d34 4
d39 4
a42 6
		--with-lockdir="/var/spool/lock" \
		--with-swatdir="${PREFIX}/swat"

FAKE_FLAGS=	prefix="${WRKINST}${PREFIX}" \
		LIBDIR="${WRKINST}${PREFIX}/lib/samba" \
		SWATDIR="${WRKINST}${PREFIX}/swat"
d45 4
d50 1
a50 30
# uncomment these to add SSL support, note that this is only useful
# for connections with other samba clients, Windows machines do not
# support SSL encrypted SMB
#CONFIGURE_ARGS+=	--with-ssl
#CONFIGURE_ARGS+=	--with-sslinc=/usr/include/ssl
#CONFIGURE_ARGS+=	--with-ssllib=/usr/lib

# uncomment this if you want to build the smbwrapper library
#CONFIGURE_ARGS+=	--with-smbwrapper

# uncomment this if you want to include support for AFS
#CONFIGURE_ARGS+=	--with-afs

# uncomment this if you want to include support for DFS
#CONFIGURE_ARGS+=	--with-dfs

# uncomment this if you want support for Kerberos IV
#CONFIGURE_ARGS+=	--with-krb4=/etc/kerberosIV

# uncomment this if you want support for Kerberos 5
#CONFIGURE_ARGS+=	--with-krb5=base-dir

# uncomment this if you want LDAP support
#CONFIGURE_ARGS+=	--with-ldap

# uncomment this if you want NISPLUS password database support
#CONFIGURE_ARGS+=	--with-nisplus

# uncomment this if you want NISPLUS_HOME support
#CONFIGURE_ARGS+=	--with-nisplus-home
d88 1
@


1.37
log
@Quick fix to resolve readline's termcap dependency.
Problem reported by krw@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2001/04/18 12:24:24 naddy Exp $
d5 1
a5 1
DISTNAME=	samba-2.0.8
@


1.37.2.1
log
@MFC:
SECURITY FIX for the /tmp hole not adequately fixed in 2.0.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2001/05/09 14:55:49 naddy Exp $
d5 1
a5 1
DISTNAME=	samba-2.0.9
@


1.37.2.2
log
@SECURITY: update to 2.0.10
http://samba.org/samba/whatsnew/macroexploit.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37.2.1 2001/05/09 14:59:52 naddy Exp $
d5 1
a5 1
DISTNAME=	samba-2.0.10
@


1.36
log
@revert maintainer back to ports@@; requested by peter.galbavy@@knowledge.com
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2001/04/18 11:35:57 naddy Exp $
d25 1
@


1.35
log
@Update to 2.0.8: This release fixes a significant security vulnerability
that allows local users to corrupt local devices (such as raw disks).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2001/04/10 11:33:46 brad Exp $
d16 1
a16 1
MAINTAINER=	Peter Galbavy <Peter.Galbavy@@knowledge.com>
@


1.34
log
@- integrate COMMENT
- bump NEED_VERSION
- add name to MAINTAINER
- hardcoded /etc -> ${SYSCONFDIR}
- move example samba config from PREFIX/lib/samba ->
PREFIX/share/examples/samba
- fixup INSTALL/DEINSTALL
--
Ok'd by: maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2000/07/22 00:58:28 brad Exp $
d5 1
a5 1
DISTNAME=	samba-2.0.7
@


1.33
log
@- add HOMEPAGE
- remove FAKE=Yes
- GNU_CONFIGURE -> CONFIGURE_STYLE
- add @@comment with RCS id to PLIST
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.32 2000/07/19 10:15:42 peter Exp $
d7 1
a7 1
NEED_VERSION=	1.310
d16 1
a16 1
MAINTAINER=	Peter.Galbavy@@knowledge.com
d24 1
a24 1
CONFIGURE_STYLE= gnu
d27 1
a27 1
		--with-privatedir="/etc/samba" \
d42 1
d78 1
a78 1
SAMPLE_CONFIG=	${PREFIX}/lib/samba/smb.conf.sample
@


1.33.2.1
log
@MFC:
SECURITY: Update to 2.0.8.  This release fixes a significant
vulnerability that allows local users to corrupt local devices (such
as raw disks).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2000/07/22 00:58:28 brad Exp $
d3 1
a3 1
DISTNAME=	samba-2.0.8
d14 1
a14 1
MAINTAINER=	ports@@openbsd.org
@


1.33.2.2
log
@MFC:
SECURITY FIX for the /tmp hole not adequately fixed in 2.0.8.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33.2.1 2001/04/18 12:48:39 naddy Exp $
d3 1
a3 1
DISTNAME=	samba-2.0.9
@


1.33.2.3
log
@SECURITY: update to 2.0.10
http://samba.org/samba/whatsnew/macroexploit.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33.2.2 2001/05/09 15:00:58 naddy Exp $
d3 1
a3 1
DISTNAME=	samba-2.0.10
@


1.32
log
@CVS is gettig annoying - I specially watched out for Makefile in the
list of file being committed - and it was there.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2000/03/24 22:11:53 espie Exp $
d5 1
a5 1
NEED_VERSION=	1.213
d12 1
a20 2
FAKE=	Yes

d22 1
a22 1
GNU_CONFIGURE=	Yes
@


1.31
log
@Move all NEED_VERSION right after CATEGORY
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2000/03/23 18:02:58 brad Exp $
d3 1
a3 1
DISTNAME=	samba-2.0.6
@


1.31.2.1
log
@bring net as of cut-over date into 2.7 branch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2000/07/22 00:58:28 brad Exp $
d3 1
a3 1
DISTNAME=	samba-2.0.7
d5 1
a5 1
NEED_VERSION=	1.310
a11 1
HOMEPAGE=	http://www.samba.org/
d20 2
d23 1
a23 1
CONFIGURE_STYLE= gnu
@


1.30
log
@Fake
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2000/03/23 08:00:40 brad Exp $
d5 1
a11 1
NEED_VERSION=	1.213
@


1.29
log
@the sample config file should always be up to date
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2000/03/23 07:56:32 brad Exp $
d11 1
a11 1
NEED_VERSION=	1.191
d20 2
d30 4
a99 1
	@@PKG_PREFIX="${PREFIX}" sh ${PKGDIR}/INSTALL ${DISTNAME} POST-INSTALL
@


1.28
log
@- {yes,YES} -> Yes
- hardcoded /usr/local -> ${PREFIX}
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2000/02/15 05:04:59 turan Exp $
d88 1
a88 2
	@@if [ ! -f ${SAMPLE_CONFIG} ]; then \
	 sed -e 's:/usr/spool/samba/:${SAMBA_SPOOL}:g' \
d90 1
a90 2
	 ${WRKSRC}/../examples/smb.conf.default > ${SAMPLE_CONFIG} ; \
	fi
@


1.27
log
@espie will not shut up about this, DISTF -> DISTFILES, PKG -> PACKAGE
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2000/02/12 08:02:27 turan Exp $
d10 1
d15 4
a18 5
LICENSE_TYPE=		GPL
PERMIT_PACKAGE_CDROM=	YES
PERMIT_PACKAGE_FTP=	YES
PERMIT_DISTFILES_CDROM=	YES
PERMIT_DISTFILES_FTP=	YES
d21 1
a21 1
GNU_CONFIGURE=	yes
d26 1
a26 1
		--with-swatdir="/usr/local/swat"
d96 1
a96 1
	@@PKG_PREFIX="${PREFIX}" ${SH} ${PKGDIR}/INSTALL ${DISTNAME} POST-INSTALL
@


1.26
log
@gpl licenses
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2000/02/11 00:37:34 espie Exp $
d15 4
a18 4
PERMIT_PKG_CDROM=	YES
PERMIT_PKG_FTP=		YES
PERMIT_DISTF_CDROM=	YES
PERMIT_DISTF_FTP=	YES
@


1.25
log
@Use WRKDIST where appropriate.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2000/01/29 23:22:32 brad Exp $
d13 6
@


1.24
log
@upgrade to Samba 2.0.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 1999/12/29 07:19:38 brad Exp $
d10 1
d54 1
a54 1
WRKSRC=	${WRKDIR}/${DISTNAME}/source
@


1.23
log
@- change MASTER_SITES to ${MASTER_SITE_BACKUP} so this is retreivable again
- MAINTAINER should only be an e-mail address
- remove deprecated variables
- cleanup Makefile
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 1999/11/12 19:12:15 turan Exp $
d3 1
a3 1
DISTNAME=	samba-2.0.5a
d5 5
a9 1
MASTER_SITES=	${MASTER_SITE_BACKUP}
@


1.22
log
@set maintiner to Peter Galbavy <Peter.Galbavy@@knowledge.com>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 1999/07/24 20:50:00 niklas Exp $
d5 1
a5 5
MASTER_SITES=	ftp://ftp.samba.org/pub/samba/ \
		http://us1.samba.org/samba/ftp/	\
		ftp://ca.samba.org/pub/samba/ \
		ftp://ftp.uni-trier.de/pub/unix/network/samba/ \
		ftp://ring.asahi-net.or.jp/pub/net/samba/
d7 1
a7 7
MAINTAINER=	Peter Galbavy <Peter.Galbavy@@knowledge.com>

WRKSRC=		${WRKDIR}/${DISTNAME}/source

SAMPLE_CONFIG=	${PREFIX}/lib/samba/smb.conf.sample
SAMBA_SPOOL=	/var/spool/samba
SAMBA_LOGDIR=	/var/log
d11 5
a15 5
CONFIGURE_ARGS=	--libdir=${PREFIX}/lib/samba \
		--localstatedir=/var \
		--with-privatedir=/etc/samba \
		--with-lockdir=/var/spool/lock \
		--with-swatdir=/usr/local/swat
d49 11
a59 3
SAMBA_DOCS=${WRKDIR}/${DISTNAME}/docs/THANKS \
	${WRKDIR}/${DISTNAME}/docs/history \
	${WRKDIR}/${DISTNAME}/docs/announce \
d62 5
a66 4
	${MKDIR} ${PREFIX}/share/examples/samba
	${CP} -r ${WRKDIR}/${DISTNAME}/examples/* ${PREFIX}/share/examples/samba
	${MKDIR} ${PREFIX}/share/doc/samba/faq
	${MKDIR} ${PREFIX}/share/doc/samba/textdocs
d68 1
a68 2
	@@for i in ${SAMBA_DOCS} ${WRKDIR}/${DISTNAME}/docs/*.reg \
	 ${WRKDIR}/${DISTNAME}/README ; do \
d71 1
a71 1
	@@for i in ${WRKDIR}/${DISTNAME}/docs/faq/* ; do \
d74 2
a75 2
	@@for i in ${WRKDIR}/${DISTNAME}/docs/textdocs/* ; do \
		${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba/textdocs ;\
d78 1
a78 1
	 ${SED} -e 's:/usr/spool/samba/:${SAMBA_SPOOL}:g' \
d80 1
a80 1
	 ${WRKDIR}/${DISTNAME}/examples/smb.conf.default > ${SAMPLE_CONFIG} ; \
d82 3
a84 4
	${INSTALL_SCRIPT} ${WRKDIR}/${DISTNAME}/source/script/mksmbpasswd.sh \
	${PREFIX}/bin
	chown root.bin ${PREFIX}/bin/smbpasswd
	chmod 111 ${PREFIX}/bin/smbpasswd
a87 1

@


1.21
log
@2.0.5a replaced 2.0.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 1999/07/22 01:54:53 brad Exp $
d11 1
a11 1
MAINTAINER=	ports@@openbsd.org
@


1.20
log
@upgrade to Samba 2.0.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 1999/05/30 23:02:58 brad Exp $
d3 1
a3 1
DISTNAME=	samba-2.0.5
@


1.19
log
@- upgrade to Samba 2.0.4b
- add INSTALL and DEINSTALL scripts
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 1999/05/09 07:26:14 brad Exp $
d3 1
a3 1
DISTNAME=	samba-2.0.4b
@


1.18
log
@PKGNAME is not needed when DISTNAME is exactly the same
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 1999/04/06 17:50:40 marc Exp $
d3 1
a3 1
DISTNAME=	samba-2.0.3
d9 1
a9 1
		ftp://ring.asahi-net.or.jp/pub/net/samba/ 
d25 1
a25 1
		--with-swatdir=/usr/local/swat		
a58 7
MAN1=		make_smbcodepage.1 nmblookup.1 smbclient.1 smbrun.1 \
		smbstatus.1 smbtar.1 testparm.1 testprns.1
MAN5=		lmhosts.5 smb.conf.5 smbpasswd.5
MAN7=		samba.7
MAN8=		nmbd.8 smbd.8 smbmnt.8 smbmount.8 smbpasswd.8 smbumount.8 \
		swat.8

d65 1
a65 3
	${CP} -r ${WRKDIR}/${DISTNAME}/examples/* \
		${PREFIX}/share/examples/samba
.if !defined(NOPORTDOCS)
d69 3
a71 3
	for i in ${SAMBA_DOCS} ${WRKDIR}/${DISTNAME}/docs/*.reg		\
			${WRKDIR}/${DISTNAME}/README ; do		\
		${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba ;		\
d73 2
a74 2
	for i in ${WRKDIR}/${DISTNAME}/docs/faq/* ; do			\
		${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba/faq ;	\
d76 1
a76 1
	for i in ${WRKDIR}/${DISTNAME}/docs/textdocs/* ; do		\
d79 4
a82 20
.endif
	@@test -d ${SAMBA_SPOOL} 					\
		|| ${MKDIR} ${SAMBA_SPOOL} && chmod 1777 ${SAMBA_SPOOL}
	@@if [ ! -f ${SAMPLE_CONFIG} ]; then				\
		${SED} -e 's:/usr/spool/samba/:${SAMBA_SPOOL}:g'	\
		    -e 's:/usr/local/samba/var/log:${SAMBA_LOGDIR}/smbd:g'\
			${WRKDIR}/${DISTNAME}/examples/smb.conf.default	\
			> ${SAMPLE_CONFIG} ;				\
	fi
	${INSTALL_SCRIPT} \
		${WRKDIR}/${DISTNAME}/source/script/mksmbpasswd.sh 	\
		${PREFIX}/bin
	if [ ! -d /etc/samba ] ; then					\
		${MKDIR} /etc/samba;					\
		chown root.wheel /etc/samba ;				\
	fi
	if [ ! -f /etc/samba/smbpasswd ] ; then				\
		${CAT} /etc/passwd | ${PREFIX}/bin/mksmbpasswd.sh 	\
			> /etc/samba/smbpasswd ; 			\
		chmod 600 /etc/samba/smbpasswd ;			\
d84 2
d88 1
a88 1
	more ${FILESDIR}/README.OpenBSD
@


1.17
log
@MASTER_SITE changes; Chris Cappuccio <chris@@nmedia.net
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 1999/03/19 09:06:04 brad Exp $
a3 1
PKGNAME=	samba-2.0.3
@


1.16
log
@upgrade to samba 2.0.3; Andrew Lambeth <andrew@@nfr.net>
@
text
@d1 1
a1 1
# $OpenBSD$
d6 2
a7 1
MASTER_SITES=	http://us1.samba.org/samba/ftp/	\
a8 1
		ftp://samba.anu.edu.au/pub/samba/ \
@


1.15
log
@form@@vs.itam.nsc.ru -> form@@openbsd.org
@
text
@d1 1
a1 7
# New ports collection makefile for:	samba
# Version required:			1.9.18
# Date created:				22 Apr 1998
# Whom:					form
#
# $OpenBSD: Makefile,v 1.14 1998/09/10 06:49:25 marc Exp $
#
d3 2
a4 2
DISTNAME=	samba-1.9.18p10
PKGNAME=	samba-1.9.18.10
d6 5
a10 1
MASTER_SITES=	ftp://samba.anu.edu.au/pub/samba/
d12 1
a12 1
MAINTAINER=	form@@OpenBSD.ORG
a14 4
MAN1=		smbstatus.1 smbclient.1 smbrun.1 smbtar.1 testparm.1 testprns.1 make_smbcodepage.1
MAN5=		smb.conf.5
MAN7=		samba.7
MAN8=		smbd.8 nmbd.8 smbpasswd.8
a17 1
XSAMBA_SPOOL=	\/var\/spool\/samba
a18 1
XSAMBA_LOGDIR=	\/var\/log
d20 48
a67 2
SAMBA_DOCS=${WRKDIR}/${DISTNAME}/docs/INSTALL.sambatar \
	${WRKDIR}/${DISTNAME}/docs/THANKS \
a69 1
	${WRKDIR}/${DISTNAME}/docs/PROJECTS \
d73 2
a74 1
	${CP} -r ${WRKDIR}/${DISTNAME}/examples/* ${PREFIX}/share/examples/samba
d77 1
d79 2
a80 6
	for i in ${SAMBA_DOCS} ${WRKDIR}/${DISTNAME}/docs/*.txt		\
			${WRKDIR}/${DISTNAME}/docs/*.reg		\
			${WRKDIR}/${DISTNAME}/docs/*.htm		\
			${WRKDIR}/${DISTNAME}/*.txt			\
			${WRKDIR}/${DISTNAME}/README			\
			${WRKDIR}/${DISTNAME}/docs/README.* ; do	\
d86 3
d90 2
a91 1
	@@test -d ${SAMBA_SPOOL} || ${MKDIR} ${SAMBA_SPOOL} && chmod 1777 ${SAMBA_SPOOL}
d93 3
a95 3
		${SED} -e 's/__SAMBA_SPOOL__/${XSAMBA_SPOOL}/'		\
		    -e 's/__LOGDIR__/${XSAMBA_LOGDIR}/' 		\
			${FILESDIR}/smb.conf.default			\
d98 6
a103 4
	${INSTALL_SCRIPT} ${WRKDIR}/${DISTNAME}/source/mksmbpasswd.sh ${PREFIX}/bin
	if [ ! -d /etc/samba ] ; then				\
		${MKDIR} /etc/samba;				\
		chown root.wheel /etc/samba ;			\
d105 3
a107 2
	if [ ! -f /etc/samba/smbpasswd ] ; then			\
		${CAT} /etc/passwd | ${PREFIX}/bin/mksmbpasswd.sh > /etc/samba/smbpasswd ; \
d115 1
@


1.14
log
@update to 1.9.18p10; Andrew Lambeth <andrew@@nfr.net>
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.13 1998/08/11 13:32:35 form Exp $
d14 1
a14 1
MAINTAINER=	form@@vs.itam.nsc.ru
@


1.13
log
@new README
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.12 1998/08/05 02:36:36 form Exp $
d9 2
a10 2
DISTNAME=	samba-1.9.18p8
PKGNAME=	samba-1.9.18.8
@


1.12
log
@remove suid from smbpasswd
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.11 1998/06/15 02:38:09 form Exp $
d22 1
a22 1
SAMPLE_CONFIG=	/etc/samba/smb.conf.default
d36 1
a36 1
	${CP} -rp ${WRKDIR}/${DISTNAME}/examples/* ${PREFIX}/share/examples/samba
d68 1
a68 1
	chown root.wheel ${PREFIX}/bin/smbpasswd
@


1.11
log
@update to 1.9.18p8
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.10 1998/05/13 04:41:46 form Exp $
d69 1
a69 1
	chmod 4111 ${PREFIX}/bin/smbpasswd
@


1.10
log
@update samba to 1.9.18p7
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.10 1998/05/12 05:14:58 form Exp $
d9 2
a10 2
DISTNAME=	samba-1.9.18p7
PKGNAME=	samba-1.9.18.7
@


1.9
log
@update samba to 1.9.18p6
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.9 1998/05/11 19:21:11 form Exp $
d9 2
a10 2
DISTNAME=	samba-1.9.18p6
PKGNAME=	samba-1.9.18.6
@


1.8
log
@update samba to 1.9.18.5
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.8 1998/05/11 10:24:19 form Exp $
d9 2
a10 2
DISTNAME=	samba-1.9.18p5
PKGNAME=	samba-1.9.18.5
@


1.7
log
@
update makefile
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.0 1998/04/22 15:12:51 form Exp $
d9 2
a10 2
DISTNAME=	samba-1.9.18p4
PKGNAME=	samba-1.9.18.4
@


1.6
log
@fix post-install typo (from austin@@canuck.com)
@
text
@d1 6
a6 4
# OpenBSD makefile for:	samba
# Version required:			1.9.18p2
# Date created:				16 Nov 1997
# Whom:					ejovi
a7 1
# $OpenBSD: Makefile,v 1.5 1998/03/14 22:05:22 marc Exp $
d9 2
a10 1
DISTNAME=	samba-1.9.18p3
a12 1
WRKSRC=		${WRKDIR}/${DISTNAME}/source
d14 1
a14 1
MAINTAINER=	joey@@OpenBSD.ORG
d16 2
a17 1
MAN1=		smbstatus.1 smbclient.1 smbrun.1 smbtar.1 testparm.1 testprns.1
d22 11
a32 32
MAKE_FLAGS=	BASEDIR=$(PREFIX)
MAKE_FLAGS+=	SBINDIR=$(PREFIX)/sbin
MAKE_FLAGS+=	MANDIR=$(PREFIX)/man
MAKE_FLAGS+=	CONFIGFILE=/etc/smb.conf 
MAKE_FLAGS+=	LMHOSTSFILE=/etc/lmhosts
MAKE_FLAGS+=	SMB_PASSWD_FILE=/etc/smbpasswd
MAKE_FLAGS+=	VARDIR=/var/log
MAKE_FLAGS+=	SMBLOGFILE=/var/log/smb
MAKE_FLAGS+=	NMBLOGFILE=/var/log/nmb
MAKE_FLAGS+=	LOCKDIR=/var/spool/lock 

DOC=		Application_Serving.txt BROWSING.txt BUGS.txt CVS_ACCESS.txt \
		DIAGNOSIS.txt DNIX.txt DOMAIN.txt DOMAIN_CONTROL.txt \
		ENCRYPTION.txt Faxing.txt GOTCHAS.txt HINTS.txt \
		INSTALL.sambatar MIRRORS.txt NT4_PlainPassword.reg \
		NTDOMAIN.txt NetBIOS.txt OS2-Client-HOWTO.txt \
		PRINTER_DRIVER.txt PROJECTS Passwords.txt Printing.txt \
		README.DCEDFS README.jis README.sambatar SCO.txt SMBTAR.notes \
		Speed.txt Support.txt THANKS Tracing.txt UNIX-SMB.txt \
		UNIX_INSTALL.txt Win95.txt Win95_PlainPassword.reg WinNT.txt \
		announce cifsntdomain.txt history samba.lsm security_level.txt \
		wfw_slip.htm faq/sambafaq.txt


HTML=		Samba-Server-FAQ-1.html Samba-Server-FAQ-2.html \
		Samba-Server-FAQ.html Samba-Server-FAQ.sgml \
		Samba-meta-FAQ-1.html Samba-meta-FAQ-2.html \
		Samba-meta-FAQ-3.html Samba-meta-FAQ-4.html \
		Samba-meta-FAQ-5.html Samba-meta-FAQ-6.html \
		Samba-meta-FAQ.html Samba-meta-FAQ.sgml Samba-meta-FAQ.txt \
		sambafaq-1.html sambafaq-2.html sambafaq-3.html \
		sambafaq-4.html sambafaq-5.html sambafaq.html sambafaq.sgml \
d35 28
a62 3
	@@if [ ! -e /etc/smb.conf ]; then \
	    ${INSTALL_DATA} ${WRKDIR}/${DISTNAME}/examples/smb.conf.default \
		/etc/smb.conf; \
d64 7
a70 12
	@@${MKDIR} ${PREFIX}/share/doc/samba
	@@echo "Installing samba docs in ${PREFIX}/share/doc/samba"
.for doc in ${DOC}
	@@${INSTALL_DATA} ${WRKDIR}/${DISTNAME}/docs/${doc} \
		${PREFIX}/share/doc/samba
.endfor
	@@${MKDIR} ${PREFIX}/share/doc/html/samba
	@@echo "Installing samba FAQ in ${PREFIX}/share/doc/html/samba"
.for html in ${HTML}
	@@${INSTALL_DATA} ${WRKDIR}/${DISTNAME}/docs/faq/${html} \
		${PREFIX}/share/doc/html/samba
.endfor
a72 9

.if ${OPSYS} == "FreeBSD"
MAKE_FLAGS+= LIBSM=-lcrypt FLAGSM="-DFreeBSD -DBSD44"
.elif (${OPSYS} == "OpenBSD")
MAKE_FLAGS+= FLAGSM="-DBSD44 -DFAST_SHARE_MODES" LIBSM=
.endif

MAKE_FLAGS+=	-f

@


1.5
log
@Upgrade to samba-1.9.18p3 (old version no longer avail)
Install sample config file in /etc if no config file exists
Install doc in /usr/local/share/doc/samba
Install faq in /usr/local/share/doc/html/samba
Clean up packing list -- remove all but config files in /etc
Get rid of one instance of mktemp and some compile warnings
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.4 1998/01/29 15:10:01 niklas Exp $
d55 1
a55 1
	    @@${INSTALL_DATA} ${WRKDIR}/${DISTNAME}/examples/smb.conf.default \
@


1.4
log
@Update version, OpeBSD support is now native.  I noticed smb.conf is in
/usr/local/etc, as it is host-dependent it would be better off in /etc I
think, but I did not change that now.  Opinions wanted.
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.3 1997/11/17 21:47:37 joey Exp $
d8 1
a8 1
DISTNAME=	samba-1.9.18p2
a19 3
pre-install:
	@@${MKDIR} /usr/local/samba

d21 1
d23 3
a25 2
MAKE_FLAGS+=	SBINDIR=$(PREFIX)/sbin 
MAKE_FLAGS+=	LIBDIR=$(PREFIX)/etc
a28 2
MAKE_FLAGS+=	CONFIGFILE=$(PREFIX)/etc/smb.conf 
MAKE_FLAGS+=	LMHOSTSFILE=$(PREFIX)/etc/lmhosts
d30 40
@


1.3
log
@added $OpenBSD$, changed ejovi to joey...removed freebsd contact from ssh
@
text
@d2 1
a2 1
# Version required:			1.9.17p4
d6 1
a6 1
# $OpenBSD: Makefile,v 1.2 1997/11/16 22:01:36 todd Exp $
d8 1
a8 1
DISTNAME=	samba-1.9.17p4
@


1.2
log
@use latest samba sources
use make overrides instead of patching the Makefile.
pkg/DESCR: samba works on UNIX, not just FreeBSD.
@
text
@d6 1
a6 1
# $OpenBSD$
d13 1
a13 1
MAINTAINER=	ejovi@@OpenBSD.ORG
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
# Version required:			1.9.15p8
d5 2
d8 1
a8 1
DISTNAME=	samba-1.9.17p2
d23 11
d35 9
@


1.1.1.1
log
@
@
text
@@


1.1.1.2
log
@samba-1.9.18p4 port
@
text
@d1 4
a4 7
# New ports collection makefile for:	samba
# Version required:			1.9.18
# Date created:				22 Apr 1998
# Whom:					form
#
# $OpenBSD: Makefile,v 1.0 1998/04/22 15:12:51 form Exp $
#
d6 1
a6 2
DISTNAME=	samba-1.9.18p4
PKGNAME=	samba-1.9.18.4
d9 1
d11 1
a11 1
MAINTAINER=	form@@vs.itam.nsc.ru
d13 1
a13 2
WRKSRC=		${WRKDIR}/${DISTNAME}/source
MAN1=		smbstatus.1 smbclient.1 smbrun.1 smbtar.1 testparm.1 testprns.1 make_smbcodepage.1
d18 2
a19 49
SAMPLE_CONFIG=	/etc/samba/smb.conf.default
SAMBA_SPOOL=	/var/spool/samba
XSAMBA_SPOOL=	\/var\/spool\/samba
SAMBA_LOGDIR=	/var/log
XSAMBA_LOGDIR=	\/var\/log

SAMBA_DOCS=${WRKDIR}/${DISTNAME}/docs/INSTALL.sambatar \
	${WRKDIR}/${DISTNAME}/docs/THANKS \
	${WRKDIR}/${DISTNAME}/docs/history \
	${WRKDIR}/${DISTNAME}/docs/announce \
	${WRKDIR}/${DISTNAME}/docs/PROJECTS \

post-install:
	${MKDIR} ${PREFIX}/share/examples/samba
	${CP} -rp ${WRKDIR}/${DISTNAME}/examples/* ${PREFIX}/share/examples/samba
.if !defined(NOPORTDOCS)
	${MKDIR} ${PREFIX}/share/doc/samba/faq
	${INSTALL_DATA} ${FILESDIR}/README.OpenBSD ${PREFIX}/share/doc/samba
	for i in ${SAMBA_DOCS} ${WRKDIR}/${DISTNAME}/docs/*.txt		\
			${WRKDIR}/${DISTNAME}/docs/*.reg		\
			${WRKDIR}/${DISTNAME}/docs/*.htm		\
			${WRKDIR}/${DISTNAME}/*.txt			\
			${WRKDIR}/${DISTNAME}/README			\
			${WRKDIR}/${DISTNAME}/docs/README.* ; do	\
		${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba ;		\
	done
	for i in ${WRKDIR}/${DISTNAME}/docs/faq/* ; do			\
		${INSTALL_DATA} $$i ${PREFIX}/share/doc/samba/faq ;	\
	done
.endif
	@@test -d ${SAMBA_SPOOL} || ${MKDIR} ${SAMBA_SPOOL} && chmod 1777 ${SAMBA_SPOOL}
	@@if [ ! -f ${SAMPLE_CONFIG} ]; then				\
		${SED} -e 's/__SAMBA_SPOOL__/${XSAMBA_SPOOL}/'		\
		    -e 's/__LOGDIR__/${XSAMBA_LOGDIR}/' 		\
			${FILESDIR}/smb.conf.default			\
			> ${SAMPLE_CONFIG} ;				\
	fi
	${INSTALL_SCRIPT} ${WRKDIR}/${DISTNAME}/source/mksmbpasswd.sh ${PREFIX}/bin
	if [ ! -d /etc/samba ] ; then				\
		${MKDIR} /etc/samba;				\
		chown root.wheel /etc/samba ;			\
	fi
	if [ ! -f /etc/samba/smbpasswd ] ; then			\
		${CAT} /etc/passwd | ${PREFIX}/bin/mksmbpasswd.sh > /etc/samba/smbpasswd ; \
		chmod 600 /etc/samba/smbpasswd ;			\
	fi
	chown root.wheel ${PREFIX}/bin/smbpasswd
	chmod 4111 ${PREFIX}/bin/smbpasswd
	more ${FILESDIR}/README.OpenBSD
@


