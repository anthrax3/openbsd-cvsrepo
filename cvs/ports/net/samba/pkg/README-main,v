head	1.13;
access;
symbols
	OPENBSD_6_0:1.13.0.4
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.13.0.2
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.11.0.4
	OPENBSD_5_8_BASE:1.11
	OPENBSD_5_7:1.10.0.4
	OPENBSD_5_7_BASE:1.10
	OPENBSD_5_6:1.10.0.2
	OPENBSD_5_6_BASE:1.10
	OPENBSD_5_5:1.8.0.4
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.2
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.7.0.6
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.4
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.2
	OPENBSD_5_0:1.6.0.2
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.4.0.2
	OPENBSD_4_9_BASE:1.4;
locks; strict;
comment	@# @;


1.13
date	2015.08.25.11.41.15;	author jca;	state Exp;
branches;
next	1.12;
commitid	rLIhgY9u26eBpYOR;

1.12
date	2015.08.25.11.07.45;	author jca;	state Exp;
branches;
next	1.11;
commitid	VAHTI6fMMPysailI;

1.11
date	2015.07.07.14.43.36;	author ajacoutot;	state Exp;
branches;
next	1.10;
commitid	WQPaMXMumvuZgEof;

1.10
date	2014.07.11.16.20.37;	author ajacoutot;	state Exp;
branches;
next	1.9;
commitid	CySj5hGosumaE9xL;

1.9
date	2014.07.10.13.09.06;	author ajacoutot;	state Exp;
branches;
next	1.8;
commitid	Xpirey71VpT09196;

1.8
date	2013.04.27.15.44.21;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2011.09.26.09.32.12;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2011.06.03.10.21.54;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2011.06.02.13.41.40;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2011.01.17.17.58.04;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.11.06.07.56.48;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.10.29.12.41.58;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.10.29.09.40.41;	author espie;	state Exp;
branches;
next	;


desc
@@


1.13
log
@Add a note about nmbd being broken in AD DC setups, and bump.

Requested by giovanni@@, putting it here instead of current.html so that
new users will be aware too.
@
text
@$OpenBSD: README-main,v 1.12 2015/08/25 11:07:45 jca Exp $

+-----------------------------------------------------------------------
| Running ${FULLPKGNAME} on OpenBSD
+-----------------------------------------------------------------------

Configuration
=============
The configuration file, found at ${CONFDIR}/smb.conf can be used right
away for simple configurations.  Local users should be added to the
Samba user database using the pdbedit(1) utility in order to use the
Samba server.

# pdbedit -a -u <username>

Install the samba-docs package and see documentation files in
${PREFIX}/share/doc/samba and example config files in
${PREFIX}/share/examples/samba for more information.

Useful documentation is also available from the Samba wiki at

  https://wiki.samba.org/index.php/Main_Page

Winbind
=======
Winbind on OpenBSD does not support local user logins as there
is no nsswitch support.  Winbind support is included for external
systems like Dovecot or Squid that are able to use it to authenticate
users.

Nmbd and AD DC mode
===================
Note that nmbd(8) daemon currently doesn't work properly when samba is
set up as an AD DC controller.

Max open files limit
====================
To use Samba as a domain controller it is advised to bump the values of
openfiles-max in /etc/login.conf and kern.maxfiles over 16384.  If you
are using /etc/login.conf.db (not usually recommended) then be sure to
rebuild it.

Don't forget to add the entry kern.maxfiles=16384 to the
/etc/sysctl.conf file to keep the change across reboots.
@


1.12
log
@Tweak rc scripts and README.  Tests, input from and ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: README-main,v 1.11 2015/07/07 14:43:36 ajacoutot Exp $
d30 5
@


1.11
log
@Move some obvious sudo -> '#' (root) in READMEs.
@
text
@d1 1
a1 1
$OpenBSD: README-main,v 1.10 2014/07/11 16:20:37 ajacoutot Exp $
d7 6
a12 1
1. Edit ${SYSCONFDIR}/samba/smb.conf to suit your needs.
d14 1
a14 15
Steps 2 and 3 are only necessary if you want to enable swat (Samba 
Web Administration Tool). Please note that administering the server
with swat over a network is inadvisable as passwords are passed in
the clear. You can avoid this problem by using ssh forwarding to
port 901.

2. add the following entry to /etc/inetd.conf:

   ...
   swat  stream  tcp  nowait.400  root  ${TRUEPREFIX}/libexec/swat  swat
   ...

inetd(8) must be reloaded (or started). To enable it at boot, the
following line needs to be added to rc.conf.local(8):
inetd_flags=
d20 1
a20 5
Winbind on OpenBSD does not support local user logins as there
is no nsswitch support.

Winbind support is included for external systems like Dovecot or
Squid that are able to use it to authenticate users.
d22 1
a22 10
!!! ATTENTION !!!
The default passdb backend has been changed to 'tdbsam'! That breaks
existing setups using the 'smbpasswd' backend without explicit
declaration! Please use 'passdb backend = smbpasswd' if you would like
to stick to the 'smbpasswd' backend or convert your smbpasswd entries
using e.g. 'pdbedit -i smbpasswd -e tdbsam'.

The 'tdbsam' backend is much more flexible concerning per user settings
like 'profile path' or 'home directory' and there are some commands which
do not work with the 'smbpasswd' backend at all.
d24 13
a36 19
The configuration file, found at ${CONFDIR}/smb.conf can be used right
away for simple configurations.  Local users must be added to the Samba user
database using the pdbedit utility in order to use the Samba server.
        
# pdbedit -a -u <username>
or the old way if for smbpasswd
# smbpasswd -a <username>

Samba contains an implementation of the SMB2 protocol. It is
disabled by default.SMB2 can be enabled by setting 
"max protocol = smb2". SMB2 is a new implementation of the SMB 
protocol used by Windows Vista and higher.

To use Samba as a PDC the values of openfiles-max in /etc/login.conf
and kern.maxfiles should be increased to 16384.

Rebuild the login.conf.db file if necessary:

        # [ -f /etc/login/conf.db ] && cap_mkdb /etc/login.conf
d38 2
a39 2
Don't forget to add the entry kern.maxfiles=16384 to the /etc/sysctl.conf
file to keep the change across reboots.
@


1.10
log
@services(5) already contains what we need.
@
text
@d1 1
a1 1
$OpenBSD: README-main,v 1.9 2014/07/10 13:09:06 ajacoutot Exp $
d50 1
a50 1
$ sudo pdbedit -a -u <username>
d52 1
a52 1
$ sudo smbpasswd -a <username>
@


1.9
log
@rc.conf.local is in man(1) section 8, at least for now.
@
text
@d1 1
a1 1
$OpenBSD: README-main,v 1.8 2013/04/27 15:44:21 ajacoutot Exp $
a18 6
   ...

3. add the following entry to /etc/services:

   ...
   swat            901/tcp                 # samba admin service
@


1.8
log
@Tweak MESSAGEs/READMEs now that inetd(8) is off by default.
@
text
@d1 1
a1 1
$OpenBSD: README-main,v 1.7 2011/09/26 09:32:12 sthen Exp $
d28 1
a28 1
following line needs to be added to rc.conf.local(5):
@


1.7
log
@update to samba 3.6.0, from Ian McWilliam / Stefan Rinkes
tweaks/testing from me and nigel@@
@
text
@d1 1
a1 1
$OpenBSD: README-main,v 1.6 2011/06/03 10:21:54 sthen Exp $
d26 4
@


1.6
log
@Change the sample cap_mkdb command so it only runs if login.conf.db is present.
ok Ian McWilliam, aja@@, landry@@
@
text
@d1 1
a1 1
$OpenBSD: README-main,v 1.5 2011/06/02 13:41:40 ajacoutot Exp $
d56 4
a59 3
An EXPERIMENTAL implementation of the SMB2 protocol has been added.
SMB2 can be enabled by setting "max protocol = smb2". SMB2 is a new
implementation of the SMB protocol used by Windows Vista and higher.
@


1.5
log
@Add a consistent header that substitutes FULLPKGNAME for the READMEs.

ok jasper@@ sthen@@
@
text
@d1 1
a1 1
$OpenBSD: README-main,v 1.4 2011/01/17 17:58:04 ajacoutot Exp $
d65 1
a65 1
        # cap_mkdb /etc/login.conf
@


1.4
log
@Add rc scripts.
While here, fix the LOCALBASE vs PREFIX and SYSCONFDIR vs /etc mess.

ok robert@@
@
text
@d1 1
a1 1
$OpenBSD: README-main,v 1.3 2010/11/06 07:56:48 ajacoutot Exp $
d3 3
a5 1
Using samba package in an OpenBSD environment:
@


1.3
log
@Cosmetic, be consistent with how we set the rcs id in other files.
@
text
@d1 1
a1 1
$OpenBSD: README-main,v 1.2 2010/10/29 12:41:58 ajacoutot Exp $
d7 1
a7 21
2. Edit /etc/rc.conf.local:
   ...
   smbd_flags="-D"         # for normal use: "-D"
   nmbd_flags="-D"         # for normal use: "-D"
   ...

3. Edit /etc/rc.local:
   echo -n 'starting local daemons:'
   ...
   if [ -f ${SYSCONFDIR}/samba/smb.conf ]; then
       if [ X"${smbd_flags}" != X"NO" -a -x ${LOCALBASE}/libexec/smbd ]; then
           echo -n ' smbd';    ${LOCALBASE}/libexec/smbd ${smbd_flags}
       fi
       if [ X"${nmbd_flags}" != X"NO" -a -x ${LOCALBASE}/libexec/nmbd ]; then
           echo -n ' nmbd';    ${LOCALBASE}/libexec/nmbd ${nmbd_flags}
       fi
   fi
   ...
   echo '.'

Steps 4 and 5 are only necessary if you want to enable swat (Samba 
d13 1
a13 1
4. add the following entry to /etc/inetd.conf:
d16 1
a16 1
   swat  stream  tcp  nowait.400  root  ${LOCALBASE}/libexec/swat  swat
d19 1
a19 1
5. add the following entry to /etc/services:
d58 1
a58 1
To use Samba as a PDC the values of openfiles-max in ${SYSCONFDIR}/login.conf
d63 1
a63 1
        # cap_mkdb ${SYSCONFDIR}/login.conf
d65 1
a65 1
Don't forget to add the entry kern.maxfiles=16384 to the ${SYSCONFDIR}/sysctl.conf
@


1.2
log
@Add RCS IDs and remove useless MESSAGEs.
@
text
@d1 1
a1 1
# $OpenBSD$
@


1.1
log
@convert to new pkg-readmes. This one keeps a MESSAGE because it says
something.
(wanted to check multi-packages...)
@
text
@d1 2
@

