head	1.4;
access;
symbols
	OPENBSD_6_0:1.2.0.4
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2;
locks; strict;
comment	@# @;


1.4
date	2017.02.10.14.23.49;	author sthen;	state Exp;
branches;
next	1.3;
commitid	Xh6htv9sU0CE7ze4;

1.3
date	2017.01.12.14.28.54;	author sthen;	state Exp;
branches;
next	1.2;
commitid	LHhpBqwiGN6A9TVW;

1.2
date	2015.12.02.12.40.04;	author jca;	state Exp;
branches;
next	1.1;
commitid	JCTyEtb45rGjw7WV;

1.1
date	2015.10.22.13.48.40;	author sthen;	state Exp;
branches;
next	;
commitid	ikaS59N3nJON3fIk;


desc
@@


1.4
log
@update to fping-3.16
@
text
@$OpenBSD: patch-src_fping_c,v 1.3 2017/01/12 14:28:54 sthen Exp $
--- src/fping.c.orig	Thu Feb  9 09:22:25 2017
+++ src/fping.c	Fri Feb 10 14:21:23 2017
@@@@ -364,6 +364,9 @@@@ int main(int argc, char** argv)
             perror("cannot setuid");
     }
 
+    if (pledge("stdio inet rpath dns", NULL) == -1)
+        perror("pledge");
+
     ident = getpid() & 0xFFFF;
     verbose_flag = 1;
     backoff_flag = 1;
@@@@ -583,6 +586,11 @@@@ int main(int argc, char** argv)
         }
     }
 
+    if (!filename) { /* drop rpath if not reading addrs from file */
+        if (pledge("stdio inet dns", NULL) == -1)
+            perror("pledge");
+    }
+
     /* validate various option settings */
 
     if (ttl > 255) {
@@@@ -798,6 +806,14 @@@@ int main(int argc, char** argv)
         exit(num_noaddress ? 2 : 1);
     }
 
+    if (name_flag) { /* done with file, drop rpath */
+        if (pledge("stdio inet dns", NULL) == -1)
+            perror("pledge");
+    } else { /* and drop dns unless we do reverse lookups */
+        if (pledge("stdio inet", NULL) == -1)
+            perror("pledge");
+    }
+
     if (src_addr_present) {
         socket_set_src_addr(s, src_addr);
     }
@@@@ -1667,7 +1683,7 @@@@ int wait_for_reply(long wait_time)
 
 #ifndef IPV6
     ip = (struct ip*)buffer;
-#if defined(__alpha__) && __STDC__ && !defined(__GLIBC__)
+#if defined(__alpha__) && __STDC__ && !defined(__GLIBC__) && !defined(__OpenBSD__)
     /* The alpha headers are decidedly broken.
      * Using an ANSI compiler, it provides ip_vhl instead of ip_hl and
      * ip_v.  So, to get ip_hl, we mask off the bottom four bits.
@


1.3
log
@update to fping-3.15
@
text
@d1 4
a4 4
$OpenBSD: patch-src_fping_c,v 1.2 2015/12/02 12:40:04 jca Exp $
--- src/fping.c.orig	Wed Jan 11 09:07:47 2017
+++ src/fping.c	Thu Jan 12 14:28:05 2017
@@@@ -375,6 +375,9 @@@@ int main( int argc, char **argv )
d14 3
a16 3
@@@@ -589,6 +592,11 @@@@ int main( int argc, char **argv )
         }/* SWITCH */
     }/* WHILE */
d26 2
a27 3
@@@@ -806,6 +814,14 @@@@ int main( int argc, char **argv )
     else {
         usage(1);
d29 1
a29 1
+
d37 5
a41 4
     
     if(!num_hosts) {
         exit(num_noaddress ? 2 : 1);
@@@@ -1623,7 +1639,7 @@@@ int wait_for_reply(long wait_time)
d44 3
a46 3
     ip = ( struct ip* )buffer;
-#if defined( __alpha__ ) && __STDC__ && !defined( __GLIBC__ )
+#if defined( __alpha__ ) && __STDC__ && !defined( __GLIBC__ ) && !defined(__OpenBSD__)
@


1.2
log
@Unbreak on alpha; ok sthen@@

Amend an ifdef supposed to work around an exotic definition of "struct
ip" on whateverOS/alpha when you use an ANSI compiler...
@
text
@d1 5
a5 5
$OpenBSD: patch-src_fping_c,v 1.1 2015/10/22 13:48:40 sthen Exp $
--- src/fping.c.orig	Wed Oct 21 21:02:56 2015
+++ src/fping.c	Wed Dec  2 08:22:39 2015
@@@@ -369,6 +369,9 @@@@ int main( int argc, char **argv )
         setuid( getuid() );
a10 1
     prog = argv[0];
d13 2
a14 1
@@@@ -561,6 +564,11 @@@@ int main( int argc, char **argv )
d26 1
a26 1
@@@@ -776,6 +784,14 @@@@ int main( int argc, char **argv )
d39 3
a41 4
     if( !num_hosts )
         exit(1);
@@@@ -1493,7 +1509,7 @@@@ int wait_for_reply(long wait_time)
     ip = ( struct ip* )buffer;
d44 1
@


1.1
log
@update to fping-3.13 and patch to use pledge
@
text
@d1 3
a3 3
$OpenBSD$
--- src/fping.c.orig	Wed Oct 14 20:48:07 2015
+++ src/fping.c	Wed Oct 21 11:06:05 2015
d26 1
a26 2
@@@@ -775,6 +783,14 @@@@ int main( int argc, char **argv )
     }
d29 1
a29 1
+    }
d37 1
a37 1
     }
d40 10
@

