head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2013.04.23.09.31.33;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2013.04.20.16.22.55;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.2
log
@remove the (minimal) rtable support; shortly after it was added to the
OpenVPN port, "exec" was added to route(8) which provides the same support
in a more general way. use a command like this instead:

"route -T <table#> exec openvpn -daemon ..."
@
text
@$OpenBSD: patch-src_openvpn_options_c,v 1.1 2013/04/20 16:22:55 sthen Exp $

the rtable support in the 2.31 update is suspect; however it is does
also not appear to be particularly useful, seems to only do the same thing
as 'route -T ## exec openvpn' .. possible candidate for removal, or reworking
to do something more clever.

--- src/openvpn/options.c.orig	Fri Mar 22 18:02:30 2013
+++ src/openvpn/options.c	Mon Apr  1 17:55:36 2013
@@@@ -304,6 +304,7 @@@@ static const char usage_message[] =
   "                  can be matched in policy routing and packetfilter rules.\n"
 #endif
   "--txqueuelen n  : Set the tun/tap TX queue length to n (Linux only).\n"
+  "--rtable n      : Set the routing table (default=0, OpenBSD only)\n"
 #ifdef ENABLE_MEMSTATS
   "--memstats file : Write live usage stats to memory mapped binary file.\n"
 #endif
@@@@ -1502,6 +1503,7 @@@@ show_settings (const struct options *o)
 #endif
   SHOW_INT (rcvbuf);
   SHOW_INT (sndbuf);
+  SHOW_INT (rtable);
 #if defined(TARGET_LINUX) && HAVE_DECL_SO_MARK
   SHOW_INT (mark);
 #endif
@@@@ -4782,6 +4784,11 @@@@ add_option (struct options *options,
     {
       VERIFY_PERMISSION (OPT_P_SOCKBUF);
       options->sndbuf = positive_atoi (p[1]);
+    }
+  else if (streq (p[0], "rtable") && p[1])
+    {
+      VERIFY_PERMISSION (OPT_P_SOCKFLAGS);
+      options->rtable = positive_atoi (p[1]);
     }
   else if (streq (p[0], "mark") && p[1])
     {
@


1.1
log
@update to OpenVPN 2.31, from Bjorn Ketelaars, maintainer timeout
@
text
@d1 1
a1 1
$OpenBSD$
@

