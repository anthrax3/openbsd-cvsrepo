head	1.2;
access;
symbols
	OPENBSD_6_1:1.1.1.1.0.34
	OPENBSD_6_1_BASE:1.1.1.1
	OPENBSD_6_0:1.1.1.1.0.32
	OPENBSD_6_0_BASE:1.1.1.1
	OPENBSD_5_9:1.1.1.1.0.28
	OPENBSD_5_9_BASE:1.1.1.1
	OPENBSD_5_8:1.1.1.1.0.30
	OPENBSD_5_8_BASE:1.1.1.1
	OPENBSD_5_7:1.1.1.1.0.26
	OPENBSD_5_7_BASE:1.1.1.1
	OPENBSD_5_6:1.1.1.1.0.24
	OPENBSD_5_6_BASE:1.1.1.1
	OPENBSD_5_5:1.1.1.1.0.22
	OPENBSD_5_5_BASE:1.1.1.1
	OPENBSD_5_4:1.1.1.1.0.20
	OPENBSD_5_4_BASE:1.1.1.1
	OPENBSD_5_3:1.1.1.1.0.18
	OPENBSD_5_3_BASE:1.1.1.1
	OPENBSD_5_2:1.1.1.1.0.16
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.14
	OPENBSD_5_0:1.1.1.1.0.12
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.10
	OPENBSD_4_9_BASE:1.1.1.1
	OPENBSD_4_8:1.1.1.1.0.8
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.6
	OPENBSD_4_7_BASE:1.1.1.1
	OPENBSD_4_6:1.1.1.1.0.4
	OPENBSD_4_6_BASE:1.1.1.1
	OPENBSD_4_5:1.1.1.1.0.2
	OPENBSD_4_5_BASE:1.1.1.1
	naddy_20090120:1.1.1.1
	naddy:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2017.09.09.21.22.49;	author naddy;	state Exp;
branches;
next	1.1;
commitid	JfjQznIXnlRBDFDh;

1.1
date	2009.01.20.19.05.23;	author naddy;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.01.20.19.05.23;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@* Update to 1.1.0.
* Replace MESSAGE with rc file.
* Drop maintainership.
* Set PORTROACH.

ptpd-1.x implements PTPv1 (IEEE 1588-2002)
ptpd-2.x implements PTPv2 (IEEE 1588-2008)
PTPv2 is not backward compatible with PTPv1.
@
text
@$OpenBSD: patch-src_dep_sys_c,v 1.1.1.1 2009/01/20 19:05:23 naddy Exp $
Index: src/dep/sys.c
--- src/dep/sys.c.orig
+++ src/dep/sys.c
@@@@ -268,15 +268,25 @@@@ getRand(UInteger32 * seed)
 Boolean 
 adjFreq(Integer32 adj)
 {
+#if defined(__OpenBSD__)
+	int64_t freq;
+#else
 	struct timex t;
+#endif
 
 	if (adj > ADJ_FREQ_MAX)
 		adj = ADJ_FREQ_MAX;
 	else if (adj < -ADJ_FREQ_MAX)
 		adj = -ADJ_FREQ_MAX;
 
+#if defined(__OpenBSD__)
+	freq = (int64_t)adj << 32;
+
+	return !adjfreq(&freq, NULL);
+#else
 	t.modes = MOD_FREQUENCY;
 	t.freq = adj * ((1 << 16) / 1000);
 
 	return !adjtimex(&t);
+#endif
 }
@


1.1
log
@Initial revision
@
text
@d1 7
a7 6
$OpenBSD$
--- src/dep/sys.c.orig	Wed Mar 28 00:09:06 2007
+++ src/dep/sys.c	Tue Oct 28 12:46:32 2008
@@@@ -98,16 +98,26 @@@@ UInteger16 getRand(UInteger32 *seed)
 
 Boolean adjFreq(Integer32 adj)
d10 1
a10 1
+  int64_t freq;
d12 1
a12 1
   struct timex t;
d14 6
a19 6
   
   if(adj > ADJ_FREQ_MAX)
     adj = ADJ_FREQ_MAX;
   else if(adj < -ADJ_FREQ_MAX)
     adj = -ADJ_FREQ_MAX;
   
d21 1
a21 1
+  freq = (int64_t)adj << 32;
d23 1
a23 1
+  return !adjfreq(&freq, NULL);
d25 4
a28 4
   t.modes = MOD_FREQUENCY;
   t.freq = adj*((1<<16)/1000);
   
   return !adjtimex(&t);
a30 1
 
@


1.1.1.1
log
@Import ptpd 1.0.0

The PTP daemon (PTPd) implements the Precision Time protocol (PTP) as
defined by the IEEE 1588 standard. PTP was developed to provide very
precise time coordination of LAN connected computers.

with ckuethe@@
@
text
@@
