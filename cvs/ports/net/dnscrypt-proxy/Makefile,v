head	1.31;
access;
symbols
	OPENBSD_6_1:1.30.0.2
	OPENBSD_6_1_BASE:1.30
	OPENBSD_6_0:1.21.0.2
	OPENBSD_6_0_BASE:1.21
	OPENBSD_5_9:1.19.0.2
	OPENBSD_5_9_BASE:1.19
	OPENBSD_5_8:1.16.0.4
	OPENBSD_5_8_BASE:1.16
	OPENBSD_5_7:1.15.0.2
	OPENBSD_5_7_BASE:1.15
	OPENBSD_5_6:1.12.0.2
	OPENBSD_5_6_BASE:1.12
	OPENBSD_5_5:1.9.0.2
	OPENBSD_5_5_BASE:1.9
	OPENBSD_5_4:1.3.0.2
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.1.1.1.0.2
	OPENBSD_5_3_BASE:1.1.1.1
	sthen_20121012:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.31
date	2017.08.02.09.32.40;	author giovanni;	state Exp;
branches;
next	1.30;
commitid	RPZ3RJ1lXtwZGIEG;

1.30
date	2017.01.23.18.00.23;	author tj;	state Exp;
branches;
next	1.29;
commitid	w6SEKe3UO7bhbEqU;

1.29
date	2017.01.19.14.59.04;	author sthen;	state Exp;
branches;
next	1.28;
commitid	rltiWBo4hUd81h9f;

1.28
date	2017.01.05.14.23.30;	author sthen;	state Exp;
branches;
next	1.27;
commitid	gBJu8HY7b4yXcSaf;

1.27
date	2017.01.04.21.52.20;	author sthen;	state Exp;
branches;
next	1.26;
commitid	ByFGwcsPJ9Hpvycz;

1.26
date	2016.11.07.10.51.36;	author sthen;	state Exp;
branches;
next	1.25;
commitid	bXhLeQYbQdffqUSF;

1.25
date	2016.09.15.06.50.05;	author landry;	state Exp;
branches;
next	1.24;
commitid	EvabJul6WBJWW05r;

1.24
date	2016.09.13.21.36.47;	author tj;	state Exp;
branches;
next	1.23;
commitid	gRKGKRFVR5RWewHh;

1.23
date	2016.09.09.17.37.51;	author tj;	state Exp;
branches;
next	1.22;
commitid	rPYvSFnxrOez0AFU;

1.22
date	2016.08.12.11.50.31;	author sthen;	state Exp;
branches;
next	1.21;
commitid	N80r7fqteoV1h9jz;

1.21
date	2016.06.05.10.14.20;	author landry;	state Exp;
branches;
next	1.20;
commitid	mJnp9fiG7fQooWeV;

1.20
date	2016.04.04.16.09.09;	author naddy;	state Exp;
branches;
next	1.19;
commitid	u3lQjrjlcAL26lGp;

1.19
date	2016.02.04.14.29.25;	author sthen;	state Exp;
branches;
next	1.18;
commitid	D773wS2LXHPlKXe6;

1.18
date	2016.02.04.00.20.09;	author sthen;	state Exp;
branches;
next	1.17;
commitid	b4CoUgvOfPozZHlr;

1.17
date	2015.09.18.18.26.18;	author sthen;	state Exp;
branches;
next	1.16;
commitid	5XTaByGcc1uShdAV;

1.16
date	2015.06.11.14.23.09;	author sthen;	state Exp;
branches
	1.16.4.1;
next	1.15;
commitid	9lVCFTjpiPl7aHzz;

1.15
date	2015.01.06.21.32.49;	author sthen;	state Exp;
branches;
next	1.14;
commitid	LQb7utqeWdp9wDBo;

1.14
date	2015.01.02.20.21.06;	author jca;	state Exp;
branches;
next	1.13;
commitid	3bLuXFScms8KnrSQ;

1.13
date	2014.09.23.23.56.33;	author sthen;	state Exp;
branches;
next	1.12;
commitid	UK1f0xDucMkFWNnc;

1.12
date	2014.07.22.10.55.40;	author ajacoutot;	state Exp;
branches;
next	1.11;
commitid	3LzguPEQl5LkjlcD;

1.11
date	2014.07.10.13.09.06;	author ajacoutot;	state Exp;
branches;
next	1.10;
commitid	Xpirey71VpT09196;

1.10
date	2014.04.25.17.11.26;	author sthen;	state Exp;
branches;
next	1.9;

1.9
date	2013.12.05.10.45.32;	author sthen;	state Exp;
branches
	1.9.2.1;
next	1.8;

1.8
date	2013.10.25.21.01.50;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2013.10.23.13.14.07;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2013.10.23.12.42.20;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2013.10.22.19.51.59;	author jca;	state Exp;
branches;
next	1.4;

1.4
date	2013.08.15.11.02.23;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2013.07.09.13.43.06;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2013.03.11.11.35.46;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2012.10.12.15.20.00;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.10.12.15.20.00;	author sthen;	state Exp;
branches;
next	;

1.9.2.1
date	2014.06.06.19.21.33;	author sthen;	state Exp;
branches;
next	;
commitid	UTc2n5WW6b0jHaG6;

1.16.4.1
date	2016.02.04.00.21.14;	author sthen;	state Exp;
branches;
next	;
commitid	cJqVQE7BwowJVTy3;


desc
@@


1.31
log
@Update to 1.9.5
ok Frank Denis (Maintainer)
@
text
@# $OpenBSD: Makefile,v 1.30 2017/01/23 18:00:23 tj Exp $

COMMENT-main=		secure communications between a DNS client and resolver
COMMENT-plugins=	example plugins for dnscrypt-proxy

V=			1.9.5
DISTNAME=		dnscrypt-proxy-${V}
PKGNAME-main=		dnscrypt-proxy-${V}
PKGNAME-plugins=	dnscrypt-proxy-plugins-${V}

CATEGORIES=		net

MASTER_SITES=		https://download.dnscrypt.org/dnscrypt-proxy/ \
			https://download.dnscrypt.org/dnscrypt-proxy/old/

HOMEPAGE=		https://dnscrypt.org/

MAINTAINER=		Frank Denis <dnscrypt@@pureftpd.org>

# BSD
PERMIT_PACKAGE_CDROM=	Yes

MULTI_PACKAGES=		-main -plugins

commonWANTLIB=		execinfo kvm m sodium pthread

WANTLIB-main=		${commonWANTLIB} c ltdl
WANTLIB-plugins=	${commonWANTLIB} crypto ldns

commonLIB_DEPENDS=	devel/libexecinfo \
			security/libsodium

LIB_DEPENDS-main=	${commonLIB_DEPENDS} \
			devel/libtool,-ltdl
LIB_DEPENDS-plugins=	${commonLIB_DEPENDS} \
			net/ldns/libldns

CONFIGURE_STYLE=	gnu
CONFIGURE_ENV+=		CPPFLAGS=-I${LOCALBASE}/include \
			LDFLAGS=-L${LOCALBASE}/lib \
			ac_cv_header_uuid_uuid_h=no

CONFIGURE_ARGS+=	--enable-plugins \
			--enable-plugins-root \
			--enable-pie=no
# Don't force PIE, it's broken on at least arm. OpenBSD enables it
# by default on arch where it works anyway.

# for tests
USE_GMAKE=		yes

DOCS=			README-PLUGINS.markdown \
			README.markdown \
			DNSCRYPT-V2-PROTOCOL.txt

# there is also a config file in newer versions; it can be specified on
# the command-line, but it's incompatible with specifying other options there,
# so we can't force daemonizing, causing issues for the rc script.

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/dnscrypt-proxy
	cd ${WRKSRC}; ${INSTALL_DATA} ${DOCS} ${PREFIX}/share/doc/dnscrypt-proxy
	rm -f ${PREFIX}/lib/dnscrypt-proxy/*.la

.include <bsd.port.mk>
@


1.30
log
@fix wording in the pkg readme, bump REVISION-main

ok sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2017/01/19 14:59:04 sthen Exp $
d6 1
a6 2
V=			1.9.3
REVISION-main=		0
@


1.29
log
@update to dnscrypt-proxy-1.9.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2017/01/05 14:23:30 sthen Exp $
d7 1
@


1.28
log
@reinstate /old/ backup MASTER_SITES, lost in Pablo's diff. (not needed now,
but maybe later).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2017/01/04 21:52:20 sthen Exp $
d6 1
a6 1
V=			1.9.1
@


1.27
log
@update to dnscrypt-proxy-1.9.1, based on a diff from Pablo Méndez Hernández,
but skipping the new config file for now because we can't force daemonizing
for the rc script (or setting uid) while using the config file. (the ideal
situation for scripts would be to allow these flags to override things on
the config file).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2016/11/07 10:51:36 sthen Exp $
d13 2
a14 1
MASTER_SITES=		https://download.dnscrypt.org/dnscrypt-proxy/
@


1.26
log
@sync WANTLIB (readding idn to some where I was overzealous, plus some lzma/pthread)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2016/09/15 06:50:05 landry Exp $
d6 4
a9 2
V=			1.7.0
REVISION=		2
a10 1
DISTNAME=		dnscrypt-proxy-${V}
d12 2
a13 2
MASTER_SITES=		https://download.dnscrypt.org/dnscrypt-proxy/ \
			https://download.dnscrypt.org/dnscrypt-proxy/old/
a23 3
PKGNAME-main=		dnscrypt-proxy-${V}
PKGNAME-plugins=	dnscrypt-proxy-plugins-${V}

d54 4
@


1.25
log
@Now that --gc-sections has been disabled on powerpc (thanks jca@@!),
remove the hacks in ports to disable it locally. Those should build ootb
in the next-next bulk...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2016/09/13 21:36:47 tj Exp $
d7 1
a7 1
REVISION=		1
d26 1
a26 1
commonWANTLIB=		execinfo kvm m sodium
@


1.24
log
@add information on running multiple instances to the readme file, clean up
pkg description, switch homepage and master_sites to https.

ok sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2016/09/09 17:37:51 tj Exp $
a42 4

.if ${MACHINE_ARCH} == "powerpc"
CONFIGURE_ENV +=	libevent_cv_gc_sections_runs=no
.endif
@


1.23
log
@expand on the instructions for running dnscrypt-proxy with unbound.
couple minor grammar tweaks while here.

ok sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2016/08/12 11:50:31 sthen Exp $
d7 1
a7 1
REVISION=		0
d11 2
a12 2
MASTER_SITES=		http://download.dnscrypt.org/dnscrypt-proxy/ \
			http://download.dnscrypt.org/dnscrypt-proxy/old/
d14 1
a14 1
HOMEPAGE=		http://dnscrypt.org/
@


1.22
log
@update to dnscrypt-proxy-1.7.0, based on a diff from pablomh at gmail
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2016/06/05 10:14:20 landry Exp $
d7 1
@


1.21
log
@Fix on powerpc by passing libevent_cv_gc_sections_runs=no in CONFIGURE_ENV.

Since --gc-sections is broken on powerpc, but noone cared to okay jca@@'s
binutils fix to disable it completely, continue fixing ports one by
one...

Btw, realized dnscrypt-proxy uses its own modified copy of libevent.. yay.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2016/04/04 16:09:09 naddy Exp $
d6 1
a6 3
V=			1.6.1
REVISION-main=		0
REVISION-plugins=	0
@


1.20
log
@g/c PFRAG.shared
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2016/02/04 14:29:25 sthen Exp $
d44 5
@


1.19
log
@Update pkg-readme and rc script for dnscrypt-proxy; "-R opendns" was the
package's old default but this has been replaced in the csv file since
the OpenDNS acquisition.

There is now no default; select a server yourself and configure it as shown
in the readme.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2016/02/04 00:20:09 sthen Exp $
d8 1
@


1.18
log
@Update to dnscrypt-proxy 1.6.1

- Security: malformed packets could cause the OpenDNS deviceid,
OpenDNS set-client-ip, blocking and AAAA blocking plugins to use
uninitialized pointers, leading to a denial of service or possibly
code execution. The vulnerable code is present since dnscrypt-proxy
1.1.0. OpenDNS users and people using dnscrypt-proxy in order to block
domain names and IP addresses should upgrade as soon as possible.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2015/09/18 18:26:18 sthen Exp $
d7 1
@


1.17
log
@update to dnscrypt-proxy-1.6.0 and sync patch with recent upstream commit
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2015/06/11 14:23:09 sthen Exp $
d6 1
a6 1
V=			1.6.0
d53 1
a53 1
			TECHNOTES
@


1.16
log
@update to dnscrypt-proxy 1.5.0, reinstate arc4random_addrandom patch
lost during resync with upstream libevent
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2015/01/06 21:32:49 sthen Exp $
d6 1
a6 1
V=			1.5.0
a36 1
#BUILD_DEPENDS=		devel/libtool
@


1.16.4.1
log
@Update to dnscrypt-proxy 1.6.1

- Security: malformed packets could cause the OpenDNS deviceid,
OpenDNS set-client-ip, blocking and AAAA blocking plugins to use
uninitialized pointers, leading to a denial of service or possibly
code execution. The vulnerable code is present since dnscrypt-proxy
1.1.0. OpenDNS users and people using dnscrypt-proxy in order to block
domain names and IP addresses should upgrade as soon as possible.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2016/02/04 00:20:09 sthen Exp $
d6 1
a6 1
V=			1.6.1
d37 1
d54 1
a54 1
			DNSCRYPT-V2-PROTOCOL.txt
@


1.15
log
@update to dnscrypt-proxy 1.4.3; update (modified) libevent for evbuffer
CVE fix, add new servers and change IPs of some existing servers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2015/01/02 20:21:06 jca Exp $
d6 1
a6 1
V=			1.4.3
@


1.14
log
@Maintenance update to dnscrypt-proxy-1.4.2

ok sthen@@, MAINTAINER timeout.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2014/09/23 23:56:33 sthen Exp $
d6 1
a6 1
V=			1.4.2
@


1.13
log
@update to dnscrypt-proxy-1.4.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2014/07/22 10:55:40 ajacoutot Exp $
d6 1
a6 1
V=			1.4.1
@


1.12
log
@Tweak documentation according to recent rc changes.

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2014/07/10 13:09:06 ajacoutot Exp $
d6 1
a6 1
V=			1.4.0
a11 2

REVISION-main=		1
@


1.11
log
@rc.conf.local is in man(1) section 8, at least for now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2014/04/25 17:11:26 sthen Exp $
d13 1
a13 1
REVISION-main=		0
@


1.10
log
@update to dnscrypt-proxy 1.4.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2013/12/05 10:45:32 sthen Exp $
d12 2
@


1.9
log
@don't pick up uuid/uuid.h if it's present at build time (not used here
anyway), spotted by naddy
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2013/10/25 21:01:50 sthen Exp $
d6 1
a6 2
V=			1.3.3
REVISION=		0
d37 1
a37 3
BUILD_DEPENDS=		devel/libtool \
			${MODGNU_AUTOCONF_DEPENDS} \
			${MODGNU_AUTOMAKE_DEPENDS}
d49 2
a50 2
# libevent test hangs. (note that currently tests also need USE_GMAKE=yes).
NO_TEST=		Yes
a54 8

AUTOCONF_VERSION=	2.69
AUTOMAKE_VERSION=	1.14

post-patch:
	cd ${WRKSRC}/src/libevent-modified; \
	    AUTOCONF_VERSION=${AUTOCONF_VERSION} \
	    AUTOMAKE_VERSION=${AUTOMAKE_VERSION} sh ./autogen.sh
@


1.9.2.1
log
@Backport reliability fix for assertion failure crash when out of buffer space
(https://github.com/jedisct1/dnscrypt-proxy/issues/71), req'd and tested by
kentas at hush com
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2013/12/05 10:45:32 sthen Exp $
d7 1
a7 1
REVISION=		1
@


1.8
log
@BUILD_DEPENDS=foo works better when you don't have it twice in the Makefile,
hit by naddy and landry
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2013/10/23 13:14:07 sthen Exp $
d44 2
a45 1
			LDFLAGS=-L${LOCALBASE}/lib
@


1.7
log
@switch to upstream's code for arc4random_addrandom removal, suggested by
Pablo Méndez Hernández
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2013/10/23 12:42:20 sthen Exp $
d38 3
a40 2

BUILD_DEPENDS=		devel/libtool
d60 1
a60 2
BUILD_DEPENDS=		${MODGNU_AUTOCONF_DEPENDS} \
			${MODGNU_AUTOMAKE_DEPENDS}
@


1.6
log
@update to dnscrypt-proxy 1.3.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2013/10/22 19:51:59 jca Exp $
d7 1
d56 9
@


1.5
log
@Fixup after arc4random_addrandom/arc4random_stir removal.
This is an embedded copy of libevent2, so don't bother with compat
patches for upstream.  ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2013/08/15 11:02:23 sthen Exp $
d6 1
a6 2
V=			1.2.0
REVISION=		1
d10 2
a11 1
MASTER_SITES=		https://github.com/downloads/opendns/dnscrypt-proxy/
d13 1
a13 1
HOMEPAGE=		http://dnscrypt.org
d25 1
a25 1
commonWANTLIB=		c execinfo kvm m
d27 1
a27 1
WANTLIB-main=		${commonWANTLIB} ltdl
d30 2
a31 1
commonLIB_DEPENDS=	devel/libexecinfo
d33 4
a36 2
LIB_DEPENDS-main=	${commonLIB_DEPENDS} devel/libtool,-ltdl
LIB_DEPENDS-plugins=	${commonLIB_DEPENDS} net/ldns/libldns
d41 5
a45 2

CONFIGURE_ARGS+=	--enable-plugins --enable-plugins-root
d48 3
a50 1
CONFIGURE_ARGS+=	--enable-pie=no
d59 1
@


1.4
log
@don't force PIE; fixes arm (and it's enabled by default on OpenBSD on arches
where it works).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2013/07/09 13:43:06 jasper Exp $
d7 1
a7 1
REVISION=		0
@


1.3
log
@fix BUILD_DEPENDS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2013/03/11 11:35:46 espie Exp $
d7 1
d40 3
@


1.2
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2012/10/12 15:20:00 sthen Exp $
d34 1
a34 1
BUILD_DEPENDS-plugins=	devel/libtool
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
a17 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.1.1.1
log
@import ports/net/dnscrypt-proxy, from Frank Denis with small tweaks
by me, ok jasper@@

DNSCrypt-proxy provides local service which can be used directly
as your local resolver or as a DNS forwarder, encrypting requests
using the DNSCrypt protocol and passing them to an upstream server,
by default OpenDNS who run this on their resolvers.

The DNSCrypt protocol is very similar to DNSCurve, but focuses on
securing communications between a client and its first-level resolver.
While not providing end-to-end security, it protects the local
network, which is often the weakest point of the chain, against
man-in-the-middle attacks. It also provides some confidentiality to
DNS queries.
@
text
@@
