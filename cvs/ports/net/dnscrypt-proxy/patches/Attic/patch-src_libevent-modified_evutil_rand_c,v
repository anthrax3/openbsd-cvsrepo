head	1.6;
access;
symbols
	OPENBSD_5_8:1.4.0.4
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_5:1.2.0.2
	OPENBSD_5_5_BASE:1.2;
locks; strict;
comment	@# @;


1.6
date	2016.02.04.00.20.09;	author sthen;	state dead;
branches;
next	1.5;
commitid	b4CoUgvOfPozZHlr;

1.5
date	2015.09.18.18.26.18;	author sthen;	state Exp;
branches;
next	1.4;
commitid	5XTaByGcc1uShdAV;

1.4
date	2015.06.11.14.23.09;	author sthen;	state Exp;
branches
	1.4.4.1;
next	1.3;
commitid	9lVCFTjpiPl7aHzz;

1.3
date	2014.04.25.17.11.26;	author sthen;	state dead;
branches;
next	1.2;

1.2
date	2013.10.23.13.14.07;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2013.10.23.12.42.20;	author sthen;	state Exp;
branches;
next	;

1.4.4.1
date	2016.02.04.00.21.14;	author sthen;	state dead;
branches;
next	;
commitid	cJqVQE7BwowJVTy3;


desc
@@


1.6
log
@Update to dnscrypt-proxy 1.6.1

- Security: malformed packets could cause the OpenDNS deviceid,
OpenDNS set-client-ip, blocking and AAAA blocking plugins to use
uninitialized pointers, leading to a denial of service or possibly
code execution. The vulnerable code is present since dnscrypt-proxy
1.1.0. OpenDNS users and people using dnscrypt-proxy in order to block
domain names and IP addresses should upgrade as soon as possible.
@
text
@$OpenBSD: patch-src_libevent-modified_evutil_rand_c,v 1.5 2015/09/18 18:26:18 sthen Exp $

From 7c922518fb0bdf2deeb9c0acc45df45c62cb1e1f Mon Sep 17 00:00:00 2001
From: Frank Denis <github@@pureftpd.org>
Date: Fri, 18 Sep 2015 19:14:29 +0200
Subject: [PATCH] Do not reference arc4random_addrandom() if it is not defined.
 It can either be defined by the C library, or via arc4random.c. Either way,
 it's useless for dnscrypt-proxy.

--- src/libevent-modified/evutil_rand.c.orig	Thu Jun 11 15:09:08 2015
+++ src/libevent-modified/evutil_rand.c	Thu Jun 11 15:11:28 2015
@@@@ -176,7 +176,12 @@@@ evutil_secure_rng_get_bytes(void *buf, size_t n)
 void
 evutil_secure_rng_add_bytes(const char *buf, size_t n)
 {
+#if !defined(_EVENT_HAVE_ARC4RANDOM) || defined(_EVENT_HAVE_ARC4RANDOM_ADDRANDOM)
 	arc4random_addrandom((unsigned char*)buf,
 	    n>(size_t)INT_MAX ? INT_MAX : (int)n);
+#else
+	(void) buf;
+	(void) n;
+#endif
 }
 
@


1.5
log
@update to dnscrypt-proxy-1.6.0 and sync patch with recent upstream commit
@
text
@d1 1
a1 1
$OpenBSD: patch-src_libevent-modified_evutil_rand_c,v 1.4 2015/06/11 14:23:09 sthen Exp $
@


1.4
log
@update to dnscrypt-proxy 1.5.0, reinstate arc4random_addrandom patch
lost during resync with upstream libevent
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 3
Reinstate diff previously applied to libevent-modified.

From cab22b04c04c0b710acff69c8c2e9bbb0d94bde7 Mon Sep 17 00:00:00 2001
d5 4
a8 3
Date: Tue, 22 Oct 2013 13:05:32 -0700
Subject: [PATCH] Check for arc4random_addrandom() presence - Needed for
 OpenBSD-current.
d16 1
a16 1
+#ifdef HAVE_ARC4RANDOM_ADDRANDOM
@


1.4.4.1
log
@Update to dnscrypt-proxy 1.6.1

- Security: malformed packets could cause the OpenDNS deviceid,
OpenDNS set-client-ip, blocking and AAAA blocking plugins to use
uninitialized pointers, leading to a denial of service or possibly
code execution. The vulnerable code is present since dnscrypt-proxy
1.1.0. OpenDNS users and people using dnscrypt-proxy in order to block
domain names and IP addresses should upgrade as soon as possible.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_libevent-modified_evutil_rand_c,v 1.4 2015/06/11 14:23:09 sthen Exp $
@


1.3
log
@update to dnscrypt-proxy 1.4.0
@
text
@d1 3
a3 1
$OpenBSD: patch-src_libevent-modified_evutil_rand_c,v 1.2 2013/10/23 13:14:07 sthen Exp $
d11 3
a13 3
--- src/libevent-modified/evutil_rand.c.orig	Tue Aug 13 03:32:00 2013
+++ src/libevent-modified/evutil_rand.c	Wed Oct 23 14:01:05 2013
@@@@ -155,7 +155,12 @@@@ evutil_secure_rng_get_bytes(void *buf, size_t n)
d21 2
a22 2
+    (void) buf;
+    (void) n;
@


1.2
log
@switch to upstream's code for arc4random_addrandom removal, suggested by
Pablo Méndez Hernández
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@update to dnscrypt-proxy 1.3.3
@
text
@d3 5
a7 2
OpenBSD has not needed arc4random_addrandom since 2003, and no longer
provides it.
d10 2
a11 19
+++ src/libevent-modified/evutil_rand.c	Wed Oct 23 13:10:29 2013
@@@@ -97,6 +97,11 @@@@ ev_arc4random_buf(void *buf, size_t n)
 #endif
 }
 
+void
+evutil_secure_rng_add_bytes(const char *buf, size_t n)
+{
+}
+
 #else /* !_EVENT_HAVE_ARC4RANDOM { */
 
 #ifdef _EVENT_ssize_t
@@@@ -144,18 +149,18 @@@@ ev_arc4random_buf(void *buf, size_t n)
 	arc4random_buf(buf, n);
 }
 
-#endif /* } !_EVENT_HAVE_ARC4RANDOM */
 
d13 1
a13 2
-evutil_secure_rng_get_bytes(void *buf, size_t n)
+evutil_secure_rng_add_bytes(const char *buf, size_t n)
d15 7
a21 3
-	ev_arc4random_buf(buf, n);
+	arc4_addrandom((unsigned char*)buf,
+	    n>(size_t)INT_MAX ? INT_MAX : (int)n);
a23 11
+#endif /* } !_EVENT_HAVE_ARC4RANDOM */
+
 void
-evutil_secure_rng_add_bytes(const char *buf, size_t n)
+evutil_secure_rng_get_bytes(void *buf, size_t n)
 {
-	arc4random_addrandom((unsigned char*)buf,
-	    n>(size_t)INT_MAX ? INT_MAX : (int)n);
+	ev_arc4random_buf(buf, n);
 }
-
@

