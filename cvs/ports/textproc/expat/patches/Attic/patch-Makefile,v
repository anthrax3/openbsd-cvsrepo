head	1.4;
access;
symbols
	OPENBSD_2_8:1.2.0.2
	OPENBSD_2_8_BASE:1.2;
locks; strict;
comment	@# @;


1.4
date	2001.01.21.19.17.40;	author avsm;	state dead;
branches;
next	1.3;

1.3
date	2000.12.14.16.02.59;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2000.10.18.14.50.55;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2000.09.27.14.48.57;	author brad;	state Exp;
branches;
next	;


desc
@@


1.4
log
@- update to expat-1.95.1

This is the new stream of official development for expat,
and is now developed on sourceforge.
@
text
@--- Makefile.orig	Tue May  9 23:21:56 2000
+++ Makefile	Thu Dec 14 10:47:28 2000
@@@@ -13,25 +13,36 @@@@
 LIBOBJS=xmltok/xmltok.o \
   xmltok/xmlrole.o \
   xmlparse/xmlparse.o
+SHLIBOBJS=$(LIBOBJS:.o=.so)
 
 OBJS=xmlwf/xmlwf.o \
   xmlwf/xmlfile.o \
   xmlwf/codepage.o \
   $(FILEMAP_OBJ)
-LIB=xmlparse/libexpat.a
+LIB=libexpat.a
 EXE=
 XMLWF=xmlwf/xmlwf$(EXE)
 
-all: $(XMLWF)
+PICFLAG= -fpic
 
+.if defined(NO_SHARED_LIBS) && ${NO_SHARED_LIBS:L} == "yes"
+all: $(XMLWF)
 $(XMLWF): $(OBJS) $(LIB)
-	$(CC) $(CFLAGS) -o $@@ $(OBJS) $(LIB)
+.else
+all: $(XMLWF) $(SHLIB)
+$(XMLWF): $(OBJS) $(LIB) $(SHLIB)
+.endif
+	$(CC) $(CFLAGS) -o $@@ $(OBJS) -L. -lexpat
 
 $(LIB): $(LIBOBJS)
 	$(AR) rc $(LIB) $(LIBOBJS)
+	@@ranlib $(LIB)
+
+$(SHLIB): $(SHLIBOBJS)
+	$(CC) -shared $(PICFLAG) -o $(SHLIB) $(SHLIBOBJS)
 
 clean:
-	rm -f $(OBJS) $(LIBOBJS) $(LIB) $(XMLWF)
+	rm -f $(OBJS) $(LIBOBJS) $(LIB) $(SHLIB) $(XMLWF)
 
 xmltok/nametab.h: gennmtab/gennmtab$(EXE)
 	rm -f $@@
@@@@ -42,5 +53,10 @@@@
 
 xmltok/xmltok.o: xmltok/nametab.h
 
+.SUFFIXES: .o .so
+
 .c.o:
 	$(CC) $(CFLAGS) -c -o $@@ $<
+
+.c.so:
+	$(CC) $(CFLAGS) $(PICFLAG) -DPIC -c -o $@@ $<
@


1.3
log
@upgrade to expat 1.2
@
text
@@


1.2
log
@pass the pic flag along to the compiler when linking the shared library.
@
text
@d1 4
a4 5
--- Makefile.orig	Mon Mar  8 08:20:38 1999
+++ Makefile	Wed Oct 18 09:47:00 2000
@@@@ -10,21 +10,28 @@@@
 #FILEMAP_OBJ=xmlwf/readfilemap.o
 OBJS=xmltok/xmltok.o \
d6 6
a11 5
-  xmlwf/xmlwf.o \
-  xmlwf/xmlfile.o \
-  xmlwf/codepage.o \
   xmlparse/xmlparse.o \
   xmlparse/hashtable.o \
d13 2
a14 4
+SHOBJS=$(OBJS:.o=.so)
+XOBJS=xmlwf/xmlwf.o \
+  xmlwf/xmlfile.o \
+  xmlwf/codepage.o
d16 1
d18 1
a18 1
-all: xmlwf/xmlwf$(EXE)
a20 2
-xmlwf/xmlwf$(EXE): $(OBJS)
-	$(CC) $(CFLAGS) -o $@@ $(OBJS)
d22 3
a24 2
+all: xmlwf/xmlwf$(EXE) libexpat.a
+xmlwf/xmlwf$(EXE): $(XOBJS) libexpat.a
d26 2
a27 2
+all: xmlwf/xmlwf$(EXE) libexpat.a $(SHLIB)
+xmlwf/xmlwf$(EXE): $(XOBJS) libexpat.a $(SHLIB)
d29 8
a36 1
+	$(CC) $(CFLAGS) -o $@@ $(XOBJS) -L. -lexpat
d39 2
a40 2
-	rm -f $(OBJS) xmlwf/xmlwf$(EXE)
+	rm -f $(OBJS) $(SHOBJS) $(XOBJS) xmlwf/xmlwf$(EXE)
d44 1
a44 1
@@@@ -35,5 +42,17 @@@@
a47 7
+libexpat.a: $(OBJS)
+	ar -rc $@@ $(OBJS)
+	ranlib $@@
+
+$(SHLIB): $(SHOBJS)
+	$(CC) -shared $(PICFLAG) -o $(SHLIB) $(SHOBJS)
+
@


1.1
log
@- correct patch filename
- create a shared library
@
text
@d2 2
a3 2
+++ Makefile	Wed Sep 27 10:23:50 2000
@@@@ -10,21 +10,26 @@@@
d20 2
a21 1
-
d39 1
a39 1
@@@@ -35,5 +40,18 @@@@
d48 1
a48 1
+	$(CC) -shared -o $(SHLIB) $(SHOBJS)
d56 1
a56 2
+	$(CC) $(CFLAGS) -fpic -DPIC -c -o $@@ $<
+
@

