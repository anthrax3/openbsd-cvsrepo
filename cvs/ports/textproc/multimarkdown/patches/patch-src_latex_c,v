head	1.1;
access;
symbols
	OPENBSD_6_2:1.1.0.2
	OPENBSD_6_2_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2017.04.12.18.42.34;	author landry;	state Exp;
branches;
next	;
commitid	MqyTAJYTnoaHrr0Y;


desc
@@


1.1
log
@Update to multimarkdown 5.4.0, from Sean Levy, who's been pinging about
this patch for more than a year (!)

- uses pledge()
- switch to cmake
- enabel tests

Various versions of this patch tested by Micah Muer and Michael McConville
@
text
@$OpenBSD$

Switch from strcat(3) to safer idiom, ensure bogus input doesn't result
in out of bounds pointer.
--- src/latex.c.orig	Sat Oct  1 11:12:24 2016
+++ src/latex.c	Sat Oct  1 11:23:02 2016
@@@@ -1219,16 +1219,16 @@@@ void print_latex_url(GString *out, char *str, scratch_
 char * correct_dimension_units(char *original) {
 	char *result;
 	int i;
+	size_t result_len;
 	
 	result = strdup(original);
+	result_len = strlen(result);
 	
 	for (i = 0; result[i]; i++)
 		result[i] = tolower(result[i]);
 	
-	if (strstr(&result[strlen(result)-2],"px")) {
-		result[strlen(result)-2] = '\0';
-		strcat(result, "pt");
-	}
-	
+	if ((result_len > 1) && strstr(&result[result_len-2],"px"))
+		result[result_len-1] = 't';
+
 	return result;
 }
@
