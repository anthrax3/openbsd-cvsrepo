head	1.13;
access;
symbols
	OPENBSD_6_1:1.13.0.2
	OPENBSD_6_1_BASE:1.13
	OPENBSD_6_0:1.8.0.2
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.6.0.2
	OPENBSD_5_9_BASE:1.6
	sthen_20151104:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.13
date	2017.03.02.10.12.02;	author sthen;	state Exp;
branches;
next	1.12;
commitid	sgxBglbrKOZfQuRs;

1.12
date	2016.09.13.18.52.06;	author naddy;	state Exp;
branches;
next	1.11;
commitid	4Y8Q5bKBOfIWFq5Y;

1.11
date	2016.09.10.13.03.43;	author ajacoutot;	state Exp;
branches;
next	1.10;
commitid	4KcvAK91uGdTLejD;

1.10
date	2016.08.20.15.20.01;	author jca;	state Exp;
branches;
next	1.9;
commitid	eFVwttmwfH60PjlJ;

1.9
date	2016.08.10.20.53.27;	author sthen;	state Exp;
branches;
next	1.8;
commitid	5bQDVECa5khgSsPC;

1.8
date	2016.04.03.14.20.03;	author sthen;	state Exp;
branches;
next	1.7;
commitid	UcRZroiDwJbEy4lE;

1.7
date	2016.04.02.18.39.32;	author sthen;	state Exp;
branches;
next	1.6;
commitid	pG5PtHbrw6s4Kitn;

1.6
date	2016.01.13.22.31.38;	author sthen;	state Exp;
branches;
next	1.5;
commitid	3qzG8twfKCL4fGEE;

1.5
date	2016.01.06.17.13.48;	author sthen;	state Exp;
branches;
next	1.4;
commitid	5sy72Dsua8h4RBTn;

1.4
date	2016.01.06.16.50.35;	author sthen;	state Exp;
branches;
next	1.3;
commitid	MxCFzeISQmJbcaWC;

1.3
date	2015.12.29.19.49.41;	author jasper;	state Exp;
branches;
next	1.2;
commitid	qnWWfNxRwuFA0B7n;

1.2
date	2015.12.29.12.54.11;	author jasper;	state Exp;
branches;
next	1.1;
commitid	Z7BAKWlffCf6cwcy;

1.1
date	2015.11.04.21.11.16;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;
commitid	RgAs2HLpl22jIV13;

1.1.1.1
date	2015.11.04.21.11.16;	author sthen;	state Exp;
branches;
next	;
commitid	RgAs2HLpl22jIV13;


desc
@@


1.13
log
@honour CC/CXX, from maintainer Frank Groeneveld
@
text
@# $OpenBSD: Makefile,v 1.12 2016/09/13 18:52:06 naddy Exp $

ONLY_FOR_ARCHS =	amd64 i386
USE_WXNEEDED =		Yes

DPB_PROPERTIES =	parallel nojunk

COMMENT =		convert HTML to PDF using Webkit

GH_ACCOUNT =		wkhtmltopdf
GH_PROJECT =		wkhtmltopdf
GH_TAGNAME =		0.12.3.2
REVISION =		1
QT_COMMIT =		8dae19a82231e87366d81c683bafcb025aea9c1d
MASTER_SITES0 =		https://github.com/wkhtmltopdf/qt/archive/
DISTFILES =		${DISTNAME}.tar.gz \
			wkhtmltopdf-qt-${QT_COMMIT}{${QT_COMMIT}}.tar.gz:0

SHARED_LIBS =		wkhtmltox 0.0 # 0.12

CATEGORIES =		textproc

HOMEPAGE =		http://wkhtmltopdf.org/

MAINTAINER =		Frank Groeneveld <frank@@frankgroeneveld.nl>

# LGPLv3
PERMIT_PACKAGE_CDROM =	Yes

WANTLIB += X11 Xext Xrender c fontconfig freetype iconv jpeg m
WANTLIB += png pthread stdc++ z

WANTLIB += icui18n # dlopen()d via QLibrary

LIB_DEPENDS =		converters/libiconv \
			graphics/png \
			graphics/jpeg \
			textproc/icu4c

USE_GMAKE =		Yes
MAKE_FLAGS =		LIBwkhtmltox_VERSION=${LIBwkhtmltox_VERSION}
MAKE_ENV +=		WRKBUILD=${WRKBUILD} \
			PORTS_CC="${CC}" PORTS_CXX="${CXX}"
CONFIGURE_ENV =	PORTS_CC="${CC}" PORTS_CXX="${CXX}"
FAKE_FLAGS =		INSTALL_ROOT=${WRKINST}${TRUEPREFIX}

SEPARATE_BUILD =	Yes

NO_TEST =		Yes

pre-patch:
	cd ${WRKDIR}/${DISTNAME} && rmdir qt
	cd ${WRKDIR}/${DISTNAME} && mv ../qt-${QT_COMMIT} qt

do-configure:
	mkdir -p ${WRKBUILD}/qt
	# qt config options taken from scripts/build.py
	cd ${WRKBUILD}/qt && \
		env -i ${CONFIGURE_ENV} ${WRKSRC}/qt/configure \
		--prefix=${WRKBUILD}/qt \
		-opensource \
		-confirm-license \
		-fast \
		-release \
		-static \
		-graphicssystem raster \
		-webkit \
		-exceptions \
		-xmlpatterns \
		-system-zlib \
		-system-libpng \
		-system-libjpeg \
		-no-libmng \
		-no-libtiff \
		-no-accessibility \
		-no-stl \
		-no-qt3support \
		-no-phonon \
		-no-phonon-backend \
		-no-opengl \
		-no-declarative \
		-no-script \
		-no-scripttools \
		-no-sql-ibase \
		-no-sql-mysql \
		-no-sql-odbc \
		-no-sql-psql \
		-no-sql-sqlite \
		-no-sql-sqlite2 \
		-no-mmx \
		-no-3dnow \
		-no-sse \
		-no-sse2 \
		-no-multimedia \
		-nomake demos \
		-nomake docs \
		-nomake examples \
		-nomake tools \
		-nomake tests \
		-nomake translations \
		-silent \
		-xrender \
		-largefile \
		-iconv \
		-openssl \
		-no-rpath \
		-no-dbus \
		-no-nis \
		-no-cups \
		-no-pch \
		-no-gtkstyle \
		-no-nas-sound \
		-no-sm \
		-no-xshape \
		-no-xinerama \
		-no-xcursor \
		-no-xfixes \
		-no-xrandr \
		-no-mitshm \
		-no-xinput \
		-no-xkb \
		-no-glib \
		-no-gstreamer \
		-D ENABLE_VIDEO=0 \
		-no-openvg \
		-no-xsync \
		-no-audio-backend \
		-no-sse3 \
		-no-ssse3 \
		-no-sse4.1 \
		-no-sse4.2 \
		-no-avx \
		-no-neon
	cd ${WRKBUILD} && env -i ${CONFIGURE_ENV} qt/bin/qmake \
		${WRKSRC}/wkhtmltopdf.pro

pre-build:
	cd ${WRKBUILD}/qt && env -i ${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS}

.include <bsd.port.mk>
@


1.12
log
@replace libiconv module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2016/09/10 13:03:43 ajacoutot Exp $
d42 3
a44 1
MAKE_ENV +=		WRKBUILD=${WRKBUILD}
d56 1
a56 1
	mkdir ${WRKBUILD}/qt
@


1.11
log
@First pass at pre-entively fixing ports that would break once guenther's header
pollution diff is in.

lang/squeak/vm does not build but it's due to the recent audio changes
games/xbattle: also fixes some conflicting implicit decl
print/hplip: also fixes some conflicting implicit decl
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2016/08/20 15:20:01 jca Exp $
d30 1
a30 1
WANTLIB += X11 Xext Xrender c fontconfig freetype jpeg m
d35 2
a36 2
MODULES =		converters/libiconv
LIB_DEPENDS =		graphics/png \
@


1.10
log
@USE_WXNEEDED

from maintainer Frank Groeneveld
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2016/08/10 20:53:27 sthen Exp $
d13 1
a13 1
REVISION =		0
@


1.9
log
@update to wkhtmltopdf-0.12.3.2, from Frank Groeneveld
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2016/04/03 14:20:03 sthen Exp $
d4 2
d13 1
@


1.8
log
@fix typo
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2016/04/02 18:39:32 sthen Exp $
d10 2
a11 3
GH_TAGNAME =		0.12.2.4
REVISION =		3
QT_COMMIT =		7e48a1fac7e0f9aefccd01e9871f987da3a62fda
@


1.7
log
@Add dep on icu4c, it is dlopen()d at runtime. From Frank Groeneveld
(I tweaked the diff a bit).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2016/01/13 22:31:38 sthen Exp $
d31 1
a31 1
WANTLIB += icu18n # dlopen()d via QLibrary
@


1.6
log
@Remove wkhtmltopdf LIB_DEPENDS on qt4 (which it was still pulling in for some
parts despite building its own patched version). So it still takes a while
to build but at least it doesn't have to wait for qt4 before it starts.
From maintainer Frank Groeneveld.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2016/01/06 17:13:48 sthen Exp $
d11 1
a11 1
REVISION =		2
d28 4
a31 1
WANTLIB += X11 Xext Xrender c fontconfig freetype jpeg m png pthread stdc++ z
d35 2
a36 1
			graphics/jpeg
@


1.5
log
@drop part of the ssl patch in wkhtmltopdf that was restricting https to tls1.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2016/01/06 16:50:35 sthen Exp $
d11 1
a11 1
REVISION =		1
a28 2
WANTLIB += lib/qt4/QtGui lib/qt4/QtNetwork lib/qt4/QtSvg lib/qt4/QtWebKit
WANTLIB += lib/qt4/QtXmlPatterns
d30 1
a30 2
MODULES =		converters/libiconv \
			x11/qt4
@


1.4
log
@Build wkhtmltopdf against patched Qt4; from maintainer Frank Groeneveld
with tweaks by me. This allows printing multiple documents into one PDF,
headless operation, adding a document outline, ToC, headers/footers and
links, using the "screen" media-type, and disabling smart-shrink.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2015/12/29 19:49:41 jasper Exp $
d11 1
a11 1
REVISION =		0
@


1.3
log
@DISTNAME is set by bsd.port.mk for these ports now
@
text
@d1 4
a4 1
# $OpenBSD: Makefile,v 1.2 2015/12/29 12:54:11 jasper Exp $
d11 5
a15 1

d28 8
a35 5
WANTLIB +=		ICE SM X11 Xext Xi Xinerama Xrender c fontconfig
WANTLIB +=		freetype m pthread stdc++ QtCore QtGui QtNetwork
WANTLIB +=		QtSvg QtWebKit QtXmlPatterns

MODULES =		x11/qt4
d37 1
d39 1
d46 4
d51 83
a133 1
	cd ${WRKBUILD} && env -i ${CONFIGURE_ENV} qmake4 ${WRKSRC}/wkhtmltopdf.pro
@


1.2
log
@use GH_PROJECT to construct DISTNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2015/11/04 21:11:16 sthen Exp $
a8 1
DISTNAME =		${GH_PROJECT}-${GH_TAGNAME}
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d9 1
a9 1
DISTNAME =		wkhtmltopdf-${GH_TAGNAME}
@


1.1.1.1
log
@import ports/textproc/wkhtmltopdf, from Frank Groeneveld, ok jca@@

Wkhtmltopdf and wkhtmltoimage are open source (LGPLv3) command line tools to
render HTML into PDF and various image formats using the Qt WebKit rendering
engine. These run entirely "headless" and do not require a display or display
service.
@
text
@@
