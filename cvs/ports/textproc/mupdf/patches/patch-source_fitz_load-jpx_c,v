head	1.3;
access;
symbols
	OPENBSD_6_0:1.1.0.8
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.4
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.6
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.2
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2016.12.12.10.54.39;	author sthen;	state Exp;
branches;
next	1.2;
commitid	Enu3DDXVVc0luyIA;

1.2
date	2016.10.18.09.24.20;	author sthen;	state Exp;
branches;
next	1.1;
commitid	tVUMQH14btHr8Nk0;

1.1
date	2014.11.29.13.25.23;	author sthen;	state Exp;
branches;
next	;
commitid	0EGi5kbx6FoyncLb;


desc
@@


1.3
log
@update to mupdf-1.10a
@
text
@$OpenBSD: patch-source_fitz_load-jpx_c,v 1.2 2016/10/18 09:24:20 sthen Exp $

- OPJ_STATIC interferes with shared lib patch for mupdf

--- source/fitz/load-jpx.c.orig	Mon Nov 28 13:34:04 2016
+++ source/fitz/load-jpx.c	Mon Dec 12 09:39:02 2016
@@@@ -481,14 +481,6 @@@@ fz_load_jpx_info(fz_context *ctx, unsigned char *data,
 
 #else /* HAVE_LURATECH */
 
-/* Without the definition of OPJ_STATIC, compilation fails on windows
- * due to the use of __stdcall. We believe it is required on some
- * linux toolchains too. */
-#define OPJ_STATIC
-#ifndef _MSC_VER
-#define OPJ_HAVE_STDINT_H
-#endif
-
 #include <openjpeg.h>
 
 /* OpenJPEG does not provide a safe mechanism to intercept
@


1.2
log
@- patch mupdf to cope with openjp2 update
- use sed -i instead of SUBST_CMD for easier update-patches management
@
text
@d1 1
a1 1
$OpenBSD: patch-source_fitz_load-jpx_c,v 1.1 2014/11/29 13:25:23 sthen Exp $
a3 1
- cope with API change in openjpeg 2.1.0
d5 5
a9 4
--- source/fitz/load-jpx.c.orig	Thu Apr 21 12:14:32 2016
+++ source/fitz/load-jpx.c	Tue Oct 18 10:09:14 2016
@@@@ -1,13 +1,5 @@@@
 #include "mupdf/fitz.h"
d21 1
a21 10
 static void fz_opj_error_callback(const char *msg, void *client_data)
@@@@ -117,7 +109,7 @@@@ fz_load_jpx(fz_context *ctx, unsigned char *data, int 
 	opj_stream_set_read_function(stream, fz_opj_stream_read);
 	opj_stream_set_skip_function(stream, fz_opj_stream_skip);
 	opj_stream_set_seek_function(stream, fz_opj_stream_seek);
-	opj_stream_set_user_data(stream, &sb);
+	opj_stream_set_user_data(stream, &sb, NULL);
 	/* Set the length to avoid an assert */
 	opj_stream_set_user_data_length(stream, size);
 
@


1.1
log
@handle api change in openjp2
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 1
cope with API change in openjpeg 2.1.0
d6 17
a22 3
--- source/fitz/load-jpx.c.orig	Sat Nov 29 00:01:34 2014
+++ source/fitz/load-jpx.c	Sat Nov 29 00:01:39 2014
@@@@ -117,7 +117,7 @@@@ fz_load_jpx(fz_context *ctx, unsigned char *data, int 
@

