head	1.7;
access;
symbols
	OPENBSD_6_0:1.5.0.2
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.2.0.4
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.1.0.2
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2016.12.12.10.54.39;	author sthen;	state Exp;
branches;
next	1.6;
commitid	Enu3DDXVVc0luyIA;

1.6
date	2016.10.16.09.16.52;	author sthen;	state Exp;
branches;
next	1.5;
commitid	dEwglaqKyYstWUzR;

1.5
date	2016.05.05.09.02.46;	author sthen;	state Exp;
branches;
next	1.4;
commitid	z3NGBSudLLHGF6pa;

1.4
date	2016.01.26.14.43.08;	author tb;	state Exp;
branches;
next	1.3;
commitid	XjBOC4tQbgu6o42c;

1.3
date	2015.11.12.17.26.54;	author sthen;	state Exp;
branches;
next	1.2;
commitid	ZwdvGV2CJzqynQxI;

1.2
date	2015.04.25.23.04.54;	author sthen;	state Exp;
branches;
next	1.1;
commitid	KNPcQzzt7HisFxrA;

1.1
date	2014.10.18.08.36.39;	author espie;	state Exp;
branches;
next	;
commitid	Hta6PN0bEdZohJOZ;


desc
@@


1.7
log
@update to mupdf-1.10a
@
text
@$OpenBSD: patch-platform_x11_pdfapp_c,v 1.6 2016/10/16 09:16:52 sthen Exp $
--- platform/x11/pdfapp.c.orig	Mon Nov 28 13:34:04 2016
+++ platform/x11/pdfapp.c	Mon Dec 12 09:39:02 2016
@@@@ -26,8 +26,18 @@@@ enum
 static void pdfapp_showpage(pdfapp_t *app, int loadpage, int drawpage, int repaint, int transition, int searching);
 static void pdfapp_updatepage(pdfapp_t *app);
 
-static const int zoomlist[] = { 18, 24, 36, 54, 72, 96, 120, 144, 180, 216, 288 };
+static const int zoomlist[] = { 18, 21, 24, 30, 36, 44, 54, 62, 72, 83, 96, 107, 120, 131, 144, 160, 180, 197, 216, 250, 288 };
 
+static int fine_zoom_in(int oldres)
+{
+	return oldres+1;
+}
+
+static int fine_zoom_out(int oldres)
+{
+	return oldres-1;
+}
+
 static int zoom_in(int oldres)
 {
 	int i;
@@@@ -1038,6 +1048,12 @@@@ static void pdfapp_search_in_direction(pdfapp_t *app, 
 		return;
 	}
 
+	if (app && *app->search == '\0')
+	{
+		winrepaint(app);
+		return;
+	}
+
 	wincursor(app, WAIT);
 
 	firstpage = app->pageno;
@@@@ -1535,9 +1551,9 @@@@ static void handlescroll(pdfapp_t *app, int modifiers,
 	{
 		/* zoom in/out if ctrl is pressed */
 		if (dir < 0)
-			app->resolution = zoom_in(app->resolution);
+			app->resolution = ((modifiers & (1<<0)) ? fine_zoom_in : zoom_in)(app->resolution);
 		else
-			app->resolution = zoom_out(app->resolution);
+			app->resolution = ((modifiers & (1<<0)) ? fine_zoom_out : zoom_out)(app->resolution);
 		if (app->resolution > MAXRES)
 			app->resolution = MAXRES;
 		if (app->resolution < MINRES)
@


1.6
log
@update to mupdf-1.9a
@
text
@d1 3
a3 3
$OpenBSD: patch-platform_x11_pdfapp_c,v 1.5 2016/05/05 09:02:46 sthen Exp $
--- platform/x11/pdfapp.c.orig	Thu Apr 21 12:14:32 2016
+++ platform/x11/pdfapp.c	Sun Oct 16 09:47:50 2016
d24 3
a26 12
@@@@ -288,7 +298,7 @@@@ void pdfapp_open_progressive(pdfapp_t *app, char *file
 		}
 
 #ifdef HAVE_CURL
-		if (!strncmp(filename, "http://", 7))
+		if (!strncmp(filename, "http://", 7) || !strncmp(filename, "https://", 8))
 		{
 			app->stream = fz_stream_from_curl(ctx, filename, pdfapp_more_data, app);
 			while (1)
@@@@ -1011,6 +1021,12 @@@@ static void pdfapp_search_in_direction(pdfapp_t *app, 
 {
 	int firstpage, page;
d37 1
a37 1
@@@@ -1508,9 +1524,9 @@@@ static void handlescroll(pdfapp_t *app, int modifiers,
@


1.5
log
@support https URLs with mupdf-x11-curl, from jirib at devio.us
@
text
@d1 3
a3 3
$OpenBSD: patch-platform_x11_pdfapp_c,v 1.4 2016/01/26 14:43:08 tb Exp $
--- platform/x11/pdfapp.c.orig	Tue Nov 10 16:19:51 2015
+++ platform/x11/pdfapp.c	Thu May  5 09:58:19 2016
d24 1
a24 1
@@@@ -316,7 +326,7 @@@@ void pdfapp_open_progressive(pdfapp_t *app, char *file
d33 1
a33 1
@@@@ -1041,6 +1051,12 @@@@ static void pdfapp_search_in_direction(pdfapp_t *app, 
d46 1
a46 1
@@@@ -1538,9 +1554,9 @@@@ static void handlescroll(pdfapp_t *app, int modifiers,
@


1.4
log
@Short-circuit the search function if the search string is empty. This
avoids blocking the viewer and eating a lot of cpu for a number of
seconds when 'n' is pressed before an actual search was performed.

ok sthen@@
@
text
@d1 3
a3 3
$OpenBSD: patch-platform_x11_pdfapp_c,v 1.3 2015/11/12 17:26:54 sthen Exp $
--- platform/x11/pdfapp.c.orig	Tue Nov 10 17:19:51 2015
+++ platform/x11/pdfapp.c	Mon Jan 18 10:14:13 2016
d24 9
@


1.3
log
@update to MuPDF-1.8
- many fixes and improvements to EPUB support
- mudraw moves to the multi-purpose mutool binary
- add new OpenGL-based viewer, mupdf-gl
- add an optional flavour to enable the javascript support (wasn't
on by default before in our package, and still isn't)
@
text
@d1 3
a3 3
$OpenBSD: patch-platform_x11_pdfapp_c,v 1.2 2015/04/25 23:04:54 sthen Exp $
--- platform/x11/pdfapp.c.orig	Tue Nov 10 16:19:51 2015
+++ platform/x11/pdfapp.c	Thu Nov 12 16:42:07 2015
d24 14
a37 1
@@@@ -1538,9 +1548,9 @@@@ static void handlescroll(pdfapp_t *app, int modifiers,
@


1.2
log
@update to MuPDF 1.7
@
text
@d1 4
a4 4
$OpenBSD: patch-platform_x11_pdfapp_c,v 1.1 2014/10/18 08:36:39 espie Exp $
--- platform/x11/pdfapp.c.orig	Thu Apr 16 09:57:45 2015
+++ platform/x11/pdfapp.c	Sat Apr 25 23:35:23 2015
@@@@ -28,8 +28,18 @@@@ enum
d24 1
a24 1
@@@@ -1502,9 +1512,9 @@@@ static void handlescroll(pdfapp_t *app, int modifiers,
@


1.1
log
@add support for fine-grained zoom, for those pesky pdf where contents would
just fit on your screen but for one pesky dpi.

idea (and code) okay'd maintainer
@
text
@d1 9
a9 6
$OpenBSD$
--- platform/x11/pdfapp.c.orig	Tue Oct 14 11:47:41 2014
+++ platform/x11/pdfapp.c	Tue Oct 14 16:04:36 2014
@@@@ -39,6 +39,16 @@@@ static int zoom_in(int oldres)
 	return zoomlist[i];
 }
d21 1
a21 1
 static int zoom_out(int oldres)
d24 12
a35 24
@@@@ -1579,9 +1589,9 @@@@ void pdfapp_onmouse(pdfapp_t *app, int x, int y, int b
 			{
 				/* zoom in/out if ctrl is pressed */
 				if (dir > 0)
-					app->resolution = zoom_in(app->resolution);
+					app->resolution = ((modifiers & (1<<0)) ? fine_zoom_in : zoom_in)(app->resolution);
 				else
-					app->resolution = zoom_out(app->resolution);
+					app->resolution = ((modifiers & (1<<0)) ? fine_zoom_out : zoom_out)(app->resolution);
 				if (app->resolution > MAXRES)
 					app->resolution = MAXRES;
 				if (app->resolution < MINRES)
$OpenBSD$
--- platform/x11/pdfapp.c.orig	Mon Oct 13 19:56:28 2014
+++ platform/x11/pdfapp.c	Mon Oct 13 20:01:17 2014
@@@@ -28,7 +28,7 @@@@ enum
 static void pdfapp_showpage(pdfapp_t *app, int loadpage, int drawpage, int repaint, int transition, int searching);
 static void pdfapp_updatepage(pdfapp_t *app);
 
-static const int zoomlist[] = { 18, 24, 36, 54, 72, 96, 120, 144, 180, 216, 288 };
+static const int zoomlist[] = { 18, 21, 24, 30, 36, 44, 54, 62, 72, 83, 96, 107, 120, 131, 144, 160, 180, 197, 216, 250, 288 };
 
 static int zoom_in(int oldres)
 {
@

