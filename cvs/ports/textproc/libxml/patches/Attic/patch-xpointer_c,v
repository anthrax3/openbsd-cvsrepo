head	1.3;
access;
symbols
	OPENBSD_5_2:1.2.0.2
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2;
locks; strict;
comment	@# @;


1.3
date	2012.09.30.12.22.05;	author jasper;	state dead;
branches;
next	1.2;

1.2
date	2012.05.18.13.25.46;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2012.01.23.10.17.49;	author ajacoutot;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2012.01.23.10.19.14;	author ajacoutot;	state Exp;
branches;
next	;

1.1.4.1
date	2012.05.18.13.27.23;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.3
log
@- update to libxml-2.8.0

tested on amd64, sparc64, mips64el and powerpc.
ok aja@@
@
text
@$OpenBSD: patch-xpointer_c,v 1.2 2012/05/18 13:25:46 jasper Exp $

From d8e1faeaa99c7a7c07af01c1c72de352eb590a3e Mon Sep 17 00:00:00 2001
From: Jüri Aedla <asd@@ut.ee>
Date: Mon, 07 May 2012 07:06:56 +0000
Subject: Fix an off by one pointer access

From f5048b3e71fc30ad096970b8df6e7af073bae4cb Mon Sep 17 00:00:00 2001
From: Daniel Veillard <veillard@@redhat.com>
Date: Thu, 18 Aug 2011 09:10:13 +0000
Subject: Hardening of XPath evaluation

--- xpointer.c.orig	Fri May 18 15:16:18 2012
+++ xpointer.c	Fri May 18 15:16:15 2012
@@@@ -1007,21 +1007,14 @@@@ xmlXPtrEvalXPtrPart(xmlXPathParserContextPtr ctxt, xml
 		NEXT;
 		break;
 	    }
-	    *cur++ = CUR;
 	} else if (CUR == '(') {
 	    level++;
-	    *cur++ = CUR;
 	} else if (CUR == '^') {
-	    NEXT;
-	    if ((CUR == ')') || (CUR == '(') || (CUR == '^')) {
-		*cur++ = CUR;
-	    } else {
-		*cur++ = '^';
-		*cur++ = CUR;
-	    }
-	} else {
-	    *cur++ = CUR;
+            if ((NXT(1) == ')') || (NXT(1) == '(') || (NXT(1) == '^')) {
+                NEXT;
+            }
 	}
+        *cur++ = CUR;
 	NEXT;
     }
     *cur = 0;
@@@@ -1269,6 +1262,7 @@@@ xmlXPtrEvalXPointer(xmlXPathParserContextPtr ctxt) {
 	ctxt->valueNr = 0;
 	ctxt->valueMax = 10;
 	ctxt->value = NULL;
+	ctxt->valueFrame = 0;
     }
     SKIP_BLANKS;
     if (CUR == '/') {
@


1.2
log
@Security fix for SA49177,
Libxml2 "xmlXPtrEvalXPtrPart()" Off-By-One Vulnerability

Patch from upstream git

ok aja@@
@
text
@d1 1
a1 1
$OpenBSD: patch-xpointer_c,v 1.1 2012/01/23 10:17:49 ajacoutot Exp $
@


1.1
log
@Bring some patches from upstream repo to fix the following CVE:
CVE-2011-0216 - Off-by-one error
CVE-2011-2821 - Double free vulnerability
CVE-2011-2834 - Double free vulnerability
CVE-2011-3905 - DOS (out-of-bounds read) via unspecified vectors
CVE-2011-3919 - Heap-based buffer overflow

ok sthen@@
@
text
@d1 6
a6 1
$OpenBSD$
d13 29
a41 3
--- xpointer.c.orig	Tue Oct 12 08:25:33 2010
+++ xpointer.c	Mon Jan 23 08:15:53 2012
@@@@ -1269,6 +1269,7 @@@@ xmlXPtrEvalXPointer(xmlXPathParserContextPtr ctxt) {
@


1.1.4.1
log
@Security fix for SA49177,
Libxml2 "xmlXPtrEvalXPtrPart()" Off-By-One Vulnerability

Patch from upstream git

ok aja@@
@
text
@d1 1
a1 6
$OpenBSD: patch-xpointer_c,v 1.1 2012/01/23 10:17:49 ajacoutot Exp $

From d8e1faeaa99c7a7c07af01c1c72de352eb590a3e Mon Sep 17 00:00:00 2001
From: Jüri Aedla <asd@@ut.ee>
Date: Mon, 07 May 2012 07:06:56 +0000
Subject: Fix an off by one pointer access
d8 3
a10 29
--- xpointer.c.orig	Fri May 18 15:16:18 2012
+++ xpointer.c	Fri May 18 15:16:15 2012
@@@@ -1007,21 +1007,14 @@@@ xmlXPtrEvalXPtrPart(xmlXPathParserContextPtr ctxt, xml
 		NEXT;
 		break;
 	    }
-	    *cur++ = CUR;
 	} else if (CUR == '(') {
 	    level++;
-	    *cur++ = CUR;
 	} else if (CUR == '^') {
-	    NEXT;
-	    if ((CUR == ')') || (CUR == '(') || (CUR == '^')) {
-		*cur++ = CUR;
-	    } else {
-		*cur++ = '^';
-		*cur++ = CUR;
-	    }
-	} else {
-	    *cur++ = CUR;
+            if ((NXT(1) == ')') || (NXT(1) == '(') || (NXT(1) == '^')) {
+                NEXT;
+            }
 	}
+        *cur++ = CUR;
 	NEXT;
     }
     *cur = 0;
@@@@ -1269,6 +1262,7 @@@@ xmlXPtrEvalXPointer(xmlXPathParserContextPtr ctxt) {
@


1.1.2.1
log
@Bring some patches from upstream repo to fix the following CVE:
CVE-2011-0216 - Off-by-one error
CVE-2011-2821 - Double free vulnerability
CVE-2011-2834 - Double free vulnerability
CVE-2011-3905 - DOS (out-of-bounds read) via unspecified vectors
CVE-2011-3919 - Heap-based buffer overflow

ok sthen@@
@
text
@@

