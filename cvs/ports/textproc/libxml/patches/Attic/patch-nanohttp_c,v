head	1.2;
access;
symbols
	OPENBSD_3_4:1.2.0.2
	OPENBSD_3_5:1.1.0.2
	OPENBSD_3_5_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2004.04.06.06.50.32;	author kevlo;	state dead;
branches
	1.2.2.1;
next	1.1;

1.1
date	2004.03.15.22.00.56;	author naddy;	state Exp;
branches;
next	;

1.2.2.1
date	2004.07.21.19.25.39;	author brad;	state Exp;
branches;
next	;


desc
@@


1.2
log
@upgrade to 2.6.8
@
text
@$OpenBSD: patch-nanohttp_c,v 1.1 2004/03/15 22:00:56 naddy Exp $
--- nanohttp.c.orig	2003-11-01 13:39:32.000000000 +0100
+++ nanohttp.c	2004-03-08 21:58:40.000000000 +0100
@@@@ -272,6 +272,7 @@@@ xmlNanoHTTPScanURL(xmlNanoHTTPCtxtPtr ct
     const char *cur = URL;
     char buf[4096];
     int indx = 0;
+    const int indxMax = 4096 - 1;
     int port = 0;
 
     if (ctxt->protocol != NULL) { 
@@@@ -288,7 +289,7 @@@@ xmlNanoHTTPScanURL(xmlNanoHTTPCtxtPtr ct
     }
     if (URL == NULL) return;
     buf[indx] = 0;
-    while (*cur != 0) {
+    while ((*cur != 0) && (indx < indxMax)) {
         if ((cur[0] == ':') && (cur[1] == '/') && (cur[2] == '/')) {
 	    buf[indx] = 0;
 	    ctxt->protocol = xmlMemStrdup(buf);
@@@@ -301,7 +302,7 @@@@ xmlNanoHTTPScanURL(xmlNanoHTTPCtxtPtr ct
     if (*cur == 0) return;
 
     buf[indx] = 0;
-    while (1) {
+    while (indx < indxMax) {
 	if ((strchr (cur, '[') && !strchr (cur, ']')) ||
 		(!strchr (cur, '[') && strchr (cur, ']'))) {
 	    __xmlIOErr(XML_FROM_HTTP, XML_HTTP_URL_SYNTAX, 
@@@@ -311,7 +312,7 @@@@ xmlNanoHTTPScanURL(xmlNanoHTTPCtxtPtr ct
 
 	if (cur[0] == '[') {
 	    cur++;
-	    while (cur[0] != ']')
+	    while ((cur[0] != ']') && (indx < indxMax))
 		buf[indx++] = *cur++;
     
 	    if (!strchr (buf, ':')) {
@@@@ -368,7 +369,7 @@@@ xmlNanoHTTPScanURL(xmlNanoHTTPCtxtPtr ct
     else {
         indx = 0;
         buf[indx] = 0;
-	while (*cur != 0)
+	while ((*cur != 0) && (indx < indxMax))
 	    buf[indx++] = *cur++;
 	buf[indx] = 0;
 	ctxt->path = xmlMemStrdup(buf);
@@@@ -390,6 +391,7 @@@@ xmlNanoHTTPScanProxy(const char *URL) {
     const char *cur = URL;
     char buf[4096];
     int indx = 0;
+    const int indxMax = 4096 - 1;
     int port = 0;
 
     if (proxy != NULL) { 
@@@@ -409,7 +411,7 @@@@ xmlNanoHTTPScanProxy(const char *URL) {
 #endif
     if (URL == NULL) return;
     buf[indx] = 0;
-    while (*cur != 0) {
+    while ((*cur != 0) && (indx < indxMax)) {
         if ((cur[0] == ':') && (cur[1] == '/') && (cur[2] == '/')) {
 	    buf[indx] = 0;
 	    indx = 0;
@@@@ -421,7 +423,7 @@@@ xmlNanoHTTPScanProxy(const char *URL) {
     if (*cur == 0) return;
 
     buf[indx] = 0;
-    while (1) {
+    while (indx < indxMax) {
 	if ((strchr (cur, '[') && !strchr (cur, ']')) ||
 		(!strchr (cur, '[') && strchr (cur, ']'))) {
 	    __xmlIOErr(XML_FROM_HTTP, XML_HTTP_URL_SYNTAX, "Syntax Error\n");
@@@@ -430,7 +432,7 @@@@ xmlNanoHTTPScanProxy(const char *URL) {
 
 	if (cur[0] == '[') {
 	    cur++;
-	    while (cur[0] != ']')
+	    while ((cur[0] != ']') && (indx < indxMax))
 		buf[indx++] = *cur++;
 
 	    if (!strchr (buf, ':')) {
@


1.2.2.1
log
@Buffer overflow fixes.

http://cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2004-0110
@
text
@d1 4
a4 4
$OpenBSD$
--- nanohttp.c.orig	Wed Aug 13 21:18:06 2003
+++ nanohttp.c	Wed Jul 21 14:39:22 2004
@@@@ -250,6 +250,7 @@@@ xmlNanoHTTPScanURL(xmlNanoHTTPCtxtPtr ct
d12 1
a12 1
@@@@ -266,7 +267,7 @@@@ xmlNanoHTTPScanURL(xmlNanoHTTPCtxtPtr ct
d21 1
a21 1
@@@@ -279,7 +280,7 @@@@ xmlNanoHTTPScanURL(xmlNanoHTTPCtxtPtr ct
d29 2
a30 2
 	    xmlGenericError (xmlGenericErrorContext, "\nxmlNanoHTTPScanURL: %s",
@@@@ -289,7 +290,7 @@@@ xmlNanoHTTPScanURL(xmlNanoHTTPCtxtPtr ct
d39 1
a39 1
@@@@ -346,7 +347,7 @@@@ xmlNanoHTTPScanURL(xmlNanoHTTPCtxtPtr ct
d48 1
a48 1
@@@@ -368,6 +369,7 @@@@ xmlNanoHTTPScanProxy(const char *URL) {
d56 1
a56 1
@@@@ -387,7 +389,7 @@@@ xmlNanoHTTPScanProxy(const char *URL) {
d65 1
a65 1
@@@@ -399,7 +401,7 @@@@ xmlNanoHTTPScanProxy(const char *URL) {
d73 2
a74 2
 	    xmlGenericError (xmlGenericErrorContext, "\nxmlNanoHTTPScanProxy: %s",
@@@@ -409,7 +411,7 @@@@ xmlNanoHTTPScanProxy(const char *URL) {
@


1.1
log
@Buffer overflow fixes.
From upstream CVS repository via Robert Nagy <thuglife@@bsd.hu>; ok pvalchev@@
@
text
@d1 1
a1 1
$OpenBSD$
@

