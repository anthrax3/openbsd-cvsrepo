head	1.4;
access;
symbols
	OPENBSD_5_4:1.3.0.8
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.6
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2013.11.09.15.02.14;	author sthen;	state dead;
branches;
next	1.3;

1.3
date	2011.11.26.19.50.08;	author kili;	state Exp;
branches;
next	1.2;

1.2
date	2011.09.05.12.38.36;	author jasper;	state dead;
branches;
next	1.1;

1.1
date	2011.07.08.20.38.00;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update calibre to 1.10.0, unbreaking the port. This removes various
diffs to fix with newer poppler/png.
@
text
@$OpenBSD: patch-src_calibre_ebooks_pdf_images_cpp,v 1.3 2011/11/26 19:50:08 kili Exp $

OCTStream::getRawStream deleted in poppler-0.18; Stream::getNextStream()
does the same according to the poppler documentation.

--- src/calibre/ebooks/pdf/images.cpp.orig	Fri Sep 23 19:14:20 2011
+++ src/calibre/ebooks/pdf/images.cpp	Thu Nov 17 16:12:13 2011
@@@@ -126,7 +126,7 @@@@ void XMLImages::add(GfxState *state, Object *ref, Stre
 
     if (img->type == jpeg) {
         int c;
-        str = ((DCTStream *)str)->getRawStream();
+        str = str->getNextStream();
         str->reset();
 
         // copy the stream
@


1.3
log
@Fix build with poppler-0.18.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@major update to 0.8.17

from viq
@
text
@d1 1
a1 1
$OpenBSD: patch-src_calibre_ebooks_pdf_images_cpp,v 1.1 2011/07/08 20:38:00 naddy Exp $
d3 2
a4 1
Fix build with png-1.5.
d6 3
a8 3
--- src/calibre/ebooks/pdf/images.cpp.orig	Wed Jul  6 18:39:44 2011
+++ src/calibre/ebooks/pdf/images.cpp	Wed Jul  6 18:41:30 2011
@@@@ -301,7 +301,7 @@@@ void PNGWriter::write_splash_bitmap(SplashBitmap *bitm
d10 7
a16 7
 void calibre_png_mem_write(png_structp png_ptr, png_bytep data, png_size_t length) {
     if (!png_ptr || length < 1) return;
-    vector<char> *buf = static_cast< vector<char>* >(png_ptr->io_ptr);
+    vector<char> *buf = static_cast< vector<char>* >(png_get_io_ptr(png_ptr));
     buf->reserve(buf->capacity() + length); 
     do {
         buf->push_back(static_cast<char>(*data));
@


1.1
log
@Fix build with png-1.5.
All fixes by yours truly.
@
text
@d1 1
a1 1
$OpenBSD$
@

