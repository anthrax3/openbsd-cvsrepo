head	1.2;
access;
symbols
	OPENBSD_5_5:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2014.06.05.06.57.03;	author jasper;	state dead;
branches;
next	1.1;
commitid	txi4gUKlq76J4iDD;

1.1
date	2014.06.04.14.29.49;	author jasper;	state Exp;
branches
	1.1.2.1;
next	;
commitid	VTGsYijlBi8FFODS;

1.1.2.1
date	2014.06.04.14.31.31;	author jasper;	state Exp;
branches;
next	;
commitid	8zNgzSZb3RIdcWyu;


desc
@@


1.2
log
@- update to py-lxml-3.3.5
- add missing TEST_DEPENDS spottedy rpointel@@

ok rpointel@@
@
text
@$OpenBSD: patch-src_lxml_html_clean_py,v 1.1 2014/06/04 14:29:49 jasper Exp $

Security fix for CVE-2014-3146,
python-lxml: clean_html input sanitization flaw

--- src/lxml/html/clean.py.orig	Sun Sep 25 20:47:23 2011
+++ src/lxml/html/clean.py	Wed Jun  4 16:24:02 2014
@@@@ -79,9 +79,10 @@@@ _css_import_re = re.compile(
 
 # All kinds of schemes besides just javascript: that can cause
 # execution:
-_javascript_scheme_re = re.compile(
-    r'\s*(?:javascript|jscript|livescript|vbscript|data|about|mocha):', re.I)
-_substitute_whitespace = re.compile(r'\s+').sub
+_is_javascript_scheme = re.compile(
+    r'(?:javascript|jscript|livescript|vbscript|data|about|mocha):',
+    re.I).search
+_substitute_whitespace = re.compile(r'[\s\x00-\x08\x0B\x0C\x0E-\x19]+').sub
 # FIXME: should data: be blocked?
 
 # FIXME: check against: http://msdn2.microsoft.com/en-us/library/ms537512.aspx
@@@@ -459,7 +460,7 @@@@ class Cleaner(object):
     def _remove_javascript_link(self, link):
         # links like "j a v a s c r i p t:" might be interpreted in IE
         new = _substitute_whitespace('', link)
-        if _javascript_scheme_re.search(new):
+        if _is_javascript_scheme(new):
             # FIXME: should this be None to delete?
             return ''
         return link
@


1.1
log
@Security fix for CVE-2014-3146, python-lxml: clean_html input sanitization flaw
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@Security fix for CVE-2014-3146, python-lxml: clean_html input sanitization flaw
@
text
@d1 1
a1 1
$OpenBSD: patch-src_lxml_html_clean_py,v 1.1 2014/06/04 14:29:49 jasper Exp $
@

