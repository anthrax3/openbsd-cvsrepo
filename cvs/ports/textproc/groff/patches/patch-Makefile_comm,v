head	1.3;
access;
symbols
	OPENBSD_6_0:1.3.0.8
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.4
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.6
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.2
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.2.0.12
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.10
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.8
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.6
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.4
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.2;
locks; strict;
comment	@# @;


1.3
date	2014.11.06.22.15.22;	author schwarze;	state Exp;
branches;
next	1.2;
commitid	D3bBI1MjSqXufVLW;

1.2
date	2011.12.04.15.41.26;	author schwarze;	state Exp;
branches;
next	1.1;

1.1
date	2011.10.12.22.00.07;	author schwarze;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to groff-1.22.3

new features:
* glilypond(1) - new preprocessor for music typesetting
* gperl(1) - new preprocessor for embedding Perl code in roff documents
* gpinyin(1) - new preprocessor to pretty-print Pinyin syllables
* groff_mom(7) now has full eqn(7), pic(7), and tbl(7) support
* mdoc(7) now supports the %C macro (already available in mandoc)

* various bugfixes
* many of our patches have been integrated upstream
* changing the bullet is no longer needed, mandoc can now handle it

ok sthen@@ naddy@@
@
text
@$OpenBSD: patch-Makefile_comm,v 1.2 2011/12/04 15:41:26 schwarze Exp $
# Install preformatted manuals
# since mandoc(1) does not format the groff manuals well.
# But install groff_mdoc(7) as source
# because mandoc(1) handles that one better than groff.
--- Makefile.comm.orig	Mon Oct 13 00:16:08 2014
+++ Makefile.comm	Mon Oct 13 00:32:56 2014
@@@@ -172,27 +172,44 @@@@ install_man:
 	-test -d $(DESTDIR)$(man1dir) || $(mkinstalldirs) $(DESTDIR)$(man1dir)
 	@@-pages="$(MAN1)"; \
 	 for p in $$pages; do \
-	   prog=`basename $$p .n`; \
-	   target=$(DESTDIR)$(man1dir)/$(NAMEPREFIX)$$prog.$(man1ext); \
+	   p0="$${p%.n}.0"; \
+	   echo "groff -t -mandoc -Tascii -P -c $$p > $$p0"; \
+	   $(top_srcdir)/test-groff -t -mandoc -Tascii -P -c $$p > $$p0; \
+	   target=$(DESTDIR)$(man1dir)/$(NAMEPREFIX)$$p0; \
 	   rm -f $$target; \
-	   echo $(INSTALL_DATA) $$p $$target; \
-	   $(INSTALL_DATA) $$p $$target; \
+	   echo $(INSTALL_DATA) $$p0 $$target; \
+	   $(INSTALL_DATA) $$p0 $$target; \
 	done
 	-test -d $(DESTDIR)$(man5dir) || $(mkinstalldirs) $(DESTDIR)$(man5dir)
 	@@-pages="$(MAN5)"; \
 	 for p in $$pages; do \
-	   target=$(DESTDIR)$(man5dir)/`basename $$p .n`.$(man5ext); \
+	   p0="$${p%.n}.0"; \
+	   echo "groff -t -mandoc -Tascii -P -c $$p > $$p0"; \
+	   $(top_srcdir)/test-groff -t -mandoc -Tascii -P -c $$p > $$p0; \
+	   target=$(DESTDIR)$(man5dir)/$$p0; \
 	   rm -f $$target; \
-	   echo $(INSTALL_DATA) $$p $$target; \
-	   $(INSTALL_DATA) $$p $$target; \
+	   echo $(INSTALL_DATA) $$p0 $$target; \
+	   $(INSTALL_DATA) $$p0 $$target; \
 	done
 	-test -d $(DESTDIR)$(man7dir) || $(mkinstalldirs) $(DESTDIR)$(man7dir)
 	@@-pages="$(MAN7)"; \
 	 for p in $$pages; do \
-	   target=$(DESTDIR)$(man7dir)/`basename $$p .n`.$(man7ext); \
+	  if [ "X$$p" = "Xgroff_mdoc.n" ]; then \
+	   mdocdir=$(DESTDIR)$(manroot)/man$(man7ext); \
+	   test -d $$mdocdir || $(mkinstalldirs) $$mdocdir; \
+	   target=$$mdocdir/groff_mdoc.7; \
 	   rm -f $$target; \
 	   echo $(INSTALL_DATA) $$p $$target; \
 	   $(INSTALL_DATA) $$p $$target; \
+	  else \
+	   p0="$${p%.n}.0"; \
+	   echo "groff -t -mandoc -Tascii -P -c $$p > $$p0"; \
+	   $(top_srcdir)/test-groff -t -mandoc -Tascii -P -c $$p > $$p0; \
+	   target=$(DESTDIR)$(man7dir)/$$p0; \
+	   rm -f $$target; \
+	   echo $(INSTALL_DATA) $$p0 $$target; \
+	   $(INSTALL_DATA) $$p0 $$target; \
+	  fi; \
 	done
 
 .PHONY: uninstall_man
@


1.2
log
@General cleanup:
* Unbreak groff manuals by using tbl(1); reported by pascal@@.
* Deal with our Mdocdate cvs keyword; as designed by jmc@@ in 2007.
* Use troffrc for OpenBSD config changes; suggested by Werner Lemberg.
* Unbreak the hdtbl examples; from upstream.
* Volume names in man(7) page headers; suggested by Yuri Pankov.
* Update various string tables; coordinated with upstream.
* Add a README explaining local changes; using feedback from pascal@@.
* Better description and bump.
ok pascal@@, and tested in an i386 bulk build by naddy@@, thanks!
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile_comm,v 1.1 2011/10/12 22:00:07 schwarze Exp $
d6 3
a8 3
--- Makefile.comm.orig	Fri Dec 31 08:33:08 2010
+++ Makefile.comm	Fri Oct 21 22:19:48 2011
@@@@ -176,27 +176,44 @@@@ install_man:
d11 12
a22 12
 	for p in $$pages; do \
-	 prog=`basename $$p .n`; \
-	 target=$(DESTDIR)$(man1dir)/$(NAMEPREFIX)$$prog.$(man1ext); \
+	 p0="$${p%.n}.0"; \
+	 echo "groff -t -mandoc -Tascii -P -c $$p > $$p0"; \
+	 $(top_srcdir)/test-groff -t -mandoc -Tascii -P -c $$p > $$p0; \
+	 target=$(DESTDIR)$(man1dir)/$(NAMEPREFIX)$$p0; \
 	 rm -f $$target; \
-	 echo $(INSTALL_DATA) $$p $$target; \
-	 $(INSTALL_DATA) $$p $$target; \
+	 echo $(INSTALL_DATA) $$p0 $$target; \
+	 $(INSTALL_DATA) $$p0 $$target; \
d26 11
a36 11
 	for p in $$pages; do \
-	 target=$(DESTDIR)$(man5dir)/`basename $$p .n`.$(man5ext); \
+	 p0="$${p%.n}.0"; \
+	 echo "groff -t -mandoc -Tascii -P -c $$p > $$p0"; \
+	 $(top_srcdir)/test-groff -t -mandoc -Tascii -P -c $$p > $$p0; \
+	 target=$(DESTDIR)$(man5dir)/$$p0; \
 	 rm -f $$target; \
-	 echo $(INSTALL_DATA) $$p $$target; \
-	 $(INSTALL_DATA) $$p $$target; \
+	 echo $(INSTALL_DATA) $$p0 $$target; \
+	 $(INSTALL_DATA) $$p0 $$target; \
d40 18
a57 18
 	for p in $$pages; do \
-	 target=$(DESTDIR)$(man7dir)/`basename $$p .n`.$(man7ext); \
+	if [ "X$$p" = "Xgroff_mdoc.n" ]; then \
+	 mdocdir=$(DESTDIR)$(manroot)/man$(man7ext); \
+	 test -d $$mdocdir || $(mkinstalldirs) $$mdocdir; \
+	 target=$$mdocdir/groff_mdoc.7; \
 	 rm -f $$target; \
 	 echo $(INSTALL_DATA) $$p $$target; \
 	 $(INSTALL_DATA) $$p $$target; \
+	else \
+	 p0="$${p%.n}.0"; \
+	 echo "groff -t -mandoc -Tascii -P -c $$p > $$p0"; \
+	 $(top_srcdir)/test-groff -t -mandoc -Tascii -P -c $$p > $$p0; \
+	 target=$(DESTDIR)$(man7dir)/$$p0; \
+	 rm -f $$target; \
+	 echo $(INSTALL_DATA) $$p0 $$target; \
+	 $(INSTALL_DATA) $$p0 $$target; \
+	fi; \
@


1.1
log
@Format groff manuals with groff before installing them
because mandoc(1) doesn't like them, with the exception
of groff_mdoc(7), which is derived from the traditional
mdoc.samples(7) and which is just fine with mandoc(1).
Problem reported and fix tested by <Pascal dot Stumpf at cubes dot de>.
naddy@@ and deraadt@@ agree with the general direction
@
text
@d1 1
a1 1
$OpenBSD$
d7 1
a7 1
+++ Makefile.comm	Tue Oct 11 02:57:44 2011
d15 2
a16 2
+	 echo "groff -mandoc -Tascii -P -c $$p > $$p0"; \
+	 $(top_srcdir)/test-groff -mandoc -Tascii -P -c $$p > $$p0; \
d29 2
a30 2
+	 echo "groff -mandoc -Tascii -P -c $$p > $$p0"; \
+	 $(top_srcdir)/test-groff -mandoc -Tascii -P -c $$p > $$p0; \
d51 2
a52 2
+	 echo "groff -mandoc -Tascii -P -c $$p > $$p0"; \
+	 $(top_srcdir)/test-groff -mandoc -Tascii -P -c $$p > $$p0; \
@

