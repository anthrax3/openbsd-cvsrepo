head	1.36;
access;
symbols
	OPENBSD_6_1:1.31.0.2
	OPENBSD_6_1_BASE:1.31
	OPENBSD_6_0:1.30.0.6
	OPENBSD_6_0_BASE:1.30
	OPENBSD_5_9:1.30.0.2
	OPENBSD_5_9_BASE:1.30
	OPENBSD_5_8:1.30.0.4
	OPENBSD_5_8_BASE:1.30
	OPENBSD_5_7:1.28.0.2
	OPENBSD_5_7_BASE:1.28
	OPENBSD_5_6:1.26.0.4
	OPENBSD_5_6_BASE:1.26
	OPENBSD_5_5:1.26.0.2
	OPENBSD_5_5_BASE:1.26
	OPENBSD_5_4:1.23.0.2
	OPENBSD_5_4_BASE:1.23
	OPENBSD_5_3:1.19.0.2
	OPENBSD_5_3_BASE:1.19
	OPENBSD_5_2:1.18.0.2
	OPENBSD_5_2_BASE:1.18
	OPENBSD_5_1_BASE:1.16
	OPENBSD_5_1:1.16.0.2
	OPENBSD_5_0:1.13.0.2
	OPENBSD_5_0_BASE:1.13
	OPENBSD_4_9:1.7.0.2
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.4.0.2
	OPENBSD_4_8_BASE:1.4
	ports:1.1.1.1
	espie:1.1.1;
locks; strict;
comment	@# @;


1.36
date	2017.07.23.09.26.29;	author espie;	state Exp;
branches;
next	1.35;
commitid	FZPR2Emws5uDqXzb;

1.35
date	2017.07.16.19.19.02;	author espie;	state Exp;
branches;
next	1.34;
commitid	tt0GhWK5c4uf9ILG;

1.34
date	2017.07.04.17.44.13;	author schwarze;	state Exp;
branches;
next	1.33;
commitid	GhwB1K4KLe4UXs2n;

1.33
date	2017.04.14.19.49.06;	author schwarze;	state Exp;
branches;
next	1.32;
commitid	0IGzV8717IceDNFq;

1.32
date	2017.04.10.11.46.34;	author sthen;	state Exp;
branches;
next	1.31;
commitid	HY6VNZxjJWzKQFDV;

1.31
date	2016.10.17.18.32.34;	author schwarze;	state Exp;
branches;
next	1.30;
commitid	ntJKgwFPojbFEzWP;

1.30
date	2015.07.18.04.32.26;	author schwarze;	state Exp;
branches;
next	1.29;
commitid	qZ2xu54bkCjOw3Uw;

1.29
date	2015.04.19.15.20.43;	author schwarze;	state Exp;
branches;
next	1.28;
commitid	50Y0EBe1U4u4zC0a;

1.28
date	2015.02.16.15.45.11;	author schwarze;	state Exp;
branches;
next	1.27;
commitid	FwjI8j47lFXfzyJv;

1.27
date	2014.11.06.22.15.22;	author schwarze;	state Exp;
branches;
next	1.26;
commitid	D3bBI1MjSqXufVLW;

1.26
date	2013.12.15.15.19.50;	author schwarze;	state Exp;
branches;
next	1.25;

1.25
date	2013.11.11.06.41.02;	author schwarze;	state Exp;
branches;
next	1.24;

1.24
date	2013.11.09.23.19.03;	author naddy;	state Exp;
branches;
next	1.23;

1.23
date	2013.07.13.07.38.59;	author schwarze;	state Exp;
branches;
next	1.22;

1.22
date	2013.05.24.14.10.01;	author zhuk;	state Exp;
branches;
next	1.21;

1.21
date	2013.03.30.23.10.05;	author schwarze;	state Exp;
branches;
next	1.20;

1.20
date	2013.03.11.11.42.41;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2012.09.25.19.31.59;	author sthen;	state Exp;
branches;
next	1.18;

1.18
date	2012.05.28.13.23.28;	author schwarze;	state Exp;
branches;
next	1.17;

1.17
date	2012.02.26.22.28.34;	author schwarze;	state Exp;
branches;
next	1.16;

1.16
date	2011.12.13.18.16.37;	author pascal;	state Exp;
branches;
next	1.15;

1.15
date	2011.12.04.15.41.26;	author schwarze;	state Exp;
branches;
next	1.14;

1.14
date	2011.10.12.22.00.07;	author schwarze;	state Exp;
branches;
next	1.13;

1.13
date	2011.07.07.05.27.15;	author schwarze;	state Exp;
branches;
next	1.12;

1.12
date	2011.06.23.12.14.51;	author schwarze;	state Exp;
branches;
next	1.11;

1.11
date	2011.04.13.16.20.34;	author kili;	state Exp;
branches;
next	1.10;

1.10
date	2011.03.22.22.27.03;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2011.03.20.17.30.24;	author schwarze;	state Exp;
branches;
next	1.8;

1.8
date	2011.03.19.16.48.53;	author schwarze;	state Exp;
branches;
next	1.7;

1.7
date	2010.11.20.19.56.48;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2010.10.28.14.41.55;	author schwarze;	state Exp;
branches;
next	1.5;

1.5
date	2010.10.19.21.26.26;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2010.05.25.18.56.07;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2010.05.22.10.39.24;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2010.04.05.14.49.25;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.04.05.14.30.32;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.04.05.14.30.32;	author espie;	state Exp;
branches;
next	;


desc
@@


1.36
log
@add pthread to COMPILER_LIBCXX.
white lie, but it allows clang and gcc to be more similar
bump accordingly.
@
text
@# $OpenBSD: Makefile,v 1.35 2017/07/16 19:19:02 espie Exp $

COMMENT =		GNU troff typesetter
VERSION =		1.22.3
SUBST_VARS =		VERSION
DISTNAME =		groff-${VERSION}
REVISION =		6

CATEGORIES =		textproc
DPB_PROPERTIES =	parallel

HOMEPAGE =		https://www.gnu.org/software/groff/
MAINTAINER =		Ingo Schwarze <schwarze@@openbsd.org>

# GPLv3+
PERMIT_PACKAGE_CDROM =	Yes

WANTLIB =		c m ${COMPILER_LIBCXX}

MASTER_SITES =		${MASTER_SITE_GNU:=groff/}

MAKE_FLAGS +=		docdir=${PREFIX}/share/doc/groff \
			exampledir=${PREFIX}/share/examples/groff \
			ac_cv_path_mkdir=/bin/mkdir

MODULES =		perl
CONFIGURE_STYLE =	gnu
CONFIGURE_ARGS +=	--without-libiconv-prefix --without-gs --without-x \
			--with-awk=awk \
			pnmcrop=missing pnmcut=missing pnmtopng=missing \
			pnmtops=missing psselect=missing

MODGNU_CONFIG_GUESS_DIRS = ${WRKSRC} ${WRKSRC}/src/libs/gnulib/build-aux

pre-configure:
	find ${WRKBUILD} -name \*.pl -type f -print0 | \
	    xargs -0 ${MODPERL_BIN_ADJ}

.include <bsd.port.mk>
@


1.35
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2017/07/04 17:44:13 schwarze Exp $
d7 1
a7 1
REVISION =		5
@


1.34
log
@Set the default operating system name for manual pages
to just "OpenBSD": that's the obvious thing to do, no idea why i
didn't do it long ago.  So far, man(7) had no default at all, and
the "OpenBSD ports" used by mdoc(7) no longer makes sense because
only about 25 ports use groff nowadays, and none of those use mdoc(7).
This change is also simplifies groff-mandoc comparisons.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2017/04/14 19:49:06 schwarze Exp $
d18 1
a18 1
WANTLIB =		c m ${LIBCXX}
@


1.33
log
@Pull in four patches that i recently pushed upstream to GNU troff.
Joint work with bentley@@, all committed upstream by Carsten Kunze.

https://savannah.gnu.org/bugs/?43554 - better \*[Lq] and \*[Rq]
https://savannah.gnu.org/bugs/?43553 - typographic quotes for .%T
https://savannah.gnu.org/bugs/?50771 - punctuation after .Lk
https://savannah.gnu.org/bugs/?50789 - .Lk with more than two args
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2017/04/10 11:46:34 sthen Exp $
d7 1
a7 1
REVISION =		4
@


1.32
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2016/10/17 18:32:34 schwarze Exp $
d7 1
a7 1
REVISION =		3
@


1.31
log
@Pull in a patch committed upstream:
Make the behaviour of .Bl -tag without -width comprehensible
and the same as in mandoc(1).
No opposition when shown on ports@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2015/07/18 04:32:26 schwarze Exp $
d18 1
a18 1
WANTLIB =		c m stdc++
@


1.30
log
@Fix bullet character for UTF-8 output.  From upstream git.
naddy@@ says i should just commit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2015/04/19 15:20:43 schwarze Exp $
d7 1
a7 1
REVISION =		2
@


1.29
log
@Apply a bugfix to .Bl that i sent upstream and that got merged there.
Helps groff-mandoc comparisons, for example in mutella(1).
No opposition when shown on ports@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2015/02/16 15:45:11 schwarze Exp $
d7 1
a7 1
REVISION =		1
@


1.28
log
@* delete bogus version number from README; from Kaspars at Bankovskis dot net
* we no longer change the rendering of the bullet character
* avoid groff warning "unbalanced .el request" when running with -mdoc -ww
* improve rendering of large braces in UTF-8 output (accepted upstream)
* bump REVISION
ok sthen@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2014/11/06 22:15:22 schwarze Exp $
d7 1
a7 1
REVISION =		0
@


1.27
log
@update to groff-1.22.3

new features:
* glilypond(1) - new preprocessor for music typesetting
* gperl(1) - new preprocessor for embedding Perl code in roff documents
* gpinyin(1) - new preprocessor to pretty-print Pinyin syllables
* groff_mom(7) now has full eqn(7), pic(7), and tbl(7) support
* mdoc(7) now supports the %C macro (already available in mandoc)

* various bugfixes
* many of our patches have been integrated upstream
* changing the bullet is no longer needed, mandoc can now handle it

ok sthen@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2013/12/15 15:19:50 schwarze Exp $
d7 1
@


1.26
log
@Two bug fixes, one bump.

1) For man(7), initialize internal numerical registers correctly
such that a stray .RE without a preceding .RS doesn't set the left
margin to column 0.  Reported by bentley@@ on discuss at mdocml.
Patch technically approved by Werner Lemberg (upstream).
The only reason it isn't committed upstream yet is that FSF
pesters me to sign a Copyright Assignment contract under
Massachusetts legislature, talking about Warranties and whatnot,
which i resist.

2) Restore correct syntax to the .ie cascade governing section titles
that i broke, trying to be too clever.  Problem reported by
David Levine via pascal@@ after the nmh(1) folks added an OpenBSD
machine to their buildbot cluster.

ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2013/11/11 06:41:02 schwarze Exp $
d4 1
a4 1
VERSION =		1.22.2
a6 1
REVISION =		4
@


1.25
log
@My implementation of .%C (city) in .Rs (citation block), accepted and
committed upstream.  It already works in mandoc(1), and it is used in
some OpenBSD base system manuals, and using it is generally encouraged,
so having it in our groff port as well really makes sense.
ok bentley@@ on August 1, 2013 (and i forgot to commit after unlock, sorry)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2013/11/09 23:19:03 naddy Exp $
d7 1
a7 1
REVISION =		3
@


1.24
log
@move http://www.gnu.org to https
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2013/07/13 07:38:59 schwarze Exp $
d7 1
a7 1
REVISION =		2
@


1.23
log
@Add a patch to avoid permanent damage to the right margin
when a man(7) input file contains two consecutive .TP lines.
This bugfix improves the formatting of unzip(1), for example.

While here, recognize 5.4 as an OpenBSD version in mdoc(7) files.

ok sthen@@ dcoppa@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2013/05/24 14:10:01 zhuk Exp $
d7 1
a7 1
REVISION =		1
d12 1
a12 1
HOMEPAGE =		http://www.gnu.org/software/groff/
@


1.22
log
@Use MODPERL_BIN_ADJ for those ports.
okay dcoppa@@ and schwarze@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2013/03/30 23:10:05 schwarze Exp $
d7 1
a7 1
REVISION =		0
@


1.21
log
@Maintenance update to groff-1.22.2.
* New features: gropdf(1), pdfmom(1)
* Lots of our patches were accepted upstream, lots of upstream bug fixes.
Tested by landry@@ and pascal@@, ok landry@@ and sthen@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2013/03/11 11:42:41 espie Exp $
d7 1
d26 1
d36 2
a37 2
	find ${WRKBUILD} -name \*.pl -type f | \
		xargs perl -pi -e 's@@^#![[:space:]]*/usr/bin/env[[:space:]]+perl@@#!/usr/bin/perl@@'
@


1.20
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2012/09/25 19:31:59 sthen Exp $
d4 3
a6 2
DISTNAME =		groff-1.21
REVISION =		8
d27 3
a29 1
			--with-awk=awk
@


1.19
log
@let dpb build groff in parallel, suggested by espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2012/05/28 13:23:28 schwarze Exp $
a14 3
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM =Yes
PERMIT_DISTFILES_FTP =	Yes
@


1.18
log
@In the footers of manuals formatted with groff,
do not print "OpenBSD 5.0" but "OpenBSD ports".
While here, remove some noise from the groff build log.
Bump the groff package.

Technically, this changes the contents of all packages that USE_GROFF,
but please refrain from bumping the world:  Having "OpenBSD 5.0" in
the footers of some ports manual until they are updated the next time,
or until the next libc bump if they aren't, is not a real problem.

string "OpenBSD ports" suggested and patch ok'ed by sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2012/02/26 22:28:34 schwarze Exp $
d8 2
@


1.17
log
@Correct the expansion of -xbd5,
keeping groff in sync with the mandoc(1) fix just committed by guenther@@;
also committed upstream by Werner Lemberg <wl at gnu dot org>.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/12/13 18:16:37 pascal Exp $
d5 1
a5 1
REVISION =		7
@


1.16
log
@Don't pick up gmkdir and gawk (ac_cv_path_AWK is not respected here).

ok schwarze@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/12/04 15:41:26 schwarze Exp $
d5 1
a5 1
REVISION =		6
@


1.15
log
@General cleanup:
* Unbreak groff manuals by using tbl(1); reported by pascal@@.
* Deal with our Mdocdate cvs keyword; as designed by jmc@@ in 2007.
* Use troffrc for OpenBSD config changes; suggested by Werner Lemberg.
* Unbreak the hdtbl examples; from upstream.
* Volume names in man(7) page headers; suggested by Yuri Pankov.
* Update various string tables; coordinated with upstream.
* Add a README explaining local changes; using feedback from pascal@@.
* Better description and bump.
ok pascal@@, and tested in an i386 bulk build by naddy@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/10/12 22:00:07 schwarze Exp $
d22 2
a23 1
			exampledir=${PREFIX}/share/examples/groff
d26 2
a27 1
CONFIGURE_ARGS +=	--without-libiconv-prefix --without-gs --without-x
@


1.14
log
@Format groff manuals with groff before installing them
because mandoc(1) doesn't like them, with the exception
of groff_mdoc(7), which is derived from the traditional
mdoc.samples(7) and which is just fine with mandoc(1).
Problem reported and fix tested by <Pascal dot Stumpf at cubes dot de>.
naddy@@ and deraadt@@ agree with the general direction
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/07/07 05:27:15 schwarze Exp $
d5 1
a5 1
REVISION =		5
@


1.13
log
@Represent bullets (for example in .Bl -bullet) by "o\bo" instead of "+\bo"
to agree with mandoc(1) and reduce noise in automatic output comparisons.
ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/06/23 12:14:51 schwarze Exp $
d5 1
a5 1
REVISION =		4
@


1.12
log
@Following http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=538330,
Solar Designer did an audit of temp file handling in groff-1.20.
He found and fixed *lots* of ugliness, but most does not look
exploitable and some was already improved in groff-1.21.

This is my own fix for the only one that, with a huge amount of extra
paranoia, might be worth patching.  To mount an exploit, the attacker
would need to trick root into setting an unusable TMPDIR (or similar)
variable in the environment such that mktemp -d fails, then convince
root to run pdfroff (*you* don't run that as root, do you?), then
handle a race condition to find the PID and predict the temp file
name to mount a symlink attack.

"I think we should still go for the fix" jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/04/13 16:20:34 kili Exp $
d5 1
a5 1
REVISION =		3
@


1.11
log
@Don't use #!/usr/bin/env perl in installed scripts, just use
#!/usr/bin/perl.

ok schwarze@@, espie@@ (well, kind of)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/03/22 22:27:03 espie Exp $
d5 1
a5 1
REVISION =		2
@


1.10
log
@work-around until someone actually debugs the grammar: use the provided
generated file, don't call yacc.

okay millert@@, naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/03/20 17:30:24 schwarze Exp $
d5 1
a5 1
REVISION =		1
d28 4
@


1.9
log
@Support upgrades from both groff-1.15+groff-mdoc
and from groff-mdoc only to groff-1.21.
Muliple cluesticks applied by and OK espie@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2011/03/19 16:48:53 schwarze Exp $
d5 1
a5 1
REVISION =		0
a23 1
SEPARATE_BUILD =	simple
@


1.8
log
@First major OpenBSD groff update since 2000.
Lots of new functionality, lots of bug fixes, and bringing in
significant maintenance efforts from upstream.
To name just one specific example, the number of arguments mdoc(7)
macros can take is no longer limited.
Two of the more tricky patches contributed by naddy@@, thanks!
Tested in bulk builds by landry@@.
Tested on sparc (GCC 2) by phessler@@ and on alpha (GCC 3) by naddy@@.
ok naddy@@, landry@@

Before using this to build ports, make sure you install
the src/usr.sbin/pkg_add/OpenBSD/PackingElement.pm patch
i'm going to commit right afterwards as well, or you will end up
with ports manuals containing ANSI escape sequences.
@
text
@d1 1
a1 1
# $OpenBSD$
d5 1
@


1.7
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/10/28 14:41:55 schwarze Exp $
d3 2
a4 2
CATEGORIES =	textproc
COMMENT =	gnu clone of nroff
d6 3
a8 21
# groff 1.15 as patched for OpenBSD-4.7
DISTNAME = groff-1.15.4.7
REVISION = 3
MASTER_SITES = http://www.bsdfrog.org/OpenBSD/distfiles/

# GPLv2
PERMIT_DISTFILES_FTP = 		Yes
PERMIT_DISTFILES_CDROM = 	Yes
PERMIT_PACKAGE_FTP = 		Yes
PERMIT_PACKAGE_CDROM = 		Yes

WRKDIST = ${WRKDIR}/groff
MAKE_FILE = Makefile.bsd-wrapper
WANTLIB += c m stdc++
RUN_DEPENDS += textproc/groff.mdoc

MAKE_FLAGS = BINDIR=${TRUEPREFIX}/bin MANDIR=${TRUEPREFIX}/man/cat \
	PREFIX=${TRUEPREFIX} DATASUBDIR=${TRUEPREFIX}/share \
	FONTDIR=${TRUEPREFIX}/share/groff_font \
	INDEXDIR=${TRUEPREFIX}/share/dict/papers \
	COMMON_WORDS=${TRUEPREFIX}/share/dict/eign
d10 18
a27 2
do-configure:
	cd ${WRKDIST} && ${MAKE} ${MAKE_FLAGS} -f ${MAKE_FILE} config.status
@


1.6
log
@Increase the -man -Tascii text width from 65 to 78 characters.
Patch by millert@@, see OpenBSD tmac.an rev. 1.2.
Bump.
Requested by naddy@@; ok espie@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/10/19 21:26:26 espie Exp $
d20 1
a20 1
RUN_DEPENDS += ::textproc/groff.mdoc
@


1.5
log
@make sure groff has its macros
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/05/25 18:56:07 jasper Exp $
d8 1
a8 1
REVISION = 2
@


1.4
log
@- sync after nicm's commit to base.

ok nicm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/05/22 10:39:24 espie Exp $
d8 1
a8 1
PKGNAME = ${DISTNAME}p1
d20 1
@


1.3
log
@synch with -current, fixes build for gcc4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/04/05 14:49:25 ajacoutot Exp $
d8 1
a8 1
PKGNAME = ${DISTNAME}p0
@


1.2
log
@Zap empty line. Use punctuation and capital.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/04/05 14:30:32 espie Exp $
d6 1
a6 1
# groff 1.15 as patched for OpenBSD 4.7
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d8 1
@


1.1.1.1
log
@groff from OpenBSD 4.7, so that we can move forward
@
text
@@
