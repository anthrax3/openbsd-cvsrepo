head	1.5;
access;
symbols
	OPENBSD_4_3:1.4.0.4
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.3.0.6
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.4
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.2
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.2.0.8
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.6
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.4
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2;
locks; strict;
comment	@# @;


1.5
date	2008.04.25.19.19.05;	author deanna;	state dead;
branches;
next	1.4;

1.4
date	2007.03.30.04.09.42;	author ckuethe;	state Exp;
branches;
next	1.3;

1.3
date	2005.09.09.17.34.53;	author brad;	state Exp;
branches
	1.3.2.1
	1.3.4.1
	1.3.6.1;
next	1.2;

1.2
date	2004.01.25.06.02.40;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.24.19.31.57;	author brad;	state Exp;
branches;
next	;

1.3.2.1
date	2007.04.03.12.16.22;	author sturm;	state Exp;
branches;
next	;

1.3.4.1
date	2007.04.03.12.03.20;	author sturm;	state Exp;
branches;
next	;

1.3.6.1
date	2007.05.01.16.28.30;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Simplify anti-DRM patches.  Catches a new DRM check that slipped in
from upstream.

Diff from brad@@, inspired by Floor on ports@@

ok brad@@, bernd@@, pvalchev@@, and a special "Kill the DRM!  DIE DIE
DIE!!!!!!!!" from todd@@
@
text
@$OpenBSD: patch-xpdf_XPDFCore_cc,v 1.4 2007/03/30 04:09:42 ckuethe Exp $
--- xpdf/XPDFCore.cc.orig	Tue Feb 27 22:05:52 2007
+++ xpdf/XPDFCore.cc	Fri Mar 30 00:31:19 2007
@@@@ -407,9 +407,6 @@@@ void XPDFCore::copySelection() {
   int pg;
   double ulx, uly, lrx, lry;
 
-  if (!doc->okToCopy()) {
-    return;
-  }
   if (getSelection(&pg, &ulx, &uly, &lrx, &lry)) {
     //~ for multithreading: need a mutex here
     if (currentSelection) {
@


1.4
log
@Update to xpdf 3.0.2, from Stuart Henderson and Brad Smith
Includes some security fixes

ok pvalchev, todd
@
text
@d1 1
a1 1
$OpenBSD: patch-xpdf_XPDFCore_cc,v 1.3 2005/09/09 17:34:53 brad Exp $
@


1.3
log
@upgrade to xpdf 3.01

Most of the update is from Bernd Ahlers <bernd at ba-net dot org>
@
text
@d1 4
a4 4
$OpenBSD: patch-xpdf_XPDFCore_cc,v 1.2 2004/01/25 06:02:40 brad Exp $
--- xpdf/XPDFCore.cc.orig	Wed Aug 17 07:34:31 2005
+++ xpdf/XPDFCore.cc	Thu Aug 18 10:23:14 2005
@@@@ -377,9 +377,6 @@@@ void XPDFCore::copySelection() {
a13 12
@@@@ -1108,11 +1105,7 @@@@ void XPDFCore::inputCbk(Widget widget, X
 #ifndef NO_TEXT_SELECT
 	  if (core->selectULX != core->selectLRX &&
 	      core->selectULY != core->selectLRY) {
-	    if (core->doc->okToCopy()) {
 	      core->copySelection();
-	    } else {
-	      error(-1, "Copying of text from this document is not allowed.");
-	    }
 	  }
 #endif
 	}
@


1.3.6.1
log
@MFC:
Update to xpdf 3.0.2, from Stuart Henderson and Brad Smith
Includes some security fixes
@
text
@d1 4
a4 4
$OpenBSD: patch-xpdf_XPDFCore_cc,v 1.3 2005/09/09 17:34:53 brad Exp $
--- xpdf/XPDFCore.cc.orig	Tue Feb 27 23:05:52 2007
+++ xpdf/XPDFCore.cc	Sat Apr 14 23:07:36 2007
@@@@ -407,9 +407,6 @@@@ void XPDFCore::copySelection() {
d14 12
@


1.3.2.1
log
@MFC:
Update to xpdf 3.0.2, from Stuart Henderson and Brad Smith
Includes some security fixes
@
text
@d1 4
a4 4
$OpenBSD: patch-xpdf_XPDFCore_cc,v 1.3 2005/09/09 17:34:53 brad Exp $
--- xpdf/XPDFCore.cc.orig	Tue Feb 27 23:05:52 2007
+++ xpdf/XPDFCore.cc	Tue Apr  3 14:11:57 2007
@@@@ -407,9 +407,6 @@@@ void XPDFCore::copySelection() {
d14 12
@


1.3.4.1
log
@MFC:
Update to xpdf 3.0.2, from Stuart Henderson and Brad Smith
Includes some security fixes
@
text
@d1 4
a4 4
$OpenBSD: patch-xpdf_XPDFCore_cc,v 1.3 2005/09/09 17:34:53 brad Exp $
--- xpdf/XPDFCore.cc.orig	Tue Feb 27 23:05:52 2007
+++ xpdf/XPDFCore.cc	Mon Apr  2 23:37:33 2007
@@@@ -407,9 +407,6 @@@@ void XPDFCore::copySelection() {
d14 12
@


1.2
log
@upgrade to xpdf 3.00

"shitloads better rendering" - jose@@
@
text
@d1 6
a6 5
$OpenBSD: patch-xpdf_XPDFCore_cc,v 1.1 2003/10/24 19:31:57 brad Exp $
--- xpdf/XPDFCore.cc.orig	2004-01-21 20:26:45.000000000 -0500
+++ xpdf/XPDFCore.cc	2004-01-24 23:34:15.000000000 -0500
@@@@ -940,9 +940,6 @@@@ void XPDFCore::moveSelection(int mx, int
 // global variables (currentSelection and currentSelectionOwner).
a7 1
 void XPDFCore::copySelection() {
d11 4
a14 24
   if (currentSelection) {
     delete currentSelection;
   }
@@@@ -997,9 +994,6 @@@@ GBool XPDFCore::getSelection(int *xMin, 
 }
 
 GString *XPDFCore::extractText(int xMin, int yMin, int xMax, int yMax) {
-  if (!doc->okToCopy()) {
-    return NULL;
-  }
   return out->getText(xMin, yMin, xMax, yMax);
 }
 
@@@@ -1008,9 +1002,6 @@@@ GString *XPDFCore::extractText(int pageN
   TextOutputDev *textOut;
   GString *s;
 
-  if (!doc->okToCopy()) {
-    return NULL;
-  }
   textOut = new TextOutputDev(NULL, gTrue, gFalse, gFalse);
   if (!textOut->isOk()) {
     delete textOut;
@@@@ -1649,11 +1640,7 @@@@ void XPDFCore::inputCbk(Widget widget, X
d16 2
a17 2
 	  if (core->selectXMin != core->selectXMax &&
 	      core->selectYMin != core->selectYMax) {
@


1.1
log
@remove DRM bullshit.
--
From: cloder@@
@
text
@d1 4
a4 4
$OpenBSD$
--- xpdf/XPDFCore.cc.orig	2003-10-23 22:54:49.000000000 -0700
+++ xpdf/XPDFCore.cc	2003-10-23 22:56:34.000000000 -0700
@@@@ -970,9 +970,6 @@@@ void XPDFCore::moveSelection(int mx, int
d14 1
a14 1
@@@@ -1027,9 +1024,6 @@@@ GBool XPDFCore::getSelection(int *xMin, 
d24 1
a24 1
@@@@ -1038,9 +1032,6 @@@@ GString *XPDFCore::extractText(int pageN
d34 1
a34 1
@@@@ -1680,11 +1671,7 @@@@ void XPDFCore::inputCbk(Widget widget, X
@

