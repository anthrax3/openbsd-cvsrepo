head	1.3;
access;
symbols
	OPENBSD_6_0:1.3.0.4
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.2.0.8
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.4
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.2
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.1.0.2
	OPENBSD_5_5_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2015.10.24.09.53.54;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	sIiz4XQinV5yAXDy;

1.2
date	2014.04.02.16.12.04;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2013.09.27.08.40.58;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to simple-scan-3.18.0.
@
text
@$OpenBSD: patch-src_simple-scan_vala,v 1.2 2014/04/02 16:12:04 ajacoutot Exp $

No gusb under OpenBSD.

--- src/simple-scan.vala.orig	Sun Sep 13 23:35:03 2015
+++ src/simple-scan.vala	Sat Oct 24 11:40:31 2015
@@@@ -31,7 +31,6 @@@@ public class SimpleScan : Gtk.Application
 
     private ScanDevice? default_device = null;
     private bool have_devices = false;
-    private GUsb.Context usb_context;
     private UserInterface ui;
     private Scanner scanner;
     private Book book;
@@@@ -62,17 +61,6 @@@@ public class SimpleScan : Gtk.Application
         scanner.scan_failed.connect (scanner_failed_cb);
         scanner.scanning_changed.connect (scanner_scanning_changed_cb);
 
-        try
-        {
-            usb_context = new GUsb.Context ();
-            usb_context.device_added.connect (() => { scanner.redetect (); });
-            usb_context.device_removed.connect (() => { scanner.redetect (); });
-        }
-        catch (Error e)
-        {
-            warning ("Failed to create USB context: %s\n", e.message);
-        }
-
         if (default_device != null)
         {
             List<ScanDevice> device_list = null;
@@@@ -95,7 +83,6 @@@@ public class SimpleScan : Gtk.Application
         base.shutdown ();
         book = null;
         ui = null;
-        usb_context = null;
         scanner.free ();
     }
 
@@@@ -180,36 +167,8 @@@@ public class SimpleScan : Gtk.Application
 
     public string? suggest_driver ()
     {
-        if (usb_context == null)
-            return null;
-
-        var driver_map = new HashTable <uint32, string> (direct_hash, direct_equal);
-        add_devices (driver_map, brscan_devices, "brscan");
-        add_devices (driver_map, brscan2_devices, "brscan2");
-        add_devices (driver_map, brscan3_devices, "brscan3");
-        add_devices (driver_map, brscan4_devices, "brscan4");
-        add_devices (driver_map, samsung_devices, "samsung");
-        add_devices (driver_map, hpaio_devices, "hpaio");
-        add_devices (driver_map, epkowa_devices, "epkowa");        
-        var devices = GUsb.context_get_devices (usb_context);
-        /* Fixed in GUsb 0.2.7: https://github.com/hughsie/libgusb/commit/83a6b1a20653c1a17f0a909f08652b5e1df44075 */
-        /*var devices = GUSB.context_get_devices (context);*/
-        for (var i = 0; i < devices.length; i++)
-        {
-            var device = devices.data[i];
-            var driver = driver_map.lookup (device.get_vid () << 16 | device.get_pid ());
-            if (driver != null)
-                return driver;
-        }
-
         return null;
     }
-
-    private void add_devices (HashTable<uint32, string> map, uint32[] devices, string driver)
-    {
-        for (var i = 0; i < devices.length; i++)
-            map.insert (devices[i], driver);
-    }   
 
     private void authorize_cb (Scanner scanner, string resource)
     {
@


1.2
log
@Drop udev-only variable.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_simple-scan_vala,v 1.1 2013/09/27 08:40:58 ajacoutot Exp $
d3 1
a3 1
No (g)udev under OpenBSD.
d5 2
a6 2
--- src/simple-scan.vala.orig	Tue Jan  7 09:54:14 2014
+++ src/simple-scan.vala	Wed Apr  2 18:04:22 2014
d11 1
a11 1
-    private GUdev.Client udev_client;
d15 1
a15 1
@@@@ -62,10 +61,6 @@@@ public class SimpleScan : Gtk.Application
d19 10
a28 3
-        string[]? subsystems = { "usb", null };
-        udev_client = new GUdev.Client (subsystems);
-        udev_client.uevent.connect (on_uevent);
d33 1
a33 1
@@@@ -88,7 +83,6 @@@@ public class SimpleScan : Gtk.Application
d37 1
a37 1
-        udev_client = null;
d41 25
a65 5
@@@@ -448,11 +442,6 @@@@ public class SimpleScan : Gtk.Application
         log_file.printf ("[%+.2fs] %s %s\n", log_timer.elapsed (), prefix, message);
         if (debug_enabled)
             stderr.printf ("[%+.2fs] %s %s\n", log_timer.elapsed (), prefix, message);
-    }
d67 4
a70 1
-    private void on_uevent (GUdev.Client client, string action, GUdev.Device device)
d72 3
a74 2
-        scanner.redetect ();
     }
d76 2
a77 1
     private static void fix_pdf (string filename) throws Error
@


1.1
log
@Much easier to just patch the vala file.
@
text
@d1 1
a1 1
$OpenBSD$
d5 2
a6 2
--- src/simple-scan.vala.orig	Fri Sep 27 10:33:59 2013
+++ src/simple-scan.vala	Fri Sep 27 10:34:10 2013
d15 2
a16 1
@@@@ -63,8 +62,6 @@@@ public class SimpleScan : Gtk.Application
d19 1
a19 1
         string[]? subsystems = { "usb", null };
d22 1
a22 1
 
d25 2
a26 1
@@@@ -88,7 +85,6 @@@@ public class SimpleScan : Gtk.Application
d34 1
a34 1
@@@@ -448,11 +444,6 @@@@ public class SimpleScan : Gtk.Application
@

