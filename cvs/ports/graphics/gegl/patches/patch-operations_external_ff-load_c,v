head	1.5;
access;
symbols
	OPENBSD_6_1:1.5.0.12
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.10
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.6
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.8
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.4
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.2
	OPENBSD_5_6_BASE:1.5
	OPENBSD_4_4:1.1.0.2
	OPENBSD_4_4_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2014.04.07.06.52.18;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	2009.01.03.14.58.42;	author ajacoutot;	state dead;
branches;
next	1.3;

1.3
date	2008.10.27.13.15.58;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2008.10.03.10.13.48;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2008.07.09.02.09.59;	author jakemsr;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update gegl to deal with newer FFmpeg API.

ok ajacoutot@@
@
text
@$OpenBSD$

Deal with newer FFmpeg API.

--- operations/external/ff-load.c.orig	Thu Mar 27 04:46:59 2014
+++ operations/external/ff-load.c	Thu Mar 27 04:50:02 2014
@@@@ -137,7 +137,7 @@@@ ff_cleanup (GeglChantO *o)
       if (p->enc)
         avcodec_close (p->enc);
       if (p->ic)
-        av_close_input_file (p->ic);
+        avformat_close_input(&p->ic);
       if (p->lavc_frame)
         av_free (p->lavc_frame);
 
@@@@ -216,9 +216,9 @@@@ decode_frame (GeglOperation *operation,
             {
               do
                 {
-                  if (av_read_packet (p->ic, &p->pkt) < 0)
+                  if (av_read_frame (p->ic, &p->pkt) < 0)
                     {
-                      fprintf (stderr, "av_read_packet failed for %s\n",
+                      fprintf (stderr, "av_read_frame failed for %s\n",
                                o->path);
                       return -1;
                     }
@@@@ -271,12 +271,12 @@@@ prepare (GeglOperation *operation)
       gint err;
 
       ff_cleanup (o);
-      err = av_open_input_file (&p->ic, o->path, NULL, 0, NULL);
+      err = avformat_open_input(&p->ic, o->path, NULL, 0);
       if (err < 0)
         {
           print_error (o->path, err);
         }
-      err = av_find_stream_info (p->ic);
+      err = avformat_find_stream_info (p->ic, NULL);
       if (err < 0)
         {
           g_warning ("ff-load: error finding stream info for %s", o->path);
@@@@ -312,7 +312,7 @@@@ prepare (GeglOperation *operation)
       if (p->codec->capabilities & CODEC_CAP_TRUNCATED)
         p->enc->flags |= CODEC_FLAG_TRUNCATED;
 
-      if (avcodec_open (p->enc, p->codec) < 0)
+      if (avcodec_open2 (p->enc, p->codec, NULL) < 0)
         {
           g_warning ("error opening codec %s", p->enc->codec->name);
           return;
@


1.4
log
@- update to gegl-0.0.22
(needed for upcoming gnome-scan update)

gimp is still happy with this update
@
text
@d1 14
a14 4
$OpenBSD: patch-operations_external_ff-load_c,v 1.3 2008/10/27 13:15:58 ajacoutot Exp $
--- operations/external/ff-load.c.orig	Sun Oct  5 23:08:47 2008
+++ operations/external/ff-load.c	Mon Oct 27 13:21:47 2008
@@@@ -32,7 +32,7 @@@@ gegl_chant_int (frame, _("Frame"), 0, 1000000, 0, _("f
d16 14
a29 4
 #include "gegl-chant.h"
 #include <errno.h>
-#include <ffmpeg/avformat.h>
+#include <libavformat/avformat.h>
d31 21
a51 2
 typedef struct
 {
@


1.3
log
@- gegl 0.0.20
@
text
@d1 1
a1 1
$OpenBSD: patch-operations_external_ff-load_c,v 1.2 2008/10/03 10:13:48 ajacoutot Exp $
@


1.2
log
@- update babl to version 0.0.22

from Giovanni Bechis
@
text
@d1 4
a4 4
$OpenBSD$
--- operations/external/ff-load.c.orig	Fri Oct  3 11:22:59 2008
+++ operations/external/ff-load.c	Fri Oct  3 11:23:11 2008
@@@@ -27,7 +27,7 @@@@ gegl_chant_int (frame, "Frame", 0, 1000000, 0, "frame 
@


1.1
log
@
* FFmpeg headers moved
* FFmpeg LIB_DEPENDS/WANTLIB changes
* add @@bin markers in PLISTs
* bump PKGNAMEs

feedback/ok brad@@
@
text
@d2 2
a3 2
--- operations/external/ff-load.c.orig	Sat Jun 21 15:16:10 2008
+++ operations/external/ff-load.c	Sat Jun 21 15:16:23 2008
@

