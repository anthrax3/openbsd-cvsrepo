head	1.3;
access;
symbols
	OPENBSD_5_8:1.2.0.4
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.1.0.6
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.4
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.2
	OPENBSD_5_5_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2015.08.30.16.06.34;	author avsm;	state dead;
branches;
next	1.2;
commitid	IFFgnDYFn7rZn9i1;

1.2
date	2015.03.28.17.59.17;	author sthen;	state Exp;
branches;
next	1.1;
commitid	Xm4OXwpeb6E6High;

1.1
date	2013.09.25.07.58.41;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to ocaml-camlimages-4.2.1

ok jca@@, tested by krw@@ daniel@@ jsg@@
@
text
@$OpenBSD: patch-src_gifread_c,v 1.2 2015/03/28 17:59:17 sthen Exp $

giflib 5.0+

--- src/gifread.c.orig	Wed Jun 22 19:04:32 2011
+++ src/gifread.c	Sat Mar 28 17:52:02 2015
@@@@ -140,7 +140,7 @@@@ value dGifOpenFileName( value name )
   GifFileType *GifFile;
   int i;
 
-  if((GifFile = DGifOpenFileName( String_val(name) )) == NULL){
+  if((GifFile = DGifOpenFileName( String_val(name), NULL )) == NULL){
     failwith("DGifOpenFileName");
   }
 
@@@@ -161,7 +161,7 @@@@ value dGifCloseFile( value hdl )
      segmentation faults */
   ((GifFileType *)hdl)->Image.ColorMap = NULL; 
 
-  DGifCloseFile( (GifFileType *) hdl );
+  DGifCloseFile( (GifFileType *) hdl, NULL );
   CAMLreturn(Val_unit);
 }
 
@@@@ -200,7 +200,7 @@@@ value dGifGetLine( value hdl )
 
   if( DGifGetLine(GifFile, String_val(buf), GifFile->Image.Width ) 
       == GIF_ERROR ){
-    PrintGifError ();
+    fprintf(stderr, "GIF-LIB error: %s\n", GifErrorString(GifFile->Error));
     failwith("DGifGetLine");
   }
   CAMLreturn(buf);
@


1.2
log
@handle giflib api change
@
text
@d1 1
a1 1
$OpenBSD: patch-src_gifread_c,v 1.1 2013/09/25 07:58:41 sthen Exp $
@


1.1
log
@libungif->giflib and patch where necessary, ok jasper@@ aja@@
@
text
@d1 1
a1 1
$OpenBSD$
d5 2
a6 2
--- src/gifread.c.orig	Thu Sep 19 16:51:12 2013
+++ src/gifread.c	Thu Sep 19 16:53:32 2013
d15 9
@

