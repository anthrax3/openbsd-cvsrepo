head	1.74;
access;
symbols
	OPENBSD_6_1:1.70.0.2
	OPENBSD_6_1_BASE:1.70
	OPENBSD_6_0:1.64.0.2
	OPENBSD_6_0_BASE:1.64
	OPENBSD_5_9:1.56.0.2
	OPENBSD_5_9_BASE:1.56
	OPENBSD_5_8:1.52.0.4
	OPENBSD_5_8_BASE:1.52
	OPENBSD_5_7:1.45.0.2
	OPENBSD_5_7_BASE:1.45
	OPENBSD_5_6:1.38.0.4
	OPENBSD_5_6_BASE:1.38
	OPENBSD_5_5:1.38.0.2
	OPENBSD_5_5_BASE:1.38
	OPENBSD_5_4:1.35.0.2
	OPENBSD_5_4_BASE:1.35
	OPENBSD_5_3:1.27.0.2
	OPENBSD_5_3_BASE:1.27
	OPENBSD_5_2:1.20.0.2
	OPENBSD_5_2_BASE:1.20
	OPENBSD_5_1_BASE:1.17
	OPENBSD_5_1:1.17.0.2
	OPENBSD_5_0:1.9.0.2
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_9:1.7.0.2
	OPENBSD_4_9_BASE:1.7
	sthen_20100917:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.74
date	2017.05.30.18.50.12;	author sthen;	state Exp;
branches;
next	1.73;
commitid	CN3t7lY49tKeDFis;

1.73
date	2017.05.22.18.25.41;	author espie;	state Exp;
branches;
next	1.72;
commitid	v1IxRzT6dn4qjHZq;

1.72
date	2017.04.21.12.18.30;	author sthen;	state Exp;
branches;
next	1.71;
commitid	vlBO06DENYElrrZ3;

1.71
date	2017.04.07.21.08.43;	author sthen;	state Exp;
branches;
next	1.70;
commitid	fWT8CkNcQrUMwmrP;

1.70
date	2017.02.02.13.55.58;	author sthen;	state Exp;
branches;
next	1.69;
commitid	sP7WZFMQYQSlHxUN;

1.69
date	2017.01.31.09.57.44;	author sthen;	state Exp;
branches;
next	1.68;
commitid	TcSMq4aykt6RauDD;

1.68
date	2017.01.02.18.13.57;	author sthen;	state Exp;
branches;
next	1.67;
commitid	5PDfoDe8WutWwO87;

1.67
date	2016.12.24.22.59.55;	author sthen;	state Exp;
branches;
next	1.66;
commitid	OfTZLaEo270R96aL;

1.66
date	2016.10.25.17.28.15;	author sthen;	state Exp;
branches;
next	1.65;
commitid	DrAHu8BW5wArmJ7V;

1.65
date	2016.10.18.09.40.25;	author sthen;	state Exp;
branches;
next	1.64;
commitid	lCCTg3FhnDygKljQ;

1.64
date	2016.07.09.11.49.05;	author sthen;	state Exp;
branches;
next	1.63;
commitid	iMA2bxzn5uIu7Ohi;

1.63
date	2016.06.24.13.56.57;	author sthen;	state Exp;
branches;
next	1.62;
commitid	5AUxnc7tvEDnryoG;

1.62
date	2016.05.06.21.47.59;	author sthen;	state Exp;
branches;
next	1.61;
commitid	TbSId0w8wIo5a4Sw;

1.61
date	2016.04.12.09.40.59;	author sthen;	state Exp;
branches;
next	1.60;
commitid	UJpyUtUIGAe6tfCY;

1.60
date	2016.03.29.14.55.18;	author sthen;	state Exp;
branches;
next	1.59;
commitid	B9HSKxfhDBYrqThc;

1.59
date	2016.03.18.23.12.17;	author naddy;	state Exp;
branches;
next	1.58;
commitid	KZAl4KEiw6a3Jixw;

1.58
date	2016.03.08.14.28.46;	author sthen;	state Exp;
branches;
next	1.57;
commitid	lQP0f419TLOTK68F;

1.57
date	2016.02.25.00.43.26;	author sthen;	state Exp;
branches;
next	1.56;
commitid	CRT8zH8UY2jqF43h;

1.56
date	2015.12.24.14.20.20;	author sthen;	state Exp;
branches;
next	1.55;
commitid	VMaSeHHX0wblPk54;

1.55
date	2015.10.21.11.06.35;	author sthen;	state Exp;
branches;
next	1.54;
commitid	jQDvYeJGvviyte6P;

1.54
date	2015.10.08.12.02.03;	author jasper;	state Exp;
branches;
next	1.53;
commitid	Fd81pQbB9Yvd8TB7;

1.53
date	2015.08.11.20.46.04;	author sthen;	state Exp;
branches;
next	1.52;
commitid	7XLt2tnvMzO3LFEo;

1.52
date	2015.06.10.22.27.28;	author sthen;	state Exp;
branches;
next	1.51;
commitid	pdBqtrI4NtowMmdB;

1.51
date	2015.06.09.20.54.38;	author sthen;	state Exp;
branches;
next	1.50;
commitid	7Q2Ee2ZMTYUEJdhO;

1.50
date	2015.06.02.15.31.15;	author kirby;	state Exp;
branches;
next	1.49;
commitid	sAcovgI2wJBkQ0tp;

1.49
date	2015.05.18.11.04.06;	author sthen;	state Exp;
branches;
next	1.48;
commitid	SS2cwwBno40VUMKG;

1.48
date	2015.05.18.10.44.57;	author sthen;	state Exp;
branches;
next	1.47;
commitid	bHjSvi5GilBzWLJX;

1.47
date	2015.05.15.13.43.40;	author sthen;	state Exp;
branches;
next	1.46;
commitid	6xKbSVFN3ZZElARU;

1.46
date	2015.03.27.08.11.28;	author ajacoutot;	state Exp;
branches;
next	1.45;
commitid	mHt3hIg3nxq5XDcy;

1.45
date	2015.02.16.22.57.08;	author naddy;	state Exp;
branches
	1.45.2.1;
next	1.44;
commitid	0dx3c9ckf7dE4tx1;

1.44
date	2014.11.27.13.25.00;	author dcoppa;	state Exp;
branches;
next	1.43;
commitid	Ps9c6kapyozHKek2;

1.43
date	2014.11.17.11.18.53;	author sthen;	state Exp;
branches;
next	1.42;
commitid	CbBDlXaNUtGwM9CY;

1.42
date	2014.11.12.12.34.07;	author sthen;	state Exp;
branches;
next	1.41;
commitid	hvcAYrFGASSzn30g;

1.41
date	2014.11.07.10.40.05;	author ajacoutot;	state Exp;
branches;
next	1.40;
commitid	QYJaNcIko4VHoTIl;

1.40
date	2014.11.05.09.26.50;	author dcoppa;	state Exp;
branches;
next	1.39;
commitid	kW3mrRUkpmfm9Hgo;

1.39
date	2014.10.03.20.45.10;	author sthen;	state Exp;
branches;
next	1.38;
commitid	iq4VRHEJd4omiDkZ;

1.38
date	2013.12.10.12.20.47;	author sthen;	state Exp;
branches;
next	1.37;

1.37
date	2013.10.26.08.02.57;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2013.09.12.22.26.03;	author sthen;	state Exp;
branches;
next	1.35;

1.35
date	2013.06.29.11.27.10;	author sthen;	state Exp;
branches;
next	1.34;

1.34
date	2013.06.26.11.22.25;	author sthen;	state Exp;
branches;
next	1.33;

1.33
date	2013.06.18.18.45.49;	author sthen;	state Exp;
branches;
next	1.32;

1.32
date	2013.06.04.18.41.47;	author naddy;	state Exp;
branches;
next	1.31;

1.31
date	2013.04.26.23.10.26;	author sthen;	state Exp;
branches;
next	1.30;

1.30
date	2013.03.21.08.45.18;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2013.03.09.11.20.32;	author sthen;	state Exp;
branches;
next	1.28;

1.28
date	2013.03.09.11.18.14;	author sthen;	state Exp;
branches;
next	1.27;

1.27
date	2013.01.30.01.39.26;	author brad;	state Exp;
branches
	1.27.2.1;
next	1.26;

1.26
date	2013.01.19.11.22.37;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2012.09.15.08.37.41;	author sthen;	state Exp;
branches;
next	1.24;

1.24
date	2012.09.14.09.56.17;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2012.09.14.09.50.18;	author sthen;	state Exp;
branches;
next	1.22;

1.22
date	2012.09.14.07.36.07;	author sthen;	state Exp;
branches;
next	1.21;

1.21
date	2012.08.21.16.29.48;	author sthen;	state Exp;
branches;
next	1.20;

1.20
date	2012.06.15.08.32.16;	author ajacoutot;	state Exp;
branches;
next	1.19;

1.19
date	2012.04.23.17.15.18;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2012.03.29.13.38.30;	author sthen;	state Exp;
branches;
next	1.17;

1.17
date	2011.12.22.15.20.10;	author sthen;	state Exp;
branches;
next	1.16;

1.16
date	2011.12.09.20.11.00;	author sthen;	state Exp;
branches;
next	1.15;

1.15
date	2011.12.03.20.30.09;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2011.11.01.20.30.49;	author jasper;	state Exp;
branches;
next	1.13;

1.13
date	2011.10.29.08.12.32;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2011.10.28.21.58.16;	author jasper;	state Exp;
branches;
next	1.11;

1.11
date	2011.10.03.06.42.45;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2011.09.16.10.02.36;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2011.06.02.17.09.31;	author kili;	state Exp;
branches;
next	1.8;

1.8
date	2011.04.16.00.15.37;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2011.01.31.23.20.23;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2010.11.17.08.05.13;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2010.10.24.21.21.00;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2010.10.18.18.13.13;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2010.10.11.08.14.42;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2010.10.01.11.45.08;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.09.17.21.37.18;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.09.17.21.37.18;	author sthen;	state Exp;
branches;
next	;

1.27.2.1
date	2013.06.19.06.55.50;	author jasper;	state Exp;
branches;
next	;

1.45.2.1
date	2015.06.05.04.24.28;	author kirby;	state Exp;
branches;
next	;
commitid	GMR9o22WypyisOsm;


desc
@@


1.74
log
@update to darktable-2.2.5
@
text
@# $OpenBSD: Makefile,v 1.73 2017/05/22 18:25:41 espie Exp $

ONLY_FOR_ARCHS=	i386 amd64

COMMENT=	virtual lighttable and darkroom for photographers

V=		2.2.5
DISTNAME=	darktable-$V
PORTROACH=	limitw:1,even
EXTRACT_SUFX=	.tar.xz

CATEGORIES=	graphics x11

HOMEPAGE=	http://www.darktable.org/

MAINTAINER=	Stuart Henderson <sthen@@openbsd.org>

# GPLv3+
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += GraphicsMagick ICE Iex IlmImf IlmThread Imath SM X11
WANTLIB += Xext Xrandr atk-1.0 c cairo cairo-gobject colord colord-gtk
WANTLIB += colordprivate cups curl exiv2 flickcurl gdk-3 gdk_pixbuf-2.0
WANTLIB += gio-2.0 glib-2.0 gmodule-2.0 gobject-2.0 gphoto2 gphoto2_port
WANTLIB += gthread-2.0 gtk-3 intl jpeg json-glib-1.0 lcms2 lensfun
WANTLIB += lua5.2 m openjp2 osmgpsmap-1.0 pango-1.0 pangocairo-1.0
WANTLIB += png pthread pugixml rsvg-2 secret-1 soup-2.4 sqlite3
WANTLIB += tiff webp xml2 z ${LIBECXX}

MASTER_SITES=	https://github.com/darktable-org/darktable/releases/download/release-$V/

MODULES=	devel/cmake \
		lang/lua \
		textproc/intltool
MODLUA_VERSION=	5.2
# TLS emulation
WANT_CXX =	base gcc

BUILD_DEPENDS=	sysutils/coreutils
RUN_DEPENDS=	devel/desktop-file-utils \
		x11/gtk+3,-guic
LIB_DEPENDS=	devel/gettext \
		devel/json-glib \
		devel/libsoup \
		geo/osm-gps-map \
		graphics/GraphicsMagick \
		graphics/colord-gtk \
		graphics/exiv2>=0.22 \
		graphics/lcms2 \
		graphics/libgphoto2>=2.5.0 \
		graphics/lensfun \
		graphics/openexr \
		graphics/openjp2 \
		net/curl \
		net/flickcurl \
		textproc/pugixml \
		x11/gnome/librsvg \
		x11/gnome/libsecret \
		x11/gtk+3

SEPARATE_BUILD=	Yes

CONFIGURE_ARGS=	-DBINARY_PACKAGE_BUILD=1 \
		-DCUSTOM_CFLAGS=1 \
		-DTESTBUILD_OPENCL_PROGRAMS=OFF
# OpenCL picks up LLVM at build time.

CPPFLAGS+=	-I${LOCALBASE}/include
LDFLAGS+=	-L${LOCALBASE}/lib
NO_TEST=	Yes

.include <bsd.port.arch.mk>
.if ${ARCH:Mi386}
# needs 64-bit atomic ops, and all the registers it can get.
CFLAGS += -march=i686 -fomit-frame-pointer
.endif
# ...and there's a hard requirement of SSE3
CFLAGS+=	-msse3
CXXFLAGS=	${CFLAGS}

post-install:
	cd ${PREFIX}/lib && ln -s darktable/libdarktable.so

.include <bsd.port.mk>
@


1.73
log
@WANT_CXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2017/04/21 12:18:30 sthen Exp $
d7 1
a7 1
V=		2.2.4
@


1.72
log
@move comment re TLS emulation down to MODGCC4_ARCHS line
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2017/04/07 21:08:43 sthen Exp $
d28 1
a28 1
WANTLIB += tiff webp xml2 z
a32 1
		gcc4 \
d36 2
a37 2
MODGCC4_ARCHS=	* # gcc4 required for TLS emulation
MODGCC4_LANGS=	c c++
@


1.71
log
@update to darktable-2.2.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2017/02/02 13:55:58 sthen Exp $
d37 1
a37 2
# gcc4 required for TLS emulation
MODGCC4_ARCHS=	*
@


1.70
log
@update to darktable-2.2.3.

Disable OpenCL tests as they cause clang to be picked up during configure,
causing problems if DPB junks it (found by naddy).

(darktable needs to be built with ports gcc for TLS emulation, otherwise
I'd just switch it to clang instead..)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2017/01/31 09:57:44 sthen Exp $
d7 1
a7 1
V=		2.2.3
@


1.69
log
@update to darktable-2.2.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2017/01/02 18:13:57 sthen Exp $
d7 1
a7 1
V=		2.2.2
d37 1
d66 3
a68 1
		-DCUSTOM_CFLAGS=1
@


1.68
log
@update to darktable-2.2.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2016/12/24 22:59:55 sthen Exp $
d7 1
a7 1
V=		2.2.1
@


1.67
log
@update to darktable 2.2.0, new feature update, for more information see
http://www.darktable.org/2016/12/darktable-2-2-0-released/

"when updating from the currently stable 2.0.x series, please bear in mind that
your edits will be preserved during this process, but it will not be possible
to downgrade from 2.2 to 2.0.x any more."
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2016/10/25 17:28:15 sthen Exp $
d7 1
a7 1
V=		2.2.0
@


1.66
log
@Update to darktable-2.0.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2016/10/18 09:40:25 sthen Exp $
d7 1
a7 1
V=		2.0.7
d21 8
a28 8
WANTLIB += GL GLU GraphicsMagick ICE Iex IlmImf IlmThread Imath
WANTLIB += SDL SM X11 Xext Xrandr atk-1.0 c cairo cairo-gobject
WANTLIB += colord colord-gtk colordprivate cups curl exiv2 flickcurl
WANTLIB += gdk-3 gdk_pixbuf-2.0 gio-2.0 glib-2.0 gmodule-2.0 gobject-2.0
WANTLIB += gphoto2 gphoto2_port gthread-2.0 gtk-3 intl jpeg
WANTLIB += json-glib-1.0 lcms2 lensfun lua5.2 m openjpeg osmgpsmap-1.0
WANTLIB += pango-1.0 pangocairo-1.0 png pthread pugixml rsvg-2 secret-1
WANTLIB += soup-2.4 sqlite3 tiff webp xml2 z
a45 1
		devel/sdl \
d54 1
a54 1
		graphics/openjpeg \
d64 1
a64 2
CONFIGURE_ARGS=	-DOPENJPEG_INCLUDE_DIR=${PREFIX}/include/openjpeg-1.5 \
		-DBINARY_PACKAGE_BUILD=1 \
@


1.65
log
@update to darktable-2.0.6 and switch to the version of the RawSpeed patch
that was committed upstream
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2016/07/09 11:49:05 sthen Exp $
d7 1
a7 1
V=		2.0.6
@


1.64
log
@update to darktable-2.0.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2016/06/24 13:56:57 sthen Exp $
d7 1
a7 1
V=		2.0.5
@


1.63
log
@Don't use std::string for a non-0-terminated string, fixing an out-of-bounds
read crash with DNG files. From Sven Gaerner.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2016/05/06 21:47:59 sthen Exp $
d7 1
a7 2
V=		2.0.4
REVISION=	0
d71 1
@


1.62
log
@update to darktable-2.0.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2016/04/12 09:40:59 sthen Exp $
d8 1
@


1.61
log
@fix darktable's memory detection on machines with >4GB RAM (HW_PHYSMEM64,
pull req 1193), reported by Jan Johansson.

while there, stop using devel/gettext MODULES.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2016/03/29 14:55:18 sthen Exp $
d7 1
a7 2
V=		2.0.3
REVISION=	0
@


1.60
log
@update to darktable-2.0.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2016/03/18 23:12:17 naddy Exp $
d8 1
d26 3
a28 3
WANTLIB += gphoto2 gphoto2_port gthread-2.0 gtk-3 jpeg json-glib-1.0
WANTLIB += lcms2 lensfun lua5.2 m openjpeg osmgpsmap-1.0 pango-1.0
WANTLIB += pangocairo-1.0 png pthread pugixml rsvg-2 secret-1
a33 1
		devel/gettext \
d44 2
a45 1
LIB_DEPENDS=	devel/json-glib \
@


1.59
log
@remove SHARED_ONLY from ports that only use modules that neither set nor
read this variable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2016/03/08 14:28:46 sthen Exp $
d7 1
a7 1
V=		2.0.2
@


1.58
log
@update to darktable-2.0.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2016/02/25 00:43:26 sthen Exp $
a10 2

SHARED_ONLY=	Yes
@


1.57
log
@update to darktable-2.0.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2015/12/24 14:20:20 sthen Exp $
d7 1
a7 1
V=		2.0.1
@


1.56
log
@update to Darktable 2.0.0, this is a major update and moves to Gtk+3.
Too many improvements to mention here; for more information, see
http://www.darktable.org/2015/12/darktable-2-0-released/

Note: when updating from 1.6.x series, edits will be preserved, but it
will not be possible to downgrade from 2.0 to 1.6.x any more.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2015/10/21 11:06:35 sthen Exp $
d7 1
a7 1
V=		2.0.0
@


1.55
log
@update to darktable 1.6.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2015/10/08 12:02:03 jasper Exp $
d7 1
a7 1
V=		1.6.9
d24 7
a30 8
WANTLIB += SDL SM X11 Xext Xrandr atk-1.0 c cairo colord colordprivate
WANTLIB += curl exiv2 flickcurl gdk-x11-2.0 gdk_pixbuf-2.0 gio-2.0
WANTLIB += glib-2.0 gmodule-2.0 gobject-2.0 gphoto2 gphoto2_port
WANTLIB += gthread-2.0 gtk-x11-2.0 jpeg json-glib-1.0 lcms2 lua5.2
WANTLIB += m openjpeg pango-1.0 pangocairo-1.0 png pthread rsvg-2
WANTLIB += secret-1 soup-2.4 sqlite3 tiff webp xml2 z

WANTLIB += lensfun # dlopen'd. this is "Extra" in check-lib-depends; that's ok,
a44 1
		x11/gtk-engines2 \
d49 1
d51 1
a51 1
		graphics/colord \
d60 1
d63 1
a63 1
		x11/gtk+2
a81 4

post-patch:
	@@sed -i 's,/usr/X11R6,${X11BASE},' \
	    ${WRKSRC}/src/external/colord-gtk/CMakeLists.txt
@


1.54
log
@sed -i
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2015/08/11 20:46:04 sthen Exp $
d7 1
a7 1
V=		1.6.8
d84 1
a84 1
	sed -i 's,/usr/X11R6,${X11BASE},' \
@


1.53
log
@update to darktable-1.6.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2015/06/10 22:27:28 sthen Exp $
d84 1
a84 1
	perl -pi -e 's,/usr/X11R6,${X11BASE},' \
@


1.52
log
@darktable build failed if colord was present, as reported by nigel@@;
fix and add as a dependency
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2015/06/09 20:54:38 sthen Exp $
d7 1
a7 2
V=		1.6.7
REVISION=	0
@


1.51
log
@update to darktable-1.6.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2015/06/02 15:31:15 kirby Exp $
d8 1
d25 6
a30 6
WANTLIB += SDL SM X11 Xext Xrandr atk-1.0 c cairo curl exiv2 flickcurl
WANTLIB += gdk-x11-2.0 gdk_pixbuf-2.0 gio-2.0 glib-2.0 gmodule-2.0
WANTLIB += gobject-2.0 gphoto2 gphoto2_port gthread-2.0 gtk-x11-2.0
WANTLIB += jpeg json-glib-1.0 lcms2 lua5.2 m openjpeg pango-1.0
WANTLIB += pangocairo-1.0 png pthread rsvg-2 secret-1 soup-2.4
WANTLIB += sqlite3 tiff webp xml2 z
d53 1
d83 4
@


1.50
log
@fix CVE-2015-3885 for embedded dcraw.
ok jasper@@ and sthen@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2015/05/18 11:04:06 sthen Exp $
a2 1
# requires SSE
a4 6
.include <bsd.port.arch.mk>
.if ${ARCH:Mi386}
# needs 64-bit atomic ops, and all the registers it can get.
CFLAGS += -march=i586 -fomit-frame-pointer
.endif

d7 2
a8 2
PORTROACH_COMMENT= newer versions require TLS
DISTNAME=	darktable-1.2.3
a10 1
REVISION=	6
d16 1
a16 1
HOMEPAGE=	http://darktable.sourceforge.net/
d23 7
a29 6
WANTLIB += GL GLU GraphicsMagick Iex IlmImf IlmThread Imath SDL
WANTLIB += atk-1.0 c cairo curl exiv2 flickcurl freetype gdk-x11-2.0
WANTLIB += gdk_pixbuf-2.0 gio-2.0 glib-2.0 gmodule-2.0 gnome-keyring
WANTLIB += gobject-2.0 gphoto2 gthread-2.0 gtk-x11-2.0 jpeg lcms2
WANTLIB += m openjpeg pango-1.0 pangocairo-1.0 png pthread rsvg-2
WANTLIB += sqlite3 stdc++ tiff xml2 z gphoto2_port soup-2.4 json-glib-1.0
d33 1
a33 1
MASTER_SITES=	${MASTER_SITE_SOURCEFORGE:=darktable/}
d37 2
d40 3
a59 1
		x11/gnome/libgnome-keyring \
d61 1
d70 2
a71 5
# enable workaround for mutex problems
CFLAGS+=	-D_DEBUG

# error: #error "SSE instruction set not enabled"
CFLAGS+=	-msse2
d73 7
a80 3

CPPFLAGS+=	-I${LOCALBASE}/include
LDFLAGS+=	-L${LOCALBASE}/lib
@


1.49
log
@more CXXFLAGS needed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2015/05/18 10:44:57 sthen Exp $
d18 1
a18 1
REVISION=	5
d31 1
a31 2
WANTLIB += GraphicsMagick
WANTLIB += GL GLU ICE Iex IlmImf IlmThread Imath SDL SM X11 Xext
@


1.48
log
@CFLAGS -> CXXFLAGS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2015/05/15 13:43:40 sthen Exp $
a9 1
CXXFLAGS += -march=i586 -fomit-frame-pointer
d78 2
@


1.47
log
@sprinkle some PORTROACH_COMMENTs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2015/03/27 08:11:28 ajacoutot Exp $
d10 1
@


1.46
log
@x11/gtk+2,-guic -> x11/gtk+3,-guic && bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2015/02/16 22:57:08 naddy Exp $
d14 1
a14 1
# N.B. newer versions require TLS
@


1.45
log
@Drop USE_GROFF from ports where the formatting differences are acceptable
or mandoc provides the more useful output.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2014/11/27 13:25:00 dcoppa Exp $
d18 1
a18 1
REVISION=	4
d50 1
a50 1
		x11/gtk+2,-guic
@


1.45.2.1
log
@fix CVE-2015-3885 for embedded dcraw.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2015/02/16 22:57:08 naddy Exp $
d18 1
a18 1
REVISION=	5
@


1.44
log
@
Readd '-DCUSTOM_CFLAGS=1', but also add '-msse2' to unbreak the
build on i386

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2014/11/17 11:18:53 sthen Exp $
a67 1
USE_GROFF=	Yes
@


1.43
log
@tell portroach to skip devel versions.
we are still behind though, newer versions need TLS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2014/11/12 12:34:07 sthen Exp $
d18 1
a18 1
REVISION=	3
d71 2
a72 1
		-DBINARY_PACKAGE_BUILD=1
d76 3
@


1.42
log
@reinstate compiler flags to unbreak i386
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2014/11/07 10:40:05 ajacoutot Exp $
d16 1
@


1.41
log
@No need for default CMAKE_BUILD_TYPE.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2014/11/05 09:26:50 dcoppa Exp $
d17 1
a17 1
REVISION=	2
d70 1
a70 2
		-DBINARY_PACKAGE_BUILD=1 \
		-DCUSTOM_CFLAGS=1
@


1.40
log
@
Drop gratuitous optimizations
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2014/10/03 20:45:10 sthen Exp $
d69 1
a69 2
CONFIGURE_ARGS=	-DCMAKE_BUILD_TYPE=Release \
		-DOPENJPEG_INCLUDE_DIR=${PREFIX}/include/openjpeg-1.5 \
@


1.39
log
@add a comment pointing out that newer versions need tls (to save time for any
users who see that this is outdated in portroach and try to update it ;)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2013/12/10 12:20:47 sthen Exp $
d17 1
a17 1
REVISION=	1
a68 1
CONFIGURE_STYLE= cmake
d71 2
a72 1
		-DBINARY_PACKAGE_BUILD=1
@


1.38
log
@search for headers in LOCALBASE/include/openjpeg-1.5; OpenJPEG v1.5.1+ no
longer provide LOCALBASE/include/openjpeg.h
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2013/10/26 08:02:57 ajacoutot Exp $
d13 2
@


1.37
log
@Fix dependencies and bump after the recent libsoup -gnome => -main merge.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2013/09/12 22:26:03 sthen Exp $
d15 1
a15 1
REVISION=	0
d69 1
@


1.36
log
@update to darktable 1.2.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2013/06/29 11:27:10 sthen Exp $
d15 1
@


1.35
log
@fix build on i386, and remove -D_DEBUG from CFLAGS which was an accidental
leftover from debugging (still available by building with FLAVOR=debug).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2013/06/26 11:22:25 sthen Exp $
d13 1
a13 2
DISTNAME=	darktable-1.2.2
REVISION=	0
d70 1
a70 4
FLAVORS=	debug
FLAVOR?=

.if ${FLAVOR:Mdebug}
a71 1
.endif
@


1.34
log
@update to darktable 1.2.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2013/06/18 18:45:49 sthen Exp $
d6 6
d14 1
d70 7
a76 1
CFLAGS+= -D_DEBUG
@


1.33
log
@update to darktable 1.2.1 and add a patch for CVE-2013-2126 in an embedded
copy of libraw; pointed out by Pascal de Bruijn (upstream), thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2013/06/04 18:41:47 naddy Exp $
d7 1
a7 1
DISTNAME=	darktable-1.2.1
@


1.32
log
@the png headers are now directly under include/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2013/04/26 23:10:26 sthen Exp $
d7 1
a7 1
DISTNAME=	darktable-1.2
@


1.31
log
@update to darktable-1.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2013/03/21 08:45:18 ajacoutot Exp $
d65 1
a65 1
CPPFLAGS+=	-I${LOCALBASE}/include/libpng
@


1.30
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.29 2013/03/09 11:20:32 sthen Exp $

BROKEN= unlocks an unlocked mutex (rthread_sync.c 1.34)
d7 2
a8 1
DISTNAME=	darktable-1.1.3
d21 1
d26 2
a27 2
WANTLIB += m pango-1.0 pangocairo-1.0 png pthread rsvg-2 sqlite3
WANTLIB += stdc++ tiff xml2 z gphoto2_port soup-2.4 json-glib-1.0
d44 1
d50 1
d62 1
a62 3
		-DBINARY_PACKAGE_BUILD=Yes \
		-DCUSTOM_CFLAGS=Yes \
		-DMAN_INSTALL_DIR="./man/man1"
@


1.29
log
@new PERMIT stuff.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2013/03/09 11:18:14 sthen Exp $
a55 1
USE_LIBTOOL=	Yes
@


1.28
log
@update darktable to 1.13 but mark it BROKEN for now as it frequently
triggers the strict mutex_unlock checks from rthread_sync 1.34, causing it
to abort.

rolls in some patches applied upstream thanks to Pascal de Bruijn.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2013/01/30 01:39:26 brad Exp $
a20 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.27
log
@Stop using the dprintf() wrapper function now that OpenBSD has dprintf()
within libc.

ok sthen@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.26 2013/01/19 11:22:37 ajacoutot Exp $
d9 1
a9 2
DISTNAME=	darktable-1.0.5
REVISION=	3
d30 1
a30 1
WANTLIB += stdc++ tiff xml2 z gphoto2_port
d42 1
d44 3
a46 1
LIB_DEPENDS=	devel/sdl \
d64 2
d67 1
@


1.27.2.1
log
@Security fix for CVE-2013-2126: incorrect error handling with broken full
colour images could result in a crash or possibly code execution.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2013/01/30 01:39:26 brad Exp $
d8 1
a8 1
REVISION=	4
@


1.26
log
@Cope with recent gphoto2 update.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/09/15 08:37:41 sthen Exp $
d8 1
a8 1
REVISION=	2
@


1.25
log
@missing dep on coreutils for nl, and patch away a bash requirement.
build problem pointed out & fixes suggested by nigel@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/09/14 09:56:17 sthen Exp $
d8 1
a8 1
REVISION=	1
a35 1
		devel/gconf2 \
d45 1
a45 1
		graphics/libgphoto2 \
@


1.24
log
@missing wantlib and add a comment about lensfun so nobody mistakenly
removes it in a wantlib sync.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/09/14 09:50:18 sthen Exp $
d8 1
a8 1
REVISION=	0
d40 1
@


1.23
log
@update to darktable 1.0.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2012/09/14 07:36:07 sthen Exp $
d8 1
d29 3
a31 1
WANTLIB += stdc++ tiff xml2 z lensfun
@


1.22
log
@Add a WANTLIB on lensfun, so the LIB_DEPENDS=graphics/lensfun is actually used.
Problem reported by halex.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2012/08/21 16:29:48 sthen Exp $
d7 1
a7 2
DISTNAME=	darktable-0.9.3
REVISION=	3
d56 2
a57 1
CONFIGURE_ARGS=	-DCMAKE_BUILD_TYPE=Release
@


1.21
log
@unbreak, hits warning "Including <librsvg/rsvg-cairo.h> directly is deprecated" with -Werror.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2012/06/15 08:32:16 ajacoutot Exp $
d8 1
a8 1
REVISION =	2
d29 1
a29 1
WANTLIB += stdc++ tiff xml2 z
@


1.20
log
@gtk-update-icon-cache:
Don't redirect errors to /dev/null and don't return true(1)
unconditionally. Instead, don't check for the existence of index.theme.
This will allow us to catch errors that may be happening because of a
missing dependency in the chain.

Some hidden issues may appear, in which case please contact me.

discussed with and ok blind jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2012/04/23 17:15:18 espie Exp $
d8 1
a8 1
REVISION =	1
@


1.19
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2012/03/29 13:38:30 sthen Exp $
d8 1
a8 1
REVISION =	0
@


1.18
log
@Change SEPARATE_BUILD=(concurrent|simple) to Yes; bsd.port.mk doesn't
make a distinction between these.  ok aja@@ dcoppa@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/12/22 15:20:10 sthen Exp $
d8 1
d40 1
a40 2
LIB_DEPENDS=	databases/sqlite3 \
		devel/sdl \
@


1.17
log
@requires SSE; mark ONLY_FOR_ARCHS=amd64 i386
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/12/09 20:11:00 sthen Exp $
d52 1
a52 1
SEPARATE_BUILD=	simple
@


1.16
log
@slightly overdue update of darktable to 0.9.3 - lots of improvements
and fixes since the previous version in ports
@
text
@d1 4
a4 1
# $OpenBSD: Makefile,v 1.15 2011/12/03 20:30:09 ajacoutot Exp $
@


1.15
log
@Add a dependency on x11/gtk+2,-guic.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/11/01 20:30:49 jasper Exp $
d4 1
a4 3
DISTNAME=	darktable-0.6

REVISION=	9
d20 6
a25 10
WANTLIB += Half Iex IlmImf IlmThread Imath X11 Xau Xcomposite
WANTLIB += Xcursor Xdamage Xdmcp Xext Xfixes Xi Xinerama Xrandr Xrender
WANTLIB += atk-1.0 c cairo crypto curl dbus-1 dbus-glib-1
WANTLIB += exif exiv2 expat fontconfig freetype gcrypt gdk-x11-2.0
WANTLIB += gdk_pixbuf-2.0 gio-2.0 glade-2.0 glib-2.0 gmodule-2.0
WANTLIB += gnome-keyring gobject-2.0 gpg-error gphoto2 gphoto2_port
WANTLIB += gthread-2.0 gtk-x11-2.0 idn jpeg lcms ltdl m pango-1.0
WANTLIB += pangocairo-1.0 pangoft2-1.0 pcre pixman-1 png pthread-stubs
WANTLIB += pthread sqlite3 ssl stdc++ tiff usb xcb-render
WANTLIB += xcb xml2 z GL Xxf86vm drm xcb-shm ffi
d29 2
a30 1
MODULES=	devel/gconf2 \
a33 2
MODGCONF2_SCHEMAS_DIR= darktable

d37 1
a37 1
		devel/libglade2 \
d39 1
a39 1
		graphics/lcms \
d44 4
a47 1
		x11/gnome/libgnome-keyring
d51 4
a54 8
USE_GROFF =	Yes
# make works for most things, except intltool.m4's .schemas rule
USE_GMAKE=	Yes

CONFIGURE_STYLE= gnu
CONFIGURE_ARGS+= --disable-gegl \
		--localedir=${TRUEPREFIX}/share/locale
CONFIGURE_ENV=	LDFLAGS="${LDFLAGS}"
d56 1
d59 2
a60 9
# add trailing linefeeds
LF+= control/jobs/camera.h control/jobs/camera_jobs.c control/jobs/camera_jobs.h
LF+= control/jobs/control.h control/jobs/control_jobs.h control/jobs/develop.h
LF+= control/jobs/film.h control/jobs/image_jobs.c control/jobs/film_jobs.h
LF+= gui/iop_history.h control/jobs/develop_jobs.h
pre-patch:
.for i in ${LF}
	echo >> ${WRKSRC}/src/$i
.endfor
@


1.14
log
@- regen WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/10/29 08:12:32 ajacoutot Exp $
d6 1
a6 1
REVISION=	8
d41 2
a42 1
RUN_DEPENDS=	devel/desktop-file-utils
@


1.13
log
@Sync dependencies after gconf2 lost its dependency to ORBit.
This should cover all fallout but there may be some dark corners which I
missed...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/10/28 21:58:16 jasper Exp $
d6 1
a6 1
REVISION=	7
d31 1
a31 1
WANTLIB += xcb xml2 z GL Xxf86vm drm xcb-shm
@


1.12
log
@- unbreak after exiv2 update
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/10/03 06:42:45 ajacoutot Exp $
d6 1
a6 1
REVISION=	6
d22 1
a22 1
WANTLIB += Half Iex IlmImf IlmThread Imath ORBit-2 X11 Xau Xcomposite
@


1.11
log
@Set DATADIRNAME in a consistent way now that glib-gettext.m4 has been
fixed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/09/16 10:02:36 espie Exp $
d6 1
a6 1
REVISION=	5
d44 1
a44 1
		graphics/exiv2 \
@


1.10
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/06/02 17:09:31 kili Exp $
d6 1
a6 1
REVISION=	4
@


1.9
log
@--disable-silent-rules is now added to CONFIGURE_ARGS per default,
if CONFIGURE_STYLE = gnu.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2011/04/16 00:15:37 sthen Exp $
d6 1
a6 1
REVISION=	3
@


1.8
log
@- remove casts now that NULL is a void *
- sync WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2011/01/31 23:20:23 sthen Exp $
a59 1
		--disable-silent-rules \
@


1.7
log
@Don't try and unconditionally use asm instructions to read the TSC
for performance-debugging printf()s. (post-unlock, updating darktable
to a newer version should fix this in a better way).

Build failure on macppc reported by ajacoutot@@ (though it affects
other arch too). ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/11/17 08:05:13 espie Exp $
d6 1
a6 1
REVISION=	2
d30 2
a31 2
WANTLIB += pthread sqlite3 ssl stdc++ tiff usb xcb-render-util xcb-render
WANTLIB += xcb xml2 z
@


1.6
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/10/24 21:21:00 ajacoutot Exp $
d6 1
a6 1
REVISION=	1
@


1.5
log
@Remove USE_X11.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/10/18 18:13:13 espie Exp $
d41 10
a50 10
RUN_DEPENDS=	::devel/desktop-file-utils
LIB_DEPENDS=	::databases/sqlite3 \
		::devel/libglade2 \
		::graphics/exiv2 \
		::graphics/lcms \
		::graphics/libgphoto2 \
		::graphics/lensfun \
		::graphics/openexr \
		::net/curl \
		::x11/gnome/libgnome-keyring
@


1.4
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/10/11 08:14:42 jasper Exp $
a52 1
USE_X11=	Yes
@


1.3
log
@- fix WANTLIB after cairo update.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/10/01 11:45:08 ajacoutot Exp $
d55 1
@


1.2
log
@Unbreak by fixing WANTLIB.
Tweak schema file while here.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/09/17 21:37:18 sthen Exp $
d6 1
a6 1
REVISION=	0
d26 1
a26 1
WANTLIB += gdk_pixbuf-2.0 gio-2.0 glade-2.0 glib-2.0 glitz gmodule-2.0
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.template,v 1.54 2008/01/13 16:43:57 espie Exp $
d6 2
d24 1
a24 1
WANTLIB += atk-1.0 c cairo crypto curl dbus-1 dbus-glib-1 eggdbus-1
d31 1
a31 1
WANTLIB += xcb xml2 z lensfun
@


1.1.1.1
log
@import ports/graphics/darktable, thanks ajacoutot@@ for review+fixes.

darktable is a virtual lighttable and darkroom for photographers:
it manages your digital negatives in a database and lets you view
them through a zoomable lighttable. It also enables you to develop
raw images and enhance them. It tries to fill the gap between the
many excellent existing free raw converters and image management
tools (such as ufraw or f-spot).

All editing is fully non-destructive and only operates on cached
image buffers for display. The full image is only converted during
export. Raw files, high-dynamic range and standard image formats
such as jpeg are all supported. The core operates completely on
floating point values, so darktable can not only be used for
photography but also for scientifically acquired images or output
of renderers (high dynamic range).
@
text
@@
