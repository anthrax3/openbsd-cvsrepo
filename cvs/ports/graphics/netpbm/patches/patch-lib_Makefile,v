head	1.6;
access;
symbols
	OPENBSD_6_1:1.6.0.2
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.5.0.2
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.4.0.22
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.24
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.20
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.18
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.4.0.16
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.4.0.14
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.4.0.12
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.4.0.10
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.4
	OPENBSD_5_1:1.4.0.8
	OPENBSD_5_0:1.4.0.6
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.4
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.2
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.3.0.8
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.6
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.4
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.2
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.2.0.4
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.2
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.1.0.4
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.2
	OPENBSD_4_0_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2016.08.31.22.12.43;	author naddy;	state Exp;
branches;
next	1.5;
commitid	xA1NzX6xEoxzPitd;

1.5
date	2016.04.26.17.59.51;	author naddy;	state Exp;
branches;
next	1.4;
commitid	1x7q1N65e6q2cZf5;

1.4
date	2010.07.02.02.54.59;	author naddy;	state Exp;
branches;
next	1.3;

1.3
date	2008.04.22.19.20.59;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2007.05.09.15.47.57;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2006.06.11.18.22.06;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.6
log
@update to 10.75.01
@
text
@$OpenBSD: patch-lib_Makefile,v 1.5 2016/04/26 17:59:51 naddy Exp $
--- lib/Makefile.orig	Sun Jun 26 19:15:09 2016
+++ lib/Makefile	Wed Aug 31 16:32:56 2016
@@@@ -52,6 +52,9 @@@@ LIBOBJECTS_X = \
   util/token.o \
   util/vasprintf.o \
 
+SHLIBOBJECTS = $(patsubst %.o, %.lo, $(LIBOBJECTS))
+SHLIBOBJECTS_X = $(patsubst %.o, %.lo, $(LIBOBJECTS_X))
+
 MANUALS3 = libnetpbm
 MANUALS5 = pbm pgm ppm pnm pam
 
@@@@ -88,13 +91,16 @@@@ extra_staticlib: $(EXTRA_STATICLIB)
 # type, but request a static library in addition.
 #----------------------------------------------------------------------------
 
-$(LIBOBJECTS): CFLAGS_TARGET=$(CFLAGS_SHLIB)
+$(SHLIBOBJECTS): CFLAGS_TARGET=$(CFLAGS_SHLIB)
 
 libpbm3.o: CFLAGS_TARGET+=$(CFLAGS_SSE)
 
 $(LIBOBJECTS): %.o: %.c importinc
 	$(CC) -c $(INCLUDES) $(CFLAGS_ALL) -o $@@ $<
 
+$(SHLIBOBJECTS): %.lo: %.c importinc
+	$(CC) -c $(INCLUDES) $(CFLAGS_ALL) -o $@@ $<
+
 MAJ = 11
 MIN = $(NETPBM_MINOR_RELEASE)
 
@@@@ -119,7 +125,7 @@@@ endif
 
 ifeq ($(NETPBMLIBTYPE),unixshared)
 # The libxxx.so link is needed to link the executables.
-libnetpbm.$(NETPBMLIBSUFFIX): $(SONAME)
+libnetpbm.$(NETPBMLIBSUFFIX): libnetpbm.$(NETPBMLIBSUFFIX).$(LIBnetpbm_VERSION)
 	rm -f $@@
 	$(SYMLINK) $< $@@
 # The $(SONAME) link is needed only to test the programs without
@@@@ -128,8 +134,8 @@@@ libnetpbm.$(NETPBMLIBSUFFIX): $(SONAME)
 $(SONAME): libnetpbm.$(NETPBMLIBSUFFIX).$(MAJ).$(MIN)
 	rm -f $@@
 	$(SYMLINK) $< $@@
-libnetpbm.$(NETPBMLIBSUFFIX).$(MAJ).$(MIN): $(LIBOBJECTS) $(LIBOBJECTS_X)
-	$(LD) $(LDSHLIB) -o $@@ $(LIBOBJECTS) $(LIBOBJECTS_X) \
+libnetpbm.$(NETPBMLIBSUFFIX).$(LIBnetpbm_VERSION): $(SHLIBOBJECTS) $(SHLIBOBJECTS_X)
+	$(LD) $(LDSHLIB) -o $@@ $(SHLIBOBJECTS) $(SHLIBOBJECTS_X) \
           $(SHLIB_CLIB) -lm $(LADD)
 endif
 
@@@@ -205,25 +211,21 @@@@ standardppmdfont.c: standard.ppmdfont
 compile.h:
 	$(SRCDIR)/buildtools/stamp-date >$@@ || rm $@@
 
-$(LIBOBJECTS_X): FORCE
+$(LIBOBJECTS_X) $(SHLIBOBJECTS_X): FORCE
 	@@if [ ! -d $(dir $@@) ] ; then mkdir $(dir $@@) ; fi
 	$(MAKE) -C $(dir $@@) -f $(SRCDIR)/$(SUBDIR)/$(dir $@@)Makefile \
 		SRCDIR=$(SRCDIR) BUILDDIR=$(BUILDDIR) $(notdir $@@) 
 
-libpm.o: compile.h
+libpm.o libpm.lo: compile.h
 
 # Install a shared library
 #
 .PHONY: install.lib
 ifeq ($(NETPBMLIBTYPE),unixshared)
 # install a Unix-style shared library
-install.lib: $(PKGDIR)/lib $(PKGDIR)/link
-	cd $(PKGDIR)/lib ; rm -f libnetpbm.$(NETPBMLIBSUFFIX).$(MAJ).*
+install.lib: $(PKGDIR)/lib
 	$(INSTALL) -c -m $(INSTALL_PERM_LIBD) \
-	  libnetpbm.$(NETPBMLIBSUFFIX).$(MAJ).$(MIN)  $(PKGDIR)/lib/
-	cd $(PKGDIR)/lib/ ; \
-          rm -f libnetpbm.$(NETPBMLIBSUFFIX).$(MAJ); \
-          $(SYMLINK) libnetpbm.$(NETPBMLIBSUFFIX).$(MAJ).$(MIN) $(SONAME)
+	  libnetpbm.$(NETPBMLIBSUFFIX).$(LIBnetpbm_VERSION)  $(PKGDIR)/lib/
 endif
 ifeq ($(NETPBMLIBTYPE),dll)
 #install a Windows DLL shared library
@@@@ -259,9 +261,9 @@@@ $(INTERFACE_HEADERS:%=%_installhdr): $(PKGDIR)/include
 	  $(SRCDIR)/lib/$(@@:%_installhdr=%) $(PKGDIR)/include/netpbm/
 
 .PHONY: install.staticlib
-install.staticlib: $(PKGDIR)/link
+install.staticlib: $(PKGDIR)/lib
 	$(INSTALL) -c -m $(INSTALL_PERM_LIBS) libnetpbm.$(STATICLIBSUFFIX) \
-	  $(PKGDIR)/link
+	  $(PKGDIR)/lib
 
 # Install a shared library stub -- the ".so" file used at link time to
 # prepare a program for dynamically linking a library at run time 
@


1.5
log
@Big, big update to 10.74.02.  Years worth of changes.  The port now
follows the "advanced" release series and we will have to create our
own distfiles accordingly.

Use srand_deterministic() to fix programs that can take a seed value
on the command line.

ok jca@@
@
text
@d1 4
a4 4
$OpenBSD: patch-lib_Makefile,v 1.4 2010/07/02 02:54:59 naddy Exp $
--- lib/Makefile.orig	Sat Sep 26 21:59:25 2015
+++ lib/Makefile	Mon Apr 25 19:43:02 2016
@@@@ -51,6 +51,9 @@@@ LIBOBJECTS_X = \
d14 1
a14 1
@@@@ -87,13 +90,16 @@@@ extra_staticlib: $(EXTRA_STATICLIB)
d32 1
a32 1
@@@@ -118,7 +124,7 @@@@ endif
d41 1
a41 1
@@@@ -127,8 +133,8 @@@@ libnetpbm.$(NETPBMLIBSUFFIX): $(SONAME)
d52 1
a52 1
@@@@ -204,25 +210,21 @@@@ standardppmdfont.c: standard.ppmdfont
d82 1
a82 1
@@@@ -258,9 +260,9 @@@@ $(INTERFACE_HEADERS:%=%_installhdr): $(PKGDIR)/include
@


1.4
log
@Update to 10.35.75.  This jumps to the latest "super stable" branch
and adds pamx, a minimal X11 viewer for files in the various netpbm
formats.
@
text
@d1 6
a6 6
$OpenBSD$
--- lib/Makefile.orig	Wed Jun 30 02:15:15 2010
+++ lib/Makefile	Wed Jun 30 02:22:04 2010
@@@@ -42,6 +42,9 @@@@ endif
 # Library objects to be linked but not built by Makefile.common:
 LIBOBJECTS_X = util/shhopt.o util/nstring.o util/filename.o
d14 8
a21 1
@@@@ -80,6 +83,10 @@@@ extra_staticlib: $(EXTRA_STATICLIB)
d24 4
a27 3
 # Note that the user may have configured -I options into CFLAGS.
+	$(CC) -c $(INCLUDES) -DNDEBUG $(CFLAGS) \
+	  $(CFLAGS_PERSONAL) $(CADD) -o $@@ $<
d29 2
a30 3
+$(SHLIBOBJECTS): %.lo: %.c importinc
 	$(CC) -c $(INCLUDES) -DNDEBUG $(CFLAGS) $(CFLAGS_SHLIB) \
 	  $(CFLAGS_PERSONAL) $(CADD) -o $@@ $<
d32 1
a32 1
@@@@ -107,7 +114,7 @@@@ endif
d41 1
a41 1
@@@@ -116,9 +123,9 @@@@ libnetpbm.$(NETPBMLIBSUFFIX): $(SONAME)
a46 1
-          $(SHLIB_CLIB) -lm $(LADD)
d49 1
a49 1
+	  $(SHLIB_CLIB) $(LADD)
d52 1
a52 2
 ifeq ($(NETPBMLIBTYPE),dll)
@@@@ -193,7 +200,7 @@@@ standardppmdfont.c:standard.ppmdfont
d61 6
a66 1
@@@@ -205,13 +212,9 @@@@ libpm.o: compile.h
d72 2
a73 1
-	$(INSTALL) -c -m $(INSTALL_PERM_LIBD) \
d78 1
a78 3
+install.lib: $(PKGDIR)/lib
+	$(BSD_INSTALL_DATA) \
+	  libnetpbm.$(NETPBMLIBSUFFIX).$(LIBnetpbm_VERSION) $(PKGDIR)/lib/
d82 2
a83 7
@@@@ -241,13 +244,13 @@@@ install.hdr: $(INTERFACE_HEADERS:%=%_installhdr)
 # directory when you compile your programs.
 
 %_installhdr: $(PKGDIR)/include
-	$(INSTALL) -c -m $(INSTALL_PERM_HDR) \
+	$(BSD_INSTALL_DATA) \
 	  $(SRCDIR)/lib/$(@@:%_installhdr=%) $(PKGDIR)/include/;
d87 2
a88 1
-	$(INSTALL) -c -m $(INSTALL_PERM_LIBS) libnetpbm.$(STATICLIBSUFFIX) \
a89 2
+install.staticlib: $(PKGDIR)/lib
+	$(BSD_INSTALL_DATA) libnetpbm.$(STATICLIBSUFFIX) \
@


1.3
log
@update to 10.26.53: miscellaneous bug fixes
@
text
@d1 4
a4 4
$OpenBSD: patch-lib_Makefile,v 1.2 2007/05/09 15:47:57 naddy Exp $
--- lib/Makefile.orig	Thu Dec 13 17:23:52 2007
+++ lib/Makefile	Tue Apr 22 21:15:55 2008
@@@@ -35,6 +35,9 @@@@ endif
d6 1
a6 1
 LIBOBJECTS_X = util/shhopt.o util/nstring.o
d14 1
a14 1
@@@@ -76,6 +79,10 @@@@ extra_staticlib: $(EXTRA_STATICLIB)
d16 1
a16 1
 $(LIBOBJECTS): %.o: %.c $(HEADERLINKS)
d21 1
a21 1
+$(SHLIBOBJECTS): %.lo: %.c $(HEADERLINKS)
d25 1
a25 1
@@@@ -101,7 +108,7 @@@@ endif
d34 1
a34 1
@@@@ -110,9 +117,9 @@@@ libnetpbm.$(NETPBMLIBSUFFIX): $(SONAME)
d43 1
a43 1
+          $(SHLIB_CLIB) $(LADD)
d47 1
a47 1
@@@@ -179,7 +186,7 @@@@ endif
d51 2
a52 2
-util/shhopt.o util/nstring.o: FORCE
+util/shhopt.o util/nstring.o util/shhopt.lo util/nstring.lo: FORCE
d56 1
a56 1
@@@@ -189,13 +196,9 @@@@ util/shhopt.o util/nstring.o: FORCE
d73 1
a73 1
@@@@ -225,13 +228,13 @@@@ install.hdr: $(INTERFACE_HEADERS:%=%_installhdr)
@


1.2
log
@Update to 10.26.42: fixes for ppmtogif, libnetpbm (PBM on amd64),
pamcomp, and pnmtopclxl.
@
text
@d1 3
a3 3
$OpenBSD: patch-lib_Makefile,v 1.1 2006/06/11 18:22:06 naddy Exp $
--- lib/Makefile.orig	Wed Dec  8 05:32:37 2004
+++ lib/Makefile	Wed May  9 16:32:31 2007
d34 1
a34 1
@@@@ -110,8 +117,8 @@@@ libnetpbm.$(NETPBMLIBSUFFIX): $(SONAME)
d40 1
d43 1
a43 1
           $(SHLIB_CLIB) $(LADD)
d46 1
@


1.1
log
@update to 10.26.28, more than four years worth of changes
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
+++ lib/Makefile	Wed May 31 01:14:05 2006
d71 1
a71 1
@@@@ -225,13 +228,13 @@@@ install.hdr: $(INTERFACE_HEADERS:%=%_ins
@

