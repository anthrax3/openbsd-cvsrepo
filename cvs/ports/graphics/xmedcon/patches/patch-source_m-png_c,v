head	1.4;
access;
symbols
	OPENBSD_6_2:1.4.0.4
	OPENBSD_6_2_BASE:1.4
	OPENBSD_6_1:1.4.0.2
	OPENBSD_6_1_BASE:1.4
	OPENBSD_6_0:1.3.0.10
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.6
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.8
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.4
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.2
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.2.0.4
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.2
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.1.0.8
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.6
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2016.09.02.22.13.45;	author jasper;	state Exp;
branches;
next	1.3;
commitid	AL54FCOU9jqCeNwR;

1.3
date	2014.05.01.13.43.13;	author benoit;	state Exp;
branches;
next	1.2;

1.2
date	2013.03.14.10.04.27;	author benoit;	state Exp;
branches;
next	1.1;

1.1
date	2011.07.08.20.38.01;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.4
log
@- update to xmedcon-0.14.1
- drop gettext module
@
text
@$OpenBSD: patch-source_m-png_c,v 1.3 2014/05/01 13:43:13 benoit Exp $
--- source/m-png.c.orig	Tue Dec 22 13:59:30 2015
+++ source/m-png.c	Fri Sep  2 23:09:24 2016
@@@@ -68,7 +68,7 @@@@ static void MdcPngErr(png_structp png_ptr, png_const_c
 
   if (!png_ptr) return; 
 
-  longjmp(png_jmpbuf(png_ptr), 1);
+  png_longjmp(png_ptr, 1);
 }
 
 static void MdcPngWarn(png_structp png_ptr, png_const_charp warning_msg)
@


1.3
log
@Remove myself as maintainer.
@
text
@d1 4
a4 4
$OpenBSD$
--- source/m-png.c.orig	Tue Dec 27 01:46:06 2011
+++ source/m-png.c	Fri Jan 18 09:39:09 2013
@@@@ -65,7 +65,7 @@@@
@


1.2
log
@- update xmedcon to 0.12.0
- bump SHARED_LIBS
- update WANTLIB and patches
- regen PLIST
- remove PFRAG.shared
@
text
@d1 1
@


1.1
log
@Fix build with png-1.5.
All fixes by yours truly.
@
text
@d1 3
a3 7
$OpenBSD$

Fix build with png-1.5.

--- source/m-png.c.orig	Tue Jul  5 17:14:51 2011
+++ source/m-png.c	Tue Jul  5 17:19:24 2011
@@@@ -65,7 +65,7 @@@@ static void MdcPngErr(png_structp png_ptr, png_const_c
d7 1
a7 1
-  longjmp(png_ptr->jmpbuf, 1);
a11 43
@@@@ -95,11 +95,12 @@@@ char *MdcReadPNG(FILEINFO *fi)
 {
   png_structp png_ptr;
   png_infop info_ptr;
+  png_textp text_ptr;
   png_uint_32 width, height, rowbytes;
   png_colorp palette;
   png_bytepp row_pointers;
   Uint32 i, commentsize;
-  int bit_depth, color_type, transform, num_palette;
+  int bit_depth, color_type, transform, num_palette, num_text;
   Uint8 *imgRGB, *pbuf;
   IMG_DATA *id;
 
@@@@ -161,21 +162,21 @@@@ char *MdcReadPNG(FILEINFO *fi)
   }
 
   /* get comment */
-  if(info_ptr->num_text > 0) {
+  if(png_get_text(png_ptr, info_ptr, &text_ptr, &num_text) > 0) {
     commentsize = 1;
 
-    for(i = 0; i < info_ptr->num_text; i++)
-      commentsize += strlen(info_ptr->text[i].key) + 1 +
-                     info_ptr->text[i].text_length + 2;
+    for(i = 0; i < num_text; i++)
+      commentsize += strlen(text_ptr[i].key) + 1 +
+                     text_ptr[i].text_length + 2;
     
     if ((fi->comment = malloc(commentsize)) == NULL) {
       MdcPngWarn(png_ptr,"PNG  Can't malloc comment string");
     }else{ 
       fi->comment[0] = '\0';
-      for (i = 0; i < info_ptr->num_text; i++) {
-        strcat(fi->comment, info_ptr->text[i].key);
+      for (i = 0; i < num_text; i++) {
+        strcat(fi->comment, text_ptr[i].key);
         strcat(fi->comment, "::");
-        strcat(fi->comment, info_ptr->text[i].text);
+        strcat(fi->comment, text_ptr[i].text);
         strcat(fi->comment, "\n");
       }
     }
@

