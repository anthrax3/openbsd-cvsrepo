head	1.55;
access;
symbols
	OPENBSD_6_1:1.55.0.2
	OPENBSD_6_1_BASE:1.55
	OPENBSD_6_0:1.53.0.4
	OPENBSD_6_0_BASE:1.53
	OPENBSD_5_9:1.53.0.2
	OPENBSD_5_9_BASE:1.53
	OPENBSD_5_8:1.49.0.4
	OPENBSD_5_8_BASE:1.49
	OPENBSD_5_7:1.43.0.2
	OPENBSD_5_7_BASE:1.43
	OPENBSD_5_6:1.39.0.2
	OPENBSD_5_6_BASE:1.39
	OPENBSD_5_5:1.38.0.2
	OPENBSD_5_5_BASE:1.38
	OPENBSD_5_4:1.36.0.2
	OPENBSD_5_4_BASE:1.36
	OPENBSD_5_3:1.34.0.2
	OPENBSD_5_3_BASE:1.34
	OPENBSD_5_2:1.29.0.2
	OPENBSD_5_2_BASE:1.29
	OPENBSD_5_1_BASE:1.28
	OPENBSD_5_1:1.28.0.2
	OPENBSD_5_0:1.26.0.2
	OPENBSD_5_0_BASE:1.26
	OPENBSD_4_9:1.24.0.2
	OPENBSD_4_9_BASE:1.24
	OPENBSD_4_8:1.23.0.2
	OPENBSD_4_8_BASE:1.23
	OPENBSD_4_7:1.21.0.6
	OPENBSD_4_7_BASE:1.21
	OPENBSD_4_6:1.21.0.4
	OPENBSD_4_6_BASE:1.21
	OPENBSD_4_5:1.21.0.2
	OPENBSD_4_5_BASE:1.21
	OPENBSD_4_4:1.19.0.2
	OPENBSD_4_4_BASE:1.19
	OPENBSD_4_3:1.18.0.2
	OPENBSD_4_3_BASE:1.18
	OPENBSD_4_2:1.15.0.2
	OPENBSD_4_2_BASE:1.15
	OPENBSD_4_0:1.13.0.2
	OPENBSD_4_0_BASE:1.13
	OPENBSD_3_9:1.12.0.4
	OPENBSD_3_9_BASE:1.12
	OPENBSD_3_8:1.12.0.2
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.10.0.2
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.6.0.2
	OPENBSD_3_6_BASE:1.6
	OPENBSD_3_5:1.5.0.2
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.3.0.2
	OPENBSD_3_4_BASE:1.3
	jolan_2003-jul-19:1.1.1.1
	jolan:1.1.1;
locks; strict;
comment	@# @;


1.55
date	2016.12.11.09.27.53;	author ajacoutot;	state Exp;
branches;
next	1.54;
commitid	QNqQnErJEjJ1VxNw;

1.54
date	2016.09.06.12.37.11;	author ajacoutot;	state Exp;
branches;
next	1.53;
commitid	z3rQhI117DvrHlZm;

1.53
date	2016.01.14.06.09.43;	author ajacoutot;	state Exp;
branches;
next	1.52;
commitid	1MTT7RUn5DsgY3tS;

1.52
date	2015.12.17.09.54.33;	author ajacoutot;	state Exp;
branches;
next	1.51;
commitid	ucBAGhJ9OHl5k2Y0;

1.51
date	2015.11.16.06.36.55;	author ajacoutot;	state Exp;
branches;
next	1.50;
commitid	QCUZ5eWQ2FAYYhVH;

1.50
date	2015.09.10.07.10.04;	author ajacoutot;	state Exp;
branches;
next	1.49;
commitid	BDuwSNknZHV1yp3r;

1.49
date	2015.07.26.07.22.15;	author ajacoutot;	state Exp;
branches;
next	1.48;
commitid	dkXFOkRDvjfRGOaD;

1.48
date	2015.06.29.06.19.32;	author ajacoutot;	state Exp;
branches;
next	1.47;
commitid	RGVFfcgCUKFMKOaq;

1.47
date	2015.06.10.06.34.45;	author ajacoutot;	state Exp;
branches;
next	1.46;
commitid	x24HO3ZekL9ai8k1;

1.46
date	2015.06.03.06.21.53;	author ajacoutot;	state Exp;
branches;
next	1.45;
commitid	6Gqi7dSagYHsQlyT;

1.45
date	2015.05.22.05.41.22;	author ajacoutot;	state Exp;
branches;
next	1.44;
commitid	PFps5C2KCif5oz97;

1.44
date	2015.04.28.06.32.47;	author ajacoutot;	state Exp;
branches;
next	1.43;
commitid	A9iBYMQ3XssEpdrF;

1.43
date	2015.01.10.10.46.37;	author brad;	state Exp;
branches;
next	1.42;
commitid	Jvhk3PM2BVrIPd5L;

1.42
date	2014.10.23.07.41.45;	author brad;	state Exp;
branches;
next	1.41;
commitid	3ZcbyNHYegRj327Y;

1.41
date	2014.10.19.23.14.23;	author brad;	state Exp;
branches;
next	1.40;
commitid	jAX6LQxB4XzyAjyo;

1.40
date	2014.08.14.08.20.27;	author brad;	state Exp;
branches;
next	1.39;
commitid	pSVHmwDct53IFfXl;

1.39
date	2014.05.16.01.34.50;	author brad;	state Exp;
branches;
next	1.38;

1.38
date	2013.12.24.15.22.55;	author brad;	state Exp;
branches;
next	1.37;

1.37
date	2013.08.19.14.38.29;	author brad;	state Exp;
branches;
next	1.36;

1.36
date	2013.04.08.17.06.56;	author brad;	state Exp;
branches;
next	1.35;

1.35
date	2013.03.13.02.26.45;	author brad;	state Exp;
branches;
next	1.34;

1.34
date	2013.01.25.09.46.22;	author brad;	state Exp;
branches;
next	1.33;

1.33
date	2013.01.14.02.14.41;	author brad;	state Exp;
branches;
next	1.32;

1.32
date	2013.01.08.10.13.13;	author brad;	state Exp;
branches;
next	1.31;

1.31
date	2012.09.12.08.15.57;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2012.09.04.06.31.08;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2012.04.28.08.41.32;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2011.12.30.17.34.39;	author edd;	state Exp;
branches;
next	1.27;

1.27
date	2011.09.04.09.22.43;	author sthen;	state Exp;
branches;
next	1.26;

1.26
date	2011.04.12.22.59.07;	author sthen;	state Exp;
branches;
next	1.25;

1.25
date	2011.03.29.20.01.43;	author edd;	state Exp;
branches;
next	1.24;

1.24
date	2010.09.03.16.39.13;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2010.05.26.21.38.52;	author jakemsr;	state Exp;
branches;
next	1.22;

1.22
date	2010.04.26.01.57.13;	author jakemsr;	state Exp;
branches;
next	1.21;

1.21
date	2008.09.08.23.28.28;	author brad;	state Exp;
branches;
next	1.20;

1.20
date	2008.09.05.01.10.21;	author brad;	state Exp;
branches;
next	1.19;

1.19
date	2008.07.09.01.57.44;	author jakemsr;	state Exp;
branches;
next	1.18;

1.18
date	2008.01.26.01.56.02;	author jakemsr;	state Exp;
branches;
next	1.17;

1.17
date	2007.10.19.14.32.57;	author jakemsr;	state Exp;
branches;
next	1.16;

1.16
date	2007.09.24.07.51.24;	author jakemsr;	state Exp;
branches;
next	1.15;

1.15
date	2007.05.25.15.54.14;	author jakemsr;	state Exp;
branches;
next	1.14;

1.14
date	2007.01.23.09.34.45;	author robert;	state dead;
branches;
next	1.13;

1.13
date	2006.03.20.05.50.49;	author jakemsr;	state Exp;
branches;
next	1.12;

1.12
date	2005.04.20.16.46.54;	author naddy;	state Exp;
branches;
next	1.11;

1.11
date	2005.04.11.14.58.00;	author naddy;	state Exp;
branches;
next	1.10;

1.10
date	2005.02.10.19.59.08;	author naddy;	state Exp;
branches;
next	1.9;

1.9
date	2005.02.09.23.41.42;	author naddy;	state Exp;
branches;
next	1.8;

1.8
date	2004.10.13.01.38.21;	author jolan;	state Exp;
branches;
next	1.7;

1.7
date	2004.10.07.06.12.11;	author jolan;	state Exp;
branches;
next	1.6;

1.6
date	2004.04.18.00.36.22;	author jolan;	state Exp;
branches;
next	1.5;

1.5
date	2003.11.04.07.50.19;	author jolan;	state Exp;
branches;
next	1.4;

1.4
date	2003.09.26.14.40.29;	author jolan;	state Exp;
branches;
next	1.3;

1.3
date	2003.08.15.14.25.08;	author jolan;	state Exp;
branches;
next	1.2;

1.2
date	2003.08.02.10.26.54;	author jolan;	state Exp;
branches;
next	1.1;

1.1
date	2003.07.19.18.16.34;	author jolan;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.07.19.18.16.34;	author jolan;	state Exp;
branches;
next	;


desc
@@


1.55
log
@Update to ffmpeg-20161210.

from Brad (maintainer)
@
text
@$OpenBSD: patch-configure,v 1.54 2016/09/06 12:37:11 ajacoutot Exp $

lavu/random_seed: use arc4random() when available

--- configure.orig	Sat Dec 10 20:37:25 2016
+++ configure	Sat Dec 10 20:43:59 2016
@@@@ -1755,6 +1755,7 @@@@ MATH_FUNCS="
 SYSTEM_FUNCS="
     access
     aligned_malloc
+    arc4random
     clock_gettime
     closesocket
     CommandLineToArgvW
@@@@ -4308,7 +4309,7 @@@@ case $target_os in
     openbsd|bitrig)
         disable symver
         SHFLAGS='-shared'
-        SLIB_INSTALL_NAME='$(SLIBNAME).$(LIBMAJOR).$(LIBMINOR)'
+        SLIB_INSTALL_NAME='$(SLIBNAME).$(LIBVERSION)'
         SLIB_INSTALL_LINKS=
         oss_indev_extralibs="-lossaudio"
         oss_outdev_extralibs="-lossaudio"
@@@@ -4672,7 +4673,7 @@@@ die_license_disabled version3 libvo_amrwbenc
 
 enabled version3 && { enabled gpl && enable gplv3 || enable lgplv3; }
 
-disabled optimizations || check_cflags -fomit-frame-pointer
+enabled x86_32 && check_cflags -fomit-frame-pointer
 
 enable_weak_pic() {
     disabled pic && return
@@@@ -5067,6 +5068,7 @@@@ check_func  ${malloc_prefix}memalign            && ena
 check_func  ${malloc_prefix}posix_memalign      && enable posix_memalign
 
 check_func  access
+check_func  arc4random
 check_func_headers time.h clock_gettime || { check_func_headers time.h clock_gettime -lrt && add_extralibs -lrt && LIBRT="-lrt"; }
 check_func  fcntl
 check_func  fork
@@@@ -5788,6 +5790,11 @@@@ if test $target_os = "haiku"; then
     disable posix_memalign
 fi
 
+
+if test $target_os = "openbsd"; then
+    enabled x86_32 && disable ebx_available
+fi
+
 enabled_all dxva2 dxva2api_cobj CoTaskMemFree &&
     prepend ffmpeg_libs $($ldflags_filter "-lole32" "-luser32") &&
     enable dxva2_lib
@@@@ -6220,8 +6227,8 @@@@ pkgconfig_generate(){
     comment=$2
     version=$3
     libs=$4
-    requires=$(map 'lib_version $v' $(eval echo \$${name#lib}_deps))
-    requires=${requires%, }
+    requires=$5
+    linkflags=$6
     enabled ${name#lib} || return 0
     mkdir -p $name
     cat <<EOF > $name/$name${build_suffix}.pc
@@@@ -6236,7 +6243,7 @@@@ Version: $version
 Requires: $(enabled shared || echo $requires)
 Requires.private: $(enabled shared && echo $requires)
 Conflicts:
-Libs: -L\${libdir} $(enabled rpath && echo "-Wl,-rpath,\${libdir}") -l${shortname} $(enabled shared || echo $libs)
+Libs: -L\${libdir} $(enabled rpath && echo "-Wl,-rpath,\${libdir}") -l${shortname} $(enabled shared || echo $libs) $linkflags
 Libs.private: $(enabled shared && echo $libs)
 Cflags: -I\${includedir}
 EOF
@@@@ -6260,12 +6267,12 @@@@ Cflags: -I\${includedir}
 EOF
 }
 
-pkgconfig_generate libavutil     "FFmpeg utility library"               "$LIBAVUTIL_VERSION"     "$LIBRT $LIBM"
-pkgconfig_generate libavcodec    "FFmpeg codec library"                 "$LIBAVCODEC_VERSION"    "$extralibs"
-pkgconfig_generate libavformat   "FFmpeg container format library"      "$LIBAVFORMAT_VERSION"   "$extralibs"
-pkgconfig_generate libavdevice   "FFmpeg device handling library"       "$LIBAVDEVICE_VERSION"   "$extralibs"
-pkgconfig_generate libavfilter   "FFmpeg audio/video filtering library" "$LIBAVFILTER_VERSION"   "$extralibs"
-pkgconfig_generate libpostproc   "FFmpeg postprocessing library"        "$LIBPOSTPROC_VERSION"   ""
-pkgconfig_generate libavresample "Libav audio resampling library"       "$LIBAVRESAMPLE_VERSION" "$LIBM"
-pkgconfig_generate libswscale    "FFmpeg image rescaling library"       "$LIBSWSCALE_VERSION"    "$LIBM"
-pkgconfig_generate libswresample "FFmpeg audio resampling library"      "$LIBSWRESAMPLE_VERSION" "$LIBM $LIBSOXR"
+pkgconfig_generate libavutil     "FFmpeg utility library"               "$LIBAVUTIL_VERSION"     "$LIBavutil_EXTRALIBS"     "$LIBavutil_REQUIRES"     "$LIBavutil_LINKFLAGS"
+pkgconfig_generate libavcodec    "FFmpeg codec library"                 "$LIBAVCODEC_VERSION"    "$LIBavcodec_EXTRALIBS"    "$LIBavcodec_REQUIRES"    "$LIBavcodec_LINKFLAGS"
+pkgconfig_generate libavformat   "FFmpeg container format library"      "$LIBAVFORMAT_VERSION"   "$LIBavformat_EXTRALIBS"   "$LIBavformat_REQUIRES"   "$LIBavformat_LINKFLAGS"
+pkgconfig_generate libavdevice   "FFmpeg device handling library"       "$LIBAVDEVICE_VERSION"   "$LIBavdevice_EXTRALIBS"   "$LIBavdevice_REQUIRES"   "$LIBavdevice_LINKFLAGS"
+pkgconfig_generate libavfilter   "FFmpeg audio/video filtering library" "$LIBAVFILTER_VERSION"   "$LIBavfilter_EXTRALIBS"   "$LIBavfilter_REQUIRES"   "$LIBavfilter_LINKFLAGS"
+pkgconfig_generate libpostproc   "FFmpeg postprocessing library"        "$LIBPOSTPROC_VERSION"   "$LIBpostproc_EXTRALIBS"   "$LIBpostproc_REQUIRES"   "$LIBpostproc_LINKFLAGS"
+pkgconfig_generate libavresample "Libav audio resampling library"       "$LIBAVRESAMPLE_VERSION" "$LIBreavsample_EXTRALIBS" "$LIBavresample_REQUIRES" "$LIBavresample_LINKFLAGS"
+pkgconfig_generate libswscale    "FFmpeg image rescaling library"       "$LIBSWSCALE_VERSION"    "$LIBswscale_EXTRALIBS"    "$LIBswscale_REQUIRES"    "$LIBswscale_LINKFLAGS"
+pkgconfig_generate libswresample "FFmpeg audio rescaling library"       "$LIBSWRESAMPLE_VERSION" "$LIBswresample_EXTRALIBS" "$LIBswresample_REQUIRES" "$LIBswresample_LINKFLAGS"
@


1.54
log
@Update to ffmpeg-20160903.

from Brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.53 2016/01/14 06:09:43 ajacoutot Exp $
d5 2
a6 2
--- configure.orig	Sat Aug 27 22:51:29 2016
+++ configure	Sat Aug 27 22:55:40 2016
d41 1
a41 1
@@@@ -5787,6 +5789,11 @@@@ if test $target_os = "haiku"; then
d53 1
a53 1
@@@@ -6219,8 +6226,8 @@@@ pkgconfig_generate(){
d64 1
a64 1
@@@@ -6235,7 +6242,7 @@@@ Version: $version
d73 1
a73 1
@@@@ -6259,12 +6266,12 @@@@ Cflags: -I\${includedir}
@


1.53
log
@Update to ffmpeg-20160113.

from Brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.52 2015/12/17 09:54:33 ajacoutot Exp $
d5 2
a6 2
--- configure.orig	Thu Nov 12 02:08:28 2015
+++ configure	Thu Dec 17 20:55:14 2015
d15 1
a15 1
@@@@ -4307,7 +4308,7 @@@@ case $target_os in
d24 1
a24 1
@@@@ -4671,7 +4672,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d33 1
a33 1
@@@@ -5066,6 +5067,7 @@@@ check_func  ${malloc_prefix}memalign            && ena
d41 1
a41 1
@@@@ -5785,6 +5787,11 @@@@ if test $target_os = "haiku"; then
d53 1
a53 1
@@@@ -6217,8 +6224,8 @@@@ pkgconfig_generate(){
d64 1
a64 1
@@@@ -6233,7 +6240,7 @@@@ Version: $version
d73 1
a73 1
@@@@ -6257,12 +6264,12 @@@@ Cflags: -I\${includedir}
@


1.52
log
@Remove MIPS -Bsymbolic workaround now that the linker has been fixed.

from Brad (maintainer)
@
text
@d1 4
a4 1
$OpenBSD: patch-configure,v 1.51 2015/11/16 06:36:55 ajacoutot Exp $
d6 10
a15 2
+++ configure	Wed Dec 16 19:10:47 2015
@@@@ -4307,7 +4307,7 @@@@ case $target_os in
d24 1
a24 1
@@@@ -4671,7 +4671,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d33 9
a41 1
@@@@ -5785,6 +5785,11 @@@@ if test $target_os = "haiku"; then
d53 1
a53 1
@@@@ -6217,8 +6222,8 @@@@ pkgconfig_generate(){
d64 1
a64 1
@@@@ -6233,7 +6238,7 @@@@ Version: $version
d73 1
a73 1
@@@@ -6257,12 +6262,12 @@@@ Cflags: -I\${includedir}
@


1.51
log
@Update to FFmpeg 20151112 (2.8.2).

from Brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.50 2015/09/10 07:10:04 ajacoutot Exp $
d3 1
a3 1
+++ configure	Sun Nov 15 22:08:43 2015
d22 1
a22 12
@@@@ -5557,7 +5557,9 @@@@ check_ldflags -Wl,--warn-common
 check_ldflags -Wl,-rpath-link=libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample
 enabled rpath && add_ldexeflags -Wl,-rpath,$libdir
 enabled rpath && add_ldlibflags -Wl,-rpath,$libdir
-test_ldflags -Wl,-Bsymbolic && append SHFLAGS -Wl,-Bsymbolic
+if ! enabled mips; then
+    test_ldflags -Wl,-Bsymbolic && append SHFLAGS -Wl,-Bsymbolic
+fi
 
 # add some strip flags
 # -wN '..@@*' is more selective than -x, but not available everywhere.
@@@@ -5785,6 +5787,11 @@@@ if test $target_os = "haiku"; then
d34 1
a34 1
@@@@ -6217,8 +6224,8 @@@@ pkgconfig_generate(){
d45 1
a45 1
@@@@ -6233,7 +6240,7 @@@@ Version: $version
d54 1
a54 1
@@@@ -6257,12 +6264,12 @@@@ Cflags: -I\${includedir}
@


1.50
log
@Update to ffmpeg-20150909.

from Brad (maintainer)
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.49 2015/07/26 07:22:15 ajacoutot Exp $
--- configure.orig	Mon Sep  7 21:58:01 2015
+++ configure	Wed Sep  9 03:08:46 2015
d22 1
a22 1
@@@@ -5556,7 +5556,9 @@@@ check_ldflags -Wl,--warn-common
d33 1
a33 1
@@@@ -5784,6 +5786,11 @@@@ if test $target_os = "haiku"; then
d45 1
a45 1
@@@@ -6216,8 +6223,8 @@@@ pkgconfig_generate(){
d56 1
a56 1
@@@@ -6232,7 +6239,7 @@@@ Version: $version
d65 1
a65 1
@@@@ -6256,12 +6263,12 @@@@ Cflags: -I\${includedir}
d77 1
a77 1
-pkgconfig_generate libswresample "FFmpeg audio resampling library"      "$LIBSWRESAMPLE_VERSION" "$LIBM"
@


1.49
log
@Update to FFmpeg 20150723 (2.7.2).

from Brad (maintainer)
@
text
@d1 4
a4 4
$OpenBSD: patch-configure,v 1.48 2015/06/29 06:19:32 ajacoutot Exp $
--- configure.orig	Thu Jul 23 19:37:50 2015
+++ configure	Thu Jul 23 19:43:44 2015
@@@@ -4204,7 +4204,7 @@@@ case $target_os in
d13 1
a13 1
@@@@ -4555,7 +4555,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d22 1
a22 2
@@@@ -5394,7 +5394,9 @@@@ check_disable_warning -Wno-pointer-sign
 check_ldflags -Wl,--warn-common
d25 1
d33 1
a33 1
@@@@ -5600,6 +5602,11 @@@@ if test $target_os = "haiku"; then
d45 1
a45 1
@@@@ -6025,8 +6032,8 @@@@ pkgconfig_generate(){
d56 1
a56 1
@@@@ -6041,7 +6048,7 @@@@ Version: $version
d65 1
a65 1
@@@@ -6065,12 +6072,12 @@@@ Cflags: -I\${includedir}
@


1.48
log
@Build with Clang on i386.

from brad (maintainer)
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.47 2015/06/10 06:34:45 ajacoutot Exp $
--- configure.orig	Tue Jun  9 20:07:32 2015
+++ configure	Sun Jun 28 03:21:53 2015
d22 1
a22 1
@@@@ -5391,7 +5391,9 @@@@ check_disable_warning -Wno-pointer-sign
d33 1
a33 1
@@@@ -5597,6 +5599,11 @@@@ if test $target_os = "haiku"; then
d45 1
a45 1
@@@@ -6022,8 +6029,8 @@@@ pkgconfig_generate(){
d56 1
a56 1
@@@@ -6038,7 +6045,7 @@@@ Version: $version
d65 1
a65 1
@@@@ -6062,12 +6069,12 @@@@ Cflags: -I\${includedir}
@


1.47
log
@Update to ffmpeg-20150609.

from brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.46 2015/06/03 06:21:53 ajacoutot Exp $
d3 1
a3 1
+++ configure	Tue Jun  9 20:32:04 2015
d33 13
a45 1
@@@@ -6022,8 +6024,8 @@@@ pkgconfig_generate(){
d56 1
a56 1
@@@@ -6038,7 +6040,7 @@@@ Version: $version
d65 1
a65 1
@@@@ -6062,12 +6064,12 @@@@ Cflags: -I\${includedir}
@


1.46
log
@Disable the use of -Bsymbolic on mips.

tested by miod@@
from brad (maintainer)
@
text
@d1 4
a4 4
$OpenBSD: patch-configure,v 1.45 2015/05/22 05:41:22 ajacoutot Exp $
--- configure.orig	Wed Mar 25 18:11:38 2015
+++ configure	Sat May 30 14:28:37 2015
@@@@ -4057,7 +4057,7 @@@@ case $target_os in
d13 1
a13 1
@@@@ -4404,7 +4404,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d22 1
a22 1
@@@@ -5203,7 +5203,9 @@@@ check_disable_warning -Wno-pointer-sign
d33 1
a33 1
@@@@ -5823,8 +5825,8 @@@@ pkgconfig_generate(){
d44 1
a44 1
@@@@ -5839,7 +5841,7 @@@@ Version: $version
d53 1
a53 1
@@@@ -5863,12 +5865,12 @@@@ Cflags: -I\${includedir}
@


1.45
log
@Correct the pkgconfig bits and re-add the use of the -Bsymbolic flag.

from brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.44 2015/04/28 06:32:47 ajacoutot Exp $
d3 1
a3 1
+++ configure	Thu May 21 16:13:18 2015
d22 12
a33 1
@@@@ -5823,8 +5823,8 @@@@ pkgconfig_generate(){
d44 1
a44 1
@@@@ -5839,7 +5839,7 @@@@ Version: $version
d53 1
a53 1
@@@@ -5863,12 +5863,12 @@@@ Cflags: -I\${includedir}
@


1.44
log
@Update to FFmpeg 20150412: a snapshot from the 2.6 branch currently at the 2.6.2
release.

Two of the lib dependencies got removed:
- libschroedinger: currently broken because of an issue with mutexes;
unmaintained upstream and its a niche codec
- libtheora: modern replacements such as VP8 / VP9 are more than good enough to
replace VP3 use

from brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.43 2015/01/10 10:46:37 brad Exp $
d3 1
a3 1
+++ configure	Wed Mar 25 18:16:17 2015
d22 1
a22 9
@@@@ -5203,7 +5203,6 @@@@ check_disable_warning -Wno-pointer-sign
 check_ldflags -Wl,--warn-common
 check_ldflags -Wl,-rpath-link=libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample
 enabled rpath && add_ldexeflags -Wl,-rpath,$libdir
-test_ldflags -Wl,-Bsymbolic && append SHFLAGS -Wl,-Bsymbolic
 
 # add some strip flags
 # -wN '..@@*' is more selective than -x, but not available everywhere.
@@@@ -5823,8 +5822,8 @@@@ pkgconfig_generate(){
d33 1
a33 1
@@@@ -5839,7 +5838,7 @@@@ Version: $version
d42 13
a54 5
@@@@ -5872,3 +5871,13 @@@@ pkgconfig_generate libpostproc   "FFmpeg postprocessin
 pkgconfig_generate libavresample "Libav audio resampling library"       "$LIBAVRESAMPLE_VERSION" "$LIBM"
 pkgconfig_generate libswscale    "FFmpeg image rescaling library"       "$LIBSWSCALE_VERSION"    "$LIBM"
 pkgconfig_generate libswresample "FFmpeg audio resampling library"      "$LIBSWRESAMPLE_VERSION" "$LIBM"
+
@


1.43
log
@Update to FFmpeg 20150107 snapshot. From 2.4 branch.
@
text
@d1 4
a4 4
$OpenBSD: patch-configure,v 1.42 2014/10/23 07:41:45 brad Exp $
--- configure.orig	Wed Jan  7 04:31:28 2015
+++ configure	Wed Jan  7 04:42:09 2015
@@@@ -3992,7 +3992,7 @@@@ case $target_os in
d13 1
a13 1
@@@@ -4323,7 +4323,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d22 1
a22 1
@@@@ -5054,7 +5054,6 @@@@ check_disable_warning -Wno-pointer-sign
d30 1
a30 1
@@@@ -5675,8 +5674,8 @@@@ pkgconfig_generate(){
d41 1
a41 1
@@@@ -5691,7 +5690,7 @@@@ Version: $version
d50 1
a50 1
@@@@ -5724,3 +5723,13 @@@@ pkgconfig_generate libpostproc   "FFmpeg postprocessin
@


1.42
log
@Fix the configure script to be able to detect the presence of the
V4L2 VIDIOC_ENUM_FRAMESIZES ioctl and make use of it on OpenBSD.

Pushed upstream and commited.

From armani@@
@
text
@d1 4
a4 8
$OpenBSD: patch-configure,v 1.41 2014/10/19 23:14:23 brad Exp $

04a4fb81b3d1a92f52b5404738da8971c018946f
v4l2: Make use of the VIDIOC_ENUM_FRAMESIZES ioctl on OpenBSD

--- configure.orig	Wed Oct  8 18:04:13 2014
+++ configure	Sun Oct 19 19:48:01 2014
@@@@ -3990,7 +3990,7 @@@@ case $target_os in
d13 1
a13 1
@@@@ -4321,7 +4321,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d22 1
a22 9
@@@@ -4943,6 +4943,7 @@@@ check_header linux/videodev2.h
 check_code cc linux/videodev2.h "struct v4l2_frmsizeenum vfse; vfse.discrete.width = 0;" && enable_safe struct_v4l2_frmivalenum_discrete
 
 check_header sys/videoio.h
+check_code cc sys/videoio.h "struct v4l2_frmsizeenum vfse; vfse.discrete.width = 0;" && enable_safe struct_v4l2_frmivalenum_discrete
 
 check_func_headers "windows.h vfw.h" capCreateCaptureWindow "$vfwcap_indev_extralibs"
 # check that WM_CAP_DRIVER_CONNECT is defined to the proper value
@@@@ -5052,7 +5053,6 @@@@ check_disable_warning -Wno-pointer-sign
d30 1
a30 1
@@@@ -5672,8 +5672,8 @@@@ pkgconfig_generate(){
d41 1
a41 1
@@@@ -5688,7 +5688,7 @@@@ Version: $version
d50 1
a50 1
@@@@ -5721,3 +5721,13 @@@@ pkgconfig_generate libpostproc   "FFmpeg postprocessin
@


1.41
log
@Update to FFmpeg 20141010 snapshot. From 2.4 branch.

ok ajacoutot@@
@
text
@d1 5
a5 1
$OpenBSD: patch-configure,v 1.40 2014/08/14 08:20:27 brad Exp $
d7 1
a7 1
+++ configure	Fri Oct 10 23:16:17 2014
d26 9
a34 1
@@@@ -5052,7 +5052,6 @@@@ check_disable_warning -Wno-pointer-sign
d42 1
a42 1
@@@@ -5672,8 +5671,8 @@@@ pkgconfig_generate(){
d53 1
a53 1
@@@@ -5688,7 +5687,7 @@@@ Version: $version
d62 1
a62 1
@@@@ -5721,3 +5720,13 @@@@ pkgconfig_generate libpostproc   "FFmpeg postprocessin
@


1.40
log
@Update to FFmpeg 20140810 snapshot. From master branch.

ok ajacoutot@@ zhuk@@
@
text
@d1 4
a4 12
$OpenBSD: patch-configure,v 1.39 2014/05/16 01:34:50 brad Exp $
--- configure.orig	Sun Aug 10 21:09:03 2014
+++ configure	Sun Aug 10 21:15:16 2014
@@@@ -1630,7 +1630,6 @@@@ HEADERS_LIST="
     mach_mach_time_h
     machine_ioctl_bt848_h
     machine_ioctl_meteor_h
-    malloc_h
     openjpeg_1_5_openjpeg_h
     OpenGL_gl3_h
     poll_h
@@@@ -3970,7 +3969,7 @@@@ case $target_os in
d13 1
a13 1
@@@@ -4301,7 +4300,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d22 1
a22 1
@@@@ -5026,7 +5025,6 @@@@ check_disable_warning -Wno-pointer-sign
d25 1
a25 1
 enabled rpath && add_ldflags -Wl,-rpath,$libdir
d30 1
a30 1
@@@@ -5645,8 +5643,8 @@@@ pkgconfig_generate(){
d41 1
a41 1
@@@@ -5661,7 +5659,7 @@@@ Version: $version
d50 1
a50 1
@@@@ -5694,3 +5692,13 @@@@ pkgconfig_generate libpostproc   "FFmpeg postprocessin
@


1.39
log
@Update to FFmpeg 20140412 snapshot. From 2.2 branch.

Update to MPlayer 20140412 snapshot.

Take MAINTAINER for MPlayer. ok edd@@

ok ajacoutot@@
@
text
@d1 6
a6 4
$OpenBSD: patch-configure,v 1.38 2013/12/24 15:22:55 brad Exp $
--- configure.orig	Mon Mar 24 23:08:28 2014
+++ configure	Mon Mar 24 23:12:38 2014
@@@@ -1606,7 +1606,6 @@@@ HAVE_LIST="
a7 2
     machine_rw_barrier
     makeinfo
d9 4
a12 4
     MapViewOfFile
     memalign
     MemoryBarrier
@@@@ -3723,7 +3722,7 @@@@ case $target_os in
d21 1
a21 1
@@@@ -4054,7 +4053,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d30 1
a30 1
@@@@ -4695,7 +4694,6 @@@@ check_disable_warning -Wno-pointer-sign
d33 1
a33 1
 enabled rpath && add_ldflags -Wl,-rpath=$libdir
d38 2
a39 1
@@@@ -5245,6 +5243,7 @@@@ pkgconfig_generate(){
d42 3
a44 1
     requires=$5
d49 1
a49 1
@@@@ -5259,7 +5258,7 @@@@ Version: $version
d58 5
a62 13
@@@@ -5295,12 +5294,12 @@@@ lavfi_libs=${lavfi_libs%, }
 lavd_libs="libavformat${build_suffix} = $LIBAVFORMAT_VERSION"
 enabled lavfi_indev && prepend lavd_libs "libavfilter${build_suffix} = $LIBAVFILTER_VERSION,"
 
-pkgconfig_generate libavutil     "FFmpeg utility library"               "$LIBAVUTIL_VERSION"     "$LIBM"
-pkgconfig_generate libavcodec    "FFmpeg codec library"                 "$LIBAVCODEC_VERSION"    "$extralibs" "libavutil${build_suffix} = $LIBAVUTIL_VERSION"
-pkgconfig_generate libavformat   "FFmpeg container format library"      "$LIBAVFORMAT_VERSION"   "$extralibs" "libavcodec${build_suffix} = $LIBAVCODEC_VERSION"
-pkgconfig_generate libavdevice   "FFmpeg device handling library"       "$LIBAVDEVICE_VERSION"   "$extralibs" "$lavd_libs"
-pkgconfig_generate libavfilter   "FFmpeg audio/video filtering library" "$LIBAVFILTER_VERSION"   "$extralibs" "$lavfi_libs"
-pkgconfig_generate libpostproc   "FFmpeg postprocessing library"        "$LIBPOSTPROC_VERSION"   ""           "libavutil${build_suffix} = $LIBAVUTIL_VERSION"
-pkgconfig_generate libavresample "Libav audio resampling library"       "$LIBAVRESAMPLE_VERSION" "$extralibs" "libavutil${build_suffix} = $LIBAVUTIL_VERSION"
-pkgconfig_generate libswscale    "FFmpeg image rescaling library"       "$LIBSWSCALE_VERSION"    "$LIBM"      "libavutil${build_suffix} = $LIBAVUTIL_VERSION"
-pkgconfig_generate libswresample "FFmpeg audio resampling library"      "$LIBSWRESAMPLE_VERSION" "$LIBM"      "libavutil${build_suffix} = $LIBAVUTIL_VERSION"
@


1.38
log
@Update to FFmpeg 20131216 snapshot. From 1.2 branch.

ok sthen@@
@
text
@d1 4
a4 5
$OpenBSD: patch-configure,v 1.37 2013/08/19 14:38:29 brad Exp $
--- configure.orig	Mon Dec 16 20:09:44 2013
+++ configure	Thu Dec 19 17:13:54 2013
@@@@ -1438,7 +1438,6 @@@@ HAVE_LIST="
     machine_ioctl_bt848_h
d6 1
d11 2
a12 2
     mkstemp
@@@@ -3234,7 +3233,7 @@@@ case $target_os in
d21 1
a21 1
@@@@ -3521,7 +3520,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d28 3
a30 4
 enable_pic() {
     enable pic
@@@@ -4081,7 +4080,6 @@@@ enabled extra_warnings && check_cflags -Winline
 # add some linker flags
d33 1
d36 3
a38 3
 enabled xmm_clobber_test &&
     check_ldflags -Wl,--wrap,avcodec_open2              \
@@@@ -4548,6 +4546,7 @@@@ pkgconfig_generate(){
d46 1
a46 1
@@@@ -4562,7 +4561,7 @@@@ Version: $version
d50 2
a51 2
-Libs: -L\${libdir} -l${shortname} $(enabled shared || echo $libs)
+Libs: -L\${libdir} -l${shortname} $(enabled shared || echo $libs) $linkflags
d55 22
a76 25
@@@@ -4598,15 +4597,15 @@@@ libavfilter_pc_deps=${libavfilter_pc_deps%, }
 libavdevice_pc_deps="libavformat${build_suffix} = $LIBAVFORMAT_VERSION"
 enabled lavfi_indev && prepend libavdevice_pc_deps "libavfilter${build_suffix} = $LIBAVFILTER_VERSION,"
 
-pkgconfig_generate libavutil "FFmpeg utility library" "$LIBAVUTIL_VERSION" "$LIBM"
-pkgconfig_generate libavcodec "FFmpeg codec library" "$LIBAVCODEC_VERSION" "$extralibs" "libavutil${build_suffix} = $LIBAVUTIL_VERSION"
-pkgconfig_generate libavformat "FFmpeg container format library" "$LIBAVFORMAT_VERSION" "$extralibs" "libavcodec${build_suffix} = $LIBAVCODEC_VERSION"
-pkgconfig_generate libavdevice "FFmpeg device handling library" "$LIBAVDEVICE_VERSION" "$extralibs" "$libavdevice_pc_deps"
-pkgconfig_generate libavfilter "FFmpeg audio/video filtering library" "$LIBAVFILTER_VERSION" "$extralibs" "$libavfilter_pc_deps"
-pkgconfig_generate libpostproc "FFmpeg postprocessing library" "$LIBPOSTPROC_VERSION" "" "libavutil${build_suffix} = $LIBAVUTIL_VERSION"
-pkgconfig_generate libavresample "Libav audio resampling library" "$LIBAVRESAMPLE_VERSION" "$extralibs" "libavutil${build_suffix} = $LIBAVUTIL_VERSION"
-pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "$LIBM" "libavutil${build_suffix} = $LIBAVUTIL_VERSION"
-pkgconfig_generate libswresample "FFmpeg audio resampling library" "$LIBSWRESAMPLE_VERSION" "$LIBM" "libavutil${build_suffix} = $LIBAVUTIL_VERSION"
+pkgconfig_generate libavutil "FFmpeg utility library" "$LIBAVUTIL_VERSION" "$LIBavutil_EXTRALIBS" "$LIBavutil_REQUIRES" "$LIBavutil_LINKFLAGS"
+pkgconfig_generate libavcodec "FFmpeg codec library" "$LIBAVCODEC_VERSION" "$LIBavcodec_EXTRALIBS" "$LIBavcodec_REQUIRES" "$LIBavcodec_LINKFLAGS"
+pkgconfig_generate libavformat "FFmpeg container format library" "$LIBAVFORMAT_VERSION" "$LIBavformat_EXTRALIBS" "$LIBavformat_REQUIRES" "$LIBavformat_LINKFLAGS"
+pkgconfig_generate libavdevice "FFmpeg device handling library" "$LIBAVDEVICE_VERSION" "$LIBavdevice_EXTRALIBS" "$LIBavdevice_REQUIRES" "$LIBavdevice_LINKFLAGS"
+pkgconfig_generate libavfilter "FFmpeg video filtering library" "$LIBAVFILTER_VERSION" "$LIBavfilter_EXTRALIBS" "$LIBavfilter_REQUIRES" "$LIBavfilter_LINKFLAGS"
+pkgconfig_generate libpostproc "FFmpeg post processing library" "$LIBPOSTPROC_VERSION" "$LIBpostproc_EXTRALIBS" "$LIBpostproc_REQUIRES" "$LIBpostproc_LINKFLAGS"
+pkgconfig_generate libavresample "Libav audio resampling library" "$LIBAVRESAMPLE_VERSION" "$LIBreavsample_EXTRALIBS" "$LIBavresample_REQUIRES" "$LIBavresample_LINKFLAGS"
+pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "$LIBswscale_EXTRALIBS" "$LIBswscale_REQUIRES" "$LIBswscale_LINKFLAGS"
+pkgconfig_generate libswresample "FFmpeg audio rescaling library" "$LIBSWRESAMPLE_VERSION" "$LIBswresample_EXTRALIBS" "$LIBswresample_REQUIRES" "$LIBswresample_LINKFLAGS"
 
 fix_ffmpeg_remote(){
     git_remote_from=$1
@


1.37
log
@Update to FFmpeg 20130718 snapshot. From 1.2 branch.

ok sthen@@
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.36 2013/04/08 17:06:56 brad Exp $
--- configure.orig	Thu May 30 18:54:00 2013
+++ configure	Wed Jun 12 16:02:21 2013
d12 1
a12 1
@@@@ -3232,7 +3231,7 @@@@ case $target_os in
d21 1
a21 1
@@@@ -3519,7 +3518,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d30 1
a30 1
@@@@ -4079,7 +4078,6 @@@@ enabled extra_warnings && check_cflags -Winline
d38 1
a38 1
@@@@ -4546,6 +4544,7 @@@@ pkgconfig_generate(){
d46 1
a46 1
@@@@ -4560,7 +4559,7 @@@@ Version: $version
d55 1
a55 1
@@@@ -4596,15 +4595,15 @@@@ libavfilter_pc_deps=${libavfilter_pc_deps%, }
d74 1
a74 1
+pkgconfig_generate libavresample "Libav audio resampling library" "$LIBAVRESAMPLE_VERSION" "$extralibs" "libavutil = $LIBAVUTIL_VERSION"
@


1.36
log
@Update to FFmpeg 20130319 snapshot. From 1.2 branch.

ok sthen@@
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.35 2013/03/13 02:26:45 brad Exp $
--- configure.orig	Tue Mar 12 22:35:42 2013
+++ configure	Wed Mar 13 01:50:12 2013
d12 1
a12 1
@@@@ -3229,7 +3228,7 @@@@ case $target_os in
d21 1
a21 1
@@@@ -3516,7 +3515,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d30 1
a30 1
@@@@ -4080,7 +4079,6 @@@@ enabled extra_warnings && check_cflags -Winline
d38 1
a38 1
@@@@ -4547,6 +4545,7 @@@@ pkgconfig_generate(){
d46 1
a46 1
@@@@ -4561,7 +4560,7 @@@@ Version: $version
d55 1
a55 1
@@@@ -4597,15 +4596,15 @@@@ libavfilter_pc_deps=${libavfilter_pc_deps%, }
@


1.35
log
@Update to FFmpeg 20130214 snapshot. From 1.1 branch.

ok sthen@@
@
text
@d1 4
a4 12
$OpenBSD: patch-configure,v 1.33 2013/01/14 02:14:41 brad Exp $
--- configure.orig	Thu Feb 14 14:58:57 2013
+++ configure	Thu Feb 14 15:07:02 2013
@@@@ -1381,6 +1381,7 @@@@ HAVE_LIST="
     gettimeofday
     glob
     gnu_as
+    gsm_h
     ibm_asm
     inet_aton
     io_h
@@@@ -1398,7 +1399,6 @@@@ HAVE_LIST="
d12 10
a21 1
@@@@ -3435,7 +3435,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d30 1
a30 12
@@@@ -3828,7 +3828,9 @@@@ enabled libfdk_aac && require  libfdk_aac fdk-aac/aace
 flite_libs="-lflite_cmu_time_awb -lflite_cmu_us_awb -lflite_cmu_us_kal -lflite_cmu_us_kal16 -lflite_cmu_us_rms -lflite_cmu_us_slt -lflite_usenglish -lflite_cmulex -lflite"
 enabled libflite   && require2 libflite "flite/flite.h" flite_init $flite_libs
 enabled libfreetype && require_pkg_config freetype2 "ft2build.h freetype/freetype.h" FT_Init_FreeType
-enabled libgsm     && require  libgsm gsm/gsm.h gsm_create -lgsm
+enabled libgsm     && { for gsm_hdr in "gsm.h" "gsm/gsm.h"; do
+                            check_lib "${gsm_hdr}" gsm_create -lgsm && break;
+                        done || die "ERROR: libgsm not found"; }
 enabled libilbc    && require  libilbc ilbc.h WebRtcIlbcfix_InitDecode -lilbc
 enabled libmodplug && require  libmodplug libmodplug/modplug.h ModPlug_Load -lmodplug
 enabled libmp3lame && require  "libmp3lame >= 3.98.3" lame/lame.h lame_set_VBR_quality -lmp3lame
@@@@ -4001,7 +4003,6 @@@@ enabled extra_warnings && check_cflags -Winline
d38 1
a38 1
@@@@ -4507,6 +4508,7 @@@@ pkgconfig_generate(){
d45 2
a46 2
     cat <<EOF > $name/$name.pc
@@@@ -4521,7 +4523,7 @@@@ Version: $version
d55 3
a57 3
@@@@ -4557,15 +4559,15 @@@@ libavfilter_pc_deps=${libavfilter_pc_deps%, }
 libavdevice_pc_deps="libavformat = $LIBAVFORMAT_VERSION"
 enabled lavfi_indev && prepend libavdevice_pc_deps "libavfilter = $LIBAVFILTER_VERSION,"
d60 2
a61 2
-pkgconfig_generate libavcodec "FFmpeg codec library" "$LIBAVCODEC_VERSION" "$extralibs" "libavutil = $LIBAVUTIL_VERSION"
-pkgconfig_generate libavformat "FFmpeg container format library" "$LIBAVFORMAT_VERSION" "$extralibs" "libavcodec = $LIBAVCODEC_VERSION"
d63 5
a67 2
-pkgconfig_generate libavfilter "FFmpeg video filtering library" "$LIBAVFILTER_VERSION" "$extralibs" "$libavfilter_pc_deps"
-pkgconfig_generate libpostproc "FFmpeg postprocessing library" "$LIBPOSTPROC_VERSION" "" "libavutil = $LIBAVUTIL_VERSION"
d74 1
a74 3
 pkgconfig_generate libavresample "Libav audio resampling library" "$LIBAVRESAMPLE_VERSION" "$extralibs" "libavutil = $LIBAVUTIL_VERSION"
-pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "$LIBM" "libavutil = $LIBAVUTIL_VERSION"
-pkgconfig_generate libswresample "FFmpeg audio resampling library" "$LIBSWRESAMPLE_VERSION" "$LIBM" "libavutil = $LIBAVUTIL_VERSION"
@


1.34
log
@- Remove the --disable-avx flag as I found out after speaking to Antoine
  about Libav that digging into the CPU run-time detection code that the
  AVX support has an OS level check unlike the SSE code so it is safe.
- Revert back to not using the -Bsymbolic linker flag as was done for
  quite some time to workaround an issue with pthreads but enabling it
  exposed a bug with the mips64 linker and I'd rather do this consistently
  across all archs as was done before instead of only for mips64 as has
  been proposed.
- sync the libgsm hacking with my submitted diff from upstream.

ok ajacoutot@@ sthen@@
@
text
@d2 5
a6 5
--- configure.orig	Tue Sep 18 22:44:40 2012
+++ configure	Thu Jan 24 16:11:00 2013
@@@@ -1185,6 +1185,7 @@@@ HAVE_LIST="
     GetProcessTimes
     getrusage
d11 2
a12 2
     inline_asm
@@@@ -1205,7 +1206,6 @@@@ HAVE_LIST="
d20 1
a20 9
@@@@ -2618,6 +2618,7 @@@@ case $target_os in
         enable pic
         disable symver
         SHFLAGS='-shared'
+        SLIBNAME_WITH_MAJOR='$(SLIBNAME).$(LIBVERSION)'
         oss_indev_extralibs="-lossaudio"
         oss_outdev_extralibs="-lossaudio"
         ;;
@@@@ -2800,7 +2801,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d29 3
a31 3
@@@@ -3138,7 +3139,9 @@@@ enabled libdirac   && require_pkg_config dirac        
     "dirac_decoder_init dirac_encoder_init"
 enabled libfaac    && require2 libfaac "stdint.h faac.h" faacEncGetVersion -lfaac
d37 1
d40 1
a40 2
 enabled libnut     && require  libnut libnut.h nut_demuxer_init -lnut
@@@@ -3291,7 +3294,6 @@@@ enabled extra_warnings && check_cflags -Winline
d43 1
a43 1
 check_ldflags -Wl,-rpath-link=libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil
d46 11
a56 11
 echo "X{};" > $TMPV
 if test_ldflags -Wl,--version-script,$TMPV; then
@@@@ -3714,6 +3716,7 @@@@ comment=$2
 version=$3
 libs=$4
 requires=$5
+linkflags=$6
 enabled ${name#lib} || return 0
 mkdir -p $name
 cat <<EOF > $name/$name.pc
@@@@ -3728,7 +3731,7 @@@@ Version: $version
d65 3
a67 3
@@@@ -3748,11 +3751,11 @@@@ Cflags: -I\${includedir}
 EOF
 }
d72 2
a73 2
-pkgconfig_generate libavdevice "FFmpeg device handling library" "$LIBAVDEVICE_VERSION" "$extralibs" "libavformat = $LIBAVFORMAT_VERSION"
-pkgconfig_generate libavfilter "FFmpeg video filtering library" "$LIBAVFILTER_VERSION" "$extralibs"
a74 2
-pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "$LIBM" "libavutil = $LIBAVUTIL_VERSION"
-pkgconfig_generate libswresample "FFmpeg audio rescaling library" "$LIBSWRESAMPLE_VERSION" "$LIBM" "libavutil = $LIBAVUTIL_VERSION"
d81 3
d86 3
@


1.33
log
@Update to FFmpeg 20121026 snapshot. From 0.10 branch.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.32 2013/01/08 10:13:13 brad Exp $
d3 10
a12 2
+++ configure	Tue Jan  8 06:02:20 2013
@@@@ -1205,7 +1205,6 @@@@ HAVE_LIST="
d20 1
a20 1
@@@@ -2618,6 +2617,7 @@@@ case $target_os in
d28 1
a28 1
@@@@ -2800,7 +2800,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d37 1
a37 1
@@@@ -3138,7 +3138,7 @@@@ enabled libdirac   && require_pkg_config dirac        
d42 3
a44 1
+enabled libgsm     && require  libgsm gsm.h gsm_create -lgsm
d48 9
a56 1
@@@@ -3714,6 +3714,7 @@@@ comment=$2
d64 1
a64 1
@@@@ -3728,7 +3729,7 @@@@ Version: $version
d73 1
a73 1
@@@@ -3748,11 +3749,11 @@@@ Cflags: -I\${includedir}
@


1.32
log
@- Fix generated libavcodec pkgc-config file for static linking.
- sync distinfo.

ok sthen@@
@
text
@d1 4
a4 5
$OpenBSD: patch-configure,v 1.31 2012/09/12 08:15:57 ajacoutot Exp $
--- configure.orig	Sun Jun 10 00:59:57 2012
+++ configure	Tue Nov 20 06:31:14 2012
@@@@ -1092,7 +1092,6 @@@@ HAVE_LIST="
     lzo1x_999_compress
d7 1
d12 1
a12 1
@@@@ -2425,6 +2424,7 @@@@ case $target_os in
d20 1
a20 1
@@@@ -2601,7 +2601,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d29 1
a29 1
@@@@ -2931,7 +2931,7 @@@@ enabled libdirac   && require_pkg_config dirac        
d35 1
d38 1
a38 13
 enabled libopencore_amrnb  && require libopencore_amrnb opencore-amrnb/interf_dec.h Decoder_Interface_init -lopencore-amrnb
@@@@ -3075,10 +3075,6 @@@@ fi
 
 if enabled small; then
     add_cflags $size_cflags
-elif enabled optimizations; then
-    add_cflags $speed_cflags
-else
-    add_cflags $noopt_cflags
 fi
 check_cflags -fno-math-errno
 check_cflags -fno-signed-zeros
@@@@ -3506,6 +3502,7 @@@@ comment=$2
d44 1
d46 1
a46 2
 prefix=$prefix
@@@@ -3519,7 +3516,7 @@@@ Version: $version
d55 1
a55 1
@@@@ -3539,10 +3536,10 @@@@ Cflags: -I\${includedir}
d64 1
a64 1
-pkgconfig_generate libpostproc "FFmpeg post processing library" "$LIBPOSTPROC_VERSION" "" "libavutil = $LIBAVUTIL_VERSION"
d66 1
d74 1
@


1.31
log
@* Remove bogus use of -rpath and replace with utilization of the
  -rpath-link linker flag
* Remove unnecessary patch for ffplay

from Brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.30 2012/09/04 06:31:08 ajacoutot Exp $
d3 1
a3 1
+++ configure	Tue Sep 11 22:47:01 2012
d77 7
a83 7
+pkgconfig_generate libavutil "FFmpeg utility library" "$LIBAVUTIL_VERSION" "$LIBavutil_EXTRALIBS" "" "$LIBavutil_LINKFLAGS"
+pkgconfig_generate libavcodec "FFmpeg codec library" "$LIBAVCODEC_VERSION" "$LIBavcodec_EXTRALIBS" "libavutil" "$LIBavcodec_LINKFLAGS"
+pkgconfig_generate libavformat "FFmpeg container format library" "$LIBAVFORMAT_VERSION" "$LIBavformat_EXTRALIBS" "libavcodec libavutil" "$LIBavformat_LINKFLAGS"
+pkgconfig_generate libavdevice "FFmpeg device handling library" "$LIBAVDEVICE_VERSION" "$LIBavdevice_EXTRALIBS" "libavformat libavcodec libavutil" "$LIBavdevice_LINKFLAGS"
+pkgconfig_generate libavfilter "FFmpeg video filtering library" "$LIBAVFILTER_VERSION" "$LIBavfilter_EXTRALIBS" "libavformat libavcodec libavutil libswscale" "$LIBavfilter_LINKFLAGS"
+pkgconfig_generate libpostproc "FFmpeg post processing library" "$LIBPOSTPROC_VERSION" "$LIBpostproc_EXTRALIBS" "libavutil" "$LIBpostproc_LINKFLAGS"
+pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "$LIBswscale_EXTRALIBS" "libavutil" "$LIBswscale_LINKFLAGS"
@


1.30
log
@Keep --as-needed and remove pthread linking hacks.
Fix the pkg-config file.

from Brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.29 2012/04/28 08:41:32 ajacoutot Exp $
d3 1
a3 1
+++ configure	Sat Aug 18 11:23:36 2012
d49 18
a66 1
@@@@ -3539,10 +3535,10 @@@@ Cflags: -I\${includedir}
d77 7
a83 7
+pkgconfig_generate libavutil "FFmpeg utility library" "$LIBAVUTIL_VERSION" "$LIBavutil_EXTRALIBS"
+pkgconfig_generate libavcodec "FFmpeg codec library" "$LIBAVCODEC_VERSION" "$LIBavcodec_EXTRALIBS" "libavutil"
+pkgconfig_generate libavformat "FFmpeg container format library" "$LIBAVFORMAT_VERSION" "$LIBavformat_EXTRALIBS" "libavcodec libavutil"
+pkgconfig_generate libavdevice "FFmpeg device handling library" "$LIBAVDEVICE_VERSION" "$LIBavdevice_EXTRALIBS" "libavformat libavcodec libavutil"
+pkgconfig_generate libavfilter "FFmpeg video filtering library" "$LIBAVFILTER_VERSION" "$LIBavfilter_EXTRALIBS" "libavformat libavcodec libavutil libswscale"
+pkgconfig_generate libpostproc "FFmpeg post processing library" "$LIBPOSTPROC_VERSION" "$LIBpostproc_EXTRALIBS" "libavutil"
+pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "$LIBswscale_EXTRALIBS" "libavutil"
@


1.29
log
@Update to ffmpeg-20120422 (0.7 branch).
* fix a whole lot of security related issues and bugs

from Brad (maintainer)
@
text
@d1 3
a3 3
$OpenBSD: patch-configure,v 1.28 2011/12/30 17:34:39 edd Exp $
--- configure.orig	Sat Apr 21 23:53:38 2012
+++ configure	Sun Apr 22 00:50:49 2012
d29 1
a29 10
@@@@ -2797,8 +2797,6 @@@@ if enabled asm; then
         $nogas "GNU assembler not found, install gas-preprocessor"
 fi
 
-check_ldflags -Wl,--as-needed
-
 if check_func dlopen; then
     ldl=
 elif check_func dlopen -ldl; then
@@@@ -2931,7 +2929,7 @@@@ enabled libdirac   && require_pkg_config dirac        
d38 1
a38 9
@@@@ -3057,7 +3055,6 @@@@ enabled extra_warnings && check_cflags -Winline
 
 # add some linker flags
 check_ldflags -Wl,--warn-common
-check_ldflags -Wl,-rpath-link,libpostproc -Wl,-rpath-link,libswscale -Wl,-rpath-link,libavfilter -Wl,-rpath-link,libavdevice -Wl,-rpath-link,libavformat -Wl,-rpath-link,libavcodec -Wl,-rpath-link,libavutil
 test_ldflags -Wl,-Bsymbolic && append SHFLAGS -Wl,-Bsymbolic
 
 echo "X{};" > $TMPV
@@@@ -3075,10 +3072,6 @@@@ fi
d49 1
a49 11
@@@@ -3519,8 +3512,7 @@@@ Version: $version
 Requires: $(enabled shared || echo $requires)
 Requires.private: $(enabled shared && echo $requires)
 Conflicts:
-Libs: -L\${libdir} -l${shortname} $(enabled shared || echo $libs)
-Libs.private: $(enabled shared && echo $libs)
+Libs: -L\${libdir} -l${shortname} $libs
 Cflags: -I\${includedir}
 EOF
 cat <<EOF > $name/$name-uninstalled.pc
@@@@ -3539,10 +3531,10 @@@@ Cflags: -I\${includedir}
@


1.28
log
@update ffmpeg to a stable snapshot, from brad, OK aja@@
@
text
@d1 4
a4 4
$OpenBSD: patch-configure,v 1.27 2011/09/04 09:22:43 sthen Exp $
--- configure.orig	Thu Sep 22 14:48:24 2011
+++ configure	Thu Sep 22 23:08:31 2011
@@@@ -1093,7 +1093,6 @@@@ HAVE_LIST="
d12 1
a12 1
@@@@ -2413,6 +2412,8 @@@@ case $target_os in
a16 1
+        SLIB_INSTALL_LINKS=
d20 1
a20 1
@@@@ -2591,7 +2592,7 @@@@ die_license_disabled version3 libvo_amrwbenc
d29 1
a29 1
@@@@ -2772,8 +2773,6 @@@@ if enabled asm; then
d38 1
a38 1
@@@@ -2906,7 +2905,7 @@@@ enabled libdirac   && require_pkg_config dirac        
d47 1
a47 1
@@@@ -3038,7 +3037,6 @@@@ enabled extra_warnings && check_cflags -Winline
d51 1
a51 1
-check_ldflags -Wl,-rpath-link=libpostproc:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil
d55 12
a66 1
@@@@ -3465,8 +3463,7 @@@@ Version: $version
d76 1
a76 1
@@@@ -3485,10 +3482,10 @@@@ Cflags: -I\${includedir}
d85 1
a85 1
-pkgconfig_generate libpostproc "FFmpeg postprocessing library" "$LIBPOSTPROC_VERSION" "" "libavutil = $LIBAVUTIL_VERSION"
@


1.27
log
@FFmpeg build/packaging tweaks from Brad:
- Stop using --disable-optimization to have the port obey the CFLAGS
  but instead modify the configure script appropriately
- Move most of the DESCR into the pkg-readme
- Remove unnecessary CPPFLAGS that was being added to CONFIGURE_ENV
@
text
@d1 4
a4 4
$OpenBSD: patch-configure,v 1.26 2011/04/12 22:59:07 sthen Exp $
--- configure.orig	Wed Apr  6 17:29:22 2011
+++ configure	Wed Aug 24 20:28:01 2011
@@@@ -1087,7 +1087,6 @@@@ HAVE_LIST="
d12 1
a12 1
@@@@ -2389,6 +2388,7 @@@@ case $target_os in
d17 1
d21 1
a21 1
@@@@ -2556,7 +2556,7 @@@@ die_license_disabled version3 libopencore_amrwb
d30 1
a30 1
@@@@ -2751,8 +2751,6 @@@@ if enabled asm; then
d39 1
a39 1
@@@@ -2885,7 +2883,7 @@@@ enabled libdirac   && require_pkg_config dirac        
d42 1
a42 1
 enabled libfreetype && add_cflags $(pkg-config --cflags freetype2) && require libfreetype ft2build.h FT_Init_FreeType -lfreetype
d48 1
a48 1
@@@@ -2997,7 +2995,6 @@@@ enabled extra_warnings && check_cflags -Winline
d52 1
a52 1
-check_ldflags '-Wl,-rpath-link,\$(BUILD_ROOT)/libpostproc -Wl,-rpath-link,\$(BUILD_ROOT)/libswscale -Wl,-rpath-link,\$(BUILD_ROOT)/libavfilter -Wl,-rpath-link,\$(BUILD_ROOT)/libavdevice -Wl,-rpath-link,\$(BUILD_ROOT)/libavformat -Wl,-rpath-link,\$(BUILD_ROOT)/libavcodec -Wl,-rpath-link,\$(BUILD_ROOT)/libavutil'
d56 1
a56 12
@@@@ -3016,10 +3013,6 @@@@ fi
 if enabled small; then
     add_cflags $size_cflags
     optimizations="small"
-elif enabled optimizations; then
-    add_cflags $speed_cflags
-else
-    add_cflags $noopt_cflags
 fi
 check_cflags -fno-math-errno
 check_cflags -fno-signed-zeros
@@@@ -3438,8 +3431,7 @@@@ Version: $version
d66 1
a66 1
@@@@ -3458,10 +3450,10 @@@@ Cflags: -I\${includedir}
d70 2
a71 2
-pkgconfig_generate libavutil "FFmpeg utility library" "$LIBAVUTIL_VERSION"
-pkgconfig_generate libavcodec "FFmpeg codec library" "$LIBAVCODEC_VERSION" "$extralibs"
d75 2
a76 2
-pkgconfig_generate libpostproc "FFmpeg post processing library" "$LIBPOSTPROC_VERSION"
-pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "" "libavutil = $LIBAVUTIL_VERSION"
@


1.26
log
@Update FFmpeg to 20110408 snapshot.

- Enable WebM encoding.
- Stop stripping the shared libraries which explains why I was
   seeing no symbol table with the shared libraries.
- Build all of FFmpeg with -fomit-frame-pointer on i386 instead of
   hacking the various Makefile's and having to add more files as
   further updates are made. Use default CFLAGS (-O2) on i386 now too
   instead of overriding with -O.
- Remove the UINT64_C hack.
- Update HOMEPAGE to use the ffmpeg.org domain.
- Various other cleaning up and fixes for the port.

From Brad, ok dcoppa@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.25 2011/03/29 20:01:43 edd Exp $
d3 1
a3 1
+++ configure	Fri Apr  8 16:46:29 2011
d47 1
a47 1
@@@@ -2997,8 +2995,6 @@@@ enabled extra_warnings && check_cflags -Winline
d52 1
a52 1
-test_ldflags -Wl,-Bsymbolic && append SHFLAGS -Wl,-Bsymbolic
d55 12
a66 11
 if test_ldflags -Wl,--version-script,$TMPV; then
@@@@ -3355,7 +3351,7 @@@@ EOF
 test -n "$malloc_prefix" &&
     echo "#define MALLOC_PREFIX $malloc_prefix" >>$TMPH
 
-if enabled small || disabled optimizations; then
+if enabled small; then
     echo "#undef  av_always_inline"  >> $TMPH
     if enabled small; then
         echo "#define av_always_inline inline"  >> $TMPH
@@@@ -3438,8 +3434,7 @@@@ Version: $version
d76 1
a76 1
@@@@ -3458,10 +3453,10 @@@@ Cflags: -I\${includedir}
@


1.25
log
@Update to a newer snapshot of ffmpeg. Maintainer timed out.
OK jakemsr@@, landry@@
@
text
@d1 12
a12 32
$OpenBSD: patch-configure,v 1.24 2010/09/03 16:39:13 sthen Exp $
--- configure.orig	Sun Mar  6 15:03:48 2011
+++ configure	Mon Mar  7 00:29:31 2011
@@@@ -1066,6 +1066,7 @@@@ HAVE_LIST="
     setmode
     socklen_t
     soundcard_h
+    sndio_h
     poll_h
     setrlimit
     strerror_r
@@@@ -1405,6 +1406,8 @@@@ jack_indev_deps="jack_jack_h"
 libdc1394_indev_deps="libdc1394"
 oss_indev_deps_any="soundcard_h sys_soundcard_h"
 oss_outdev_deps_any="soundcard_h sys_soundcard_h"
+sndio_indev_deps="sndio_h"
+sndio_outdev_deps="sndio_h"
 v4l_indev_deps="linux_videodev_h"
 v4l2_indev_deps_any="linux_videodev2_h sys_videoio_h"
 vfwcap_indev_deps="capCreateCaptureWindow vfwcap_defines"
@@@@ -1589,6 +1592,10 @@@@ cpu="generic"
 target_os_default=$(tolower $(uname -s))
 host_os=$target_os_default
 
+if test "$target_os_default" = "openbsd"; then
+  arch_default=$(arch -s)
+fi
+
 # configurable options
 enable avcodec
 enable avdevice
@@@@ -2335,6 +2342,7 @@@@ case $target_os in
d20 20
a39 3
@@@@ -2822,7 +2830,7 @@@@ enabled libdirac   && add_cflags $(pkg-config --cflags
                       require  libdirac libdirac_decoder/dirac_parser.h dirac_decoder_init $(pkg-config --libs dirac) &&
                       require  libdirac libdirac_encoder/dirac_encoder.h dirac_encoder_init $(pkg-config --libs dirac)
d41 1
d47 1
a47 16
@@@@ -2890,11 +2898,14 @@@@ check_header dev/ic/bt8xx.h
 
 check_header sys/soundcard.h
 check_header soundcard.h
+check_header sndio.h
 
 enabled_any alsa_indev alsa_outdev && check_lib2 alsa/asoundlib.h snd_pcm_htimestamp -lasound
 
 enabled jack_indev && check_lib2 jack/jack.h jack_client_open -ljack
 
+enabled_any sndio_indev sndio_outdev && check_lib2 sndio.h sio_open -lsndio
+
 enabled x11grab                         &&
 check_header X11/Xlib.h                 &&
 check_header X11/extensions/XShm.h      &&
@@@@ -2930,9 +2941,6 @@@@ enabled extra_warnings && check_cflags -Winline
a50 1
-check_ldflags -Wl,--as-needed
d56 10
a65 1
@@@@ -3368,8 +3376,7 @@@@ Version: $version
d75 1
a75 1
@@@@ -3388,10 +3395,10 @@@@ Cflags: -I\${includedir}
d87 6
a92 6
+pkgconfig_generate libavcodec "FFmpeg codec library" "$LIBAVCODEC_VERSION" "$LIBavcodec_EXTRALIBS"
+pkgconfig_generate libavformat "FFmpeg container format library" "$LIBAVFORMAT_VERSION" "$LIBavformat_EXTRALIBS" "libavcodec = $LIBAVCODEC_VERSION"
+pkgconfig_generate libavdevice "FFmpeg device handling library" "$LIBAVDEVICE_VERSION" "$LIBavdevice_EXTRALIBS" "libavformat = $LIBAVFORMAT_VERSION"
+pkgconfig_generate libavfilter "FFmpeg video filtering library" "$LIBAVFILTER_VERSION" "$LIBavfilter_EXTRALIBS"
+pkgconfig_generate libpostproc "FFmpeg post processing library" "$LIBPOSTPROC_VERSION" "$LIBpostproc_EXTRALIBS"
+pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "$LIBswscale_EXTRALIBS" "libavutil = $LIBAVUTIL_VERSION"
@


1.24
log
@- Some clean up of the FFMpeg configure patch
- Update the sndio backend code to the newer libavdevice alsa code
which has been refactored and cleaned up a bit

From Brad (maintainer).
@
text
@d1 4
a4 12
$OpenBSD: patch-configure,v 1.23 2010/05/26 21:38:52 jakemsr Exp $
--- configure.orig	Tue May 11 19:21:00 2010
+++ configure	Thu Aug 19 21:51:04 2010
@@@@ -1064,7 +1064,6 @@@@ HAVE_LIST="
     lzo1x_999_compress
     machine_ioctl_bt848_h
     machine_ioctl_meteor_h
-    malloc_h
     memalign
     mkstemp
     pld
@@@@ -1076,6 +1075,7 @@@@ HAVE_LIST="
d12 1
a12 1
@@@@ -1396,6 +1396,8 @@@@ jack_indev_extralibs="-ljack"
d20 2
a21 2
 vfwcap_indev_deps="capCreateCaptureWindow"
@@@@ -1465,6 +1467,10 @@@@ cpu="generic"
d32 1
a32 2
@@@@ -2167,6 +2173,7 @@@@ case $target_os in
         # Thus explicitly enable PIC here.
d34 1
d40 2
a41 1
@@@@ -2605,7 +2612,7 @@@@ enabled libdirac   && add_cflags $(pkg-config --cflags
a43 1
 enabled libfaad    && require2 libfaad faad.h faacDecOpen -lfaad
d46 1
a46 1
 enabled libmp3lame && require  libmp3lame lame/lame.h lame_init -lmp3lame -lm
d48 2
a49 2
 enabled libopencore_amrnb  && require libopencore_amrnb opencore-amrnb/interf_dec.h Decoder_Interface_init -lopencore-amrnb -lm
@@@@ -2687,11 +2694,14 @@@@ check_header dev/ic/bt8xx.h
d64 1
a64 1
@@@@ -2726,9 +2736,6 @@@@ enabled extra_warnings && check_cflags -Winline
d70 1
a70 1
-check_ldflags -Wl,-Bsymbolic
d73 2
a74 2
 test_ldflags -Wl,--version-script,$TMPV &&
@@@@ -3123,8 +3130,7 @@@@ Version: $version
d84 1
a84 1
@@@@ -3143,12 +3149,12 @@@@ Cflags: -I\${includedir}
d89 1
a89 1
-pkgconfig_generate libavcodec "FFmpeg codec library" "$LIBAVCODEC_VERSION" "$extralibs" "libavutil = $LIBAVUTIL_VERSION"
d92 3
d96 6
a101 11
+pkgconfig_generate libavcodec "FFmpeg codec library" "$LIBAVCODEC_VERSION" "$LIBavcodec_EXTRALIBS" "libavutil"
+pkgconfig_generate libavformat "FFmpeg container format library" "$LIBAVFORMAT_VERSION" "$LIBavformat_EXTRALIBS" "libavcodec libavutil"
+pkgconfig_generate libavdevice "FFmpeg device handling library" "$LIBAVDEVICE_VERSION" "$LIBavdevice_EXTRALIBS" "libavcodec libavformat libavutil"
 enabled avfilter &&
-    pkgconfig_generate libavfilter "FFmpeg video filtering library" "$LIBAVFILTER_VERSION" "$extralibs" "libavutil = $LIBAVUTIL_VERSION"
+    pkgconfig_generate libavfilter "FFmpeg video filtering library" "$LIBAVFILTER_VERSION" "$LIBavfilter_EXTRALIBS" "libavcodec libavutil libswscale"
 enabled postproc &&
-    pkgconfig_generate libpostproc "FFmpeg post processing library" "$LIBPOSTPROC_VERSION"
-pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "" "libavutil = $LIBAVUTIL_VERSION"
+    pkgconfig_generate libpostproc "FFmpeg post processing library" "$LIBPOSTPROC_VERSION" "$LIBpostproc_EXTRALIBS" "libavutil"
+pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "$LIBswscale_EXTRALIBS" "libavutil"
@


1.23
log
@update to ffmpeg subversion snapshot from 2010-05-12

update needed for newer x264 and for gcc4.  this causes yet more
fallout as some libav* functions other ports were using have been
fully deprecated.  commits coming rsn ...

mostly from new MAINTAINER
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.22 2010/04/26 01:57:13 jakemsr Exp $
d3 1
a3 1
+++ configure	Sun May 16 13:19:13 2010
d20 1
a20 1
@@@@ -1396,6 +1396,10 @@@@ jack_indev_extralibs="-ljack"
a24 1
+sndio_indev_extralibs="-lsndio"
a25 1
+sndio_outdev_extralibs="-lsndio"
d29 1
a29 1
@@@@ -1465,6 +1469,10 @@@@ cpu="generic"
d40 9
a48 19
@@@@ -1489,7 +1497,7 @@@@ enable swscale
 enable swscale_alpha
 
 # build settings
-SHFLAGS='-shared -Wl,-soname,$$(@@F)'
+SHFLAGS='-shared'
 FFSERVERLDFLAGS=-Wl,-E
 LIBPREF="lib"
 LIBSUF=".a"
@@@@ -1499,7 +1507,7 @@@@ SLIBPREF="lib"
 SLIBSUF=".so"
 SLIBNAME='$(SLIBPREF)$(FULLNAME)$(SLIBSUF)'
 SLIBNAME_WITH_VERSION='$(SLIBNAME).$(LIBVERSION)'
-SLIBNAME_WITH_MAJOR='$(SLIBNAME).$(LIBMAJOR)'
+SLIBNAME_WITH_MAJOR='$(SLIBNAME).$(LIBVERSION)'
 LIB_INSTALL_EXTRA_CMD='$$(RANLIB) "$(LIBDIR)/$(LIBNAME)"'
 
 CC_O='-o $@@'
@@@@ -2605,7 +2613,7 @@@@ enabled libdirac   && add_cflags $(pkg-config --cflags
d57 1
a57 1
@@@@ -2687,11 +2695,14 @@@@ check_header dev/ic/bt8xx.h
d72 1
a72 1
@@@@ -2726,9 +2737,6 @@@@ enabled extra_warnings && check_cflags -Winline
d82 1
a82 1
@@@@ -3123,8 +3131,7 @@@@ Version: $version
d92 1
a92 1
@@@@ -3143,12 +3150,12 @@@@ Cflags: -I\${includedir}
@


1.22
log
@sndio for audio recording.
NOTE: the audio recording muxer is still named 'oss' for compatability.
@
text
@d1 13
a13 6
$OpenBSD: patch-configure,v 1.21 2008/09/08 23:28:28 brad Exp $
--- configure.orig	Fri Jun 20 19:40:11 2008
+++ configure	Wed Apr 21 05:04:39 2010
@@@@ -766,12 +766,11 @@@@ HAVE_LIST="
     sdl
     sdl_video_size
d15 1
a15 1
-    soundcard_h
d18 16
a33 28
     sys_mman_h
     sys_resource_h
     sys_select_h
-    sys_soundcard_h
     termios_h
     threads
     winsock2_h
@@@@ -877,14 +876,14 @@@@ libdc1394_demuxer_deps="libdc1394"
 libnut_demuxer_deps="libnut"
 libnut_muxer_deps="libnut"
 mp3_demuxer_deps="mpegaudio_parser"
-oss_demuxer_deps_any="soundcard_h sys_soundcard_h"
-oss_muxer_deps_any="soundcard_h sys_soundcard_h"
+oss_demuxer_deps_any="sndio_h"
+oss_muxer_deps_any="sndio_h"
 redir_demuxer_deps="network"
 rtp_muxer_deps="network rtp_protocol"
 rtsp_demuxer_deps="sdp_demuxer"
 sdp_demuxer_deps="rtp_protocol mpegts_demuxer"
 v4l_demuxer_deps="linux_videodev_h"
-v4l2_demuxer_deps="linux_videodev2_h"
+v4l2_demuxer_deps="sys_videoio_h"
 vfwcap_demuxer_deps="capCreateCaptureWindow"
 vfwcap_demuxer_extralibs="-lvfw32"
 x11_grab_device_demuxer_deps="x11grab XShmCreateImage"
@@@@ -934,6 +933,10 @@@@ cpu="generic"
 # OS
 target_os=$(tolower $(uname -s))
d35 2
a36 2
+if test $target_os = openbsd; then
+  arch=`arch -s`
d39 5
a43 5
 # libraries
 enable bzlib
 enable zlib
@@@@ -953,9 +956,9 @@@@ enable stripping
 vhook="default"
a47 3
 VHOOKSHFLAGS='$(SHFLAGS)'
-LDLATEFLAGS='-Wl,-rpath-link,\$(BUILD_ROOT)/libpostproc -Wl,-rpath-link,\$(BUILD_ROOT)/libswscale -Wl,-rpath-link,\$(BUILD_ROOT)/libavfilter -Wl,-rpath-link,\$(BUILD_ROOT)/libavdevice -Wl,-rpath-link,\$(BUILD_ROOT)/libavformat -Wl,-rpath-link,\$(BUILD_ROOT)/libavcodec -Wl,-rpath-link,\$(BUILD_ROOT)/libavutil'
+LDLATEFLAGS=''
d51 1
a51 1
@@@@ -965,7 +968,7 @@@@ SLIBPREF="lib"
d57 1
a57 1
 LIB_INSTALL_EXTRA_CMD='$(RANLIB) "$(LIBDIR)/$(LIBNAME)"'
d59 11
a69 51
 # gcc stupidly only outputs the basename of targets with -MM
@@@@ -1130,7 +1133,7 @@@@ EOF
         arch="powerpc"
         enable fast_64bit
     ;;
-    mips|mipsel|IP*)
+    mips|mipsel|mips64|IP*)
         arch="mips"
     ;;
     sun4u|sparc64)
@@@@ -1140,13 +1143,13 @@@@ EOF
     sparc)
         arch="sparc"
     ;;
-    sh4)
+    sh4|sh)
         arch="sh4"
     ;;
-    parisc)
+    parisc|hppa)
         arch="parisc"
     ;;
-    parisc64)
+    parisc64|hppa64)
         arch="parisc"
         enable fast_64bit
     ;;
@@@@ -1213,11 +1216,11 @@@@ case $target_os in
         disable need_memalign
         LIBOBJFLAGS='$(PIC)'
         SHFLAGS='-shared'
-        SLIBNAME='$(SLIBPREF)$(FULLNAME)$(SLIBSUF).$(LIBVERSION)'
-        SLIBNAME_WITH_VERSION='$(SLIBNAME)'
-        SLIBNAME_WITH_MAJOR='$(SLIBNAME)'
-        oss_demuxer_extralibs="-lossaudio"
-        oss_muxer_extralibs="-lossaudio"
+        #SLIBNAME='$(SLIBPREF)$(FULLNAME)$(SLIBSUF).$(LIBVERSION)'
+        #SLIBNAME_WITH_VERSION='$(SLIBNAME)'
+        #SLIBNAME_WITH_MAJOR='$(SLIBNAME)'
+        oss_demuxer_extralibs="-lsndio"
+        oss_muxer_extralibs="-lsndio"
         ;;
     freebsd)
         disable need_memalign
@@@@ -1501,7 +1504,7 @@@@ fi
 check_cc <<EOF || die "Symbol mangling check failed."
 int ff_extern;
 EOF
-sym=$($nm -P -g $TMPO | grep ff_extern)
+sym=$($nm -g $TMPO | grep ff_extern | cut -d ' ' -f 3)
 extern_prefix=${sym%%ff_extern*}
d71 3
a73 2
 check_asm inline_asm '""'
@@@@ -1531,16 +1534,16 @@@@ fi
d75 1
a75 1
 # check for assembler specific support
d77 1
a77 20
-if test $arch = "powerpc"; then
-check_cc <<EOF && enable dcbzl
-int main(void) {
-    register long zero = 0;
-    char data[1024];
-    asm volatile("dcbzl %0, %1" : : "b" (data), "r" (zero));
-return 0;
-}
-EOF
-fi
+#if test $arch = "powerpc"; then
+#check_cc <<EOF && enable dcbzl
+#int main(void) {
+#    register long zero = 0;
+#    char data[1024];
+#    asm volatile("dcbzl %0, %1" : : "b" (data), "r" (zero));
+#return 0;
+#}
+#EOF
+#fi
d79 6
a84 45
 # check for SIMD availability
 
@@@@ -1582,10 +1585,14 @@@@ enabled vis && add_cflags "-mcpu=ultrasparc -mtune=ult
 
 # ---
 # big/little-endian test
-check_cc <<EOF || die "endian test failed"
-unsigned int endian = 'B' << 24 | 'I' << 16 | 'G' << 8 | 'E';
+check_exec <<EOF || enable bigendian
+#include <sys/types.h>
+int main(void) {
+	if (_BYTE_ORDER == _BIG_ENDIAN)
+		return 1;
+	return 0;
+}
 EOF
-od -A n -t x1 $TMPO | grep -q '42 *49 *47 *45' && enable bigendian
 
 # ---
 # check availability of some header files
@@@@ -1607,7 +1614,7 @@@@ check_func2 windows.h GetProcessTimes
 check_header byteswap.h
 check_header conio.h
 check_header dlfcn.h
-check_header malloc.h
+#check_header malloc.h
 check_header sys/mman.h
 check_header sys/resource.h
 check_header termios.h
@@@@ -1717,10 +1724,10 @@@@ if test "$target_os" = cygwin -o "$target_os" = mingw3
     echo
 fi
 
-if enabled vhook; then
-    check_ldflags -rdynamic
-    check_ldflags -export-dynamic
-fi
+#if enabled vhook; then
+#    check_ldflags -rdynamic
+#    check_ldflags -export-dynamic
+#fi
 
 check_foo_config imlib2 imlib2 Imlib2.h imlib_load_font
 check_foo_config freetype2 freetype ft2build.h FT_Init_FreeType
@@@@ -1756,7 +1763,7 @@@@ fi
a85 26
 texi2html -version > /dev/null 2>&1 && enable texi2html || disable texi2html
 
-check_type sys/socket.h socklen_t
+check_type sys/types.h socklen_t
 
 ##########################################
 # Network check
@@@@ -1791,6 +1798,7 @@@@ EOF
 
 check_header linux/videodev.h
 check_header linux/videodev2.h
+check_header sys/videoio.h
 
 check_func2 "windows.h vfw.h" capCreateCaptureWindow -lvfw32
 
@@@@ -1803,8 +1811,7 @@@@ check_func2 "windows.h vfw.h" capCreateCaptureWindow -
   check_header dev/video/bktr/ioctl_bt848.h; } ||
 check_header dev/ic/bt8xx.h
 
-check_header sys/soundcard.h
-check_header soundcard.h
+check_header sndio.h
 
 # deal with the X11 frame grabber
 enabled x11grab                         &&
@@@@ -1831,7 +1838,7 @@@@ enabled extra_warnings && check_cflags -Winline
d88 2
a89 1
 check_ldflags $LDLATEFLAGS
a90 1
+# check_ldflags -Wl,-Bsymbolic
d92 4
a95 4
 if enabled small; then
     check_cflags -Os            # not all compilers support -Os
@@@@ -2204,8 +2211,7 @@@@ Version: $version
 Requires: $(disabled shared && echo $requires)
d98 1
a98 1
-Libs: -L\${libdir} -l${shortname} $(disabled shared && echo $libs)
d104 1
a104 1
@@@@ -2224,17 +2230,17 @@@@ Cflags: -I\${includedir}
d109 3
a111 3
-pkgconfig_generate libavcodec "FFmpeg codec library" "$LIBAVCODEC_VERSION" "$extralibs" "$pkg_requires libavutil = $LIBAVUTIL_VERSION"
-pkgconfig_generate libavformat "FFmpeg container format library" "$LIBAVFORMAT_VERSION" "$extralibs" "$pkg_requires libavcodec = $LIBAVCODEC_VERSION"
-pkgconfig_generate libavdevice "FFmpeg device handling library" "$LIBAVDEVICE_VERSION" "$extralibs" "$pkg_requires libavformat = $LIBAVFORMAT_VERSION"
d114 2
a115 2
+pkgconfig_generate libavformat "FFmpeg container format library" "$LIBAVFORMAT_VERSION" "$LIBavformat_EXTRALIBS" "libavutil libavcodec"
+pkgconfig_generate libavdevice "FFmpeg device handling library" "$LIBAVDEVICE_VERSION" "$LIBavdevice_EXTRALIBS" "libavutil libavformat"
d117 2
a118 1
     pkgconfig_generate libavfilter "FFmpeg video filtering library" "$LIBAVFILTER_VERSION" "$extralibs" "$pkg_requires libavutil = $LIBAVUTIL_VERSION"
d121 1
d123 1
a123 8
 if enabled swscale; then
-    pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "" "libavutil = $LIBAVUTIL_VERSION"
+    pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "$LIBswscale_EXTRALIBS" "libavutil"
 else
-    pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "" "$pkg_requires libavcodec = $LIBAVCODEC_VERSION"
+    pkgconfig_generate libswscale "FFmpeg image rescaling library" "$LIBSWSCALE_VERSION" "$LIBswscale_EXTRALIBS"
     apply libswscale/libswscale.pc sed s/^Libs:.*$/Libs:/
 fi
@


1.21
log
@Enable the V4L2 input support.

ok jakemsr@@
@
text
@d1 27
a27 4
$OpenBSD: patch-configure,v 1.20 2008/09/05 01:10:21 brad Exp $
--- configure.orig	Fri Jun 20 22:40:11 2008
+++ configure	Sun Sep  7 00:17:23 2008
@@@@ -884,7 +884,7 @@@@ rtp_muxer_deps="network rtp_protocol"
d36 1
a36 1
@@@@ -934,6 +934,10 @@@@ cpu="generic"
d47 1
a47 1
@@@@ -953,9 +957,9 @@@@ enable stripping
d59 1
a59 1
@@@@ -965,7 +969,7 @@@@ SLIBPREF="lib"
d68 1
a68 1
@@@@ -1130,7 +1134,7 @@@@ EOF
d77 1
a77 1
@@@@ -1140,13 +1144,13 @@@@ EOF
d94 1
a94 1
@@@@ -1213,9 +1217,9 @@@@ case $target_os in
d101 2
d106 2
a107 2
         oss_demuxer_extralibs="-lossaudio"
         oss_muxer_extralibs="-lossaudio"
d109 3
a111 1
@@@@ -1501,7 +1505,7 @@@@ fi
d120 1
a120 1
@@@@ -1531,16 +1535,16 @@@@ fi
d147 1
a147 1
@@@@ -1582,10 +1586,14 @@@@ enabled vis && add_cflags "-mcpu=ultrasparc -mtune=ult
d165 1
a165 1
@@@@ -1607,7 +1615,7 @@@@ check_func2 windows.h GetProcessTimes
d174 1
a174 1
@@@@ -1717,10 +1725,10 @@@@ if test "$target_os" = cygwin -o "$target_os" = mingw3
d189 1
a189 1
@@@@ -1756,7 +1764,7 @@@@ fi
d198 1
a198 1
@@@@ -1791,6 +1799,7 @@@@ EOF
d206 11
a216 1
@@@@ -1831,7 +1840,7 @@@@ enabled extra_warnings && check_cflags -Winline
d225 1
a225 1
@@@@ -2204,8 +2213,7 @@@@ Version: $version
d235 1
a235 1
@@@@ -2224,17 +2232,17 @@@@ Cflags: -I\${includedir}
@


1.20
log
@Fix FFmpeg's configure script so it can retreive and understand the
hardware architecture instead of the machine port. Also add support
for detecting the presence of AltiVec at run-time using the
machdep.altivec sysctl.

At the moment AltiVec is disabled but this at least allows the
configure script to build in the support if --disable-altivec is
removed. Facilitates further testing and debugging.

ok kili@@ jakemsr@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.19 2008/07/09 01:57:44 jakemsr Exp $
d3 10
a12 1
+++ configure	Thu Aug 14 23:43:26 2008
d171 9
a179 1
@@@@ -1831,7 +1839,7 @@@@ enabled extra_warnings && check_cflags -Winline
d188 1
a188 1
@@@@ -2204,8 +2212,7 @@@@ Version: $version
d198 1
a198 1
@@@@ -2224,17 +2231,17 @@@@ Cflags: -I\${includedir}
@


1.19
log
@
update to subversion snapshot from 2008-06-20.

added since last update:

- AVM2 (Flash 9) SWF muxer
- QT variant of IMA ADPCM encoder
- VFW grabber
- Ipod/Iphone compatible mp4 muxer
- Mimic decoder
- MSN TCP Webcam stream demuxer
- RL2 demuxer / decoder
- IFF demuxer
- 8SVX audio decoder
- BFI demuxer
- MAXIS EA XA (.xa) demuxer / decoder
- BFI video decoder
- OMA demuxer

also:
* headers have been moved to library specific subdirectories instead
  of all under ffmpeg.
* libswscale is now enabled in the build.


feedback/ok brad@@
@
text
@d1 15
a15 4
$OpenBSD: patch-configure,v 1.18 2008/01/26 01:56:02 jakemsr Exp $
--- configure.orig	Fri Jun 20 19:40:11 2008
+++ configure	Sat Jul  5 03:08:34 2008
@@@@ -953,9 +953,9 @@@@ enable stripping
d27 1
a27 1
@@@@ -965,7 +965,7 @@@@ SLIBPREF="lib"
d36 27
a62 1
@@@@ -1213,9 +1213,9 @@@@ case $target_os in
d75 1
a75 1
@@@@ -1501,7 +1501,7 @@@@ fi
d84 28
a111 1
@@@@ -1582,10 +1582,14 @@@@ enabled vis && add_cflags "-mcpu=ultrasparc -mtune=ult
d129 1
a129 1
@@@@ -1607,7 +1611,7 @@@@ check_func2 windows.h GetProcessTimes
d138 1
a138 1
@@@@ -1717,10 +1721,10 @@@@ if test "$target_os" = cygwin -o "$target_os" = mingw3
d153 1
a153 1
@@@@ -1756,7 +1760,7 @@@@ fi
d162 1
a162 1
@@@@ -1831,7 +1835,7 @@@@ enabled extra_warnings && check_cflags -Winline
d171 1
a171 1
@@@@ -2204,8 +2208,7 @@@@ Version: $version
d181 1
a181 1
@@@@ -2224,17 +2227,17 @@@@ Cflags: -I\${includedir}
@


1.18
log
@update to 20080118

relevent Changelog entries:

+- Monkey's Audio demuxer and decoder
+- additional SPARC (VIS) optimizations
+- AMV audio and video decoder
+- DNxHD encoder
+- H.264 PAFF decoding
+- Nellymoser ASAO decoder
+- Beam Software SIFF demuxer and decoder
+- libvorbis Vorbis decoding removed in favor of native decoder
+- IntraX8 (J-Frame) subdecoder for WMV2 and VC-1
+- Ogg muxer
+- PC Paintbrush PCX decoder
+- Sun Rasterfile decoder
+- TechnoTrend PVA demuxer
+- Linux Media Labs MPEG-4 (LMLM4) demuxer

port changes:

disable ff_fdct_sse2 usage on i386 and libpostproc's
temporal noise reduction filter, since they both regularly
cause segfaults.

ok deanna@@, brad@@

tested by a few others, thanks
@
text
@d1 98
a98 4
$OpenBSD: patch-configure,v 1.17 2007/10/19 14:32:57 jakemsr Exp $
--- configure.orig	Fri Jan 18 01:21:47 2008
+++ configure	Sun Jan 20 00:36:03 2008
@@@@ -1785,7 +1785,7 @@@@ enabled extra_warnings && check_cflags -Winline
d107 11
a117 1
@@@@ -2158,28 +2158,28 @@@@ Cflags: -I\${includedir}
d121 16
a136 28
-pkgconfig_generate libavutil "FFmpeg utility library" "$lavu_version" -lavutil "" ffmpeg
+pkgconfig_generate libavutil "FFmpeg utility library" "$lavu_version" "-lavutil $LIBavutil_EXTRALIBS" "" ffmpeg
 pkgconfig_generate_uninstalled libavutil "FFmpeg utility library" "$lavu_version"
 
-pkgconfig_generate libavcodec "FFmpeg codec library" "$lavc_version" "-lavcodec $extralibs" "$pkg_requires libavutil = $lavu_version" ffmpeg
-pkgconfig_generate_uninstalled libavcodec "FFmpeg codec library" "$lavc_version" "$extralibs" "$pkg_requires libavutil = $lavu_version"
+pkgconfig_generate libavcodec "FFmpeg codec library" "$lavc_version" "-lavcodec $LIBavcodec_EXTRALIBS" "libavutil = $lavu_version" ffmpeg
+pkgconfig_generate_uninstalled libavcodec "FFmpeg codec library" "$lavc_version" "-pthread"
 
-pkgconfig_generate libavformat "FFmpeg container format library" "$lavf_version" "-lavformat $extralibs" "$pkg_requires libavcodec = $lavc_version" ffmpeg
-pkgconfig_generate_uninstalled libavformat "FFmpeg container format library" "$lavf_version" "$extralibs" "$pkg_requires libavcodec = $lavc_version"
+pkgconfig_generate libavformat "FFmpeg container format library" "$lavf_version" "-lavformat $LIBavformat_EXTRALIBS" "libavutil = $lavu_version libavcodec = $lavc_version" ffmpeg
+pkgconfig_generate_uninstalled libavformat "FFmpeg container format library" "$lavf_version"
 
-pkgconfig_generate libavdevice "FFmpeg device handling library" "$lavd_version" "-lavdevice $extralibs" "$pkg_requires libavformat = $lavf_version" ffmpeg
-pkgconfig_generate_uninstalled libavdevice "FFmpeg device handling library" "$lavd_version" "$extralibs" "$pkg_requires libavformat = $lavf_version"
+pkgconfig_generate libavdevice "FFmpeg device handling library" "$lavd_version" "-lavdevice $LIBavdevice_EXTRALIBS" "libavutil = $lavu_version libavformat = $lavf_version" ffmpeg
+pkgconfig_generate_uninstalled libavdevice "FFmpeg device handling library" "$lavd_version"
 if enabled pp; then
-    pkgconfig_generate libpostproc "FFmpeg post processing library" "$pp_version" -lpostproc "" postproc
+    pkgconfig_generate libpostproc "FFmpeg post processing library" "$pp_version" "-lpostproc $LIBpostproc_EXTRALIBS" "libavutil = $lavu_version " postproc
     pkgconfig_generate_uninstalled libpostproc "FFmpeg post processing library" "$pp_version"
 fi
 
 if enabled swscaler; then
     pkgconfig_generate libswscale "FFmpeg image rescaling library" "$sws_version" -lswscale "libavutil = $lavu_version" ffmpeg
-    pkgconfig_generate_uninstalled libswscale "FFmpeg image rescaling library" "$sws_version" "" "libavutil = $lavu_version"
+    pkgconfig_generate_uninstalled libswscale "FFmpeg image rescaling library" "$sws_version"
d138 3
a140 6
-    pkgconfig_generate libswscale "FFmpeg image rescaling library" "$sws_version" "" "$pkg_requires libavcodec = $lavc_version" ffmpeg
-    pkgconfig_generate_uninstalled libswscale "FFmpeg image rescaling library" "$sws_version" "" "$pkg_requires libavcodec = $lavc_version"
+    pkgconfig_generate libswscale "FFmpeg image rescaling library" "$sws_version" "" "libavcodec = $lavc_version" ffmpeg
+    pkgconfig_generate_uninstalled libswscale "FFmpeg image rescaling library" "$sws_version"
     apply libswscale.pc sed s/^Libs:.*$/Libs:/
     apply libswscale-uninstalled.pc sed s/^Libs:.*$/Libs:/
@


1.17
log
@- provide complete pkg-config information, instead of relying
  on inter-library dependency magic
- libavcodec needs libvorbis which needs libogg, so add ogg
  to libavcodec's dependency libs
- as of the previous commit, libavformat depends on libX11 and
  libXext, add them as dependency libs
- add RPATH info when linking libavcodec and libavformat, so
  applications that dlopen() libavcodec or libavformat have a
  better chance of finding dependency libs

fixes multimedia/ffmpeg2theora build problem noticed by sturm@@
@
text
@d1 13
a13 4
$OpenBSD: patch-configure,v 1.16 2007/09/24 07:51:24 jakemsr Exp $
--- configure.orig	Mon Sep 10 19:18:12 2007
+++ configure	Fri Oct 19 03:02:40 2007
@@@@ -2076,26 +2076,26 @@@@ Cflags: -I\${includedir}
d23 2
a24 2
+pkgconfig_generate libavcodec "FFmpeg codec library" "$lavc_version" "-lavcodec $LIBavcodec_EXTRALIBS" "libavutil = $lavu_version $LIBavcodec_REQUIRES" ffmpeg
+pkgconfig_generate_uninstalled libavcodec "FFmpeg codec library" "$lavc_version" "-pthread" ""
d28 2
a29 2
+pkgconfig_generate libavformat "FFmpeg container format library" "$lavf_version" "-lavformat $LIBavformat_EXTRALIBS" "libavcodec = $lavc_version $LIBavformat_REQUIRES" ffmpeg
+pkgconfig_generate_uninstalled libavformat "FFmpeg container format library" "$lavf_version" "" ""
d31 4
d36 3
a38 3
-  pkgconfig_generate libpostproc "FFmpeg post processing library" "$pp_version" -lpostproc "" postproc
+  pkgconfig_generate libpostproc "FFmpeg post processing library" "$pp_version" "-lpostproc $LIBpostproc_EXTRALIBS" "" postproc
   pkgconfig_generate_uninstalled libpostproc "FFmpeg post processing library" "$pp_version"
d42 3
a44 4
-  pkgconfig_generate libswscale "FFmpeg image rescaling library" "$sws_version" -lswscale "libavutil = $lavu_version" ffmpeg
-  pkgconfig_generate_uninstalled libswscale "FFmpeg image rescaling library" "$sws_version" "" "libavutil = $lavu_version"
+  pkgconfig_generate libswscale "FFmpeg image rescaling library" "$sws_version" "-lswscale $LIBswscale_EXTRALIBS" "libavutil = $lavu_version" ffmpeg
+  pkgconfig_generate_uninstalled libswscale "FFmpeg image rescaling library" "$sws_version" "" ""
d46 6
a51 6
-  pkgconfig_generate libswscale "FFmpeg image rescaling library" "$sws_version" "" "$pkg_requires libavcodec = $lavc_version" ffmpeg
-  pkgconfig_generate_uninstalled libswscale "FFmpeg image rescaling library" "$sws_version" "" "$pkg_requires libavcodec = $lavc_version"
+  pkgconfig_generate libswscale "FFmpeg image rescaling library" "$sws_version" "" "" ffmpeg
+  pkgconfig_generate_uninstalled libswscale "FFmpeg image rescaling library" "$sws_version" "" ""
   apply libswscale.pc sed s/^Libs:.*$/Libs:/
   apply libswscale-uninstalled.pc sed s/^Libs:.*$/Libs:/
@


1.16
log
@update to snapshot from 2007-09-10

additions/changes in this update:

- RoQ muxer, audio encoder
- Renderware TXD demuxer and decoder
- extern C declarations for C++ removed from headers
- sws_flags command line option
- codebook generator
- RoQ video encoder
- QTRLE encoder
- OS/2 support removed
- AC-3 decoder
- NUT muxer (since r10052)
- Matroska muxer
- Slice-based parallel H.264 decoding

plus lots of bugfixes

prodding/testing/ok brad@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.15 2007/05/25 15:54:14 jakemsr Exp $
d3 7
a9 3
+++ configure	Mon Sep 10 19:52:11 2007
@@@@ -2079,11 +2079,11 @@@@ EOF
 pkgconfig_generate libavutil "FFmpeg utility library" "$lavu_version" -lavutil "" ffmpeg
d14 1
a14 1
+pkgconfig_generate libavcodec "FFmpeg codec library" "$lavc_version" "-lavcodec -pthread" "" ffmpeg
d19 1
a19 1
+pkgconfig_generate libavformat "FFmpeg container format library" "$lavf_version" -lavformat "" ffmpeg
d23 3
a25 2
   pkgconfig_generate libpostproc "FFmpeg post processing library" "$pp_version" -lpostproc "" postproc
@@@@ -2091,11 +2091,11 @@@@ if enabled pp; then
d31 1
a31 1
+  pkgconfig_generate libswscale "FFmpeg image rescaling library" "$sws_version" -lswscale "" ffmpeg
@


1.15
log
@update to SVN snapshot from 20070501

several new codecs added, including an WMA encoder, Theora
encoding via libtheora, and H.264 encoding via x264

with feedback from brad@@, jolan@@, naddy@@ and Nikns Sainkin
<nikns at secure dot lv>

OK jolan@@
@
text
@d1 4
a4 4
$OpenBSD$
--- configure.orig	Tue May  1 13:26:05 2007
+++ configure	Wed May  2 23:46:49 2007
@@@@ -2126,11 +2126,11 @@@@ EOF
d20 1
a20 1
@@@@ -2138,11 +2138,11 @@@@ if enabled pp; then
@


1.14
log
@- update to version 20070110 (cvs snapshot)
- Nikns Siankin <nikns@@secure.lv> takes mainteinership
- add support for several external codecs
- fix regress target
- and many more

from Nikns Siankin <nikns@@secure.lv>
@
text
@d1 20
a20 28
$OpenBSD: patch-configure,v 1.13 2006/03/20 05:50:49 jakemsr Exp $
--- configure.orig	Tue Feb 28 00:11:44 2006
+++ configure	Tue Feb 28 00:15:42 2006
@@@@ -243,7 +243,7 @@@@ LIBSUF=".a"
 LIB='$(LIBPREF)$(NAME)$(LIBSUF)'
 SLIBPREF="lib"
 SLIBSUF=".so"
-SLIBNAME='$(SLIBPREF)$(NAME)$(SLIBSUF)'
+SLIBNAME='$(SLIBPREF)$(NAME)$(SLIBSUF).$(LIBVERSION)'
 SLIBNAME_WITH_VERSION='$(SLIBPREF)$(NAME)$(SLIBSUF).$(LIBVERSION)'
 SLIBNAME_WITH_MAJOR='$(SLIBPREF)$(NAME)$(SLIBSUF).$(LIBMAJOR)'
 EXESUF=""
@@@@ -324,10 +324,11 @@@@ bktr="yes"
 audio_oss="yes"
 dv1394="no"
 make="gmake"
+SHFLAGS='-shared'
 LIBOBJFLAGS="\$(PIC)"
-LDFLAGS="$LDFLAGS -export-dynamic -pthread"
+LDFLAGS="$LDFLAGS -export-dynamic"
 LDCONFIG="ldconfig -m \$(libdir)"
-extralibs="$extralibs -lossaudio"
+extralibs=""
 ;;
 FreeBSD)
 v4l="no"
@@@@ -1015,10 +1016,12 @@@@ EOF
 $cc -o $TMPE $TMPC 2> /dev/null || _memalign=no
d23 12
a34 4
+if false ; then
 if test "$_memalign" = "no" -a "$mmx" = "yes" -a "$memalignhack" != "yes"; then
     echo "Error, no memalign() but SSE enabled, disable it or use --enable-memalign-hack."
     exit 1
a35 59
+fi
 
 cat > $TMPC << EOF
 #include <time.h>
@@@@ -1046,7 +1049,8 @@@@ $cc $CFLAGS $LDFLAGS -o $TMPE $TMPC -lz 
 # XXX: more tests needed - runtime test
 fi
 if test "$zlib" = "yes"; then
-extralibs="$extralibs -lz"
+# extralibs="$extralibs -lz"
+ :
 fi
 
 if test "$lzo" = "yes" -a "$gpl" = "yes"; then
@@@@ -1074,7 +1078,7 @@@@ int main( void ) { return (lrintf(3.999f
 EOF
 
 have_lrintf="no"
-if $cc $CFLAGS $LDFLAGS $extralibs -o $TMPE $TMPC 2> /dev/null ; then
+if $cc $CFLAGS $LDFLAGS -lm -o $TMPE $TMPC 2> /dev/null ; then
   have_lrintf="yes"
   # allanc@@chickenandporn.com: cannot execute cross-compiled
   # code on the host.  Only execute if not cross-compiling.
@@@@ -1963,7 +1967,7 @@@@ Description: FFmpeg utility library
 Version: $lavu_version
 Requires:
 Conflicts:
-Libs: -L\${libdir} -lavutil
+Libs: -L\${libdir} -lavutil -lm
 Cflags: -I\${includedir} -I\${includedir}/ffmpeg
 EOF
 
@@@@ -1994,7 +1998,7 @@@@ Description: FFmpeg codec library
 Version: $lavc_version
 Requires: $pkg_requires libavutil = $lavu_version
 Conflicts:
-Libs: -L\${libdir} -lavcodec $extralibs
+Libs: -L\${libdir} -lavcodec -lavutil -lm -lz -pthread
 Cflags: -I\${includedir} -I\${includedir}/ffmpeg
 EOF
 
@@@@ -2009,7 +2013,7 @@@@ Description: FFmpeg codec library
 Version: $lavc_version
 Requires: $pkg_requires libavutil = $lavu_version
 Conflicts:
-Libs: \${libdir}/${LIBPREF}avcodec${LIBSUF} $extralibs
+Libs: \${libdir}/${LIBPREF}avcodec${LIBSUF} ${extralibs}
 Cflags: -I\${includedir}
 EOF
 
@@@@ -2025,7 +2029,7 @@@@ Description: FFmpeg container format lib
 Version: $lavf_version
 Requires: $pkg_requires libavcodec = $lavc_version
 Conflicts:
-Libs: -L\${libdir} -lavformat $extralibs
+Libs: -L\${libdir} -lavformat -lavutil -lossaudio -lavcodec -lm -lz -pthread
 Cflags: -I\${includedir} -I\${includedir}/ffmpeg
 EOF
 
@


1.13
log
@update to CVS as of 3/12/06.

relevant portion of the official ChangeLog:

- Fraps FPS1 video decoder
- Snow video encoder/decoder
- Sonic audio encoder/decoder
- Vorbis audio decoder
- Macromedia ADPCM decoder
- Duck TrueMotion 2 video decoder
- support for decoding FLX and DTA extensions in FLIC files
- H.264 custom quantization matrices support
- ffserver fixed, it should now be usable again
- QDM2 audio decoder
- Real Cooker audio decoder
- TrueSpeech audio decoder
- WMA2 audio decoder fixed, now all files should play correctly
- RealAudio 14.4 and 28.8 decoders fixed
- JPEG-LS encoder and decoder
- CamStudio video decoder
- build system improvements
- tabs and trailing whitespace removed from the codebase
- AIFF/AIFF-C audio format, encoding and decoding
- ADTS AAC file reading and writing
- Creative VOC file reading and writing
- American Laser Games multimedia (*.mm) playback system
- Zip Blocks Motion Video decoder
- Improved Theora/VP3 decoder
- True Audio (TTA) decoder
- AVS demuxer and video decoder

also, bktr(4) support has been integrated upstream, and most of the
source patches in the port are no longer necessary.

OK brad@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.12
log
@Update to 20050413; from Jacob Meuser <jakemsr@@jakemsr.com>.
Lots of bug fixes.
@
text
@d1 23
a23 17
$OpenBSD: patch-configure,v 1.11 2005/04/11 14:58:00 naddy Exp $
--- configure.orig	Sat Apr  9 08:32:58 2005
+++ configure	Wed Apr 13 00:18:10 2005
@@@@ -111,8 +111,8 @@@@ case "$cpu" in
   i386|i486|i586|i686|i86pc|BePC)
     cpu="x86"
   ;;
-  x86_64)
-    if [ "`$cc -dumpmachine | grep x86_64 | cut -d- -f1`" = "x86_64" -a \
+  amd64|x86_64)
+    if [ "`$cc -dumpmachine | grep amd64 | cut -d- -f1`" = "amd64" -a \
          -z "`echo $CFLAGS | grep -- -m32`"  ]; then
       cpu="x86_64"
     else
@@@@ -266,6 +266,12 @@@@ make="gmake"
 CFLAGS="-pthread"
 LDFLAGS="$LDFLAGS -export-dynamic -pthread"
d25 1
a25 7
+OpenBSD)
+strip="echo"
+extralibs="$extralibs -lossaudio -pthread"
+source_path="`echo $0 | sed -e 's#/configure##'`"
+SLIBSUF=".so.$SV"
+;;
 BSD/OS)
d27 1
a27 2
 audio_oss="yes"
@@@@ -832,10 +838,10 @@@@ EOF
d31 6
a36 8
-if test "$_memalign" = "no" -a "$mmx" = "yes" -a "$memalignhack" != "yes"; then
-    echo "error, no memalign() but sse enabled, either disable it or use --enable-memalign-hack"
-    exit 1
-fi
+#if test "$_memalign" = "no" -a "$mmx" = "yes" -a "$memalignhack" != "yes"; then
+#    echo "error, no memalign() but sse enabled, either disable it or use --enable-memalign-hack"
+#    exit 1
+#fi
d40 2
a41 7
@@@@ -1274,9 +1280,6 @@@@ if test "$pthreads" = "yes" ; then
   echo "HAVE_PTHREADS=yes" >> config.mak
   echo "#define HAVE_PTHREADS 1" >> $TMPH
   echo "#define HAVE_THREADS 1" >> $TMPH
-  if test $targetos != FreeBSD; then
-     extralibs="$extralibs -lpthread"
-  fi
d43 52
a94 2
 if test "$sdl" = "yes" ; then
   echo "CONFIG_SDL=yes" >> config.mak
@


1.11
log
@fix fallout from amd64 canonicalization; from Jacob Meuser <jakemsr@@jakemsr.com>
@
text
@d1 4
a4 4
$OpenBSD: patch-configure,v 1.10 2005/02/10 19:59:08 naddy Exp $
--- configure.orig	Fri Jan 21 14:16:04 2005
+++ configure	Tue Apr  5 11:30:14 2005
@@@@ -107,8 +107,8 @@@@ case "$cpu" in
d15 1
a15 1
@@@@ -248,6 +248,12 @@@@ make="gmake"
d23 1
a23 1
+SLIBSUF=.so.5.0
d28 1
a28 1
@@@@ -785,10 +791,10 @@@@ EOF
d43 1
a43 1
@@@@ -1219,9 +1225,6 @@@@ if test "$pthreads" = "yes" ; then
@


1.10
log
@Fix build on i386 and properly recognize amd64.
From: Jacob Meuser <jakemsr@@jakemsr.com>
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.9 2005/02/09 23:41:42 naddy Exp $
d3 2
a4 2
+++ configure	Wed Feb  9 22:53:37 2005
@@@@ -107,7 +107,7 @@@@ case "$cpu" in
d9 1
d11 1
a11 1
     if [ "`$cc -dumpmachine | grep x86_64 | cut -d- -f1`" = "x86_64" -a \
d14 1
@


1.9
log
@- update ffmpeg to snapshot 20050130
- remove inter-library dependencies
- chase fallout in dependent ports

From: Jacob Meuser <jakemsr@@jakemsr.com>
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.8 2004/10/13 01:38:21 jolan Exp $
d3 10
a12 1
+++ configure	Tue Feb  8 17:03:22 2005
d26 15
@


1.8
log
@build & install documentation, enable threads support, tweaks

from new maintainer Jacob Meuser
@
text
@d1 4
a4 4
$OpenBSD: patch-configure,v 1.6 2004/04/18 00:36:22 jolan Exp $
--- configure.orig	Mon Jul  5 11:06:16 2004
+++ configure	Fri Oct  8 17:42:35 2004
@@@@ -232,6 +232,12 @@@@ make="gmake"
d10 1
a10 1
+extralibs="$extralibs -lossaudio"
d12 1
a12 1
+SLIBSUF=.so`grep '#define FFMPEG_VERSION ' $source_path/libavcodec/avcodec.h | cut -d '"' -f 2 | cut -d '0' -f 2 | cut -d '-' -f 1`
d17 1
a17 14
@@@@ -347,9 +353,9 @@@@ for opt do
   ;;
   --make=*) make=`echo $opt | cut -d '=' -f 2`
   ;;
-  --extra-cflags=*) CFLAGS="${opt#--extra-cflags=}"
+  --extra-cflags=*) CFLAGS="$CFLAGS ${opt#--extra-cflags=}"
   ;;
-  --extra-ldflags=*) LDFLAGS=${opt#--extra-ldflags=}
+  --extra-ldflags=*) LDFLAGS="$LDFLAGS ${opt#--extra-ldflags=}"
   ;;
   --extra-libs=*) extralibs=${opt#--extra-libs=}
   ;;
@@@@ -1122,8 +1128,12 @@@@ fi
 if test "$pthreads" = "yes" ; then
d20 1
d23 1
a23 7
+  if test $targetos = OpenBSD; then
+     extralibs="$extralibs -pthread"
+  else
+     if test $targetos != FreeBSD; then
+        extralibs="$extralibs -lpthread"
+     fi
   fi
d26 1
@


1.7
log
@update to 0.4.9-pre1
@
text
@d2 2
a3 2
--- configure.orig	Mon Jul  5 13:06:16 2004
+++ configure	Thu Oct  7 00:38:53 2004
d29 15
@


1.6
log
@experimental bktr(4) support, from freebsd
@
text
@d1 6
a6 6
$OpenBSD: patch-configure,v 1.5 2003/11/04 07:50:19 jolan Exp $
--- configure.orig	2003-09-28 10:26:39.000000000 -0500
+++ configure	2004-02-26 21:20:18.000000000 -0600
@@@@ -155,6 +155,12 @@@@ dv1394="no"
 make="gmake"
 LDFLAGS="$LDFLAGS -export-dynamic"
d12 1
a12 1
+SLIBSUF=.so`grep '#define FFMPEG_VERSION ' $source_path/libavcodec/avcodec.h | cut -d '"' -f 2 | cut -d '0' -f 2`
d17 1
a17 1
@@@@ -276,9 +282,9 @@@@ for opt do
@


1.5
log
@Update to 0.4.8.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure,v 1.4 2003/09/26 14:40:29 jolan Exp $
d3 2
a4 2
+++ configure	2003-11-03 22:20:14.000000000 -0600
@@@@ -155,6 +155,15 @@@@ dv1394="no"
d9 4
a12 7
+a52="no"
+audio_oss="no"
+dv1394="no"
+sdl="no"	# not respected
+v4l="no"
+vhook="no"
+SLIBSUF=.so._SV_
d17 12
a28 23
@@@@ -714,14 +723,14 @@@@ EOF
 
 sdl_too_old=no
 sdl=no
-if $cc -o $TMPE `sdl-config --cflags` $TMPC `sdl-config --libs`  2> /dev/null  ; then
-_sdlversion=`sdl-config --version | sed 's/[^0-9]//g'`
-if test "$_sdlversion" -lt 121 ; then
-sdl_too_old=yes
-else
-sdl=yes
-fi
-fi
+#if $cc -o $TMPE `sdl-config --cflags` $TMPC `sdl-config --libs`  2> /dev/null  ; then
+#_sdlversion=`sdl-config --version | sed 's/[^0-9]//g'`
+#if test "$_sdlversion" -lt 121 ; then
+#sdl_too_old=yes
+#else
+#sdl=yes
+#fi
+#fi
 
 if test "$sdl" = "no" ; then
    ffplay=no
@


1.4
log
@Update to 0.4.7.
@
text
@d1 4
a4 4
$OpenBSD: patch-configure,v 1.3 2003/08/15 14:25:08 jolan Exp $
--- configure.orig	2003-08-24 17:29:49.000000000 -0500
+++ configure	2003-09-26 02:35:26.000000000 -0500
@@@@ -152,6 +152,15 @@@@ dv1394="no"
d20 1
a20 1
@@@@ -707,14 +716,14 @@@@ EOF
@


1.3
log
@Update to 20030813.
@
text
@d1 4
a4 4
$OpenBSD: patch-configure,v 1.2 2003/08/02 10:26:54 jolan Exp $
--- configure.orig	2003-08-13 14:54:47.000000000 -0500
+++ configure	2003-08-14 10:14:42.000000000 -0500
@@@@ -151,6 +151,15 @@@@ dv1394="no"
d20 1
a20 1
@@@@ -713,14 +722,14 @@@@ EOF
@


1.2
log
@update to 20030725
@
text
@d1 4
a4 4
$OpenBSD: patch-configure,v 1.1.1.1 2003/07/19 18:16:34 jolan Exp $
--- configure.orig	2003-07-25 04:19:55.000000000 -0500
+++ configure	2003-07-31 21:44:39.000000000 -0500
@@@@ -148,6 +148,14 @@@@ dv1394="no"
d15 1
d20 1
a20 1
@@@@ -703,14 +711,14 @@@@ EOF
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD$
--- configure.orig	Sun Jun 22 06:27:05 2003
+++ configure	Wed Jul 16 20:21:00 2003
@@@@ -145,6 +145,14 @@@@ dv1394="no"
d19 1
a19 1
@@@@ -633,14 +641,14 @@@@ EOF
@


1.1.1.1
log
@import of ffmpeg-20030622:

FFmpeg is a complete solution to record, convert and stream audio and
video.  It includes libavcodec, the leading audio/video codec library.
@
text
@@
