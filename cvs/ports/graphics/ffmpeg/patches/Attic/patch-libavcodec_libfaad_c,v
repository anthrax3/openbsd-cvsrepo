head	1.6;
access;
symbols
	OPENBSD_4_9:1.5.0.4
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.5.0.2
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.4.0.6
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.4
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.2
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.3.0.2
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.2.0.2
	OPENBSD_4_3_BASE:1.2;
locks; strict;
comment	@# @;


1.6
date	2011.03.29.20.01.43;	author edd;	state dead;
branches;
next	1.5;

1.5
date	2010.05.26.21.38.52;	author jakemsr;	state Exp;
branches;
next	1.4;

1.4
date	2008.09.15.22.06.11;	author jakemsr;	state Exp;
branches;
next	1.3;

1.3
date	2008.07.09.01.57.44;	author jakemsr;	state Exp;
branches;
next	1.2;

1.2
date	2008.01.26.01.56.02;	author jakemsr;	state Exp;
branches;
next	1.1;

1.1
date	2007.09.24.07.51.24;	author jakemsr;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to a newer snapshot of ffmpeg. Maintainer timed out.
OK jakemsr@@, landry@@
@
text
@$OpenBSD: patch-libavcodec_libfaad_c,v 1.5 2010/05/26 21:38:52 jakemsr Exp $
--- libavcodec/libfaad.c.orig	Tue May 11 19:20:53 2010
+++ libavcodec/libfaad.c	Wed May 12 19:16:19 2010
@@@@ -76,14 +76,14 @@@@ typedef struct {
 #else
     unsigned char FAADAPI (*faacDecSetConfiguration)(faacDecHandle hDecoder,
                                                      faacDecConfigurationPtr config);
-    long FAADAPI (*faacDecInit)(faacDecHandle hDecoder,
+    int FAADAPI (*faacDecInit)(faacDecHandle hDecoder,
                                 unsigned char *buffer,
-                                unsigned long buffer_size,
-                                unsigned long *samplerate,
+                                unsigned int buffer_size,
+                                unsigned int *samplerate,
                                 unsigned char *channels);
     char FAADAPI (*faacDecInit2)(faacDecHandle hDecoder, unsigned char *pBuffer,
                                  unsigned long SizeOfDecoderSpecificInfo,
-                                 unsigned long *samplerate, unsigned char *channels);
+                                 unsigned int *samplerate, unsigned char *channels);
     void *FAADAPI (*faacDecDecode)(faacDecHandle hDecoder,
                                    faacDecFrameInfo *hInfo,
                                    unsigned char *buffer,
@@@@ -120,7 +120,7 @@@@ static void channel_setup(AVCodecContext *avctx)
 static av_cold int faac_init_mp4(AVCodecContext *avctx)
 {
     FAACContext *s = avctx->priv_data;
-    unsigned long samplerate;
+    unsigned int samplerate;
 #ifndef FAAD2_VERSION
     unsigned long channels;
 #else
@@@@ -134,7 +134,7 @@@@ static av_cold int faac_init_mp4(AVCodecContext *avctx
                             &samplerate, &channels);
         if (r < 0){
             av_log(avctx, AV_LOG_ERROR,
-                   "faacDecInit2 failed r:%d   sr:%ld  ch:%ld  s:%d\n",
+                   "faacDecInit2 failed r:%d   sr:%d  ch:%ld  s:%d\n",
                    r, samplerate, (long)channels, avctx->extradata_size);
         } else {
             avctx->sample_rate = samplerate;
@@@@ -179,7 +179,7 @@@@ static int faac_decode_frame(AVCodecContext *avctx,
 #else
 
     if(!s->init){
-        unsigned long srate;
+        unsigned int srate;
         unsigned char channels;
         int r = s->faacDecInit(s->faac_handle, buf, buf_size, &srate, &channels);
         if(r < 0){
@


1.5
log
@update to ffmpeg subversion snapshot from 2010-05-12

update needed for newer x264 and for gcc4.  this causes yet more
fallout as some libav* functions other ports were using have been
fully deprecated.  commits coming rsn ...

mostly from new MAINTAINER
@
text
@d1 1
a1 1
$OpenBSD: patch-libavcodec_libfaad_c,v 1.4 2008/09/15 22:06:11 jakemsr Exp $
@


1.4
log
@
- faad/faac update related changes
- bump PKGNAME

ok brad@@, also tested by ckuethe@@ a while back
@
text
@d1 4
a4 4
$OpenBSD$
--- libavcodec/libfaad.c.orig	Wed Jul 16 00:28:58 2008
+++ libavcodec/libfaad.c	Wed Jul 16 00:37:44 2008
@@@@ -75,14 +75,14 @@@@ typedef struct {
d23 2
a24 2
@@@@ -119,7 +119,7 @@@@ static void channel_setup(AVCodecContext *avctx)
 static int faac_init_mp4(AVCodecContext *avctx)
d32 1
a32 1
@@@@ -133,7 +133,7 @@@@ static int faac_init_mp4(AVCodecContext *avctx)
d41 1
a41 1
@@@@ -176,7 +176,7 @@@@ static int faac_decode_frame(AVCodecContext *avctx,
@


1.3
log
@
update to subversion snapshot from 2008-06-20.

added since last update:

- AVM2 (Flash 9) SWF muxer
- QT variant of IMA ADPCM encoder
- VFW grabber
- Ipod/Iphone compatible mp4 muxer
- Mimic decoder
- MSN TCP Webcam stream demuxer
- RL2 demuxer / decoder
- IFF demuxer
- 8SVX audio decoder
- BFI demuxer
- MAXIS EA XA (.xa) demuxer / decoder
- BFI video decoder
- OMA demuxer

also:
* headers have been moved to library specific subdirectories instead
  of all under ffmpeg.
* libswscale is now enabled in the build.


feedback/ok brad@@
@
text
@d1 4
a4 6
$OpenBSD: patch-libavcodec_libfaad_c,v 1.2 2008/01/26 01:56:02 jakemsr Exp $
--- libavcodec/libfaad.c.orig	Fri Jun 20 19:40:02 2008
+++ libavcodec/libfaad.c	Fri Jun 20 23:06:05 2008
@@@@ -73,21 +73,21 @@@@ typedef struct {
                                  short *sample_buffer,
                                  unsigned long *samples);
d6 1
a6 2
-    unsigned char FAADAPI (*faacDecSetConfiguration)(faacDecHandle hDecoder,
+    uint8_t FAADAPI (*faacDecSetConfiguration)(faacDecHandle hDecoder,
d9 2
a10 1
-                                unsigned char *buffer,
d13 5
a17 3
-                                unsigned char *channels);
-    char FAADAPI (*faacDecInit2)(faacDecHandle hDecoder, unsigned char *pBuffer,
-                                 unsigned long SizeOfDecoderSpecificInfo,
d19 1
a19 8
+    int32_t FAADAPI (*faacDecInit)(faacDecHandle hDecoder,
+                                uint8_t *buffer,
+                                uint32_t buffer_size,
+                                uint32_t *samplerate,
+                                uint8_t *channels);
+    int8_t FAADAPI (*faacDecInit2)(faacDecHandle hDecoder, uint8_t *pBuffer,
+                                 uint32_t SizeOfDecoderSpecificInfo,
+                                 uint32_t *samplerate, uint8_t *channels);
d22 2
a23 19
-                                   unsigned char *buffer,
-                                   unsigned long buffer_size);
-    char* FAADAPI (*faacDecGetErrorMessage)(unsigned char errcode);
+                                   uint8_t *buffer,
+                                   uint32_t buffer_size);
+    int8_t* FAADAPI (*faacDecGetErrorMessage)(uint8_t errcode);
 #endif
 
     void FAADAPI (*faacDecClose)(faacDecHandle hDecoder);
@@@@ -95,7 +95,7 @@@@ typedef struct {
 
 } FAACContext;
 
-static const unsigned long faac_srates[] =
+static const uint32_t faac_srates[] =
 {
     96000, 88200, 64000, 48000, 44100, 32000,
     24000, 22050, 16000, 12000, 11025, 8000
@@@@ -119,11 +119,11 @@@@ static void channel_setup(AVCodecContext *avctx)
d28 1
a28 1
+    uint32_t samplerate;
d32 2
a33 6
-    unsigned char channels;
+    uint8_t channels;
 #endif
     int r = 0;
 
@@@@ -134,7 +134,7 @@@@ static int faac_init_mp4(AVCodecContext *avctx)
d36 3
a38 3
                    "faacDecInit2 failed r:%d   sr:%ld  ch:%ld  s:%d\n",
-                   r, samplerate, (long)channels, avctx->extradata_size);
+                   r, (long)samplerate, (long)channels, avctx->extradata_size);
d41 1
a41 2
             avctx->channels = channels;
@@@@ -176,8 +176,8 @@@@ static int faac_decode_frame(AVCodecContext *avctx,
d46 2
a47 3
-        unsigned char channels;
+        uint32_t srate;
+        uint8_t channels;
a49 10
             av_log(avctx, AV_LOG_ERROR, "faac: codec init failed.\n");
@@@@ -189,7 +189,7 @@@@ static int faac_decode_frame(AVCodecContext *avctx,
         s->init = 1;
     }
 
-    out = s->faacDecDecode(s->faac_handle, &frame_info, (unsigned char*)buf, (unsigned long)buf_size);
+    out = s->faacDecDecode(s->faac_handle, &frame_info, buf, buf_size);
 
     if (frame_info.error > 0) {
         av_log(avctx, AV_LOG_ERROR, "faac: frame decoding failed: %s\n",
@


1.2
log
@update to 20080118

relevent Changelog entries:

+- Monkey's Audio demuxer and decoder
+- additional SPARC (VIS) optimizations
+- AMV audio and video decoder
+- DNxHD encoder
+- H.264 PAFF decoding
+- Nellymoser ASAO decoder
+- Beam Software SIFF demuxer and decoder
+- libvorbis Vorbis decoding removed in favor of native decoder
+- IntraX8 (J-Frame) subdecoder for WMV2 and VC-1
+- Ogg muxer
+- PC Paintbrush PCX decoder
+- Sun Rasterfile decoder
+- TechnoTrend PVA demuxer
+- Linux Media Labs MPEG-4 (LMLM4) demuxer

port changes:

disable ff_fdct_sse2 usage on i386 and libpostproc's
temporal noise reduction filter, since they both regularly
cause segfaults.

ok deanna@@, brad@@

tested by a few others, thanks
@
text
@d1 3
a3 3
$OpenBSD: patch-libavcodec_libfaad_c,v 1.1 2007/09/24 07:51:24 jakemsr Exp $
--- libavcodec/libfaad.c.orig	Fri Jan 18 01:21:38 2008
+++ libavcodec/libfaad.c	Sat Jan 19 18:35:16 2008
d5 2
a6 2
                                 short *sample_buffer,
                                 unsigned long *samples);
d8 2
a9 2
-        unsigned char FAADAPI (*faacDecSetConfiguration)(faacDecHandle hDecoder,
+        uint8_t FAADAPI (*faacDecSetConfiguration)(faacDecHandle hDecoder,
d11 6
a16 6
-        long FAADAPI (*faacDecInit)(faacDecHandle hDecoder,
-                                   unsigned char *buffer,
-                                 unsigned long buffer_size,
-                                 unsigned long *samplerate,
-                                 unsigned char *channels);
-        char FAADAPI (*faacDecInit2)(faacDecHandle hDecoder, unsigned char *pBuffer,
d19 6
a24 6
+        int32_t FAADAPI (*faacDecInit)(faacDecHandle hDecoder,
+                                   uint8_t *buffer,
+                                 uint32_t buffer_size,
+                                 uint32_t *samplerate,
+                                 uint8_t *channels);
+        int8_t FAADAPI (*faacDecInit2)(faacDecHandle hDecoder, uint8_t *pBuffer,
d27 8
a34 8
         void *FAADAPI (*faacDecDecode)(faacDecHandle hDecoder,
                                          faacDecFrameInfo *hInfo,
-                                         unsigned char *buffer,
-                                                                 unsigned long buffer_size);
-        char* FAADAPI (*faacDecGetErrorMessage)(unsigned char errcode);
+                                         uint8_t *buffer,
+                                         uint32_t buffer_size);
+        char* FAADAPI (*faacDecGetErrorMessage)(uint8_t errcode);
d80 2
a81 2
             av_log(avctx, AV_LOG_ERROR, "faac: codec init failed: %s\n",
@@@@ -190,7 +190,7 @@@@ static int faac_decode_frame(AVCodecContext *avctx,
a89 25
@@@@ -259,16 +259,16 @@@@ static int faac_decode_init(AVCodecContext *avctx)
         dfaac(Decode, (int FAADAPI (*)(faacDecHandle, unsigned char*,
                              unsigned long*, short*, unsigned long*)));
 #else
-        dfaac(SetConfiguration, (unsigned char FAADAPI (*)(faacDecHandle,
+        dfaac(SetConfiguration, (uint8_t FAADAPI (*)(faacDecHandle,
                                                            faacDecConfigurationPtr)));
-        dfaac(Init, (long FAADAPI (*)(faacDecHandle, unsigned char*,
-                                     unsigned long, unsigned long*, unsigned char*)));
-        dfaac(Init2, (char FAADAPI (*)(faacDecHandle, unsigned char*,
-                                       unsigned long, unsigned long*,
-                                       unsigned char*)));
+        dfaac(Init, (int32_t FAADAPI (*)(faacDecHandle, uint8_t*,
+                                     uint32_t, uint32_t*, uint8_t*)));
+        dfaac(Init2, (int8_t FAADAPI (*)(faacDecHandle, uint8_t*,
+                                       uint32_t, uint32_t*,
+                                       uint8_t*)));
         dfaac(Decode, (void *FAADAPI (*)(faacDecHandle, faacDecFrameInfo*,
-                             unsigned char*, unsigned long)));
-        dfaac(GetErrorMessage, (char* FAADAPI (*)(unsigned char)));
+                             uint8_t*, uint32_t)));
+        dfaac(GetErrorMessage, (int8_t* FAADAPI (*)(uint8_t)));
 #endif
 #undef dfacc
 
@


1.1
log
@update to snapshot from 2007-09-10

additions/changes in this update:

- RoQ muxer, audio encoder
- Renderware TXD demuxer and decoder
- extern C declarations for C++ removed from headers
- sws_flags command line option
- codebook generator
- RoQ video encoder
- QTRLE encoder
- OS/2 support removed
- AC-3 decoder
- NUT muxer (since r10052)
- Matroska muxer
- Slice-based parallel H.264 decoding

plus lots of bugfixes

prodding/testing/ok brad@@
@
text
@d1 3
a3 3
$OpenBSD$
--- libavcodec/libfaad.c.orig	Tue Jul 17 23:14:10 2007
+++ libavcodec/libfaad.c	Mon Sep 10 20:03:04 2007
d47 1
a47 1
@@@@ -104,11 +104,11 @@@@ static const unsigned long faac_srates[] =
d61 1
a61 1
@@@@ -119,7 +119,7 @@@@ static int faac_init_mp4(AVCodecContext *avctx)
d70 1
a70 1
@@@@ -160,8 +160,8 @@@@ static int faac_decode_frame(AVCodecContext *avctx,
d81 1
a81 1
@@@@ -173,7 +173,7 @@@@ static int faac_decode_frame(AVCodecContext *avctx,
d90 1
a90 1
@@@@ -242,16 +242,16 @@@@ static int faac_decode_init(AVCodecContext *avctx)
@

