head	1.23;
access;
symbols
	OPENBSD_6_2:1.23.0.2
	OPENBSD_6_2_BASE:1.23
	OPENBSD_6_1:1.22.0.2
	OPENBSD_6_1_BASE:1.22
	OPENBSD_6_0:1.17.0.2
	OPENBSD_6_0_BASE:1.17
	OPENBSD_5_9:1.15.0.2
	OPENBSD_5_9_BASE:1.15
	OPENBSD_5_8:1.13.0.4
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.9.0.2
	OPENBSD_5_7_BASE:1.9
	OPENBSD_5_6:1.3.0.2
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.2.0.4
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.2
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.1.1.1.0.2
	OPENBSD_5_3_BASE:1.1.1.1
	jasper_20132801:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.23
date	2017.09.19.10.22.46;	author ajacoutot;	state Exp;
branches;
next	1.22;
commitid	dfGD5cmSeqOFY8Ds;

1.22
date	2017.01.03.19.21.18;	author landry;	state Exp;
branches;
next	1.21;
commitid	4DhVkqkiKi7pRQRO;

1.21
date	2016.11.10.21.58.40;	author danj;	state Exp;
branches;
next	1.20;
commitid	4ER2f1Ti7zNi2Qmp;

1.20
date	2016.10.19.13.30.16;	author sthen;	state Exp;
branches;
next	1.19;
commitid	91KH2zJX9SfcERDO;

1.19
date	2016.10.05.14.42.10;	author sthen;	state Exp;
branches;
next	1.18;
commitid	wUpb1pZ0SKd6mvtv;

1.18
date	2016.09.04.10.53.40;	author sthen;	state Exp;
branches;
next	1.17;
commitid	tu4Whzz7ueFwwAZv;

1.17
date	2016.04.02.14.03.58;	author sthen;	state Exp;
branches;
next	1.16;
commitid	cgcAxpSawGl9tMBP;

1.16
date	2016.03.01.01.02.30;	author sthen;	state Exp;
branches;
next	1.15;
commitid	oCeT9c3g5YISJeBe;

1.15
date	2016.02.02.23.08.40;	author sthen;	state Exp;
branches;
next	1.14;
commitid	siZVdF6ZrFLbssuR;

1.14
date	2015.09.29.10.52.12;	author sthen;	state Exp;
branches;
next	1.13;
commitid	xbfDwwa9BDEzVq2B;

1.13
date	2015.06.05.14.26.22;	author sthen;	state Exp;
branches
	1.13.4.1;
next	1.12;
commitid	s6Sq1u7JOc65Ei1Z;

1.12
date	2015.06.05.10.51.17;	author sthen;	state Exp;
branches;
next	1.11;
commitid	d0S0xRd9fvKEesjx;

1.11
date	2015.04.02.14.21.16;	author jasper;	state Exp;
branches;
next	1.10;
commitid	4Dkfcsk2uZtFDSwy;

1.10
date	2015.03.26.12.09.15;	author sthen;	state Exp;
branches;
next	1.9;
commitid	WNZT1JgiK5vl8mj3;

1.9
date	2015.01.06.17.24.00;	author sthen;	state Exp;
branches;
next	1.8;
commitid	r7UIvnDuDtl7wBs3;

1.8
date	2014.12.21.00.12.09;	author daniel;	state Exp;
branches;
next	1.7;
commitid	z4bPvn0uyeYglduL;

1.7
date	2014.11.28.22.20.01;	author sthen;	state Exp;
branches;
next	1.6;
commitid	0FbqeEsvPq6NOCRm;

1.6
date	2014.10.29.22.12.38;	author landry;	state Exp;
branches;
next	1.5;
commitid	6hV0PaKTUZm7fVu2;

1.5
date	2014.08.25.20.15.28;	author landry;	state Exp;
branches;
next	1.4;
commitid	RNRGKhgleJLUUf1T;

1.4
date	2014.08.14.07.04.22;	author ajacoutot;	state Exp;
branches;
next	1.3;
commitid	3YndDUI0DUVHR6eF;

1.3
date	2014.04.06.21.10.19;	author sthen;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	2013.03.11.11.10.55;	author espie;	state Exp;
branches
	1.2.4.1;
next	1.1;

1.1
date	2013.01.28.07.55.58;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2013.01.28.07.55.58;	author jasper;	state Exp;
branches;
next	;

1.2.4.1
date	2014.09.01.13.36.04;	author jasper;	state Exp;
branches;
next	;
commitid	ta878vAgqp10eOXE;

1.3.2.1
date	2014.09.18.14.58.27;	author jasper;	state Exp;
branches;
next	;
commitid	sgVygH4QElP9fKWA;

1.13.4.1
date	2016.03.11.09.17.30;	author jasper;	state Exp;
branches;
next	;
commitid	AOLoj7UCCNH79ehS;


desc
@@


1.23
log
@Explicitely --disable-jpeg2000 otherwise if openjpeg is present, the build
fails (jpeg2000 support needs openjp2).
@
text
@# $OpenBSD: Makefile,v 1.22 2017/01/03 19:21:18 landry Exp $

COMMENT=		Python Imaging Library (maintained fork of PIL)

MODPY_EGG_VERSION=	3.4.2
DISTNAME=		Pillow-${MODPY_EGG_VERSION}
PKGNAME=		py-${DISTNAME}
CATEGORIES=		graphics
REVISION=		1

HOMEPAGE=		http://python-pillow.org/

# PIL Software License
# Permission to use, copy, modify and distribute freely.
PERMIT_PACKAGE_CDROM=   Yes

FLAVORS=		python3
FLAVOR?=

MODPY_PI =		Yes
EXTRACT_SUFX=		.zip

WANTLIB=		freetype jpeg lcms2 pthread tiff webp z \
			webpdemux webpmux \
			${MODPY_WANTLIB} ${MODTK_WANTLIB}

MODULES=		lang/python \
			x11/tk

BUILD_DEPENDS=		${MODPY_TKINTER_DEPENDS}
TEST_DEPENDS=		${FULLPKGNAME}:${BUILD_PKGPATH} \
			devel/py-nose${MODPY_FLAVOR}
RUN_DEPENDS=		${MODPY_RUN_DEPENDS}

# Is Tk image support actually useful?
LIB_DEPENDS=		graphics/lcms2 \
			graphics/libwebp \
			${MODTK_LIB_DEPENDS}

MODPY_SETUPTOOLS=	Yes
MAKE_ENV=		C_INCLUDE_PATH="${X11BASE}/include:${LOCALBASE}/include:${MODTK_INCDIR}:${MODTCL_INCDIR}" \
			LIBRARY_PATH="${X11BASE}/lib:${LOCALBASE}/lib"

MODPY_ADJ_FILES=	Scripts/*.py

SUBST_VARS+=		INCL_DIR MODPY_FLAVOR
INCL_DIR=		${MODPY_INCDIR:S/${LOCALBASE}\///}

MODPY_DISTUTILS_BUILD=	build_ext --disable-jpeg2000

post-install:
	${INSTALL_DATA_DIR} ${WRKINST}${MODPY_INCDIR}
	${INSTALL_DATA} ${WRKSRC}/libImaging/{ImPlatform,Imaging}.h ${WRKINST}${MODPY_INCDIR}
	for s in ${PREFIX}/bin/*; do mv $$s $$s${MODPY_BIN_SUFFIX}; done

do-test:
	cd ${WRKSRC}; ${MODPY_BIN} ./selftest.py --installed

.include <bsd.port.mk>
@


1.22
log
@bump ports depending on python3 in graphics
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2016/11/10 21:58:40 danj Exp $
d9 1
a9 1
REVISION=		0
a34 1
# Enable JPEG2000 support via openjpeg?
d48 2
@


1.21
log
@Remove superfluous if ${FLAVOR:Mpython3}

tweaks and ok rpointel@@ shadchin@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2016/10/19 13:30:16 sthen Exp $
d9 1
@


1.20
log
@update to py-Pillow-3.4.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2016/10/05 14:42:10 sthen Exp $
a51 1
.if ${FLAVOR:Mpython3}
a52 1
.endif
@


1.19
log
@update to Pillow 3.4.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2016/09/04 10:53:40 sthen Exp $
d5 1
a5 1
MODPY_EGG_VERSION=	3.4.1
@


1.18
log
@update to py-Pillow 3.3.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2016/04/02 14:03:58 sthen Exp $
d5 1
a5 1
MODPY_EGG_VERSION=	3.3.1
@


1.17
log
@update to py-Pillow-3.2.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2016/03/01 01:02:30 sthen Exp $
d5 1
a5 1
MODPY_EGG_VERSION=	3.2.0
d41 2
@


1.16
log
@update to py-Pillow 3.1.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2016/02/02 23:08:40 sthen Exp $
d3 1
a3 1
COMMENT=		Python Imaging Library (fork)
d5 1
a5 1
MODPY_EGG_VERSION=	3.1.1
@


1.15
log
@Add upstream patch to py-Pillow, fixing a buffer overflow in PcdDecode.c,
where the decoder writes assuming 4 bytes per pixel into a 3 byte per pixel
wide buffer, allowing writing 768 bytes off the end of the buffer. This
overwrites objects in Python's stack, leading to a crash.
https://github.com/python-pillow/Pillow/pull/1706

(There's also a newer upstream release but that will need additional
checking before it can go in).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2015/09/29 10:52:12 sthen Exp $
d5 1
a5 1
MODPY_EGG_VERSION=	2.8.1
a8 1
REVISION=		1
d10 1
a10 1
HOMEPAGE=		http://python-pillow.github.io/
a47 3
	for s in ${WRKSRC}/Scripts/*.py; do \
		${INSTALL_SCRIPT} $$s ${PREFIX}/bin/`basename $$s .py`; \
	done
@


1.14
log
@bump REVISION for setuptools dep change.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2015/06/05 14:26:22 sthen Exp $
d9 1
a9 1
REVISION=		0
@


1.13
log
@update to py-Pillow 2.8.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2015/06/05 10:51:17 sthen Exp $
d9 1
@


1.13.4.1
log
@Add upstream patch to py-Pillow, fixing a buffer overflow in PcdDecode.c,
where the decoder writes assuming 4 bytes per pixel into a 3 byte per pixel
wide buffer, allowing writing 768 bytes off the end of the buffer. This
overwrites objects in Python's stack, leading to a crash.
https://github.com/python-pillow/Pillow/pull/1706, CVE-2016-2533
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2015/06/05 14:26:22 sthen Exp $
a7 1
REVISION=		0
@


1.12
log
@add MODPY_FLAVOR to SUBST_VARS, unbreaking updates from old subpackaged py-Pillow
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2015/04/02 14:21:16 jasper Exp $
d5 1
a5 2
MODPY_EGG_VERSION=	2.7.0
REVISION=		0
d30 3
a32 4
TEST_DEPENDS=		${FULLPKGNAME}:${BUILD_PKGPATH}
RUN_DEPENDS=		${MODPY_RUN_DEPENDS} \
			${MODPY_TKINTER_DEPENDS}
# XXX can we get rid of tkinter dep for the library?
d35 1
@


1.11
log
@- switch to MODPY_PI
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2015/03/26 12:09:15 sthen Exp $
d6 1
d45 1
a45 1
SUBST_VARS+=		INCL_DIR
@


1.10
log
@update to py-Pillow 2.7.0 and remove subpackages, py-sane distribution has
now been separated.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2015/01/06 17:24:00 sthen Exp $
d19 1
a19 1
MASTER_SITES=		${MASTER_SITE_PYPI:=P/Pillow/}
@


1.9
log
@update to Pillow 2.6.2 (restrict size of compressed iTXt or zTXt section,
avoid potential DoS)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2014/12/21 00:12:09 daniel Exp $
d3 1
a3 2
COMMENT-main=		Python Imaging Library (fork)
COMMENT-sane=		Python SANE module
d5 1
a5 1
MODPY_EGG_VERSION=	2.6.2
d7 1
a7 2
PKGNAME-main=		py-${DISTNAME}
PKGNAME-sane=		py-sane-${MODPY_EGG_VERSION}
d10 1
a10 1
HOMEPAGE=		https://github.com/python-imaging/Pillow
a15 2
MULTI_PACKAGES=		-main -sane

a17 6
.if ${FLAVOR:Mpython3}
FULLPKGNAME-main=	py3-${DISTNAME}
FULLPKGNAME-sane=	py3-sane-${MODPY_EGG_VERSION}
FULLPKGPATH-main=	graphics/py-Pillow,-main,python3
FULLPKGPATH-sane=	graphics/py-Pillow,-sane,python3
.endif
d22 1
a22 1
WANTLIB-main=		freetype jpeg lcms2 pthread tiff webp z \
a25 2
WANTLIB-sane=		pthread sane ${MODPY_WANTLIB}

d30 2
a31 2
TEST_DEPENDS=		${FULLPKGNAME-main}:${BUILD_PKGPATH}
RUN_DEPENDS-main=	${MODPY_RUN_DEPENDS} \
d33 1
d36 1
a36 1
LIB_DEPENDS-main=	graphics/lcms2 \
a39 4
RUN_DEPENDS-sane=	${BASE_PKGPATH},-main
LIB_DEPENDS-sane=	${MODPY_LIB_DEPENDS} \
			graphics/sane-backends

a41 2
INCL_DIR=		${PREFIX}/include/python${MODPY_VERSION}

d44 2
a45 5
pre-configure:
	${SUBST_CMD} ${WRKSRC}/Sane/setup.py

post-build:
	cd ${WRKSRC}/Sane && ${MODPY_BIN} setup.py build
a47 2
	cd ${WRKSRC}/Sane && \
		${MODPY_BIN} setup.py install --skip-build --root ${WRKINST}
d51 2
a52 2
	${INSTALL_DATA_DIR} ${INCL_DIR}
	${INSTALL_DATA} ${WRKSRC}/libImaging/{ImPlatform,Imaging}.h ${INCL_DIR}
@


1.8
log
@Remove no longer needed work-around following recent change in
python.port.mk.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2014/11/28 22:20:01 sthen Exp $
d6 1
a6 2
MODPY_EGG_VERSION=	2.6.1
REVISION=		0
@


1.7
log
@add python3 support to py-Pillow
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2014/10/29 22:12:38 landry Exp $
d42 1
a42 2
# ${MODPY_TKINTER_DEPENDS} appends ,tkinter to devel/setuptools too.
BUILD_DEPENDS=		lang/python/${MODPY_VERSION},-tkinter
d45 1
a45 1
			lang/python/${MODPY_VERSION},-tkinter
@


1.6
log
@Update to py-Pillow 2.6.1.
Check https://github.com/python-pillow/Pillow/blob/master/CHANGES.rst
for changes.
Tested in a bulk by sthen@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2014/08/25 20:15:28 landry Exp $
d7 1
d21 9
d44 1
a44 1
TEST_DEPENDS=		${BUILD_PKGPATH}
d77 3
@


1.5
log
@Update to py-Pillow 2.5.3.

https://pypi.python.org/pypi/Pillow/2.5.3
2.5.2 fixes CVE-2014-3589 and 2.5.3 fixes CVE-2014-3598.

Went in a bulk build without fallout, ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2014/08/14 07:04:22 ajacoutot Exp $
d6 1
a6 1
MODPY_EGG_VERSION=	2.5.3
@


1.4
log
@Build the python sane bindings.
Subpackage this port:
py-Pillow
py-sane

ok sthen@@ rpointel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2014/04/06 21:10:19 sthen Exp $
d6 1
a6 1
MODPY_EGG_VERSION=	2.4.0
a11 2
REVISION-main=		0

d34 1
d37 2
d69 1
a69 1
	cd ${WRKSRC}; ${MODPY_BIN} ./selftest.py
@


1.3
log
@update to py-Pillow 2.4.0. Commits to move py-Imaging users over to py-Pillow will follow (words of encouragement from landry@@)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2013/03/11 11:10:55 espie Exp $
d3 2
a4 1
COMMENT=		Python Imaging Library (fork)
d8 2
a9 1
PKGNAME=		py-${DISTNAME}
d12 2
d20 2
d25 2
a26 1
WANTLIB=		freetype jpeg lcms2 pthread tiff webp z \
d29 2
d35 4
a38 3
BUILD_DEPENDS=		${RUN_DEPENDS}
RUN_DEPENDS=		lang/python/${MODPY_VERSION},-tkinter
LIB_DEPENDS=		graphics/lcms2 \
d42 4
d52 6
d59 2
@


1.3.2.1
log
@Security fixes for CVE-2014-3589 and CVE-2014-3598
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2014/04/06 21:10:19 sthen Exp $
a7 1
REVISION=		0
@


1.2
log
@PERMIT_* / REGRESS -> TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2013/01/28 07:55:58 jasper Exp $
d5 1
a5 1
MODPY_EGG_VERSION=	1.7.8
d19 1
a19 1
WANTLIB=		freetype jpeg lcms pthread z \
d28 2
a29 1
LIB_DEPENDS=		graphics/lcms \
a33 2
NO_TEST=		Yes

d44 3
@


1.2.4.1
log
@Security fix for CVE-2014-3589
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2013/03/11 11:10:55 espie Exp $
a7 1
REVISION=		0
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
a14 3
PERMIT_PACKAGE_FTP=     Yes
PERMIT_DISTFILES_CDROM= Yes
PERMIT_DISTFILES_FTP=   Yes
d33 1
a33 1
NO_REGRESS=		Yes
@


1.1.1.1
log
@import py-Pillow-1.7.8

Pillow is the "friendly" PIL fork. PIL is the Python Imaging Library.

The Python Imaging Library (PIL) adds image processing capabilities to
your Python environment. This library provides extensive file format
support, an efficient internal representation, and powerful image
processing capabilities.

feedback/ok fgsch@@
@
text
@@
