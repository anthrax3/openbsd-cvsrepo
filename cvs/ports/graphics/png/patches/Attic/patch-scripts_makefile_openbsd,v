head	1.41;
access;
symbols
	OPENBSD_5_3:1.38.0.4
	OPENBSD_5_3_BASE:1.38
	OPENBSD_5_2:1.38.0.2
	OPENBSD_5_2_BASE:1.38
	OPENBSD_5_1_BASE:1.36
	OPENBSD_5_1:1.36.0.2
	OPENBSD_5_0:1.34.0.2
	OPENBSD_5_0_BASE:1.34
	OPENBSD_4_9:1.31.0.4
	OPENBSD_4_9_BASE:1.31
	OPENBSD_4_8:1.31.0.2
	OPENBSD_4_8_BASE:1.31
	OPENBSD_4_7:1.30.0.2
	OPENBSD_4_7_BASE:1.30
	OPENBSD_4_6:1.27.0.2
	OPENBSD_4_6_BASE:1.27
	OPENBSD_4_5:1.26.0.2
	OPENBSD_4_5_BASE:1.26
	OPENBSD_4_4:1.24.0.2
	OPENBSD_4_4_BASE:1.24
	OPENBSD_4_3:1.23.0.2
	OPENBSD_4_3_BASE:1.23
	OPENBSD_4_2:1.21.0.2
	OPENBSD_4_2_BASE:1.21
	OPENBSD_4_1:1.18.0.2
	OPENBSD_4_1_BASE:1.18
	OPENBSD_4_0:1.16.0.2
	OPENBSD_4_0_BASE:1.16
	OPENBSD_3_9:1.13.0.2
	OPENBSD_3_9_BASE:1.13
	OPENBSD_3_8:1.12.0.2
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.11.0.2
	OPENBSD_3_7_BASE:1.11
	OPENBSD_3_6:1.9.0.2
	OPENBSD_3_6_BASE:1.9
	OPENBSD_3_5:1.7.0.2
	OPENBSD_3_5_BASE:1.7
	OPENBSD_3_4:1.4.0.4
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.4.0.2
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.2.0.2
	OPENBSD_3_2_BASE:1.2;
locks; strict;
comment	@# @;


1.41
date	2013.06.03.02.46.25;	author naddy;	state dead;
branches;
next	1.40;

1.40
date	2013.04.15.02.38.43;	author brad;	state Exp;
branches;
next	1.39;

1.39
date	2013.03.25.00.21.37;	author brad;	state Exp;
branches;
next	1.38;

1.38
date	2012.03.30.18.58.03;	author naddy;	state Exp;
branches;
next	1.37;

1.37
date	2012.02.26.14.57.54;	author naddy;	state Exp;
branches;
next	1.36;

1.36
date	2011.11.14.17.48.59;	author rpointel;	state Exp;
branches;
next	1.35;

1.35
date	2011.09.23.21.00.28;	author sthen;	state Exp;
branches;
next	1.34;

1.34
date	2011.07.15.11.10.40;	author naddy;	state Exp;
branches;
next	1.33;

1.33
date	2011.07.08.20.34.37;	author naddy;	state Exp;
branches;
next	1.32;

1.32
date	2011.06.23.22.50.27;	author naddy;	state Exp;
branches;
next	1.31;

1.31
date	2010.06.27.19.55.04;	author kili;	state Exp;
branches;
next	1.30;

1.30
date	2009.12.06.21.43.11;	author naddy;	state Exp;
branches;
next	1.29;

1.29
date	2009.10.12.10.17.16;	author naddy;	state Exp;
branches;
next	1.28;

1.28
date	2009.08.23.14.44.18;	author naddy;	state Exp;
branches;
next	1.27;

1.27
date	2009.03.04.20.17.16;	author naddy;	state Exp;
branches;
next	1.26;

1.26
date	2008.12.02.16.45.59;	author naddy;	state Exp;
branches;
next	1.25;

1.25
date	2008.09.28.14.43.22;	author naddy;	state Exp;
branches;
next	1.24;

1.24
date	2008.05.07.14.29.39;	author naddy;	state Exp;
branches;
next	1.23;

1.23
date	2007.10.16.20.32.18;	author naddy;	state Exp;
branches;
next	1.22;

1.22
date	2007.10.06.19.33.28;	author naddy;	state Exp;
branches;
next	1.21;

1.21
date	2007.05.16.19.47.00;	author naddy;	state Exp;
branches;
next	1.20;

1.20
date	2007.04.08.15.02.36;	author naddy;	state Exp;
branches;
next	1.19;

1.19
date	2007.03.15.19.19.23;	author naddy;	state Exp;
branches;
next	1.18;

1.18
date	2006.11.30.11.25.32;	author bernd;	state Exp;
branches;
next	1.17;

1.17
date	2006.11.18.16.06.26;	author bernd;	state Exp;
branches;
next	1.16;

1.16
date	2006.06.29.14.33.47;	author bernd;	state Exp;
branches;
next	1.15;

1.15
date	2006.05.13.13.52.48;	author bernd;	state Exp;
branches;
next	1.14;

1.14
date	2006.05.10.13.50.01;	author bernd;	state Exp;
branches;
next	1.13;

1.13
date	2005.12.26.22.33.17;	author steven;	state Exp;
branches;
next	1.12;

1.12
date	2005.07.24.04.55.35;	author brad;	state Exp;
branches;
next	1.11;

1.11
date	2004.10.15.04.41.13;	author brad;	state Exp;
branches;
next	1.10;

1.10
date	2004.09.20.01.24.11;	author brad;	state Exp;
branches;
next	1.9;

1.9
date	2004.07.06.21.53.16;	author brad;	state Exp;
branches;
next	1.8;

1.8
date	2004.04.06.08.32.45;	author brad;	state Exp;
branches;
next	1.7;

1.7
date	2004.02.25.20.24.41;	author brad;	state Exp;
branches;
next	1.6;

1.6
date	2004.02.24.23.18.58;	author brad;	state Exp;
branches;
next	1.5;

1.5
date	2003.12.18.00.09.48;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2003.01.25.05.52.21;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2002.10.30.23.55.27;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2002.07.17.22.39.03;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2002.04.26.02.19.04;	author brad;	state Exp;
branches;
next	;


desc
@@


1.41
log
@switch to autotools-based build and follow the upstream install layout
@
text
@$OpenBSD: patch-scripts_makefile_openbsd,v 1.40 2013/04/15 02:38:43 brad Exp $
--- scripts/makefile.openbsd.orig	Wed Mar 27 21:21:27 2013
+++ scripts/makefile.openbsd	Thu Apr 11 21:29:02 2013
@@@@ -7,8 +7,10 @@@@
 # and license in png.h
 
 PREFIX?= /usr/local
+BINDIR= ${PREFIX}/bin
 LIBDIR=	${PREFIX}/lib
-MANDIR= ${PREFIX}/man/cat
+MANDIR= ${PREFIX}/man/man
+INCDIR= ${PREFIX}/include/libpng
 
 SHLIB_MAJOR=	15
 SHLIB_MINOR=	1.5.15
@@@@ -22,15 +24,34 @@@@ HDRS=	png.h pngconf.h pnglibconf.h
 
 CFLAGS+= -W -Wall
 CPPFLAGS+= -I${.CURDIR}
+LDADD=	-lz -lm
 
 NOPROFILE= Yes
 
-CLEANFILES+= pngtest.o pngtest pnglibconf.h
+CLEANFILES+= pngtest.o pngtest pngvalid.o pngvalid pnglibconf.h libpng-config
 
 MAN=	libpng.3 libpngpf.3 png.5
-DOCS = ANNOUNCE CHANGES INSTALL KNOWNBUG LICENSE README TODO Y2KINFO \
-       libpng-manual.txt
 
+all: pnglibconf.h ${_LIBS} libpng-config libpng.pc
+
+beforedepend: pnglibconf.h
+
+libpng.pc:
+	sed < scripts/libpng.pc.in -e s'!@@prefix@@!$(PREFIX)!' \
+		-e 's!@@exec_prefix@@!$(BINDIR)!' -e 's!@@libdir@@!$(LIBDIR)!' \
+		-e 's!@@includedir@@!$(INCDIR)!'  \
+		-e 's!@@PNGLIB_VERSION@@!$(PNGLIB_VERSION)!' > libpng.pc
+
+libpng-config:
+	( cat scripts/libpng-config-head.in; \
+	echo prefix=\"$(PREFIX)\"; \
+	echo I_opts=\"-I$(INCDIR)\"; \
+	echo L_opts=\"-L$(LIBDIR)\"; \
+	echo libs=\"-lpng\"; \
+	echo static_libs=\"-lz -lm\"; \
+	cat scripts/libpng-config-body.in ) > libpng-config
+	chmod +x libpng-config
+
 # see scripts/pnglibconf.mak for more options
 pnglibconf.h: scripts/pnglibconf.h.prebuilt
 	cp scripts/pnglibconf.h.prebuilt $@@
@@@@ -41,13 +62,20 @@@@ pngtest.o:	pngtest.c
 pngtest:	pngtest.o
 	${CC} ${LDFLAGS} ${.ALLSRC} -o ${.TARGET} -L${.OBJDIR} -lpng -lz -lm
 
-test:	pngtest
-	cd ${.OBJDIR} && env \
-		LD_LIBRARY_PATH="${.OBJDIR}" ${.OBJDIR}/pngtest
+pngvalid.o:	contrib/libtests/pngvalid.c
+	${CC} ${CPPFLAGS} ${CFLAGS} -c ${.ALLSRC} -o ${.TARGET}
 
+pngvalid:	pngvalid.o
+	${CC} ${LDFLAGS} ${.ALLSRC} -o ${.TARGET} -L${.OBJDIR} -lpng -lz -lm
+
+test regress:	pngtest pngvalid
+	@@LD_LIBRARY_PATH="${.OBJDIR}" srcdir=. ./test-pngtest.sh
+	@@LD_LIBRARY_PATH="${.OBJDIR}" ./test-pngvalid-simple.sh
+	@@LD_LIBRARY_PATH="${.OBJDIR}" ./test-pngvalid-full.sh
+
 beforeinstall:
-	if [ ! -d ${DESTDIR}${PREFIX}/include/libpng ]; then \
-	  ${INSTALL} -d -o root -g wheel ${DESTDIR}${PREFIX}/include; \
+	if [ ! -d ${DESTDIR}${INCDIR} ]; then \
+	  ${INSTALL} -d -o root -g wheel ${DESTDIR}${INCDIR}; \
 	fi
 	if [ ! -d ${DESTDIR}${LIBDIR} ]; then \
 	  ${INSTALL} -d -o root -g wheel ${DESTDIR}${LIBDIR}; \
@@@@ -61,22 +89,18 @@@@ beforeinstall:
 	if [ ! -d ${DESTDIR}${MANDIR}5 ]; then \
 	  ${INSTALL} -d -o root -g wheel ${DESTDIR}${MANDIR}5; \
 	fi
-	if [ ! -d ${DESTDIR}${PREFIX}/share/doc/png ]; then \
-	  ${INSTALL} -d -o root -g wheel ${DESTDIR}${PREFIX}/share/doc/png; \
+	if [ ! -d ${DESTDIR}${LIBDIR}/pkgconfig ]; then \
+	  ${INSTALL} -d -o root -g wheel ${DESTDIR}${LIBDIR}/pkgconfig; \
 	fi
 
 afterinstall:
-	@@rm -f ${DESTDIR}${LIBDIR}/libpng_pic.a
 	@@rm -f ${DESTDIR}${LIBDIR}/debug/libpng.a
-	@@rm -f ${DESTDIR}${PREFIX}/include/png.h
-	@@rm -f ${DESTDIR}${PREFIX}/include/pngconf.h
-	@@rm -f ${DESTDIR}${PREFIX}/include/pnglibconf.h
 	@@rmdir ${DESTDIR}${LIBDIR}/debug 2>/dev/null || true
+	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} \
+		-m ${BINMODE} libpng-config ${DESTDIR}${BINDIR}
 	${INSTALL} ${INSTALL_COPY} -o ${SHAREOWN} -g ${SHAREGRP} \
-		-m ${NONBINMODE} ${HDRS} ${DESTDIR}${PREFIX}/include
+		-m ${NONBINMODE} ${HDRS} ${DESTDIR}${INCDIR}
 	${INSTALL} ${INSTALL_COPY} -o ${SHAREOWN} -g ${SHAREGRP} \
-		-m ${NONBINMODE} ${HDRS} ${DESTDIR}${PREFIX}/include
-	${INSTALL} ${INSTALL_COPY} -o ${SHAREOWN} -g ${SHAREGRP} \
-		-m ${NONBINMODE} ${DOCS} ${DESTDIR}${PREFIX}/share/doc/png
+		-m ${NONBINMODE} libpng.pc ${DESTDIR}${LIBDIR}/pkgconfig
 
 .include <bsd.lib.mk>
@


1.40
log
@Update to png 1.5.15.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.39 2013/03/25 00:21:37 brad Exp $
@


1.39
log
@Update to png 1.5.14.

Reinstates inter-library dependencies and corrects the libpng-config
and pkg-config files for static vs shared linking.

WANTLIB update and Ok naddy@@
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.38 2012/03/30 18:58:03 naddy Exp $
--- scripts/makefile.openbsd.orig	Wed Jan 23 21:59:05 2013
+++ scripts/makefile.openbsd	Sat Mar 23 21:07:49 2013
d15 1
a15 1
 SHLIB_MINOR=	1.5.14
@


1.38
log
@SECURITY update to 1.5.10.
libpng failed to correctly handle malloc() failure for text chunks,
which can lead to memory corruption and the possibility of execution
of hostile code. (CVE-2011-3048)
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.37 2012/02/26 14:57:54 naddy Exp $
--- scripts/makefile.openbsd.orig	Thu Mar 29 07:06:56 2012
+++ scripts/makefile.openbsd	Fri Mar 30 20:00:16 2012
d15 6
a20 2
 SHLIB_MINOR=	1.5.10
@@@@ -25,12 +27,30 @@@@ CPPFLAGS+= -I${.CURDIR}
d46 2
a47 2
+	echo R_opts=\"-Wl,-rpath,$(LIBDIR)\"; \
+	echo libs=\"-lpng -lz -lm\"; \
d54 1
a54 1
@@@@ -41,13 +61,20 @@@@ pngtest.o:	pngtest.c
d80 1
a80 1
@@@@ -61,22 +88,19 @@@@ beforeinstall:
d91 1
a91 1
 	@@rm -f ${DESTDIR}${LIBDIR}/libpng_pic.a
@


1.37
log
@update to 1.5.9
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.36 2011/11/14 17:48:59 rpointel Exp $
--- scripts/makefile.openbsd.orig	Sat Feb 18 21:31:16 2012
+++ scripts/makefile.openbsd	Sat Feb 25 18:19:23 2012
d15 1
a15 1
 SHLIB_MINOR=	1.5.9
@


1.36
log
@Update libpng to 1.5.6.
bump major version of shared libs.
ok naddy@@.
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.35 2011/09/23 21:00:28 sthen Exp $
--- scripts/makefile.openbsd.orig	Thu Nov  3 04:42:52 2011
+++ scripts/makefile.openbsd	Thu Nov  3 12:18:34 2011
d15 2
a16 2
 SHLIB_MINOR=	1.5.6
@@@@ -25,12 +27,30 @@@@
d50 1
a50 1
@@@@ -41,13 +61,20 @@@@
d57 1
a57 1
+pngvalid.o:	pngvalid.c
d76 1
a76 1
@@@@ -61,22 +88,19 @@@@
@


1.35
log
@SECURITY update to png 1.5.5, fixing a divide-by-zero with malformed cHRM
chunks, this bug was introduced in 1.5.4 - CVE-2011-3328. Clues from naddy@@
@
text
@d1 4
a4 4
$OpenBSD: patch-scripts_makefile_openbsd,v 1.34 2011/07/15 11:10:40 naddy Exp $
--- scripts/makefile.openbsd.orig	Thu Sep 22 14:40:25 2011
+++ scripts/makefile.openbsd	Fri Sep 23 09:20:15 2011
@@@@ -7,12 +7,11 @@@@
d14 3
a16 7
-SHLIB_MAJOR=	15
-SHLIB_MINOR=	1.5.5
-
 LIB=	png
 SRCS=	png.c pngerror.c pngget.c pngmem.c pngpread.c \
 	pngread.c pngrio.c pngrtran.c pngrutil.c pngset.c pngtrans.c \
@@@@ -25,12 +24,30 @@@@ CPPFLAGS+= -I${.CURDIR}
d50 1
a50 1
@@@@ -41,13 +58,20 @@@@ pngtest.o:	pngtest.c
d76 1
a76 1
@@@@ -61,22 +85,19 @@@@ beforeinstall:
@


1.34
log
@SECURITY update to png-1.5.4:
1. buffer overwrite in png_rgb_to_gray (CVE-2011-2690)
2. crash in png_default_error due to use of NULL Pointer (CVE-2011-2691)
3. memory corruption when handling empty sCAL chunks (CVE-2011-2692)
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.33 2011/07/08 20:34:37 naddy Exp $
--- scripts/makefile.openbsd.orig	Thu Jul  7 05:24:50 2011
+++ scripts/makefile.openbsd	Fri Jul  8 18:50:50 2011
d15 1
a15 1
-SHLIB_MINOR=	1.5.4
@


1.33
log
@Update to png 1.5.2.  Lots of improvements, but also significant
API incompatibility:

"The libpng 1.5.x series finally hides the contents of the venerable
and hoary png_struct and png_info data structures inside private
(i.e., non-installed) header files. Instead of direct struct-access,
applications should be using the various png_get_xxx() and png_set_xxx()
accessor functions, which have existed for almost as long as libpng
itself."
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.32 2011/06/23 22:50:27 naddy Exp $
--- scripts/makefile.openbsd.orig	Thu Mar 31 18:23:42 2011
+++ scripts/makefile.openbsd	Sun Jul  3 19:09:39 2011
d15 1
a15 1
-SHLIB_MINOR=	1.5.2
@


1.32
log
@Cope with bsd.man.mk changes and install source man pages.
While here, also update some PLISTs, fix PREFIX use, etc.
ok landry@@
@
text
@d1 4
a4 4
$OpenBSD: patch-scripts_makefile_openbsd,v 1.31 2010/06/27 19:55:04 kili Exp $
--- scripts/makefile.openbsd.orig	Fri Jun 25 18:31:16 2010
+++ scripts/makefile.openbsd	Mon Jun 20 13:22:02 2011
@@@@ -7,11 +7,12 @@@@
a12 4
+DOCDIR= ${PREFIX}/share/doc/png
 
-SHLIB_MAJOR=	0
-SHLIB_MINOR=	1.2.44
d14 3
d19 2
a20 1
@@@@ -25,24 +26,42 @@@@ CPPFLAGS+= -I${.CURDIR} -DPNG_NO_MMX_CODE
d24 2
a25 2
-CLEANFILES+= pngtest.o pngtest
+CLEANFILES+= pngtest.o pngtest libpng-config
d28 2
a29 2
-DOCS = ANNOUNCE CHANGES INSTALL KNOWNBUG LICENSE README TODO Y2KINFO libpng.txt
+DOCS = libpng-1.2.44.txt
d31 3
a33 1
+all: ${_LIBS} libpng-config libpng.pc
d36 4
a39 4
+	cat scripts/libpng.pc.in | sed -e s\!@@prefix@@!$(PREFIX)! \
+		-e s\!@@exec_prefix@@!$(BINDIR)! -e s\!@@libdir@@!$(LIBDIR)! \
+		-e s\!@@includedir@@!$(INCDIR)!  \
+		-e s\!@@PNGLIB_VERSION@@!$(PNGLIB_VERSION)!> libpng.pc
d51 4
a54 3
 pngtest.o:	pngtest.c
 	${CC} ${CPPFLAGS} ${CFLAGS} -c ${.ALLSRC} -o ${.TARGET}
 
d59 4
a62 3
+test regress:	pngtest
 	cd ${.OBJDIR} && env \
 		LD_LIBRARY_PATH="${.OBJDIR}" ${.OBJDIR}/pngtest
d64 8
d80 1
a80 1
@@@@ -56,21 +75,24 @@@@ beforeinstall:
a85 3
+	if [ ! -d ${DESTDIR}${DOCDIR} ]; then \
+	  ${INSTALL} -d -o root -g wheel ${DESTDIR}${DOCDIR}; \
 	fi
d88 1
a88 1
+	fi
d95 1
d104 2
a106 3
 	${INSTALL} ${INSTALL_COPY} -o ${SHAREOWN} -g ${SHAREGRP} \
-		-m ${NONBINMODE} ${DOCS} ${DESTDIR}${PREFIX}/share/doc/png
+		-m ${NONBINMODE} ${DOCS} ${DESTDIR}${DOCDIR}
@


1.31
log
@SECRUTY update to 1.22.44

Fixes CVE-2010-1205.

ok naddy@@
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.30 2009/12/06 21:43:11 naddy Exp $
--- scripts/makefile.openbsd.orig	Sat Jun 26 02:31:16 2010
+++ scripts/makefile.openbsd	Sun Jun 27 08:39:13 2010
d10 2
a11 1
 MANDIR= ${PREFIX}/man/cat
@


1.30
log
@maintenance update to 1.2.41
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.29 2009/10/12 10:17:16 naddy Exp $
--- scripts/makefile.openbsd.orig	Thu Aug 13 13:13:23 2009
+++ scripts/makefile.openbsd	Sun Aug 23 16:21:58 2009
d15 1
a15 1
-SHLIB_MINOR=	1.2.41
d28 1
a28 1
+DOCS = libpng-1.2.41.txt
d61 1
a61 1
-	  ${INSTALL} -d -o root -g wheel ${DESTDIR}${PREFIX}/include/libpng; \
d89 1
a89 1
-		-m ${NONBINMODE} ${HDRS} ${DESTDIR}${PREFIX}/include/libpng
@


1.29
log
@minor maintenance update to 1.2.40
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.28 2009/08/23 14:44:18 naddy Exp $
d15 1
a15 1
-SHLIB_MINOR=	1.2.40
d28 1
a28 1
+DOCS = libpng-1.2.40.txt
@


1.28
log
@maintenance update to 1.2.39
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.27 2009/03/04 20:17:16 naddy Exp $
d15 1
a15 1
-SHLIB_MINOR=	1.2.39
d28 1
a28 1
+DOCS = libpng-1.2.39.txt
@


1.27
log
@Security update to 1.2.35: Fix an uninitialized data bug; CVE-2009-0040.
@
text
@d1 5
a5 5
$OpenBSD: patch-scripts_makefile_openbsd,v 1.26 2008/12/02 16:45:59 naddy Exp $
--- scripts/makefile.openbsd.orig	Sat Sep  8 05:23:02 2007
+++ scripts/makefile.openbsd	Wed Oct  3 17:20:11 2007
@@@@ -4,11 +4,12 @@@@
 # For conditions of distribution and use, see copyright notice in png.h
d15 1
a15 1
-SHLIB_MINOR=	1.2.35
d19 1
a19 1
@@@@ -22,24 +23,42 @@@@ CPPFLAGS+= -I${.CURDIR} -DPNG_NO_MMX_CODE 
d28 1
a28 1
+DOCS = libpng-1.2.35.txt
d67 1
a67 1
@@@@ -53,21 +72,24 @@@@ beforeinstall:
@


1.26
log
@update to 1.2.33, which fixes a minor memory leak
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.25 2008/09/28 14:43:22 naddy Exp $
d15 1
a15 1
-SHLIB_MINOR=	1.2.33
d28 1
a28 1
+DOCS = libpng-1.2.33.txt
@


1.25
log
@Maintenance update to 1.2.32.
Library bump because png_struct has been extended.
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.24 2008/05/07 14:29:39 naddy Exp $
d15 1
a15 1
-SHLIB_MINOR=	1.2.32
d28 1
a28 1
+DOCS = libpng-1.2.32.txt
@


1.24
log
@Update to 1.2.28 which fixes a number of "security and crash bugs".
Bump library version since struct png_struct has changed--this shouldn't be
used externally, but you never know.

ok bernd@@
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.23 2007/10/16 20:32:18 naddy Exp $
d15 1
a15 1
-SHLIB_MINOR=	1.2.28
d28 1
a28 1
+DOCS = libpng-1.2.28.txt
@


1.23
log
@SECURITY update to 1.2.22.
Fixes a number of out-of-bounds reads in certain chunk-handlers.
CVE-2007-5266, CVE-2007-5267, CVE-2007-5268, CVE-2007-5269.
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.22 2007/10/06 19:33:28 naddy Exp $
d15 1
a15 1
-SHLIB_MINOR=	1.2.22
d28 1
a28 1
+DOCS = libpng-1.2.22.txt
@


1.22
log
@maintenance update to 1.2.20
@
text
@d1 1
a1 1
$OpenBSD$
d15 1
a15 1
-SHLIB_MINOR=	1.2.20
d28 1
a28 1
+DOCS = libpng-1.2.20.txt
@


1.21
log
@SECURITY update to 1.2.18:
Fix a NULL pointer dereference vulnerability involving palette
images with a malformed tRNS chunk (CVE-2007-2445).
ok steven@@
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.20 2007/04/08 15:02:36 naddy Exp $
--- scripts/makefile.openbsd.orig	Wed Jan 31 14:22:38 2007
+++ scripts/makefile.openbsd	Sat Mar 31 20:47:38 2007
d15 1
a15 1
-SHLIB_MINOR=	1.2.18
d18 2
a19 2
 SRCS=	png.c pngerror.c pnggccrd.c pngget.c pngmem.c pngpread.c \
@@@@ -22,24 +23,42 @@@@ CPPFLAGS+= -I${.CURDIR} -DPNG_NO_MMX_CODE -DPNG_USE_PN
d28 1
a28 1
+DOCS = libpng-1.2.18.txt
@


1.20
log
@Hardcode our build options in pngconf.h so everything sees really the same
interface.  ok steven@@
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.19 2007/03/15 19:19:23 naddy Exp $
d15 1
a15 1
-SHLIB_MINOR=	1.2.16
d28 1
a28 1
+DOCS = libpng-1.2.16.txt
@


1.19
log
@update to 1.2.16:
- minor bug fixes
- we now use the same API no matter whether asm optimizations are enabled
  or not
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.18 2006/11/30 11:25:32 bernd Exp $
d3 1
a3 1
+++ scripts/makefile.openbsd	Sat Feb 10 20:26:09 2007
d19 1
a19 1
@@@@ -22,24 +23,42 @@@@ CPPFLAGS+= -I${.CURDIR} -DPNG_NO_MMX_COD
@


1.18
log
@Update to png-1.2.14.

'fine with me' steven@@
@
text
@d1 4
a4 4
$OpenBSD: patch-scripts_makefile_openbsd,v 1.17 2006/11/18 16:06:26 bernd Exp $
--- scripts/makefile.openbsd.orig	Wed Nov 15 13:51:31 2006
+++ scripts/makefile.openbsd	Fri Nov 17 10:37:08 2006
@@@@ -3,11 +3,12 @@@@
d15 1
a15 1
-SHLIB_MINOR=	1.2.14
d19 1
a19 6
@@@@ -17,28 +18,46 @@@@ SRCS=	png.c pngerror.c pnggccrd.c pngget
 HDRS=	png.h pngconf.h
 
 CFLAGS+= -Wall
-CPPFLAGS+= -I${.CURDIR} -DPNG_NO_ASSEMBLER_CODE -DPNG_USE_PNGGCCRD
+CPPFLAGS+= -I${.CURDIR}
d28 1
a28 1
+DOCS = README libpng.txt
d67 1
a67 1
@@@@ -52,21 +71,24 @@@@ beforeinstall:
@


1.17
log
@Security update to libpng-1.2.13. (CVE-2006-3334)

Libpng versions 1.0.6 through 1.2.12 can crash while decoding
the sPLT chunk.  This is due to an incorrect calculation of
the buffer size for storing the palette entries.

ok steven@@
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.16 2006/06/29 14:33:47 bernd Exp $
d15 1
a15 1
-SHLIB_MINOR=	1.2.13
@


1.16
log
@Security update to png-1.2.12.

Fixes a buffer overflow vulnerability.

More information:
http://www.securityfocus.com/bid/18698/

ok steven@@ naddy@@
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.15 2006/05/13 13:52:48 bernd Exp $
--- scripts/makefile.openbsd.orig	Tue Jun 27 22:22:40 2006
+++ scripts/makefile.openbsd	Thu Jun 29 11:03:42 2006
d15 1
a15 1
-SHLIB_MINOR=	1.2.12
@


1.15
log
@We compile png with -DPNG_NO_ASSEMBLER_CODE. Unfortunately, the libpng build
system doesn't install a pngconf.h appropriate to the options passed to the
build.
So we have to put a PNG_NO_ASSEMBLER_CODE define into pngconf.h manually.
This unbreaks (at least) ImageMagick on amd64.

Some more information about this problem can be found here:

http://sourceforge.net/mailarchive/forum.php?thread_id=10314069&forum_id=43850

Since we don't want to compile pentium specific code,
remove -DPNG_USE_PNGGCCRD.

Bump major lib version and PKGNAME.

with help & ok steven@@, naddy@@
@
text
@d1 4
a4 4
$OpenBSD: patch-scripts_makefile_openbsd,v 1.14 2006/05/10 13:50:01 bernd Exp $
--- scripts/makefile.openbsd.orig	Sun Apr 23 20:45:40 2006
+++ scripts/makefile.openbsd	Sat May 13 13:21:46 2006
@@@@ -3,12 +3,12 @@@@
d11 2
a12 2
+INCDIR=	${PREFIX}/include/libpng
+DOCDIR=	${PREFIX}/share/doc/png
d15 2
a16 2
-SHLIB_MINOR=	1.2.10
-
d19 1
a19 2
 	pngread.c pngrio.c pngrtran.c pngrutil.c pngset.c pngtrans.c \
@@@@ -17,28 +17,46 @@@@ SRCS=	png.c pngerror.c pnggccrd.c pngget
d72 1
a72 1
@@@@ -52,21 +70,24 @@@@ beforeinstall:
@


1.14
log
@Update to png-1.2.10 and better DESCR.

ok naddy@@
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
+++ scripts/makefile.openbsd	Tue May  9 15:07:40 2006
d20 6
a25 1
@@@@ -21,24 +21,42 @@@@ CPPFLAGS+= -I${.CURDIR} -DPNG_NO_ASSEMBL
@


1.13
log
@SHARED_LIBS
feedback and ok naddy@@
@
text
@d1 4
a4 6
--- scripts/makefile.openbsd.orig	Fri Dec  3 01:14:31 2004
+++ scripts/makefile.openbsd	Mon Dec 26 22:46:14 2005
@@@@ -1,14 +1,14 @@@@
-# makefile for libpng
+# makefile for libpng under OpenBSD
 # Copyright (C) 1995 Guy Eric Schalnat, Group 42, Inc.
d8 1
a8 1
+BINDIR=	${PREFIX}/bin
d10 1
a10 2
-MANDIR= ${PREFIX}/man/cat
+MANDIR=	${PREFIX}/man/cat
d15 1
a15 1
-SHLIB_MINOR=	1.2.8
d20 1
a20 1
@@@@ -21,24 +21,39 @@@@ CPPFLAGS+= -I${.CURDIR} -DPNG_NO_ASSEMBL
d28 2
a29 2
-DOCS=	ANNOUNCE CHANGES LICENSE README libpng.txt
+DOCS=	README libpng.txt
a30 1
-pngtest.o:	pngtest.c
a32 4
+pngtest.o: pngtest.c
 	${CC} ${CPPFLAGS} ${CFLAGS} -c ${.ALLSRC} -o ${.TARGET}
 
-pngtest:	pngtest.o
d34 4
a37 1
+	cat scripts/libpng.pc.in | sed -e s\!@@PREFIX@@!$(PREFIX)! > libpng.pc
d49 4
a52 1
+pngtest: pngtest.o
d56 1
a56 1
+test regress: pngtest
d68 1
a68 1
@@@@ -52,21 +67,24 @@@@ beforeinstall:
@


1.12
log
@upgrade to png 1.2.8

From: Simon Dassow <janus at area319 dot de>
@
text
@d1 3
a3 3
--- scripts/makefile.openbsd.orig	Thu Dec  2 19:14:31 2004
+++ scripts/makefile.openbsd	Sun Jul 24 00:55:05 2005
@@@@ -1,13 +1,16 @@@@
d19 1
a19 3
+SHLIB_MAJOR=	4
+SHLIB_MINOR=	2
 
d22 2
a23 1
@@@@ -21,24 +24,39 @@@@ CPPFLAGS+= -I${.CURDIR} -DPNG_NO_ASSEMBL
d70 1
a70 1
@@@@ -52,21 +70,24 @@@@ beforeinstall:
@


1.11
log
@install pkgconfig file for png.

From: Jacob Meuser <jakemsr at jakemsr dot com>
@
text
@d1 2
a2 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.10 2004/09/20 01:24:11 brad Exp $
--- scripts/makefile.openbsd.orig	Sat Sep 11 22:19:36 2004
+++ scripts/makefile.openbsd	Thu Oct 14 03:48:56 2004
d18 1
a18 1
-SHLIB_MINOR=	1.2.7
d20 1
a20 1
+SHLIB_MINOR=	1
@


1.10
log
@upgrade to png 1.2.7
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.9 2004/07/06 21:53:16 brad Exp $
d3 1
a3 1
+++ scripts/makefile.openbsd	Sat Sep 18 22:43:38 2004
d25 1
a25 1
@@@@ -21,24 +24,36 @@@@ CPPFLAGS+= -I${.CURDIR} -DPNG_NO_ASSEMBL
d37 1
a37 1
+all: ${_LIBS} libpng-config
d43 3
d72 1
a72 1
@@@@ -52,21 +67,19 @@@@ beforeinstall:
d81 3
d98 2
a99 1
-	${INSTALL} ${INSTALL_COPY} -o ${SHAREOWN} -g ${SHAREGRP} \
@


1.9
log
@sync
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.8 2004/04/06 08:32:45 brad Exp $
--- scripts/makefile.openbsd.orig	Thu Oct  3 07:32:34 2002
+++ scripts/makefile.openbsd	Tue Jul  6 17:33:35 2004
d19 1
a19 1
-SHLIB_MINOR=	1.2.5
d21 1
a21 1
+SHLIB_MINOR=	0
@


1.8
log
@remove LDADD instead of leaving it empty.
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.7 2004/02/25 20:24:41 brad Exp $
--- scripts/makefile.openbsd.orig	2002-10-03 07:32:34.000000000 -0400
+++ scripts/makefile.openbsd	2004-04-06 03:49:40.000000000 -0400
a88 2
-	${INSTALL} ${INSTALL_COPY} -o ${SHAREOWN} -g ${SHAREGRP} \
-		-m ${NONBINMODE} ${HDRS} ${DESTDIR}${PREFIX}/include
d91 2
@


1.7
log
@oops, check -> regress
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.6 2004/02/24 23:18:58 brad Exp $
d3 1
a3 1
+++ scripts/makefile.openbsd	2004-02-25 15:22:57.000000000 -0500
d25 1
a25 5
@@@@ -18,27 +21,40 @@@@ HDRS=	png.h pngconf.h
 
 CFLAGS+= -Wall
 CPPFLAGS+= -I${.CURDIR} -DPNG_NO_ASSEMBLER_CODE -DPNG_USE_PNGGCCRD
+LDADD=
d69 1
a69 1
@@@@ -52,21 +68,19 @@@@ beforeinstall:
@


1.6
log
@- add license marker
- remove REGRESS_TARGET and add a check target to the png Makefile
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.5 2003/12/18 00:09:48 espie Exp $
d3 1
a3 1
+++ scripts/makefile.openbsd	2004-02-24 18:16:55.000000000 -0500
d61 1
a61 1
+test check: pngtest
@


1.5
log
@Unlink png from zlib, bump major number.
Breaks lbreakout2 and pdflib, we don't really care, we'll fix them.
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.4 2003/01/25 05:52:21 brad Exp $
--- scripts/makefile.openbsd.orig	2002-10-03 13:32:34.000000000 +0200
+++ scripts/makefile.openbsd	2003-12-17 02:21:50.000000000 +0100
d25 1
a25 1
@@@@ -18,17 +21,30 @@@@ HDRS=	png.h pngconf.h
d39 3
d43 1
a43 3
+all: ${_LIBS} libpng-config
 
 pngtest.o:	pngtest.c
d46 1
d57 1
a57 1
 pngtest:	pngtest.o
d60 3
a62 1
@@@@ -37,8 +53,8 @@@@ test:	pngtest
@


1.4
log
@- strip out some useless docs
- install libpng-config
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.3 2002/10/30 23:55:27 brad Exp $
--- scripts/makefile.openbsd.orig	Thu Oct  3 07:32:34 2002
+++ scripts/makefile.openbsd	Sat Jan 25 00:32:05 2003
d20 2
a21 2
+SHLIB_MAJOR=	3
+SHLIB_MINOR=	1
d29 1
a29 1
+LDADD=	-lz
@


1.3
log
@upgrade to png 1.2.5
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_makefile_openbsd,v 1.2 2002/07/17 22:39:03 brad Exp $
d3 2
a4 2
+++ scripts/makefile.openbsd	Tue Oct 29 11:46:03 2002
@@@@ -1,13 +1,15 @@@@
d11 1
d25 1
a25 1
@@@@ -18,6 +20,7 @@@@ HDRS=	png.h pngconf.h
d33 26
a58 1
@@@@ -37,8 +40,8 @@@@ test:	pngtest
d69 1
a69 1
@@@@ -52,21 +55,17 @@@@ beforeinstall:
d85 2
d89 2
a92 2
-		-m ${NONBINMODE} ${HDRS} ${DESTDIR}${PREFIX}/include
-	${INSTALL} ${INSTALL_COPY} -o ${SHAREOWN} -g ${SHAREGRP} \
@


1.2
log
@upgrade to png 1.2.4
--
compat symlinks have been removed.
@
text
@d1 3
a3 3
$OpenBSD: patch-scripts_makefile_openbsd,v 1.1 2002/04/26 02:19:04 brad Exp $
--- scripts/makefile.openbsd.orig	Wed May 22 21:35:26 2002
+++ scripts/makefile.openbsd	Wed May 22 21:41:41 2002
d18 1
a18 1
-SHLIB_MINOR=	1.2.4
@


1.1
log
@upgrade to png 1.2.2
--
headers have been moved from include/ to include/libpng/.
for the short term sym-links have been created in include/ but will
be removed once all ports have been checked. porters should @@comment out
the sym-links to check ports locally.
@
text
@d1 3
a3 3
$OpenBSD$
--- scripts/makefile.openbsd.orig	Mon Apr 15 10:25:46 2002
+++ scripts/makefile.openbsd	Sun Apr 21 16:16:34 2002
d18 1
a18 1
-SHLIB_MINOR=	1.2.2
d20 1
a20 1
+SHLIB_MINOR=	0
d43 1
a43 1
@@@@ -52,19 +55,17 @@@@ beforeinstall:
d63 2
@

