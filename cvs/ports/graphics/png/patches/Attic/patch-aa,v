head	1.15;
access;
symbols
	OPENBSD_2_7:1.12.0.4
	OPENBSD_2_7_BASE:1.12
	OPENBSD_2_6:1.12.0.2
	OPENBSD_2_6_BASE:1.12
	OPENBSD_2_5:1.10.0.2
	OPENBSD_2_5_BASE:1.10
	OPENBSD_2_4:1.7.0.2
	OPENBSD_2_4_BASE:1.7
	OPENBSD_2_3:1.6.0.2
	OPENBSD_2_3_BASE:1.6
	png0_96:1.1.1.1
	angelos:1.1.1;
locks; strict;
comment	@# @;


1.15
date	2000.06.25.02.20.52;	author brad;	state dead;
branches;
next	1.14;

1.14
date	2000.06.22.08.21.49;	author brad;	state Exp;
branches;
next	1.13;

1.13
date	2000.05.21.10.40.23;	author fgsch;	state Exp;
branches;
next	1.12;

1.12
date	99.06.11.18.25.48;	author brad;	state Exp;
branches
	1.12.4.1;
next	1.11;

1.11
date	99.05.08.18.13.52;	author brad;	state Exp;
branches;
next	1.10;

1.10
date	99.04.04.23.44.50;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	99.03.14.07.27.12;	author csapuntz;	state Exp;
branches;
next	1.8;

1.8
date	99.03.13.19.08.37;	author csapuntz;	state Exp;
branches;
next	1.7;

1.7
date	98.09.11.21.11.07;	author marc;	state Exp;
branches;
next	1.6;

1.6
date	98.03.21.05.00.02;	author marc;	state Exp;
branches;
next	1.5;

1.5
date	98.03.13.00.38.00;	author jason;	state Exp;
branches;
next	1.4;

1.4
date	98.02.10.10.45.18;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	98.02.04.16.29.07;	author don;	state Exp;
branches;
next	1.2;

1.2
date	98.02.04.02.21.12;	author don;	state Exp;
branches;
next	1.1;

1.1
date	97.12.03.03.39.50;	author angelos;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	97.12.03.03.39.50;	author angelos;	state Exp;
branches;
next	;

1.12.4.1
date	2000.09.15.04.53.39;	author marc;	state dead;
branches;
next	;


desc
@@


1.15
log
@use --mode option with libtool
@
text
@--- scripts/makefile.std.orig	Wed Dec  8 18:44:40 1999
+++ scripts/makefile.std	Thu Jun 22 04:04:46 2000
@@@@ -8,8 +8,6 @@@@
 # Where the zlib library and include files are located
 #ZLIBLIB=/usr/local/lib
 #ZLIBINC=/usr/local/include
-ZLIBLIB=../zlib
-ZLIBINC=../zlib
 
 CC=cc
 CFLAGS=-I$(ZLIBINC) -O # -g -DPNG_DEBUG=5
@@@@ -18,34 +16,35 @@@@
 #RANLIB=echo
 RANLIB=ranlib
 
-OBJS = png.o pngset.o pngget.o pngrutil.o pngtrans.o pngwutil.o \
-	pngread.o pngrio.o pngwio.o pngwrite.o pngrtran.o \
-	pngwtran.o pngmem.o pngerror.o pngpread.o
+OBJS = png.lo pngset.lo pngget.lo pngrutil.lo pngtrans.lo pngwutil.lo \
+	pngread.lo pngrio.lo pngwio.lo pngwrite.lo pngrtran.lo \
+	pngwtran.lo pngmem.lo pngerror.lo pngpread.lo
 
 all: libpng.a pngtest
 
+.SUFFIXES: .c .lo
+
+.c.lo:
+	libtool $(CC) $(CFLAGS) -c $(.IMPSRC)
+
 libpng.a: $(OBJS)
-	ar rc $@@  $(OBJS)
-	$(RANLIB) $@@
+	libtool $(CC) $(CFLAGS) -o libpng.la $(OBJS) \
+	 -version-info 1:6:0 -rpath $(prefix)/lib
 
-pngtest: pngtest.o libpng.a
-	$(CC) -o pngtest $(CFLAGS) pngtest.o $(LDFLAGS)
+pngtest: pngtest.lo libpng.a
+	libtool $(CC) -o pngtest $(CFLAGS) pngtest.lo $(LDFLAGS)
 
 test: pngtest
 	./pngtest
 
 install: libpng.a
-	-@@mkdir $(prefix)/include
-	-@@mkdir $(prefix)/lib
-	cp png.h $(prefix)/include
-	cp pngconf.h $(prefix)/include
-	chmod 644 $(prefix)/include/png.h
-	chmod 644 $(prefix)/include/pngconf.h
-	cp libpng.a $(prefix)/lib
-	chmod 644 $(prefix)/lib/libpng.a
+	${BSD_INSTALL_DATA_DIR} $(DESTDIR)$(prefix)/include
+	${BSD_INSTALL_DATA_DIR} $(DESTDIR)$(prefix)/lib
+	${BSD_INSTALL_DATA} png.h pngconf.h $(DESTDIR)$(prefix)/include
+	libtool ${BSD_INSTALL_DATA} libpng.la $(DESTDIR)$(prefix)/lib
 
 clean:
-	rm -f *.o libpng.a pngtest pngout.png
+	rm -f *.o *.lo libpng.a pngtest pngout.png
 
 DOCS = ANNOUNCE CHANGES INSTALL KNOWNBUG LICENSE README TODO Y2KINFO
 writelock:
@@@@ -53,20 +52,19 @@@@
 
 # DO NOT DELETE THIS LINE -- make depend depends on it.
 
-png.o: png.h pngconf.h
-pngerror.o: png.h pngconf.h
-pngrio.o: png.h pngconf.h
-pngwio.o: png.h pngconf.h
-pngmem.o: png.h pngconf.h
-pngset.o: png.h pngconf.h
-pngget.o: png.h pngconf.h
-pngread.o: png.h pngconf.h
-pngrtran.o: png.h pngconf.h
-pngrutil.o: png.h pngconf.h
-pngtest.o: png.h pngconf.h
-pngtrans.o: png.h pngconf.h
-pngwrite.o: png.h pngconf.h
-pngwtran.o: png.h pngconf.h
-pngwutil.o: png.h pngconf.h
-pngpread.o: png.h pngconf.h
-
+png.lo: png.h pngconf.h
+pngerror.lo: png.h pngconf.h
+pngrio.lo: png.h pngconf.h
+pngwio.lo: png.h pngconf.h
+pngmem.lo: png.h pngconf.h
+pngset.lo: png.h pngconf.h
+pngget.lo: png.h pngconf.h
+pngread.lo: png.h pngconf.h
+pngrtran.lo: png.h pngconf.h
+pngrutil.lo: png.h pngconf.h
+pngtest.lo: png.h pngconf.h
+pngtrans.lo: png.h pngconf.h
+pngwrite.lo: png.h pngconf.h
+pngwtran.lo: png.h pngconf.h
+pngwutil.lo: png.h pngconf.h
+pngpread.lo: png.h pngconf.h
@


1.14
log
@- remove license type
- remove FAKE=Yes
- remove unnecessary pre-patch target and replace with usage of MAKE_FILE
- switch to libtool for shared library creation
@
text
@@


1.13
log
@Update to png-1.0.6; too many changes to list here.
@
text
@d1 3
a3 9
--- Makefile.orig	Sun May 21 06:47:39 2000
+++ Makefile	Sun May 21 06:49:59 2000
@@@@ -3,17 +3,19 @@@@
 # For conditions of distribution and use, see copyright notice in png.h
 
 # where make install puts libpng.a and png.h
-prefix=/usr/local
+prefix=${PREFIX}
 
a8 11
+#ZLIBLIB=../zlib
+#ZLIBINC=../zlib
 
-CC=cc
-CFLAGS=-I$(ZLIBINC) -O # -g -DPNG_DEBUG=5
-LDFLAGS=-L. -L$(ZLIBLIB) -lpng -lz -lm
+VER=1.6
+#CC=cc
+#CFLAGS=-I$(ZLIBINC) -O # -g -DPNG_DEBUG=5
+#LDFLAGS=-L. -L$(ZLIBLIB) -lpng -lz -lm
+LDFLAGS=-L. -lpng -lz -lm
d10 3
a14 3
@@@@ -22,12 +24,20 @@@@
 	pngread.o pngrio.o pngwio.o pngwrite.o pngrtran.o \
 	pngwtran.o pngmem.o pngerror.o pngpread.o
d16 10
a25 2
-all: libpng.a pngtest
+.SUFFIXES: .c .so .o
d27 2
a28 2
+.c.so:
+	${CC} -fpic -DPIC ${CFLAGS} -c ${.IMPSRC} -o ${.TARGET}
a29 2
+all: libpng.a libpng.so.${VER}
 
d31 9
a39 2
 	ar rc $@@  $(OBJS)
 	$(RANLIB) $@@
d41 2
a42 5
+libpng.so.${VER}: $(OBJS:S/o$/so/g)
+	ld -Bshareable -Bforcearchive -x -assert pure-text -o $@@ $(OBJS:S/o$/so/g) -lz
+
 pngtest: pngtest.o libpng.a
 	$(CC) -o pngtest $(CFLAGS) pngtest.o $(LDFLAGS)
a43 1
@@@@ -37,12 +47,10 @@@@
d45 2
a46 2
 	-@@mkdir $(prefix)/include
 	-@@mkdir $(prefix)/lib
d53 4
a56 4
+	${BSD_INSTALL_DATA} png.h pngconf.h $(prefix)/include
+	${BSD_INSTALL_DATA} libpng.a $(prefix)/lib
+	${RANLIB} $(prefix)/lib/libpng.a
+	${BSD_INSTALL_DATA} libpng.so.${VER} $(prefix)/lib
d59 42
a100 1
 	rm -f *.o libpng.a pngtest pngout.png
@


1.12
log
@use -fpic instead of -fPIC and use -Bforcearchive while linking
@
text
@d1 3
a3 3
--- Makefile.orig	Sat May  8 13:28:29 1999
+++ Makefile	Sat May  8 13:40:34 1999
@@@@ -3,17 +3,18 @@@@
d21 1
a21 1
+VER=1.3
d24 1
d29 1
a29 1
@@@@ -22,12 +23,20 @@@@
d51 1
a51 1
@@@@ -37,12 +46,10 @@@@
@


1.12.4.1
log
@bring graphics as of cut-over date into 2.7 branch
@
text
@@


1.11
log
@- fixup non-shared lib situation so the port will not make shared
libs on any arch that does not have shared libs, not just alpha.
@
text
@d36 1
a36 1
+	${CC} -fPIC -DPIC ${CFLAGS} -c ${.IMPSRC} -o ${.TARGET}
d45 1
a45 1
+	ld -Bshareable -x -assert pure-text -o $@@ $(OBJS:S/o$/so/g) -lz
@


1.10
log
@Don't lie about ZLIB, it's not under /usr/local, and we don't need to
specify anything to use it since it's in the standard place.
@
text
@d1 2
a2 2
--- Makefile	Sat Mar 13 11:05:57 1999
+++ Makefile.mine	Sat Mar 13 11:01:58 1999
d11 2
a12 2
-#ZLIBLIB=/usr/local/lib
-#ZLIBINC=/usr/local/include
d15 3
a17 1
-
a20 5
+#ZLIBLIB=/usr/local/lib
+#ZLIBINC=/usr/local/include
+#ZLIBLIB=../zlib
+#ZLIBINC=../zlib
+
d28 1
a28 1
@@@@ -22,12 +23,27 @@@@
d36 1
a36 1
+	${CC} -fpic -DPIC ${CFLAGS} -c ${.IMPSRC} -o ${.TARGET}
a37 1
+.if (${MACHINE_ARCH} != "alpha")
a38 3
+.else
+all: libpng.a
+.endif
a43 1
+.if (${MACHINE_ARCH} != "alpha")
a45 2
+.endif
+
d50 1
a50 1
@@@@ -37,12 +53,12 @@@@
a62 1
+.if(${MACHINE_ARCH} != "alpha")
a63 1
+.endif
@


1.9
log
@

Version number should have been bumped.
@
text
@d19 2
a20 2
+ZLIBLIB=/usr/local/lib
+ZLIBINC=/usr/local/include
@


1.8
log
@

updated for libpng-1.0.3.
@
text
@d24 1
a24 1
+VER=1.2
@


1.7
log
@update to version 1.2
@
text
@d1 3
a3 3
--- Makefile.~1~	Fri Sep 11 13:21:25 1998
+++ Makefile	Fri Sep 11 13:30:28 1998
@@@@ -3,31 +3,46 @@@@
d6 4
d31 1
a31 6
 
 # where make install puts libpng.a and png.h
-prefix=/usr/local
+prefix=${PREFIX}
 
 OBJS = png.o pngset.o pngget.o pngrutil.o pngtrans.o pngwutil.o \
d56 1
d60 1
a60 1
@@@@ -37,12 +52,12 @@@@
@


1.6
log
@update to 1.0.1 as 1.0.0 is no longer available;
Install man pages and doc.
@
text
@d1 2
a2 2
--- Makefile.~1~	Fri Mar 20 20:19:03 1998
+++ Makefile	Fri Mar 20 20:23:32 1998
d13 1
a13 1
-CFLAGS=-I$(ZLIBINC) -O # -g -DPNG_DEBUG=1
d20 1
a20 1
+VER=1.1
d22 2
a23 2
+#CFLAGS=-I$(ZLIBINC) -O # -g -DPNG_DEBUG=1
+LDFLAGS=-L. -lpng -lz -lm -static
d60 1
a60 1
@@@@ -37,12 +52,15 @@@@
d70 3
a72 5
+	${INSTALL} -c -m 644 -o ${BINOWN} -g ${BINGRP} png.h pngconf.h \
+		$(prefix)/include
+	${INSTALL} -c -m 644 -o ${BINOWN} -g ${BINGRP} libpng.a \
+		$(prefix)/lib
+	ranlib $(prefix)/lib/libpng.a
d74 1
a74 2
+	${INSTALL} -c -m 644 -o ${BINOWN} -g ${BINGRP} libpng.so.${VER} \
+		$(prefix)/lib
@


1.5
log
@updated to png-1.0.0
@
text
@d1 81
a81 105
*** scripts/makefile.std	Sat Mar  7 15:12:04 1998
--- Makefile	Tue Mar 10 02:46:31 1998
***************
*** 5,33 ****
  # Where the zlib library and include files are located
  #ZLIBLIB=/usr/local/lib
  #ZLIBINC=/usr/local/include
! ZLIBLIB=../zlib
! ZLIBINC=../zlib
  
! CC=cc
! CFLAGS=-I$(ZLIBINC) -O # -g -DPNG_DEBUG=1
! LDFLAGS=-L. -L$(ZLIBLIB) -lpng -lz -lm
  
  #RANLIB=echo
  RANLIB=ranlib
  
  # where make install puts libpng.a and png.h
! prefix=/usr/local
  
  OBJS = png.o pngset.o pngget.o pngrutil.o pngtrans.o pngwutil.o \
  	pngread.o pngrio.o pngwio.o pngwrite.o pngrtran.o \
  	pngwtran.o pngmem.o pngerror.o pngpread.o
  
! all: libpng.a pngtest
  
  libpng.a: $(OBJS)
  	ar rc $@@  $(OBJS)
  	$(RANLIB) $@@
  
  pngtest: pngtest.o libpng.a
  	$(CC) -o pngtest $(CFLAGS) pngtest.o $(LDFLAGS)
  
--- 5,48 ----
  # Where the zlib library and include files are located
  #ZLIBLIB=/usr/local/lib
  #ZLIBINC=/usr/local/include
! #ZLIBLIB=../zlib
! #ZLIBINC=../zlib
  
! VER=1.0
! #CC=cc
! #CFLAGS=-I$(ZLIBINC) -O # -g -DPNG_DEBUG=1
! LDFLAGS=-L. -lpng -lz -lm -static
  
  #RANLIB=echo
  RANLIB=ranlib
  
  # where make install puts libpng.a and png.h
! prefix=${PREFIX}
  
  OBJS = png.o pngset.o pngget.o pngrutil.o pngtrans.o pngwutil.o \
  	pngread.o pngrio.o pngwio.o pngwrite.o pngrtran.o \
  	pngwtran.o pngmem.o pngerror.o pngpread.o
  
! .SUFFIXES: .c .so .o
! 
! .c.so:
! 	${CC} -fpic -DPIC ${CFLAGS} -c ${.IMPSRC} -o ${.TARGET}
! 
! .if (${MACHINE_ARCH} != "alpha")
! all: libpng.a libpng.so.${VER}
! .else
! all: libpng.a
! .endif
  
  libpng.a: $(OBJS)
  	ar rc $@@  $(OBJS)
  	$(RANLIB) $@@
  
+ .if (${MACHINE_ARCH} != "alpha")
+ libpng.so.${VER}: $(OBJS:S/o$/so/g)
+ 	ld -Bshareable -x -assert pure-text -o $@@ $(OBJS:S/o$/so/g) -lz
+ .endif
+ 
  pngtest: pngtest.o libpng.a
  	$(CC) -o pngtest $(CFLAGS) pngtest.o $(LDFLAGS)
  
***************
*** 37,48 ****
  install: libpng.a
  	-@@mkdir $(prefix)/include
  	-@@mkdir $(prefix)/lib
! 	cp png.h $(prefix)/include
! 	cp pngconf.h $(prefix)/include
! 	chmod 644 $(prefix)/include/png.h
! 	chmod 644 $(prefix)/include/pngconf.h
! 	cp libpng.a $(prefix)/lib
! 	chmod 644 $(prefix)/lib/libpng.a
  
  clean:
  	rm -f *.o libpng.a pngtest pngout.png
--- 52,63 ----
  install: libpng.a
  	-@@mkdir $(prefix)/include
  	-@@mkdir $(prefix)/lib
! 	${INSTALL} -c -m 644 -o ${BINOWN} -g ${BINGRP} png.h pngconf.h $(prefix)/include
! 	${INSTALL} -c -m 644 -o ${BINOWN} -g ${BINGRP} libpng.a $(prefix)/lib
! 	ranlib $(prefix)/lib/libpng.a
! .if(${MACHINE_ARCH} != "alpha")
! 	${INSTALL} -c -m 644 -o ${BINOWN} -g ${BINGRP} libpng.so.${VER} $(prefix)/lib
! .endif
  
  clean:
  	rm -f *.o libpng.a pngtest pngout.png
@


1.4
log
@On a current system LDCONFIG need not be special cased for mips/alpha
@
text
@d1 2
a2 2
*** makefile.orig	Fri May 16 01:53:30 1997
--- makefile	Wed Feb  4 10:32:36 1998
d32 1
a32 1
  	$(CC) -o pngtest $(CCFLAGS) pngtest.o $(LDFLAGS)
d41 1
a41 1
! VER=0.96
d77 1
a77 1
  	$(CC) -o pngtest $(CCFLAGS) pngtest.o $(LDFLAGS)
@


1.3
log
@Oops.  Don't install .so's on alpha either.
@
text
@d93 1
a93 1
--- 52,69 ----
a101 4
! .if(${MACHINE_ARCH} == "mips")
! 	${LDCONFIG} -n ${PREFIX}/lib
! .else
! 	${LDCONFIG} -m ${PREFIX}/lib
a102 2
! .endif
! 
@


1.2
log
@Don't build shared libs on alpha
@
text
@d2 1
a2 1
--- makefile	Tue Feb  3 20:22:33 1998
d93 1
a93 1
--- 52,68 ----
d98 1
a98 1
! 	${INSTALL} -c -m 644 -o ${BINOWN} -g ${BINGRP} libpng.a libpng.so.${VER} $(prefix)/lib
d101 1
@


1.1
log
@Initial revision
@
text
@d1 2
a2 2
*** makefile.orig	Fri May 16 10:53:30 1997
--- makefile	Tue Jun 24 16:53:47 1997
d34 1
a34 1
--- 5,42 ----
d61 1
d63 3
d71 1
d74 1
d93 1
a93 1
--- 46,54 ----
d100 8
@


1.1.1.1
log
@Add libpng port.
@
text
@@

