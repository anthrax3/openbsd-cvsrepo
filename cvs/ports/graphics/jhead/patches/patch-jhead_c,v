head	1.12;
access;
symbols
	OPENBSD_6_2:1.12.0.12
	OPENBSD_6_2_BASE:1.12
	OPENBSD_6_1:1.12.0.10
	OPENBSD_6_1_BASE:1.12
	OPENBSD_6_0:1.12.0.8
	OPENBSD_6_0_BASE:1.12
	OPENBSD_5_9:1.12.0.4
	OPENBSD_5_9_BASE:1.12
	OPENBSD_5_8:1.12.0.6
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_7:1.12.0.2
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.11.0.6
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.4
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.2
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.10.0.2
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.9.0.12
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.9
	OPENBSD_5_1:1.9.0.10
	OPENBSD_5_0:1.9.0.8
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_9:1.9.0.6
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.9.0.4
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.9.0.2
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.6.0.4
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.2
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.5.0.2
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.4.0.8
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.6
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.4
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.2
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.3.0.8
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.6
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.4
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.2
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.1.1.1.0.2
	OPENBSD_3_4_BASE:1.1.1.1
	naddy_20030718:1.1.1.1
	naddy:1.1.1;
locks; strict;
comment	@# @;


1.12
date	2015.02.04.07.00.15;	author benoit;	state Exp;
branches;
next	1.11;
commitid	2DCVDqAme7y0iGKC;

1.11
date	2013.03.08.07.54.31;	author benoit;	state Exp;
branches;
next	1.10;

1.10
date	2013.01.13.13.38.32;	author benoit;	state Exp;
branches;
next	1.9;

1.9
date	2009.11.19.14.14.40;	author okan;	state Exp;
branches;
next	1.8;

1.8
date	2009.11.19.08.05.14;	author stephan;	state Exp;
branches;
next	1.7;

1.7
date	2009.10.01.20.20.27;	author benoit;	state Exp;
branches;
next	1.6;

1.6
date	2008.10.21.23.47.52;	author okan;	state Exp;
branches;
next	1.5;

1.5
date	2008.04.24.19.36.14;	author okan;	state Exp;
branches;
next	1.4;

1.4
date	2006.05.29.17.40.24;	author sturm;	state Exp;
branches;
next	1.3;

1.3
date	2004.07.18.20.21.03;	author xsa;	state Exp;
branches;
next	1.2;

1.2
date	2004.01.16.23.26.01;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2003.07.17.22.07.06;	author naddy;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.07.17.22.07.06;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.12
log
@Update to jhead-3.00.
@
text
@--- jhead.c.orig	Mon Feb  2 23:24:06 2015
+++ jhead.c	Wed Feb  4 07:43:36 2015
@@@@ -164,7 +164,8 @@@@
         }
         if (strlen(Editor) > PATH_MAX) ErrFatal("env too long");
 
-        sprintf(QuotedPath, "%s \"%s\"",Editor, TempFileName);
+        snprintf(QuotedPath, sizeof(QuotedPath), "%s \"%s\"",Editor,
+	    TempFileName);
         a = system(QuotedPath);
     }
 
@@@@ -271,7 +272,8 @@@@
     if (!HasScandate && !ImageInfo.DateTime[0]){
         // Scan date is not in the file yet, and it doesn't have one built in.  Add it.
         char Temp[40];
-        sprintf(Temp, "scan_date=%s", ctime(&ImageInfo.FileDateTime));
+        snprintf(Temp, sizeof(Temp),
+            "scan_date=%s", ctime(&ImageInfo.FileDateTime));
         strncat(OutComment, Temp, MAX_COMMENT_SIZE-5-strlen(OutComment));
         Modified = TRUE;
     }
@@@@ -303,8 +305,10 @@@@
 
     if (scale < 0.4) scale = 0.4; // Don't scale down by too much.
 
-    sprintf(CommandString, "mogrify -geometry %dx%d -quality 85 &i",(int)(ImageInfo.Width*scale+0.5), 
-                                    (int)(ImageInfo.Height*scale+0.5));
+    snprintf(CommandString, sizeof(CommandString),
+        "mogrify -geometry %dx%d -quality 85 &i",
+        (int)(ImageInfo.Width*scale+0.5), (int)(ImageInfo.Height*scale+0.5));
+
     return TRUE;
 }
 
@@@@ -625,7 +629,8 @@@@
                         memcpy(pat, pattern+ppos, 4);
                         pat[a-ppos] = 'd'; // Replace 'i' with 'd' for '%d'
                         pat[a-ppos+1] = '\0';
-                        sprintf(num, pat, FileSequence); // let printf do the number formatting.
+			// let printf do the number formatting.
+			snprintf(num, sizeof(num), pat, FileSequence);
                         nl = strlen(num);
                         l = strlen(pattern+a+1);
                         if (ppos+nl+l+1 >= PATH_MAX) ErrFatal("str overflow");
@@@@ -641,7 +646,7 @@@@
         strftime(NewName, PATH_MAX, pattern, &tm);
     }else{
         // My favourite scheme.
-        sprintf(NewName, "%02d%02d-%02d%02d%02d",
+        snprintf(NewName, sizeof(NewName), "%02d%02d-%02d%02d%02d",
              tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec);
     }
 
@@@@ -670,7 +675,7 @@@@
             NameExtra[0] = 0;
         }
 
-        sprintf(NewName, "%s%s.jpg", NewBaseName, NameExtra);
+        snprintf(NewName, sizeof(NewName), "%s%s.jpg", NewBaseName, NameExtra);
 
         if (!strcmp(FileName, NewName)) break; // Skip if its already this name.
 
@@@@ -685,7 +690,8 @@@@
                 printf("%s --> %s\n",FileName, NewName);
 #ifdef _WIN32
                 if (RenameAssociatedFiles){
-                    sprintf(NewName, "%s%s", NewBaseName, NameExtra);
+                    snprintf(NewName, sizeof(NewName),
+			"%s%s", NewBaseName, NameExtra);
                     RenameAssociated(FileName, NewName);
                 }
 #endif
@@@@ -718,7 +724,8 @@@@
                 ErrNonfatal("Unknown orientation tag",0,0);
                 return TRUE; // Image is still modified.
             }
-            sprintf(RotateCommand, "jpegtran -trim -%s -outfile &o &i", Argument);
+            snprintf(RotateCommand, sizeof(RotateCommand), 
+                "jpegtran -trim -%s -outfile &o &i", Argument);
             ApplyCommand = RotateCommand;
             DoCommand(FileName, FALSE);
             ApplyCommand = NULL;
@@@@ -737,7 +744,8 @@@@
                 strcpy(ThumbTempName_out, FileName);
                 strcat(ThumbTempName_out, ".tho");
                 SaveThumbnail(ThumbTempName_in);
-                sprintf(RotateCommand,"jpegtran -trim -%s -outfile \"%s\" \"%s\"",
+                snprintf(RotateCommand, sizeof(RotateCommand), 
+                    "jpegtran -trim -%s -outfile \"%s\" \"%s\"",
                     Argument, ThumbTempName_out, ThumbTempName_in);
 
                 if (system(RotateCommand) == 0){
@@@@ -765,7 +773,8 @@@@
         return FALSE;
     }
 
-    sprintf(ThumbnailGenCommand, "mogrify -thumbnail %dx%d \"%s\"", 
+    snprintf(ThumbnailGenCommand, sizeof(ThumbnailGenCommand),
+        "mogrify -thumbnail %dx%d \"%s\"",
         RegenThumbnail, RegenThumbnail, FileName);
 
     if (system(ThumbnailGenCommand) == 0){
@@@@ -1134,7 +1143,7 @@@@
 
             // Print to temp buffer first to avoid putting null termination in destination.
             // snprintf() would do the trick, hbut not available everywhere (like FreeBSD 4.4)
-            sprintf(TempBuf, "%04d:%02d:%02d %02d:%02d:%02d",
+            snprintf(TempBuf, sizeof(TempBuf), "%04d:%02d:%02d %02d:%02d:%02d",
                 tm.tm_year+1900, tm.tm_mon+1, tm.tm_mday,
                 tm.tm_hour, tm.tm_min, tm.tm_sec);
             
@


1.11
log
@- update jhead to 2.97
- update patches

ok okan@@ (maintainer)
@
text
@d1 3
a3 4
$OpenBSD$
--- jhead.c.orig	Wed Jan 30 18:02:56 2013
+++ jhead.c	Tue Mar  5 15:05:10 2013
@@@@ -163,7 +163,8 @@@@
d13 1
a13 1
@@@@ -269,7 +270,8 @@@@
d23 1
a23 1
@@@@ -296,7 +298,9 @@@@
d27 2
a28 1
-    sprintf(CommandString, "mogrify -geometry %dx%d -quality 80 &i",(int)(ImageInfo.Width*scale), (int)(ImageInfo.Height*scale));
d30 3
a32 2
+        "mogrify -geometry %dx%d -quality 80 &i",
+        (int)(ImageInfo.Width*scale), (int)(ImageInfo.Height*scale));
d36 1
a36 1
@@@@ -611,7 +615,8 @@@@
d46 1
a46 1
@@@@ -627,7 +632,7 @@@@
d55 1
a55 1
@@@@ -656,7 +661,7 @@@@
d64 1
a64 1
@@@@ -671,7 +676,8 @@@@
d74 3
a76 2
@@@@ -704,7 +710,8 @@@@
                 ErrFatal("Orientation screwup");
a77 1
 
d84 1
a84 1
@@@@ -723,7 +730,8 @@@@
d94 1
a94 1
@@@@ -751,7 +759,8 @@@@
d104 1
a104 1
@@@@ -1091,7 +1100,7 @@@@
@


1.10
log
@- update jhead to 2.96
- update patches
- remove USE_GROFF

ok okan@@ (maintainer)
@
text
@d1 4
a4 3
--- jhead.c.orig	Fri Jun 22 17:00:21 2012
+++ jhead.c	Sat Jan 12 10:34:05 2013
@@@@ -162,7 +162,8 @@@@ static int FileEditComment(char * TempFileName, char *
d14 1
a14 1
@@@@ -268,7 +269,8 @@@@ static int ModifyDescriptComment(char * OutComment, ch
d17 1
a17 1
         char Temp[30];
d19 2
a20 2
+	snprintf(Temp, sizeof(Temp),
+	    "scan_date=%s", ctime(&ImageInfo.FileDateTime));
d24 1
a24 1
@@@@ -294,7 +296,9 @@@@ static int AutoResizeCmdStuff(void)
d26 1
a26 1
     if (scale < 0.5) scale = 0.5; // Don't scale down by more than a factor of two.
d28 1
a28 1
-    sprintf(CommandString, "mogrify -geometry %dx%d -quality 85 &i",(int)(ImageInfo.Width*scale), (int)(ImageInfo.Height*scale));
d30 1
a30 1
+        "mogrify -geometry %dx%d -quality 85 &i",
d35 1
a35 1
@@@@ -609,7 +613,8 @@@@ static void DoFileRenaming(const char * FileName)
d45 1
a45 1
@@@@ -625,7 +630,7 @@@@ static void DoFileRenaming(const char * FileName)
d54 1
a54 1
@@@@ -654,7 +659,7 @@@@ static void DoFileRenaming(const char * FileName)
d63 1
a63 1
@@@@ -669,7 +674,8 @@@@ static void DoFileRenaming(const char * FileName)
d73 1
a73 1
@@@@ -702,7 +708,8 @@@@ static int DoAutoRotate(const char * FileName)
d83 1
a83 1
@@@@ -721,7 +728,8 @@@@ static int DoAutoRotate(const char * FileName)
d93 1
a93 1
@@@@ -749,7 +757,8 @@@@ static int RegenerateThumbnail(const char * FileName)
d103 1
a103 1
@@@@ -1089,7 +1098,7 @@@@ void ProcessFile(const char * FileName)
@


1.9
log
@- don't hardcode CFLAGS
- fix an instance of a wrong sprintf() -> snprintf() conv.
and bump

ok sthen@@
@
text
@d1 3
a3 3
--- jhead.c.orig	Fri Nov  6 10:15:21 2009
+++ jhead.c	Wed Nov 18 20:39:50 2009
@@@@ -155,7 +155,8 @@@@ static int FileEditComment(char * TempFileName, char *
d13 1
a13 1
@@@@ -261,7 +262,8 @@@@ static int ModifyDescriptComment(char * OutComment, ch
d23 1
a23 1
@@@@ -287,7 +289,9 @@@@ static int AutoResizeCmdStuff(void)
@


1.8
log
@update to 2.88, ok sthen@@, ok and patch sync okan@@
@
text
@d2 1
a2 1
+++ jhead.c	Wed Nov 18 11:42:49 2009
d49 1
a49 1
+        snprintf(NewName, sizeof NewBaseName, "%02d%02d-%02d%02d%02d",
@


1.7
log
@- update jhead to 2.87
- update & regen patches

ok ajacoutot@@, okan@@
@
text
@d1 2
a2 2
--- jhead.c.orig	Mon Mar  2 08:34:10 2009
+++ jhead.c	Wed Sep 30 16:49:45 2009
d34 1
a34 1
@@@@ -601,7 +605,8 @@@@ static void DoFileRenaming(const char * FileName)
d44 1
a44 1
@@@@ -617,7 +622,7 @@@@ static void DoFileRenaming(const char * FileName)
d53 1
a53 1
@@@@ -646,7 +651,7 @@@@ static void DoFileRenaming(const char * FileName)
d62 1
a62 1
@@@@ -661,7 +666,8 @@@@ static void DoFileRenaming(const char * FileName)
d72 1
a72 1
@@@@ -694,7 +700,8 @@@@ static int DoAutoRotate(const char * FileName)
d82 1
a82 1
@@@@ -713,7 +720,8 @@@@ static int DoAutoRotate(const char * FileName)
d92 1
a92 1
@@@@ -741,7 +749,8 @@@@ static int RegenerateThumbnail(const char * FileName)
d102 1
a102 1
@@@@ -1081,7 +1090,7 @@@@ void ProcessFile(const char * FileName)
@


1.6
log
@- update to 2.84
- sync patches
- take maintainership

ok merdely
@
text
@d1 3
a3 5
$OpenBSD: patch-jhead_c,v 1.5 2008/04/24 19:36:14 okan Exp $
--- jhead.c.orig	Sat Oct  4 12:10:35 2008
+++ jhead.c	Sun Oct 19 19:19:22 2008
@@@@ -154,7 +154,8 @@@@ static int FileEditComment(char * TempFileName, char *
 #endif
d5 1
d12 2
a13 2
     
@@@@ -260,7 +261,8 @@@@ static int ModifyDescriptComment(char * OutComment, ch
d23 1
a23 1
@@@@ -286,7 +288,9 @@@@ static int AutoResizeCmdStuff(void)
d34 1
a34 19
@@@@ -316,13 +320,15 @@@@ static void DoCommand(const char * FileName, int ShowI
         if (ApplyCommand[a] == '&'){
             if (ApplyCommand[a+1] == 'i'){
                 // Input file.
-                e += sprintf(ExecString+e, "\"%s\"",FileName);
+                e += snprintf(ExecString+e, sizeof(ExecString) + e,
+		    "\"%s\"",FileName);
                 a += 1;
                 continue;
             }
             if (ApplyCommand[a+1] == 'o'){
                 // Needs an output file distinct from the input file.
-                e += sprintf(ExecString+e, "\"%s\"",TempName);
+                e += snprintf(ExecString+e, sizeof(ExecString) + e,
+		    "\"%s\"",TempName);
                 a += 1;
                 TempUsed = TRUE;
                 unlink(TempName);// Remove any pre-existing temp file
@@@@ -553,7 +559,8 @@@@ static void DoFileRenaming(const char * FileName)
d44 2
a45 2
@@@@ -570,8 +577,9 @@@@ static void DoFileRenaming(const char * FileName)
         strftime(NewBaseName+PrefixPart, PATH_MAX, pattern, &tm);
d48 3
a50 5
-        sprintf(NewBaseName+PrefixPart, "%02d%02d-%02d%02d%02d",
-             tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec);
+        snprintf(NewBaseName+PrefixPart, sizeof NewBaseName+PrefixPart,
+            "%02d%02d-%02d%02d%02d",
+            tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec);
d53 1
a53 2
     AddLetter = isdigit(NewBaseName[strlen(NewBaseName)-1]);
@@@@ -596,7 +604,7 @@@@ static void DoFileRenaming(const char * FileName)
d62 1
a62 1
@@@@ -606,7 +614,8 @@@@ static void DoFileRenaming(const char * FileName)
d72 1
a72 1
@@@@ -638,7 +647,8 @@@@ static int DoAutoRotate(const char * FileName)
d76 3
a78 3
-            sprintf(RotateCommand, "jpegtran -%s -outfile &o &i", Argument);
+            snprintf(RotateCommand, sizeof(RotateCommand),
+		"jpegtran -%s -outfile &o &i", Argument);
d82 1
a82 1
@@@@ -657,7 +667,8 @@@@ static int DoAutoRotate(const char * FileName)
d86 3
a88 3
-                sprintf(RotateCommand,"jpegtran -%s -outfile \"%s\" \"%s\"",
+                snprintf(RotateCommand, sizeof(RotateCommand),
+		    "jpegtran -%s -outfile \"%s\" \"%s\"",
d92 1
a92 1
@@@@ -685,7 +696,8 @@@@ static int RegenerateThumbnail(const char * FileName)
d102 1
a102 1
@@@@ -1025,7 +1037,7 @@@@ void ProcessFile(const char * FileName)
@


1.5
log
@- update to 2.82
- remove no longer needed sparc64 workaround
- add graphics/jpeg RUN_DEPENDS (for jpegtran)
- simplify build
- remove MAINTAINER, as requested

ok xsa@@ merdely@@
@
text
@d1 4
a4 4
$OpenBSD: patch-jhead_c,v 1.4 2006/05/29 17:40:24 sturm Exp $
--- jhead.c.orig	Thu Apr  3 10:52:21 2008
+++ jhead.c	Thu Apr 24 09:15:26 2008
@@@@ -153,7 +153,7 @@@@ static int FileEditComment(char * TempFileName, char *
d9 2
a10 1
+        snprintf(QuotedPath, sizeof(QuotedPath), "%s \"%s\"",Editor, TempFileName);
d14 1
a14 1
@@@@ -259,7 +259,8 @@@@ static int ModifyDescriptComment(char * OutComment, ch
d19 1
a19 1
+        snprintf(Temp, sizeof(Temp),
d21 1
a21 1
         strcat(OutComment, Temp);
d24 1
a24 1
@@@@ -285,7 +286,9 @@@@ static int AutoResizeCmdStuff(void)
d30 2
a31 2
+	"mogrify -geometry %dx%d -quality 85 &i",
+	(int)(ImageInfo.Width*scale), (int)(ImageInfo.Height*scale));
d35 1
a35 1
@@@@ -315,13 +318,15 @@@@ static void DoCommand(const char * FileName, int ShowI
d53 1
a53 1
@@@@ -551,7 +556,8 @@@@ static void DoFileRenaming(const char * FileName)
d59 5
a63 5
+                        snprintf(num, sizeof(num), pat, FileSequence);
                         memmove(pattern+ppos+strlen(num), pattern+a+1, strlen(pattern+a+1)+1);
                         memcpy(pattern+ppos, num, strlen(num));
                         break;
@@@@ -565,8 +571,9 @@@@ static void DoFileRenaming(const char * FileName)
d70 1
a70 1
+	    "%02d%02d-%02d%02d%02d",
d74 2
a75 2
     for (a=0;;a++){
@@@@ -590,7 +597,7 @@@@ static void DoFileRenaming(const char * FileName)
d84 1
a84 1
@@@@ -600,7 +607,8 @@@@ static void DoFileRenaming(const char * FileName)
d94 1
a94 1
@@@@ -632,7 +640,8 @@@@ static int DoAutoRotate(const char * FileName)
d104 1
a104 1
@@@@ -651,7 +660,8 @@@@ static int DoAutoRotate(const char * FileName)
d114 1
a114 1
@@@@ -679,7 +689,8 @@@@ static int RegenerateThumbnail(const char * FileName)
d120 1
a120 1
+	"mogrify -thumbnail %dx%d \"%s\"", 
d124 1
a124 1
@@@@ -1012,7 +1023,7 @@@@ void ProcessFile(const char * FileName)
@


1.4
log
@update to jhead 2.6

from reyk, xsa is too busy to take of this
@
text
@d1 4
a4 4
$OpenBSD$
--- jhead.c.orig	Tue May 23 08:50:41 2006
+++ jhead.c	Tue May 23 08:57:01 2006
@@@@ -163,7 +163,7 @@@@ static int FileEditComment(char * TempFi
d13 1
a13 1
@@@@ -269,7 +269,8 @@@@ static int ModifyDescriptComment(char * 
d23 1
a23 1
@@@@ -295,7 +296,9 @@@@ static int AutoResizeCmdStuff(void)
d34 1
a34 1
@@@@ -325,13 +328,15 @@@@ static void DoCommand(const char * FileN
d52 1
a52 1
@@@@ -559,7 +564,8 @@@@ static void DoFileRenaming(const char * 
d62 1
a62 1
@@@@ -573,8 +579,9 @@@@ static void DoFileRenaming(const char * 
d74 1
a74 1
@@@@ -598,7 +605,7 @@@@ static void DoFileRenaming(const char * 
d83 1
a83 1
@@@@ -608,7 +615,8 @@@@ static void DoFileRenaming(const char * 
d93 1
a93 1
@@@@ -640,7 +648,8 @@@@ static int DoAutoRotate(const char * Fil
d103 1
a103 1
@@@@ -659,7 +668,8 @@@@ static int DoAutoRotate(const char * Fil
d113 1
a113 1
@@@@ -687,7 +697,8 @@@@ static int RegenerateThumbnail(const cha
d123 1
a123 1
@@@@ -985,7 +996,7 @@@@ void ProcessFile(const char * FileName)
d126 1
a126 1
             // snprintf() would do the trick ,but not available everywhere (like FreeBSD 4.4)
d131 1
a131 1
 
@


1.3
log
@
update to jhead-2.2;
@
text
@d1 4
a4 4
$OpenBSD: patch-jhead_c,v 1.2 2004/01/16 23:26:01 naddy Exp $
--- jhead.c.orig	Mon Jul  5 19:28:00 2004
+++ jhead.c	Fri Jul 16 09:28:54 2004
@@@@ -153,7 +153,8 @@@@ static int FileEditComment(char * TempFi
d9 1
a9 2
+        snprintf(QuotedPath, sizeof QuotedPath, "%s \"%s\"",
+		Editor, TempFileName);
d13 1
a13 1
@@@@ -260,7 +261,8 @@@@ static int ModifyDescriptComment(char * 
d18 2
a19 2
+        snprintf(Temp, sizeof Temp, "scan_date=%s",
+		ctime(&ImageInfo.FileDateTime));
d23 1
a23 1
@@@@ -288,7 +290,9 @@@@ static int AutoResizeCmdStuff(void)
d25 1
a25 1
     if (scale > 0.8) return FALSE; // Don't rescale by really small amounts (not worth it!)
d27 3
a29 3
-    sprintf(CommandString, "mogrify -geometry %dx%d -quality 80 &i",(int)(ImageInfo.Width*scale), (int)(ImageInfo.Height*scale));
+    snprintf(CommandString, sizeof CommandString,
+	"mogrify -geometry %dx%d -quality 80 &i",
d34 2
a35 1
@@@@ -319,17 +323,20 @@@@ static void DoCommand(const char * FileN
d38 3
a40 10
                 if (strstr(FileName, " ")){
-                    e += sprintf(ExecString+e, "\"%s\"",FileName);
+                    e += snprintf(ExecString+e, sizeof ExecString+e,
+			"\"%s\"",FileName);
                 }else{
                     // No need for quoting (that way I can put a relative path in front)
-                    e += sprintf(ExecString+e, "%s",FileName);
+                    e += snprintf(ExecString+e, sizeof ExecString+e,
+			"%s",FileName);
                 }
d47 2
a48 2
+                e += snprintf(ExecString+e, sizeof ExecString+e, 
+			"\"%s\"",TempName);
d52 1
a52 2
@@@@ -494,7 +501,7 @@@@ void DoFileRenaming(const char * FileNam
                         char num[16];
d54 1
d56 3
a58 2
-                        sprintf(num, pat, FilesMatched); // let printf do the number formatting.
+                        snprintf(num, sizeof num, pat, FilesMatched); // let printf do the number formatting.
d62 1
a62 1
@@@@ -508,7 +515,8 @@@@ void DoFileRenaming(const char * FileNam
d67 1
d69 2
a70 2
+		"%02d%02d-%02d%02d%02d",
              tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec);
d73 2
a74 1
@@@@ -533,7 +541,7 @@@@ void DoFileRenaming(const char * FileNam
d79 1
a79 1
+        snprintf(NewName, sizeof NewName, "%s%s.jpg", NewBaseName, NameExtra);
d83 41
a123 11
@@@@ -617,7 +625,8 @@@@ void ProcessFile(const char * FileName)
                     if (Argument == NULL){
                         ErrFatal("Orientation screwup");
                     }
-                    sprintf(RotateCommand, "jpegtran -%s -outfile &o &i", Argument);
+                    snprintf(RotateCommand, sizeof RotateCommand,
+			"jpegtran -%s -outfile &o &i", Argument);
                     ApplyCommand = RotateCommand;
                     DoCommand(FileName);
                     ApplyCommand = NULL;
@@@@ -838,7 +847,7 @@@@ void ProcessFile(const char * FileName)
d128 1
a128 1
+            snprintf(TempBuf, sizeof TempBuf, "%04d:%02d:%02d %02d:%02d:%02d",
@


1.2
log
@update to 2.1; from Xavier Santolaria <xavier@@santolaria.net>
@
text
@d1 4
a4 4
$OpenBSD: patch-jhead_c,v 1.1.1.1 2003/07/17 22:07:06 naddy Exp $
--- jhead.c.orig	2004-01-14 19:48:42.000000000 +0100
+++ jhead.c	2004-01-14 20:42:41.000000000 +0100
@@@@ -151,7 +151,8 @@@@ static int FileEditComment(char * TempFi
d9 1
a9 1
+        snprintf(QuotedPath, sizeof QuotedPath, "%s \"%s\"", 
d14 1
a14 1
@@@@ -258,7 +259,8 @@@@ static int ModifyDescriptComment(char * 
d19 1
a19 1
+        snprintf(Temp, sizeof Temp, "scan_date=%s", 
d24 1
a24 1
@@@@ -286,7 +288,9 @@@@ static int AutoResizeCmdStuff(void)
d29 3
a31 3
+    snprintf(CommandString, sizeof CommandString, 
+	"mogrify -geometry %dx%d -quality 80 &i", 
+		(int)(ImageInfo.Width*scale), (int)(ImageInfo.Height*scale));
d35 1
a35 1
@@@@ -317,17 +321,20 @@@@ static void DoCommand(const char * FileN
d40 1
a40 1
+                    e += snprintf(ExecString+e, sizeof ExecString+e, 
d45 1
a45 1
+                    e += snprintf(ExecString+e, sizeof ExecString+e, 
d59 18
a76 1
@@@@ -479,7 +486,8 @@@@ void DoFileRenaming(const char * FileNam
d78 3
a80 11
             }else{
                 // My favourite scheme.
-                sprintf(NewBaseName+PrefixPart, "%02d%02d-%02d%02d%02d",
+                snprintf(NewBaseName+PrefixPart, sizeof NewBaseName+PrefixPart,
+			"%02d%02d-%02d%02d%02d",
                      tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec);
             }
 
@@@@ -504,7 +512,8 @@@@ void DoFileRenaming(const char * FileNam
                     NameExtra[0] = 0;
                 }
d82 2
a83 3
-                sprintf(NewName, "%s%s.jpg", NewBaseName, NameExtra);
+                snprintf(NewName, sizeof NewName, "%s%s.jpg", 
+			NewBaseName, NameExtra);
d85 1
a85 1
                 if (!strcmp(FileName, NewName)) break; // Skip if its already this name.
d87 2
a88 1
@@@@ -595,9 +604,11 @@@@ void ProcessFile(const char * FileName)
d91 3
a93 9
                     #ifdef _WIN32
-                        sprintf(RotateCommand, "jpegtran -%s &i &o", Argument);
+                        snprintf(RotateCommand, sizeof RotateCommand, 
+				"jpegtran -%s &i &o", Argument);
                     #else
-                        sprintf(RotateCommand, "jpegtran -%s &i > &o", Argument);
+                        snprintf(RotateCommand, sizeof RotateCommand, 
+				"jpegtran -%s &i > &o", Argument);
                     #endif
d96 2
a97 1
@@@@ -819,7 +830,7 @@@@ void ProcessFile(const char * FileName)
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD$
--- jhead.c.orig	Thu Jul 17 20:33:53 2003
+++ jhead.c	Thu Jul 17 20:34:20 2003
@@@@ -148,7 +148,7 @@@@ static int FileEditComment(char * TempFi
d9 2
a10 1
+        snprintf(QuotedPath, sizeof QuotedPath, "%s \"%s\"",Editor, TempFileName);
d14 1
a14 1
@@@@ -255,7 +255,7 @@@@ static int ModifyDescriptComment(char * 
d19 2
a20 1
+        snprintf(Temp, sizeof Temp, "scan_date=%s", ctime(&ImageInfo.FileDateTime));
d24 1
a24 1
@@@@ -283,7 +283,9 @@@@ static int AutoResizeCmdStuff(void)
d30 2
a31 2
+	"mogrify -geometry %dx%d -quality 80 &i",
+	(int)(ImageInfo.Width*scale), (int)(ImageInfo.Height*scale));
d35 1
a35 1
@@@@ -314,17 +316,20 @@@@ static void DoCommand(const char * FileN
d59 1
a59 1
@@@@ -476,8 +481,9 @@@@ void DoFileRenaming(const char * FileNam
a63 1
-                     tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec);
d65 2
a66 2
+			"%02d%02d-%02d%02d%02d", tm.tm_mon+1, tm.tm_mday,
+			tm.tm_hour, tm.tm_min, tm.tm_sec);
d69 1
a69 2
             for (a=0;;a++){
@@@@ -501,7 +507,7 @@@@ void DoFileRenaming(const char * FileNam
d74 2
a75 1
+                snprintf(NewName, sizeof NewName, "%s%s.jpg", NewBaseName, NameExtra);
d79 15
a93 11
@@@@ -592,7 +598,8 @@@@ void ProcessFile(const char * FileName)
                 #ifdef _WIN32
                     sprintf(RotateCommand, "jpegtran -%s &i &o", Argument);
                 #else
-                    sprintf(RotateCommand, "jpegtran -%s &i > &o", Argument);
+                    snprintf(RotateCommand, sizeof RotateCommand, 
+			"jpegtran -%s &i > &o", Argument);
                 #endif
                 ApplyCommand = RotateCommand;
                 DoCommand(FileName);
@@@@ -810,7 +817,7 @@@@ void ProcessFile(const char * FileName)
@


1.1.1.1
log
@Import jhead 2.0.
Submitted by Xavier Santolaria <xavier@@santolaria.net>.

Jhead is a command line driven program for manipulating
the non image parts of Exif flavor Jpeg files that most
digital cameras produce.
@
text
@@
