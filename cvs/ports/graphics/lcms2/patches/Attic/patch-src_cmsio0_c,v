head	1.2;
access;
symbols
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2013.10.03.20.21.02;	author brad;	state dead;
branches;
next	1.1;

1.1
date	2013.03.30.15.49.43;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to lcms2 2.5.

ok kili@@ ajacoutot@@
@
text
@$OpenBSD: patch-src_cmsio0_c,v 1.1 2013/03/30 15:49:43 ajacoutot Exp $

From d2d902b9a03583ae482c782b2f243f7e5268a47d Mon Sep 17 00:00:00 2001
From: Marti Maria <info@@littlecms.com>
Date: Tue, 26 Mar 2013 11:29:50 +0100
Subject: [PATCH] >Changes from Richard Hughes

--- src/cmsio0.c.orig	Mon Sep 10 18:01:51 2012
+++ src/cmsio0.c	Sat Mar 30 16:42:26 2013
@@@@ -614,10 +614,13 @@@@ cmsBool _cmsReadHeader(_cmsICCPROFILE* Icc)
     Icc -> DeviceClass     = (cmsProfileClassSignature) _cmsAdjustEndianess32(Header.deviceClass);
     Icc -> ColorSpace      = (cmsColorSpaceSignature)   _cmsAdjustEndianess32(Header.colorSpace);
     Icc -> PCS             = (cmsColorSpaceSignature)   _cmsAdjustEndianess32(Header.pcs);
+   
     Icc -> RenderingIntent = _cmsAdjustEndianess32(Header.renderingIntent);
     Icc -> flags           = _cmsAdjustEndianess32(Header.flags);
     Icc -> manufacturer    = _cmsAdjustEndianess32(Header.manufacturer);
     Icc -> model           = _cmsAdjustEndianess32(Header.model);
+    Icc -> creator         = _cmsAdjustEndianess32(Header.creator);
+    
     _cmsAdjustEndianess64(&Icc -> attributes, &Header.attributes);
     Icc -> Version         = _cmsAdjustEndianess32(Header.version);
 
@@@@ -786,27 +789,32 @@@@ void CMSEXPORT cmsSetHeaderFlags(cmsHPROFILE hProfile,
 cmsUInt32Number CMSEXPORT cmsGetHeaderManufacturer(cmsHPROFILE hProfile)
 {
     _cmsICCPROFILE*  Icc = (_cmsICCPROFILE*) hProfile;
-    return (cmsUInt32Number) Icc ->manufacturer;
+    return Icc ->manufacturer;
 }
 
 void CMSEXPORT cmsSetHeaderManufacturer(cmsHPROFILE hProfile, cmsUInt32Number manufacturer)
 {
     _cmsICCPROFILE*  Icc = (_cmsICCPROFILE*) hProfile;
-    Icc -> manufacturer = (cmsUInt32Number) manufacturer;
+    Icc -> manufacturer = manufacturer;
 }
 
+cmsUInt32Number CMSEXPORT cmsGetHeaderCreator(cmsHPROFILE hProfile)
+{
+    _cmsICCPROFILE*  Icc = (_cmsICCPROFILE*) hProfile;
+    return Icc ->creator;
+}
+
 cmsUInt32Number CMSEXPORT cmsGetHeaderModel(cmsHPROFILE hProfile)
 {
     _cmsICCPROFILE*  Icc = (_cmsICCPROFILE*) hProfile;
-    return (cmsUInt32Number) Icc ->model;
+    return Icc ->model;
 }
 
 void CMSEXPORT cmsSetHeaderModel(cmsHPROFILE hProfile, cmsUInt32Number model)
 {
     _cmsICCPROFILE*  Icc = (_cmsICCPROFILE*) hProfile;
-    Icc -> model = (cmsUInt32Number) model;
+    Icc -> model = model;
 }
-
 
 void CMSEXPORT cmsGetHeaderAttributes(cmsHPROFILE hProfile, cmsUInt64Number* Flags)
 {
@


1.1
log
@Add an accessor to get the profile creator, as this lets us work out
which CMM is writing broken 'mluc' tags for certain V4 profiles.
from Richard Hughes, committed upstream

Needed for a wip colord update.
@
text
@d1 1
a1 1
$OpenBSD$
@

