head	1.2;
access;
symbols
	OPENBSD_6_0:1.2.0.18
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.14
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.16
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.12
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.10
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.8
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.6
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.4
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.2
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.8
	OPENBSD_5_0:1.1.0.6
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.4
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2012.04.14.15.09.55;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2010.06.30.17.10.08;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Major update to 4.0.1, which adds BigTIFF support and includes some API
changes.  Also include upstream fix for CVE-2012-1173.
@
text
@$OpenBSD: patch-libtiff_tif_open_c,v 1.1 2010/06/30 17:10:08 naddy Exp $
--- libtiff/tif_open.c.orig	Wed Apr 11 18:54:12 2012
+++ libtiff/tif_open.c	Wed Apr 11 18:55:56 2012
@@@@ -86,6 +86,7 @@@@ TIFFClientOpen(
 	TIFF *tif;
 	int m;
 	const char* cp;
+	size_t namelen;
 
 	/* The following are configuration checks. They should be redundant, but should not
 	 * compile to any actual code in an optimised release build anyway. If any of them
@@@@ -116,14 +117,15 @@@@ TIFFClientOpen(
 	m = _TIFFgetMode(mode, module);
 	if (m == -1)
 		goto bad2;
-	tif = (TIFF *)_TIFFmalloc((tmsize_t)(sizeof (TIFF) + strlen(name) + 1));
+	namelen = strlen(name);
+	tif = (TIFF *)_TIFFmalloc((tmsize_t)(sizeof (TIFF) + namelen + 1));
 	if (tif == NULL) {
 		TIFFErrorExt(clientdata, module, "%s: Out of memory (TIFF structure)", name);
 		goto bad2;
 	}
 	_TIFFmemset(tif, 0, sizeof (*tif));
 	tif->tif_name = (char *)tif + sizeof (TIFF);
-	strcpy(tif->tif_name, name);
+	strlcpy(tif->tif_name, name, namelen+1);
 	tif->tif_mode = m &~ (O_CREAT|O_TRUNC);
 	tif->tif_curdir = (uint16) -1;		/* non-existent directory */
 	tif->tif_curoff = 0;
@


1.1
log
@SECURITY:
Update to 3.9.4, which includes fixes for CVE-2009-2347 and CVE-2010-1411.
@
text
@d1 4
a4 4
$OpenBSD$
--- libtiff/tif_open.c.orig	Sun Jun 27 01:10:42 2010
+++ libtiff/tif_open.c	Sun Jun 27 01:11:52 2010
@@@@ -154,18 +154,20 @@@@ TIFFClientOpen(
d10 3
d16 1
a16 1
-	tif = (TIFF *)_TIFFmalloc(sizeof (TIFF) + strlen(name) + 1);
d18 1
a18 1
+	tif = (TIFF *)_TIFFmalloc(sizeof (TIFF) + namelen + 1);
d28 1
a28 1
 	tif->tif_curdir = (tdir_t) -1;		/* non-existent directory */
@

