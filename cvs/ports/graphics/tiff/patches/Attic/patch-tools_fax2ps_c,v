head	1.7;
access;
symbols
	OPENBSD_4_9:1.6.0.4
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.2
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.5.0.6
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.4
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.2
	OPENBSD_4_5_BASE:1.5
	OPENBSD_3_7:1.3.0.6
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.4
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.2
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.2.0.8
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.6
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.4
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.2.0.2
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2011.05.09.08.14.43;	author giovanni;	state dead;
branches;
next	1.6;

1.6
date	2010.06.30.17.10.08;	author naddy;	state Exp;
branches;
next	1.5;

1.5
date	2008.10.25.09.39.29;	author naddy;	state Exp;
branches;
next	1.4;

1.4
date	2005.06.18.21.24.41;	author naddy;	state dead;
branches;
next	1.3;

1.3
date	2003.12.23.23.45.41;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2002.01.19.09.34.42;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2001.10.10.15.15.00;	author wilfried;	state Exp;
branches;
next	;


desc
@@


1.7
log
@
Update to 3.9.5, help and ok naddy@@
@
text
@$OpenBSD: patch-tools_fax2ps_c,v 1.6 2010/06/30 17:10:08 naddy Exp $
--- tools/fax2ps.c.orig	Thu Apr 20 14:36:23 2006
+++ tools/fax2ps.c	Sun Oct 11 15:42:29 2009
@@@@ -377,11 +377,12 @@@@ main(int argc, char** argv)
 	int n;
 	FILE* fd;
 	char buf[16*1024];
+	char temp[22];
 
-	fd = tmpfile();
+	strlcpy(temp, "/tmp/fax2psXXXXXXXXXX", sizeof(temp));
+	fd = fdopen(mkstemp(temp), "w+");
 	if (fd == NULL) {
-	    fprintf(stderr, "Could not create temporary file, exiting.\n");
-	    fclose(fd);
+	    fprintf(stderr, "Could not create temporary file \"%s\".\n", temp);
 	    exit(-2);
 	}
 #if defined(HAVE_SETMODE) && defined(O_BINARY)
@


1.6
log
@SECURITY:
Update to 3.9.4, which includes fixes for CVE-2009-2347 and CVE-2010-1411.
@
text
@d1 1
a1 1
$OpenBSD: patch-tools_fax2ps_c,v 1.5 2008/10/25 09:39:29 naddy Exp $
@


1.5
log
@SECURITY fixes for CVE-2006-2656 and CVE-2006-3459 through 3465.
Man page fixes.

Mostly via FreeBSD.  Approving noises from bernd@@ and jasper@@
@
text
@d1 4
a4 4
$OpenBSD$
--- tools/fax2ps.c.orig	Fri Oct 24 18:41:45 2008
+++ tools/fax2ps.c	Fri Oct 24 18:44:21 2008
@@@@ -373,11 +373,12 @@@@ main(int argc, char** argv)
d19 1
a19 1
 	while ((n = read(fileno(stdin), buf, sizeof (buf))) > 0)
@


1.4
log
@update to 3.7.2 which integrates the numerous security patches
brad@@ drops maintainership
@
text
@d1 4
a4 14
$OpenBSD: patch-tools_fax2ps_c,v 1.3 2003/12/23 23:45:41 brad Exp $
--- tools/fax2ps.c.orig	2003-10-04 07:43:17.000000000 -0400
+++ tools/fax2ps.c	2003-12-13 02:13:27.000000000 -0500
@@@@ -23,6 +23,7 @@@@
  * LIABILITY, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE 
  * OF THIS SOFTWARE.
  */
+#include <errno.h>
 #include <math.h>
 #include <stdio.h>
 #include <string.h>
@@@@ -372,15 +373,19 @@@@ main(int argc, char** argv)
 	} while (++optind < argc);
     } else {
a5 1
+	int sfd = -1;
d7 2
a8 2
-	char temp[1024], buf[16*1024];
+	char temp[15] = "", buf[16*1024];
d10 8
a17 15
-	strcpy(temp, "/tmp/fax2psXXXXXX");
-	(void) mktemp(temp);
-	fd = fopen(temp, "w");
-	if (fd == NULL) {
-	    fprintf(stderr, "Could not create temp file \"%s\"\n", temp);
-	    exit(-2);
+	strlcpy(temp, "/tmp/fax2ps.XXXXXX", sizeof temp);
+	if ((sfd = mkstemp(temp)) == -1 ||
+	    (fd = fdopen(sfd, "w+")) == NULL) {
+		if (sfd != -1) {
+			unlink(temp);
+			close(sfd);
+		}
+		fprintf(stderr, "%s: %s\n", temp, strerror(errno));
+		exit(-2);
a19 1
 	    write(fileno(fd), buf, n);
@


1.3
log
@upgrade to libtiff 3.6.0
@
text
@d1 1
a1 1
$OpenBSD: patch-tools_fax2ps_c,v 1.2 2002/01/19 09:34:42 brad Exp $
@


1.2
log
@upgrade to libtiff 3.5.7
@
text
@d1 3
a3 3
$OpenBSD: patch-tools_fax2ps_c,v 1.1 2001/10/10 15:15:00 wilfried Exp $
--- tools/fax2ps.c.orig	Wed Mar 28 20:45:43 2001
+++ tools/fax2ps.c	Fri Jan 18 23:48:37 2002
d12 1
a12 1
@@@@ -370,15 +371,19 @@@@ main(int argc, char** argv)
@


1.1
log
@use -fPIC rather than -fpic
regenerate the patches with update-patches
ok naddy@@
@
text
@d1 19
a19 5
$OpenBSD$
--- tools/fax2ps.c.orig	Wed Mar 29 06:22:33 2000
+++ tools/fax2ps.c	Wed Oct 10 17:07:22 2001
@@@@ -382,8 +382,7 @@@@ main(int argc, char** argv)
 	char temp[1024], buf[16*1024];
d21 1
a21 1
 	strcpy(temp, "/tmp/fax2psXXXXXX");
d24 15
a38 4
+	fd = fdopen(mkstemp(temp), "w+");
 	if (fd == NULL) {
 	    fprintf(stderr, "Could not create temp file \"%s\"\n", temp);
 	    exit(-2);
@

