head	1.9;
access;
symbols
	OPENBSD_5_9:1.9.0.4
	OPENBSD_6_0:1.9.0.2
	OPENBSD_5_7:1.8.0.8
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.8.0.6
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.8.0.4
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.2
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.7.0.2
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.6.0.2
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.4
	OPENBSD_5_0:1.5.0.2
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.4.0.4
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.2
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.3.0.6
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.4
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.2
	OPENBSD_4_5_BASE:1.3
	OPENBSD_3_6:1.1.0.6
	OPENBSD_3_5:1.1.0.4
	OPENBSD_3_7:1.1.0.2
	OPENBSD_3_7_BASE:1.1;
locks; strict;
comment	@# @;


1.9
date	2015.03.29.17.39.22;	author naddy;	state dead;
branches
	1.9.2.1
	1.9.4.1;
next	1.8;
commitid	DVvDfC6c0cv0tIBV;

1.8
date	2013.05.03.11.00.39;	author jasper;	state Exp;
branches
	1.8.6.1
	1.8.8.1;
next	1.7;

1.7
date	2012.09.24.19.51.04;	author naddy;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	2012.04.14.15.09.55;	author naddy;	state Exp;
branches;
next	1.5;

1.5
date	2011.05.09.08.14.43;	author giovanni;	state Exp;
branches;
next	1.4;

1.4
date	2010.06.30.17.10.08;	author naddy;	state Exp;
branches;
next	1.3;

1.3
date	2008.10.25.09.39.29;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2005.06.18.21.24.40;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2004.10.20.20.37.48;	author brad;	state Exp;
branches
	1.1.2.1
	1.1.4.1
	1.1.6.1;
next	;

1.1.2.1
date	2005.05.25.05.37.32;	author robert;	state Exp;
branches;
next	;

1.1.4.1
date	2005.03.31.22.02.44;	author sturm;	state Exp;
branches;
next	;

1.1.6.1
date	2005.03.31.22.08.46;	author sturm;	state Exp;
branches;
next	;

1.7.2.1
date	2013.05.03.11.04.00;	author jasper;	state Exp;
branches;
next	;

1.8.6.1
date	2015.03.29.20.58.58;	author naddy;	state dead;
branches;
next	;
commitid	yV7LOUcjZFa2iAbX;

1.8.8.1
date	2015.03.29.19.41.56;	author naddy;	state dead;
branches;
next	;
commitid	tay2jRrbkJ3GxbDm;

1.9.2.1
date	2016.11.30.21.36.36;	author naddy;	state Exp;
branches;
next	;
commitid	SSUFe7wdxWokBCcs;

1.9.4.1
date	2016.11.30.22.14.18;	author naddy;	state Exp;
branches;
next	;
commitid	HYFVXR4DcvEOAZJj;


desc
@@


1.9
log
@Security update to 4.0.4beta (plus one further upstream fix).
Should fix CVE-2014-8127, CVE-2014-8128, CVE-2014-8129, CVE-2014-8130,
CVE-2014-9655, CVE-2015-1547.
@
text
@$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.8 2013/05/03 11:00:39 jasper Exp $

Security fix for CVE-2013-1961 libtiff (tiff2pdf): Stack-based buffer overflow
with malformed image-length and resolution

Patch from https://bugzilla.redhat.com/show_bug.cgi?id=952131

--- libtiff/tif_dirinfo.c.orig	Sun Aug 19 18:56:34 2012
+++ libtiff/tif_dirinfo.c	Mon Sep 24 21:30:29 2012
@@@@ -711,7 +711,7 @@@@ _TIFFCreateAnonField(TIFF *tif, uint32 tag, TIFFDataTy
 	 * note that this name is a special sign to TIFFClose() and
 	 * _TIFFSetupFields() to free the field
 	 */
-	sprintf(fld->field_name, "Tag %d", (int) tag);
+	snprintf(fld->field_name, 32, "Tag %d", (int) tag);
 
 	return fld;    
 }
@


1.9.4.1
log
@Update to 4.0.7.
* Multiple security fixes, including
CVE-2016-3622, CVE-2014-8127, CVE-2016-9273, CVE-2016-9448,
MSVR 35094, MSVR 35095, MSVR 35105
* Remove obsolete tools bmp2tiff, gif2tiff, ras2tiff, sgi2tiff, sgisv, ycbcr

Minor patches to maintain ABI compatibility with 4.0.6.
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 1
maintain ABI compatibility with 4.0.6
d6 12
a17 4
--- libtiff/tif_dirinfo.c.orig	Fri Nov 18 03:52:13 2016
+++ libtiff/tif_dirinfo.c	Wed Nov 30 21:20:09 2016
@@@@ -529,7 +529,7 @@@@ TIFFFindField(TIFF* tif, uint32 tag, TIFFDataType dt)
 	return tif->tif_foundfield = (ret ? *ret : NULL);
a18 6
 
-static const TIFFField*
+const TIFFField*
 _TIFFFindFieldByName(TIFF* tif, const char *field_name, TIFFDataType dt)
 {
 	TIFFField key = {0, 0, 0, TIFF_NOTYPE, 0, 0, 0, 0, 0, 0, NULL, NULL};
@


1.9.2.1
log
@Update to 4.0.7.
* Multiple security fixes, including
CVE-2016-3622, CVE-2014-8127, CVE-2016-9273, CVE-2016-9448,
MSVR 35094, MSVR 35095, MSVR 35105
* Remove obsolete tools bmp2tiff, gif2tiff, ras2tiff, sgi2tiff, sgisv, ycbcr

Minor patches to maintain ABI compatibility with 4.0.6.
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 1
maintain ABI compatibility with 4.0.6
d6 12
a17 4
--- libtiff/tif_dirinfo.c.orig	Fri Nov 18 03:52:13 2016
+++ libtiff/tif_dirinfo.c	Wed Nov 30 21:20:09 2016
@@@@ -529,7 +529,7 @@@@ TIFFFindField(TIFF* tif, uint32 tag, TIFFDataType dt)
 	return tif->tif_foundfield = (ret ? *ret : NULL);
a18 6
 
-static const TIFFField*
+const TIFFField*
 _TIFFFindFieldByName(TIFF* tif, const char *field_name, TIFFDataType dt)
 {
 	TIFFField key = {0, 0, 0, TIFF_NOTYPE, 0, 0, 0, 0, 0, 0, NULL, NULL};
@


1.8
log
@Security fixes for
CVE-2013-1960 - Heap-based buffer overflow
CVE-2013-1961 - Stack-based buffer overflow

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.7 2012/09/24 19:51:04 naddy Exp $
@


1.8.6.1
log
@Security update to 4.0.4beta (plus one further upstream fix).
Should fix CVE-2014-8127, CVE-2014-8128, CVE-2014-8129, CVE-2014-8130,
CVE-2014-9655, CVE-2015-1547.
@
text
@d1 1
a1 1
$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.8 2013/05/03 11:00:39 jasper Exp $
@


1.8.8.1
log
@Security update to 4.0.4beta (plus one further upstream fix).
Should fix CVE-2014-8127, CVE-2014-8128, CVE-2014-8129, CVE-2014-8130,
CVE-2014-9655, CVE-2015-1547.
@
text
@d1 1
a1 1
$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.8 2013/05/03 11:00:39 jasper Exp $
@


1.7
log
@Update to 4.0.3.
* A number of security issues have been resolved, including CVE-2012-3401.
* Accessor functions for TIFF field information have been added to
  support functionality which was available in libtiff 3.9.X.

ok jasper@@
@
text
@d1 7
a7 1
$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.6 2012/04/14 15:09:55 naddy Exp $
@


1.7.2.1
log
@Security fixes for
CVE-2013-1960 - Heap-based buffer overflow
CVE-2013-1961 - Stack-based buffer overflow

ok sthen@@
@
text
@d1 1
a1 7
$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.8 2013/05/03 11:00:39 jasper Exp $

Security fix for CVE-2013-1961 libtiff (tiff2pdf): Stack-based buffer overflow
with malformed image-length and resolution

Patch from https://bugzilla.redhat.com/show_bug.cgi?id=952131

@


1.6
log
@Major update to 4.0.1, which adds BigTIFF support and includes some API
changes.  Also include upstream fix for CVE-2012-1173.
@
text
@d1 4
a4 4
$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.5 2011/05/09 08:14:43 giovanni Exp $
--- libtiff/tif_dirinfo.c.orig	Tue May 31 16:33:06 2011
+++ libtiff/tif_dirinfo.c	Wed Apr 11 18:25:33 2012
@@@@ -661,7 +661,7 @@@@ _TIFFCreateAnonField(TIFF *tif, uint32 tag, TIFFDataTy
@


1.5
log
@
Update to 3.9.5, help and ok naddy@@
@
text
@d1 4
a4 4
$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.4 2010/06/30 17:10:08 naddy Exp $
--- libtiff/tif_dirinfo.c.orig	Thu Jul  8 18:17:59 2010
+++ libtiff/tif_dirinfo.c	Thu Apr 21 15:35:54 2011
@@@@ -869,7 +869,7 @@@@ _TIFFCreateAnonFieldInfo(TIFF *tif, ttag_t tag, TIFFDa
d6 1
a6 1
 	 * _TIFFSetupFieldInfo() to free the field
@


1.4
log
@SECURITY:
Update to 3.9.4, which includes fixes for CVE-2009-2347 and CVE-2010-1411.
@
text
@d1 4
a4 4
$OpenBSD$
--- libtiff/tif_dirinfo.c.orig	Sun Jun 27 01:01:31 2010
+++ libtiff/tif_dirinfo.c	Sun Jun 27 01:01:51 2010
@@@@ -873,7 +873,7 @@@@ _TIFFCreateAnonFieldInfo(TIFF *tif, ttag_t tag, TIFFDa
@


1.3
log
@SECURITY fixes for CVE-2006-2656 and CVE-2006-3459 through 3465.
Man page fixes.

Mostly via FreeBSD.  Approving noises from bernd@@ and jasper@@
@
text
@d2 11
a12 25

CVE-2006-3464,3465

--- libtiff/tif_dirinfo.c.orig	Tue Feb  7 14:51:03 2006
+++ libtiff/tif_dirinfo.c	Fri Oct 24 18:53:28 2008
@@@@ -775,7 +775,8 @@@@ _TIFFFieldWithTag(TIFF* tif, ttag_t tag)
 		TIFFErrorExt(tif->tif_clientdata, "TIFFFieldWithTag",
 			  "Internal error, unknown tag 0x%x",
                           (unsigned int) tag);
-		assert(fip != NULL);
+		/* assert(fip != NULL); */
+
 		/*NOTREACHED*/
 	}
 	return (fip);
@@@@ -789,7 +790,8 @@@@ _TIFFFieldWithName(TIFF* tif, const char *field_name)
 	if (!fip) {
 		TIFFErrorExt(tif->tif_clientdata, "TIFFFieldWithName",
 			  "Internal error, unknown tag %s", field_name);
-		assert(fip != NULL);
+		/* assert(fip != NULL); */
+		
 		/*NOTREACHED*/
 	}
 	return (fip);
@


1.2
log
@update to 3.7.2 which integrates the numerous security patches
brad@@ drops maintainership
@
text
@d1 14
a14 15
$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.1 2004/10/20 20:37:48 brad Exp $
--- libtiff/tif_dirinfo.c.orig	Mon Dec 22 03:22:15 2003
+++ libtiff/tif_dirinfo.c	Wed Oct 20 14:38:11 2004
@@@@ -31,6 +31,8 @@@@
  */
 #include "tiffiop.h"
 #include <stdlib.h>
+#include <assert.h>
+#include <stdio.h>
 
 /*
  * NB: NB: THIS ARRAY IS ASSUMED TO BE SORTED BY TAG.
@@@@ -309,6 +311,7 @@@@ _TIFFMergeFieldInfo(TIFF* tif, const TIF
 		tif->tif_fieldinfo = (TIFFFieldInfo**)
 		    _TIFFmalloc(n * sizeof (TIFFFieldInfo*));
d16 11
a26 43
+	assert(tif->tif_fieldinfo != NULL);
 	tp = &tif->tif_fieldinfo[tif->tif_nfields];
 	for (i = 0; i < n; i++)
 		tp[i] = (TIFFFieldInfo*) &info[i];	/* XXX */
@@@@ -376,7 +379,7 @@@@ TIFFDataWidth(TIFFDataType type)
 TIFFDataType
 _TIFFSampleToTagType(TIFF* tif)
 {
-	int bps = (int) TIFFhowmany(tif->tif_dir.td_bitspersample, 8);
+	uint32 bps = TIFFhowmany8(tif->tif_dir.td_bitspersample);
 
 	switch (tif->tif_dir.td_sampleformat) {
 	case SAMPLEFORMAT_IEEEFP:
@@@@ -422,9 +425,6 @@@@ _TIFFFindFieldInfo(TIFF* tif, ttag_t tag
 	return ((const TIFFFieldInfo *)0);
 }
 
-#include <assert.h>
-#include <stdio.h>
-
 const TIFFFieldInfo*
 _TIFFFieldWithTag(TIFF* tif, ttag_t tag)
 {
@@@@ -460,6 +460,8 @@@@ _TIFFCreateAnonFieldInfo(TIFF *tif, ttag
     TIFFFieldInfo *fld;
 
     fld = (TIFFFieldInfo *) _TIFFmalloc(sizeof (TIFFFieldInfo));
+    if (fld == NULL)
+	return NULL;
     _TIFFmemset( fld, 0, sizeof(TIFFFieldInfo) );
 
     fld->field_tag = tag;
@@@@ -470,6 +472,10 @@@@ _TIFFCreateAnonFieldInfo(TIFF *tif, ttag
     fld->field_oktochange = TRUE;
     fld->field_passcount = TRUE;
     fld->field_name = (char *) _TIFFmalloc(32);
+    if (fld->field_name == NULL) {
+	_TIFFfree(fld);
+	return NULL;
+    }
 
     /* note that this name is a special sign to TIFFClose() and
      * _TIFFSetupFieldInfo() to free the field
@


1.1
log
@Fix memory allocation problems and numerous integer overflows.

CAN-2004-0803, CAN-2004-0804, CAN-2004-0886
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@SECURITY:
fix multiple vulnerabilities; bump PKGNAME
http://www.vuxml.org/openbsd/d045aeb6-9ea6-11d9-9623-00065bd5b0b6.html

ok brad@@
@
text
@@


1.1.6.1
log
@cumulative update with patches of recent months

MFC:
fix an issue with not being able to open some valid TIFF files.

http://www.sigmasoft.com/~openbsd/archive/openbsd-ports/200503/msg00090.html

From: Bernd Ahlers <b dot ahlers at ba-net dot org>
---
Integer overflow in tif_dirread.c and tif_fax3.c for libtiff allows remote
attackers to execute arbitrary code via a TIFF file containing a TIFF_ASCII
or TIFF_UNDEFINED directory entry with a -1 entry count, which leads to a
heap-based buffer overflow.

CAN-2004-1308
---
fix an issue with alpha channels.

http://bugzilla.remotesensing.org/show_bug.cgi?id=718
---
fix MASTER_SITES; From: Bernd Ahlers <b dot ahlers at ba-net dot org>
---
Fix memory allocation problems and numerous integer overflows.

CAN-2004-0803, CAN-2004-0804, CAN-2004-0886

ok brad@@
@
text
@d1 1
a1 1
$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.1 2004/10/20 20:37:48 brad Exp $
@


1.1.4.1
log
@cumulative update with patches of recent months

MFC:
fix an issue with not being able to open some valid TIFF files.

http://www.sigmasoft.com/~openbsd/archive/openbsd-ports/200503/msg00090.html

From: Bernd Ahlers <b dot ahlers at ba-net dot org>
---
Integer overflow in tif_dirread.c and tif_fax3.c for libtiff allows remote
attackers to execute arbitrary code via a TIFF file containing a TIFF_ASCII
or TIFF_UNDEFINED directory entry with a -1 entry count, which leads to a
heap-based buffer overflow.

CAN-2004-1308
---
fix an issue with alpha channels.

http://bugzilla.remotesensing.org/show_bug.cgi?id=718
---
fix MASTER_SITES; From: Bernd Ahlers <b dot ahlers at ba-net dot org>
---
Fix memory allocation problems and numerous integer overflows.

CAN-2004-0803, CAN-2004-0804, CAN-2004-0886

ok brad@@
@
text
@d1 1
a1 1
$OpenBSD: patch-libtiff_tif_dirinfo_c,v 1.1 2004/10/20 20:37:48 brad Exp $
@

