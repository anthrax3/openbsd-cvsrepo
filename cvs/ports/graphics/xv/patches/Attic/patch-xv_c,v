head	1.3;
access;
symbols
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2005.04.12.17.28.04;	author naddy;	state dead;
branches;
next	1.2;

1.2
date	2005.03.15.01.16.47;	author naddy;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	2004.09.21.18.46.04;	author sturm;	state Exp;
branches;
next	;

1.2.2.1
date	2005.05.23.20.23.54;	author robert;	state dead;
branches;
next	;


desc
@@


1.3
log
@SECURITY:
Fixes for multiple vulnerabilities.  Switch to centralized jumbo patch.
From rohee@@
@
text
@$OpenBSD: patch-xv_c,v 1.2 2005/03/15 01:16:47 naddy Exp $
--- xv.c.orig	Tue Mar 15 00:20:23 2005
+++ xv.c	Tue Mar 15 00:28:24 2005
@@@@ -1990,10 +1990,9 @@@@ static int openPic(filenum)
 #else /* it is VMS */
       sprintf(filename, "[]xvXXXXXX");
 #endif
-      mktemp(filename);
+      fp = fdopen(mkstemp(filename), "w");
 
       clearerr(stdin);
-      fp = fopen(filename,"w");
       if (!fp) FatalError("openPic(): can't write temporary file");
     
       while ( (i=getchar()) != EOF) putc(i,fp);
@@@@ -2219,7 +2218,7 @@@@ static int openPic(filenum)
   SetISTR(ISTR_INFO,formatStr);
 	
   SetInfoMode(INF_PART);
-  SetISTR(ISTR_FILENAME, 
+  SetISTR(ISTR_FILENAME, "%s",
 	  (filenum==DFLTPIC || filenum==GRABBED || frompipe)
 	  ? "<none>" : basefname);
 
@@@@ -2759,7 +2758,7 @@@@ int UncompressFile(name, uncompname)
   
 #ifndef VMS
   sprintf(uncompname, "%s/xvuXXXXXX", tmpdir);
-  mktemp(uncompname);
+  close(mkstemp(uncompname));
   sprintf(buf,"%s -c %s >%s", UNCOMPRESS, fname, uncompname);
 #else /* it IS VMS */
   strcpy(uncompname, "[]xvuXXXXXX");
@@@@ -2934,8 +2933,8 @@@@ static int readpipe(cmd, fname)
   if (!cmd || (strlen(cmd) < (size_t) 2)) return 1;
 
   sprintf(tmpname,"%s/xvXXXXXX", tmpdir);
-  mktemp(tmpname);
-  if (tmpname[0] == '\0') {   /* mktemp() blew up */
+  close(mkstemp(tmpname));
+  if (tmpname[0] == '\0') {   /* mkstemp() blew up */
     sprintf(str,"Unable to create temporary filename.");
     ErrPopUp(str, "\nHow unlikely!");
     return 1;
@@@@ -3232,9 +3231,17 @@@@ static void createMainWindow(geom, name)
   hints.flags = 0;
   if ((i&XValue || i&YValue)) hints.flags = USPosition;
 
-  if (i&XValue && i&XNegative) x = vrWIDE - eWIDE - abs(x);
-  if (i&YValue && i&YNegative) y = vrHIGH - eHIGH - abs(y);
-
+  hints.win_gravity = NorthWestGravity;
+  if (i&XValue && i&XNegative) {
+    hints.win_gravity = NorthEastGravity;
+    x = vrWIDE - (eWIDE + 2 * bwidth) - abs(x);
+  }
+  if (i&YValue && i&YNegative) {
+    hints.win_gravity = (hints.win_gravity == NorthWestGravity) ?
+	SouthWestGravity : SouthEastGravity;
+    y = vrHIGH - (eHIGH + 2 * bwidth) - abs(y);
+  }
+ 
   if (x+eWIDE > vrWIDE) x = vrWIDE - eWIDE;   /* keep on screen */
   if (y+eHIGH > vrHIGH) y = vrHIGH - eHIGH;
 
@@@@ -3253,7 +3260,7 @@@@ static void createMainWindow(geom, name)
   hints.x = x;                  hints.y = y;
   hints.width = eWIDE;          hints.height = eHIGH;
   hints.max_width  = maxWIDE;   hints.max_height = maxHIGH;
-  hints.flags |= USSize | PMaxSize;
+  hints.flags |= USSize | PMaxSize | PWinGravity;
     
   xswa.bit_gravity = StaticGravity;
   xswa.background_pixel = bg;
@@@@ -3302,10 +3309,6 @@@@ static void createMainWindow(geom, name)
     }
   }
 
-
-  XSetStandardProperties(theDisp,mainW,"","",None,NULL,0,&hints);
-  setWinIconNames(name);
-
   xwmh.input = True;
   xwmh.flags = InputHint;
 
@@@@ -3330,12 +3333,12 @@@@ static void createMainWindow(geom, name)
       }
     }
   }
-  XSetWMHints(theDisp, mainW, &xwmh);
 
   classh.res_name = "xv";
   classh.res_class = "XVroot";
-  XSetClassHint(theDisp, mainW, &classh);
 
+  XmbSetWMProperties(theDisp, mainW, NULL, NULL, NULL, 0, &hints, &xwmh, &classh);
+  setWinIconNames(name);
 
   if (nodecor) {   /* turn of image window decorations (in MWM) */ 
     Atom mwm_wm_hints;
@


1.2
log
@Fix a format string vulnerability in the handling of image filenames.
From Gentoo, via rohee@@
@
text
@d1 1
a1 1
$OpenBSD: patch-xv_c,v 1.1 2004/09/21 18:46:04 sturm Exp $
@


1.2.2.1
log
@SECURITY:
Fixes for multiple vulnerabilities. Switch to centralized jumbo patch.
bump PKGNAME
http://www.vuxml.org/openbsd/e9b45990-abff-11d9-a42d-080020f8e4df.html

ok brad@@
@
text
@d1 1
a1 1
$OpenBSD: patch-xv_c,v 1.2 2005/03/15 01:16:47 naddy Exp $
@


1.1
log
@Add some sanity checking in XV. Patches from Marcus Meissner
adapted by rohee@@ by way of millert@@

while here, adapt patches to regular naming scheme
@
text
@d1 3
a3 3
$OpenBSD$
--- xv.c.orig	Tue Sep 21 06:49:20 2004
+++ xv.c	Tue Sep 21 06:50:28 2004
d16 9
@

