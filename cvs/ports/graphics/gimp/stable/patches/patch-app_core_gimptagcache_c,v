head	1.1;
access;
symbols
	OPENBSD_6_2:1.1.0.4
	OPENBSD_6_2_BASE:1.1
	OPENBSD_6_1:1.1.0.2
	OPENBSD_6_1_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2016.08.09.12.00.00;	author tb;	state Exp;
branches;
next	;
commitid	eOoWp1KEpAATSjdQ;


desc
@@


1.1
log
@Guard against printf("%s", NULL) that can be hit on exit and in the
open dialog.

ok giovanni
@
text
@$OpenBSD$
--- app/core/gimptagcache.c.orig	Fri Aug 21 00:57:25 2015
+++ app/core/gimptagcache.c	Tue Aug  9 03:58:01 2016
@@@@ -404,8 +404,8 @@@@ gimp_tag_cache_save (GimpTagCache *cache)
 
       identifier_string = g_markup_escape_text (g_quark_to_string (cache_rec->identifier), -1);
       g_string_append_printf (buf, "\n  <resource identifier=\"%s\" checksum=\"%s\">\n",
-                              identifier_string,
-                              g_quark_to_string (cache_rec->checksum));
+                              identifier_string ? identifier_string : "(NULL)",
+                              cache_rec->checksum ? g_quark_to_string (cache_rec->checksum) : "(NULL)");
       g_free (identifier_string);
 
       for (tag_iterator = cache_rec->tags;
@@@@ -494,7 +494,7 @@@@ gimp_tag_cache_load (GimpTagCache *cache)
   else
     {
       g_printerr ("Failed to parse tag cache: %s\n",
-                  error ? error->message : NULL);
+                  error ? error->message : "(NULL)");
     }
 
   g_free (filename);
@@@@ -591,7 +591,7 @@@@ gimp_tag_cache_load_text (GMarkupParseContext  *contex
       else
         {
           g_warning ("dropping invalid tag '%s' from '%s'\n", buffer,
-                     g_quark_to_string (parse_data->current_record.identifier));
+                     parse_data->current_record.identifier ? g_quark_to_string (parse_data->current_record.identifier) : "(NULL)");
         }
     }
 }
@
