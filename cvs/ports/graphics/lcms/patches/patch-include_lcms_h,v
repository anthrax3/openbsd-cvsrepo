head	1.8;
access;
symbols
	OPENBSD_6_2:1.8.0.34
	OPENBSD_6_2_BASE:1.8
	OPENBSD_6_1:1.8.0.32
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.8.0.30
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.26
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.8.0.28
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.8.0.24
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.8.0.22
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.8.0.20
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.18
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.16
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.8.0.14
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.8
	OPENBSD_5_1:1.8.0.12
	OPENBSD_5_0:1.8.0.10
	OPENBSD_5_0_BASE:1.8
	OPENBSD_4_9:1.8.0.8
	OPENBSD_4_9_BASE:1.8
	OPENBSD_4_8:1.8.0.6
	OPENBSD_4_8_BASE:1.8
	OPENBSD_4_7:1.8.0.4
	OPENBSD_4_7_BASE:1.8
	OPENBSD_4_6:1.8.0.2
	OPENBSD_4_6_BASE:1.8
	OPENBSD_4_5:1.7.0.4
	OPENBSD_4_5_BASE:1.7
	OPENBSD_4_4:1.7.0.2
	OPENBSD_4_4_BASE:1.7
	OPENBSD_4_3:1.5.0.4
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.5.0.2
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.3.0.4
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.2
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.2.0.6
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.4
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.1.0.4
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_5:1.1.0.2
	OPENBSD_3_5_BASE:1.1;
locks; strict;
comment	@# @;


1.8
date	2009.04.09.13.10.49;	author jasper;	state Exp;
branches;
next	1.7;

1.7
date	2008.07.19.11.18.23;	author espie;	state Exp;
branches
	1.7.4.1;
next	1.6;

1.6
date	2008.06.10.00.42.40;	author okan;	state dead;
branches;
next	1.5;

1.5
date	2007.08.05.19.04.52;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2007.08.02.19.22.12;	author mbalmer;	state Exp;
branches;
next	1.3;

1.3
date	2006.03.16.11.03.07;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.14.08.46.54;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2004.02.03.05.15.16;	author brad;	state Exp;
branches;
next	;

1.7.4.1
date	2009.06.20.01.34.27;	author william;	state Exp;
branches;
next	;


desc
@@


1.8
log
@- update lcms to 1.18
* includes security fixes for CVE-2009-0581, CVE-2009-0723 and CVE-2009-0733.
(which could cause a memory leak, buffer overflows and code execution)

ok ajacoutot@@
@
text
@$OpenBSD: patch-include_lcms_h,v 1.7 2008/07/19 11:18:23 espie Exp $
--- include/lcms.h.orig	Thu Apr  9 13:56:40 2009
+++ include/lcms.h	Thu Apr  9 13:59:19 2009
@@@@ -143,17 +143,17 @@@@ typedef    pthread_rwlock_t      LCMS_RWLOCK_T;
 #   define USE_BIG_ENDIAN      1
 #endif
 
-#if TARGET_CPU_PPC
+#if defined(TARGET_CPU_PPC) && TARGET_CPU_PPC
 #   define USE_BIG_ENDIAN   1
 #endif
 
-#if macintosh
+#if defined(macintosh) && macintosh
 # ifndef __LITTLE_ENDIAN__
 #   define USE_BIG_ENDIAN      1
 # endif
 #endif
 
-#ifdef __BIG_ENDIAN__
+#if defined(__BIG_ENDIAN__) && __BIG_ENDIAN__
 #   define USE_BIG_ENDIAN      1
 #endif
 
@@@@ -1415,7 +1415,6 @@@@ LCMS_INLINE WORD _cmsClampWord(int in)
 LCMS_INLINE void* _cmsMalloc(size_t size)
 {
     if (size > ((size_t) 1024*1024*500)) return NULL;  // Never allow over 500Mb
-    if (size < 0) return NULL;              // Prevent signed size_t exploits
 
     return (void*) malloc(size);
 }
@


1.7
log
@zap stupid warnings during further compilation using lcms.
Kill the darn noise !
@
text
@d1 3
a3 3
$OpenBSD$
--- include/lcms.h.orig	Sat Jul 19 12:52:40 2008
+++ include/lcms.h	Sat Jul 19 12:55:23 2008
d20 1
a20 1
-#if __BIG_ENDIAN__
d25 1
a25 1
@@@@ -1407,7 +1407,6 @@@@ LCMS_INLINE WORD _cmsClampWord(int in)
@


1.7.4.1
log
@SECURITY FIX

Resolves CVE-2009-0581, CVE-2009-0723, and CVE-2009-0733

patch from upstream via debian

ok robert@@
@
text
@d1 3
a3 8
$OpenBSD: patch-include_lcms_h,v 1.7 2008/07/19 11:18:23 espie Exp $

CVE-2009-0581
CVE-2009-0723    
CVE-2009-0733

--- include/lcms.h.orig	Fri Jul 27 06:00:01 2007
+++ include/lcms.h	Thu Jun 18 23:57:39 2009
d25 1
a25 1
@@@@ -1407,11 +1407,21 @@@@ LCMS_INLINE WORD _cmsClampWord(int in)
a32 26
 
+LCMS_INLINE void* _cmsCalloc(size_t nmemb, size_t size)
+{
+    size_t alloc = nmemb * size;
+    if (size == 0) {
+      return _cmsMalloc(0);
+    }
+    if (alloc / size != nmemb) {
+        return NULL;
+    }
+    return _cmsMalloc(alloc);
+}
 
 LCMS_INLINE void _cmsFree(void *Ptr)
 {
@@@@ -2023,6 +2033,10 @@@@ void cdecl _cmsComputePrelinearizationTablesFromXFORM(
 
 // Build a tone curve for K->K' if possible (only works on CMYK)
 LPGAMMATABLE _cmsBuildKToneCurve(cmsHTRANSFORM hCMYK2CMYK, int nPoints);
+
+// Validates a LUT
+LCMSBOOL cdecl _cmsValidateLUT(LPLUT NewLUT);
+
 
 // These are two VITAL macros, from converting between 8 and 16 bit
 // representation. 
@


1.6
log
@update to 1.17 from brad@@

ok merdely@@
@
text
@d1 4
a4 4
$OpenBSD: patch-include_lcms_h,v 1.5 2007/08/05 19:04:52 espie Exp $
--- include/lcms.h.orig	Tue Mar  7 22:46:48 2006
+++ include/lcms.h	Tue Mar  7 22:47:46 2006
@@@@ -131,11 +131,17 @@@@
d8 3
a10 12
-#if defined(__OpenBSD__) || defined(__NetBSD__) || defined(__FreeBSD__)
+#if defined(__NetBSD__) || defined(__FreeBSD__)
 #  include <sys/types.h>
 #  define USE_INT64           1
 #  define LCMSSLONGLONG       int_64_t
 #  define LCMSULONGLONG       u_int64_t
+#endif
+#if defined(__OpenBSD__)
+#  include <stdint.h>
+#  define USE_INT64           1
+#  define LCMSSLONGLONG	      int64_t
+#  define LCMSULONGLONG       uint64_t
d13 20
a32 1
 #ifdef USE_INT64
@


1.5
log
@revert unokay'ed update that breaks at least digikam.
@
text
@d1 1
a1 1
$OpenBSD: patch-include_lcms_h,v 1.3 2006/03/16 11:03:07 espie Exp $
@


1.4
log
@Update to LCMS 1.17
@
text
@d2 3
a4 3
--- include/lcms.h.orig	Fri Jul 27 12:00:01 2007
+++ include/lcms.h	Tue Jul 31 14:42:02 2007
@@@@ -161,11 +161,18 @@@@ typedef    pthread_rwlock_t      LCMS_RWLOCK_T;
d12 1
a12 1
 #  define LCMSSLONGLONG       int64_t
a14 1
+
d18 1
a18 1
+#  define LCMSSLONGLONG       int64_t
@


1.3
log
@update to 1.15, okay brad@@, mbalmer@@
@
text
@d1 4
a4 4
$OpenBSD$
--- include/lcms.h.orig	Tue Mar  7 22:46:48 2006
+++ include/lcms.h	Tue Mar  7 22:47:46 2006
@@@@ -131,11 +131,17 @@@@
d12 1
a12 1
 #  define LCMSSLONGLONG       int_64_t
d15 1
d19 1
a19 1
+#  define LCMSSLONGLONG	      int64_t
@


1.2
log
@kill annoying warnings
okay pval@@
@
text
@d1 4
a4 13
$OpenBSD: patch-include_lcms_h,v 1.1 2004/02/03 05:15:16 brad Exp $
--- include/lcms.h.orig	Sat Dec 20 16:00:11 2003
+++ include/lcms.h	Mon Mar 14 09:27:50 2005
@@@@ -75,7 +75,7 @@@@
 
 // Metroworks CodeWarrior
 
-#if __MWERKS__ 
+#ifdef __MWERKS__ 
 #   define unlink remove
 #   if WIN32 
 #       define USE_CUSTOM_SWAB 1
@@@@ -100,7 +100,7 @@@@
d8 2
a9 8
-#if TARGET_CPU_PPC
+#ifdef TARGET_CPU_PPC
 #   define USE_BIG_ENDIAN   1
 #endif
 
@@@@ -114,6 +114,9 @@@@
 
 #if defined(__OpenBSD__) || defined(__NetBSD__) || defined(__FreeBSD__)
a10 3
+#  if BYTE_ORDER == BIG_ENDIAN
+#    define USE_BIG_ENDIAN    1
+#  endif
d12 8
a19 9
 #  undef  LONGLONG
 #  define LONGLONG            u_int64_t
@@@@ -128,7 +131,7 @@@@
 #include <memory.h>
 #include <string.h>
 
-#if defined(__GNUC__) || defined(__FreeBSD__)
+#if defined(__GNUC__) || defined(__OpenBSD__) || defined(__NetBSD__) || defined(__FreeBSD__)
 #   include <unistd.h>
d22 1
@


1.1
log
@upgrade to lcms 1.12
@
text
@d1 21
a21 3
$OpenBSD$
--- include/lcms.h.orig	2003-12-20 10:00:11.000000000 -0500
+++ include/lcms.h	2004-02-02 22:05:58.000000000 -0500
@

