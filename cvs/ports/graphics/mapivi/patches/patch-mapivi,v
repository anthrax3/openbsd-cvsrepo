head	1.7;
access;
symbols
	OPENBSD_6_0:1.7.0.10
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.6
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.8
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.4
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.2
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.6.0.8
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.6
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.4
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.2
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.4
	OPENBSD_5_0:1.5.0.2
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.4.0.12
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.10
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.8
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.6
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.4
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.2
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.3.0.2
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.2.0.2
	OPENBSD_4_2_BASE:1.2
	ajacoutot_20070529:1.1.1.1
	ajacoutot:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2014.04.25.09.47.50;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2012.07.11.08.59.57;	author giovanni;	state Exp;
branches;
next	1.5;

1.5
date	2011.07.18.10.00.32;	author giovanni;	state Exp;
branches;
next	1.4;

1.4
date	2008.07.02.14.26.22;	author landry;	state Exp;
branches;
next	1.3;

1.3
date	2007.12.27.22.49.14;	author kili;	state Exp;
branches;
next	1.2;

1.2
date	2007.05.31.06.52.24;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2007.05.29.17.08.59;	author ajacoutot;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.05.29.17.08.59;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.7
log
@unbreak with perl 5.18
@
text
@$OpenBSD: patch-mapivi,v 1.6 2012/07/11 08:59:57 giovanni Exp $
--- mapivi.orig	Thu Feb 21 20:53:44 2008
+++ mapivi	Sun Jul 14 12:07:09 2013
@@@@ -148,12 +148,12 @@@@ if (($EvilOS) and (defined $ENV{APPDATA}) and ($maprog
 # for windows we use this path
 $maprogsdir     = $ENV{APPDATA}."/maprogs" if defined $ENV{APPDATA};
 my $configdir   = "$maprogsdir/mapivi";   # the configuration dir
-my $icon_path   = "$configdir/icons";     # the icon dir
+my $icon_path   = "${PREFIX}/share/mapivi/icons";     # the icon dir
 
 my $splashAvail = (eval "require Tk::Splash")  ? 1 : 0 ;
 my $splash;
-my $logo = "$configdir/logo.jpg";
-if ($splashAvail and -f $logo) {
+my $logo = "${PREFIX}/share/mapivi/pics/logo.jpg";
+if ($splashAvail and -f $logo and -d $configdir) {
   # Splash->Show parameters: $image, $width, $height, $title, $overrideredirect
   $splash = Tk::Splash->Show($logo, 844, 259, "", 1);
 }
@@@@ -360,7 +360,7 @@@@ my $nrToConvert     = 0;
 my $maxCommentLength = 2**16 - 3; # a comment block may have max 64kB
 
 my $trashdir        = "$configdir/trash";     # the trashcan
-my $plugindir       = "$configdir/PlugIns";   # the mapivi plugin dir
+my $plugindir       = "${PREFIX}/share/mapivi/PlugIns";   # the mapivi plugin dir
 my $iptcdir         = "$configdir/IPTC_templates";  # the IPTC templates folder
 my $configFile      = "$configdir/mapivirc";  # the configuration file
 my $file_Entry_values = "$configdir/Entry_values";
@@@@ -445,7 +445,7 @@@@ my %new_keywords;
 my %ignore_keywords;
 
 # external programs used by mapivi
-my %exprogs = qw/convert 0 composite 0 jhead 0 jpegtran 0 jpegpixi 0 mogrify 0 gimp-remote 0 gimp-win-remote 0 montage 0 xwd 0 identify 0 thunderbird 0 mozilla-thunderbird 0 exiftool 0/;
+my %exprogs = qw/convert 0 composite 0 jhead 0 jpegtran 0 jpegpixi 0 mogrify 0 gimp 0 montage 0 identify 0 exiftool 0/;
 # short comment about the usage of the external programs
 my %exprogscom = (
 		   "convert"        => "build thumbnails",
@@@@ -455,12 +455,9 @@@@ my %exprogscom = (
 		   "jpegpixi"       => "do nearly lossless interpolation (remove dead pixels)",
 		   "mogrify"        => "change the size/quality of pictures",
 		   "montage"        => "combine pictures to e.g. index prints",
-		   "gimp-remote"    => "edit pictures with The GIMP (only UNIX)",
-		   "gimp-win-remote"=> "edit pictures with The GIMP (only windows)",
-		   "xwd"            => "make a screenshot of a window or desktop",
+		   "gimp"   	    => "edit pictures with The GIMP (only UNIX)",
 		   "identify"       => "describe the format and characteristics of a picture",
 		   "thunderbird"    => "send pictures via email",
-		   "mozilla-thunderbird" => "send pictures via email",
 		   "exiftool"       => "Read/write meta information in image files",
 		  );
 # where to find the external programs (resources)
@@@@ -472,11 +469,9 @@@@ my %exprogsres = (
 		   "jpegpixi"       => "http://www.zero-based.org/software/jpegpixi/",
 		   "mogrify"        => "Image Magick http://www.imagemagick.org",
 		   "montage"        => "Image Magick http://www.imagemagick.org",
-		   "gimp-remote"    => "The GIMP http://www.gimp.org",
-		   "gimp-win-remote"=> "gimp-win-remote http://sourceforge.net/projects/gimp-win-remote/",
+		   "gimp"           => "The GIMP http://www.gimp.org",
 		   "identify"       => "Image Magick http://www.imagemagick.org",
 		   "thunderbird"    => "http://www.mozilla.org/projects/thunderbird/",
-		   "mozilla-thunderbird" => "http://www.mozilla.org/projects/thunderbird/",
 		   "exiftool"       => "http://owl.phy.queensu.ca/~phil/exiftool/",	
 		  );
 
@@@@ -544,7 +539,7 @@@@ my %config = (
 			  "ColorThumbBG"    => "azure3",
 			  "ColorProgress"   => "#106dba",
 			  "ColorPicker"     => "#efefef", # last color selected with color picker
-			  "DefaultThumb"    => "$configdir/EmptyThumb.jpg",
+		          "DefaultThumb"    => "${PREFIX}/share/mapivi/pics/EmptyThumb.jpg",
 			  "Copyright"       => "copyright (c) $copyright_year Herrmann",
 			  "Comment"         => "This picture was taken in south africa ...",
 			  "MaxProcs"        => 1,
@@@@ -739,7 +734,6 @@@@ my %config = (
 			  "LineLength"      => 30,  # length of one line in the thumbnail table e.g. for comments
 			  "ExtViewer"       => 'display', # name of external picture viewer
 			  "ExtViewerMulti"  => 0,   # bool
-			  "ExtBGApp"        => "wmsetbg -a", # name of external app to set desktop background (with options) 
 			  "ConvertUmlaut"   => 1,   # convert german umlaute (e.g. ä -> ae etc.)
 			  "DeadPixelStr"    => "1300,846,3 85,411,3 7,365,3 1529,185,3 1593,201,3 1387,1003,3 1957,1057,3 50,1043,2 615,935,3", # info about the dead pixels of your camera see: http://www.zero-based.org/software/jpegpixi/
 			  "DeadPixelMethod" => "linear",
@@@@ -795,7 +789,7 @@@@ my %config = (
 			  "MailPicNoChange" => 0,
 			  "MailPicMaxLength"=> 800,
 			  "MailPicQuality"  => 75,
-              "MailTool"        => 'mozilla-thunderbird',
+              "MailTool"        => 'thunderbird',
 			  "winDirRequesterAskAgain" => 1,
 			  "FuzzyBorderWidth"=> 10,
 			  "FuzzyBorderBlur" => 10,
@@@@ -1083,7 +1077,7 @@@@ ENIIJZtY4oUFGKCwQgw13KBDDz8UcUQTPlBc0cUSAhEEwAANVLBBCC
 dKyyLnF00kjQlkTSR9GqxBKzyS6bEbY0EestAAEBADs=
 EOF
 my $mapiviicon = $top->Photo(-data => $icon_data);
-my $mapiviiconfile = "$configdir/MapiviIcon.gif";
+my $mapiviiconfile = "$icon_path/MapiviIcon.gif";
 $mapiviiconfile    = "$configdir/MapiviIcon32.gif" if $EvilOS;
 #my $mapiviicon = $top->Photo(-file => $mapiviiconfile) if (-f $mapiviiconfile);
 $top->idletasks if $EvilOS; # this line is crucial (at least on windows)
@@@@ -10153,11 +10147,11 @@@@ sub decorationDialog {
   my $pf = $pfa->Frame(-bd => $config{Borderwidth}, -relief => 'groove')->pack(-side => "left");
   my $pfn = $pf->Frame()->pack();
   my $pfs = $pf->Frame()->pack();
-  foreach my $gravity qw(NorthWest North NorthEast) {
+  foreach my $gravity (qw(NorthWest North NorthEast)) {
 	my $but = $pfn->Radiobutton(-text => "", -variable => \$config{CopyPosition}, -value => $gravity)->pack(-side => 'left');
 	$balloon->attach($but, -msg => "Align the copyright text or logo in $gravity position");
   }
-  foreach my $gravity qw(SouthWest South SouthEast) {
+  foreach my $gravity (qw(SouthWest South SouthEast)) {
 	my $but = $pfs->Radiobutton(-text => "", -variable => \$config{CopyPosition}, -value => $gravity)->pack(-side => 'left');
 	$balloon->attach($but, -msg => "Align the copyright text or logo in $gravity position");
   }
@@@@ -13567,8 +13561,6 @@@@ sub createMenubar {
 						}
 						slideshow();
 					  }, -accelerator => "<s>");
-  $view_menu->command(-label => "use actual picture as desktop background",
-					  -command => \&setBackground);
  
   $view_menu->separator;
   my $layout_menu = $view_menu->cascade(-label => "Window layout ...");
@@@@ -13719,7 +13711,7 @@@@ sub addPicProcessing {
     $border_menu->command(-image => compound_menu($top, 'add relative border (lossless) ...', ''), -command => sub { losslessBorder(RELATIVE); } );
     $border_menu->command(-image => compound_menu($top, 'add border or copyright (lossy) ...', ''), -command => \&addDecoration);
 
-    $menu->command(-image => compound_menu($top, 'edit in GIMP', 'applications-graphics.png'), -command => \&GIMPedit, -accelerator => "<Ctrl-e>") unless ($exprogs{"gimp-remote"} or $exprogs{"gimp-win-remote"});
+    $menu->command(-image => compound_menu($top, 'edit in GIMP', 'applications-graphics.png'), -command => \&GIMPedit, -accelerator => "<Ctrl-e>") unless ($exprogs{"gimp"} or $exprogs{"gimp-win-remote"});
 }
 
 ##############################################################
@@@@ -16381,7 +16373,7 @@@@ sub makeButton {
 	my $picName      = shift;
 	my $func         = shift;
 
-	my $pic   = "$configdir/$picName";
+	my $pic   = "${PREFIX}/share/mapivi/$picName";
 	my $image = $parentWidget->Photo(-file => $pic) if -f $pic;
 
 	if ($image) {
@@@@ -20002,7 +19994,7 @@@@ sub plusMinusEntry {
 ##############################################################
 sub normalizeCoords {
   my $canvas = shift;
-  foreach my $coord qw(m_x1 m_x2 m_y1 m_y2) {
+  foreach my $coord (qw(m_x1 m_x2 m_y1 m_y2)) {
 	# assign it to the step width
 	$canvas->{$coord} = sprintf "%.0f", ($canvas->{$coord}/$canvas->{m_step});
 	$canvas->{$coord} *= $canvas->{m_step};
@@@@ -20011,10 +20003,10 @@@@ sub normalizeCoords {
   }
 
   # check upper bound
-  foreach my $coord qw(m_x1 m_x2) {
+  foreach my $coord (qw(m_x1 m_x2)) {
 	$canvas->{$coord} = $canvas->{m_wo} if ($canvas->{$coord} > $canvas->{m_wo});
   }
-  foreach my $coord qw(m_y1 m_y2) {
+  foreach my $coord (qw(m_y1 m_y2)) {
 	$canvas->{$coord} = $canvas->{m_ho} if ($canvas->{$coord} > $canvas->{m_ho});
   }
 }
@@@@ -25675,7 +25667,7 @@@@ sub GIMPedit {
 	return if (!checkExternProgs("GIMPedit", "gimp-win-remote"));
   }
   else {
-	  if (!checkExternProgs("GIMPedit", "gimp-remote")){
+	  if (!checkExternProgs("GIMPedit", "gimp")){
 		  $dpic  = $sellist[0];
 		  $pic   = basename($dpic);
 		  my $rc = $top->messageBox(-icon    => "question",
@@@@ -25698,7 +25690,7 @@@@ sub GIMPedit {
 	# check if file is a link and get the real target
 	next if (!getRealFile(\$dpic));
 
-	my $command = "gimp-remote -n      \"$dpic\" ";
+	my $command = "gimp \"$dpic\" ";
 	#$command    = "gimp-win-remote \"$dpic\" " if $EvilOS;   # GIMP <= 2.0
 	$command    = "gimp-win-remote gimp-2.2.exe \"$dpic\" " if $EvilOS; # GIMP > 2.0
 	$command .= "2>&1 1>/dev/null &" if (!$EvilOS);
@


1.6
log
@
Fix "edit with gimp" function
@
text
@d1 3
a3 3
$OpenBSD: patch-mapivi,v 1.5 2011/07/18 10:00:32 giovanni Exp $
--- mapivi.orig	Thu Feb 21 21:53:44 2008
+++ mapivi	Wed Jul 11 10:47:36 2012
d100 14
d141 22
@


1.5
log
@
Make it start on a clean machine
Minor cleanups
@
text
@d1 1
a1 1
$OpenBSD: patch-mapivi,v 1.4 2008/07/02 14:26:22 landry Exp $
d3 1
a3 1
+++ mapivi	Mon Jul 18 11:51:32 2011
d34 1
a34 1
+my %exprogs = qw/convert 0 composite 0 jhead 0 jpegtran 0 jpegpixi 0 mogrify 0 gimp-remote 0 montage 0 identify 0 exiftool 0/;
d38 2
a39 1
@@@@ -456,11 +456,8 @@@@ my %exprogscom = (
d42 1
a42 1
 		   "gimp-remote"    => "edit pictures with The GIMP (only UNIX)",
d45 1
d52 2
a53 1
@@@@ -473,10 +470,8 @@@@ my %exprogsres = (
d56 1
a56 1
 		   "gimp-remote"    => "The GIMP http://www.gimp.org",
d58 1
d109 9
d127 9
d141 1
a141 1
+	my $command = "gimp-remote \"$dpic\" ";
@


1.4
log
@Long due update to mapivi 0.97, from MAINTAINER Giovanni Bechis, thanks !

ok okan@@
@
text
@d1 1
a1 1
$OpenBSD: patch-mapivi,v 1.3 2007/12/27 22:49:14 kili Exp $
d3 2
a4 2
+++ mapivi	Thu Mar 13 20:25:24 2008
@@@@ -148,11 +148,11 @@@@ if (($EvilOS) and (defined $ENV{APPDATA}) and ($maprog
d14 1
d16 1
a16 1
 if ($splashAvail and -f $logo) {
d19 1
d38 1
a38 1
@@@@ -456,10 +456,7 @@@@ my %exprogscom = (
d45 2
a46 2
-		   "thunderbird"    => "send pictures via email",
 		   "mozilla-thunderbird" => "send pictures via email",
d49 2
a50 1
@@@@ -473,9 +470,7 @@@@ my %exprogsres = (
d56 2
a57 2
-		   "thunderbird"    => "http://www.mozilla.org/projects/thunderbird/",
 		   "mozilla-thunderbird" => "http://www.mozilla.org/projects/thunderbird/",
d60 1
d78 9
@


1.3
log
@
Don't invoke gimp-remote with option "-n"; it has been a noop since
gimp-2.0 and now it's gone completely.
From maintainer Giovanni Bechis.
@
text
@d1 18
a18 4
$OpenBSD: patch-mapivi,v 1.2 2007/05/31 06:52:24 ajacoutot Exp $
--- mapivi.orig	Tue Oct 31 04:21:59 2006
+++ mapivi	Fri Dec 21 22:35:08 2007
@@@@ -341,7 +341,7 @@@@ my $nrToConvert     = 0;
d23 2
a24 2
+my $plugindir       = "!!PREFIX!!/share/mapivi/PlugIns";   # the mapivi plugin dir
 my $iptcdir         = "$configdir/IPTC_templates";  # the IPTC templates directory
d27 1
a27 1
@@@@ -422,7 +422,7 @@@@ my %new_keywords;
d31 1
a31 1
-my %exprogs = qw/convert 0 composite 0 jhead 0 jpegtran 0 jpegpixi 0 mogrify 0 gimp-remote 0 gimp-win-remote 0 montage 0 xwd 0 identify 0 thunderbird 0 exiftool 0/;
d36 1
a36 1
@@@@ -433,10 +433,7 @@@@ my %exprogscom = (
d44 1
d47 1
a47 2
 # where to find the external programs (resources)
@@@@ -449,9 +446,7 @@@@ my %exprogsres = (
d54 1
d57 1
a57 2
 
@@@@ -505,7 +500,7 @@@@ my %config = (
d60 1
a60 1
 			  "ColorPicker"     => "red", # last color selected with color picker
d62 1
a62 1
+			  "DefaultThumb"    => "!!PREFIX!!/share/mapivi/EmptyThumb.jpg",
d66 18
a83 11
@@@@ -1854,9 +1849,7 @@@@ sub startup {
   if ($config{NrOfRuns} == 0) {
 	#whereIsPerl();
 	makeConfigDir();
-	copyConfigPics();
 	copyOtherStuff();
-	copyPlugIns();
   }
   $config{NrOfRuns}++;
   gratulation() if (($config{NrOfRuns} % 1000 == 0) and ($config{NrOfRuns} > 0)); # modulo
@@@@ -13073,8 +13066,6 @@@@ sub createMenubar {
d87 1
a87 1
- $view_menu->command(-label => "use actual picture as desktop background",
d89 4
a92 12
  $view_menu->command(-label => "smart update",
 					  -command => sub { smart_update(); });
 
@@@@ -13217,7 +13208,6 @@@@ sub addFileActionsMenu {
   $fop_menu->command(-label => "copy to ...",    -command => sub { copyPicsDialog(COPY, $lb); } );
   $fop_menu->command(-label => "link to ...",    -command => \&linkPicsDialog) if (!$EvilOS);
   $fop_menu->command(-label => "move to ...",    -command => sub { movePicsDialog($lb); } );
-  $fop_menu->command(-label => "send to ...",    -command => sub { sendTo($lb); } );
   $fop_menu->command(-label => "convert ...",    -command => sub { convertPics($lb); } );
   $fop_menu->command(-label => "copy to print ...", -command => sub { copyToPrint($lb); }, -accelerator => "<Ctrl-p>");
   $fop_menu->command(-label => "rename ...",     -command => sub { renamePic($lb); }, -accelerator => "<r>");
@@@@ -15630,7 +15620,7 @@@@ sub makeButton {
d97 1
a97 1
+	my $pic   = "!!PREFIX!!/share/mapivi/$picName";
d101 1
a101 9
@@@@ -17178,7 +17168,6 @@@@ If this option is enabled one viewer will be started l
 "viewer pic1.jpg pic2.jpg pic3.jpg",
 if not 3 viewers will be started like this:
 "viewer pic1.jpg" "viewer pic2.jpg" "viewer pic3.jpg".');
-  labeledEntry($dF, 'top', $w, "Tool to set the desktop background",\$tmpconf{ExtBGApp});
 
   # ###############  button frame  ########################
 
@@@@ -24417,7 +24406,7 @@@@ sub GIMPedit {
@


1.2
log
@- ${LOCALBASE} -> ${PREFIX}

from Giovanni Bechis
@
text
@d1 1
a1 1
$OpenBSD: patch-mapivi,v 1.1.1.1 2007/05/29 17:08:59 ajacoutot Exp $
d3 1
a3 1
+++ mapivi	Tue May 29 18:56:03 2007
d96 9
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d9 1
a9 1
+my $plugindir       = "!!LOCALBASE!!/share/mapivi/PlugIns";   # the mapivi plugin dir
d48 1
a48 1
+			  "DefaultThumb"    => "!!LOCALBASE!!/share/mapivi/EmptyThumb.jpg",
d84 1
a84 1
+	my $pic   = "!!LOCALBASE!!/share/mapivi/$picName";
@


1.1.1.1
log
@Import mapivi-0.91

Picture Viewer and Organizer written in Perl/Tk. Mapivi supports adding,
viewing and editing of JPEG meta informations like:
EXIF, IPTC/IIM and JPEG comments.

Based on a submission by maintainer Giovanni Bechis on ports@@.
@
text
@@
