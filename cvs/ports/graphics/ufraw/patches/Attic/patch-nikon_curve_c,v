head	1.8;
access;
symbols
	OPENBSD_4_9:1.7.0.2
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.6.0.4
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.2
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.5.0.2
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.4.0.4
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.2
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.3.0.2
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.2.0.4
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.2
	OPENBSD_4_1_BASE:1.2
	ufraw_20060915:1.1.1.1
	mbalmer:1.1.1;
locks; strict;
comment	@# @;


1.8
date	2011.03.06.11.43.38;	author sthen;	state dead;
branches;
next	1.7;

1.7
date	2010.09.16.10.18.38;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2009.10.21.22.44.52;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2009.06.21.14.01.28;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2008.06.07.05.31.41;	author phessler;	state Exp;
branches;
next	1.3;

1.3
date	2007.10.24.22.44.22;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2006.10.28.16.48.16;	author mbalmer;	state Exp;
branches;
next	1.1;

1.1
date	2006.09.17.17.52.38;	author mbalmer;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.09.17.17.52.38;	author mbalmer;	state Exp;
branches;
next	;


desc
@@


1.8
log
@update ufraw to 0.18, main change is updating the internal copy of dcraw to 9.06
@
text
@$OpenBSD: patch-nikon_curve_c,v 1.7 2010/09/16 10:18:38 sthen Exp $
--- nikon_curve.c.orig	Tue Feb 23 17:53:25 2010
+++ nikon_curve.c	Wed Apr  7 03:42:17 2010
@@@@ -353,8 +353,8 @@@@ static const unsigned char *FileTypeHeaders[NUM_FILE_T
 #ifdef _STAND_ALONE_
 
 //filenames
-char exportFilename[1024];
-char nikonFilename[1024];
+char exportFilename[FILENAME_MAX];
+char nikonFilename[FILENAME_MAX];
 
 unsigned int standalone_samplingRes = 65536;
 unsigned int standalone_outputRes = 256;
@@@@ -395,8 +395,7 @@@@ static int ProcessArgs(int num_args, char *args[])
 	else if (strcmp(args[i],"-o") == 0 || strcmp(args[i],"-O") == 0)
 	{
 	    i++;
-	    strncpy(exportFilename, args[i], 1023);
-	    exportFilename[1023] = '\0';
+	    strlcpy(exportFilename, args[i], sizeof(exportFilename));
 	}
 	else if (strcmp(args[i],"-sr") == 0)
 	{
@@@@ -424,24 +423,21 @@@@ static int ProcessArgs(int num_args, char *args[])
 	{
 	    i++;
 	    program_mode = NEF_MODE;
-	    strncpy(nikonFilename, args[i], 1023);
-	    nikonFilename[1023] = '\0';
+	    strlcpy(nikonFilename, args[i], sizeof(nikonFilename));
 	}
 	//don't load argument 0
 	else if (i != 0)
 	{
 	    //consider this the file name to load
-	    strncpy(nikonFilename, args[i], 1023);
-	    nikonFilename[1023] = '\0';
+	    strlcpy(nikonFilename, args[i], sizeof(nikonFilename));
 	}
     }
 
     if (strlen(exportFilename) == 0)
     {
 	//set it to have a default output file name
-	strncpy(exportFilename, nikonFilename, 1023);
-	strncat(exportFilename, "_CURVE_OUTPUT.txt", 1023);
-	exportFilename[1023] = '\0';
+	strlcpy(exportFilename, nikonFilename, sizeof(exportFilename));
+	strlcat(exportFilename, "_CURVE_OUTPUT.txt", sizeof(exportFilename));
     }
 
     return NC_SUCCESS;
@@@@ -1998,7 +1994,7 @@@@ static int ConvertNikonCurveData(char *inFileName, cha
 {
     //Load the curve data from the ncv/ntc file
     NikonData data;
-    char tmpstr[1024];
+    char tmpstr[FILENAME_MAX];
 
     if ( samplingRes <= 1 || outputRes <= 1 || samplingRes > MAX_RESOLUTION
 	    || outputRes > MAX_RESOLUTION )
@@@@ -2028,8 +2024,7 @@@@ static int ConvertNikonCurveData(char *inFileName, cha
 	}
 
 	//rename output files
-	strncpy(tmpstr, outFileName, 1023);
-	tmpstr[1023] = '\0';
+	strlcpy(tmpstr, outFileName, sizeof(tmpstr));
 	//if the name has an extension, attempt to remove it
 	if (tmpstr[strlen(tmpstr)-4] == '.')
 	{
@@@@ -2039,19 +2034,19 @@@@ static int ConvertNikonCurveData(char *inFileName, cha
 	switch(i)
 	{
 	    case TONE_CURVE:
-	        strncat(tmpstr, "_TONE.txt", 1023);
+	        strlcat(tmpstr, "_TONE.txt", sizeof(tmpstr));
 	    break;
 
 	    case RED_CURVE:
-	        strncat(tmpstr, "_RED.txt", 1023);
+	        strlcat(tmpstr, "_RED.txt", sizeof(tmpstr));
 	    break;
 
 	    case GREEN_CURVE:
-	        strncat(tmpstr, "_GREEN.txt", 1023);
+	        strlcat(tmpstr, "_GREEN.txt", sizeof(tmpstr));
 	    break;
 
 	    case BLUE_CURVE:
-	        strncat(tmpstr, "_BLUE.txt", 1023);
+	        strlcat(tmpstr, "_BLUE.txt", sizeof(tmpstr));
 	    break;
 
 	    default:
@


1.7
log
@update UFRaw to 0.17, rolling in the lensfun flavour.
@
text
@d1 1
a1 1
$OpenBSD: patch-nikon_curve_c,v 1.6 2009/10/21 22:44:52 sthen Exp $
@


1.6
log
@update to 0.16
@
text
@d1 4
a4 4
$OpenBSD: patch-nikon_curve_c,v 1.5 2009/06/21 14:01:28 sthen Exp $
--- nikon_curve.c.orig	Thu Jul  9 02:23:49 2009
+++ nikon_curve.c	Wed Oct 21 23:31:01 2009
@@@@ -77,8 +77,8 @@@@ static const unsigned char *FileTypeHeaders[NUM_FILE_T
d15 1
a15 1
@@@@ -119,8 +119,7 @@@@ int ProcessArgs(int num_args, char *args[])
d25 1
a25 1
@@@@ -148,24 +147,21 @@@@ int ProcessArgs(int num_args, char *args[])
d54 1
a54 1
@@@@ -1742,7 +1738,7 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
d63 1
a63 1
@@@@ -1772,8 +1768,7 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
d73 1
a73 1
@@@@ -1783,19 +1778,19 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
@


1.5
log
@sync WANTLIB and update to 0.15; mbalmer ok.
@
text
@d1 3
a3 3
$OpenBSD: patch-nikon_curve_c,v 1.4 2008/06/07 05:31:41 phessler Exp $
--- nikon_curve.c.orig	Tue Dec 16 06:55:29 2008
+++ nikon_curve.c	Thu Jun 18 02:48:27 2009
d54 1
a54 1
@@@@ -1739,7 +1735,7 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
d63 1
a63 1
@@@@ -1769,8 +1765,7 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
d73 1
a73 1
@@@@ -1780,19 +1775,19 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
@


1.4
log
@Update to ufraw-0.13

many changes and fixes, including extended EXIF support, and option to
save as png 8 or 16 bits.

originally from sthen@@, with tweaks by me
ok merdely@@
"if it makes sense, commit it" mbalmer@@
@
text
@d1 3
a3 3
$OpenBSD: patch-nikon_curve_c,v 1.3 2007/10/24 22:44:22 jasper Exp $
--- nikon_curve.c.orig	Sun Nov 11 03:10:38 2007
+++ nikon_curve.c	Sat Dec 29 12:19:46 2007
d54 1
a54 1
@@@@ -1723,7 +1719,7 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
d63 1
a63 1
@@@@ -1753,8 +1749,7 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
d73 1
a73 1
@@@@ -1764,19 +1759,19 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
@


1.3
log
@- unbreak after recent gtk update
- regen patches

looked good to mbalmer@@
@
text
@d1 4
a4 4
$OpenBSD: patch-nikon_curve_c,v 1.2 2006/10/28 16:48:16 mbalmer Exp $
--- nikon_curve.c.orig	Mon Jul 23 14:01:40 2007
+++ nikon_curve.c	Tue Oct 16 12:57:56 2007
@@@@ -76,8 +76,8 @@@@ static const unsigned char *FileTypeHeaders[NUM_FILE_T
d15 1
a15 1
@@@@ -118,8 +118,7 @@@@ int ProcessArgs(int num_args, char *args[])
d25 1
a25 1
@@@@ -147,24 +146,21 @@@@ int ProcessArgs(int num_args, char *args[])
d54 1
a54 1
@@@@ -1722,7 +1718,7 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
d60 1
a60 1
     
d63 1
a63 1
@@@@ -1752,8 +1748,7 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
d65 1
a65 1
 	
d73 1
a73 1
@@@@ -1763,19 +1758,19 @@@@ int ConvertNikonCurveData(char *inFileName, char *outF
@


1.2
log
@Update to ufraw-0.10.  See http://ufraw.sourceforge.net/ for a complete
list of changes.
@
text
@d1 4
a4 4
$OpenBSD: patch-nikon_curve_c,v 1.1.1.1 2006/09/17 17:52:38 mbalmer Exp $
--- nikon_curve.c.orig	Sun Aug 13 17:13:12 2006
+++ nikon_curve.c	Sat Oct 28 18:39:51 2006
@@@@ -76,8 +76,8 @@@@ static const unsigned char *FileTypeHead
d15 1
a15 1
@@@@ -118,8 +118,7 @@@@ int ProcessArgs(int num_args, char *args
d25 1
a25 1
@@@@ -147,24 +146,21 @@@@ int ProcessArgs(int num_args, char *args
d54 1
a54 1
@@@@ -1675,7 +1671,7 @@@@ int ConvertNikonCurveData(char *inFileNa
d63 1
a63 1
@@@@ -1705,8 +1701,7 @@@@ int ConvertNikonCurveData(char *inFileNa
d73 1
a73 1
@@@@ -1716,19 +1711,19 @@@@ int ConvertNikonCurveData(char *inFileNa
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
$OpenBSD$
--- nikon_curve.c.orig	Wed Apr 26 18:30:10 2006
+++ nikon_curve.c	Tue Jul 11 23:00:25 2006
d54 1
a54 1
@@@@ -1674,7 +1670,7 @@@@ int ConvertNikonCurveData(char *inFileNa
d63 1
a63 1
@@@@ -1704,8 +1700,7 @@@@ int ConvertNikonCurveData(char *inFileNa
d73 1
a73 1
@@@@ -1715,19 +1710,19 @@@@ int ConvertNikonCurveData(char *inFileNa
@


1.1.1.1
log
@a raw converter.
CVt: ----------------------------------------------------------------------
@
text
@@
