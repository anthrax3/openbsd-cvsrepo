head	1.3;
access;
symbols
	OPENBSD_5_7:1.1.0.2;
locks; strict;
comment	@# @;


1.3
date	2017.05.05.13.19.24;	author espie;	state Exp;
branches;
next	1.2;
commitid	Ra5i4v7vLjO7xd7p;

1.2
date	2015.06.17.12.46.56;	author sthen;	state dead;
branches;
next	1.1;
commitid	BDamjyEij8CI0i6G;

1.1
date	2015.05.31.06.43.22;	author kirby;	state Exp;
branches
	1.1.2.1;
next	;
commitid	D0Q7foNC1WX3t7hA;

1.1.2.1
date	2015.06.01.07.51.22;	author jasper;	state Exp;
branches;
next	;
commitid	HLsBt1IdEJ66zClb;


desc
@@


1.3
log
@fix with clang/bug-fix from ufraw-current
@
text
@$OpenBSD$
can't find abs of uint with clang
fix stolen from ufraw-current

Index: dcraw.cc
--- dcraw.cc.orig
+++ dcraw.cc
@@@@ -9240,13 +9240,13 @@@@ canon_a5:
       filters = 0x16161616;
     }
     if (make[0] == 'O') {
-      i = find_green (12, 32, 1188864, 3576832);
-      c = find_green (12, 32, 2383920, 2387016);
-      if (abs(i) < abs(c)) {
-	SWAP(i,c);
+      float g1 = find_green (12, 32, 1188864, 3576832);
+      float g2 = find_green (12, 32, 2383920, 2387016);
+      if (fabsf(g1) < fabsf(g2)) {
+	SWAP(g1,g2);
 	load_flags = 24;
       }
-      if ((int) i < 0) filters = 0x61616161;
+      if (g1 < 0) filters = 0x61616161;
     }
   } else if (fsize == 5869568) {
     if (!timestamp && minolta_z2()) {
@


1.2
log
@update to ufraw-0.22, rolling in the dcraw CVE fix already patched and
improving camera support
@
text
@d1 3
a3 1
$OpenBSD: patch-dcraw_cc,v 1.1 2015/05/31 06:43:22 kirby Exp $
d5 22
a26 27
fix CVE-2015-3885
http://ufraw.cvs.sourceforge.net/viewvc/ufraw/ufraw/dcraw.cc?r1=1.334&r2=1.335

--- dcraw.cc.orig	Fri Jan 30 18:15:16 2015
+++ dcraw.cc	Tue May 26 13:21:07 2015
@@@@ -934,7 +934,8 @@@@ struct jhead {
 
 int CLASS ljpeg_start (struct jhead *jh, int info_only)
 {
-  int c, tag, len;
+  int c, tag;
+  ushort len;
   uchar data[0x10000];
   const uchar *dp;
 
@@@@ -945,8 +946,9 @@@@ int CLASS ljpeg_start (struct jhead *jh, int info_only
   do {
     fread (data, 2, 2, ifp);
     tag =  data[0] << 8 | data[1];
-    len = (data[2] << 8 | data[3]) - 2;
-    if (tag <= 0xff00) return 0;
+    len = (data[2] << 8 | data[3]);
+    if (tag <= 0xff00 || len <= 2) return 0;
+    len -= 2;
     fread (data, 1, len, ifp);
     switch (tag) {
       case 0xffc3:
@


1.1
log
@fix CVE-2015-3885 for embedded dcraw.
reported by Sevan / Venture37 on ports@@, thanks
looks ok to kili@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@Security fixes for CVE-2015-3885
@
text
@d1 1
a1 1
$OpenBSD: patch-dcraw_cc,v 1.1 2015/05/31 06:43:22 kirby Exp $
@

