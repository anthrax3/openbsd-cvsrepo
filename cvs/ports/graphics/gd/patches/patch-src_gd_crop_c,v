head	1.1;
access;
symbols
	OPENBSD_6_0:1.1.0.4
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2016.06.30.13.27.42;	author jasper;	state Exp;
branches
	1.1.2.1;
next	;
commitid	ykBD1GFmiII4Yy7Q;

1.1.2.1
date	2016.06.30.13.28.34;	author jasper;	state Exp;
branches;
next	;
commitid	Os0o6dPRKCKU4CpC;


desc
@@


1.1
log
@Security fix for CVE-2016-6128 (libgd does not properly handle invalid color
index which could lead to a denial of service against applications using the
libgd library).
@
text
@$OpenBSD$

CVE-2016-6128
https://bugs.php.net/bug.php?id=72494 
https://github.com/libgd/libgd/compare/3fe0a7128bac5000fdcfab888bd2a75ec0c9447d...fd623025505e87bba7ec8555eeb72dae4fb0afd

--- src/gd_crop.c.orig	Thu Jun 30 15:23:49 2016
+++ src/gd_crop.c	Thu Jun 30 15:24:14 2016
@@@@ -136,6 +136,10 @@@@ BGD_DECLARE(gdImagePtr) gdImageCropThreshold(gdImagePt
 		return NULL;
 	}
 
+	if (!gdImageTrueColor(im) && color >= gdImageColorsTotal(im)) {
+		return NULL;
+	}
+	
 	/* TODO: Add gdImageGetRowPtr and works with ptr at the row level
 	 * for the true color and palette images
 	 * new formats will simply work with ptr
@


1.1.2.1
log
@Security fix for CVE-2016-6128 (libgd does not properly handle invalid color
index which could lead to a denial of service against applications using the
libgd library).
@
text
@d1 1
a1 1
$OpenBSD: patch-src_gd_crop_c,v 1.1 2016/06/30 13:27:42 jasper Exp $
@

