head	1.3;
access;
symbols
	OPENBSD_6_1:1.2.0.4
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.2
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.1.0.2
	OPENBSD_5_9_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2017.05.23.13.00.46;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	NC0FUknvzq58Se0n;

1.2
date	2016.05.18.20.02.27;	author sthen;	state Exp;
branches;
next	1.1;
commitid	j9bfsiSBfoGsmrqp;

1.1
date	2015.10.09.07.06.52;	author ajacoutot;	state Exp;
branches;
next	;
commitid	Rl8XoJhkYtTyIxf9;


desc
@@


1.3
log
@Update to sane-backends-1.0.27.
- now uses libusb1, so ping me if you see a regression
@
text
@$OpenBSD: patch-backend_canon-sane_c,v 1.2 2016/05/18 20:02:27 sthen Exp $

errno.h header is required now that errno is a per-thread variable.
"undefined symbol 'errno'" at runtime with dlopen()'d modules.

Index: backend/canon-sane.c
--- backend/canon-sane.c.orig
+++ backend/canon-sane.c
@@@@ -1,3 +1,5 @@@@
+#include <errno.h>
+
 SANE_Status
 sane_init (SANE_Int * version_code, SANE_Auth_Callback __sane_unused__ authorize)
 {
@@@@ -858,10 +860,10 @@@@ sane_control_option (SANE_Handle handle, SANE_Int opti
 	  if (status == SANE_STATUS_GOOD)
 	    {
 	      time (&(s->time1));
-	      DBG (11, "time0 = %ld\n", s->time0);
-	      DBG (11, "time1 = %ld\n", s->time1);
+	      DBG (11, "time0 = %lld\n", s->time0);
+	      DBG (11, "time1 = %lld\n", s->time1);
 	      dtime = (s->time1) - (s->time0);
-	      DBG (11, "dtime = %ld\n", dtime);
+	      DBG (11, "dtime = %lld\n", dtime);
 
 	      DBG (11, "switch_preview = %d\n", s->switch_preview);
 	      if (s->switch_preview == 0)
@@@@ -875,7 +877,7 @@@@ sane_control_option (SANE_Handle handle, SANE_Int opti
 
 	      DBG (11, "SANE_UNFIX(s->val[OPT_BR_Y].w) = %f\n",
 		   SANE_UNFIX (s->val[OPT_BR_Y].w));
-	      DBG (11, "rt = %ld\n", rt);
+	      DBG (11, "rt = %lld\n", rt);
 
 	      if (dtime < rt)
 		{
@


1.2
log
@Make sure we pull in errno.h for all files in sane-backends that use
errno. This is a requirement on OpenBSD now that errno is stored in the
TIB; most uses have already been taken care of, but this slipped through
the cracks as it only provides a dlopen()'d module rather than object
code which is linked during build.  ok guenther@@ ajacoutot@@

Note to readers, if you see "undefined symbol 'errno'" messages when you
run or use programs on OpenBSD following this change (libc 87.0 etc.),
please report them, even if the program appears to otherwise run normally.
@
text
@d1 1
a1 1
$OpenBSD: patch-backend_canon-sane_c,v 1.1 2015/10/09 07:06:52 ajacoutot Exp $
d6 3
a8 2
--- backend/canon-sane.c.orig	Sun Aug 25 22:22:58 2013
+++ backend/canon-sane.c	Wed May 18 14:01:04 2016
d13 1
a13 1
 sane_init (SANE_Int * version_code, SANE_Auth_Callback UNUSEDARG authorize)
@


1.1
log
@Update to sane-backends-1.0.25.
@
text
@d1 14
a14 4
$OpenBSD$
--- backend/canon-sane.c.orig	Thu Oct  8 08:07:40 2015
+++ backend/canon-sane.c	Thu Oct  8 08:08:10 2015
@@@@ -858,10 +858,10 @@@@ sane_control_option (SANE_Handle handle, SANE_Int opti
d28 1
a28 1
@@@@ -875,7 +875,7 @@@@ sane_control_option (SANE_Handle handle, SANE_Int opti
@

