head	1.9;
access;
symbols
	OPENBSD_3_5:1.8.0.16
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.8.0.14
	OPENBSD_3_4_BASE:1.8
	OPENBSD_3_3:1.8.0.12
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.8.0.10
	OPENBSD_3_2_BASE:1.8
	OPENBSD_3_1:1.8.0.8
	OPENBSD_3_1_BASE:1.8
	OPENBSD_3_0:1.8.0.6
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9_TRACKING_SWITCH:1.8
	OPENBSD_2_9:1.8.0.4
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_8:1.8.0.2
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.4.0.2
	OPENBSD_2_7_BASE:1.4
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3
	OPENBSD_2_5:1.2.0.4
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.2
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.1.1.1.0.2
	OPENBSD_2_3_BASE:1.1.1.1
	mpeg-lib_1_2_1:1.1.1.1
	mpeg-lib:1.1.1;
locks; strict;
comment	@# @;


1.9
date	2004.06.22.03.07.17;	author brad;	state dead;
branches;
next	1.8;

1.8
date	2000.10.16.21.17.13;	author brad;	state Exp;
branches;
next	1.7;

1.7
date	2000.09.24.02.13.09;	author brad;	state Exp;
branches;
next	1.6;

1.6
date	2000.09.14.14.19.24;	author brad;	state Exp;
branches;
next	1.5;

1.5
date	2000.09.14.13.31.16;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	2000.01.09.05.56.34;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	99.06.13.03.41.55;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	98.06.30.22.29.11;	author marc;	state Exp;
branches;
next	1.1;

1.1
date	97.12.20.03.17.26;	author don;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	97.12.20.03.17.26;	author don;	state Exp;
branches;
next	;


desc
@@


1.9
log
@rename patches
@
text
@--- Makefile.in.orig	Thu Nov 26 11:03:29 1998
+++ Makefile.in	Mon Oct 16 15:29:06 2000
@@@@ -15,11 +15,13 @@@@
 CPPFLAGS      = $(INCLUDE_DIRS) $(DEFINES)
 
 # Installation directories (and install program)
+DESTDIR         = 
+
 prefix          = @@prefix@@
 exec_prefix     = @@exec_prefix@@
 INSTALL_INCLUDE = @@includedir@@
 INSTALL_LIBRARY = @@libdir@@
-INSTALL         = @@INSTALL@@
+INSTALL_DATA    = @@INSTALL_DATA@@
 
 # Other miscellaneous programs
 AR            = @@AR@@
@@@@ -37,23 +39,29 @@@@
 		mono.c ordered.c ordered2.c mb_ordered.c
 LIBSRC        = @@libsrc@@
 LIBOBJ        = @@libobj@@
+SHLIBOBJ      = $(LIBOBJ:.o=.so)
 
 
 # Other files of interest
 
 LIBRARY       = libmpeg.a
-SHLIB         = libmpeg.so
+SHLIB         = libmpeg.so.13.1
 HEADER        = mpeg.h
 EXTRAS        = @@extras@@
 
+PICFLAG       = -fpic
+
+.SUFFIXES: .o .so
+
 # Implicit targets
 .c.o:
 		$(CC) -c $(CFLAGS) $(CPPFLAGS) $<
 
+.c.so:
+		$(CC) -c $(CFLAGS) $(CPPFLAGS) $(PICFLAG) -DPIC $< -o $@@
 
-# Library/cleanup targets: 
 
-all:		lib $(EXTRAS)
+# Library/cleanup targets: 
 
 lib:		$(LIBRARY)
 
@@@@ -63,17 +71,24 @@@@
 		$(AR) $(ARFLAGS) $(LIBRARY) $(LIBOBJ)
 		$(RANLIB) $(LIBRARY)
 
-$(SHLIB):	$(LIBOBJ)
-		$(CC) -shared -o $(SHLIB) $(LIBOBJ)
+$(SHLIB):	$(SHLIBOBJ)
+		$(CC) -shared $(PICFLAG) -o $(SHLIB) $(SHLIBOBJ)
 
+.if defined(NO_SHARED_LIBS) && ${NO_SHARED_LIBS:L} == "yes"
+all:		lib $(EXTRAS)
 install:	$(LIBRARY)
-		$(INSTALL) -d $(INSTALL_INCLUDE) $(INSTALL_LIBRARY)
-		$(INSTALL) -m 0644 $(HEADER) $(INSTALL_INCLUDE)/$(HEADER)
-		$(INSTALL) -m 0644 $(LIBRARY) $(INSTALL_LIBRARY)/$(LIBRARY)
-		@@if test -f $(SHLIB) ; then echo "warning: $(SHLIB) *not* installed (installing shared libraries is too system-specific)" ; fi
+.else
+all:		lib shlib $(EXTRAS)
+install:	$(LIBRARY) $(SHLIB)
+.endif
+		$(INSTALL_DATA) $(HEADER) $(DESTDIR)$(INSTALL_INCLUDE)
+		$(INSTALL_DATA) $(LIBRARY) $(DESTDIR)$(INSTALL_LIBRARY)
+		@@if [ -f $(SHLIB) ]; then \
+		   $(INSTALL_DATA) $(SHLIB) $(DESTDIR)$(INSTALL_LIBRARY); \
+		fi
 
 clean:
-		rm -f $(LIBRARY) $(EXTRAS) $(LIBOBJ) core
+		rm -f $(LIBRARY) $(SHLIB) $(EXTRAS) $(LIBOBJ) $(SHLIBOBJ) core
 		cd extras && $(MAKE) clean
 
 distclean:	clean
@


1.8
log
@pass the pic flag along to the compiler when linking the shared library.
@
text
@@


1.7
log
@revert switch to libtool, use "cc -shared" to create shared libraries
@
text
@d2 1
a2 1
+++ Makefile.in	Sat Sep 23 21:44:36 2000
d18 1
a18 1
@@@@ -37,23 +39,27 @@@@
d33 2
d42 1
a42 1
+		$(CC) -c $(CFLAGS) $(CPPFLAGS) -fpic -DPIC $< -o $@@
d51 1
a51 1
@@@@ -63,17 +69,24 @@@@
d58 1
a58 1
+		$(CC) -shared -o $(SHLIB) $(SHLIBOBJ)
@


1.6
log
@better, eliminates relinking of libraries on installation
@
text
@d2 2
a3 2
+++ Makefile.in	Thu Sep 14 10:15:18 2000
@@@@ -15,16 +15,19 @@@@
d18 5
a22 3
 ARFLAGS       = -ru
 RANLIB        = @@RANLIB@@
+LIBTOOL       = libtool --quiet
a24 3
 # Source for the library itself -- note that we define LIBSRC and
@@@@ -41,14 +44,14 @@@@
 
d27 3
a29 3
-LIBRARY       = libmpeg.a
+LIBRARY       = libmpeg.la
 SHLIB         = libmpeg.so
d33 2
d37 4
a40 2
-		$(CC) -c $(CFLAGS) $(CPPFLAGS) $<
+		$(LIBTOOL) --mode=compile $(CC) -c $(CFLAGS) $(CPPFLAGS) $<
d42 1
d44 8
a51 10
 # Library/cleanup targets: 
@@@@ -60,20 +63,19 @@@@
 shlib:          $(SHLIB)
 
 $(LIBRARY):	$(LIBOBJ)
-		$(AR) $(ARFLAGS) $(LIBRARY) $(LIBOBJ)
-		$(RANLIB) $(LIBRARY)
+		$(LIBTOOL) --mode=link $(CC) $(CFLAGS) -o libmpeg.la \
+			$(LIBOBJ:.o=.lo) -version-info 13:1:0 -rpath $(INSTALL_LIBRARY)
+
d53 4
a56 2
 $(SHLIB):	$(LIBOBJ)
 		$(CC) -shared -o $(SHLIB) $(LIBOBJ)
d58 2
d65 4
d70 4
a73 1
+		$(LIBTOOL) --mode=install $(INSTALL_DATA) libmpeg.la $(DESTDIR)$(INSTALL_LIBRARY)
d77 1
a77 1
+		rm -f $(LIBRARY) $(SHLIB) $(EXTRAS) $(LIBOBJ) $(LIBOBJ:.o=.lo) core
@


1.5
log
@switch to libtool for shared library creation
@
text
@d2 1
a2 1
+++ Makefile.in	Thu Sep 14 08:44:26 2000
d24 9
a32 1
@@@@ -48,7 +51,7 @@@@
d60 1
a60 1
+		libtool --mode=install $(INSTALL_DATA) libmpeg.la $(DESTDIR)$(INSTALL_LIBRARY)
@


1.4
log
@upgrade to mpeg_lib 1.3.1
@
text
@d2 8
a9 2
+++ Makefile.in	Thu Dec 23 22:55:03 1999
@@@@ -19,13 +19,14 @@@@
d20 1
a21 1
+.SUFFIXES: .c .o .so
d24 1
a24 15
 # LIBOBJ this way (instead of just LIBOBJ=$(LIBSRC:.c=.o) because
@@@@ -37,12 +38,13 @@@@
 		mono.c ordered.c ordered2.c mb_ordered.c
 LIBSRC        = @@libsrc@@
 LIBOBJ        = @@libobj@@
+SHLIBOBJ      = @@shlibobj@@
 
 
 # Other files of interest
 
 LIBRARY       = libmpeg.a
-SHLIB         = libmpeg.so
+SHLIB         = libmpeg.so.13.1
 HEADER        = mpeg.h
 EXTRAS        = @@extras@@
d26 1
a26 1
@@@@ -50,10 +52,16 @@@@
d28 2
a29 1
 		$(CC) -c $(CFLAGS) $(CPPFLAGS) $<
a30 2
+.c.so:
+		$(CC) -c $(CFLAGS) $(CPPFLAGS) -fpic -DPIC $< -o $@@
d33 2
d36 9
a44 16
+.if defined(NO_SHARED_LIBRARY) && ${NO_SHARED_LIBRARY:U} == YES
 all:		lib $(EXTRAS)
+.else
+all:		lib shlib $(EXTRAS)
+.endif
 
 lib:		$(LIBRARY)
 
@@@@ -63,17 +71,22 @@@@
 		$(AR) $(ARFLAGS) $(LIBRARY) $(LIBOBJ)
 		$(RANLIB) $(LIBRARY)
 
-$(SHLIB):	$(LIBOBJ)
-		$(CC) -shared -o $(SHLIB) $(LIBOBJ)
+$(SHLIB):	$(SHLIBOBJ)
+		ld -Bshareable -Bforcearchive -o $(SHLIB) $(SHLIBOBJ)
a45 1
+.if defined(NO_SHARED_LIBRARY) && ${NO_SHARED_LIBRARY:U} == YES
d51 2
a52 8
+.else
+install:	$(LIBRARY) $(SHLIB)
+.endif
+		$(INSTALL_DATA) $(HEADER) $(INSTALL_INCLUDE)/$(HEADER)
+		$(INSTALL_DATA) $(LIBRARY) $(INSTALL_LIBRARY)/$(LIBRARY)
+		@@if [ -f $(SHLIB) ]; then \
+		 $(INSTALL_DATA) $(SHLIB) $(INSTALL_LIBRARY)/$(SHLIB) ;\
+		fi
d56 1
a56 1
+		rm -f $(LIBRARY) $(SHLIB) $(EXTRAS) $(LIBOBJ) core
@


1.3
log
@use -Bforcearchive when linking the shared lib
@
text
@d1 12
a12 3
--- Makefile.in.orig	Mon Feb 26 10:12:54 1996
+++ Makefile.in	Tue Jun 30 15:13:40 1998
@@@@ -16,6 +16,7 @@@@
a13 1
 SHELL         = /bin/sh
d15 1
a15 1
+.SUFFIXES: .so
d19 1
a19 1
@@@@ -27,23 +28,33 @@@@
d29 8
a36 2
+SHLIBRARY	  = libmpeg.so.1.2
 MPEGTEST      = mpegtest
d38 10
a47 1
 # Targets for all platforms
d49 1
a49 2
-all:		$(LIBRARY) @@extras@@
+all:		$(LIBRARY) ${SHLIBRARY} @@extras@@
d51 1
a51 1
 $(LIBRARY):	$(LIBOBJ)
d55 19
a73 11
+$(SHLIBRARY):	$(SHLIBOBJ)
+		ld -Bshareable -Bforcearchive -o $(SHLIBRARY) $(SHLIBOBJ)
+
 $(LIBOBJ):	Makefile
 
+install:
+	install -c -m 444 ${LIBRARY} ${PREFIX}/lib
+	install -c -m 444 ${SHLIBRARY} ${PREFIX}/lib
+	install -c -m 444 mpeg.h ${PREFIX}/include
+
 @@Makefile_extras@@
d76 3
a78 9
@@@@ -53,6 +64,9 @@@@
 distclean: clean
 		rm -f config.cache config.log config.status Makefile config.h
 		cd extras && $(MAKE) distclean
+
+.c.so:
+	${CC} ${CFLAGS} -fpic -DPIC -c $< -o $@@
 
 # Include a system-specific Makefile fragment, if any
d80 1
@


1.2
log
@don't build shared libs on the alpha; only one patch per patch file
@
text
@d34 1
a34 1
+		ld -Bshareable -o $(SHLIBRARY) $(SHLIBOBJ)
@


1.1
log
@Initial revision
@
text
@d1 55
a55 151
*** Makefile.in.orig	Mon Feb 26 12:12:54 1996
--- Makefile.in	Thu Dec 18 19:36:45 1997
***************
*** 16,21 ****
--- 16,22 ----
  RANLIB        = @@RANLIB@@
  SHELL         = /bin/sh
  
+ .SUFFIXES: .so
  
  # Source for the library itself -- note that we define LIBSRC and
  # LIBOBJ this way (instead of just LIBOBJ=$(LIBSRC:.c=.o) because
***************
*** 27,49 ****
  		mono.c ordered.c ordered2.c mb_ordered.c
  LIBSRC        = @@libsrc@@
  LIBOBJ        = @@libobj@@
  
  
  # Other files of interest
  
  LIBRARY       = libmpeg.a
  MPEGTEST      = mpegtest
  
  # Targets for all platforms
  
! all:		$(LIBRARY) @@extras@@
  
  $(LIBRARY):	$(LIBOBJ)
  		$(AR) $(ARFLAGS) $(LIBRARY) $(LIBOBJ)
  		$(RANLIB) $(LIBRARY)
  
  $(LIBOBJ):	Makefile
  
  @@Makefile_extras@@
  
  clean:
--- 28,59 ----
  		mono.c ordered.c ordered2.c mb_ordered.c
  LIBSRC        = @@libsrc@@
  LIBOBJ        = @@libobj@@
+ SHLIBOBJ      = @@shlibobj@@
  
  
  # Other files of interest
  
  LIBRARY       = libmpeg.a
+ SHLIBRARY	  = libmpeg.so.1.2
  MPEGTEST      = mpegtest
  
  # Targets for all platforms
  
! all:		$(LIBRARY) ${SHLIBRARY} @@extras@@
  
  $(LIBRARY):	$(LIBOBJ)
  		$(AR) $(ARFLAGS) $(LIBRARY) $(LIBOBJ)
  		$(RANLIB) $(LIBRARY)
  
+ $(SHLIBRARY):	$(SHLIBOBJ)
+ 		ld -Bshareable -o $(SHLIBRARY) $(SHLIBOBJ)
+ 
  $(LIBOBJ):	Makefile
  
+ install:
+ 	install -c -m 444 ${LIBRARY} ${SHLIBRARY} ${PREFIX}/lib
+ 	install -c -m 444 mpeg.h ${PREFIX}/include
+ 
  @@Makefile_extras@@
  
  clean:
***************
*** 53,58 ****
--- 63,71 ----
  distclean: clean
  		rm -f config.cache config.log config.status Makefile config.h
  		cd extras && $(MAKE) distclean
+ 
+ .c.so:
+ 	${CC} ${CFLAGS} -fpic -DPIC -c $< -o $@@
  
  # Include a system-specific Makefile fragment, if any
  
*** configure.orig	Mon Feb 26 11:58:27 1996
--- configure	Thu Dec 18 19:36:45 1997
***************
*** 817,822 ****
--- 817,823 ----
  if test $dither = yes; then
    libsrc='$(DECODER_SRC) $(DITHER_SRC)'
    libobj='$(DECODER_SRC:.c=.o) $(DITHER_SRC:.c=.o)'
+   shlibobj='$(DECODER_SRC:.c=.so) $(DITHER_SRC:.c=.so)'
    cat >> confdefs.h <<\EOF
  #define ENABLE_DITHER 1
  EOF
***************
*** 825,830 ****
--- 826,832 ----
  else
    libsrc='$(DECODER_SRC)'
    libobj='$(DECODER_SRC:.c=.o)'
+   shlibobj='$(DECODER_SRC:.c=.so)'
    cat >> confdefs.h <<\EOF
  #define ENABLE_DITHER 0
  EOF
***************
*** 1459,1464 ****
--- 1461,1467 ----
  s%@@AR@@%$AR%g
  s%@@libsrc@@%$libsrc%g
  s%@@libobj@@%$libobj%g
+ s%@@shlibobj@@%$shlibobj%g
  s%@@jrevdct@@%$jrevdct%g
  s%@@extras@@%$extras%g
  /@@Makefile_extras@@/r $Makefile_extras
*** config.guess.orig	Thu Dec 18 19:51:29 1997
--- config.guess	Thu Dec 18 20:00:23 1997
***************
*** 311,316 ****
--- 311,319 ----
      *:NetBSD:*:*)
  	echo ${UNAME_MACHINE}-unknown-netbsd`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
  	exit 0 ;;
+     *:OpenBSD:*:*)
+ 	echo ${UNAME_MACHINE}-unknown-openbsd`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+ 	exit 0 ;;
      *:GNU:*:*)
  	echo `echo ${UNAME_MACHINE}|sed -e 's,/.*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
  	exit 0 ;;
*** config.sub.orig	Thu Dec 18 20:03:37 1997
--- config.sub	Thu Dec 18 20:06:00 1997
***************
*** 637,645 ****
  	      | -amigados* | -msdos* | -newsos* | -unicos* | -aos* \
  	      | -nindy* | -vxworks* | -ebmon* | -hms* | -mvs* | -clix* \
  	      | -riscos* | -linux* | -uniplus* | -iris* | -rtu* | -xenix* \
! 	      | -hiux* | -386bsd* | -netbsd* | -freebsd* | -riscix* \
! 	      | -lynxos* | -bosx* | -nextstep* | -cxux* | -aout* | -elf* \
! 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
  	      | -udi* | -eabi* | -lites* )
  	# Remember, each alternative MUST END IN *, to match a version number.
  		;;
--- 637,645 ----
  	      | -amigados* | -msdos* | -newsos* | -unicos* | -aos* \
  	      | -nindy* | -vxworks* | -ebmon* | -hms* | -mvs* | -clix* \
  	      | -riscos* | -linux* | -uniplus* | -iris* | -rtu* | -xenix* \
! 	      | -hiux* | -386bsd* | -netbsd* | -openbsd* | -freebsd* \
! 	      |	-riscix* | -lynxos* | -bosx* | -nextstep* | -cxux* | -aout* \
! 	      | -elf* | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
  	      | -udi* | -eabi* | -lites* )
  	# Remember, each alternative MUST END IN *, to match a version number.
  		;;
@


1.1.1.1
log
@Initial import.
@
text
@@
