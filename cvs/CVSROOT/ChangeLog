CVSROOT:	/cvs
Module name:	www
Changes by:	mlarkin@cvs.openbsd.org	2017/04/01 17:35:12

Modified files:
	.              : 61.html 

Log message:
update 61.html with vmm improvements from last couple weeks


CVSROOT:	/cvs
Module name:	www
Changes by:	beck@cvs.openbsd.org	2017/04/01 17:48:07

Modified files:
	.              : 61.html 

Log message:
LibreSSL will be 2.5.3 for release, include releease notes so far in 61.html


CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2017/04/01 18:27:36

Modified files:
	sys/conf       : newvers.sh 

Log message:
unlock tree, we are now hacking on 6.1-current


CVSROOT:	/cvs
Module name:	src
Changes by:	beck@cvs.openbsd.org	2017/04/01 18:27:44

Modified files:
	usr.bin/systat : iostat.c 

Log message:
Make dma range buffer cache pages visible in systat io
ok deraadt@


CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2017/04/01 18:28:56

Modified files:
	sys/dev/acpi   : acpitz.c 

Log message:
normalize order of arguments to if ()


CVSROOT:	/cvs
Module name:	src
Changes by:	guenther@cvs.openbsd.org	2017/04/01 18:53:37

Modified files:
	libexec/comsat : comsat.c 

Log message:
Prefer pread() over lseek()+read()
open() only needs the mode argument if O_CREAT is present

ok beck@ deraadt@


CVSROOT:	/cvs
Module name:	www
Changes by:	jcs@cvs.openbsd.org	2017/04/01 19:00:51

Modified files:
	.              : 61.html 

Log message:
add acpisbs, mention acpi change for apple hardware


CVSROOT:	/cvs
Module name:	www
Changes by:	jsg@cvs.openbsd.org	2017/04/01 20:16:09

Modified files:
	.              : arm64.html 

Log message:
Describe problems caused by boards that require boot firmware on the
system disk.

ok patrick@


CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2017/04/01 20:51:51

Modified files:
	usr.bin/unifdef: unifdef.c 

Log message:
Replace snprintf(NULL, malloc, snprintf.... with the much better asprintf.
ok millert


CVSROOT:	/cvs
Module name:	src
Changes by:	visa@cvs.openbsd.org	2017/04/01 21:51:13

Modified files:
	sys/arch/mips64/mips64: context.S 

Log message:
Bring back the wait instruction into the idle loop, but only on octeon.
This lets an idle SoC run a bit cooler.

Tested on CN5020, CN6120 and CN7130.


CVSROOT:	/cvs
Module name:	src
Changes by:	visa@cvs.openbsd.org	2017/04/01 22:01:52

Modified files:
	gnu/usr.bin/binutils-2.17/bfd: archive64.c 

Log message:
Fix an out-of-bounds memory access with 64-bit armaps.

OK kettenis@


CVSROOT:	/cvs
Module name:	src
Changes by:	jsg@cvs.openbsd.org	2017/04/02 00:02:19

Modified files:
	distrib/notes/arm64: hardware 

Log message:
add overdrive 1000


CVSROOT:	/cvs
Module name:	src
Changes by:	jca@cvs.openbsd.org	2017/04/02 06:56:39

Modified files:
	sys/netinet    : tcp_usrreq.c 

Log message:
Fix tcp stats reporting

Return the sum of per-cpu counters instead of the current cpu's
counters.  Brainfart on my side.  Analysis and fix by Andrei-Marius Radu.


CVSROOT:	/cvs
Module name:	src
Changes by:	visa@cvs.openbsd.org	2017/04/02 09:25:05

Modified files:
	sys/arch/octeon/dev: if_cnmac.c 

Log message:
Drop address conversion cruft.


CVSROOT:	/cvs
Module name:	src
Changes by:	visa@cvs.openbsd.org	2017/04/02 09:48:19

Modified files:
	sys/arch/loongson/loongson: machdep.c 
	sys/arch/octeon/octeon: machdep.c 
	sys/arch/sgi/sgi: machdep.c 

Log message:
printf format strings should be literals. Reminded by clang.


CVSROOT:	/cvs
Module name:	www
Changes by:	beck@cvs.openbsd.org	2017/04/02 10:38:32

Modified files:
	.              : 61.html 

Log message:
httpd and nc and ocspcheck, etc. etc.


CVSROOT:	/cvs
Module name:	www
Changes by:	beck@cvs.openbsd.org	2017/04/02 10:53:22

Modified files:
	.              : 61.html 

Log message:
minor cleanups


CVSROOT:	/cvs
Module name:	www
Changes by:	beck@cvs.openbsd.org	2017/04/02 11:01:12

Modified files:
	.              : 61.html 

Log message:
don't forget about BN_gcd goodies that were addded to avoid RSA keygen sidechannels


CVSROOT:	/cvs
Module name:	src
Changes by:	kettenis@cvs.openbsd.org	2017/04/02 12:06:57

Modified files:
	sys/arch/arm64/arm64: pmap.c 

Log message:
On ARMv8, the translation table walk is fully coherent so there is no
reason to explicitly flush the cache before invalidating the TLB.  The
barrier that is included in out TLB flushing code should be enough to
guarantee that the TLB walking hardware sees the updated page table
contents, so the explicit barriers can go as well.  Sanitize the code
immediately surrounding the removed bits while I'm there.

Tested by jsg@, ok drahn@, visa@


CVSROOT:	/cvs
Module name:	src
Changes by:	jmc@cvs.openbsd.org	2017/04/02 12:13:19

Modified files:
	usr.bin/units  : units.lib 

Log message:
update currency exchange rates;


CVSROOT:	/cvs
Module name:	src
Changes by:	jmc@cvs.openbsd.org	2017/04/02 12:14:34

Modified files:
	libexec/spamd  : spamd.8 

Log message:
note that some hosts never generate tuples and are ignored;
ok beck


CVSROOT:	/cvs
Module name:	www
Changes by:	tj@cvs.openbsd.org	2017/04/02 12:30:27

Modified files:
	faq/ports      : guide.html 

Log message:
consistent formatting in the make commands; from anton lindqvist


CVSROOT:	/cvs
Module name:	www
Changes by:	deraadt@cvs.openbsd.org	2017/04/02 12:41:02

Modified files:
	.              : 61.html 

Log message:
some cleanup


CVSROOT:	/cvs
Module name:	src
Changes by:	mlarkin@cvs.openbsd.org	2017/04/02 14:21:44

Modified files:
	sys/arch/amd64/amd64: vmm.c 

Log message:
Filter out RDTSCP, needed to handle solaris guests. We set the VMX control
to enable RDTSCP to 0, so when solaris attempted to use the instruction
(since it wasn't filtered out of CPUID information), the CPU issued an
#UD exception.


CVSROOT:	/cvs
Module name:	src
Changes by:	krw@cvs.openbsd.org	2017/04/02 14:57:22

Modified files:
	sbin/dhclient  : parse.c 

Log message:
Change parse_string() warning from "filename must be a string" to
"expecting a string". Things other than filenames are parsed here.


CVSROOT:	/cvs
Module name:	src
Changes by:	tom@cvs.openbsd.org	2017/04/02 15:23:44

Modified files:
	sbin/isakmpd   : field.c 

Log message:
Check return value of asprintf(), and don't use 0 as a char *

Started by, and ok, deraadt@


CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2017/04/02 16:57:21

Modified files:
	usr.sbin/rtadvd: dump.c 

Log message:
Always use return value of asprintf to determine success/failure,
don't rely upon *ret becoming NULL
ok millert, tom


CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2017/04/02 17:02:06

Modified files:
	usr.bin/less   : line.c 

Log message:
The character buffer should be resized using recallocarray()
ok millert and nicm a while ago


CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2017/04/02 17:40:09

Modified files:
	sys/kern       : uipc_socket.c 

Log message:
Less convoluted code in soshutdown()
ok guenther


CVSROOT:	/cvs
Module name:	www
Changes by:	stsp@cvs.openbsd.org	2017/04/03 03:16:44

Modified files:
	build          : support.dat 

Log message:
tweak my support entry


CVSROOT:	/cvs
Module name:	www
Changes by:	stsp@cvs.openbsd.org	2017/04/03 03:16:55

Modified files:
	.              : support.html 

Log message:
sync


CVSROOT:	/cvs
Module name:	ports
Changes by:	jca@cvs.openbsd.org	2017/04/03 04:08:17

Modified files:
	security/botan2: Makefile 
	security/botan2/pkg: PLIST 
Added files:
	security/botan2/pkg: PFRAG.x86 

Log message:
Fix packaging on !(x86)

rdrand_rng.h is arch-specific.  ok bluhm@ (maintainer)


CVSROOT:	/cvs
Module name:	src
Changes by:	visa@cvs.openbsd.org	2017/04/03 07:51:54

Modified files:
	sys/arch/octeon/octeon: locore.S 

Log message:
Compute address for ll/sc only once.


CVSROOT:	/cvs
Module name:	src
Changes by:	krw@cvs.openbsd.org	2017/04/03 08:16:34

Modified files:
	sbin/dhclient  : clparse.c parse.c 

Log message:
Tweak 'expecting' parse_warn() messages to be more consistent.


CVSROOT:	/cvs
Module name:	src
Changes by:	krw@cvs.openbsd.org	2017/04/03 09:34:46

Modified files:
	sbin/dhclient  : clparse.c parse.c 

Log message:
Tweak parse_string() to not consume the ';'. Simplifies/shortens
some logic.


CVSROOT:	/cvs
Module name:	src
Changes by:	beck@cvs.openbsd.org	2017/04/03 09:52:59

Modified files:
	lib/libcrypto/asn1: t_x509.c 

Log message:
Fix silly code that printfs NULL when there are no fractional seconds
on a GENREALIZEDTIME (which there should really never be for anything
remotely standards compliant)
ok jsing@


CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2017/04/03 10:10:00

Modified files:
	sys/dev/onewire: onewire.c 

Log message:
provide size to free(9)


CVSROOT:	/cvs
Module name:	src
Changes by:	tedu@cvs.openbsd.org	2017/04/03 10:18:35

Modified files:
	usr.bin/grep   : util.c 

Log message:
initialize regmatch_t always, fixes grep -o ""
from Michael Santos


CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2017/04/03 11:07:58

Modified files:
	libexec/comsat : comsat.c 

Log message:
use recallocarray() because the array contains data that can be observed


CVSROOT:	/cvs
Module name:	www
Changes by:	claudio@cvs.openbsd.org	2017/04/03 11:21:28

Modified files:
	.              : 61.html 

Log message:
The limits for the socketbuffers were 256k and 2M not 2GB that would be
excessive.


CVSROOT:	/cvs
Module name:	src
Changes by:	tedu@cvs.openbsd.org	2017/04/03 11:23:39

Modified files:
	libexec/comsat : comsat.c 

Log message:
check return from pread, don't divide -1 for count


CVSROOT:	/cvs
Module name:	www
Changes by:	claudio@cvs.openbsd.org	2017/04/03 11:58:32

Modified files:
	.              : 61.html 

Log message:
TLS session ticket support in relayd and httpd


CVSROOT:	/cvs
Module name:	src
Changes by:	krw@cvs.openbsd.org	2017/04/03 12:23:36

Modified files:
	sbin/dhclient  : conflex.c parse.c 

Log message:
Simplify read_string() to just read the characters between the '"'s.
Push the un-vising up to parse_string(). This allows both the actual
string and the un-vised version to be available as desired. Use
memcpy() instead of strdup() to copy un-vised string since it may
legitimately contain NUL.


CVSROOT:	/cvs
Module name:	src
Changes by:	fcambus@cvs.openbsd.org	2017/04/03 12:43:41

Modified files:
	usr.sbin/wsfontload: wsfontload.8 

Log message:
WSDISPLAY_MAXFONTCOUNT macro was introduced in sys/dev/wscons/wsconsio.h
(revision 1.75) to limit the number of fonts that can be loaded.

Reflect that in the man page as well.

OK jcs@


CVSROOT:	/cvs
Module name:	src
Changes by:	otto@cvs.openbsd.org	2017/04/03 13:40:43

Modified files:
	share/man/man3 : CMSG_DATA.3 

Log message:
Send and receive 1 byte of data in addition to the control message. This is
needed to make the code work in more cases.
Sending actually is not really needed, but do it anyway, to avoid confusing
mismatch between producer and consumer.
Problem noted by Luke Small; ok deraadt@


CVSROOT:	/cvs
Module name:	src
Changes by:	otto@cvs.openbsd.org	2017/04/03 13:42:04

Modified files:
	lib/libc/sys   : recv.2 

Log message:
Add caveat telling it's better to always read a data byte when passing
control messages.
Problem noted by Luke Small; ok deraadt@


CVSROOT:	/cvs
Module name:	src
Changes by:	krw@cvs.openbsd.org	2017/04/03 13:59:39

Modified files:
	sbin/dhclient  : clparse.c dhcpd.h parse.c 

Log message:
Change parse_string() to take an optional integer pointer that can
be used to return the final size of the parsed (i.e. un-vis'ed)
string. Use same, plus memcpy() to ensure entire final string is
copied to intended destination even if there are embedded NULs.


CVSROOT:	/cvs
Module name:	src
Changes by:	fcambus@cvs.openbsd.org	2017/04/03 14:59:19

Modified files:
	sbin/shutdown  : shutdown.c 

Log message:
warn format string should be literal.

OK deraadt@, millert@


CVSROOT:	/cvs
Module name:	www
Changes by:	tb@cvs.openbsd.org	2017/04/03 16:23:01

Modified files:
	build          : support.dat 

Log message:
+Wenka Computer Systems


CVSROOT:	/cvs
Module name:	www
Changes by:	tb@cvs.openbsd.org	2017/04/03 16:23:25

Modified files:
	.              : support.html 

Log message:
sync


CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2017/04/03 18:03:12

Modified files:
	etc/etc.alpha  : Makefile.inc 
	etc/etc.amd64  : Makefile.inc 
	etc/etc.arm64  : Makefile.inc 
	etc/etc.armv7  : Makefile.inc 
	etc/etc.hppa   : Makefile.inc 
	etc/etc.i386   : Makefile.inc 
	etc/etc.landisk: Makefile.inc 
	etc/etc.loongson: Makefile.inc 
	etc/etc.luna88k: Makefile.inc 
	etc/etc.macppc : Makefile.inc 
	etc/etc.sgi    : Makefile.inc 
	etc/etc.socppc : Makefile.inc 
	etc/etc.sparc64: Makefile.inc 

Log message:
cp -p the bootblocks to RELEASEDIR; ok tb


CVSROOT:	/cvs
Module name:	src
Changes by:	djm@cvs.openbsd.org	2017/04/03 18:24:56

Modified files:
	usr.bin/ssh    : sftp-server.c 

Log message:
disallow creation (of empty files) in read-only mode; reported by
Michal Zalewski, feedback & ok deraadt@


CVSROOT:	/cvs
Module name:	src
Changes by:	claudio@cvs.openbsd.org	2017/04/03 18:40:52

Modified files:
	sys/dev/pci    : if_iwm.c if_iwmreg.h 

Log message:
Add 8265 and 3168 support. Both cards need new firmware files which currently
need to be installed by hand until the iwm-firmware package has been updated.
This includes handling (by ignoring) of IWM_UCODE_TLV_FW_MEM_SEG and
IWM_DEBUG_LOG_MSG firmware commands. Mostly stolen from dragonflybsd.
With this in the X270 has working ethernet and wifi.
Commit! deraadt@


CVSROOT:	/cvs
Module name:	src
Changes by:	millert@cvs.openbsd.org	2017/04/03 20:37:15

Modified files:
	usr.sbin/snmpd : snmpd.c 

Log message:
Rewrite tohexstr() to use the common idiom of converting a byte
string to hex nybble by nybble.  This avoids using the return value
of snprintf() unchecked.  OK deraadt@


CVSROOT:	/cvs
Module name:	src
Changes by:	deraadt@cvs.openbsd.org	2017/04/03 22:38:31

Modified files:
	sys/dev/ic     : malo.c 

Log message:
add a free() size near microcode loading


CVSROOT:	/cvs
Module name:	src
Changes by:	visa@cvs.openbsd.org	2017/04/04 06:30:04

Modified files:
	sys/arch/sparc64/sparc64: lock_machdep.c 

Log message:
Issue memory barrier before lock release, not after. This ensures
the release write becomes globally visible only after any writes
of the critical section are globally visible. In practice, the
reordering has not happened because the kernel runs in the total
store order mode.

Tested by and OK kettenis@


CVSROOT:	/cvs
Module name:	src
Changes by:	kettenis@cvs.openbsd.org	2017/04/04 06:56:24

Modified files:
	sys/arch/arm64/arm64: pmap.c 

Log message:
Cleanup the code further.  Get rid of the remaining C++-style comments,
remove some debug printfs, get rid of STATIC and __inline defines and
remove a bit more unused code.

ok drahn@, visa@


CVSROOT:	/cvs
Module name:	src
Changes by:	krw@cvs.openbsd.org	2017/04/04 07:01:20

Modified files:
	sbin/dhclient  : clparse.c dhclient.c dhcpd.h 

Log message:
Treat SSID's like the 0 to 32 bytes of uint8_t data that they really
are. Track and use the actual lengths and use memcpy()/memcmp()
instead of strcmp()/strdup().


